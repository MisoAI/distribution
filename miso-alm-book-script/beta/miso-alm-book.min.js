!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===s&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(":root{--mfa-color-primary-10:#e5eefa;--mfa-color-primary-20:#d2e1f3;--mfa-color-primary-100:#05c;--mfa-color-secondary-100:#06aeb8;--mfa-color-neutral-10:#e5e7ea;--mfa-color-neutral-40:#8c8c8c;--mfa-color-neutral-60:#66707e;--mfa-color-neutral-80:#544f4f;--mfa-color-neutral-100:#001129;--miso-ask-combo-content-padding:0!important}.mfa-card{background-color:#fff;border:1px solid var(--mfa-color-neutral-10);border-radius:.25rem;padding:1.5rem}.mfa-card .mfa-card__header{color:var(--mfa-color-neutral-100);font-family:Roboto,sans-serif;font-size:1.125rem;font-weight:600;line-height:1.2;margin-bottom:.75rem}.mfa-ask-input .miso-search-box__input-group{align-items:center;border:none!important;padding-right:.25rem}.mfa-ask-input .miso-search-box__input{height:2.75rem}.mfa-ask-input .miso-search-box__input::-moz-placeholder{color:var(--mfa-color-neutral-60)!important}.mfa-ask-input .miso-search-box__input::placeholder{color:var(--mfa-color-neutral-60)!important}.mfa-ask-input .miso-search-box__button{background-color:var(--mfa-color-primary-100)!important;color:#fff!important;font-family:Roboto,sans-serif!important;font-size:.875rem!important;font-weight:600;height:2.4rem;padding:.5rem 1.5rem!important}.mfa-question-option{align-items:center;background-color:var(--mfa-color-primary-10);border-radius:.25rem;cursor:pointer;display:flex;gap:.5rem;padding:.75rem}.mfa-question-option svg{color:var(--mfa-color-secondary-100);flex-shrink:0}.mfa-question-option .mfa-question-option__text{color:var(--mfa-color-neutral-100);font-family:Roboto,sans-serif;font-size:.875rem;font-weight:400}.mfa-question-option:hover{background-color:var(--mfa-color-primary-20)}miso-answer .miso-markdown p{line-height:1.5}miso-answer .miso-markdown li:not(:last-child){margin-bottom:1.25rem}.miso-list__item{border:none!important}.miso-list__item .miso-list__item-body{padding:0!important}.miso-list__item .miso-list__item-index{margin-top:-3px}.miso-ask-combo__related-resources-phrase{font-size:1.25rem!important;margin-bottom:1.5rem!important}miso-related-questions .miso-list__list{display:flex;flex-direction:column;gap:.75rem;list-style-type:none;padding-left:0!important}.mfa-answer-header{align-items:center;display:flex;flex-wrap:wrap;justify-content:space-between;margin-bottom:1.2rem;margin-top:1.5rem}.mfa-answer-header.mfa-answer-header--unready{display:none}.mfa-answer-header__title{display:flex;flex-wrap:wrap;font-size:1.875rem}.mfa-answer-header__title miso-ask[status~=ready][visible-when~=ready]{display:flex!important;font-weight:700}.mfa-answer-header__title miso-ask[status~=ready][visible-when~=ready] .miso-text{font-size:1.875rem;line-height:1.5;margin:0}.mfa-answer-header__action{align-items:center;border:none;color:var(--mfa-color-primary-100);display:flex;font-size:.875rem;font-weight:600}.mfa-answer-header__action svg{height:1.25rem;width:1.25rem}.mfa-answer-header__action:hover{text-decoration:underline}.mfa-answer__info{align-items:center;display:flex;gap:.25rem;margin-bottom:1rem}.mfa-answer__info svg{color:var(--mfa-color-secondary-100)}.mfa-answer-container{display:flex;flex-direction:row;gap:4rem}.mfa-answer-main-block,.mfa-answer-secondary-block{width:50%}.mfa-answer-related{margin-top:2rem}.mfa-answer-footer{margin-bottom:4rem}.mfa-source-item__main-block{display:flex;flex-direction:column;gap:.5rem}.mfa-source-item__main-block .mfa-source-item__title{color:var(--mfa-color-neutral-100);font-family:Roboto,sans-serif;font-size:.875rem;font-weight:600;line-height:1.2}.mfa-source-item__main-block .mfa-source-item__date{color:var(--mfa-color-neutral-60);font-family:Roboto,sans-serif;font-size:.875rem;font-weight:400;letter-spacing:-.02em;line-height:1.5}.mfa-source-item__main-block .mfa-source-item__snippet{color:var(--mfa-color-neutral-100);font-family:Roboto,sans-serif;font-size:.875rem;font-weight:400;line-height:1.2}.mfa-source-item__main-block .mfa-source-item__snippet mark{background-color:transparent}.mfa-source-item__main-block .mfa-source-item__actions{align-items:center;color:var(--mfa-color-secondary-100);display:flex;font-size:.875rem;gap:.5rem}miso-sources .miso-list__item{border-radius:0!important;margin-top:.75rem!important}miso-sources .miso-list__item:not(:last-child){border-bottom:1px solid #d9d9d9!important;padding-bottom:.75rem!important}miso-sources .miso-list__item-body:hover .mfa-source-item__actions{text-decoration:underline}.mfa-related-resource{display:flex;font-size:.875rem;gap:1.875rem;width:100%}.mfa-related-resource .miso-list__item-body{flex:1}.mfa-related-resource__tags{margin-bottom:.625rem}.mfa-related-resource__tag{border-radius:.25rem;font-size:.625rem;padding:.125rem .5rem;text-transform:uppercase}.mfa-related-resource__tag--ebook{background-color:#2062ce;color:#fff}.mfa-related-resource__title{color:#333;font-size:1.25rem;font-weight:700;line-height:1;margin-bottom:.625rem}.mfa-related-resource__array-data-group{display:flex;gap:.25rem}.mfa-related-resource__array-data-group:not(:last-child){margin-bottom:.25rem}.mfa-related-resource__array-data-label{color:#544f4f;font-weight:700;text-transform:capitalize}.mfa-related-resource__array-data-value{color:#8c8c8c}.mfa-related-resource__snippet{display:flex;gap:.5rem;margin-top:.875rem}.mfa-related-resource__snippet svg{color:var(--mfa-color-secondary-100);margin-top:2px}.mfa-related-resource__snippet div{color:#333}.mfa-related-resource__snippet div mark{background-color:transparent}.mfa-related-resource__actions{display:flex;flex-direction:column;gap:.625rem;width:9rem}.mfa-related-resource__action{align-items:center;cursor:pointer;display:flex;gap:.5rem}.mfa-related-resource__action span{color:#2062ce}.mfa-related-resource__action:hover span{text-decoration:underline}.mfa-answer{padding-bottom:2rem}.mfa-source{padding-bottom:1.5rem}.mfa-answer-divider{background-color:transparent!important;background:repeating-linear-gradient(90deg,#333 0 4px,transparent 0 8px);margin-bottom:2.5rem!important;margin-top:0!important}.mfa-followup-title{font-size:1.875rem;margin-bottom:1.25rem}.mfa-followup-title .mfa-followup-title__question{font-weight:700}.mfa-followup-title .miso-text{display:inline;font-size:1.875rem!important;line-height:1.5!important;margin:0!important}.miso-ask-combo__ask-this-book{height:100%}.mfa-ask-this-book{font-size:.875rem;height:100%;line-height:1.5rem}.mfa-ask-this-book .mfa-ask-input{padding:0 .625rem}.mfa-ask-this-book .mfa-ask-this-book__container{height:calc(600px - 4rem);overflow-y:auto;padding:0 .625rem 2rem}.mfa-ask-this-book .miso-search-box .miso-search-box__input-group{border:1px solid var(--miso-border-color-light)!important}.mfa-ask-this-book .miso-search-box .miso-search-box__input{font-size:.875rem!important}.mfa-ask-this-book .mfa-ask-input{margin-bottom:1.25rem}.mfa-ask-this-book__answer-title{font-weight:700;margin-bottom:.75rem}.mfa-ask-this-book__answer-title .miso-text{display:inline;font-size:.875rem!important;line-height:1.5rem!important;margin:0!important}.mfa-ask-this-book__explore--hide{display:none}.mfa-ask-this-book__info{font-size:.625rem;padding-right:.625rem;text-align:right}.mfa-ask-this-book__info--hide{display:none}.mfa-related-questions-container__header{color:var(--mfa-color-neutral-100);font-family:Roboto,sans-serif;font-size:.875rem;font-weight:600;line-height:1.2;margin-bottom:.75rem}.mfa-ask-this-book__tabs,.mfa-my-answers__tabs{border-bottom:1px solid var(--miso-border-color-light);display:flex;gap:1rem}.mfa-ask-this-book__tabs .mfa-ask-this-book__tab,.mfa-ask-this-book__tabs .mfa-my-answers__tab,.mfa-my-answers__tabs .mfa-ask-this-book__tab,.mfa-my-answers__tabs .mfa-my-answers__tab{color:var(--mfa-color-neutral-40);cursor:pointer;font-family:Roboto,sans-serif;font-size:.8rem;font-weight:600;letter-spacing:-.02em;padding:.1rem 0}.mfa-ask-this-book__tabs .mfa-ask-this-book__tab.mfa-ask-this-book__tab--active,.mfa-ask-this-book__tabs .mfa-ask-this-book__tab.mfa-my-answers__tab--active,.mfa-ask-this-book__tabs .mfa-my-answers__tab.mfa-ask-this-book__tab--active,.mfa-ask-this-book__tabs .mfa-my-answers__tab.mfa-my-answers__tab--active,.mfa-my-answers__tabs .mfa-ask-this-book__tab.mfa-ask-this-book__tab--active,.mfa-my-answers__tabs .mfa-ask-this-book__tab.mfa-my-answers__tab--active,.mfa-my-answers__tabs .mfa-my-answers__tab.mfa-ask-this-book__tab--active,.mfa-my-answers__tabs .mfa-my-answers__tab.mfa-my-answers__tab--active{border-bottom:2px solid var(--mfa-color-primary-100);color:var(--mfa-color-primary-100)}.mfa-ask-this-book__tabs{margin-bottom:1.25rem}.mfa-my-answers__tabs{margin-bottom:.5rem}.mfa-ask-this-book__tab-content,.mfa-my-answers__tab-content{display:none}.mfa-ask-this-book__tab-content.mfa-ask-this-book__tab-content--active,.mfa-ask-this-book__tab-content.mfa-my-answers__tab-content--active,.mfa-my-answers__tab-content.mfa-ask-this-book__tab-content--active,.mfa-my-answers__tab-content.mfa-my-answers__tab-content--active{display:block}.miso-user-history__empty{color:var(--mfa-color-neutral-60);font-size:.875rem;padding:1rem 0;text-align:center}.miso-user-history__list{list-style-type:none;padding-left:0}.miso-user-history__list .miso-user-history__item{border-bottom:1px solid var(--miso-border-color-light);cursor:pointer;font-size:.875rem;padding:.75rem 0}.miso-user-history__list .miso-user-history__item:last-child{border-bottom:none}");var t="1.12.3-beta.6";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var n=Object.freeze({__proto__:null,GROUP:s,NAME:i});function o(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function r(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function c(t){return null==t}function l(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function u(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function _(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function d(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function h(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class m{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);f(s),f(i),f(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>p(this,t)),e):p(this,t),this._value=t}disconnect(){this._active=!1}}function p(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function f(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function g(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function b(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function y(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async i=>{try{await t(i),e()}catch(t){s(t)}}))}))}async function w(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((n,o)=>{const r=new m((t=>{t&&(r.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),o(new DOMException("Aborted","AbortError"))}))}))}function v(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function k(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function E(t,e){const s=C((()=>window.localStorage.getItem(t))),i=C((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,o=e.indexOf(";",n);return decodeURIComponent(0>o?e.substring(n):e.substring(n,o))}(t))),n=s||i||""+e();return n&&!s&&C((()=>window.localStorage.setItem(t,n))),n&&!i&&C((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n))),n}function C(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function S(t){return new x(t)}class x{constructor(t){this._value=t;const e=t=>{this._value=t};u(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class O{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class I{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new O),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function T(t,e){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,{onError:e=t=>console.error(t),transform:s=t=>t}={}){try{s(t)()}catch(t){e(t)}}(t,e);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let A;try{A=document.currentScript}catch(t){}async function R(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if(q(t))return;return new Promise((e=>{let s;s=setInterval((()=>{q(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function N(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.3-beta.6/dist/css/${t}.css`}function q(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function L(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function P(t,{depth:e=5,...s}={}){return $(t,e)}function $(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>$(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const n=t[i];"function"!=typeof n&&(i.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(s[i]=$(n,e-1)))}return s}(t,e):t:"(...)"}function U(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,n]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,n)}function j(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:o}=n[i];o&&(e[i]="function"==typeof o?o.bind(t):o)}}return Object.freeze(e)}function M(t={},e={}){const s=t.metadata||e.metadata?a({...t.metadata,...e.metadata}):void 0,i=t._meta||e._meta?a({...t._meta,...e._meta}):void 0;return a({...t,...e,metadata:s,_meta:i})}function D(t={},e={}){const s=t.context&&t.context.custom_context||e.context&&e.context.custom_context?a({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context}):void 0,i=t.context||e.context?a({...t.context,...e.context,custom_context:s}):void 0;return a({...t,...e,context:i})}function z(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let n=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(n*=1+(s-i)*e/1e3),n}}(t);return(t,s,i,n)=>{const o=e(i,s);return t+Math.max(n-i,0)*o/1e3}}const F=Symbol.for("miso:resources");class B{constructor(){this._resources=new Map;const t=window[F]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){Q(this._resources,t).resolve(e)}async get(t){return Q(this._resources,t).promise}}function Q(t,e){if(t.has(e))return t.get(e);const s=new O;return t.set(e,s),s}function H(){return window[F]||(window[F]=new B)}class G{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new O;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class V{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)o(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&o(s,e)}}_injectSubscribeInterface(t){l(t,this,["on","once"])}}function W(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class Y{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:W(t,e),uuid:k()})}(t,e);u(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new V({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(Y,"miso:component");class K extends Y{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new O);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Z{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new m(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class J{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const X=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class tt{constructor(t,e){this._client=t,this._root=e,this._bulk=new G(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n}={}){const{request:o={}}=this._client.options;n=n||o.timeout;const r="GET"!==s&&null!=e?JSON.stringify(e):void 0,c=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(t,a({method:s,headers:i,body:r,cache:"no-cache",mode:"cors",signal:c})),u=await l.json();if(l.status>=400||u.errors){var _=Error(u.message);throw _.data=u,_.status=l.status,_}return u}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:o,body:r}=i[e];o>=400||n?s.reject({status_code:o,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t){const{apiKey:e}=this._client.options,s=t.filter((t=>t)).join("/");return`${`${this.getApiEndpoint(s)}/${s}`}?api_key=${window.encodeURIComponent(e)}`}getApiEndpoint(t){const{dataEndpoint:e=X.DATA_ENDPOINT,eventEndpoint:s=X.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const o of this._root._urlPasses)try{i=o({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const o of this._root._payloadPasses)try{i=o({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}applyHeaderPasses(t,{apiGroup:e,apiName:s,payload:i,headers:n,options:o}){const r=this._client;for(const a of this._root._headersPasses)try{n=a({client:r,apiGroup:e,apiName:s,payload:i,headers:n,options:o})||n}catch(e){(t._error||console.error)(e)}return n}}class et extends Y{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,o=this._apiPath,r=this._url({apiGroup:o,apiName:t,payload:e,options:s}),a=this._headers({apiGroup:o,apiName:t,payload:e,options:s}),c={apiGroup:o,apiName:t,payload:e=this._preprocess({apiGroup:o,apiName:t,payload:e,options:s}),url:r,headers:a,options:s};this._events.emit("request",{...c,...n});const l=await this._send(c),u={...c,response:l};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_headers({apiGroup:t,apiName:e,payload:s,options:i}){return this.helpers.applyHeaderPasses(this,{apiGroup:t,apiName:e,payload:s,headers:{},options:i})}_preprocess({apiGroup:t,apiName:e,payload:s,options:i}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s,options:i})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,headers:i,payload:n,options:{bulk:o,...r}={}}){return o?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,{...r,headers:i})}_postprocess({response:t}){return t.data}}const{GROUP:st,NAME:it}=n;class nt extends et{constructor(t){super(t,st.INTERACTIONS)}async upload(t,e){try{return await this._run(it.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===it.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class ot{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...n}=this._options;const o=new J(i);let r;s=e(this._ac.signal,o.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:o}={}){if(o&&o.aborted)return[];let r,a,l=0,u=!1;function _(){r&&clearInterval(r),u=!0}const d=new I;return r=setInterval((async()=>{let e,r,h;try{if([e,r,h]=await t(o?{signal:o}:{}),u||!c(a)&&a>=h)return;c(h)||(a=h),n&&n(e,r,h),l=0}catch(t){return i&&i(t),l++,void(l>s&&(_(),d.error(t)))}d.update(e,r),r&&_()}),e),o&&o.addEventListener&&o.addEventListener("abort",(()=>{_(),d.abort(o.reason)})),d}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:s,onResponse:(t,e)=>{e?o.clear():this._isUpdated(r,t)&&o.touch(),r=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||at(t.answer)!==at(e.answer)||at(t.reasoning)!==at(e.reasoning)}_revisionOf(t){return t&&t.revision}}class rt extends ot{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}function at(t=""){return t.length}const{GROUP:ct,NAME:lt}=n;class ut extends et{constructor(t){super(t,ct.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t)&&(t={question_id:t}),t.question_id)return new _t(this,t,e);const s=await this._run(lt.QUESTIONS,t,e);return new _t(this,s,e)}async _questions(t,e){return this._run(lt.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${lt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(lt.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(lt.TRENDING_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(lt.SEARCH,t,e);return s.question_id?new dt(this,s,e):s}async _searchGet(t,e){return this._run(`${lt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(lt.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(lt.SEARCH_AUTOCOMPLETE,t,e)}}class _t extends rt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class dt extends rt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),u(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:ht,NAME:mt}=n;class pt extends et{constructor(t){super(t,ht.SEARCH)}async search(t,e){return this._run(mt.SEARCH,t,e)}async autocomplete(t,e){return this._run(mt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(mt.MGET,t,e)}}const{GROUP:ft,NAME:gt}=n;class bt extends et{constructor(t){super(t,ft.RECOMMENDATION)}async userToProducts(t,e){return this._run(gt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(gt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(gt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(gt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(gt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(gt.PRODUCT_TO_PRODUCTS,t,e)}}class yt extends Y{constructor(t,e){super("api",t),this._client=t,this.helpers=new tt(t,e),this.interactions=new nt(this),this.ask=new ut(this),this.search=new pt(this),this.recommendation=new bt(this)}}var wt=Object.freeze({__proto__:null,Api:yt,ApiBase:et,ApiHelpers:tt,Interactions:nt,Ask:ut,Search:pt,Recommendation:bt});class vt extends Y{constructor(t){super("context",t),this._client=t}}var kt={api:wt,context:{Context:vt}};class Et{constructor(t){u(this,{install:t})}}class Ct extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new St(this,kt),this.plugins=new xt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new O);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addHeadersPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._headersPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return u(i,{id:t}),this._tryConfig(i,e),i;case"function":return new Et(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,o=t.lastIndexOf("/",n)+1,r=t.indexOf(".",o),a=0>r?"":t.slice(r,n);return`${t.slice(0,o)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new H).get(s);!this.isRegistered(t)&&this.register(i)}}class St{constructor(t,e){l(this,t,["getPluginClass","addSubtree","addPayloadPass","addHeadersPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),u(this,{classes:e})}}class xt{constructor(t){l(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Ot=new class extends Y{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Ct(this),this._clients=[],this._payloadPasses=[],this._headersPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=t,this._cmdRes=new O}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var It=Object.freeze({__proto__:null,viewable:w,debounce:L});const{currentScript:Tt}=document;class At extends Y{static attach(){(window.MisoClients||(window.MisoClients=[])).push(At),window.MisoClient?window.MisoClient!==At&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=At}static debug(){}constructor(t){super("client",Ot),this._config(t),this.context=new vt(this),this.api=new yt(this,Ot),function(t){Ot._clients.push(t),Ot._events.emit("create",t)}(this)}get version(){return At.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.request&&t.request.sendApiKeyByHeader&&console.warn('`sendApiKeyByHeader` option is deprecated. Please call `MisoClient.plugins.use("std:header-api-key");` instead.'),t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,a(t)}_readConfigFromScriptUrl(){return a({apiKey:new URL(new Request(Tt.src||Tt.href).url).searchParams.get("api_key")||void 0})}}At.helpers=It,u(At,{uuid:k()});var Rt=function(t){const e=Ot._pluginRoot;return Ot.MisoClient=e.MisoClient=t,l(t,Ot,["version","instances","any","meta","on","once","cmdDone"]),l(t,e,["plugins"]),t}(At);const{GROUP:Nt,NAME:qt}=n;let Lt;class Pt{constructor(t){this._plugin=t,this._props={}}get anonymous_id(){return this._props.anonymous_id||Lt||(Lt=E("miso_anonymous_id",k))}set anonymous_id(t){this._requireString("anonymous_id",t),this._set("anonymous_id",t)}get user_id(){return this._props.user_id}set user_id(t){this._requireString("user_id",t),this._set("user_id",t)}get user_hash(){return this._props.user_hash}set user_hash(t){this._requireString("user_hash",t),this._set("user_hash",t)}get user_type(){return this._props.user_type}set user_type(t){this._requireString("user_type",t),this._set("user_type",t)}get site(){return this._props.site}set site(t){this._requireString("site",t),this._set("site",t)}get auth(){return this._props.auth}set auth(t){this._requireString("auth",t),this._set("auth",t)}_set(t,e){this._props[t]=e,this._plugin._events.emit("set",`${t} = '${e}'`)}_requireString(t,e){if("string"!=typeof e&&void 0!==e)throw Error(t+" must be a string");return e}}function $t(){const t=new URLSearchParams(window.location.search);let e=a({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Ut{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function jt(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=k()),{...e,context:{...s,custom_context:i}}}const Mt="std:native-fetch";let Dt,zt;const Ft=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Dt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Dt="borrowed",t.contentWindow.fetch}catch(t){zt=t}})();const Bt="std:header-api-key";const Qt="miso-logdump",Ht="miso-logdump",Gt=Ht+"__download-btn",Vt="Miso Log";class Wt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Jt||(Jt=R(N("logdump")))}();let t=document.getElementById(Qt);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Vt,e.classList.add(Gt),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Qt,t.classList.add(Ht),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Qt),e=t&&t.querySelector("."+Gt);e&&(e.textContent=this._options.logDownloadButtonText||Vt)}hideDownloadButton(){const t=document.getElementById(Qt);t&&(t.style.display="none")}download(){const t=new Blob([Kt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Yt()})}return t&&"string"==typeof t?t:`miso-log.${Yt()}.jsonl`}clear(){this._logs=[]}}function Yt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Kt(t){return t.map((t=>JSON.stringify(P(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Zt(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function Zt(t){return t?P(t,{depth:2}):t}let Jt;const Xt="std:debug";function te(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}Rt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Wt(t)}static get id(){return Xt}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Xt,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...o}){const r=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+r),"interactions"===e){const t=o.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,n="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${n} (${i})`:""+n)}a.push([{...o,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(te)):this._log(t,e,te(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Mt}install(t,e){Ft?(e.setCustomFetch(Ft),t.debug(`<plugin:${Mt}>`,"[info]",`Using ${Dt} native fetch`)):t.debug(`<plugin:${Mt}>`,"[error]","Failed to obtain native fetch: "+zt.message)}},class{static get id(){return Bt}install(t,e){e.addUrlPass(this._modifyUrl.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),t.debug(`<plugin:${Bt}>`,"[info]","Send API key in header")}_modifyUrl({url:t}){return t.replace(/[?&]api_key=[^&]*/g,"")}_modifyHeaders({client:t,headers:e}){const{apiKey:s}=t.options;return s?{...e,"X-API-KEY":s}:e}}),Rt.plugins.use(class extends Y{static get id(){return"std:context"}constructor(){super("context")}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Pt(this);var s,i;s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type","site","auth"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyHeaders({client:t,headers:e}){const{auth:s}=t.context;return s&&(e={...e,Authorization:s}),e}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return i?e===Nt.INTERACTIONS?s===qt.UPLOAD?this._modifyPayloadForInteractions(t,i):i:this._modifyPayloadForQueries(t,i):i}_modifyPayloadForQueries(t,e){const{user_id:s,user_hash:i,user_type:n,anonymous_id:o,site:r}=t.context;return M(e,{...s?{user_id:s,user_type:n,user_hash:i}:{anonymous_id:o},metadata:r?{site:r}:void 0})}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i,site:n}=t.context,o={anonymous_id:s,user_id:i},r=n?{site:n}:void 0,a=r?{custom_context:r}:void 0;return{data:e=e.map((t=>D(t,{...o,context:a})))}}}),Rt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...a({page:a({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:$t()}),...t.context}})))}}}),Rt.plugins.use(class extends Y{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Ut(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:n,payload:o}){if(e===s.SEARCH)if(n===i.SEARCH)this._captureSearchApiRequest(t,o)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Rt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(jt)}}}),Rt.plugins.use(class extends Y{static get id(){return"std:api-patch"}constructor(){super("api-patch")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._patchApiPayload.bind(this))}_patchApiPayload(t){let{payload:e,...s}=t;return e?(e=this._copyMetadataToMeta(e,s),e=this._suppressMetadata(e,s),e=this._suppressUserType(e,s),e):e}_copyMetadataToMeta(t,{apiGroup:e}){return e===s.ASK&&t.metadata?{...t,_meta:t.metadata}:t}_suppressMetadata(t,{apiGroup:e}){switch(e){case s.SEARCH:case s.RECOMMENDATION:const{_meta:e,metadata:i,...n}=t;return n;default:return t}}_suppressUserType(t,{apiGroup:e}){switch(e){case s.SEARCH:case s.RECOMMENDATION:const{user_type:e,...i}=t;return i;default:return t}}});const ee="default",se=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ie=new Set([se.PRODUCTS,se.CATEGORIES,se.ATTRIBUTES,se.RESULTS,se.ITEMS,se.QUESTION,se.ANSWER,se.REASONING,se.IMAGES,se.SOURCES,se.RELATED_RESOURCES,se.FOLLOW_UP_QUESTIONS,se.QUERY_SUGGESTIONS,se.RELATED_QUESTIONS,se.AFFILIATION,se.FACETS,se.TOTAL]);function ne(t){return ie.has(t)}const oe=new Set([se.PRODUCTS,se.IMAGES,se.SOURCES,se.RELATED_RESOURCES]);const re=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ae=[re.IMPRESSION,re.VIEWABLE,re.CLICK,re.SUBMIT,re.FEEDBACK],ce=[re.IMPRESSION,re.VIEWABLE,re.CLICK],le=new Set(ce);const ue=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),_e=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),de=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function he(t){if(0>ae.indexOf(t))throw Error("Unrecognized event type: "+t)}const me=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"}),pe=Object.freeze({QUERY:"query",REFINE:"refine",MORE:"more"});function fe(t,e){return Object.freeze({...t,...e,members:ge(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function ge(t=[],e=[]){return[...new Set([...t,...e])]}function be(t,e){let s={};for(const i of t)i&&(s=e(s,i));return a(s)}function ye(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function we(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>Object.assign(t,{...e,payload:M(t.payload,e.payload)})))}function ve(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function ke(t){if(void 0===t)return;let[e,s]=r(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function Ee(t,e){return!1===(e=ke(e))[0]?e:t&&e?[e[0]||t[0],Ce(t[1],e[1])]:e||t}function Ce(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Se=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function xe(t={}){t=ye(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Oe(e);return t}function Oe(t={}){return t=ye(t)}function Ie(t={},e={}){const s={...t};for(const[i,n]of Object.entries(e))void 0!==n&&(s[i]=ae.includes(i)?Te(t[i],n):n);return s}function Te(t={},e={}){return{...t,...e}}function Ae(t){return void 0===t?void 0:"function"!=typeof t?()=>t:t}const Re=[{key:me.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return a({group:s,name:t,payload:e})},merge:we},{key:me.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${se.PRODUCTS}: ... }) instead`),t={...s,[se.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[ve(e)]=ke(s);return i},merge:function(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=Ee(t[s],i);return t}))}},{key:me.DATA_PROCESSOR,normalize:function(t){t=r(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:me.TRACKERS,normalize:function(t={}){t=ye(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=xe(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:Ie(t[s],i));return t}))}},{key:me.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=r(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:me.FILTERS,normalize:ye,merge:function(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>Object.assign(t,e)))}},{key:me.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&be(t,((t,e)=>Object.assign(t,e)))}},{key:me.TEMPLATES,normalize:function(t={}){const e={};for(const[s,i]of Object.entries(t))e[s]=Ae(i);return e},merge:function(...t){return be(t,((t,e)=>{for(const[i,n]of Object.entries(e))t[i]=(s=t[i],Ae(n)||s);var s;return t}))}}];class Ne{constructor(){this._events=new V({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class qe{constructor(t={},e={}){this._events=new V({target:this}),this._defaults=e,this._context=t||{},this._locals={},u(this,{resolved:new Le(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Le{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class Pe{constructor(t,e,s,i,n){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=n}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Re){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Ne.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Pe(this,this._globals,e,s,i))}}),Object.defineProperty(qe.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Pe(this,this._locals,e,s,i))}}),Object.defineProperty(Le.prototype,e,{get:function(){return this._get(t)}})}const $e=[me.API,me.LAYOUTS,me.DATA_PROCESSOR,me.TRACKERS,me.INTERACTIONS];function Ue(t,e=$e){for(const s of e)je(t,s)}function je(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function Me(t={}){const{setValue:e,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:i="q",sourceParam:n="qs",...o}={}){return{setValue:t,focus:e,updateUrl:s,param:i,sourceParam:n,...o}}(t),o=new URLSearchParams(window.location.search),r=o.get(i),c=o.get(n)||void 0,{layout:l}=this._views.get(se.QUERY);l&&(r&&e&&(l.value=r),!r&&s&&l.focus()),r&&this.query(a({q:r,qs:c}))}class De extends Y{constructor(t,e,s){super(t,e),this._name=t,this._plugin=e,this._client=s,this._options=new Ne}}function ze(t){return t?"view:"+t:"view"}Ue(De.prototype);class Fe{constructor(t={}){(this._events=new V)._injectSubscribeInterface(this),this._options=t,this._states={},u(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const i=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Be{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:k(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function Qe(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class He{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t}async _handleRequest(t){if(!this.active)return;const{session:e,...s}=t;try{const{signal:i}=this._ac||{},n={...t.options,signal:i},o=await this._source({session:e,...s,options:n});if(o&&o[Symbol.asyncIterator]){let t;for await(t of(o._response&&this._emitResponseWithSessionCheck({session:e,request:s,value:o._response}),o)){if(!Qe(this._hub,e))break;this._emitResponse({session:e,request:s,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:s,value:o})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:s,error:t})}}_emitResponseWithSessionCheck(t){Qe(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ge{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{o(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Ve,VIEWABLE:We,CLICK:Ye}=re,{UNTRACKED:Ke,TRIGGERED:Ze}=ue,Je=Object.freeze({[Ve]:Ke,[We]:Ke,[Ye]:Ke});class Xe{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Je}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Ke}set(t,e,s){he(e),function(t){if(t!==ue.UNTRACKED&&t!==ue.TRACKING&&t!==ue.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of r(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Ze))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),(()=>({...Je}))))[e]=s}}const ts=[Symbol("itemless")];class es{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new Xe(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){he(t);const{options:i}=this;if(!i||!1===i.active)return;this._syncSession();const{deduplicated:n=!0,itemless:o=!1}=i;if(n){if(o&&(e=ts),0===(e=this._states.untriggered(r(e),t)).length)return;this._states.set(e,t,ue.TRIGGERED)}this._sendToHub({type:t,items:o?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:re.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(a({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Xe(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[ze(this._role)]}}for(const t of ce)es.prototype[t]=function(e,s){this._trigger(t,e,s)};function ss(t){return t&&t.meta&&t.meta.empty}class is{constructor(t,e){this._events=new V({target:this}),this._views=t,this._mapping=os((t._roles.mappings||{})[e]||e),u(this,{role:e,interface:new ns(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ge((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===se.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new es({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((n=e)===(o=i)||n&&o&&n.status===o.status&&n.error===o.error&&n.value===o.value&&n.ongoing===o.ongoing&&ss(n)===ss(o)&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(n.session,o.session)))return;var n,o;const{session:r,status:a,ongoing:c,request:l,meta:u,value:_}=e,d={session:r,status:a,ongoing:c,request:l,meta:u,data:_,...rs(this.role,e)},h=(t={},e)=>{!1!==t&&this.updateState({...d,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?_e.ERRONEOUS:t.status;t=this._state=Object.freeze(a({...t,status:s}));const{role:i}=this;this.hub.update(ze(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:n,...o}=t,r={value:this._mapping(t,this),status:i,data:e,meta:n,...o};return this.role===se.CONTAINER&&(r.meta={...n,empty:this._isContainerEmpty(t)}),a(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!ne(s))continue;if(!as(s,os((this._views._roles.mappings||{})[s]||s)(t,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class ns{constructor(t){l(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function os(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function rs(t,e){return function(t){return t.status===_e.READY&&!t.ongoing}(e)?{empty:!!as(t,e&&e.value)}:{}}function as(t,e){switch(t){case se.ANSWER:case se.REASONING:return!e||!e.value;default:return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}}function cs(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class ls{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new V({target:this,error:s}),u(this,{facets:new us(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return a({facets:Object.freeze({}),sort:cs(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(a({...t,...e,facets:Object.freeze(a({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class us{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const _s=Symbol.for("miso:tracked");function ds(t){return!!t[_s]}function hs(t){t[_s]=!0}const ms=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ps(t,e){return!!e&&{...t,...e}}class fs{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n,options:o}){this._hub=t,this._workflow=e,this._workflowName=e._name,this._extensions=s,this._layoutFactory=i,this._options=o,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new ls(this);for(const t of n.members)t!==se.CONTAINER&&(this._views[t]=new is(this,t));u(this,{interface:new gs(this),trackers:new bs(this,n.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on("data",(t=>this.refresh({data:t}))),o.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new is(this,se.CONTAINER);e.layout=this._createLayout(se.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===se.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return a({...ms,...n,impression:ps(ms.impression,e),viewable:ps(ms.viewable,s),click:ps(ms.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=se.CONTAINER;this._containerTracker=new es({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class gs{constructor(t){this._actor=t,l(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class bs{constructor(t,e){this._views=t;for(const s of e)s!==se.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,se.CONTAINER,{get:()=>t._getContainerTracker()})}}class ys{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:re.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ws{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=r(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function vs(t){return async({group:e,name:n,payload:o,options:r})=>{if(e===s.ASK)switch(n){case i.QUESTIONS:return t.api.ask.questions(o,r);case i.SEARCH:return t.api.ask.search(o,r)}return t.api[e]._run(n,o,r)}}class ks{constructor({role:t,workflow:e,...s}={}){u(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=S(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,y((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const n=this._rendered.get(this._element),o=S([]),r=S({});this._render(this._element,{state:s,rendered:n,timestamp:t},{notifyUpdate:o.args,writeToState:r.merge,...e}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),i&&i(...o.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Es(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function Cs(t,e,s,i){const{templates:n}=t,[o,r]=zs(t,s);return""+o+(n.indexBlock||Ms)(t,s,i)+(n.infoBlock||n.articleInfoBlock||Is)(t,s,i)+r}function Ss(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||As)(t,e,s)+(n.descriptionBlock||Ns)(t,e,s)+(n.priceBlock||$s)(t,e,s)+(n.ctaBlock||Ds)(t,e,s)}</div>`}function xs(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||As)(t,e,s)+(n.descriptionBlock||Ns)(t,e,s)+(n.priceBlock||$s)(t,e,s)}</div>`}function Os(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||As)(t,e,s)+(n.dateBlock||qs)(t,e,s)+(n.descriptionBlock||Ns)(t,e,s)+(n.ctaBlock||Ds)(t,e,s)}</div>`}function Is(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||As)(t,e,s)+(n.authorsAndDateBlock||Ps)(t,e,s)}</div>`}function Ts(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||As)(t,e,s)}</div>`}function As({className:t},{title:e,_title_with_markups:s}){const i=Hs(s)||v(e);return i?`<div class="${t}__item-title">${i}</div>`:""}function Rs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ns({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${Hs(e)}</div>`:s?`<div class="${t}__item-desc">${v(s)}</div>`:""}function qs({className:t,templates:e},{created_at:s,updated_at:i,published_at:n}){const o=n||s||i;return o?`<div class="${t}__item-date">${Qs(o,e.date)}</div>`:""}function Ls({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function Ps(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-authors-and-date-container">${""+(n.authorsBlock||Ls)(t,e,s)+(n.dateBlock||qs)(t,e,s)}</div>`}function $s(t,e){const{className:s,templates:i}=t,{sale_price:n,original_price:o,currency:r="USD"}=e,a=n||o;if(!a)return"";const c=void 0!==o&&void 0!==n&&o>n,l=e.discount_rate_percent||(c?Math.floor(100*(1-n/o)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${o}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Us)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function Us(t,{discount_rate_percent:e}){return`(${e}% off)`}function js(t,e,s={}){const{className:i,templates:n}=t,{cover_image:o,image_src:r,image_alt:a}=e;if(!o&&!r)return"";const c=r?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${o}">`}${"cover-image"===c&&s.brand?(n.brandBlock||Rs)(t,e,s):""}</div>`}function Ms({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Ds(t,e,s){const{className:i,templates:n}=t,o=Gs.asFunction(n.cta)(t,e,s);return o?`<div class="${i}__item-cta-container">${o}</div>`:""}function zs({className:t,options:e={}},{product_id:s,url:i},{classSuffix:n="item-body",role:o="item",...r}={}){const a=!1!==r.link&&i?"a":"div";return[`<${a} class="${t}__${n}" ${o?`data-role="${o}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==r.link&&i?`href="${i}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:i=!0}=t;let n="";i&&(e&&(n+=` target="${e}"`),s&&(n+=` rel="${s}"`));return n}(e.link)}`:""}>`,`</${a}>`]}const Fs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Bs="en-US";function Qs(t,e=Fs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Fs.locale,e);default:throw Error("Invalid date format: "+e)}}function Hs(t){return t&&t.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Gs=Object.freeze({tagPair:zs,formatDate:Qs,formatNumber:function(t,e=Bs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||Bs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},formatHtmlWithMarkup:Hs,escapeHtml:v,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Vs extends ks{constructor({className:t,templates:e,...s}={}){super(s),u(this,{className:t,templates:{...Es("root"),...e,helpers:Gs}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Ws extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ws.MisoClient.ui.layouts.create("banner").render(this)}}class Ys{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let n=!1;try{await w(t,{...e,signal:i}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return n}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Ks extends ks{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ys}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Ws.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===se.PRODUCTS||t===se.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:o=!1,unanswerable:r=!1}={}}=e,a=[s,o?_e.EMPTY:_e.NONEMPTY];s===_e.READY&&a.push(i?_e.ONGOING:_e.DONE),r&&a.push(_e.UNANSWERABLE),t.setAttribute("status",a.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===_e.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Zs=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:o}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,o)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Js extends Vs{static get type(){return"error"}static get defaultTemplates(){return Zs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Zs,...e},...s})}}const Xs=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function ti(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class ei{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,n=new Map,o=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],l=Object.freeze({index:r,key:a,value:e[r],element:c});i.set(a,l),n.set(c,l),o.push(l)}return{k2b:i,e2b:n,entries:o}}(t,e,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},o=ti(n,i),r=ti(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:o,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function si(t){U(t,ii.prototype)}class ii{_initTrackable(){this._bindings=new ei,this._viewables=new Ys}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map((t=>this._getItemKey(t))),n=this._getItemElements(t),{bounds:o,unbounds:r}=this._bindings.update(i,s,n);this._onBindingsUpdate(o,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!ds(e)&&0===e.button&&!e.defaultPrevented&&!!g(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&(hs(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class ni{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===_e.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await w(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const oi=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[o,r]=zs(t,s);return""+o+(n.imageBlock||js)(t,s,i)+(n.infoBlock||n.productInfoBlock||xs)(t,s,i)+r},article:function(t,e,s,i){const{templates:n}=t,[o,r]=zs(t,s);return""+o+(n.imageBlock||js)(t,s,i)+(n.infoBlock||n.articleInfoBlock||Os)(t,s,i)+(n.indexBlock||Ms)(t,s,i)+r},compactArticle:Cs,image:function(t,e,s,i){const{templates:n}=t,[o,r]=zs(t,s);return""+o+(n.imageBlock||js)(t,s,i)+(n.infoBlock||n.imageInfoBlock||Ts)(t,s,i)+r},question:function(t,e,s){const[i,n]=zs(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n,options:o}=t,{status:r}=e;return`<div class="${s} ${r}"${i?` data-role="${i}"`:""}${o.itemType?` data-item-type="${o.itemType}"`:""}>${r===_e.READY?n[r](t,e):""}${n.trigger(t,e)}${n.loading(t,e)}</div>`},[_e.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e)||[];return i.length>0||e.ongoing?s.body(t,e,i):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:i,templates:n,options:o}=t,r=n.ordered?"ol":"ul";return`<${r} class="${i}__list" data-role="list"${o.itemType?` data-item-type="${o.itemType}"`:""}>${n.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let o=i;return s.map((s=>n.item(t,e,s,o++))).join("")},item:function(t,e,s,i){const{className:n,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${n}__item">${o[a](t,e,s,{index:i})}</li>`},productInfoBlock:xs,articleInfoBlock:Os,compactArticleInfoBlock:Is,imageInfoBlock:Ts,brandBlock:Rs,titleBlock:As,descriptionBlock:Ns,dateBlock:qs,authorsBlock:Ls,authorsAndDateBlock:Ps,priceBlock:$s,discountRateText:Us,ctaBlock:Ds,cta:function(t,e,s){const{templates:i}=t,{url:n}=e;if(!n)return"";const[o,r]=zs(t,{url:n},{classSuffix:"item-cta",role:"cta"}),a=Gs.asFunction(i.ctaText)(t,e,s);return a?`${o}${a}${r}`:""},imageBlock:js,indexBlock:Ms,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class ri extends Vs{static get defaultTemplates(){return oi}constructor({templates:t,itemType:e="product",...s}){super({templates:{...oi,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value&&(t.value.products||t.value)}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:n}=e;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}si(ri.prototype),U(ri.prototype,ni.prototype);const ai="miso-list";class ci extends ri{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ai}constructor({className:t=ai,...e}={}){super({className:t,...e})}}const li="miso-horizontal";class ui extends ri{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return li}constructor({className:t=li,...e}={}){super({className:t,...e})}}const _i="miso-cards";function di(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function hi(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function mi(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),i=e[2]||"";return[s,i]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function pi(t){return void 0===t||t instanceof fi?t:new fi(t)}class fi{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=pi(t),pi([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class gi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,y((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),i=e.itemCount,n=e.itemCount=s?s.length:void 0;n!==i&&(void 0===n?e.itemIndex=void 0:void 0===i&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(di(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let i=0;for(const e of s.children)hi(e,"active",i===t),i++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const bi="miso-ui-icon",yi=bi+"-svg-1_12_3-beta_6",wi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},vi=`<symbol id="${bi}-${wi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ki=`<symbol id="${bi}-${wi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,Ei=`<symbol id="${bi}-${wi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,Ci=`<svg id="${yi}" style="display:none;">${[vi,ki,Ei,`<symbol id="${bi}-${wi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${bi}-${wi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${bi}-${wi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${bi}-${wi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let Si=!1;function xi(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${bi}-${t}"></use></svg>`}Si||document.head.querySelector("#"+yi)||(Si=!0,document.head.insertAdjacentHTML("beforeend",Ci));const Oi=new Set(Object.values(wi));xi(wi.SEND),xi(wi.SEARCH);const Ii=xi(wi.TRIANGLE);xi(wi.TRIANGLE_EQ);const Ti=xi(wi.CHEVRON),Ai=xi(wi.CHEVRON_NEGATIVE),Ri=xi(wi.BULB),Ni="miso-carousel",qi=Object.freeze({body:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${n.list(t,e,s)}</div></div>${n.controls(t,e,s)}`},controls:function(t,e,s){const{templates:i}=t;return`${i.controlContainer(t,e,"previous")}${i.controlContainer(t,e,"next")}${i.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-container-${s}">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?Ai:Ti},indexIndicator:function(t,e,s){const{className:i,templates:n}=t;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${i}__index-indicator-item">${n.indexIndicatorItem(t,e,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Li=Object.freeze({...ri.defaultTemplates,...qi});class Pi extends ri{static get type(){return"carousel"}static get defaultTemplates(){return Li}static get defaultClassName(){return Ni}constructor({className:t=Ni,templates:e,...s}={}){super({className:t,templates:{...qi,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){U(t,gi.prototype)}(Pi.prototype);const $i="16rem",Ui=Object.freeze({...ri.defaultTemplates,item:function(t,e,s,i){const{className:n,templates:o,options:r}=t,{itemType:a}=r,c=o[a](t,e,s,{index:i});return`<li class="${n}__item${s._size?` ${n}__item-${s._size}`:""}">${c}</li>`}}),ji="miso-gallery";class Mi extends ri{static get type(){return"gallery"}static get defaultTemplates(){return Ui}static get defaultClassName(){return ji}constructor({className:t=ji,templates:e,...s}={}){super({className:t,templates:{...Ui,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=s?void 0:this._bodyHtml(t),n=this._itemsHtml(t,e);return{...t,...a({incremental:s,bodyHtml:i,itemsHtml:n})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const i=this._renderListElement(t,e,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:i}=e;return s||(t.innerHTML=i),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,i)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const i=t.children.length,n=this._writeItemSizes((this._getItems(e)||[]).slice(i),s,i);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,n,{offset:i}))}_writeItemSizes(t,[e=0,s=0]=[],i=0){let n=0;i>0&&(n=Math.min(i,e),i-=n,e-=n),i>0&&(n=Math.min(i,s),i-=n,s-=n);const o=[];for(const i of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),o.push({...i,_size:t})}return o}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=pi(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:i}=e,{height:n=$i}=this.options,o=mi(n),r=t.clientWidth;if(0===r)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(r*i.width*2/(o*i.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),i=t;const n=Math.min(Math.floor(s/3),i);i-=n,s-=3*n;const o=Math.min(s,i);return i-=o,s-=o,[n,o,i]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,i=0]=e;const{className:n}=this;for(const e of t.children){let t=!1,o=!1;s>0?(t=!0,s--):i>0&&(o=!0,i--),hi(e,n+"__item-large",t),hi(e,n+"__item-medium",o),hi(e,n+"__item-small",!t&&!o)}}}const Di="miso-search-box";const zi=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:n,autocomplete:o}=t,{placeholder:r}=n;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${o.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=e;var o;return("function"==typeof i?i(t):""+i)+("function"==typeof n?n(t):(Oi.has(o=n)?xi(o):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:n}=t;t={templates:s,workflow:i,...n};const o=[],r=[];for(const t of e)(t.product?o:r).push(t);return s.queries(t,r)+(r.length>0&&o.length>0?"<hr>":"")+s.products(t,o)},completionList:function(t,e,s){const{className:i,templates:n}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map((s=>n.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:n}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${n[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||v(e)},product:function(t,{product:e}){const{templates:s}=t,[i,n]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+n},imageBlock:js,productInfoBlock:xs}),Fi=Object.freeze({className:"miso-autocomplete",debounce:300});class Bi extends Vs{static get type(){return"search-box"}static get defaultTemplates(){return zi}static get defaultClassName(){return Di}constructor({className:t=Di,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...zi,...e},...i}),u(this,{autocomplete:{...Fi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=L(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:n=_e.INITIAL,session:o,value:r}=e.completions,{index:a}=o;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);hi(t,"nonempty",u.length>0),l.setAttribute("data-status",n),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:n}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Qi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Qi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&g(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),n=this._context().data.get(parseInt(e)),o=n&&n.text;return o&&(s&&(s.value=o),this._view._events.emit("select",Object.freeze({value:n,index:e,domEvent:t})),t.defaultPrevented||this._submit(o)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[re.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Qi{static empty(){return Qi._empty||(Qi._empty=new Qi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const n in t)for(const o of t[n])o.product&&!o.product.url||(o._index=e,o._field=n,s.set(e,o),i.push(o),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Hi="miso-option-list";const Gi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${v(e.text||e)}</li>`}});class Vi extends Vs{static get type(){return"option-list"}static get defaultTemplates(){return Gi}static get defaultClassName(){return Hi}constructor({className:t=Hi,templates:e,...s}={}){super({className:t,templates:{...Gi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;hi(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._select(i.text))}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}si(Vi.prototype);const Wi=Object.freeze({...Es("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Yi extends Vs{static get defaultTemplates(){return Wi}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...Wi,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=g(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],y((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Ki="miso-feedback",Zi=["helpful","unhelpful"];const Ji=Object.freeze({options:function(t){const{templates:e}=t;return Zi.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Xi extends Yi{static get type(){return"feedback"}static get defaultTemplates(){return Ji}static get defaultClassName(){return Ki}constructor({className:t=Ki,templates:e,...s}={}){if(super({className:t,templates:{...Ji,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const tn="miso-text";const en=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:n=!1,tag:o}}=t,r=i?`data-role="${i}"`:"",a=void 0!==e?v(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[n,o]=e;switch(n){case"date":return t=>s(t,o);case"number":return t=>i(t,o);default:return t=>""+t}}(t)(e)):"";return n?a:`<${o} class="${s}" ${r}>${a}</${o}>`}});class sn extends Vs{static get type(){return"text"}static get defaultTemplates(){return en}static get defaultClassName(){return tn}constructor({className:t=tn,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...en,...e},tag:s,...i})}}class nn extends ks{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=S(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class on{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:o}){const r=i.length;n=Math.min(n,r);const a=!!o&&n===r,c=e.substring(0,s),l=!i.startsWith(c);return a||l?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function rn(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:o=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,an(e)];o&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${r} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||_e.INITIAL),i}function an(t){return t+"__cursor"}function cn(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:n,operation:o,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${ln(i[0])}, ${ln(i[1])})`,e,""+o,n,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function ln(t){return Math.floor(100*t)/100+"ms"}const un="miso-typewriter";class _n extends nn{static get type(){return"typewriter"}static get defaultClassName(){return un}constructor({className:t=un,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:o,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:i,...a}),u(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:z({speed:n,acceleration:o}),this._readiness=new O,"markdown"===s&&_n.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=an(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:cn(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new on}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:{value:s="",stage:i,finished:n}={},session:o,status:r}=t,c=(u=t,(l=e)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const _=e?c&&i===e.stage?e.streak:e.streak+1:0,d=c&&e&&e.doneAt||(r===_e.READY&&n?performance.now():void 0);return this._prevState=Object.freeze(a({session:o,status:r,value:s,stage:i,streak:_,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:o}){const r=rn(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}n(a);const l=e.status===_e.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===_e.READY)&&!c}),l&&o()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const i=e.closest('[data-role="follow-up-link"]');if(i){let{q:e}=i.dataset;return e=e?e.trim():void 0,void(e&&this._view._events.emit("follow-up-click",{event:t,q:e}))}const n=e.closest("a");if(n){if(!t.defaultPrevented){const{href:e,innerText:s,className:i}=n;e&&this._view._events.emit("link-click",a({event:t,url:e,text:s?s.trim():"",className:i||"",attributes:dn(n)}))}}else;}}function dn(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const hn="miso-affiliation";const mn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n,options:o}=t,{status:r}=e,a=i?` data-role="${i}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),_=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${o.itemType?` data-item-type="${o.itemType}"`:""}${void 0!==_?` data-item-count="${_}"`:""}>${r===_e.READY?n[r](t,e):""}</div>`},[_e.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}-container">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Ii},body:function(t,e){const{className:s,templates:i}=t,n=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,n)}</div>`},item:function(t,e,s,i){const{className:n,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${n}__item"><div class="${n}__item-inner">${o.itemHeader(t,e,s,{index:i})}${o[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:n,templates:o}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=o;return r=Gs.asFunction(r)(t,e,s,i),a=Gs.asFunction(a)(t,e,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${r}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:n}=t,[o,r]=zs(t,s,{link:!1});return""+o+(n.infoBlock||n.affiliationInfoBlock||Ss)(t,s,i)+(n.imageBlock||js)(t,s,{brand:!0,...i})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:n,templates:o}=t,r=Gs.asFunction(o.logoText)(t,e,s,i)||"",a=Gs.asFunction(o.logoImg)(t,e,s,i);return a?`<span class="${n}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:n,templates:o}=t,r=Gs.asFunction(o.logoUrl)(t,e,s,i);if(!r)return"";const a=Gs.asFunction(o.logoAltText)(t,e,s,i);return`<img class="${n}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),pn=Object.freeze({...ri.defaultTemplates,...mn});class fn extends ri{static get type(){return"affiliation"}static get defaultTemplates(){return pn}static get defaultClassName(){return hn}constructor({className:t=hn,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...mn,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Z(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,y((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(di(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const gn="miso-facets",bn="miso-facet",yn="custom_attributes.";const wn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map((n=>s.facet(t,{field:n,entries:i[n]},e)))},facet:function(t,e,s){const{facetClassName:i=bn,templates:n}=t,{field:o}=e;return`<div class="${i}" data-role="facet" data-field="${v(o)}">${n.header(t,e,s)}${n.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=bn,templates:n}=t;return`<div class="${i}__header">${n.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(yn)&&(e=e.substring(18)),v(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:n=bn,templates:o}=t;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>o.option(t,{field:e,value:s,count:n},i))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=bn,templates:n}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(t,e,s)}</span>\n  <span class="${i}__count">${n.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return v(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function vn(t,e){return`${t}:::${e}`}function kn(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class En extends Vs{static get type(){return"facets"}static get defaultTemplates(){return wn}static get defaultClassName(){return gn}constructor({className:t=gn,templates:e,...s}={}){super({className:t,templates:{...wn,...e},...s}),this._bindings=new ei}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=kn(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=kn(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],n=[],o=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),r=s[t];if(!r)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=r[e];if(!c)break;i.push(vn(t,c)),n.push({field:t,value:c}),o.push(s)}}this._bindings.update(i,n,o)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[v(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:n,value:o}=i;this._view.filters.facets.toggle(n,o),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Cn="miso-select";const Sn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,o=i?`data-role="${i}"`:"",r=t._getItems(e),a=r.find((t=>t.selected))||r[0];return`\n<div class="${s}" ${o}>\n  ${n.button(t,a)}\n  ${n.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>i.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return v(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,((t,e)=>" "+e))||e||"")}});class xn extends Vs{static get type(){return"select"}static get defaultTemplates(){return Sn}static get defaultClassName(){return Cn}constructor({className:t=Cn,templates:e,...s}={}){super({className:t,templates:{...Sn,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}si(xn.prototype);const On="miso-more-button";const In=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==_e.READY?" disabled":""}>\n  ${n.text(t)}\n</div>\n`},text:function(t){return"More"}});class Tn extends Vs{static get type(){return"more-button"}static get defaultTemplates(){return In}static get defaultClassName(){return On}constructor({className:t=On,templates:e,...s}={}){super({className:t,templates:{...In,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var An=Object.freeze({__proto__:null,TemplateBasedLayout:Vs,ContainerLayout:Ks,ErrorLayout:Js,BannerLayout:class extends Vs{static get type(){return"banner"}static get defaultTemplates(){return Xs}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Xs,...e},...s})}},CollectionLayout:ri,ListLayout:ci,HorizontalLayout:ui,CardsLayout:class extends ri{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return _i}constructor({className:t=_i,...e}={}){super({className:t,...e})}},CarouselLayout:Pi,GalleryLayout:Mi,SearchBoxLayout:Bi,OptionListLayout:Vi,FeedbackLayout:Xi,TextLayout:sn,TypewriterLayout:_n,AffiliationLayout:fn,FacetsLayout:En,SelectLayout:xn,MoreButtonLayout:Tn});function Rn(t){return t&&t.value&&t.value.revision}function Nn(t){const e=function(t){if(!t)return _e.INITIAL;const{request:e,error:s,value:i}=t;return s?_e.ERRONEOUS:i?_e.READY:e?_e.LOADING:_e.INITIAL}(t);return a({status:e,ongoing:e===_e.READY?t.ongoing:void 0,...t})}function qn(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:i}=s;i&&(e.meta.miso_id=i)}function Ln(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:n}=i||{};return n?{...t,value:{...s,keywords:n}}:t}function Pn(t){const{role:e,type:s,items:i}=t,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:a({property:e})}};switch(function(t){return le.has(t)}(s)&&(!function(t,e=[]){return function(t){return oe.has(t)}(t)||e.length>0&&"object"==typeof e[0]&&e[0].product_id}(e,i)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map((t=>t.text||t.id||t))):n.product_ids=(i||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case re.SUBMIT:n.context.custom_context.value=t.value;break;case re.FEEDBACK:n.context.custom_context.value=n.value=t.value,n.context.custom_context.result_type=n.result_type=t.result_type}return a(n)}const $n=Object.freeze({}),Un=Object.freeze({[se.CONTAINER]:Ks.type,[se.ERROR]:Js.type}),jn=Object.freeze({}),Mn=Object.freeze({api:$n,layouts:Un,trackers:jn}),Dn=Object.freeze({mappings:{[se.ERROR]:t=>t.error}});class zn extends Y{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:n,options:o}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=o||new qe(e&&e._options,n),this._hub=new Fe({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({roles:t}){const e=this._hub,s=this._client,i=this._options,n=this._extensions,o=this._plugin.layouts;this._sessions=new Be(e),this._data=new He(e,{source:vs(s),options:i}),this._views=new fs(e,{extensions:n,layouts:o,roles:t,options:i,workflow:this}),this._interactions=new ws(e,{client:s,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("session",(t=>this._onSession(t))),this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(ze(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:i}){i||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[ze(t)]||{};e.session&&e.status===_e.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onSession(t){this.updateData({session:t})}_onMainViewUpdate(t){const{status:e}=t,s=e===_e.READY,i=e===_e.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(t);return i.add(t),!n}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=we(this._options.resolved.api,t);this.updateData({session:e,request:s}),this._hub.update("request",{...s,session:e})}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Rn(t);if(!c(s)){const t=Rn(this._hub.states.data);if(!c(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){const e=this._hub.states.data;t=this._defaultProcessData(t,e);for(const s of this._options.resolved.dataProcessor)t=s(t,e);this._updateDataInHub(t,e)}_defaultProcessData(t,e){return t=function(t,e){if(!t||!t.value||t.request||!e||!e.request)return t;const{request:s}=e;return{...t,request:s}}(t,e),t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=Nn(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:_e.READY,session:this.session,...e},this._hub.update(ze(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction({...t,data:this._hub.states.data});this._sendInteraction(e)}_buildInteraction(t){let e=Pn(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=function(t,e){const{data:s}=e;if(!s)return t;const i=s.request&&s.request.payload&&s.request.payload.metadata;return i?D(t,{context:{custom_context:i}}):t}(t,e),t=this._writeApiInfoToInteraction(t,e),t=this._writeRequestInfoToInteraction(t,e),t=function(t,e){if(e.role!==se.AFFILIATION)return t;const{items:s}=e;return D(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return D(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeRequestInfoToInteraction(t,e){return t}_writeMisoIdToInteraction(t,e){const s=this._hub.states[ze(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?D(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function Fn(t){if(t.affiliation_products){const{affiliation_products:e,...s}=t;t={...s,affiliation:Bn(e)}}else if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Qn(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map((t=>({...t})));let n=0;for(const t of i)s&&(t.channel=s),t.position=n++;return{...t,affiliation:{...e,products:i}}}(t)}function Bn(t){return{channel:"miso",products:t}}function Qn({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Hn)}}function Hn({id:t,deeplink:e,headline:s,description:i,currency:n,retailPrice:o,salePrice:r,discountRate:c,image:l,thumbnail:u,merchant:_,...d}){return a({id:"sovrn-"+t,title:s,description:i,cover_image:l,url:e,currency:n,original_price:o,sale_price:r,discount_rate_percent:c,brand:_&&_.name,brand_logo:_&&_.logo,custom_attributes:Gn({sovrn_id:t,thumbnail:u,merchant:_,...d})})}function Gn(t,e=""){return Object.keys(t).reduce(((s,i)=>{const n=t[i];if(void 0===n)return s;const o=e?`${e}_${i}`:i;return"object"==typeof n?{...s,...Gn(n,o)}:{...s,[o]:n}}),{})}function Vn(t){U(t,Wn.prototype)}Ue(zn.prototype),Object.assign(zn,{DEFAULT_API_OPTIONS:$n,DEFAULT_LAYOUTS:Un,DEFAULT_TRACKERS:jn,DEFAULT_OPTIONS:Mn,ROLES_OPTIONS:Dn});class Wn{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Yn=Object.freeze({...zn.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...zn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Kn=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),Zn=Object.freeze({...zn.DEFAULT_LAYOUTS,[se.QUERY]:[Bi.type,{placeholder:"Ask a question"}],[se.QUESTION]:[sn.type,{tag:"h2"}],[se.ANSWER]:_n.type,[se.FEEDBACK]:Xi.type,[se.IMAGES]:[Mi.type,{incremental:!0,itemType:"image"}],[se.SOURCES]:[ci.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[se.AFFILIATION]:[fn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Jn=Object.freeze({...zn.DEFAULT_TRACKERS,[se.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Se.click},[se.IMAGES]:Se,[se.SOURCES]:Se,[se.AFFILIATION]:Se,[se.PRODUCTS]:Se}),Xn=Object.freeze({...zn.DEFAULT_OPTIONS,api:Yn,autocomplete:Kn,layouts:Zn,trackers:Jn}),to=fe(zn.ROLES_OPTIONS,{main:se.ANSWER,members:Object.keys(Zn),mappings:{[se.ANSWER]:function(t){if(!t||!t.value)return;const{answer:e="",answer_stage:s,finished:i}=t.value;return Object.freeze({value:e,stage:s,finished:!!i})},[se.REASONING]:function(t){if(!t||!t.value)return;const{reasoning:e="",reasoning_finished:s}=t.value;return Object.freeze({value:e,stage:"reasoning",finished:!!s})}}});class eo extends zn{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new ys(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(se.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(se.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[ze(this._roles.main)]||{};t.session&&t.status!==_e.INITIAL&&(t.status!==_e.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===_e.READY&&!t.ongoing,n=e===_e.ERRONEOUS,o=i?"done":n?"error":e,r=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(o,t),(i||n)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){Me.call(this,t)}query(t){if(!t.q&&!t.questionId)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||de.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t,e){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Fn(e)}}(t=super._defaultProcessData(t,e)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_updateUrlIfNecessary({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,n=t&&t.question||e&&e.payload&&e.payload.question,o=e&&e.payload&&e.payload.metadata&&e.payload.metadata.question_source;if(!n)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(i)||de.ORGANIC;n===a&&o===c||(r.searchParams.set(s,n),o===de.ORGANIC?r.searchParams.delete(i):r.searchParams.set(i,o),window.history.replaceState({},"",r))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=function(t,{event_target:e}={}){return e?D(t,{context:{custom_context:{event_target:e}}}):t}(t=this._writeAnswerClickInteraction(t,e),e)}_writeRequestInfoToInteraction(t,e){const{data:s}=e;if(!s)return t;const i=s.request&&s.request.payload;if(!i)return t;const{question:n,fq:o}=i;return D(t,{context:{custom_context:{question:n,fq:o}}})}_writeAskPropertiesToInteraction(t={},e){return D(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==se.ANSWER)return t;const{items:s=[]}=e;return D(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[ze(t.role)]||{},{payload:s}=e||{};return s&&s.metadata&&s.metadata.question_source||void 0}_onCitationClick({index:t,event:e}){if(0!==e.button)return;if(ds(e))return;const{value:s}=this._hub.states.data||{},{sources:i}=s||{},n=i&&i[t-1];n&&n.product_id&&(hs(e),this._views.trackers.sources.click([n.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){0===t.button&&(ds(t)||(hs(t),this._views.trackers.answer.click([],{items:[e]})))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Vn(eo.prototype),Object.assign(eo,{DEFAULT_API_OPTIONS:Yn,DEFAULT_AUTOCOMPLETE_OPTIONS:Kn,DEFAULT_LAYOUTS:Zn,DEFAULT_TRACKERS:Jn,DEFAULT_OPTIONS:Xn,ROLES_OPTIONS:to});var so=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var io=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class no{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class oo{constructor(t){this._context=t,u(this,{lowerCamelToKebab:h,kebabToLowerCamel:_,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=d(t))||"querySuggestions"===t?"followUpQuestions":t}phrase(t,{name:e,extraNames:s=[],tag:i="div",inline:n=!1}){const{classPrefix:o}=t;return`<${i} class="${n?o+"__phrase-inline":o+"__phrase"} ${[e,...s].map((t=>`${o}__${t}-phrase`)).join(" ")}">${this.phraseText(t,_(e))}</${i}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,extraNames:n=[],visibleWhen:o,trait:r,logo:a=!1},c){const l=[i,...n].map((e=>`${t}__${e}-container`));return e&&l.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:l,visibleWhen:o,trait:r,logo:a,parentQuestionId:s},c)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${h(t)}="${i}"`)}return s}}const ro=j(new oo({...so,DEFAULT_PHRASES:io})),ao=j(new class extends no{constructor(){super({helpers:ro})}answerGroup(t){const{container:e}=this._helpers;return[this.question(t),this.reasoning(t),this.answer(t),this.affiliation(t),this.sources(t),this.followUpQuestions(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"question",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",s(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(t={}){const{phrases:e,reasoning:s={}}=t,{container:i,element:n,phraseText:o}=this._helpers,r=[];return s.expand&&r.push("expanded"),i(t,{name:"reasoning",visibleWhen:"nonempty"},[n("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[n("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||Ri}</div>`,`<div class="miso-collapsible__title" data-role="title">${o(e,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ti}</div>`]),n("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(t){const{container:e,phrase:s}=this._helpers,i="follow-up-questions",n=["query-suggestions"];return e(t,{name:i,extraNames:n,visibleWhen:"nonempty"},[s(t,{name:i,extraNames:n,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(t){const{features:e={}}=t;return!1===e.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:n={},logo:o=!0}=t;return i(t,{name:"related-resources"},!1===n.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:o},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:ro}));function co(t={}){const{normalizeOptions:e,section:s,container:i}=ro,{answerGroup:n}=ao;return s(t=e(t),{name:"follow-up"},[i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...n(t)])}var lo=Object.freeze({__proto__:null,helpers:ro,sections:ao,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=ro,{followUps:n,relatedResourcesSection:o,answerGroup:r}=ao;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},r(t))+n(t)+o(t)},followUp:co});const uo=Object.freeze({...eo.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...eo.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),_o=Object.freeze({...eo.DEFAULT_LAYOUTS,[se.QUERY]:[Bi.type,{templates:{buttonIcon:"send"}}],[se.REASONING]:_n.type,[se.RELATED_RESOURCES]:[ci.type,{incremental:!0,itemType:"article"}],[se.QUERY_SUGGESTIONS]:Vi.type,[se.FOLLOW_UP_QUESTIONS]:Vi.type}),ho=Object.freeze({...eo.DEFAULT_TRACKERS,[se.RELATED_RESOURCES]:Se,[se.QUERY_SUGGESTIONS]:{...Se,click:{...Se.click,validate:t=>0===t.button}}}),mo=Object.freeze({followUp:co}),po=Object.freeze({...eo.DEFAULT_OPTIONS,api:uo,layouts:_o,trackers:ho,templates:mo}),fo=fe(eo.ROLES_OPTIONS,{members:Object.keys(_o),mappings:{[se.QUERY_SUGGESTIONS]:function(t,{workflow:e}={}){const s=e.previous,i=s&&s.states.data.value,n=i&&(i.suggested_followup_questions||i.followup_questions||[]);return n&&n.map((t=>({text:t})))},[se.FOLLOW_UP_QUESTIONS]:function(t){if(t&&t.value)return(t.value.followup_questions||[]).map((t=>({text:t})))}}});class go extends eo{constructor(t,e){super({name:"ask",context:t,roles:fo,defaults:po,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;u(this,{parentQuestionId:e})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on(ze(se.REASONING),(t=>this._onReasoningViewUpdate(t))),this._views.get(se.ANSWER).on("follow-up-click",(t=>this._onFollowUpClick(t))),this._views.get(se.FOLLOW_UP_QUESTIONS).on("select",(t=>this._onFollowUpQuestionSelect(t))),this._views.get(se.QUERY_SUGGESTIONS).on("select",(t=>this._onQuerySuggestionSelect(t)))]}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){const{next:t}=this;t&&t.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,questionId:s,...i}={}){if(s)return a({...i,question_id:s});const{parentQuestionId:n}=this;let o=a({...i,question:t,parent_question_id:n,metadata:{...i.metadata,question_source:e||de.ORGANIC}});return o=this._writeWikiLinkTemplateToPayload(o),o}_updateData(t){super._updateData(t),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:t}=this;if(!t)return;const e=t._views.get(se.QUERY_SUGGESTIONS);e&&e.refresh()}_onReasoningViewUpdate({status:t,ongoing:e}){if(t!==_e.READY||e)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,n,o,{property:r}=t.context&&t.context.custom_context||{};return e.role!==se.FOLLOW_UP_QUESTIONS&&e.role!==se.QUERY_SUGGESTIONS||(r="suggested_followup_questions"),e.role===se.QUERY_SUGGESTIONS?(n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,o=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,o=this._getQuestionSourceFromViewState(e)),D(t,{context:{custom_context:{property:r,root_question_id:s,parent_question_id:n,question_id:i,question_source:o}}})}_onFollowUpClick({q:t,event:e}={}){0===e.button&&this._submitFollowUpQuestion({q:t,qs:de.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:t}){this._submitFollowUpQuestion({q:t,qs:de.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:t="",qs:e}={}){if(!(t=t.trim()))return;this.getOrCreateNext().query({q:t,qs:e})}_onQuerySuggestionSelect({value:t}){t&&this.query({q:t,qs:de.SUGGESTED_QUESTIONS})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const t=this._views.get(se.REASONING),e=t&&t.element;return e&&e.closest('[data-role="reasoning-box"]')}_destroy(t){const{next:e,parentQuestionId:s,questionId:i}=this;e&&e.destroy(t),s&&this._context._byPqid.delete(s),i&&this._context._byQid.delete(i),super._destroy(t)}}const bo={event:"done"};class yo extends De{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new go(this),this._events.on("*",(t=>this._createNextIfNecessary(t))),this._autoNextFn=void 0}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new go(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}autoNext(t){this._autoNextFn=function(t=bo){switch(!0===t&&(t=bo),"string"==typeof t&&(t={event:t}),typeof t){case"object":return e=>t.event===e._event;case"function":return t;default:return()=>!1}}(t)}_createNextIfNecessary(t){if(!this._autoNextFn||!this._autoNextFn(t))return;const{workflow:e}=t;e&&e.getOrCreateNext()}}Ue(yo.prototype,[me.TEMPLATES]);const wo=Object.freeze({...zn.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...zn.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),vo=Object.freeze({...zn.DEFAULT_LAYOUTS,[se.QUERY]:[Bi.type],[se.PRODUCTS]:[ci.type,{incremental:!0,infiniteScroll:!0}],[se.KEYWORDS]:[sn.type,{raw:!0}],[se.TOTAL]:[sn.type,{raw:!0,format:"number"}],[se.FACETS]:[En.type],[se.SORT]:[xn.type],[se.MORE]:[Tn.type]}),ko=Object.freeze({...zn.DEFAULT_TRACKERS,[se.PRODUCTS]:Se}),Eo=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Co=Object.freeze({...zn.DEFAULT_OPTIONS,api:wo,layouts:vo,trackers:ko,pagination:Eo}),So=fe(zn.ROLES_OPTIONS,{main:se.PRODUCTS,members:Object.keys(vo),mappings:{[se.FACETS]:"facet_counts",[se.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=e.states.filters||{},o=n&&n.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return o?i.map((t=>({...t,selected:t.field===o}))):i}}});class xo extends zn{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(se.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){Me.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._views.filters.reset({silent:!0}),this.restart();const e=pe.QUERY,s=this._buildPayload(t,e);this._request({payload:s,type:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=pe.REFINE,s=this._getQuery(),i=this._buildPayload(s,e);this._request({payload:i,type:e})}_more(){if(this.status!==_e.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=pe.MORE,e=this._getQuery(),s=this._buildPayload(e,t);this._request({payload:s,type:t})}_getQuery(){return this._hub.states.query}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t,e){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),e===pe.MORE&&(t=this._processPayloadForMoreRequest(t)),t}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return a({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return r(t)}_writePageInfoToPayload(t){return{...t,metadata:{...t.metadata,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map((t=>t.product_id)).filter((t=>t)),n=[...t.exclude||[],...i];return 0===n.length?t:{...t,exclude:n}}_defaultProcessData(t,e){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case _e.INITIAL:case _e.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=Ln(t=super._defaultProcessData(t,e)),this._currentFacetCounts),t=function(t,{role:e=se.PRODUCTS}={}){const{status:s,request:i,value:n}=t;if(s!==_e.READY||!i||!n)return t;const{[e]:o}=n;if(!o)return t;const{rows:r}=i.payload,{length:a}=o;return r>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{metadata:s}=e.payload;if(!s||!s.page)return function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,value:{...e,root_miso_id:s}}:t}(t);return function(t,e,{role:s=se.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:n,total:o,root_miso_id:r}=t.value,{[s]:a=[]}=e.value;return{...e,value:{...e.value,facet_counts:n,total:o,root_miso_id:r,[s]:[...i,...a]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeRootMisoIdToInteraction(t)}_writeRequestInfoToInteraction(t,e){const{data:s}=e;if(!s)return t;const i=s.request&&s.request.payload;if(!i)return t;const{q:n,fq:o}=i;return D(t,{context:{custom_context:{q:n,fq:o}}})}_writeRootMisoIdToInteraction(t){const e=this._hub.states.data,{root_miso_id:s}=e&&e.value||{};return s?D(t,{context:{custom_context:{root_miso_id:s}}}):t}}Ue(xo.prototype,[me.PAGINATION,me.FILTERS]),Object.assign(xo,{DEFAULT_API_OPTIONS:wo,DEFAULT_LAYOUTS:vo,DEFAULT_TRACKERS:ko,DEFAULT_PAGINATION:Eo,DEFAULT_OPTIONS:Co,ROLES_OPTIONS:So});const Oo=Object.freeze({members:[]});function Io({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function To(t){return t&&t.value&&t.value.trim()||void 0}class Ao extends zn{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:Io(e),roles:Oo,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,To(t)===To(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!To(t))return void this._updateCompletions({session:s,status:_e.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:To(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function Ro(t){U(t,No.prototype)}class No{_initAutocomplete(t){this._autocomplete=new Ao(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const qo=fe(eo.ROLES_OPTIONS,{mappings:{[se.QUESTION]:se.KEYWORDS}});class Lo extends eo{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:qo,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset({silent:!0}),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._writeWikiLinkTemplateToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return M(e,{metadata:{question_source:t||de.ORGANIC}})}_defaultProcessData(t,e){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:i}={}}=e;return i?{...t,meta:{...t.meta,miso_id:i}}:t}(t=Ln(t=super._defaultProcessData(t,e))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_updateDataInHub(t){switch(t.status){case _e.INITIAL:case _e.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),qn(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}Ro(Lo.prototype);const Po={...xo.ROLES_OPTIONS,members:[se.PRODUCTS,se.KEYWORDS,se.TOTAL,se.FACETS,se.SORT,se.MORE,se.ERROR]};class $o extends xo{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Po,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t,e){return t=super._buildPayload(t,e),t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=function(t,e){return e===pe.QUERY?t:{...t,answer:!1}}(t=this._writeQuestionIdToPayload(t),e),t}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return M(t,{metadata:{question_id:this._superworkflow._answer.questionId}})}_defaultProcessData(t,e){return qn(t=super._defaultProcessData(t,e)),t}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}}Object.assign($o,{ROLES_OPTIONS:Po});class Uo{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return $o.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const jo=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...eo.DEFAULT_API_OPTIONS.payload,...xo.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Mo=Object.freeze({...eo.DEFAULT_LAYOUTS,...xo.DEFAULT_LAYOUTS,[se.QUERY]:[Bi.type,{placeholder:""}],[se.QUESTION]:[sn.type,{raw:!0}],[se.SOURCES]:[ui.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:Cs,articleInfoBlock:Is}}]}),Do=Object.freeze({...eo.DEFAULT_TRACKERS,...xo.DEFAULT_TRACKERS}),zo=Object.freeze({...xo.DEFAULT_PAGINATION,active:!0}),Fo=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Bo=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Qo=Object.freeze({...eo.DEFAULT_OPTIONS,...xo.DEFAULT_OPTIONS,api:jo,layouts:Mo,trackers:Do,autocomplete:Fo,pagination:zo,filters:Bo}),Ho=Object.freeze({main:se.PRODUCTS,members:Object.keys(Mo),mappings:Object.freeze({...eo.ROLES_OPTIONS.mappings,...xo.ROLES_OPTIONS.mappings})});class Go extends zn{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Ho,defaults:Qo})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Lo(this),this._results=new $o(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){this._views=new Uo(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return t=this._answer._defaultProcessInteraction0(t,e),t=this._results._defaultProcessInteraction0(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Ue(Go.prototype,[me.PAGINATION,me.FILTERS]);const Vo=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),Wo=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Yo=Object.freeze({...xo.DEFAULT_LAYOUTS}),Ko=Object.freeze({...xo.DEFAULT_TRACKERS}),Zo=Object.freeze({...xo.DEFAULT_OPTIONS,api:Vo,autocomplete:Wo,layouts:Yo,trackers:Ko}),Jo=xo.ROLES_OPTIONS;class Xo extends xo{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Jo,defaults:Zo})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=se.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}Ro(Xo.prototype);class tr extends De{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=ee){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=ee){return this._members.has(t)}get(t=ee){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class er extends zn{_initProperties(t){super._initProperties(t);const{id:e}=t;u(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return D(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(er,{DEFAULT_API_OPTIONS:zn.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:zn.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:zn.DEFAULT_TRACKERS,DEFAULT_OPTIONS:zn.DEFAULT_OPTIONS,ROLES_OPTIONS:zn.ROLES_OPTIONS});const sr=Object.freeze({...er.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...er.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),ir=Object.freeze({...er.DEFAULT_LAYOUTS,[se.PRODUCTS]:ci.type}),nr=Object.freeze({...er.DEFAULT_TRACKERS,[se.PRODUCTS]:Se}),or=Object.freeze({...er.DEFAULT_OPTIONS,api:sr,layouts:ir,trackers:nr}),rr=fe(er.ROLES_OPTIONS,{main:se.PRODUCTS,members:Object.keys(ir)});class ar extends er{constructor(t,e){super({name:"recommendation",context:t,roles:rr,defaults:or,id:e})}start(){return this._request(),this}notifyViewUpdate(t=se.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class cr extends tr{constructor(t,e){super("recommendations",t,e)}_create(t){return new ar(this,t)}}const lr=Object.freeze({...er.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),ur=Object.freeze({...er.DEFAULT_LAYOUTS,[se.RELATED_QUESTIONS]:[ci.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[se.QUERY]:[Bi.type,{placeholder:"Ask a question"}]}),_r=Object.freeze({...er.DEFAULT_TRACKERS,[se.RELATED_QUESTIONS]:Se,[se.CONTAINER]:{...Se,itemless:!0},[se.QUERY]:{[re.SUBMIT]:{active:!0}}}),dr=Object.freeze({...er.DEFAULT_OPTIONS,api:lr,layouts:ur,trackers:_r}),hr=fe(er.ROLES_OPTIONS,{main:se.RELATED_QUESTIONS,members:Object.keys(ur)});class mr extends er{constructor(t,e){super({name:"explore",context:t,roles:hr,defaults:dr,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(se.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Wn.prototype.useLink.call(this,t,e),e&&this.useLayouts({[se.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=se.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t,e){return t=super._defaultProcessData(t,e),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Wn.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Vn(mr.prototype);class pr extends tr{constructor(t,e){super("explores",t,e)}_create(t){return new mr(this,t)}}class fr extends Y{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new O)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const gr=Object.freeze(so),br=Object.freeze(io),yr=Object.freeze(lo);var wr=Object.freeze({__proto__:null,constants:gr,phrases:br,templates:yr,wireFollowUps:function(t,e,s){if(!t)throw Error("client is required");!function(t,{template:e=co,...s}={}){if("function"!=typeof e)throw Error("template must be a function or undefined");const i=Object.keys(s).length>0;if(e===co&&!i)return;t.ui.asks.useTemplates({followUp:i?t=>e({...s,...t}):e})}(t,s),function(t){if(!t||"miso-follow-ups"===t.tagName.toLowerCase())return;const e=document.createElement("miso-follow-ups");for(const{name:s,value:i}of t.attributes)e.setAttribute(s,i);t.parentNode.replaceChild(e,t)}(e)},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:vr}=document,kr=Object.freeze({templates:yr,autostart:!0}),Er=["templates","phrases","features"];class Cr{constructor(){this._defaults=kr,this._scriptSrc=function(){if(!vr||!vr.src)return{};const t=document.createElement("a");t.href=vr.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Or(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Or(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return a({apiKey:t,apiHost:e,templates:Ir(s),phrases:i,...n})}(Sr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Sr(...t){let e={};for(const s of t)s&&(e=xr(e,s));return e}function xr(t,e){if(!e)return t;Object.assign(t,e);for(const s of Er)s in e&&(t[s]={...t[s],...e[s]});return t}function Or(t){return""===t||"false"!==t&&t}function Ir(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Ir):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,Ir);default:throw Error("Unsupported template type: "+t)}}class Tr{constructor(t,{classPrefix:e=gr.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");u(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Ar extends fr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Cr,this._localOptions={}}config(t={}){t=Sr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;u(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Tr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:o}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=i,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(e,s.followUpsSection,{...i,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&o(e,s.relatedResourcesSection),l.autoQuery()}}class Rr extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}const Nr="trait",qr=Object.freeze([Nr]);class Lr extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return qr}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const t of this._traits)this._destroyTrait(t);this._traits=[]}attributeChangedCallback(t){if(t===Nr)this._syncTraits()}_syncTraits(){const t=(this.getAttribute(Nr)||"").split(/\s+/).filter(Boolean),e=[];for(const s of this._traits)t.includes(s.constructor.traitName)?e.push(s):this._destroyTrait(s);if(t.length>0){const s=function(t){const e=t.ui&&t.ui.traits||{};return Object.values(e).reduce(((t,e)=>(t[e.traitName]=e,t)),{})}(Lr.MisoClient);for(const i of t){if(this._traits.find((t=>t.constructor.traitName===i)))continue;const t=s[i];if(!t){console.warn("Unknown trait: "+i);continue}const n=new t(this);e.push(n)}}this._traits=e}_destroyTrait(t){try{t._destroy&&t._destroy()}catch(t){console.error(t)}}}let Pr,$r,Ur;async function jr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Pr||(Pr=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return $r=$r||e.any(),Ur=Ur||await $r,Ur.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Ur}const Mr="logo",Dr="auto",zr=Object.freeze([...Lr.observedAttributes,Mr]);function Fr(t){if(!t)return Dr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Br extends Lr{static get observedAttributes(){return zr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Fr(this.getAttribute(Mr))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Dr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Mr,e):this.removeAttribute(Mr)}async connectedCallback(){super.connectedCallback();const t=this._client=await jr(Br);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Mr)this._handleLogoUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleLogoUpdate(t,e){Fr(t)!==Fr(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Qr="parent-question-id",Hr=Object.freeze([...Br.observedAttributes,Qr]);const Gr="unit-id",Vr=Object.freeze([...Br.observedAttributes,Gr]);class Wr extends Br{static get observedAttributes(){return Vr}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(Gr)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Gr,t):this.removeAttribute(Gr)}attributeChangedCallback(t,e,s){if(t===Gr)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Yr=Object.freeze({__proto__:null,MisoAskElement:class extends Br{static get tagName(){return"miso-ask"}static get observedAttributes(){return Hr}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Qr)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Qr,t):this.removeAttribute(Qr))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Qr)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Wr{static get tagName(){return"miso-explore"}static get observedAttributes(){return Wr.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends Br{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Br.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Br{static get tagName(){return"miso-search"}static get observedAttributes(){return Br.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Wr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Wr.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const Kr="role",Zr=Object.freeze([Kr]);class Jr extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Zr}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Kr);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Kr}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Kr}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Kr&&this._container&&this._container._updateComponentRole(this,e,s)}}var Xr=Object.freeze({__proto__:null,MisoComponentElement:Jr,MisoQueryElement:class extends Jr{constructor(){super({role:se.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends Jr{constructor(){super({role:se.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends Jr{constructor(){super({role:se.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Jr{constructor(){super({role:se.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Jr{constructor(){super({role:se.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Jr{constructor(){super({role:se.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Jr{constructor(){super({role:se.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Jr{constructor(){super({role:se.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends Jr{constructor(){super({role:se.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends Jr{constructor(){super({role:se.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Jr{constructor(){super({role:se.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Jr{constructor(){super({role:se.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Jr{constructor(){super({role:se.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends Jr{constructor(){super({role:se.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Jr{constructor(){super({role:se.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Jr{constructor(){super({role:se.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Jr{constructor(){super({role:se.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Jr{constructor(){super({role:se.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Jr{constructor(){super({role:se.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Jr{constructor(){super({role:se.ERROR})}static get tagName(){return"miso-error"}}});class ta extends Lr{static get observedAttributes(){return Lr.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(t){this._setContext(t)}async connectedCallback(){super.connectedCallback();const t=this._client=await jr(ta);document.body.contains(this)&&this._setContext(this._getContext(t))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(t){throw Error("Unimplemented")}_setContext(t){if(this._context===t)return;const e=this._context;this._context=t,this._onContext(t,e)}_onContext(){}}var ea=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends ta{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return ta.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(t){return t.ui.asks}_onContext(t,e){t!==e&&(this._unwire(),this._wire(t))}_unwire(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}_wire(t){t&&(t._autoNextFn||t.autoNext(),this._unsubscribes.push(t.on("create",(t=>{const{parentQuestionId:e}=t,s=t._options.resolved.templates.followUp;if(!e||!s)return;const i=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:e}));const n=this.children.length;for(const e of Array.prototype.slice.call(this.children,i,n))this._elementToWorkflow.set(e,t)}))),this._unsubscribes.push(t.on("loading",(({workflow:t})=>{for(const e of this.children)if(this._elementToWorkflow.get(e)===t){e.scrollIntoView({behavior:"smooth",block:"start"});break}}))),this._unsubscribes.push(t.on("destroy",(({workflow:t})=>{for(const e of this.children)this._elementToWorkflow.get(e)===t&&(this._elementToWorkflow.delete(e),e.remove())}))))}}});class sa extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(sa.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var ia=Object.freeze({__proto__:null,containers:Yr,roles:Xr,contexts:ea,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends sa{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Ws,MisoStubElement:Lr});const na="miso-hybrid-search-combo";var oa=Object.freeze({__proto__:null,CLASS_PREFIX:na,CONAINER_TAG:"miso-hybrid-search"});const ra="Show more",aa="Show less";var ca=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:ra,showLess:aa});const la=j(new oo({...oa,DEFAULT_PHRASES:ca})),ua=j(new class extends no{constructor(){super({helpers:la})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:la}));var _a=Object.freeze({__proto__:null,helpers:la,sections:ua,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=la;t=e(t);const{answerBox:n,answerGroup:o,searchResultsGroup:r}=ua,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[n(t)]:o(t))+s(t,{name:"search-results"},r(t))}});const da="answer-box-open",ha="answer-box-shown",ma='[data-role="answer-box-toggle"]';class pa{constructor(t,e,{classPrefix:s=na,phrases:i={},hideWhenUnanswerable:n=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=n,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(ma)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case _e.ERRONEOUS:case _e.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||aa:this._phrases.showMore||ra;for(const e of this._element.querySelectorAll(ma))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const fa={isOpen:da,shown:ha},ga={toggleOpen:["toggle",da],open:["add",da],close:["remove",da],toggleHidden:["toggle",ha],show:["add",ha],hide:["remove",ha]};for(const[t,e]of Object.entries(fa))Object.defineProperty(pa.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(ga))pa.prototype[t]=function(){this._updateBoxStatus(e,s),s===da&&(this._syncButtonText(),this._syncScroll())};const ba=Object.freeze(oa),ya=Object.freeze(ca),wa=Object.freeze(_a);var va=Object.freeze({__proto__:null,constants:ba,phrases:ya,templates:wa,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new pa(t,e,s)}});const ka=Object.freeze(wr),Ea=Object.freeze(va);var Ca=Object.freeze({__proto__:null,ask:ka,hybridSearch:Ea});function Sa(t){const e=t._element;if(!e)return()=>{};const s=e=>t._handleClick(e);return e.addEventListener("click",s),()=>e.removeEventListener("click",s)}const xa="miso-collapsible",Oa="expanded",Ia=[{action:"expand",classAction:"add",className:Oa},{action:"collapse",classAction:"remove",className:Oa}];class Ta{static get traitName(){return"collapsible"}constructor(t){this._element=t,t.collapsible=this,t.classList.add(xa),this._unsubscribes=[Sa(this)]}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(xa),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(t,e){for(const s of e)Object.defineProperty(t,s,{get(){return this._element&&this._element.classList.contains(s)}})}(Ta.prototype,[Oa]),function(t,e){for(const{action:s,classAction:i,className:n}of e)t[s]=function(){this._element&&this._element.classList[i](n),this["_"+s]&&this["_"+s]()}}(Ta.prototype,Ia),function(t,e){t._handleClick=function(t){const{target:s,button:i}=t;if(0===i)for(let{role:i,selector:n,action:o}of e)if(n=n||`[data-role="${i}"]`,n&&s.closest(n))return this[o](),void t.stopPropagation()}}(Ta.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var Aa=Object.freeze({__proto__:null,CollapsibleTrait:Ta});let Ra,Na;async function qa(){return Na||(Na=R(Ra||(Ra=N("ui"))))}class La{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Pa{constructor(t,e){this._plugin=t,this._client=e,u(this,{sources:{api:vs(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Xo(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Go(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class $a{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Ar(this._plugin,this._MisoClient))}}Rt.plugins.use(class extends Y{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Rr(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new O}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Ca,traits:Aa};l(s,this,["layouts","combo","ready"]),u(this,{MisoClient:t}),u(t,{ui:s}),this.combo=new $a(this,t);const i=Object.values(An).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:o,combos:r,contexts:a,...c}=ia,_=[...Object.values(r),...Object.values(a),...Object.values(n),...Object.values(o),...Object.values(c)],d=[Br,ta,sa];for(const e of[...d,..._])e.MisoClient=t;await qa();for(const t of _)b(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){u(t,{ui:new Pa(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new La(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new cr(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new pr(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new yo(this,t)),e}}),Rt.attach(),function(t){const e=[];function s(t){e.push(t)}T("misodev",{transform:t=>()=>t({addCmdTransform:s})});const i=t=>{for(const s of e)t=s(t);return t};setTimeout((()=>{T("misocmd",{transform:i}),t&&t()}))}((function(){Ot._cmdRes.resolve()}));const Ua="B43jkUKwmy9iEz17kO5V21KoPTmORcuBTRfltOVO",ja=({setAttribute:t},{source:e={}})=>{e.url&&t("href",e.url)},Ma=({parentQuestionId:t})=>`\n<miso-ask class="mfa-card mfa-related-questions-container" visible-when="initial+nonempty" logo="false" parent-question-id="${t}">\n  <div class="mfa-card__header">Related questions you can explore</div>\n  <miso-query-suggestions></miso-query-suggestions>\n</miso-ask>\n  `,Da=({parentQuestionId:t})=>`\n<miso-ask class="mfa-ask-input" visible-when="initial" logo="false" parent-question-id="${t}">\n  <miso-query></miso-query>\n</miso-ask>\n  `,za=({parentQuestionId:t})=>`\n<miso-ask class="mfa-answer miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${t}">\n  <hr class="mfa-answer-divider">\n  <div class="mfa-followup-title">\n    <span class="mfa-followup-title__label">Follow-up question:</span>\n    <span class="mfa-followup-title__question">\n      “<miso-question></miso-question>”\n    </span>\n  </div>\n  <miso-answer></miso-answer>\n</miso-ask>\n  `,Fa=({parentQuestionId:t})=>`\n<miso-ask class="mfa-source miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n  <div class="mfa-card">\n    <div class="mfa-card__header">Sources from My Bookshelf</div>\n    <miso-sources></miso-sources>\n  </div>\n</miso-ask>\n  `,Ba=(t,e,s,i)=>{const{templates:{indexBlock:n,helpers:{tagPair:o,formatDate:r}}}=t,{title:a,published_at:c,created_at:l,updated_at:u,snippet:_}=s,[d,h]=o(t,s),m=c||l||u;return`\n${d}\n  <div class="mfa-source-item__main-block">\n    <div class="mfa-source-item__title">${a}</div>\n    ${m?`<div class="mfa-source-item__date">${r(m)}</div>`:""}\n    <div class="mfa-source-item__snippet">${_}</div>\n    <div class="mfa-source-item__actions">\n      \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n   Ask this book anything\n    </div>\n  </div>\n  ${n(t,s,i)}\n${h}\n  `},Qa=(t,{text:e})=>`\n<li class="mfa-question-option" data-role="option" tabindex="0">\n  \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n  \n  <span class="mfa-question-option__text">${e}</span>\n</li>\n  `,Ha=(t,e)=>{const s=(t=>t&&Array.isArray(t)&&t.length>0?t.join(" | "):null)(e);return s?`\n  <div class="mfa-related-resource__array-data-group">\n    <div class="mfa-related-resource__array-data-label">${t}:</div>\n    <div class="mfa-related-resource__array-data-value">${s}</div>\n  </div>\n  `:""},Ga=(t,e,s)=>{const{templates:{helpers:{tagPair:i}}}=t,{title:n,authors:o,tags:r,snippet:a}=s,[c,l]=i(t,s);return`\n<div class="mfa-card mfa-related-resource">\n  ${c}\n    <div class="mfa-related-resource__main-block">\n      <div class="mfa-related-resource__tags">\n        <span class="mfa-related-resource__tag mfa-related-resource__tag--ebook">ebook</span>\n      </div>\n      <div class="mfa-related-resource__title">${n}</div>\n      ${Ha("author",o)}\n      ${Ha("topic",r)}\n      <div class="mfa-related-resource__snippet">\n        \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n  \n        <div>${a}</div>\n      </div>\n    </div>\n  ${l}\n  <div class="mfa-related-resource__actions">\n    <div class="mfa-related-resource__action">\n      \n<svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.33366 12.3333V2.33329H0.666992V0.666626H3.16699C3.38801 0.666626 3.59997 0.754423 3.75625 0.910704C3.91253 1.06698 4.00033 1.27895 4.00033 1.49996V11.5H14.3653L16.032 4.83329H5.66699V3.16663H17.1003C17.227 3.16663 17.352 3.19551 17.4658 3.25107C17.5797 3.30664 17.6793 3.38742 17.7573 3.48728C17.8352 3.58714 17.8893 3.70346 17.9156 3.82738C17.9418 3.95131 17.9394 4.07958 17.9087 4.20246L15.8253 12.5358C15.7802 12.716 15.6761 12.876 15.5297 12.9902C15.3832 13.1045 15.2028 13.1666 15.017 13.1666H3.16699C2.94598 13.1666 2.73402 13.0788 2.57774 12.9225C2.42146 12.7663 2.33366 12.5543 2.33366 12.3333ZM4.00033 18.1666C3.5583 18.1666 3.13437 17.991 2.82181 17.6785C2.50925 17.3659 2.33366 16.942 2.33366 16.5C2.33366 16.0579 2.50925 15.634 2.82181 15.3214C3.13437 15.0089 3.5583 14.8333 4.00033 14.8333C4.44235 14.8333 4.86628 15.0089 5.17884 15.3214C5.4914 15.634 5.66699 16.0579 5.66699 16.5C5.66699 16.942 5.4914 17.3659 5.17884 17.6785C4.86628 17.991 4.44235 18.1666 4.00033 18.1666ZM14.0003 18.1666C13.5583 18.1666 13.1344 17.991 12.8218 17.6785C12.5093 17.3659 12.3337 16.942 12.3337 16.5C12.3337 16.0579 12.5093 15.634 12.8218 15.3214C13.1344 15.0089 13.5583 14.8333 14.0003 14.8333C14.4424 14.8333 14.8663 15.0089 15.1788 15.3214C15.4914 15.634 15.667 16.0579 15.667 16.5C15.667 16.942 15.4914 17.3659 15.1788 17.6785C14.8663 17.991 14.4424 18.1666 14.0003 18.1666Z" fill="#001129"/>\n</svg>\n    \n      <span>Buy this Book</span>\n    </div>\n    <div class="mfa-related-resource__action">\n      \n<svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.0002 0.5C14.4935 0.5 18.2319 3.73333 19.016 8C18.2327 12.2667 14.4935 15.5 10.0002 15.5C5.50687 15.5 1.76854 12.2667 0.984375 8C1.76771 3.73333 5.50687 0.5 10.0002 0.5ZM10.0002 13.8333C11.6998 13.833 13.3489 13.2557 14.6776 12.196C16.0063 11.1363 16.936 9.65689 17.3144 8C16.9346 6.34442 16.0043 4.86667 14.6757 3.80835C13.3471 2.75004 11.6988 2.17377 10.0002 2.17377C8.30162 2.17377 6.65328 2.75004 5.32469 3.80835C3.99609 4.86667 3.06585 6.34442 2.68604 8C3.06446 9.65689 3.9941 11.1363 5.32283 12.196C6.65155 13.2557 8.30065 13.833 10.0002 13.8333ZM10.0002 11.75C9.00565 11.75 8.05182 11.3549 7.34856 10.6516C6.6453 9.94839 6.25021 8.99456 6.25021 8C6.25021 7.00544 6.6453 6.05161 7.34856 5.34835C8.05182 4.64509 9.00565 4.25 10.0002 4.25C10.9948 4.25 11.9486 4.64509 12.6519 5.34835C13.3551 6.05161 13.7502 7.00544 13.7502 8C13.7502 8.99456 13.3551 9.94839 12.6519 10.6516C11.9486 11.3549 10.9948 11.75 10.0002 11.75ZM10.0002 10.0833C10.5527 10.0833 11.0826 9.86384 11.4733 9.47314C11.864 9.08244 12.0835 8.55253 12.0835 8C12.0835 7.44747 11.864 6.91756 11.4733 6.52686C11.0826 6.13616 10.5527 5.91667 10.0002 5.91667C9.44767 5.91667 8.91777 6.13616 8.52707 6.52686C8.13637 6.91756 7.91687 7.44747 7.91687 8C7.91687 8.55253 8.13637 9.08244 8.52707 9.47314C8.91777 9.86384 9.44767 10.0833 10.0002 10.0833Z" fill="#001129"/>\n</svg>\n    \n      <span>See Free Chapter</span>\n    </div>\n    <div class="mfa-related-resource__action">\n      \n<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M9.00116 1.77415C10.9587 0.0166499 13.9837 0.0749834 15.8695 1.96415C17.7545 3.85415 17.8195 6.86415 16.0662 8.82748L8.9995 15.9042L1.9345 8.82748C0.181164 6.86415 0.246997 3.84915 2.13116 1.96415C4.01866 0.0774834 7.03783 0.0141499 9.00116 1.77415ZM14.6895 3.14165C13.4395 1.88998 11.4228 1.83915 10.1145 3.01415L9.002 4.01248L7.88866 3.01498C6.57616 1.83832 4.56366 1.88998 3.31033 3.14332C2.06866 4.38498 2.00616 6.37248 3.15033 7.68582L9.00033 13.545L14.8503 7.68665C15.9953 6.37248 15.9328 4.38748 14.6895 3.14165Z" fill="#001129"/>\n</svg>\n    \n      <span>Add to Wishlist</span>\n    </div>\n  </div>\n</div>\n  `},Va=(t,e,{text:s})=>`\n<div class="mfa-question-option" data-role="option" tabindex="0">\n  \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n  \n  <span class="mfa-question-option__text">${s}</span>\n</div>\n  `,Wa=({parentQuestionId:t})=>`\n<miso-ask class="mfa-related-questions-container" visible-when="initial+nonempty" logo="false" parent-question-id="${t}">\n  <div class="mfa-related-questions-container__header">Related questions you can explore</div>\n  <miso-query-suggestions></miso-query-suggestions>\n</miso-ask>\n  `,Ya=["url","created_at","updated_at","published_at","authors","tags"],Ka="https://api-edge.askmiso.com/v1",Za=async(t,e)=>{if(e)try{const s=await fetch(`${Ka}/ask/questions/${e}/answer?api_key=${Ua}`,{headers:t?{Authorization:t}:{}}),{data:i}=await s.json();return i}catch(t){return void console.error("Error fetching answer:",t)}},Ja=async(t,e,s,i)=>{const n=i||document.querySelector("miso-user-history");if(!n)return;n.innerHTML='\n<div class="miso-loading" aria-label="Loading" data-role="loading" style="display: flex;"></div>\n  ';const o=await(async(t,e)=>{if(!t)return[];try{const s=await fetch(`${Ka}/ask/alm/user_history?api_key=${Ua}`,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:e}:{}},body:JSON.stringify({user_id:t})}),{data:i}=await s.json();return i||[]}catch(t){return console.error("Error fetching user history:",t),[]}})(t,e);if(!Array.isArray(o)||0===o.length)return void(n.innerHTML='<div class="miso-user-history__empty">No history found</div>');n.innerHTML=`\n<ul class="miso-user-history__list">\n  ${o.map((t=>(({question_id:t,question:e})=>`\n<li class="miso-user-history__item" data-question-id="${t}">\n  <div class="miso-user-history__item-title">${e}</div>\n</li>\n  `)(t))).join("")}\n</ul>\n  `;const r=i.querySelectorAll(".miso-user-history__item");s&&r.forEach((t=>{t.addEventListener("click",(()=>{s(t.dataset.questionId)}))}))},Xa=t=>{t.querySelector(".mfa-ask-this-book__explore").classList.add("mfa-ask-this-book__explore--hide"),t.querySelector(".mfa-ask-this-book__info").classList.remove("mfa-ask-this-book__info--hide"),(t=>{const e=t.querySelector(".mfa-ask-this-book__tabs");e&&(e.style.display="none")})(t),(t=>{const e=t.querySelector('.mfa-ask-this-book__tab-content[data-tab-id="explore"]');e&&e.classList.add("mfa-ask-this-book__tab-content--active");const s=t.querySelector('.mfa-ask-this-book__tab-content[data-tab-id="history"]');s&&s.classList.remove("mfa-ask-this-book__tab-content--active")})(t)},tc=async(t,e)=>{await t.ui.ready;const s=MisoClient.ui.defaults.ask.wireFollowUps,i=document.querySelector("#miso-ask-combo");i.innerHTML='\n<section class="mfa-ask-this-book">\n  <miso-ask class="mfa-ask-input miso-circled-citation-index" logo="false">\n    <miso-query></miso-query>\n    <div class="mfa-ask-this-book__info mfa-ask-this-book__info--hide">Responses generated by AI using content from this book.</div>\n  </miso-ask>\n  <div class="mfa-ask-this-book__container">\n    <miso-ask class="mfa-ask-this-book__answer miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="mfa-ask-this-book__answer-title">\n        “<miso-question></miso-question>”\n      </div>\n      <miso-answer></miso-answer>\n    </miso-ask>\n    <div class="mfa-follow-up__related-questions-container"></div>\n    <div class="mfa-ask-this-book__tabs">\n      <div class="mfa-ask-this-book__tab mfa-ask-this-book__tab--active" data-tab-id="explore">\n        <span>Questions you can explore</span>\n      </div>\n      <div class="mfa-ask-this-book__tab" data-tab-id="history">\n        <span>Previously asked questions</span>\n      </div>\n    </div>\n    <div class="mfa-ask-this-book__tab-content mfa-ask-this-book__tab-content--active" data-tab-id="explore">\n      <miso-explore class="mfa-ask-this-book__explore">\n        <miso-related-questions></miso-related-questions>\n      </miso-explore>\n    </div>\n    <div class="mfa-ask-this-book__tab-content" data-tab-id="history">\n      <miso-user-history></miso-user-history>\n    </div>\n  </div>\n</section>\n  ';const n=e=>{const s=t.ui.ask;i.querySelector(".miso-search-box__input").value=e,s.query({q:e})},o=t.ui.asks;o.useLayouts({query:{placeholder:"What can we answer for you?",buttonText:"Ask"},query_suggestions:{templates:{option:Qa}}}),o.on("request",(()=>{Xa(i)})),o.on("tracker",(({items:t,role:e,type:s})=>{if("query_suggestions"===e&&"click"===s){n(t[0].text)}}));const r=t.ui.explore;r.useApi({product_id:e}),r.useLink((()=>{})),r.useLayouts({related_questions:["list",{templates:{question:Va}}]}),r.on("done",(()=>{i.querySelectorAll(".mfa-question-option").forEach((t=>{t.addEventListener("click",(()=>{const e=t.querySelector(".mfa-question-option__text").textContent;n(e)}))}))})),r.start(),s(t,i.querySelector(".mfa-follow-up__related-questions-container"),{template:Wa});const a=i.querySelectorAll(".mfa-ask-this-book__tab"),c=i.querySelectorAll(".mfa-ask-this-book__tab-content");a.forEach((t=>{t.addEventListener("click",(()=>{if(t.classList.contains("mfa-ask-this-book__tab--active"))return;a.forEach((t=>t.classList.remove("mfa-ask-this-book__tab--active"))),c.forEach((t=>t.classList.remove("mfa-ask-this-book__tab-content--active"))),t.classList.add("mfa-ask-this-book__tab--active");const e=i.querySelector(`.mfa-ask-this-book__tab-content[data-tab-id="${t.dataset.tabId}"]`);e&&e.classList.add("mfa-ask-this-book__tab-content--active")}))}));const l=i.querySelector("miso-user-history");l&&Ja(t.context.user_id,t.context.auth,(e=>{(async e=>{if(!e)return;Xa(i);const s=t.ui.ask,n=await Za(t.context.auth,e);n&&s.updateData({session:s.session,value:n})})(e)}),l)},ec=["url","created_at","updated_at","published_at","authors","tags"];!function(t){const e={_client:!1,_init(){if(this._client)return;const t=new Rt(Ua);this._client=t},setUserInfo(t){const{userId:e,userType:s}=t;e&&(this._client.context.user_id=e),s&&(this._client.context.user_type=s)},setAuthToken(t){t&&(this._client.context.auth="Bearer "+t)},clearAuthToken(){this._client.context.auth=void 0},answer(t){t&&(this._client.ui.asks.reset(),(async(t,e)=>{const s=t.ui.ask;await t.ui.ready;const i=MisoClient.ui.defaults.ask,n=i.wireFollowUps,o=i.wireRelatedResources,r=document.querySelector("#miso-ask-combo");r.innerHTML='\n<div class="mfa-answer-header mfa-answer-header--unready">\n  <div class="mfa-answer-header__title">\n    You asked about&nbsp;\n    <miso-ask visible-when="ready" logo="false">\n      “<miso-question></miso-question>”\n    </miso-ask>\n  </div>\n  <div class="mfa-answer-header__actions">\n    <button class="mfa-answer-header__action">\n      My Answers\n      \n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g clip-path="url(#clip0_116_16781)">\n    <path d="M16 12L10 18V6L16 12Z" fill="currentColor"/>\n  </g>\n  <defs>\n    <clipPath id="clip0_116_16781">\n      <rect width="24" height="24" fill="white" transform="matrix(-1 0 0 -1 24 24)"/>\n    </clipPath>\n  </defs>\n</svg>\n  \n    </button>\n  </div>\n</div>\n<div class="mfa-answer-container">\n  <section class="mfa-answer-main-block">\n    <miso-ask class="mfa-answer miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="mfa-answer__info">\n        \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n   Results are generated using information from My Bookshelf\n      </div>\n      <miso-answer></miso-answer>\n    </miso-ask>\n    <div class="mfa-follow-up__answer-container"></div>\n    <div class="mfa-follow-up__input-container"></div>\n  </section>\n  <section class="mfa-answer-secondary-block">\n    <miso-ask class="mfa-source miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <div class="mfa-card">\n        <div class="mfa-card__header">Sources from My Bookshelf</div>\n        <miso-sources></miso-sources>\n      </div>\n    </miso-ask>\n    <div class="mfa-follow-up__sources-container"></div>\n    <div class="mfa-follow-up__related-questions-container"></div>\n  </section>\n</div>\n<section class="mfa-answer-related">\n  <miso-ask class="miso-ask-combo__related-resources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <h2 class="miso-ask-combo__phrase miso-ask-combo__related-resources-phrase">Books related to this topic</h2>\n    <miso-related-resources></miso-related-resources>\n  </miso-ask>\n</section>\n<div class="mfa-answer-footer"></div>\n  ';const a=t.ui.asks;a.useApi({fq:"type:ReferenceBook",source_fl:Ya,related_resource_fl:Ya}),a.useLayouts({answer:{onCitationLink:ja},sources:["list",{templates:{article:Ba}}],query:{placeholder:"Ask a follow-up question",buttonText:"Ask"},query_suggestions:{templates:{option:Qa}},related_resources:["list",{templates:{article:Ga}}]}),a.on("request",(()=>{document.querySelector(".mfa-answer-header").classList.add("mfa-answer-header--unready");const t=r.querySelectorAll(".mfa-answer"),e=r.querySelectorAll(".mfa-source");if(t.length>1&&e.length>1){const s=t.length-2,i=Math.max(t[s].offsetHeight,e[s].offsetHeight);t[s].style.height=i+"px",e[s].style.height=i+"px"}})),a.on("ready",(()=>{document.querySelector(".mfa-answer-header").classList.remove("mfa-answer-header--unready")})),a.on("tracker",(({role:t,type:e})=>{if("query_suggestions"===t&&"click"===e){const t=r.querySelectorAll(".mfa-followup-title__label");t[t.length-1].textContent="Related question:"}})),n(t,r.querySelector(".mfa-follow-up__related-questions-container"),{template:Ma}),n(t,r.querySelector(".mfa-follow-up__input-container"),{template:Da}),n(t,r.querySelector(".mfa-follow-up__answer-container"),{template:za}),n(t,r.querySelector(".mfa-follow-up__sources-container"),{template:Fa}),o(t,r.querySelector(".miso-ask-combo__related-resources")),s.query({q:e})})(this._client,t))},askThisBook(t){t&&(this._client.ui.asks.reset(),tc(this._client,t))},myAnswers(t){((t,e)=>{const s=document.querySelector("#miso-my-answers");if(!s)return;s.innerHTML='\n<div class="mfa-my-answers__tabs">\n  <div class="mfa-my-answers__tab mfa-my-answers__tab--active" data-tab-id="history">\n    <span>Previously Asked Questions</span>\n  </div>\n</div>\n<div class="mfa-my-answers__tab-content mfa-my-answers__tab-content--active" data-tab-id="history">\n  <miso-user-history></miso-user-history>\n</div>\n  ';const i=s.querySelector("miso-user-history");i&&Ja(t.context.user_id,t.context.auth,e,i)})(this._client,t)},retrieveAnswer(t){t&&(this._client.ui.asks.reset(),(async(t,e)=>{const s=t.ui.ask;await t.ui.ready;const i=MisoClient.ui.defaults.ask,n=i.wireFollowUps,o=i.wireRelatedResources,r=document.querySelector("#miso-ask-combo");r.innerHTML='\n<div class="mfa-answer-header mfa-answer-header--unready">\n  <div class="mfa-answer-header__title">\n    You asked about&nbsp;\n    <miso-ask visible-when="ready" logo="false">\n      “<miso-question></miso-question>”\n    </miso-ask>\n  </div>\n  <div class="mfa-answer-header__actions">\n    <button class="mfa-answer-header__action">\n      My Answers\n      \n<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g clip-path="url(#clip0_116_16781)">\n    <path d="M16 12L10 18V6L16 12Z" fill="currentColor"/>\n  </g>\n  <defs>\n    <clipPath id="clip0_116_16781">\n      <rect width="24" height="24" fill="white" transform="matrix(-1 0 0 -1 24 24)"/>\n    </clipPath>\n  </defs>\n</svg>\n  \n    </button>\n  </div>\n</div>\n<div class="mfa-answer-container">\n  <section class="mfa-answer-main-block">\n    <miso-ask class="mfa-answer miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="mfa-answer__info">\n        \n<svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"/>\n</svg>\n   Results are generated using information from My Bookshelf\n      </div>\n      <miso-answer></miso-answer>\n    </miso-ask>\n    <div class="mfa-follow-up__answer-container"></div>\n    <div class="mfa-follow-up__input-container"></div>\n  </section>\n  <section class="mfa-answer-secondary-block">\n    <miso-ask class="mfa-source miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <div class="mfa-card">\n        <div class="mfa-card__header">Sources from My Bookshelf</div>\n        <miso-sources></miso-sources>\n      </div>\n    </miso-ask>\n    <div class="mfa-follow-up__sources-container"></div>\n    <div class="mfa-follow-up__related-questions-container"></div>\n  </section>\n</div>\n<section class="mfa-answer-related">\n  <miso-ask class="miso-ask-combo__related-resources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <h2 class="miso-ask-combo__phrase miso-ask-combo__related-resources-phrase">Books related to this topic</h2>\n    <miso-related-resources></miso-related-resources>\n  </miso-ask>\n</section>\n<div class="mfa-answer-footer"></div>\n  ',s.useApi(!1);const a=t.ui.asks;a.useApi({fq:"type:ReferenceBook",source_fl:ec,related_resource_fl:ec}),a.useLayouts({answer:{onCitationLink:ja},sources:["list",{templates:{article:Ba}}],query:{placeholder:"Ask a follow-up question",buttonText:"Ask"},query_suggestions:{templates:{option:Qa}},related_resources:["list",{templates:{article:Ga}}]}),a.on("request",(()=>{document.querySelector(".mfa-answer-header").classList.add("mfa-answer-header--unready");const t=r.querySelectorAll(".mfa-answer"),e=r.querySelectorAll(".mfa-source");if(t.length>1&&e.length>1){const s=t.length-2,i=Math.max(t[s].offsetHeight,e[s].offsetHeight);t[s].style.height=i+"px",e[s].style.height=i+"px"}})),a.on("ready",(()=>{document.querySelector(".mfa-answer-header").classList.remove("mfa-answer-header--unready")})),a.on("tracker",(({role:t,type:e})=>{if("query_suggestions"===t&&"click"===e){const t=r.querySelectorAll(".mfa-followup-title__label");t[t.length-1].textContent="Related question:"}})),n(t,r.querySelector(".mfa-follow-up__related-questions-container"),{template:Ma}),n(t,r.querySelector(".mfa-follow-up__input-container"),{template:Da}),n(t,r.querySelector(".mfa-follow-up__answer-container"),{template:za}),n(t,r.querySelector(".mfa-follow-up__sources-container"),{template:Fa}),o(t,r.querySelector(".miso-ask-combo__related-resources"));const c=await Za(t.context.auth,e);c&&s.updateData({session:s.session,value:c})})(this._client,t))}};t.MisoForALM||(t.MisoForALM=e),e._init()}(window)}();
