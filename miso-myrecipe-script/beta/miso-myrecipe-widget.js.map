{"version":3,"file":"miso-myrecipe-widget.js","sources":["../src/widgets/plan-listing/index.ts","../src/services/api.ts","../src/core/instance.ts","../src/index.ts"],"sourcesContent":["import type { MisoWidgetInstance } from '../../core/instance'\nimport type { Plan } from '../../types/api'\nimport { fetchPlans } from '../../services/api'\nimport './styles.css'\n\nexport class PlanListingWidget {\n  private container: HTMLElement\n  private instance: MisoWidgetInstance\n  private widgetElement: HTMLElement | null = null\n  private plans: Plan[] = []\n  private isLoading = false\n\n  constructor(container: HTMLElement, instance: MisoWidgetInstance) {\n    this.container = container\n    this.instance = instance\n  }\n\n  render(): void {\n    // Initial render with loading state\n    this.renderContent()\n\n    // Fetch plans asynchronously\n    this.loadPlans()\n  }\n\n  private async loadPlans(): Promise<void> {\n    this.isLoading = true\n    this.renderContent()\n\n    try {\n      const config = this.instance.getConfig()\n      const response = await fetchPlans(config.token)\n      this.plans = response.data\n    } catch (error) {\n      console.error('Failed to fetch plans:', error)\n      this.plans = []\n    } finally {\n      this.isLoading = false\n      this.renderContent()\n    }\n  }\n\n  private renderContent(): void {\n    const template = `\n      <div class=\"miso-plan-listing\">\n        <h1 class=\"miso-plan-listing__title\">Meal Plans</h1>\n        ${this.isLoading ? this.renderLoading() : this.renderPlans()}\n      </div>\n    `\n\n    this.container.innerHTML = template\n    this.widgetElement = this.container.firstElementChild as HTMLElement\n\n    // Attach event listeners after rendering\n    if (!this.isLoading) {\n      this.attachEventListeners()\n    }\n  }\n\n  private renderLoading(): string {\n    return `\n      <div class=\"miso-plan-listing__loading\">\n        Loading...\n      </div>\n    `\n  }\n\n  private renderPlans(): string {\n    if (this.plans.length === 0) {\n      return this.renderEmptyState()\n    }\n\n    const planCount = this.plans.length === 1 ? '1 Plan' : `${this.plans.length} Plans`\n\n    return `\n      <div class=\"miso-plan-listing__header\">\n        <div class=\"miso-plan-listing__count\">${planCount}</div>\n        <button class=\"miso-plan-listing__new-btn\" data-action=\"create-plan\">\n          <span>New Plan</span>\n          <img src=\"/src/assets/imgs/icon-add.svg\" alt=\"\" class=\"miso-plan-listing__new-btn-icon\" />\n        </button>\n      </div>\n      <div class=\"miso-plan-listing__list\">\n        ${this.plans.map(plan => this.renderPlanCard(plan)).join('')}\n      </div>\n    `\n  }\n\n  private renderEmptyState(): string {\n    return `\n      <div class=\"miso-plan-listing__empty\">\n        <p class=\"miso-plan-listing__empty-text\">No meal plan yet. Create a new plan to get started!</p>\n        <button class=\"miso-plan-listing__new-btn\" data-action=\"create-plan\">\n          <span>New Plan</span>\n          <img src=\"/src/assets/imgs/icon-add.svg\" alt=\"\" class=\"miso-plan-listing__new-btn-icon\" />\n        </button>\n      </div>\n    `\n  }\n\n  private renderPlanCard(plan: Plan): string {\n    const recipeCount = plan.recipes.length === 1 ? '1 RECIPE' : `${plan.recipes.length} RECIPES`\n    const createdDate = this.formatDate(plan.created_at)\n\n    return `\n      <div class=\"miso-plan-listing__card\" data-plan-id=\"${plan.id}\">\n        <div class=\"miso-plan-listing__card-title\">${this.escapeHtml(plan.title)}</div>\n        <div class=\"miso-plan-listing__card-meta\">\n          <span class=\"miso-plan-listing__card-recipes\">${recipeCount}</span>\n          <span class=\"miso-plan-listing__card-date\">CREATED ON ${createdDate}</span>\n        </div>\n      </div>\n    `\n  }\n\n  private formatDate(timestamp: number): string {\n    const date = new Date(timestamp)\n    const day = date.getDate()\n    const month = date.getMonth() + 1\n    const year = date.getFullYear().toString().slice(-2)\n    return `${day}/${month}/${year}`\n  }\n\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div')\n    div.textContent = text\n    return div.innerHTML\n  }\n\n  private attachEventListeners(): void {\n    if (!this.widgetElement) return\n\n    // New Plan button\n    const newPlanBtn = this.widgetElement.querySelector('[data-action=\"create-plan\"]')\n    if (newPlanBtn) {\n      newPlanBtn.addEventListener('click', () => {\n        this.instance.emit('create-plan')\n      })\n    }\n\n    // Plan cards\n    const planCards = this.widgetElement.querySelectorAll('[data-plan-id]')\n    planCards.forEach(card => {\n      card.addEventListener('click', () => {\n        const planId = (card as HTMLElement).dataset.planId\n        if (planId) {\n          this.instance.emit('view-plan', planId)\n        }\n      })\n    })\n  }\n\n  async getPlans(): Promise<Plan[]> {\n    return this.plans\n  }\n\n  async refreshPlans(): Promise<void> {\n    await this.loadPlans()\n  }\n\n  destroy(): void {\n    if (this.widgetElement) {\n      this.container.removeChild(this.widgetElement)\n      this.widgetElement = null\n    }\n    this.plans = []\n  }\n}\n","import type { Plan } from '../types/api'\n\n// Toggle between empty and sample data for demo purposes\nconst MOCK_EMPTY = true\n\n// Sample plan data matching Figma design\nconst SAMPLE_PLANS: Plan[] = [\n  {\n    id: 'plan-1',\n    title: 'Week of Nov 18 - Nov 24',\n    messages: [\n      { role: 'user', content: 'Create a weekly meal plan with healthy recipes' },\n      { role: 'assistant', content: 'I\\'ve created a healthy weekly meal plan for you.' }\n    ],\n    recipes: [\n      {\n        slot_label: 'Monday',\n        title: 'Grilled Chicken Salad',\n        cover_image: 'https://example.com/chicken-salad.jpg',\n        author: 'Chef John',\n        description: 'A fresh and healthy grilled chicken salad',\n        url: 'https://example.com/recipes/chicken-salad',\n        rating: 4.5,\n        cook_time: '30 mins'\n      },\n      {\n        slot_label: 'Tuesday',\n        title: 'Salmon with Vegetables',\n        cover_image: 'https://example.com/salmon.jpg',\n        author: 'Chef Mary',\n        description: 'Pan-seared salmon with roasted vegetables',\n        url: 'https://example.com/recipes/salmon',\n        rating: 4.8,\n        cook_time: '40 mins'\n      },\n      {\n        slot_label: 'Wednesday',\n        title: 'Vegetarian Pasta',\n        cover_image: 'https://example.com/pasta.jpg',\n        author: 'Chef Tom',\n        description: 'Delicious vegetarian pasta with fresh vegetables',\n        url: 'https://example.com/recipes/pasta',\n        rating: 4.3,\n        cook_time: '25 mins'\n      },\n      {\n        slot_label: 'Thursday',\n        title: 'Beef Stir Fry',\n        cover_image: 'https://example.com/stir-fry.jpg',\n        author: 'Chef Lisa',\n        description: 'Quick and easy beef stir fry',\n        url: 'https://example.com/recipes/stir-fry',\n        rating: 4.6,\n        cook_time: '20 mins'\n      },\n      {\n        slot_label: 'Friday',\n        title: 'Fish Tacos',\n        cover_image: 'https://example.com/tacos.jpg',\n        author: 'Chef Mike',\n        description: 'Fresh fish tacos with homemade salsa',\n        url: 'https://example.com/recipes/fish-tacos',\n        rating: 4.7,\n        cook_time: '35 mins'\n      },\n      {\n        slot_label: 'Saturday',\n        title: 'BBQ Ribs',\n        cover_image: 'https://example.com/ribs.jpg',\n        author: 'Chef Bob',\n        description: 'Tender BBQ ribs with special sauce',\n        url: 'https://example.com/recipes/bbq-ribs',\n        rating: 4.9,\n        cook_time: '2 hours'\n      },\n      {\n        slot_label: 'Sunday',\n        title: 'Roast Chicken',\n        cover_image: 'https://example.com/roast-chicken.jpg',\n        author: 'Chef Sarah',\n        description: 'Classic roast chicken with herbs',\n        url: 'https://example.com/recipes/roast-chicken',\n        rating: 4.8,\n        cook_time: '1 hour 30 mins'\n      }\n    ],\n    created_at: Date.now() - 7 * 24 * 60 * 60 * 1000, // 7 days ago\n    updated_at: Date.now() - 2 * 24 * 60 * 60 * 1000 // 2 days ago\n  },\n  {\n    id: 'plan-2',\n    title: 'Quick Weeknight Dinners',\n    messages: [\n      { role: 'user', content: 'I need quick dinner ideas for busy weeknights' },\n      { role: 'assistant', content: 'Here are some quick and easy dinner recipes.' }\n    ],\n    recipes: [\n      {\n        slot_label: 'Monday',\n        title: '15-Minute Pasta',\n        cover_image: 'https://example.com/quick-pasta.jpg',\n        author: 'Chef Anna',\n        description: 'Super quick pasta dish',\n        url: 'https://example.com/recipes/quick-pasta',\n        rating: 4.4,\n        cook_time: '15 mins'\n      },\n      {\n        slot_label: 'Tuesday',\n        title: 'One-Pan Chicken',\n        cover_image: 'https://example.com/one-pan.jpg',\n        author: 'Chef David',\n        description: 'Easy one-pan chicken dinner',\n        url: 'https://example.com/recipes/one-pan-chicken',\n        rating: 4.5,\n        cook_time: '25 mins'\n      },\n      {\n        slot_label: 'Wednesday',\n        title: 'Quick Tacos',\n        cover_image: 'https://example.com/quick-tacos.jpg',\n        author: 'Chef Emma',\n        description: 'Fast and tasty tacos',\n        url: 'https://example.com/recipes/quick-tacos',\n        rating: 4.6,\n        cook_time: '20 mins'\n      },\n      {\n        slot_label: 'Thursday',\n        title: 'Stir-Fry Rice',\n        cover_image: 'https://example.com/fried-rice.jpg',\n        author: 'Chef Kevin',\n        description: 'Quick fried rice with vegetables',\n        url: 'https://example.com/recipes/fried-rice',\n        rating: 4.3,\n        cook_time: '18 mins'\n      },\n      {\n        slot_label: 'Friday',\n        title: 'Sheet Pan Dinner',\n        cover_image: 'https://example.com/sheet-pan.jpg',\n        author: 'Chef Rachel',\n        description: 'Easy sheet pan dinner',\n        url: 'https://example.com/recipes/sheet-pan',\n        rating: 4.7,\n        cook_time: '30 mins'\n      }\n    ],\n    created_at: Date.now() - 14 * 24 * 60 * 60 * 1000, // 14 days ago\n    updated_at: Date.now() - 5 * 24 * 60 * 60 * 1000 // 5 days ago\n  },\n  {\n    id: 'plan-3',\n    title: 'Vegetarian Delights',\n    messages: [\n      { role: 'user', content: 'Create a vegetarian meal plan' },\n      { role: 'assistant', content: 'I\\'ve created a delicious vegetarian meal plan.' }\n    ],\n    recipes: [\n      {\n        slot_label: 'Breakfast',\n        title: 'Avocado Toast',\n        cover_image: 'https://example.com/avocado-toast.jpg',\n        author: 'Chef Sophie',\n        description: 'Healthy avocado toast',\n        url: 'https://example.com/recipes/avocado-toast',\n        rating: 4.6,\n        cook_time: '10 mins'\n      },\n      {\n        slot_label: 'Lunch',\n        title: 'Buddha Bowl',\n        cover_image: 'https://example.com/buddha-bowl.jpg',\n        author: 'Chef Oliver',\n        description: 'Nutritious buddha bowl',\n        url: 'https://example.com/recipes/buddha-bowl',\n        rating: 4.8,\n        cook_time: '25 mins'\n      },\n      {\n        slot_label: 'Dinner',\n        title: 'Lentil Curry',\n        cover_image: 'https://example.com/lentil-curry.jpg',\n        author: 'Chef Priya',\n        description: 'Spicy lentil curry',\n        url: 'https://example.com/recipes/lentil-curry',\n        rating: 4.9,\n        cook_time: '35 mins'\n      }\n    ],\n    created_at: Date.now() - 21 * 24 * 60 * 60 * 1000, // 21 days ago\n    updated_at: Date.now() - 10 * 24 * 60 * 60 * 1000 // 10 days ago\n  }\n]\n\n/**\n * Fetch all plans for the current user\n * @param _token Bearer token for authentication\n * @returns Promise with plans data\n */\nexport async function fetchPlans(_token: string): Promise<{ data: Plan[] }> {\n  // Mock API call - in production this would be a real fetch\n  // const response = await fetch('/myr/plan', {\n  //   method: 'GET',\n  //   headers: {\n  //     'Authorization': `Bearer ${token}`,\n  //     'Content-Type': 'application/json'\n  //   }\n  // })\n  // return response.json()\n\n  // Simulate network delay\n  await new Promise(resolve => setTimeout(resolve, 300))\n\n  // Return mock data based on toggle\n  return {\n    data: MOCK_EMPTY ? [] : SAMPLE_PLANS\n  }\n}\n","import type { WidgetConfig, WidgetInstance, EventCallback } from '../types/widget'\nimport { PlanListingWidget } from '../widgets/plan-listing'\n\nexport class MisoWidgetInstance implements WidgetInstance {\n  private config: WidgetConfig\n  private eventListeners: Map<string, Set<EventCallback>> = new Map()\n  private planListingWidget: PlanListingWidget | null = null\n  \n  constructor(config: WidgetConfig) {\n    this.config = config\n  }\n\n  on(event: string, callback: EventCallback): void {\n    if (!this.eventListeners.has(event)) {\n      this.eventListeners.set(event, new Set())\n    }\n    this.eventListeners.get(event)!.add(callback)\n  }\n\n  off(event: string, callback: EventCallback): void {\n    const listeners = this.eventListeners.get(event)\n    if (listeners) {\n      listeners.delete(callback)\n    }\n  }\n\n  emit(event: string, ...args: any[]): void {\n    const listeners = this.eventListeners.get(event)\n    if (listeners) {\n      listeners.forEach(callback => callback(...args))\n    }\n  }\n\n  renderPlanListingWidget(container: HTMLElement): void {\n    this.planListingWidget = new PlanListingWidget(container, this)\n    this.planListingWidget.render()\n  }\n\n  destroyPlanListingWidget(): void {\n    if (this.planListingWidget) {\n      this.planListingWidget.destroy()\n      this.planListingWidget = null\n    }\n  }\n\n  renderPlanEditorWidget(container: HTMLElement, planId: string | null): void {\n    // TODO: Implement plan editor widget\n    console.warn('renderPlanEditorWidget not implemented', container, planId)\n  }\n\n  destroyPlanEditorWidget(): void {\n    // TODO: Implement plan editor widget\n    console.warn('destroyPlanEditorWidget not implemented')\n  }\n\n  async getPlans(): Promise<any[]> {\n    if (!this.planListingWidget) {\n      return []\n    }\n    return this.planListingWidget.getPlans()\n  }\n\n  async refreshPlans(): Promise<void> {\n    if (this.planListingWidget) {\n      await this.planListingWidget.refreshPlans()\n    }\n  }\n\n  getConfig(): WidgetConfig {\n    return this.config\n  }\n}\n","import { MisoWidgetInstance } from './core/instance'\nimport type { WidgetConfig, WidgetInstance } from './types/widget'\nimport './styles/variables.css'\n\nexport type { WidgetConfig, WidgetInstance } from './types/widget'\nexport type { Plan, Recipe, Message, Messages } from './types/api'\n\nexport function init(config: WidgetConfig): WidgetInstance {\n  return new MisoWidgetInstance(config)\n}\n\n// Export as global for IIFE bundle\nif (typeof window !== 'undefined') {\n  (window as any).misoForMyR = { init }\n}\n"],"names":["PlanListingWidget","constructor","container","instance","this","widgetElement","plans","isLoading","render","renderContent","loadPlans","config","getConfig","response","async","Promise","resolve","setTimeout","data","fetchPlans","token","error","console","template","renderLoading","renderPlans","innerHTML","firstElementChild","attachEventListeners","length","renderEmptyState","map","plan","renderPlanCard","join","recipeCount","recipes","createdDate","formatDate","created_at","id","escapeHtml","title","timestamp","date","Date","getDate","getMonth","getFullYear","toString","slice","text","div","document","createElement","textContent","newPlanBtn","querySelector","addEventListener","emit","querySelectorAll","forEach","card","planId","dataset","getPlans","refreshPlans","destroy","removeChild","MisoWidgetInstance","eventListeners","Map","planListingWidget","on","event","callback","has","set","Set","get","add","off","listeners","delete","args","renderPlanListingWidget","destroyPlanListingWidget","renderPlanEditorWidget","warn","destroyPlanEditorWidget","init","window","misoForMyR"],"mappings":"wCAKO,MAAMA,EAOX,WAAAC,CAAYC,EAAwBC,GAJpCC,KAAQC,cAAoC,KAC5CD,KAAQE,MAAgB,GACxBF,KAAQG,WAAY,EAGlBH,KAAKF,UAAYA,EACjBE,KAAKD,SAAWA,CAClB,CAEA,MAAAK,GAEEJ,KAAKK,gBAGLL,KAAKM,WACP,CAEA,eAAcA,GACZN,KAAKG,WAAY,EACjBH,KAAKK,gBAEL,IACE,MAAME,EAASP,KAAKD,SAASS,YACvBC,QCyKZC,iBAeE,aAHM,IAAIC,QAAQC,GAAWC,WAAWD,EAAS,MAG1C,CACLE,KAAmB,GAEvB,CD3L6BC,CAAWR,EAAOS,OACzChB,KAAKE,MAAQO,EAASK,IACxB,OAASG,GACPC,QAAQD,MAAM,yBAA0BA,GACxCjB,KAAKE,MAAQ,EACf,CAAA,QACEF,KAAKG,WAAY,EACjBH,KAAKK,eACP,CACF,CAEQ,aAAAA,GACN,MAAMc,EAAW,kHAGXnB,KAAKG,UAAYH,KAAKoB,gBAAkBpB,KAAKqB,oCAInDrB,KAAKF,UAAUwB,UAAYH,EAC3BnB,KAAKC,cAAgBD,KAAKF,UAAUyB,kBAG/BvB,KAAKG,WACRH,KAAKwB,sBAET,CAEQ,aAAAJ,GACN,MAAO,0FAKT,CAEQ,WAAAC,GACN,GAA0B,IAAtBrB,KAAKE,MAAMuB,OACb,OAAOzB,KAAK0B,mBAKd,MAAO,kGAFiC,IAAtB1B,KAAKE,MAAMuB,OAAe,SAAW,GAAGzB,KAAKE,MAAMuB,qUAW/DzB,KAAKE,MAAMyB,IAAIC,GAAQ5B,KAAK6B,eAAeD,IAAOE,KAAK,yBAG/D,CAEQ,gBAAAJ,GACN,MAAO,uZAST,CAEQ,cAAAG,CAAeD,GACrB,MAAMG,EAAsC,IAAxBH,EAAKI,QAAQP,OAAe,WAAa,GAAGG,EAAKI,QAAQP,iBACvEQ,EAAcjC,KAAKkC,WAAWN,EAAKO,YAEzC,MAAO,8DACgDP,EAAKQ,4DACXpC,KAAKqC,WAAWT,EAAKU,6HAEhBP,6EACQE,8CAIhE,CAEQ,UAAAC,CAAWK,GACjB,MAAMC,EAAO,IAAIC,KAAKF,GAItB,MAAO,GAHKC,EAAKE,aACHF,EAAKG,WAAa,KACnBH,EAAKI,cAAcC,WAAWC,OAAM,IAEnD,CAEQ,UAAAT,CAAWU,GACjB,MAAMC,EAAMC,SAASC,cAAc,OAEnC,OADAF,EAAIG,YAAcJ,EACXC,EAAI1B,SACb,CAEQ,oBAAAE,GACN,IAAKxB,KAAKC,cAAe,OAGzB,MAAMmD,EAAapD,KAAKC,cAAcoD,cAAc,+BAChDD,GACFA,EAAWE,iBAAiB,QAAS,KACnCtD,KAAKD,SAASwD,KAAK,iBAKLvD,KAAKC,cAAcuD,iBAAiB,kBAC5CC,QAAQC,IAChBA,EAAKJ,iBAAiB,QAAS,KAC7B,MAAMK,EAAUD,EAAqBE,QAAQD,OACzCA,GACF3D,KAAKD,SAASwD,KAAK,YAAaI,MAIxC,CAEA,cAAME,GACJ,OAAO7D,KAAKE,KACd,CAEA,kBAAM4D,SACE9D,KAAKM,WACb,CAEA,OAAAyD,GACM/D,KAAKC,gBACPD,KAAKF,UAAUkE,YAAYhE,KAAKC,eAChCD,KAAKC,cAAgB,MAEvBD,KAAKE,MAAQ,EACf,EEnKK,MAAM+D,EAKX,WAAApE,CAAYU,GAHZP,KAAQkE,mBAAsDC,IAC9DnE,KAAQoE,kBAA8C,KAGpDpE,KAAKO,OAASA,CAChB,CAEA,EAAA8D,CAAGC,EAAeC,GACXvE,KAAKkE,eAAeM,IAAIF,IAC3BtE,KAAKkE,eAAeO,IAAIH,EAAO,IAAII,KAErC1E,KAAKkE,eAAeS,IAAIL,GAAQM,IAAIL,EACtC,CAEA,GAAAM,CAAIP,EAAeC,GACjB,MAAMO,EAAY9E,KAAKkE,eAAeS,IAAIL,GACtCQ,GACFA,EAAUC,OAAOR,EAErB,CAEA,IAAAhB,CAAKe,KAAkBU,GACrB,MAAMF,EAAY9E,KAAKkE,eAAeS,IAAIL,GACtCQ,GACFA,EAAUrB,QAAQc,GAAYA,KAAYS,GAE9C,CAEA,uBAAAC,CAAwBnF,GACtBE,KAAKoE,kBAAoB,IAAIxE,EAAkBE,EAAWE,MAC1DA,KAAKoE,kBAAkBhE,QACzB,CAEA,wBAAA8E,GACMlF,KAAKoE,oBACPpE,KAAKoE,kBAAkBL,UACvB/D,KAAKoE,kBAAoB,KAE7B,CAEA,sBAAAe,CAAuBrF,EAAwB6D,GAE7CzC,QAAQkE,KAAK,yCAA0CtF,EAAW6D,EACpE,CAEA,uBAAA0B,GAEEnE,QAAQkE,KAAK,0CACf,CAEA,cAAMvB,GACJ,OAAK7D,KAAKoE,kBAGHpE,KAAKoE,kBAAkBP,WAFrB,EAGX,CAEA,kBAAMC,GACA9D,KAAKoE,yBACDpE,KAAKoE,kBAAkBN,cAEjC,CAEA,SAAAtD,GACE,OAAOR,KAAKO,MACd,EC/DK,SAAS+E,EAAK/E,GACnB,OAAO,IAAI0D,EAAmB1D,EAChC,OAGsB,oBAAXgF,SACRA,OAAeC,WAAa,CAAEF"}