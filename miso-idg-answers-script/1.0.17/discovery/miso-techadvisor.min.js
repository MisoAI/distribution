!function(){"use strict";var e=Object.freeze({aff_type:"random",...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()}),t="1.0.17";const s=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var n=function(){if(e.sponsor)return s.find((t=>t.key===e.sponsor))||void 0}();function i(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const r=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),o=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var a=Object.freeze({__proto__:null,GROUP:r,NAME:o});function c(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function l(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function u(e){return null!=e?""+e:e}function h(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function _(e){return null==e}function d(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function p(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function m(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function f(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function g(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class y{constructor(e,{duration:t=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);w(s),w(n),w(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==n?n:t})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>b(this,e)),t):b(this,e),this._value=e}disconnect(){this._active=!1}}function b(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function w(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function v(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function E(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function S(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async n=>{try{await e(n),t()}catch(e){s(e)}}))}))}async function k(e,{area:t=.5,duration:s=1e3,signal:n}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((i,r)=>{const o=new y((e=>{e&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((e=>{o.value=e[0].isIntersecting}),{threshold:t});a.observe(e),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function I(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function O(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function x(e,t){const s=T((()=>window.localStorage.getItem(e))),n=T((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,n=t.indexOf(s);if(0>n)return;const i=n+s.length,r=t.indexOf(";",i);return decodeURIComponent(0>r?t.substring(i):t.substring(i,r))}(e))),i=s||n||""+t();return i&&!s&&T((()=>window.localStorage.setItem(e,i))),i&&!n&&T((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,i))),i}function T(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function C(e){return new A(e)}class A{constructor(e){this._value=e;const t=e=>{this._value=e};p(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class R{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class ${constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new R),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var N="1.12.0-beta.0";let P;try{P=document.currentScript}catch(e){}async function L(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let n;e.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{e.sheet&&(n&&clearInterval(n),t())}),100)}))}(e),await async function(e){if(q(e))return;return new Promise((t=>{let s;s=setInterval((()=>{q(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function U(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${N}/dist/css/${e}.css`}function q(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function j(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function D(e,{depth:t=5,...s}={}){return M(e,t)}function M(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>M(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const n={};if(0>=t)return n;for(const s in e){const i=e[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=M(i,t-1)))}return n}(e,t):e:"(...)"}function z(e,t){const s=Object.getOwnPropertyDescriptors(t),n=Object.getOwnPropertyDescriptors(e);for(const[t,i]of Object.entries(s))"constructor"!==t&&void 0===n[t]&&Object.defineProperty(e,t,i)}function F(e){const t={},s=new Set;for(let n=e;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(t[n]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}const B=100,Q=4;function G(e){const t=function({speed:e=B,acceleration:t=Q}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,n)=>{let i=e*(Math.random()+.5);return t>0&&void 0!==n&&s>n&&(i*=1+(s-n)*t/1e3),i}}(e);return(e,s,n,i)=>{const r=t(n,s);return e+Math.max(i-n,0)*r/1e3}}const H=Symbol.for("miso:resources");class W{constructor(){this._resources=new Map;const e=window[H]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){V(this._resources,e).resolve(t)}async get(e){return V(this._resources,e).promise}}function V(e,t){if(e.has(t))return e.get(t);const s=new R;return e.set(t,s),s}function K(){return window[H]||(window[H]=new W)}class Y{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new R;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class Z{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},n=this._namedCallbacks[e];if(n)for(const e of n)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,n)=>{const i=t._on(e,(e=>{setTimeout((()=>i()));try{s(e)}catch(e){n(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:n})=>{try{e(s,n)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)c(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&c(s,t)}}_injectSubscribeInterface(e){d(e,this,["on","once"])}}function J(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class X{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:J(e,t),uuid:O()})}(e,t);p(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new Z({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(X,"miso:component");class ee extends X{constructor(e,t,{libName:s,keyName:n}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=e=>e[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new R);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class te{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new y(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class se{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:ne}=document,ie=ne.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function re({}){await Promise.all([ae()])}let oe=!1;async function ae(){if(oe)return;if(oe=!0,!ne)throw Error("currentScript not found");const e=ne.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}function ce(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${ie}/${e}`}const le=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",logo_image:"image/macworld.jpg",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",logo_image:"image/techhive.jpeg",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",logo_image:"image/pcwelt.jpg",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",logo_image:"image/macwelt.jpg",regions:[],ref_story:"2383200"}].map((({logo_image:e,...t})=>({logo_image:ce(e),...t})));async function ue(e,{interval:t=300,timeout:s}={}){const n=e();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const t=e();null!=t&&(a(),n(t))}),t),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}function he({site:e,version:t,config:s}){const{aff_type:n}=s;return h({source:"miso-client-script",script_version:t,attribution:"miso-smart-answers",aff_type:n,site:e.key,uuid:O()})}function _e(){return h({page:h({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:de()})}function de(){const e=new URLSearchParams(window.location.search);let t=h({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}le.reduce(((e,t)=>(e[t.key]=t,e)),{});const pe=5e3;let me,fe,ge=!1;async function ye(){return fe||(fe=Promise.any([we(),ve(),be(pe)]))}async function be(e){return new Promise((t=>setTimeout((()=>{const e=O();ke("Fallback",e),t(e)}),e)))}async function we(){const e=await ue((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&ke("GA4",e),e}async function ve(){const e=(await(me||(me=async function(){return ue((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&ke("UA",e),e}const Ee="%cMiso",Se="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function ke(s,n){!function(...s){(e.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(Ee,Se,...e)}(...s)}(`[${s}] Client ID: ${n}${ge?" (unused)":""}`),ge=!0}const Ie="%cMiso",Oe="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function xe(...s){(e.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(Ie,Oe,...e)}(...s)}const Te=new Map;async function Ce(e){return async function(e,t,s){if(e.has(t))return e.get(t);const n=await s(t);return e.set(t,n),n}(Te,e,(async e=>await async function(e,t){return async function(e,t,{fields:s}={}){let n=`https://b2c-contenthub.com/wp-json/wp/v2/${e}/${t}`;s&&(n+="?_fields="+s.join(","));return async function(e){return(await window.fetch(e)).json()}(n)}("posts",e,t)}(e,{fields:["meta"]})))}async function Ae(e){const t={};let s;try{s=await Ce(e),xe("Fetched post info",[s])}catch(s){return console.error("Cannot fetch post: "+e),console.error(s),t}try{if(t.contentType=s.meta.content_type,!t.contentType)throw Error("Blank meta.content_type: "+e)}catch(t){console.error("Cannot extract story type: "+e),console.error(t)}try{const{suppress_monetization:e='""'}=s.meta||{},n=JSON.parse(e);t.adSuppression=!0===n.content_ads}catch(t){console.error("Cannot extract suppress_monetization info: "+e),console.error(t)}return t}const Re="home",$e="answers",Ne="search",Pe="article",Le="other";var Ue=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const qe={key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},je=window.location.hostname!==qe.hostname;var De={...qe,dev:je};var Me=Object.freeze(function(){const e=(t=window.location.pathname).endsWith("/")?t.substring(0,t.length-1):t;var t;switch(e){case"":return{type:Re};case"/smart-answers":return{type:$e};case"/search":return{type:Ne};default:if(De.regions.indexOf(e.substring(1))>=0)return{type:Re}}const s=e.substring(1).split("/");if("article"===s[0]){const e=""+s[1];return{type:Pe,postId:e,product_id:`article_${De.key}_${e}`}}return{type:Le}}());const ze="%cMiso",Fe="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Be=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var Qe=function(){if(Ue.sponsor)return Be.find((e=>e.key===Ue.sponsor))||void 0}(),Ge=Object.freeze({__proto__:null,config:Ue,version:t,site:De,page:Me,sponsor:Qe,debug:function(...e){(Ue.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(ze,Fe,...e)}(...e)}}),He="1.12.0-beta.0";const We=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Ve{constructor(e,t){this._client=e,this._root=t,this._bulk=new Y(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,l=i?AbortSignal.timeout(i):void 0,u=await(this._root._customFetch||window.fetch)(e,h({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:l})),_=await u.json();if(u.status>=400||_.errors){var d=Error(_.message);throw d.data=_,d.status=u.status,d}return _}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:n}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:i,status_code:r,body:o}=n[t];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:n={}}=this._client.options,i=t.sendApiKeyByHeader||n.sendApiKeyByHeader,r=e.filter((e=>e)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=We.DATA_ENDPOINT,eventEndpoint:s=We.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:t,apiName:s,url:n})||n}catch(t){(e._error||console.error)(t)}return n}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:t,apiName:s,payload:n})||n}catch(t){(e._error||console.error)(t)}return n}}class Ke extends X{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...i}),this._postprocess(l)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(e,t,n):this.helpers.fetch(s,n,r)}_postprocess({response:e}){return e.data}}const{GROUP:Ye,NAME:Ze}=a;class Je extends Ke{constructor(e){super(e,Ye.INTERACTIONS)}async upload(e,t){try{return await this._run(Ze.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Ze.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:n}=s;return this.helpers.sendBeacon(e,n,t),{}}return super._send({...s,options:t})}}class Xe{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...n}=this._options;const r=new se(s);let o;t=i(this._ac.signal,r.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,l=!1;function u(){o&&clearInterval(o),l=!0}const h=new $;return o=setInterval((async()=>{let t,o,d;try{if([t,o,d]=await e(r?{signal:r}:{}),l||!_(a)&&a>=d)return;_(d)||(a=d),i&&i(t,o,d),c=0}catch(e){return n&&n(e),c++,void(c>s&&(u(),h.error(e)))}h.update(t,o),o&&u()}),t),r&&r.addEventListener&&r.addEventListener("abort",(()=>{u(),h.abort(r.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?r.clear():this._isUpdated(o,e)&&r.touch(),o=e},...n})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class et extends Xe{constructor(e,t,s,n){super(n),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:tt,NAME:st}=a;class nt extends Ke{constructor(e){super(e,tt.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new it(this,e,t);const s=await this._run(st.QUESTIONS,e,t);return new it(this,s,t)}async _questions(e,t){return this._run(st.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${st.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(st.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(st.TRENDING_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(st.SEARCH,e,t);return s.question_id?new rt(this,s,t):s}async _searchGet(e,t){return this._run(`${st.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(st.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(st.SEARCH_AUTOCOMPLETE,e,t)}}class it extends et{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class rt extends et{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),p(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:ot,NAME:at}=a;class ct extends Ke{constructor(e){super(e,ot.SEARCH)}async search(e,t){return this._run(at.SEARCH,e,t)}async autocomplete(e,t){return this._run(at.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(at.MGET,e,t)}}const{GROUP:lt,NAME:ut}=a;class ht extends Ke{constructor(e){super(e,lt.RECOMMENDATION)}async userToProducts(e,t){return this._run(ut.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(ut.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(ut.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(ut.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(ut.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(ut.PRODUCT_TO_PRODUCTS,e,t)}}class _t extends X{constructor(e,t){super("api",e),this._client=e,this.helpers=new Ve(e,t),this.interactions=new Je(this),this.ask=new nt(this),this.search=new ct(this),this.recommendation=new ht(this)}}var dt=Object.freeze({__proto__:null,Api:_t,ApiBase:Ke,ApiHelpers:Ve,Interactions:Je,Ask:nt,Search:ct,Recommendation:ht});class pt extends X{constructor(e){super("context",e),this._client=e}}var mt={api:dt,context:{Context:pt}};class ft{constructor(e){p(this,{install:e})}}class gt extends ee{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new yt(this,mt),this.plugins=new bt(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new R);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const n=new s;return p(n,{id:e}),this._tryConfig(n,t),n;case"function":return new ft(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(e,t,s){const n=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),i=0>t?e.length:t,r=e.lastIndexOf("/",i)+1,o=e.indexOf(".",r),a=0>o?"":e.slice(o,i);return`${e.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${n}.min.js`}(e,t,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new K).get(s);!this.isRegistered(e)&&this.register(n)}}class yt{constructor(e,t){d(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),p(this,{classes:t})}}class bt{constructor(e){d(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const wt=new class extends X{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new gt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=He,this._cmdRes=new R}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var vt=Object.freeze({__proto__:null,viewable:k,debounce:j});const{currentScript:Et}=document;class St extends X{static attach(){(window.MisoClients||(window.MisoClients=[])).push(St),window.MisoClient?window.MisoClient!==St&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=St}static debug(){}constructor(e){super("client",wt),this._config(e),this.context=new pt(this),this.api=new _t(this,wt),function(e){wt._clients.push(e),wt._events.emit("create",e)}(this)}get version(){return St.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,h(e)}_readConfigFromScriptUrl(){return h({apiKey:new URL(new Request(Et.src||Et.href).url).searchParams.get("api_key")||void 0})}}St.helpers=vt,p(St,{uuid:O()});var kt=function(e){const t=wt._pluginRoot;return wt.MisoClient=t.MisoClient=e,d(e,wt,["version","instances","any","meta","on","once","cmdDone"]),d(e,t,["plugins"]),e}(St);const{GROUP:It,NAME:Ot}=a;let xt;class Tt{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||xt||(xt=x("miso_anonymous_id",O))}set anonymous_id(e){e=u(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=u(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function Ct(){const e=new URLSearchParams(window.location.search);let t=h({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class At{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],n=e[t];n!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Rt(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:He};return s.uuid||(s.uuid=O()),{...e,context:{...t,custom_context:s}}}const $t="std:native-fetch";let Nt,Pt;const Lt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Nt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),Nt="borrowed",e.contentWindow.fetch}catch(e){Pt=e}})();const Ut="miso-logdump",qt="miso-logdump",jt=qt+"__download-btn",Dt="Miso Log";class Mt{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return Qt||(Qt=L(U("logdump")))}();let e=document.getElementById(Ut);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||Dt,t.classList.add(jt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=Ut,e.classList.add(qt),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(Ut),t=e&&e.querySelector("."+jt);t&&(t.textContent=this._options.logDownloadButtonText||Dt)}hideDownloadButton(){const e=document.getElementById(Ut);e&&(e.style.display="none")}download(){const e=new Blob([Ft(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:zt()})}return e&&"string"==typeof e?e:`miso-log.${zt()}.jsonl`}clear(){this._logs=[]}}function zt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Ft(e){return e.map((e=>JSON.stringify(D(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Bt(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function Bt(e){return e?D(e,{depth:2}):e}let Qt;const Gt="std:debug";function Ht(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function Wt(e,t){return Object.freeze({...e,...t,members:Vt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Vt(e=[],t=[]){return[...new Set([...e,...t])]}function Kt(e,t){let s={};for(const n of e)n&&(s=t(s,n));return h(s)}function Yt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Zt(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,n=t.payload,{...s,...n,...Jt("_meta",s,n)})});var s,n}))}function Jt(e,t,s){const n=t&&t[e],i=s&&s[e],r=n?i?{...n,...i}:n:i;return void 0!==r?{[e]:r}:{}}kt.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Mt(e)}static get id(){return Gt}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Gt,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,n)=>this._handleEvent(e,n,s,t)))}_handleEvent(e,{name:t},s,n=[]){if("child"===t||"subtree"===t)return;const i=n.concat(e.meta.path);if(i.length||"create"!==t){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(t,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(i[1],i.slice(2),t,s))}this._logw(i.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",e];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=e,i="custom"===t&&s?`${t}:${s}`:t;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,n){this._logw([e,t.join(".")],s,n)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Ht)):this._log(e,t,Ht(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return $t}install(e,t){Lt?(t.setCustomFetch(Lt),e.debug(`<plugin:${$t}>`,"[info]",`Using ${Nt} native fetch`)):e.debug(`<plugin:${$t}>`,"[error]","Failed to obtain native fetch: "+Pt.message)}}),kt.plugins.use(class extends X{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new Tt(this);var s,n;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:n}){return t===It.INTERACTIONS&&s===Ot.UPLOAD?this._modifyPayloadForInteractions(e,n):t===It.ASK&&s===Ot.QUESTIONS?this._modifyPayloadForAsk(e,n):this._modifyPayloadForOthers(e,n)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:n,anonymous_id:i}=e.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=e.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:n}=e.context,i=h({anonymous_id:s,user_id:n});return{data:t=t.map((e=>({...i,...e})))}}}),kt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...h({page:h({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Ct()}),...e.context}})))}}}),kt.plugins.use(class extends X{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new At(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:n}){if(t===r.SEARCH)if(s===o.SEARCH)this._captureSearchApiRequest(e,n)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),kt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(Rt)}}}),kt.plugins.use(class extends X{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case r.SEARCH:case r.RECOMMENDATION:return!0}return!1}});const Xt="data-miso-product-id",es="default",ts="_organic",ss=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ns=new Set([ss.PRODUCTS,ss.CATEGORIES,ss.ATTRIBUTES,ss.RESULTS,ss.ITEMS,ss.QUESTION,ss.ANSWER,ss.IMAGES,ss.SOURCES,ss.RELATED_RESOURCES,ss.QUERY_SUGGESTIONS,ss.RELATED_QUESTIONS,ss.AFFILIATION,ss.FACETS,ss.TOTAL]);function is(e){return ns.has(e)}const rs=new Set([ss.PRODUCTS,ss.IMAGES,ss.SOURCES,ss.RELATED_RESOURCES]);const os=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),as=[os.IMPRESSION,os.VIEWABLE,os.CLICK,os.SUBMIT,os.FEEDBACK],cs=[os.IMPRESSION,os.VIEWABLE,os.CLICK],ls=new Set(cs);const us=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),hs=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function _s(e){if(0>as.indexOf(e))throw Error("Unrecognized event type: "+e)}const ds=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function ps(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function ms(e){if(void 0===e)return;let[t,s]=l(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function fs(e,t){return!1===(t=ms(t))[0]?t:e&&t?[t[0]||e[0],gs(e[1],t[1])]:t||e}function gs(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const ys=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function bs(e={}){e=Yt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))ws(t);return e}function ws(e={}){return e=Yt(e)}function vs(e={},t={}){const s={...e};for(const[n,i]of Object.entries(t))void 0!==i&&(s[n]=as.includes(n)?Es(e[n],i):i);return s}function Es(e={},t={}){return{...e,...t}}const Ss=[{key:ds.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return h({group:s,name:e,payload:t})},merge:Zt},{key:ds.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${ss.PRODUCTS}: ... }) instead`),e={...s,[ss.PRODUCTS]:t});const n={};for(const[t,s]of Object.entries(e))n[ps(t)]=ms(s);return n},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{for(const[s,n]of Object.entries(t))e[s]=fs(e[s],n);return e}))}},{key:ds.DATA_PROCESSOR,normalize:function(e){e=l(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:ds.TRACKERS,normalize:function(e={}){e=Yt(e);const{active:t,...s}=e,n={};for(const[e,t]of Object.entries(s))n[e]=bs(t);return{active:t,...n}},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{for(const[s,n]of Object.entries(t))void 0!==n&&(e[s]="active"===s?n:vs(e[s],n));return e}))}},{key:ds.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=l(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,n=t.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:ds.FILTERS,normalize:Yt,merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>Object.assign(e,t)))}},{key:ds.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>Object.assign(e,t)))}}];class ks{constructor(){this._events=new Z({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class Is{constructor(e={},t={}){this._events=new Z({target:this}),this._defaults=t,this._context=e||{},this._locals={},p(this,{resolved:new Os(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class Os{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,n=s._context[e];this._cache[e]=t(s._defaults[e],n&&n.get(),s._locals[e])}return this._cache[e]}}class xs{constructor(e,t,s,n,i){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?n(e):void 0,this._merge=i}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of Ss){const{key:t,normalize:s,merge:n}=e;Object.defineProperty(ks.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new xs(this,this._globals,t,s,n))}}),Object.defineProperty(Is.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new xs(this,this._locals,t,s,n))}}),Object.defineProperty(Os.prototype,t,{get:function(){return this._get(e)}})}const Ts=[ds.API,ds.LAYOUTS,ds.DATA_PROCESSOR,ds.TRACKERS,ds.INTERACTIONS];function Cs(e,t=Ts){for(const s of t)As(e,s)}function As(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+n](e){return this._options[t].merge(e),this},["clear"+n](){return this._options[t].set(),this}})}var s}const Rs="q",$s="qs";function Ns(e={}){const{setValue:t,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:n=Rs,sourceParam:i=$s,...r}={}){return{setValue:e,focus:t,updateUrl:s,param:n,sourceParam:i,...r}}(e),r=new URLSearchParams(window.location.search),o=r.get(n),a=r.get(i)||void 0,{layout:c}=this._views.get(ss.QUERY);c&&(o&&t&&(c.value=o),!o&&s&&c.focus()),o&&this.query(h({q:o,qs:a}))}class Ps extends X{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new ks}}function Ls(e){return e?"view:"+e:"view"}Cs(Ps.prototype);class Us{constructor(e={}){(this._events=new Z)._injectSubscribeInterface(this),this._options=e,this._states={},p(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const n=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(n),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(n)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class qs{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:O(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function js(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class Ds{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e})}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...n}=e;this._emitResponse({session:t,request:n});try{const{signal:s}=this._ac||{},i={...e.options,signal:s},r=await this._source({session:t,...e,options:i});if(r&&r[Symbol.asyncIterator]){let e;for await(e of(r._response&&this._emitResponseWithSessionCheck({session:t,request:n,value:r._response}),r)){if(!js(this._hub,t))break;this._emitResponse({session:t,request:n,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:n,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:n,error:e})}}_emitResponseWithSessionCheck(e){js(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ms{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{c(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:zs,VIEWABLE:Fs,CLICK:Bs}=os,{UNTRACKED:Qs,TRIGGERED:Gs}=us,Hs=Object.freeze({[zs]:Qs,[Fs]:Qs,[Bs]:Qs});class Ws{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Hs}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||Qs}set(e,t,s){_s(t),function(e){if(e!==us.UNTRACKED&&e!==us.TRACKING&&e!==us.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const n of l(e))this._setOne(n,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Gs))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const n=s(t);return e.set(t,n),n}(this._states,this._getKey(e),(()=>({...Hs}))))[t]=s}}const Vs=[Symbol("itemless")];class Ks{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Ws(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){_s(e);const{options:n}=this;if(!n)return;this._syncSession();const{deduplicated:i=!0,itemless:r=!1}=n;if(i){if(r&&(t=Vs),0===(t=this._states.untriggered(l(t),e)).length)return;this._states.set(t,e,us.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:os.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(h({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Ws(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[Ls(this._role)]}}for(const e of cs)Ks.prototype[e]=function(t,s){this._trigger(e,t,s)};class Ys{constructor(e,t){this._events=new Z({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),p(this,{role:t,interface:new Zs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ms((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===ss.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Ks({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((i=t)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:l,meta:u,value:h}=t,_={session:o,status:a,ongoing:c,request:l,meta:u,data:h,...Js(t)},d=(e={},t)=>{!1!==e&&this.updateState({..._,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:d})}catch(e){this._error(e),d({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?hs.ERRONEOUS:e.status;e=this._state=Object.freeze(h({...e,status:s}));const{role:n}=this;this.hub.update(Ls(n),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:n,meta:i,...r}=e,o={value:this._mapping(e,this),status:n,data:t,meta:i,...r};return this.role===ss.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(t)}),h(o)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!is(s))continue;let t=e&&e[s];if(s===ss.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Zs{constructor(e){d(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Js(e){return function(e){return e.status===hs.READY&&!e.ongoing}(e)?{empty:!!Xs(e)}:{}}function Xs(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function en(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class tn{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new Z({target:this,error:s}),p(this,{facets:new sn(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return h({facets:Object.freeze({}),sort:en(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(h({...e,...t,facets:Object.freeze(h({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class sn{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const nn=Symbol.for("miso:tracked");function rn(e){return!!e[nn]}function on(e){e[nn]=!0}const an=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function cn(e,t){return!!t&&{...e,...t}}class ln{constructor(e,{workflow:t,extensions:s,layouts:n,roles:i,options:r}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new tn(this);for(const e of i.members)e!==ss.CONTAINER&&(this._views[e]=new Ys(this,e));p(this,{interface:new un(this),trackers:new hn(this,i.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),e.on("data",(e=>this.refresh({data:e}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Ys(this,ss.CONTAINER);t.layout=this._createLayout(ss.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,n]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName});if(t===ss.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,n]=t;return this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:n}=t._inst;e&&(s=s.filter((t=>t.role===ss.CONTAINER||e.includes(t.role)))),n&&(s=s.filter((e=>!n.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:n={},...i}=e;return h({...an,...i,impression:cn(an.impression,t),viewable:cn(an.viewable,s),click:cn(an.click,n)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=ss.CONTAINER;this._containerTracker=new Ks({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class un{constructor(e){this._actor=e,d(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class hn{constructor(e,t){this._views=e;for(const s of t)s!==ss.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,ss.CONTAINER,{get:()=>e._getContainerTracker()})}}class _n{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:os.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class dn{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=l(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function pn(e){return async({group:t,name:s,payload:n,options:i})=>{if(t===r.ASK)switch(s){case o.QUESTIONS:return e.api.ask.questions(n,i);case o.SEARCH:return e.api.ask.search(n,i)}return e.api[t]._run(s,n,i)}}class mn{constructor({role:e,workflow:t,...s}={}){p(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const n=this._rendered.get(e),i=C(!1);t=this._preprocess({state:t,rendered:n},{skip:i.t})||t,this._updatePending(t,s),i.value||this._handleInput({state:t,rendered:n},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,S((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),r=C([]),o=C({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function fn(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function gn(e,t,s,n){const{templates:i}=e,[r,o]=Pn(e,s);return""+r+(i.indexBlock||$n)(e,s,n)+(i.infoBlock||i.articleInfoBlock||vn)(e,s,n)+o}function yn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Sn)(e,t,s)+(i.descriptionBlock||In)(e,t,s)+(i.priceBlock||Cn)(e,t,s)+(i.ctaBlock||Nn)(e,t,s)}</div>`}function bn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Sn)(e,t,s)+(i.descriptionBlock||In)(e,t,s)+(i.priceBlock||Cn)(e,t,s)}</div>`}function wn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Sn)(e,t,s)+(i.dateBlock||On)(e,t,s)+(i.descriptionBlock||In)(e,t,s)+(i.ctaBlock||Nn)(e,t,s)}</div>`}function vn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Sn)(e,t,s)+(i.authorsAndDateBlock||Tn)(e,t,s)}</div>`}function En(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Sn)(e,t,s)}</div>`}function Sn({className:e},{title:t,_title_with_markups:s}){const n=s||I(t);return n?`<div class="${e}__item-title">${n}</div>`:""}function kn({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function In({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${I(s)}</div>`:""}function On({className:e,templates:t},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${e}__item-date">${qn(r,t.date)}</div>`:""}function xn({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function Tn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-authors-and-date-container">${""+(i.authorsBlock||xn)(e,t,s)+(i.dateBlock||On)(e,t,s)}</div>`}function Cn(e,t){const{className:s,templates:n}=e,{sale_price:i,original_price:r,currency:o="USD"}=t,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,l=t.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(n.discountRateText||An)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function An(e,{discount_rate_percent:t}){return`(${t}% off)`}function Rn(e,t,s={}){const{className:n,templates:i}=e,{cover_image:r,image_src:o,image_alt:a}=t;if(!r&&!o)return"";const c=o?"image":"cover-image";return`<div class="${n}__item-${c}-container">${"image"===c?`<img class="${n}__item-${c}" src="${o}"${a?` alt="${a}"`:""}>`:`<img class="${n}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(i.brandBlock||kn)(e,t,s):""}</div>`}function $n({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Nn(e,t,s){const{className:n,templates:i}=e,r=jn.asFunction(i.cta)(e,t,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function Pn({className:e,options:t={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const a=!1!==o.link&&n?"a":"div",c=!1!==o.link&&n?`href="${n}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:n=!0}=e;let i="";n&&(t&&(i+=` target="${t}"`),s&&(i+=` rel="${s}"`));return i}(t.link)}`:"";return[`<${a} class="${e}__${i}" ${r?`data-role="${r}"`:""} ${s?`${Xt}="${s}"`:""} ${c}>`,`</${a}>`]}const Ln=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Un="en-US";function qn(e,t=Ln){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||Ln.locale,t);default:throw Error("Invalid date format: "+t)}}const jn=Object.freeze({tagPair:Pn,formatDate:qn,formatNumber:function(e,t=Un){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||Un.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:I,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class Dn extends mn{constructor({className:e,templates:t,...s}={}){super(s),p(this,{className:e,templates:{...fn("root"),...t,helpers:jn}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Mn extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Mn.MisoClient.ui.layouts.create("banner").render(this)}}class zn{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(e,{ac:s});let i=!1;try{await k(e,{...t,signal:n}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return i}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class Fn extends mn{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new zn}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Mn.tagName,s=this._shallRenderBanner(e),n=e.querySelector(t);s&&!n?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&n&&n.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,n=void 0!==s&&"auto"!==s?s:t;return"auto"===n?e.components.some((({role:e})=>function(e){return e===ss.PRODUCTS||e===ss.ANSWER}(e))):!!n}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1,unanswerable:o=!1}={}}=t,a=[s,r?hs.EMPTY:hs.NONEMPTY];s===hs.READY&&a.push(n?hs.ONGOING:hs.DONE),o&&a.push(hs.UNANSWERABLE),e.setAttribute("status",a.join(" ")),i?e.setAttribute("miso-id",i):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===hs.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const Bn=Object.freeze({root:function(e,t){const{className:s,templates:n}=e,{status:i,value:r}=t;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class Qn extends Dn{static get type(){return"error"}static get defaultTemplates(){return Bn}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...Bn,...t},...s})}}const Gn=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Hn(e,t){const s=[];for(const n of t.entries){const t=e.e2b.get(n.element);t&&t.key===n.key||s.push(n)}return s}class Wn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const n=function(e,t,s){const n=new Map,i=new Map,r=[];for(let o=0;e.length>o;o++){const a=e[o],c=s[o],l=Object.freeze({index:o,key:a,value:t[o],element:c});n.set(a,l),i.set(c,l),r.push(l)}return{k2b:n,e2b:i,entries:r}}(e,t,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Hn(i,n),o=Hn(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function Vn(e){z(e,Kn.prototype)}class Kn{_initTrackable(){this._bindings=new Wn,this._viewables=new zn}_syncBindings(e,t){const s=this._getItems(t)||[],n=s.map((e=>this._getItemKey(e))),i=this._getItemElements(e),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:n}of e)(async()=>{await this._viewables.track(n,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!rn(t)&&0===t.button&&!t.defaultPrevented&&!!v(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(on(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Yn{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===hs.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let n=!1;try{await k(t,{area:1,duration:0,signal:s.signal}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Zn=Object.freeze({product:function(e,t,s,n){const{templates:i}=e,[r,o]=Pn(e,s);return""+r+(i.imageBlock||Rn)(e,s,n)+(i.infoBlock||i.productInfoBlock||bn)(e,s,n)+o},article:function(e,t,s,n){const{templates:i}=e,[r,o]=Pn(e,s);return""+r+(i.imageBlock||Rn)(e,s,n)+(i.infoBlock||i.articleInfoBlock||wn)(e,s,n)+(i.indexBlock||$n)(e,s,n)+o},compactArticle:gn,image:function(e,t,s,n){const{templates:i}=e,[r,o]=Pn(e,s);return""+r+(i.imageBlock||Rn)(e,s,n)+(i.infoBlock||i.imageInfoBlock||En)(e,s,n)+o},question:function(e,t,s){const[n,i]=Pn(e,s);return`${n}${s.value||s.text||s}${i}`},root:function(e,t){const{className:s,role:n,templates:i,options:r}=e,{status:o}=t;return`<div class="${s} ${o}"${n?` data-role="${n}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${o===hs.READY?i[o](e,t):""}${i.trigger(e,t)}${i.loading(e,t)}</div>`},[hs.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t)||[];return n.length>0||t.ongoing?s.body(e,t,n):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:n,templates:i,options:r}=e,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${i.items(e,t,s)}</${o}>`},ordered:!1,items:function(e,t,s,{offset:n=0}={}){const{templates:i}=e;let r=n;return s.map((s=>i.item(e,t,s,r++))).join("")},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item">${r[a](e,t,s,{index:n})}</li>`},productInfoBlock:bn,articleInfoBlock:wn,compactArticleInfoBlock:vn,imageInfoBlock:En,brandBlock:kn,titleBlock:Sn,descriptionBlock:In,dateBlock:On,authorsBlock:xn,authorsAndDateBlock:Tn,priceBlock:Cn,discountRateText:An,ctaBlock:Nn,cta:function(e,t,s){const{templates:n}=e,{url:i}=t;if(!i)return"";const[r,o]=Pn(e,{url:i},{classSuffix:"item-cta",role:"cta"}),a=jn.asFunction(n.ctaText)(e,t,s);return a?`${r}${a}${o}`:""},imageBlock:Rn,indexBlock:$n,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Jn extends Dn{static get defaultTemplates(){return Zn}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Zn,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=this._html(e,t,s);return{...e,incremental:s,html:n}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:n,html:i}=t;if(n)if(i){this._getListElement(e).insertAdjacentHTML("beforeend",i)}else s(!1);else e.innerHTML=i}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:n,element:i}=t;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Vn(Jn.prototype),z(Jn.prototype,Yn.prototype);const Xn="miso-list";class ei extends Jn{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Xn}constructor({className:e=Xn,...t}={}){super({className:e,...t})}}const ti="miso-horizontal";class si extends Jn{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ti}constructor({className:e=ti,...t}={}){super({className:e,...t})}}const ni="miso-cards";function ii(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function ri(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function oi(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),n=t[2]||"";return[s,n]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function ai(e){return void 0===e||e instanceof ci?e:new ci(e)}class ci{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=ai(e),ai([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class li{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,S((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),n=t.itemCount,i=t.itemCount=s?s.length:void 0;i!==n&&(void 0===i?t.itemIndex=void 0:void 0===n&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(ii(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let n=0;for(const t of s.children)ri(t,"active",n===e),n++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const ui="miso-ui-icon",hi=ui+"-svg-1_12_0-beta_0",_i={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},di=`<symbol id="${ui}-${_i.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,pi=`<symbol id="${ui}-${_i.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,mi=`<symbol id="${ui}-${_i.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,n=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-n} ${n}L${n} ${t-n}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,fi=`<svg id="${hi}" style="display:none;">${[di,pi,mi,`<symbol id="${ui}-${_i.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${ui}-${_i.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${ui}-${_i.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let gi=!1;function yi(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${ui}-${e}"></use></svg>`}gi||document.head.querySelector("#"+hi)||(gi=!0,document.head.insertAdjacentHTML("beforeend",fi));const bi=new Set(Object.values(_i));yi(_i.SEND),yi(_i.SEARCH);const wi=yi(_i.TRIANGLE);yi(_i.TRIANGLE_EQ);const vi=yi(_i.CHEVRON),Ei=yi(_i.CHEVRON_NEGATIVE),Si="miso-carousel",ki=Object.freeze({body:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__viewport"><div class="${n}__viewport-inner">${i.list(e,t,s)}</div></div>${i.controls(e,t,s)}`},controls:function(e,t,s){const{templates:n}=e;return`${n.controlContainer(e,t,"previous")}${n.controlContainer(e,t,"next")}${n.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-container-${s}">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?Ei:vi},indexIndicator:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${n}__index-indicator-item">${i.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Ii=Object.freeze({...Jn.defaultTemplates,...ki});class Oi extends Jn{static get type(){return"carousel"}static get defaultTemplates(){return Ii}static get defaultClassName(){return Si}constructor({className:e=Si,templates:t,...s}={}){super({className:e,templates:{...ki,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){z(e,li.prototype)}(Oi.prototype);const xi="16rem",Ti=Object.freeze({...Jn.defaultTemplates,item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o,c=r[a](e,t,s,{index:n});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),Ci="miso-gallery";class Ai extends Jn{static get type(){return"gallery"}static get defaultTemplates(){return Ti}static get defaultClassName(){return Ci}constructor({className:e=Ci,templates:t,...s}={}){super({className:e,templates:{...Ti,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=s?void 0:this._bodyHtml(e),i=this._itemsHtml(e,t);return{...e,...h({incremental:s,bodyHtml:n,itemsHtml:i})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const n=this._renderListElement(e,t,s);n&&(this._syncListAspectRatio(n),this._renderItems(n,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:n}=t;return s||(e.innerHTML=n),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,n=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,n)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const n=e.children.length,i=this._writeItemSizes((this._getItems(t)||[]).slice(n),s,n);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,i,{offset:n}))}_writeItemSizes(e,[t=0,s=0]=[],n=0){let i=0;n>0&&(i=Math.min(n,t),n-=i,t-=i),n>0&&(i=Math.min(n,s),n-=i,s-=i);const r=[];for(const n of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),r.push({...n,_size:e})}return r}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=ai(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:n}=t,{height:i=xi}=this.options,r=oi(i),o=e.clientWidth;if(0===o)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(o*n.width*2/(r*n.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),n=e;const i=Math.min(Math.floor(s/3),n);n-=i,s-=3*i;const r=Math.min(s,n);return n-=r,s-=r,[i,r,n]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,n=0]=t;const{className:i}=this;for(const t of e.children){let e=!1,r=!1;s>0?(e=!0,s--):n>0&&(r=!0,n--),ri(t,i+"__item-large",e),ri(t,i+"__item-medium",r),ri(t,i+"__item-small",!e&&!r)}}}const Ri="miso-search-box";const $i=Object.freeze({root:function(e){const{className:t,templates:s,role:n,options:i,autocomplete:r}=e,{placeholder:o}=i;return`\n<div class="${t}" ${n?`data-role="${n}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=t;var r;return("function"==typeof n?n(e):""+n)+("function"==typeof i?i(e):(bi.has(r=i)?yi(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:n,autocomplete:i}=e;e={templates:s,workflow:n,...i};const r=[],o=[];for(const e of t)(e.product?r:o).push(e);return s.queries(e,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__${t}-list" data-role="${t}-list">${s.map((s=>i.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:n,templates:i}=e;return`\n<li class="${n}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${i[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||I(t)},product:function(e,{product:t}){const{templates:s}=e,[n,i]=s.helpers.tagPair(e,t,{role:!1});return""+n+s.imageBlock(e,t)+s.productInfoBlock(e,t)+i},imageBlock:Rn,productInfoBlock:bn}),Ni=Object.freeze({className:"miso-autocomplete",debounce:300});class Pi extends Dn{static get type(){return"search-box"}static get defaultTemplates(){return $i}static get defaultClassName(){return Ri}constructor({className:e=Ri,templates:t,autocomplete:s,...n}={}){super({className:e,templates:{...$i,...t},...n}),p(this,{autocomplete:{...Ni,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=j(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:n}){if(!t.completions)return;const{status:i=hs.INITIAL,session:r,value:o}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(o);ri(e,"nonempty",u.length>0),l.setAttribute("data-status",i),l.innerHTML=this.templates.completions(this,u),n({completions:{index:a,status:i}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return Li.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new Li(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&v(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let n=t;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const t=n.getAttribute("data-index"),i=this._context().data.get(parseInt(t)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[os.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class Li{static empty(){return Li._empty||(Li._empty=new Li)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,n=[];for(const i in e)for(const r of e[i])r.product&&!r.product.url||(r._index=t,r._field=i,s.set(t,r),n.push(r),t++);return n}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const Ui="miso-option-list";const qi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:n}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>n.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${I(t.text||t)}</li>`}});class ji extends Dn{static get type(){return"option-list"}static get defaultTemplates(){return qi}static get defaultClassName(){return Ui}constructor({className:e=Ui,templates:t,...s}={}){super({className:e,templates:{...qi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:n}=t;this._syncOptionValues(e,n)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;ri(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;n&&(this._trackClick(e,s),this._submit(n.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}Vn(ji.prototype);const Di=Object.freeze({...fn("options"),root:function(e){const{className:t,role:s,templates:n}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${n.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:n}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${n.content(e,t)}\n</div>\n`}});class Mi extends Dn{static get defaultTemplates(){return Di}constructor({className:e,templates:t,field:s,defaultValue:n,...i}={}){super({className:e,templates:{...Di,...t},...i}),this._field=s,this._defaultValue=n}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=v(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=t.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],S((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:n}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",n),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const zi="miso-feedback",Fi=["helpful","unhelpful"];const Bi=Object.freeze({options:function(e){const{templates:t}=e;return Fi.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:n,options:i={}}=e;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(e,t)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Qi extends Mi{static get type(){return"feedback"}static get defaultTemplates(){return Bi}static get defaultClassName(){return zi}constructor({className:e=zi,templates:t,...s}={}){if(super({className:e,templates:{...Bi,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Gi="miso-text";const Hi=Object.freeze({root:function(e,{value:t}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=e,o=n?`data-role="${n}"`:"",a=void 0!==t?I(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:n}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[i,r]=t;switch(i){case"date":return e=>s(e,r);case"number":return e=>n(e,r);default:return e=>""+e}}(e)(t)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Wi extends Dn{static get type(){return"text"}static get defaultTemplates(){return Hi}static get defaultClassName(){return Gi}constructor({className:e=Gi,templates:t,tag:s="p",...n}={}){super({className:e,templates:{...Hi,...t},tag:s,...n})}}class Vi extends mn{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=C(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Ki{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=t.substring(0,s),l=!n.startsWith(c);return a||l?e.innerText=n:e.insertAdjacentText("beforeend",n.substring(s,i)),a&&e.classList.add("done"),{cursor:i,done:a}}}function Yi(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=e;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[t,Zi(t)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(e));const n=t.children[0];return n.setAttribute("data-status",s||hs.INITIAL),n}function Zi(e){return e+"__cursor"}function Ji(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Xi(n[0])}, ${Xi(n[1])})`,t,""+r,i,o)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Xi(e){return Math.floor(100*e)/100+"ms"}const er="miso-typewriter";class tr extends Vi{static get type(){return"typewriter"}static get defaultClassName(){return er}constructor({className:e=er,tag:t="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:t,format:s,tooltip:n,...a}),p(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:G({speed:i,acceleration:r}),this._readiness=new R,"markdown"===s&&tr.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=Zi(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:n,onDebug:Ji(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Ki}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=e,a=n&&n.answer_stage||"result",c=(u=e,(l=t)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const _=t?c&&a===t.stage?t.streak:t.streak+1:0,d=c&&t&&t.doneAt||(r!==hs.READY||o?void 0:Date.now());return this._prevState=Object.freeze(h({session:i,status:r,value:s,stage:a,streak:_,doneAt:d,done:void 0!==d}))}_render(e,{state:t,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=Yi(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(o,s,{...t,cursor:e})}i(a);const l=t.status===hs.READY&&!a.done;n({ongoing:l},{silent:l&&(!s||s.status===hs.READY)&&!c}),l&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const n=t.closest("a");if(n){if(!e.defaultPrevented){const{href:t,innerText:s,className:i}=n;t&&this._view._events.emit("link-click",h({event:e,url:t,text:s?s.trim():"",className:i||"",attributes:sr(n)}))}}else;}}function sr(e){const{attributes:t}=e,s={};for(const{name:e,value:n}of t)e.startsWith("data-")&&(s[e]=n);try{return JSON.stringify(s)}catch(e){return"{}"}}const nr="miso-affiliation";const ir=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i,options:r}=e,{status:o}=t,a=n?` data-role="${n}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${o}"${a}${l}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${o===hs.READY?i[o](e,t):""}</div>`},[hs.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t);return n&&n.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}-container">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return wi},body:function(e,t){const{className:s,templates:n}=e,i=e._getItems(t);return`<div class="${s}__body">${n.list(e,t,i)}</div>`},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(e,t,s,{index:n})}${r[a](e,t,s,{index:n})}</div></li>`},itemHeader:function(e,t,s,n){const{className:i,templates:r}=e;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=jn.asFunction(o)(e,t,s,n),a=jn.asFunction(a)(e,t,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,n){const{templates:i}=e,[r,o]=Pn(e,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||yn)(e,s,n)+(i.imageBlock||Rn)(e,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,n){const{className:i,templates:r}=e,o=jn.asFunction(r.logoText)(e,t,s,n)||"",a=jn.asFunction(r.logoImg)(e,t,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(e,t,s,n){const{className:i,templates:r}=e,o=jn.asFunction(r.logoUrl)(e,t,s,n);if(!o)return"";const a=jn.asFunction(r.logoAltText)(e,t,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),rr=Object.freeze({...Jn.defaultTemplates,...ir});class or extends Jn{static get type(){return"affiliation"}static get defaultTemplates(){return rr}static get defaultClassName(){return nr}constructor({className:e=nr,templates:t,autoplay:s,...n}={}){super({className:e,itemType:"affiliation",templates:{...ir,...t},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new te(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,S((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(ii(n,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const ar="miso-facets",cr="miso-facet",lr="custom_attributes.";const ur=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:n={}}=t.value||{};return Object.keys(n).map((i=>s.facet(e,{field:i,entries:n[i]},t)))},facet:function(e,t,s){const{facetClassName:n=cr,templates:i}=e,{field:r}=t;return`<div class="${n}" data-role="facet" data-field="${I(r)}">${i.header(e,t,s)}${i.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:n=cr,templates:i}=e;return`<div class="${n}__header">${i.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(lr)&&(t=t.substring(18)),I(t)},options:function(e,{field:t,entries:s},n){const{facetClassName:i=cr,templates:r}=e;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(e,{field:t,value:s,count:i},n))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:n=cr,templates:i}=e;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(e,t,s)}</span>\n  <span class="${n}__count">${i.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return I(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function hr(e,t){return`${e}:::${t}`}function _r(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class dr extends Dn{static get type(){return"facets"}static get defaultTemplates(){return ur}static get defaultClassName(){return ar}constructor({className:e=ar,templates:t,...s}={}){super({className:e,templates:{...ur,...t},...s}),this._bindings=new Wn}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=_r(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)this._setSelected(n,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=_r(e.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)t[e]&&this._setSelected(n,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),n=[],i=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),o=s[e];if(!o)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=o[t];if(!c)break;n.push(hr(e,c)),i.push({field:e,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[I(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const pr="miso-select";const mr=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e,r=n?`data-role="${n}"`:"",o=e._getItems(t),a=o.find((e=>e.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(e,a)}\n  ${i.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:n}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:n}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>n.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:n}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${n.text(e,t)}</li>`},text:function(e,t){return I(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,((e,t)=>" "+t))||t||"")}});class fr extends Dn{static get type(){return"select"}static get defaultTemplates(){return mr}static get defaultClassName(){return pr}constructor({className:e=pr,templates:t,...s}={}){super({className:e,templates:{...mr,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}Vn(fr.prototype);const gr="miso-more-button";const yr=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${t.status!==hs.READY?" disabled":""}>\n  ${i.text(e)}\n</div>\n`},text:function(e){return"More"}});class br extends Dn{static get type(){return"more-button"}static get defaultTemplates(){return yr}static get defaultClassName(){return gr}constructor({className:e=gr,templates:t,...s}={}){super({className:e,templates:{...yr,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var wr=Object.freeze({__proto__:null,TemplateBasedLayout:Dn,ContainerLayout:Fn,ErrorLayout:Qn,BannerLayout:class extends Dn{static get type(){return"banner"}static get defaultTemplates(){return Gn}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Gn,...t},...s})}},CollectionLayout:Jn,ListLayout:ei,HorizontalLayout:si,CardsLayout:class extends Jn{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ni}constructor({className:e=ni,...t}={}){super({className:e,...t})}},CarouselLayout:Oi,GalleryLayout:Ai,SearchBoxLayout:Pi,OptionListLayout:ji,FeedbackLayout:Qi,TextLayout:Wi,TypewriterLayout:tr,AffiliationLayout:or,FacetsLayout:dr,SelectLayout:fr,MoreButtonLayout:br});function vr(e){return e&&e.value&&e.value.revision}function Er(e){const t=function(e){if(!e)return hs.INITIAL;const{request:t,error:s,value:n}=e;return s?hs.ERRONEOUS:n?hs.READY:t?hs.LOADING:hs.INITIAL}(e);return h({status:t,ongoing:t===hs.READY?e.ongoing:void 0,...e})}function Sr(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:n}=s;n&&(t.meta.miso_id=n)}function kr(e){const{request:t,value:s}=e;if(!t)return e;const{payload:n}=t||{},{q:i}=n||{};return i?{...e,value:{...s,keywords:i}}:e}function Ir(e){const{role:t,type:s,items:n}=e,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:h({property:t})}};switch(function(e){return ls.has(e)}(s)&&(!function(e){return rs.has(e)}(t)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((e=>e.text||e.id||e))):i.product_ids=(n||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case os.SUBMIT:i.context.custom_context.value=e.value;break;case os.FEEDBACK:i.context.custom_context.value=i.value=e.value,i.context.custom_context.result_type=i.result_type=e.result_type}return h(i)}function Or(e={},t={}){return h({...e,...t,context:h({...e.context,...t.context,custom_context:h({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const xr=Object.freeze({}),Tr=Object.freeze({[ss.CONTAINER]:Fn.type,[ss.ERROR]:Qn.type}),Cr=Object.freeze({}),Ar=Object.freeze({api:xr,layouts:Tr,trackers:Cr}),Rr=Object.freeze({mappings:{[ss.ERROR]:e=>e.error}});class $r extends X{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:n,defaults:i,options:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=n=n||t._client,e=Object.freeze({...e,plugin:s,client:n}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=r||new Is(t&&t._options,i),this._hub=new Us({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,n._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new qs(s),this._data=new Ds(s,{source:pn(n),options:i}),this._views=new ln(s,{extensions:r,layouts:o,roles:t,options:i,workflow:e}),this._interactions=new dn(s,{client:n,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(Ls(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:n}){n||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[Ls(e)]||{};t.session&&t.status===hs.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===hs.READY,n=t===hs.ERRONEOUS;this._emitLifecycleEvent(n?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||n)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(e);return n.add(e),!i}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Zt(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=vr(e);if(!_(s)){const e=vr(this._hub.states.data);if(!_(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=Er(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:hs.READY,session:this.session,...t},this._hub.update(Ls(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=Ir(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)t=n(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==ss.AFFILIATION)return e;const{items:s}=t;return Or(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return Or(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[Ls(t.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?Or(e,{miso_id:n}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function Nr(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Pr(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:n}=t;if(!n)return e;n=n.map((e=>({...e})));let i=0;for(const e of n)s&&(e.channel=s),e.position=i++;return{...e,affiliation:{...t,products:n}}}(e)}function Pr({products:e,...t}){return{channel:"sovrn",...t,products:e.map(Lr)}}function Lr({id:e,deeplink:t,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:l,merchant:u,..._}){return h({id:"sovrn-"+e,title:s,description:n,cover_image:c,url:t,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:u&&u.name,brand_logo:u&&u.logo,custom_attributes:Ur({sovrn_id:e,thumbnail:l,merchant:u,..._})})}function Ur(e,t=""){return Object.keys(e).reduce(((s,n)=>{const i=e[n];if(void 0===i)return s;const r=t?`${t}_${n}`:n;return"object"==typeof i?{...s,...Ur(i,r)}:{...s,[r]:i}}),{})}function qr(e){z(e,jr.prototype)}Cs($r.prototype),Object.assign($r,{DEFAULT_API_OPTIONS:xr,DEFAULT_LAYOUTS:Tr,DEFAULT_TRACKERS:Cr,DEFAULT_OPTIONS:Ar,ROLES_OPTIONS:Rr});class jr{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=t;else{window.open(t,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const Dr=Object.freeze({...$r.DEFAULT_API_OPTIONS,group:r.ASK,payload:{...$r.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Mr=Object.freeze({actor:!1,api:{group:r.ASK,name:o.AUTOCOMPLETE}}),zr=Object.freeze({...$r.DEFAULT_LAYOUTS,[ss.QUERY]:[Pi.type,{placeholder:"Ask a question"}],[ss.QUESTION]:[Wi.type,{tag:"h2"}],[ss.ANSWER]:tr.type,[ss.FEEDBACK]:Qi.type,[ss.IMAGES]:[Ai.type,{incremental:!0,itemType:"image"}],[ss.SOURCES]:[ei.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[ss.AFFILIATION]:[or.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Fr=Object.freeze({...$r.DEFAULT_TRACKERS,[ss.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:ys.click},[ss.IMAGES]:ys,[ss.SOURCES]:ys,[ss.AFFILIATION]:ys,[ss.PRODUCTS]:ys}),Br=Object.freeze({...$r.DEFAULT_OPTIONS,api:Dr,autocomplete:Mr,layouts:zr,trackers:Fr}),Qr=Wt($r.ROLES_OPTIONS,{main:ss.ANSWER,members:Object.keys(zr)});class Gr extends $r{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new _n(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(ss.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(ss.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[Ls(this._roles.main)]||{};e.session&&e.status!==hs.INITIAL&&(e.status!==hs.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,n=t===hs.READY&&!e.ongoing,i=t===hs.ERRONEOUS,r=n?"done":i?"error":t,o=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,e),(n||i)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){Ns.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||ts}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==Rs?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:Nr(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_updateUrlIfNecessary({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:n}=this._autoQuery,i=e&&e.question||t&&t.payload&&t.payload.question,r=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source;if(!i)return;const o=new URL(window.location),a=o.searchParams.get(s),c=o.searchParams.get(n)||ts;i===a&&r===c||(o.searchParams.set(s,i),r===ts?o.searchParams.delete(n):o.searchParams.set(n,r),window.history.replaceState({},"",o))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=function(e,{event_target:t}={}){return t?Or(e,{context:{custom_context:{event_target:t}}}):e}(e=this._writeAnswerClickInteraction(e,t),t)}_writeAskPropertiesToInteraction(e={},t){return Or(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==ss.ANSWER)return e;const{items:s=[]}=t;return Or(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[Ls(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e,event:t}){if(rn(t))return;const{value:s}=this.states.data||{},{sources:n}=s||{},i=n&&n[e-1];i&&i.product_id&&(on(t),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){rn(e)||(on(e),this._views.trackers.answer.click([],{items:[t]}))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}qr(Gr.prototype),Object.assign(Gr,{DEFAULT_API_OPTIONS:Dr,DEFAULT_AUTOCOMPLETE_OPTIONS:Mr,DEFAULT_LAYOUTS:zr,DEFAULT_TRACKERS:Fr,DEFAULT_OPTIONS:Br,ROLES_OPTIONS:Qr});const Hr=Object.freeze({...Gr.DEFAULT_API_OPTIONS,name:o.QUESTIONS,payload:{...Gr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Wr=Object.freeze({...Gr.DEFAULT_LAYOUTS,[ss.QUERY]:[Pi.type,{templates:{buttonIcon:"send"}}],[ss.RELATED_RESOURCES]:[ei.type,{incremental:!0,itemType:"article"}],[ss.QUERY_SUGGESTIONS]:ji.type}),Vr=Object.freeze({...Gr.DEFAULT_TRACKERS,[ss.RELATED_RESOURCES]:ys,[ss.QUERY_SUGGESTIONS]:{...ys,click:{...ys.click,validate:e=>0===e.button}}}),Kr=Object.freeze({...Gr.DEFAULT_OPTIONS,api:Hr,layouts:Wr,trackers:Vr}),Yr=Wt(Gr.ROLES_OPTIONS,{members:Object.keys(Wr)});class Zr extends Gr{constructor(e,t){super({name:"ask",context:e,roles:Yr,defaults:Kr,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;p(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:n}=this;let i=h({...s,question:e,parent_question_id:n,_meta:{...s._meta,question_source:t||ts}});return i=this._writeWikiLinkTemplateToPayload(i),i}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let n,i,r,{property:o}=e.context&&e.context.custom_context||{};return t.role===ss.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(t)),Or(e,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class Jr extends Ps{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Zr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Zr(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const Xr=Object.freeze({...$r.DEFAULT_API_OPTIONS,group:r.SEARCH,payload:{...$r.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),eo=Object.freeze({...$r.DEFAULT_LAYOUTS,[ss.QUERY]:[Pi.type],[ss.PRODUCTS]:[ei.type,{incremental:!0,infiniteScroll:!0}],[ss.KEYWORDS]:[Wi.type,{raw:!0}],[ss.TOTAL]:[Wi.type,{raw:!0,format:"number"}],[ss.FACETS]:[dr.type],[ss.SORT]:[fr.type],[ss.MORE]:[br.type]}),to=Object.freeze({...$r.DEFAULT_TRACKERS,[ss.PRODUCTS]:ys}),so=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),no=Object.freeze({...$r.DEFAULT_OPTIONS,api:Xr,layouts:eo,trackers:to,pagination:so}),io=Wt($r.ROLES_OPTIONS,{main:ss.PRODUCTS,members:Object.keys(eo),mappings:{[ss.FACETS]:"facet_counts",[ss.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=t.states.filters||{},r=i&&i.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(n).field;return r?n.map((e=>({...e,selected:e.field===r}))):n}}});class ro extends $r{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(ss.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){Ns.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this._views.filters.reset({silent:!0}),this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==hs.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:n}=t||{};return h({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const n=e[s];n&&n.length&&(t[s]={terms:n})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return l(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},n=s.map((e=>e.product_id)).filter((e=>e)),i=[...e.exclude||[],...n];return 0===i.length?e:{...e,exclude:i}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:n}=e;switch(s){case hs.INITIAL:case hs.LOADING:break;default:return e}return n&&n.facet_counts?e:{...e,value:{...n,facet_counts:t}}}(e=kr(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=ss.PRODUCTS}={}){const{status:s,request:n,value:i}=e;if(s!==hs.READY||!n||!i)return e;const{[t]:r}=i;if(!r)return e;const{rows:o}=n.payload,{length:a}=r;return o>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=ss.PRODUCTS}={}){if(!t.value)return e;const{[s]:n=[],facet_counts:i,total:r}=e.value,{[s]:o=[]}=t.value;return{...t,value:{...t.value,facet_counts:i,total:r,[s]:[...n,...o]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}Cs(ro.prototype,[ds.PAGINATION,ds.FILTERS]),Object.assign(ro,{DEFAULT_API_OPTIONS:Xr,DEFAULT_LAYOUTS:eo,DEFAULT_TRACKERS:to,DEFAULT_PAGINATION:so,DEFAULT_OPTIONS:no,ROLES_OPTIONS:io});const oo=Object.freeze({members:[]});function ao({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function co(e){return e&&e.value&&e.value.trim()||void 0}class lo extends $r{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:ao(t),roles:oo,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,co(e)===co(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!co(e))return void this._updateCompletions({session:s,status:hs.INITIAL});const n=this._buildPayload(e);this._request({payload:n})}_buildPayload(e){return{q:co(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function uo(e){z(e,ho.prototype)}class ho{_initAutocomplete(e){this._autocomplete=new lo(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const _o=Wt(Gr.ROLES_OPTIONS,{mappings:{[ss.QUESTION]:ss.KEYWORDS}});class po extends Gr{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:_o,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset({silent:!0}),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._writeWikiLinkTemplateToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||ts}}}_defaultProcessData(e){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:n}={}}=t;return n?{...e,meta:{...e.meta,miso_id:n}}:e}(e=kr(e=super._defaultProcessData(e))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_updateDataInHub(e){switch(e.status){case hs.INITIAL:case hs.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),Sr(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}uo(po.prototype);const mo={...ro.ROLES_OPTIONS,members:[ss.PRODUCTS,ss.KEYWORDS,ss.TOTAL,ss.FACETS,ss.SORT,ss.MORE,ss.ERROR]};class fo extends ro{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:mo,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:h({...e._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(e){return Sr(e=super._defaultProcessData(e)),e}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}}Object.assign(fo,{ROLES_OPTIONS:mo});class go{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return fo.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,n=this._getSubviews(s);if(!n._containers.has(e)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(e)){for(const n of e.components)if(s.containsElement(n))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}n.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const yo=Object.freeze({group:r.ASK,name:o.SEARCH,payload:{...Gr.DEFAULT_API_OPTIONS.payload,...ro.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),bo=Object.freeze({...Gr.DEFAULT_LAYOUTS,...ro.DEFAULT_LAYOUTS,[ss.QUERY]:[Pi.type,{placeholder:""}],[ss.QUESTION]:[Wi.type,{raw:!0}],[ss.SOURCES]:[si.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:gn,articleInfoBlock:vn}}]}),wo=Object.freeze({...Gr.DEFAULT_TRACKERS,...ro.DEFAULT_TRACKERS}),vo=Object.freeze({...ro.DEFAULT_PAGINATION,active:!0}),Eo=Object.freeze({api:{group:r.ASK,name:o.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),So=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),ko=Object.freeze({...Gr.DEFAULT_OPTIONS,...ro.DEFAULT_OPTIONS,api:yo,layouts:bo,trackers:wo,autocomplete:Eo,pagination:vo,filters:So}),Io=Object.freeze({main:ss.PRODUCTS,members:Object.keys(bo),mappings:Object.freeze({...Gr.ROLES_OPTIONS.mappings,...ro.ROLES_OPTIONS.mappings})});class Oo extends $r{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Io,defaults:ko})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new po(this),this._results=new fo(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){this._views=new go(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return e=this._answer._defaultProcessInteraction0(e,t),e=this._results._defaultProcessInteraction0(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}Cs(Oo.prototype,[ds.PAGINATION,ds.FILTERS]);const xo=Object.freeze({group:r.SEARCH,name:o.SEARCH,payload:{fl:["*"]}}),To=Object.freeze({api:{group:r.SEARCH,name:o.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Co=Object.freeze({...ro.DEFAULT_LAYOUTS}),Ao=Object.freeze({...ro.DEFAULT_TRACKERS}),Ro=Object.freeze({...ro.DEFAULT_OPTIONS,api:xo,autocomplete:To,layouts:Co,trackers:Ao}),$o=ro.ROLES_OPTIONS;class No extends ro{constructor(e,t){super({name:"search",plugin:e,client:t,roles:$o,defaults:Ro})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=ss.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}uo(No.prototype);class Po extends Ps{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=es){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=es){return this._members.has(e)}get(e=es){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class Lo extends $r{_initProperties(e){super._initProperties(e);const{id:t}=e;p(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return Or(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign(Lo,{DEFAULT_API_OPTIONS:$r.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:$r.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:$r.DEFAULT_TRACKERS,DEFAULT_OPTIONS:$r.DEFAULT_OPTIONS,ROLES_OPTIONS:$r.ROLES_OPTIONS});const Uo=Object.freeze({...Lo.DEFAULT_API_OPTIONS,group:r.RECOMMENDATION,name:o.USER_TO_PRODUCTS,payload:{...Lo.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),qo=Object.freeze({...Lo.DEFAULT_LAYOUTS,[ss.PRODUCTS]:ei.type}),jo=Object.freeze({...Lo.DEFAULT_TRACKERS,[ss.PRODUCTS]:ys}),Do=Object.freeze({...Lo.DEFAULT_OPTIONS,api:Uo,layouts:qo,trackers:jo}),Mo=Wt(Lo.ROLES_OPTIONS,{main:ss.PRODUCTS,members:Object.keys(qo)});class zo extends Lo{constructor(e,t){super({name:"recommendation",context:e,roles:Mo,defaults:Do,id:t})}start(){return this._request(),this}notifyViewUpdate(e=ss.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class Fo extends Po{constructor(e,t){super("recommendations",e,t)}_create(e){return new zo(this,e)}}const Bo=Object.freeze({...Lo.DEFAULT_API_OPTIONS,group:r.ASK,name:o.RELATED_QUESTIONS}),Qo=Object.freeze({...Lo.DEFAULT_LAYOUTS,[ss.RELATED_QUESTIONS]:[ei.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[ss.QUERY]:[Pi.type,{placeholder:"Ask a question"}]}),Go=Object.freeze({...Lo.DEFAULT_TRACKERS,[ss.RELATED_QUESTIONS]:ys,[ss.CONTAINER]:{...ys,itemless:!0},[ss.QUERY]:{[os.SUBMIT]:{active:!0}}}),Ho=Object.freeze({...Lo.DEFAULT_OPTIONS,api:Bo,layouts:Qo,trackers:Go}),Wo=Wt(Lo.ROLES_OPTIONS,{main:ss.RELATED_QUESTIONS,members:Object.keys(Qo)});class Vo extends Lo{constructor(e,t){super({name:"explore",context:e,roles:Wo,defaults:Ho,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(ss.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return jr.prototype.useLink.call(this,e,t),t&&this.useLayouts({[ss.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=ss.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=jr.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}qr(Vo.prototype);class Ko extends Po{constructor(e,t){super("explores",e,t)}_create(e){return new Vo(this,e)}}class Yo extends X{constructor({name:e,plugin:t,MisoClient:s,...n}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new R)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var Zo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var Jo=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Xo{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class ea{constructor(e){this._context=e,p(this,{lowerCamelToKebab:g,kebabToLowerCamel:m,kebabOrSnakeToLowerCamel:f})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...n}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=f(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:n=!1}){const{classPrefix:i}=e;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${t}-phrase">${this.phraseText(e,m(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,n=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof n){case"function":return n(e);case"string":return n;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${e}__${n}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const n=t[e];void 0!==n&&(s+=` ${g(e)}="${n}"`)}return s}}const ta=F(new ea({...Zo,DEFAULT_PHRASES:Jo})),sa=F(new class extends Xo{constructor(){super({helpers:ta})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=e;return n(e,{name:"related-resources"},!1===i.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:n={}}=e;return!1===n.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:ta}));function na(e={}){const{normalizeOptions:t,section:s,container:n}=ta,{querySuggestions:i,answerGroup:r}=sa;return s(e=t(e),{name:"follow-up"},[i(e),n(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(e)])}var ia=Object.freeze({__proto__:null,helpers:ta,sections:sa,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=ta,{followUps:i,relatedResourcesSection:r,answerGroup:o}=sa;return""+s(e=t(e),{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},o(e))+i(e)+r(e)},followUp:na});const ra=Object.freeze(Zo),oa=Object.freeze(Jo),aa=Object.freeze(ia);var ca=Object.freeze({__proto__:null,constants:ra,phrases:oa,templates:aa,wireFollowUps:function(e,t,{template:s=na,...n}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const i=e.ui.asks,r=e.ui.ask;i.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:e.workflow.questionId}))})),r.on("loading",(()=>{t.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:la}=document,ua=Object.freeze({templates:aa,autostart:!0}),ha=["templates","phrases","features"];class _a{constructor(){this._defaults=ua,this._scriptSrc=function(){if(!la||!la.src)return{};const e=document.createElement("a");e.href=la.src;const t={};for(const[s,n]of new URLSearchParams(e.search))"q"!==s&&(t[s]=ma(n));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=ma(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:n,...i}={}){return h({apiKey:e,apiHost:t,templates:fa(s),phrases:n,...i})}(da(this._defaults,this._scriptSrc,e,this._pageUrl))}}function da(...e){let t={};for(const s of e)s&&(t=pa(t,s));return t}function pa(e,t){if(!t)return e;Object.assign(e,t);for(const s of ha)s in t&&(e[s]={...e[s],...t[s]});return e}function ma(e){return""===e||"false"!==e&&e}function fa(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(fa):function(e,t){const s={};for(const[n,i]of Object.entries(e))s[n]=t(i);return s}(e,fa);default:throw Error("Unsupported template type: "+e)}}class ga{constructor(e,{classPrefix:t=ra.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");p(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class ya extends Yo{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new _a,this._localOptions={}}config(e={}){e=da(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;p(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new ga(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=e.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(t,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),l.autoQuery()}}class ba extends ee{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let wa,va,Ea;async function Sa(e){const t=await async function(e){return e.MisoClient||window.MisoClient||wa||(wa=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return va=va||t.any(),Ea=Ea||await va,Ea.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),Ea}const ka="logo",Ia="auto",Oa=Object.freeze([ka]);function xa(e){if(!e)return Ia;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class Ta extends HTMLElement{static get observedAttributes(){return Oa}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return xa(this.getAttribute(ka))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Ia:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(ka,t):this.removeAttribute(ka)}async connectedCallback(){const e=this._client=await Sa(Ta);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===ka)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){xa(e)!==xa(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const Ca="parent-question-id",Aa=Object.freeze([...Ta.observedAttributes,Ca]);const Ra="unit-id",$a=Object.freeze([...Ta.observedAttributes,Ra]);class Na extends Ta{static get observedAttributes(){return $a}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute(Ra)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(Ra,e):this.removeAttribute(Ra)}attributeChangedCallback(e,t,s){if(e===Ra)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var Pa=Object.freeze({__proto__:null,MisoAskElement:class extends Ta{static get tagName(){return"miso-ask"}static get observedAttributes(){return Aa}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Ca)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(Ca,e):this.removeAttribute(Ca))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===Ca)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Na{static get tagName(){return"miso-explore"}static get observedAttributes(){return Na.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends Ta{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Ta.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends Ta{static get tagName(){return"miso-search"}static get observedAttributes(){return Ta.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Na{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Na.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const La="role",Ua=Object.freeze([La]);class qa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Ua}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(La);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${La}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${La}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===La&&this._container&&this._container._updateComponentRole(this,t,s)}}var ja=Object.freeze({__proto__:null,MisoComponentElement:qa,MisoQueryElement:class extends qa{constructor(){super({role:ss.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends qa{constructor(){super({role:ss.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends qa{constructor(){super({role:ss.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends qa{constructor(){super({role:ss.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends qa{constructor(){super({role:ss.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends qa{constructor(){super({role:ss.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends qa{constructor(){super({role:ss.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends qa{constructor(){super({role:ss.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends qa{constructor(){super({role:ss.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends qa{constructor(){super({role:ss.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends qa{constructor(){super({role:ss.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends qa{constructor(){super({role:ss.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends qa{constructor(){super({role:ss.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends qa{constructor(){super({role:ss.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends qa{constructor(){super({role:ss.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends qa{constructor(){super({role:ss.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends qa{constructor(){super({role:ss.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends qa{constructor(){super({role:ss.ERROR})}static get tagName(){return"miso-error"}}});class Da extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Da.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Ma=Object.freeze({__proto__:null,containers:Pa,roles:ja,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Da{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Mn});const za="miso-hybrid-search-combo";var Fa=Object.freeze({__proto__:null,CLASS_PREFIX:za,CONAINER_TAG:"miso-hybrid-search"});const Ba="Show more",Qa="Show less";var Ga=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:Ba,showLess:Qa});const Ha=F(new ea({...Fa,DEFAULT_PHRASES:Ga})),Wa=F(new class extends Xo{constructor(){super({helpers:Ha})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Ha}));var Va=Object.freeze({__proto__:null,helpers:Ha,sections:Wa,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=Ha;e=t(e);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=Wa,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[i(e)]:r(e))+s(e,{name:"search-results"},o(e))}});const Ka="answer-box-open",Ya="answer-box-shown",Za='[data-role="answer-box-toggle"]';class Ja{constructor(e,t,{classPrefix:s=za,phrases:n={},hideWhenUnanswerable:i=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=n,this._hideWhenUnanswerable=i,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Za)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case hs.ERRONEOUS:case hs.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||Qa:this._phrases.showMore||Ba;for(const t of this._element.querySelectorAll(Za))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const Xa={isOpen:Ka,shown:Ya},ec={toggleOpen:["toggle",Ka],open:["open",Ka],close:["remove",Ka],toggleHidden:["toggle",Ya],show:["add",Ya],hide:["remove",Ya]};for(const[e,t]of Object.entries(Xa))Object.defineProperty(Ja.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(ec))Ja.prototype[e]=function(){this._updateBoxStatus(t,s),s===Ka&&(this._syncButtonText(),this._syncScroll())};const tc=Object.freeze(Fa),sc=Object.freeze(Ga),nc=Object.freeze(Va);var ic=Object.freeze({__proto__:null,constants:tc,phrases:sc,templates:nc,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new Ja(e,t,s)}});const rc=Object.freeze(ca),oc=Object.freeze(ic);var ac=Object.freeze({__proto__:null,ask:rc,hybridSearch:oc});const cc="ui";let lc,uc;async function hc(){return uc||(uc=L(lc||(lc=U(cc))))}class _c{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class dc{constructor(e,t){this._plugin=e,this._client=t,p(this,{sources:{api:pn(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new No(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Oo(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class pc{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new ya(this._plugin,this._MisoClient))}}async function mc(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(kt,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||t.debug;n&&kt.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&kt.plugins.use("std:dry-run");return window.MisoClientSA=kt,kt}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const n=window.misoSA=new t(s);return n.context.anonymous_id=await ye(),n}(e,{MisoClient:t});return await s.ui.ready,[t,s]}let fc;async function gc(){return fc||(fc=async function(){const[[e,t]]=await Promise.all([mc(Ge),re(Ge)]);return{MisoClient:e,client:t}}())}kt.plugins.use(class extends X{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new ba(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new R}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:ac};d(s,this,["layouts","combo","ready"]),p(this,{MisoClient:e}),p(e,{ui:s}),this.combo=new pc(this,e);const n=Object.values(wr).filter((e=>e.type));for(const t of n)t.MisoClient=e;for(const e of n)this.layouts.register(e);const{containers:i,roles:r,combos:o,...a}=Ma,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];Ta.MisoClient=e,Da.MisoClient=e;for(const t of c)t.MisoClient=e;await hc();for(const e of c)E(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){p(e,{ui:new dc(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new _c(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Fo(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new Ko(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new Jr(this,e)),t}});const yc='<svg fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',bc='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',wc='<svg fill="currentColor" viewBox="0 0 24 24">\n<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z"/>\n</svg>',vc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Ec='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function Sc(e,t,s={}){const{className:n}=e,{cover_image:i,title:r}=t;if(!i)return"";return`<div class="${n}__item-cover-image-container" aria-hidden="true">${`<img class="${n}__item-cover-image" src="${i}" alt="${r}">`}</div>`}function kc({className:e},{title:t}){let s="";return t&&(s+=`<div class="${e}__item-title">${t}</div>`),`<div class="${e}__item-info-container">${s}</div>`}function Ic(e){if(!e)return"";const{origin:t,hostname:s}=new URL(e);return`\n<div class="miso-list__item-brand-label">\n  <img class="miso-list__item-brand-logo" src="https://www.google.com/s2/favicons?sz=24&amp;domain=${t}">\n  <span>${s.replace(/^www\./,"")}</span>\n</div>\n`}Object.freeze({ordered:!0,article:function(e,t,s,n){const{templates:i}=e,[r,o]=i.helpers.tagPair(e,s);return""+r+Sc(e,s,n)+kc(e,s)+i.indexBlock(e,s,n)+o},infoBlock:kc}),Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,created_at:n,updated_at:i,published_at:r,url:o}){const a=r||n||i;let c=`<div class="${e}__item-main-block">`;t&&(c+=`<div class="${e}__item-title">${t}</div>`);s&&(c+=`<div class="${e}__item-snippet">${s}</div>`);c+=`<div class="${e}__item-meta-group">${Ic(o)}`,a&&(c+=`<div class="${e}__item-dot"></div><div class="${e}__item-date">${function(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}(a)}</div>`);return c+="</div></div>",`<div class="${e}__item-info-container">${c}</div>`},imageBlock:Sc});const Oc="header #miso-search",xc="#siteSearch-open-button";function Tc(e){const{searchParams:t}=new URL(window.location.href);return t.set("q",e),"/search/?"+t}async function Cc(e){const t=document.querySelector(Oc);if(!t)return;const s=document.querySelector(xc);if(e.page.type===Ne)return void(s&&s.addEventListener("click",(()=>{const e=document.querySelector("#siteSearch-close-button");e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()})));const{client:n}=await gc(),i=n.ui.hybridSearch;i.useLink(Tc,{open:!1}),i.autocomplete.enable(),t.classList.add("miso-hybrid-search-input"),t.innerHTML=`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${vc}</span>\n        <input class="miso-search-box__input" placeholder="What are you searching for?" type="text" autocomplete="off" data-role="input">\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Ec}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}const{currentScript:Ac}=document;async function Rc({}){await Promise.all([Nc()])}let $c=!1;async function Nc(){if($c)return;if($c=!0,!Ac)throw Error("currentScript not found");const e=Ac.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}var Pc={queryButton:"A.I. Search",home:{title:"Smart Answers from ${name}",queryPlaceholder:"Ask us a question",info:"What is this?"},story:{title:{nonempty:"Explore frequently asked questions",empty:"Explore with a question"},queryPlaceholder:{nonempty:"Ask your own question...",empty:"Ask a question..."}},answers:{title:"Smart Answers",subtitle:"Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.",feedback:{helpful:"Helpful",unhelpful:"Not Helpful"},sources:"My reply is based on the following",relatedResources:"Go beyond, and learn more about this topic",querySuggestions:"Related questions you can explore",followUp:{queryPlaceholder:"Ask a follow-up question",queryButton:"Ask"},affiliation:{title:"Best Prices Today: ${title}"},error:{title:"Oops!",description:"We are currently experiencing some difficulties. Would you please trying again later?"}},sponsor:{phrase:"Supported by",tooltip:"Our sponsors help keep Smart Answers running,<br>but do not influence our editorial independence."}},Lc=Object.freeze({__proto__:null,default:Pc,queryButton:Pc.queryButton,home:Pc.home,story:Pc.story,answers:Pc.answers,sponsor:Pc.sponsor}),Uc={queryButton:"KI-Suche",home:{title:"Smart Answers von ${name}",queryPlaceholder:"Stellen Sie uns eine Frage",info:"Was ist das?"},story:{title:{nonempty:"Hufig gestellte fragen entdecken",empty:"Hufig gestellte fragen entdecken"},queryPlaceholder:{nonempty:"Stellen Sie Ihre eigene Frage...",empty:"Stellen Sie Ihre eigene Frage..."}},answers:{title:"Smart Answers",subtitle:"Erhalten Sie Antworten auf Ihre Technikfragen durch KI, die ausschlielich auf Berichten und Tests unserer Experten basieren.",feedback:{helpful:"Hilfreich",unhelpful:"Nicht hilfreich"},sources:"Meine Antwort basiert auf folgenden Inhalten",relatedResources:"Erfahren Sie mehr ber dieses Thema",querySuggestions:"Verwandte Fragen, die Sie erforschen knnen",followUp:{queryPlaceholder:"Stellen Sie eine Anschlussfrage",queryButton:"Fragen Sie"},affiliation:{title:"Beste Preise heute: ${title}"},error:{title:"Hoppla!",description:"Wir erleben derzeit einige Schwierigkeiten. Wrden Sie es bitte spter noch einmal versuchen?"}},sponsor:{phrase:"Untersttzt von",tooltip:"Unsere Sponsoren helfen, Smart Answers am Leben zu halten, haben aber keinen Einfluss auf unsere redaktionelle Unabhngigkeit."}},qc=Object.freeze({__proto__:null,default:Uc,queryButton:Uc.queryButton,home:Uc.home,story:Uc.story,answers:Uc.answers,sponsor:Uc.sponsor});const jc=function(e){if("de"===e)return qc;return Lc}("en");const Dc="miso-smart-answers";const Mc="smart-answers-discovery";function zc(e){return Bc("home",function({site:e}){const{name:t,ref_story:s}=e;return`\n<div class="${Mc}__container">\n  <div class="${Mc}__header">\n    <div class="${Mc}__title">\n      ${jc.home.title.replace("${name}",t)}\n    </div>\n    ${Qc(s)}\n  </div>\n  <div class="${Mc}__body">\n    <div class="${Mc}__search-box">\n      <input type="text" class="${Mc}__search-box-input" placeholder="${jc.home.queryPlaceholder}" aria-label="${jc.home.queryPlaceholder}">\n      <button class="${Mc}__search-box-button" data-role="button">\n        <i>${yc}</i>\n        <span>${jc.queryButton}</span>\n      </button>\n    </div>\n  </div>\n  <div class="${Mc}__footer">\n    ${Qc(s)}\n  </div>\n</div>\n`}(e))}function Fc(e,t={}){return Bc("article",function(e,{questions:t=[]}){const s=0===t.length,n=jc.story.title[s?"empty":"nonempty"],i=jc.story.queryPlaceholder[s?"empty":"nonempty"];return`\n<div class="${Mc}__header">\n  <i>${bc.replace("<svg",'<svg aria-hidden="true" focusable="false"')}</i>\n  <h4 class="${Mc}__title">${n}</h4>\n</div>\n<div class="${Mc}__body">\n  <div class="${Mc}__questions-container">\n    <ul class="${Mc}__questions-list">${t.map((t=>function({page:e},{question:t}){return`\n<li class="${Mc}__question-item">\n  <a href="/smart-answers?q=${encodeURIComponent(t)}&qs=${encodeURIComponent(e.storyId)}" class="${Mc}__question-link" data-role="faq-item" target="_blank" rel="nofollow">${t}</a>\n</li>\n`}(e,{question:t}))).join("")}</ul>\n  </div>\n  ${function({sponsor:e}){return e?`\n<div class="${Dc}__sponsor" data-brand="${e.key}">\n  <div class="${Dc}__sponsor-text">${jc.sponsor.phrase}</div>\n  <div class="${Dc}__sponsor-logo">\n    <img src="${ce(e.image)}" alt="${e.name}">\n  </div>\n  <div class="${Dc}__sponsor-info" tabindex="-1">\n    ${wc}\n    <div class="${Dc}__sponsor-info-tooltip">${jc.sponsor.tooltip}</div>\n  </div>\n</div>`.trim():""}(e)}\n  <div class="${Mc}__search-box">\n    <input type="text" class="${Mc}__search-box-input" placeholder="${i}" aria-label="${i}">\n    <button class="${Mc}__search-box-button" data-role="button">\n      <i>${yc}</i>\n      <span>${jc.queryButton}</span>\n    </button>\n  </div>\n</div>\n`}(e,t))}function Bc(e,t){const s=document.createElement("div");return s.classList.add(Mc),s.classList.add(e),s.innerHTML=t,s}function Qc(e){return e?`\n<div class="${Mc}__info">\n  <span>${jc.home.info}</span>\n  <a class="${Mc}__info-link" href="/?post_type=post&p=${e}" target="_blank" aria-label="${jc.home.info}">${wc}</a>\n</div>\n`:""}const Gc={impression:new Set,viewable_impression:new Set,click:new Set};function Hc(e,t){Wc("click",e,t)}function Wc(e,t,s){s=function(e,t){const s=[],n=Gc[e];for(const e of t)n.has(e)||(s.push(e),n.add(e));return s}(e,s),0!==s.length&&function(e,t,s){const{config:n,site:i,page:r,session_id:o,anonymous_id:a}=t,c="staging"===n.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1",l=["api_key="+n.api_key];!n.dry_run&&function(e){return window.location.hostname===e.hostname}(i)||l.push("&dry_run=1");const u=`${c}/interactions?${l.join("&")}`,h={data:[{type:e,anonymous_id:a,product_ids:[],...t.miso_id?{miso_id:t.miso_id}:{},context:{..._e(),custom_context:{...he(t),api_group:"ask",api_name:"related_questions",property:"related_questions",page_story_id:r.storyId,session_id:o,...s}}}]};if(!window.navigator.sendBeacon(u,JSON.stringify(h)))throw Error("Send beacon unsuccessful: "+u);xe("[Discovery] "+e,h.data)}(e,t,{items:s})}const Vc=(()=>{let e="";for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&(e+=`&${encodeURIComponent(t)}=${encodeURIComponent(s)}`);return e})();function Kc(e,t){const s=t.querySelector('input[type="text"]');if(!s)throw Error('input[type="text"] not found');s.addEventListener("keydown",(({key:t,isComposing:n})=>{n||"Enter"!==t||Yc(e,s.value)})),t.addEventListener("click",(({target:n})=>{for(let i=n;i&&i!==t;i=i.parentElement){if(i.matches('a[href][data-role="faq-item"]')){try{Hc(e,[Zc(i)])}catch(e){console.error(e)}return}if(i.matches('[data-role="button"]'))return void Yc(e,s.value)}}))}function Yc(e,t){if(!t)return;window.open(`/smart-answers?q=${encodeURIComponent(t)}${Vc}`,"_blank")}function Zc({href:e}){return new URL(e).searchParams.get("q")}async function Jc({config:e,site:t,page:s,session_id:n}){xe("[Discovery] Fetching suggested questions from Miso API...");const i=`${"staging"===e.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1"}/ask/related_questions?api_key=${e.api_key}`;try{const e=await window.fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_meta:{site:t.key,session_id:n},product_id:s.storyId})}),{data:r}=await e.json(),{related_questions:o,miso_id:a}=r;return 0===o.length&&xe("[Discovery] No suggested questions found."),{related_questions:o,miso_id:a}}catch(e){return xe("[Discovery] Failed to fetch suggested questions: "+e),console.error(e),[]}}async function Xc(e){const t=document.querySelector("#miso-smart-answers-faq");if(!t)return void xe("[Discovery] No block shown: cannot find the reference position for discovery block.");e={...e,session_id:O()};const[{related_questions:s,miso_id:n}]=await Promise.all([Jc(e),Rc(e)]);e.miso_id=n;const i=Fc(e,{questions:s});Kc(e,i),t.insertAdjacentElement("afterend",i),t.parentNode.removeChild(t),function(e,t){Wc("impression",e,t)}(e,s),await k(i),function(e,t){Wc("viewable_impression",e,t)}(e,s)}async function el(e){const{page:t}=e;switch(t.type){case"home":await async function(e){const t=document.querySelector(".layout--right-rail");if(!t)return void console.error("[Smart Answers] No block shown: cannot find the reference position for discovery block.");await Rc(e);const s=zc(e);Kc(e,s),t.insertAdjacentElement("beforebegin",s)}(e);break;case"story":const[s,n]=await Promise.all([Ae(t.postId),ye()]);await Xc({...e,story:s,anonymous_id:n});break;default:xe("[Discovery] No discovery block for page type: "+t.type)}}(async(e,s)=>{if("/smart-answers"===window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=t;const i=function(e){const t=window.location.pathname;if("/"===t||e.regions.indexOf(t.substring(1))>=0)return{type:"home",site:e};const s=t.substring(1).split("/");if("article"===s[0]){const t=""+s[1];return{type:"story",site:e,postId:t,storyId:`story_${e.key}_${t}`}}return{type:"other",site:e}}(e),r={site:e,config:s,page:i,version:t,sponsor:n};await Promise.all([el(r),Cc(r)])})({key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},e)}();
