!function(){"use strict";var t=Object.freeze({aff_type:"random",...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()}),e="1.0.17";const s=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var n=function(){if(t.sponsor)return s.find((e=>e.key===t.sponsor))||void 0}(),i="1.12.0-beta.0";function r(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const o=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),a=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var c=Object.freeze({__proto__:null,GROUP:o,NAME:a});function u(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function l(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function h(t){return null!=t?""+t:t}function d(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function _(t){return null==t}function p(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function m(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function f(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function g(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function y(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class b{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);v(s),v(n),v(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>w(this,t)),e):w(this,t),this._value=t}disconnect(){this._active=!1}}function w(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function v(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function E(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function S(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function k(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function I(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,r)=>{const o=new b((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function O(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function x(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function A(t,e){const s=T((()=>window.localStorage.getItem(t))),n=T((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,r=e.indexOf(";",i);return decodeURIComponent(0>r?e.substring(i):e.substring(i,r))}(t))),i=s||n||""+e();return i&&!s&&T((()=>window.localStorage.setItem(t,i))),i&&!n&&T((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i))),i}function T(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function C(t){return new R(t)}class R{constructor(t){this._value=t;const e=t=>{this._value=t};m(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class N{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class ${constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new N),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var P="1.12.0-beta.0";let L;try{L=document.currentScript}catch(t){}async function U(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(j(t))return;return new Promise((e=>{let s;s=setInterval((()=>{j(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function q(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${P}/dist/css/${t}.css`}function j(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function D(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function M(t,{depth:e=5,...s}={}){return F(t,e)}function F(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>F(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=F(i,e-1)))}return n}(t,e):t:"(...)"}function z(t,e){const s=Object.getOwnPropertyDescriptors(e),n=Object.getOwnPropertyDescriptors(t);for(const[e,i]of Object.entries(s))"constructor"!==e&&void 0===n[e]&&Object.defineProperty(t,e,i)}function B(t){const e={},s=new Set;for(let n=t;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(e[n]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}const Q=100,G=4;function H(t){const e=function({speed:t=Q,acceleration:e=G}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const r=e(n,s);return t+Math.max(i-n,0)*r/1e3}}const W=Symbol.for("miso:resources");class V{constructor(){this._resources=new Map;const t=window[W]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){K(this._resources,t).resolve(e)}async get(t){return K(this._resources,t).promise}}function K(t,e){if(t.has(e))return t.get(e);const s=new N;return t.set(e,s),s}function Y(){return window[W]||(window[W]=new V)}class Z{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new N;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class J{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)u(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&u(s,e)}}_injectSubscribeInterface(t){p(t,this,["on","once"])}}function X(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class tt{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:X(t,e),uuid:x()})}(t,e);m(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new J({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(tt,"miso:component");class et extends tt{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new N);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class st{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new b(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class nt{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const it=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class rt{constructor(t,e){this._client=t,this._root=e,this._bulk=new Z(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,d({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:r,body:o}=n[e];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=it.DATA_ENDPOINT,eventEndpoint:s=it.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){(t._error||console.error)(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){(t._error||console.error)(e)}return n}}class ot extends tt{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,r)}_postprocess({response:t}){return t.data}}const{GROUP:at,NAME:ct}=c;class ut extends ot{constructor(t){super(t,at.INTERACTIONS)}async upload(t,e){try{return await this._run(ct.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===ct.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}class lt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new nt(s);let o;e=r(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new $;return o=setInterval((async()=>{let e,o,d;try{if([e,o,d]=await t(r?{signal:r}:{}),u||!_(a)&&a>=d)return;_(d)||(a=d),i&&i(e,o,d),c=0}catch(t){return n&&n(t),c++,void(c>s&&(l(),h.error(t)))}h.update(e,o),o&&l()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?i.clear():this._isUpdated(o,t)&&i.touch(),o=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class ht extends lt{constructor(t,e,s,n){super(n),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:dt,NAME:_t}=c;class pt extends ot{constructor(t){super(t,dt.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new mt(this,t,e);const s=await this._run(_t.QUESTIONS,t,e);return new mt(this,s,e)}async _questions(t,e){return this._run(_t.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${_t.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(_t.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(_t.TRENDING_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(_t.SEARCH,t,e);return s.question_id?new ft(this,s,e):s}async _searchGet(t,e){return this._run(`${_t.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(_t.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(_t.SEARCH_AUTOCOMPLETE,t,e)}}class mt extends ht{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class ft extends ht{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),m(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:gt,NAME:yt}=c;class bt extends ot{constructor(t){super(t,gt.SEARCH)}async search(t,e){return this._run(yt.SEARCH,t,e)}async autocomplete(t,e){return this._run(yt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(yt.MGET,t,e)}}const{GROUP:wt,NAME:vt}=c;class Et extends ot{constructor(t){super(t,wt.RECOMMENDATION)}async userToProducts(t,e){return this._run(vt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(vt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(vt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(vt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(vt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(vt.PRODUCT_TO_PRODUCTS,t,e)}}class St extends tt{constructor(t,e){super("api",t),this._client=t,this.helpers=new rt(t,e),this.interactions=new ut(this),this.ask=new pt(this),this.search=new bt(this),this.recommendation=new Et(this)}}var kt=Object.freeze({__proto__:null,Api:St,ApiBase:ot,ApiHelpers:rt,Interactions:ut,Ask:pt,Search:bt,Recommendation:Et});class It extends tt{constructor(t){super("context",t),this._client=t}}var Ot={api:kt,context:{Context:It}};class xt{constructor(t){m(this,{install:t})}}class At extends et{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Tt(this,Ot),this.plugins=new Ct(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new N);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return m(n,{id:t}),this._tryConfig(n,e),n;case"function":return new xt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,r=t.lastIndexOf("/",i)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,i);return`${t.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new Y).get(s);!this.isRegistered(t)&&this.register(n)}}class Tt{constructor(t,e){p(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),m(this,{classes:e})}}class Ct{constructor(t){p(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Rt=new class extends tt{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new At(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=i,this._cmdRes=new N}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Nt=Object.freeze({__proto__:null,viewable:I,debounce:D});const{currentScript:$t}=document;class Pt extends tt{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Pt),window.MisoClient?window.MisoClient!==Pt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Pt}static debug(){}constructor(t){super("client",Rt),this._config(t),this.context=new It(this),this.api=new St(this,Rt),function(t){Rt._clients.push(t),Rt._events.emit("create",t)}(this)}get version(){return Pt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,d(t)}_readConfigFromScriptUrl(){return d({apiKey:new URL(new Request($t.src||$t.href).url).searchParams.get("api_key")||void 0})}}Pt.helpers=Nt,m(Pt,{uuid:x()});var Lt=function(t){const e=Rt._pluginRoot;return Rt.MisoClient=e.MisoClient=t,p(t,Rt,["version","instances","any","meta","on","once","cmdDone"]),p(t,e,["plugins"]),t}(Pt);const{GROUP:Ut,NAME:qt}=c;let jt;class Dt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||jt||(jt=A("miso_anonymous_id",x))}set anonymous_id(t){t=h(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=h(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Mt(){const t=new URLSearchParams(window.location.search);let e=d({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Ft{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function zt(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:i};return s.uuid||(s.uuid=x()),{...t,context:{...e,custom_context:s}}}const Bt="std:native-fetch";let Qt,Gt;const Ht=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Qt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Qt="borrowed",t.contentWindow.fetch}catch(t){Gt=t}})();const Wt="miso-logdump",Vt="miso-logdump",Kt=Vt+"__download-btn",Yt="Miso Log";class Zt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return ee||(ee=U(q("logdump")))}();let t=document.getElementById(Wt);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Yt,e.classList.add(Kt),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Wt,t.classList.add(Vt),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Wt),e=t&&t.querySelector("."+Kt);e&&(e.textContent=this._options.logDownloadButtonText||Yt)}hideDownloadButton(){const t=document.getElementById(Wt);t&&(t.style.display="none")}download(){const t=new Blob([Xt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Jt()})}return t&&"string"==typeof t?t:`miso-log.${Jt()}.jsonl`}clear(){this._logs=[]}}function Jt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Xt(t){return t.map((t=>JSON.stringify(M(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),te(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function te(t){return t?M(t,{depth:2}):t}let ee;const se="std:debug";function ne(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function ie(t,e){return Object.freeze({...t,...e,members:re(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function re(t=[],e=[]){return[...new Set([...t,...e])]}function oe(t,e){let s={};for(const n of t)n&&(s=e(s,n));return d(s)}function ae(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function ce(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...ue("_meta",s,n)})});var s,n}))}function ue(t,e,s){const n=e&&e[t],i=s&&s[t],r=n?i?{...n,...i}:n:i;return void 0!==r?{[t]:r}:{}}Lt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Zt(t)}static get id(){return se}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(se,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(ne)):this._log(t,e,ne(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Bt}install(t,e){Ht?(e.setCustomFetch(Ht),t.debug(`<plugin:${Bt}>`,"[info]",`Using ${Qt} native fetch`)):t.debug(`<plugin:${Bt}>`,"[error]","Failed to obtain native fetch: "+Gt.message)}}),Lt.plugins.use(class extends tt{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Dt(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return e===Ut.INTERACTIONS&&s===qt.UPLOAD?this._modifyPayloadForInteractions(t,n):e===Ut.ASK&&s===qt.QUESTIONS?this._modifyPayloadForAsk(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=d({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),Lt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...d({page:d({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Mt()}),...t.context}})))}}}),Lt.plugins.use(class extends tt{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Ft(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===o.SEARCH)if(s===a.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Lt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(zt)}}}),Lt.plugins.use(class extends tt{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case o.SEARCH:case o.RECOMMENDATION:return!0}return!1}});const le="data-miso-product-id",he="default",de="_organic",_e=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),pe=new Set([_e.PRODUCTS,_e.CATEGORIES,_e.ATTRIBUTES,_e.RESULTS,_e.ITEMS,_e.QUESTION,_e.ANSWER,_e.IMAGES,_e.SOURCES,_e.RELATED_RESOURCES,_e.QUERY_SUGGESTIONS,_e.RELATED_QUESTIONS,_e.AFFILIATION,_e.FACETS,_e.TOTAL]);function me(t){return pe.has(t)}const fe=new Set([_e.PRODUCTS,_e.IMAGES,_e.SOURCES,_e.RELATED_RESOURCES]);const ge=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ye=[ge.IMPRESSION,ge.VIEWABLE,ge.CLICK,ge.SUBMIT,ge.FEEDBACK],be=[ge.IMPRESSION,ge.VIEWABLE,ge.CLICK],we=new Set(be);const ve=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Ee=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function Se(t){if(0>ye.indexOf(t))throw Error("Unrecognized event type: "+t)}const ke=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function Ie(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function Oe(t){if(void 0===t)return;let[e,s]=l(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function xe(t,e){return!1===(e=Oe(e))[0]?e:t&&e?[e[0]||t[0],Ae(t[1],e[1])]:e||t}function Ae(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Te=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Ce(t={}){t=ae(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Re(e);return t}function Re(t={}){return t=ae(t)}function Ne(t={},e={}){const s={...t};for(const[n,i]of Object.entries(e))void 0!==i&&(s[n]=ye.includes(n)?$e(t[n],i):i);return s}function $e(t={},e={}){return{...t,...e}}const Pe=[{key:ke.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return d({group:s,name:t,payload:e})},merge:ce},{key:ke.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${_e.PRODUCTS}: ... }) instead`),t={...s,[_e.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[Ie(e)]=Oe(s);return n},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=xe(t[s],n);return t}))}},{key:ke.DATA_PROCESSOR,normalize:function(t){t=l(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:ke.TRACKERS,normalize:function(t={}){t=ae(t);const{active:e,...s}=t,n={};for(const[t,e]of Object.entries(s))n[t]=Ce(e);return{active:e,...n}},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{for(const[s,n]of Object.entries(e))void 0!==n&&(t[s]="active"===s?n:Ne(t[s],n));return t}))}},{key:ke.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=l(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:ke.FILTERS,normalize:ae,merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>Object.assign(t,e)))}},{key:ke.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>Object.assign(t,e)))}}];class Le{constructor(){this._events=new J({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Ue{constructor(t={},e={}){this._events=new J({target:this}),this._defaults=e,this._context=t||{},this._locals={},m(this,{resolved:new qe(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class qe{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,n=s._context[t];this._cache[t]=e(s._defaults[t],n&&n.get(),s._locals[t])}return this._cache[t]}}class je{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Pe){const{key:e,normalize:s,merge:n}=t;Object.defineProperty(Le.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new je(this,this._globals,e,s,n))}}),Object.defineProperty(Ue.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new je(this,this._locals,e,s,n))}}),Object.defineProperty(qe.prototype,e,{get:function(){return this._get(t)}})}const De=[ke.API,ke.LAYOUTS,ke.DATA_PROCESSOR,ke.TRACKERS,ke.INTERACTIONS];function Me(t,e=De){for(const s of e)Fe(t,s)}function Fe(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}const ze="q",Be="qs";function Qe(t={}){const{setValue:e,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:n=ze,sourceParam:i=Be,...r}={}){return{setValue:t,focus:e,updateUrl:s,param:n,sourceParam:i,...r}}(t),r=new URLSearchParams(window.location.search),o=r.get(n),a=r.get(i)||void 0,{layout:c}=this._views.get(_e.QUERY);c&&(o&&e&&(c.value=o),!o&&s&&c.focus()),o&&this.query(d({q:o,qs:a}))}class Ge extends tt{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Le}}function He(t){return t?"view:"+t:"view"}Me(Ge.prototype);class We{constructor(t={}){(this._events=new J)._injectSubscribeInterface(this),this._options=t,this._states={},m(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const n=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(n),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(n)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Ve{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:x(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function Ke(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Ye{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t})}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},r=await this._source({session:e,...t,options:i});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:n,value:r._response}),r)){if(!Ke(this._hub,e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){Ke(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ze{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{u(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Je,VIEWABLE:Xe,CLICK:ts}=ge,{UNTRACKED:es,TRIGGERED:ss}=ve,ns=Object.freeze({[Je]:es,[Xe]:es,[ts]:es});class is{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:ns}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||es}set(t,e,s){Se(e),function(t){if(t!==ve.UNTRACKED&&t!==ve.TRACKING&&t!==ve.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of l(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==ss))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...ns}))))[e]=s}}const rs=[Symbol("itemless")];class os{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new is(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){Se(t);const{options:n}=this;if(!n)return;this._syncSession();const{deduplicated:i=!0,itemless:r=!1}=n;if(i){if(r&&(e=rs),0===(e=this._states.untriggered(l(e),t)).length)return;this._states.set(e,t,ve.TRIGGERED)}this._sendToHub({type:t,items:r?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:ge.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(d({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new is(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[He(this._role)]}}for(const t of be)os.prototype[t]=function(e,s){this._trigger(t,e,s)};class as{constructor(t,e){this._events=new J({target:this}),this._views=t,this._mapping=function(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}((t._roles.mappings||{})[e]||e),m(this,{role:e,interface:new cs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ze((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===_e.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new os({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((i=e)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=e,d={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...us(e)},_=(t={},e)=>{!1!==t&&this.updateState({...d,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:_})}catch(t){this._error(t),_({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?Ee.ERRONEOUS:t.status;t=this._state=Object.freeze(d({...t,status:s}));const{role:n}=this;this.hub.update(He(n),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:n,meta:i,...r}=t,o={value:this._mapping(t,this),status:n,data:e,meta:i,...r};return this.role===_e.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(e)}),d(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!me(s))continue;let e=t&&t[s];if(s===_e.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class cs{constructor(t){p(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function us(t){return function(t){return t.status===Ee.READY&&!t.ongoing}(t)?{empty:!!ls(t)}:{}}function ls(t){const{value:e}=t;return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}function hs(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class ds{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new J({target:this,error:s}),m(this,{facets:new _s(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return d({facets:Object.freeze({}),sort:hs(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(d({...t,...e,facets:Object.freeze(d({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class _s{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const ps=Symbol.for("miso:tracked");function ms(t){return!!t[ps]}function fs(t){t[ps]=!0}const gs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ys(t,e){return!!e&&{...t,...e}}class bs{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i,options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new ds(this);for(const t of i.members)t!==_e.CONTAINER&&(this._views[t]=new as(this,t));m(this,{interface:new ws(this),trackers:new vs(this,i.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on("data",(t=>this.refresh({data:t}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new as(this,_e.CONTAINER);e.layout=this._createLayout(_e.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===_e.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:n}=e._inst;t&&(s=s.filter((e=>e.role===_e.CONTAINER||t.includes(e.role)))),n&&(s=s.filter((t=>!n.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return d({...gs,...i,impression:ys(gs.impression,e),viewable:ys(gs.viewable,s),click:ys(gs.click,n)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=_e.CONTAINER;this._containerTracker=new os({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class ws{constructor(t){this._actor=t,p(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class vs{constructor(t,e){this._views=t;for(const s of e)s!==_e.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,_e.CONTAINER,{get:()=>t._getContainerTracker()})}}class Es{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:ge.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ss{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=l(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ks(t){return async({group:e,name:s,payload:n,options:i})=>{if(e===o.ASK)switch(s){case a.QUESTIONS:return t.api.ask.questions(n,i);case a.SEARCH:return t.api.ask.search(n,i)}return t.api[e]._run(s,n,i)}}class Is{constructor({role:t,workflow:e,...s}={}){m(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=C(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,k((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),r=C([]),o=C({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Os(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function xs(t,e,s,n){const{templates:i}=t,[r,o]=Qs(t,s);return""+r+(i.indexBlock||zs)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Rs)(t,s,n)+o}function As(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||$s)(t,e,s)+(i.descriptionBlock||Ls)(t,e,s)+(i.priceBlock||Ds)(t,e,s)+(i.ctaBlock||Bs)(t,e,s)}</div>`}function Ts(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||$s)(t,e,s)+(i.descriptionBlock||Ls)(t,e,s)+(i.priceBlock||Ds)(t,e,s)}</div>`}function Cs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||$s)(t,e,s)+(i.dateBlock||Us)(t,e,s)+(i.descriptionBlock||Ls)(t,e,s)+(i.ctaBlock||Bs)(t,e,s)}</div>`}function Rs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||$s)(t,e,s)+(i.authorsAndDateBlock||js)(t,e,s)}</div>`}function Ns(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||$s)(t,e,s)}</div>`}function $s({className:t},{title:e,_title_with_markups:s}){const n=s||O(e);return n?`<div class="${t}__item-title">${n}</div>`:""}function Ps({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ls({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${O(s)}</div>`:""}function Us({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${t}__item-date">${Ws(r,e.date)}</div>`:""}function qs({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function js(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-authors-and-date-container">${""+(i.authorsBlock||qs)(t,e,s)+(i.dateBlock||Us)(t,e,s)}</div>`}function Ds(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:r,currency:o="USD"}=e,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,u=e.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||Ms)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Ms(t,{discount_rate_percent:e}){return`(${e}% off)`}function Fs(t,e,s={}){const{className:n,templates:i}=t,{cover_image:r,image_src:o,image_alt:a}=e;if(!r&&!o)return"";const c=o?"image":"cover-image";return`<div class="${n}__item-${c}-container">${"image"===c?`<img class="${n}__item-${c}" src="${o}"${a?` alt="${a}"`:""}>`:`<img class="${n}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(i.brandBlock||Ps)(t,e,s):""}</div>`}function zs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Bs(t,e,s){const{className:n,templates:i}=t,r=Vs.asFunction(i.cta)(t,e,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function Qs({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const a=!1!==o.link&&n?"a":"div",c=!1!==o.link&&n?`href="${n}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:n=!0}=t;let i="";n&&(e&&(i+=` target="${e}"`),s&&(i+=` rel="${s}"`));return i}(e.link)}`:"";return[`<${a} class="${t}__${i}" ${r?`data-role="${r}"`:""} ${s?`${le}="${s}"`:""} ${c}>`,`</${a}>`]}const Gs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Hs="en-US";function Ws(t,e=Gs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Gs.locale,e);default:throw Error("Invalid date format: "+e)}}const Vs=Object.freeze({tagPair:Qs,formatDate:Ws,formatNumber:function(t,e=Hs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||Hs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:O,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Ks extends Is{constructor({className:t,templates:e,...s}={}){super(s),m(this,{className:t,templates:{...Os("root"),...e,helpers:Vs}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Ys extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ys.MisoClient.ui.layouts.create("banner").render(this)}}class Zs{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await I(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Js extends Is{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Zs}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Ys.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===_e.PRODUCTS||t===_e.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1,unanswerable:o=!1}={}}=e,a=[s,r?Ee.EMPTY:Ee.NONEMPTY];s===Ee.READY&&a.push(n?Ee.ONGOING:Ee.DONE),o&&a.push(Ee.UNANSWERABLE),t.setAttribute("status",a.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===Ee.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Xs=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:r}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class tn extends Ks{static get type(){return"error"}static get defaultTemplates(){return Xs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Xs,...e},...s})}}const en=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function sn(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class nn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});n.set(a,u),i.set(c,u),r.push(u)}return{k2b:n,e2b:i,entries:r}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=sn(i,n),o=sn(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function rn(t){z(t,on.prototype)}class on{_initTrackable(){this._bindings=new nn,this._viewables=new Zs}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!ms(e)&&0===e.button&&!e.defaultPrevented&&!!E(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&(fs(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class an{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===Ee.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let n=!1;try{await I(e,{area:1,duration:0,signal:s.signal}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const cn=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[r,o]=Qs(t,s);return""+r+(i.imageBlock||Fs)(t,s,n)+(i.infoBlock||i.productInfoBlock||Ts)(t,s,n)+o},article:function(t,e,s,n){const{templates:i}=t,[r,o]=Qs(t,s);return""+r+(i.imageBlock||Fs)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Cs)(t,s,n)+(i.indexBlock||zs)(t,s,n)+o},compactArticle:xs,image:function(t,e,s,n){const{templates:i}=t,[r,o]=Qs(t,s);return""+r+(i.imageBlock||Fs)(t,s,n)+(i.infoBlock||i.imageInfoBlock||Ns)(t,s,n)+o},question:function(t,e,s){const[n,i]=Qs(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i,options:r}=t,{status:o}=e;return`<div class="${s} ${o}"${n?` data-role="${n}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${o===Ee.READY?i[o](t,e):""}${i.trigger(t,e)}${i.loading(t,e)}</div>`},[Ee.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e)||[];return n.length>0||e.ongoing?s.body(t,e,n):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:n,templates:i,options:r}=t,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${i.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let r=n;return s.map((s=>i.item(t,e,s,r++))).join("")},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item">${r[a](t,e,s,{index:n})}</li>`},productInfoBlock:Ts,articleInfoBlock:Cs,compactArticleInfoBlock:Rs,imageInfoBlock:Ns,brandBlock:Ps,titleBlock:$s,descriptionBlock:Ls,dateBlock:Us,authorsBlock:qs,authorsAndDateBlock:js,priceBlock:Ds,discountRateText:Ms,ctaBlock:Bs,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[r,o]=Qs(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Vs.asFunction(n.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Fs,indexBlock:zs,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class un extends Ks{static get defaultTemplates(){return cn}constructor({templates:t,itemType:e="product",...s}){super({templates:{...cn,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}rn(un.prototype),z(un.prototype,an.prototype);const ln="miso-list";class hn extends un{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ln}constructor({className:t=ln,...e}={}){super({className:t,...e})}}const dn="miso-horizontal";class _n extends un{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return dn}constructor({className:t=dn,...e}={}){super({className:t,...e})}}const pn="miso-cards";function mn(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function fn(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function gn(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),n=e[2]||"";return[s,n]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function yn(t){return void 0===t||t instanceof bn?t:new bn(t)}class bn{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=yn(t),yn([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class wn{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,k((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),n=e.itemCount,i=e.itemCount=s?s.length:void 0;i!==n&&(void 0===i?e.itemIndex=void 0:void 0===n&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(mn(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let n=0;for(const e of s.children)fn(e,"active",n===t),n++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const vn="miso-ui-icon",En=vn+"-svg-1_12_0-beta_0",Sn={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},kn=`<symbol id="${vn}-${Sn.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,In=`<symbol id="${vn}-${Sn.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,On=`<symbol id="${vn}-${Sn.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,xn=`<svg id="${En}" style="display:none;">${[kn,In,On,`<symbol id="${vn}-${Sn.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${vn}-${Sn.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${vn}-${Sn.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let An=!1;function Tn(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${vn}-${t}"></use></svg>`}An||document.head.querySelector("#"+En)||(An=!0,document.head.insertAdjacentHTML("beforeend",xn));const Cn=new Set(Object.values(Sn));Tn(Sn.SEND),Tn(Sn.SEARCH);const Rn=Tn(Sn.TRIANGLE);Tn(Sn.TRIANGLE_EQ);const Nn=Tn(Sn.CHEVRON),$n=Tn(Sn.CHEVRON_NEGATIVE),Pn="miso-carousel",Ln=Object.freeze({body:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__viewport"><div class="${n}__viewport-inner">${i.list(t,e,s)}</div></div>${i.controls(t,e,s)}`},controls:function(t,e,s){const{templates:n}=t;return`${n.controlContainer(t,e,"previous")}${n.controlContainer(t,e,"next")}${n.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-container-${s}">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?$n:Nn},indexIndicator:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${n}__index-indicator-item">${i.indexIndicatorItem(t,e,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Un=Object.freeze({...un.defaultTemplates,...Ln});class qn extends un{static get type(){return"carousel"}static get defaultTemplates(){return Un}static get defaultClassName(){return Pn}constructor({className:t=Pn,templates:e,...s}={}){super({className:t,templates:{...Ln,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){z(t,wn.prototype)}(qn.prototype);const jn="16rem",Dn=Object.freeze({...un.defaultTemplates,item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o,c=r[a](t,e,s,{index:n});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),Mn="miso-gallery";class Fn extends un{static get type(){return"gallery"}static get defaultTemplates(){return Dn}static get defaultClassName(){return Mn}constructor({className:t=Mn,templates:e,...s}={}){super({className:t,templates:{...Dn,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=s?void 0:this._bodyHtml(t),i=this._itemsHtml(t,e);return{...t,...d({incremental:s,bodyHtml:n,itemsHtml:i})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const n=this._renderListElement(t,e,s);n&&(this._syncListAspectRatio(n),this._renderItems(n,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:n}=e;return s||(t.innerHTML=n),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,n=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,n)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const n=t.children.length,i=this._writeItemSizes((this._getItems(e)||[]).slice(n),s,n);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,i,{offset:n}))}_writeItemSizes(t,[e=0,s=0]=[],n=0){let i=0;n>0&&(i=Math.min(n,e),n-=i,e-=i),n>0&&(i=Math.min(n,s),n-=i,s-=i);const r=[];for(const n of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),r.push({...n,_size:t})}return r}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=yn(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:n}=e,{height:i=jn}=this.options,r=gn(i),o=t.clientWidth;if(0===o)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(o*n.width*2/(r*n.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),n=t;const i=Math.min(Math.floor(s/3),n);n-=i,s-=3*i;const r=Math.min(s,n);return n-=r,s-=r,[i,r,n]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,n=0]=e;const{className:i}=this;for(const e of t.children){let t=!1,r=!1;s>0?(t=!0,s--):n>0&&(r=!0,n--),fn(e,i+"__item-large",t),fn(e,i+"__item-medium",r),fn(e,i+"__item-small",!t&&!r)}}}const zn="miso-search-box";const Bn=Object.freeze({root:function(t){const{className:e,templates:s,role:n,options:i,autocomplete:r}=t,{placeholder:o}=i;return`\n<div class="${e}" ${n?`data-role="${n}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=e;var r;return("function"==typeof n?n(t):""+n)+("function"==typeof i?i(t):(Cn.has(r=i)?Tn(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__${e}-list" data-role="${e}-list">${s.map((s=>i.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||O(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=s.helpers.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:Fs,productInfoBlock:Ts}),Qn=Object.freeze({className:"miso-autocomplete",debounce:300});class Gn extends Ks{static get type(){return"search-box"}static get defaultTemplates(){return Bn}static get defaultClassName(){return zn}constructor({className:t=zn,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...Bn,...e},...n}),m(this,{autocomplete:{...Qn,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=D(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=Ee.INITIAL,session:r,value:o}=e.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(t),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);fn(t,"nonempty",l.length>0),u.setAttribute("data-status",i),u.innerHTML=this.templates.completions(this,l),n({completions:{index:a,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Hn.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Hn(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&E(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ge.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Hn{static empty(){return Hn._empty||(Hn._empty=new Hn)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const r of t[i])r.product&&!r.product.url||(r._index=e,r._field=i,s.set(e,r),n.push(r),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Wn="miso-option-list";const Vn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${O(e.text||e)}</li>`}});class Kn extends Ks{static get type(){return"option-list"}static get defaultTemplates(){return Vn}static get defaultClassName(){return Wn}constructor({className:t=Wn,templates:e,...s}={}){super({className:t,templates:{...Vn,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncOptionValues(t,n)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;fn(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._submit(n.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}rn(Kn.prototype);const Yn=Object.freeze({...Os("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class Zn extends Ks{static get defaultTemplates(){return Yn}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...Yn,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=E(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],k((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Jn="miso-feedback",Xn=["helpful","unhelpful"];const ti=Object.freeze({options:function(t){const{templates:e}=t;return Xn.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class ei extends Zn{static get type(){return"feedback"}static get defaultTemplates(){return ti}static get defaultClassName(){return Jn}constructor({className:t=Jn,templates:e,...s}={}){if(super({className:t,templates:{...ti,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const si="miso-text";const ni=Object.freeze({root:function(t,{value:e}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=t,o=n?`data-role="${n}"`:"",a=void 0!==e?O(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:n}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[i,r]=e;switch(i){case"date":return t=>s(t,r);case"number":return t=>n(t,r);default:return t=>""+t}}(t)(e)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class ii extends Ks{static get type(){return"text"}static get defaultTemplates(){return ni}static get defaultClassName(){return si}constructor({className:t=si,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...ni,...e},tag:s,...n})}}class ri extends Is{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=C(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class oi{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function ai(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,ci(e)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||Ee.INITIAL),n}function ci(t){return t+"__cursor"}function ui(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${li(n[0])}, ${li(n[1])})`,e,""+r,i,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function li(t){return Math.floor(100*t)/100+"ms"}const hi="miso-typewriter";class di extends ri{static get type(){return"typewriter"}static get defaultClassName(){return hi}constructor({className:t=hi,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:n,...a}),m(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:H({speed:i,acceleration:r}),this._readiness=new N,"markdown"===s&&di.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=ci(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:ui(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new oi}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==Ee.READY||o?void 0:Date.now());return this._prevState=Object.freeze(d({session:i,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=ai(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}i(a);const u=e.status===Ee.READY&&!a.done;n({ongoing:u},{silent:u&&(!s||s.status===Ee.READY)&&!c}),u&&r()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const n=e.closest("a");if(n){if(!t.defaultPrevented){const{href:e,innerText:s,className:i}=n;e&&this._view._events.emit("link-click",d({event:t,url:e,text:s?s.trim():"",className:i||"",attributes:_i(n)}))}}else;}}function _i(t){const{attributes:e}=t,s={};for(const{name:t,value:n}of e)t.startsWith("data-")&&(s[t]=n);try{return JSON.stringify(s)}catch(t){return"{}"}}const pi="miso-affiliation";const mi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i,options:r}=t,{status:o}=e,a=n?` data-role="${n}"`:"",c=e.value||{},u=c.channel?` data-channel="${c.channel}"`:"",l=t._getItems(e),h=l?l.length:void 0;return`<div class="${s} ${o}"${a}${u}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${o===Ee.READY?i[o](t,e):""}</div>`},[Ee.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Rn},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(t,e,s,{index:n})}${r[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=Vs.asFunction(o)(t,e,s,n),a=Vs.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[r,o]=Qs(t,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||As)(t,s,n)+(i.imageBlock||Fs)(t,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:r}=t,o=Vs.asFunction(r.logoText)(t,e,s,n)||"",a=Vs.asFunction(r.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:r}=t,o=Vs.asFunction(r.logoUrl)(t,e,s,n);if(!o)return"";const a=Vs.asFunction(r.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),fi=Object.freeze({...un.defaultTemplates,...mi});class gi extends un{static get type(){return"affiliation"}static get defaultTemplates(){return fi}static get defaultClassName(){return pi}constructor({className:t=pi,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...mi,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new st(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,k((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(mn(n,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const yi="miso-facets",bi="miso-facet",wi="custom_attributes.";const vi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:n={}}=e.value||{};return Object.keys(n).map((i=>s.facet(t,{field:i,entries:n[i]},e)))},facet:function(t,e,s){const{facetClassName:n=bi,templates:i}=t,{field:r}=e;return`<div class="${n}" data-role="facet" data-field="${O(r)}">${i.header(t,e,s)}${i.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:n=bi,templates:i}=t;return`<div class="${n}__header">${i.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(wi)&&(e=e.substring(18)),O(e)},options:function(t,{field:e,entries:s},n){const{facetClassName:i=bi,templates:r}=t;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(t,{field:e,value:s,count:i},n))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:n=bi,templates:i}=t;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(t,e,s)}</span>\n  <span class="${n}__count">${i.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return O(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function Ei(t,e){return`${t}:::${e}`}function Si(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class ki extends Ks{static get type(){return"facets"}static get defaultTemplates(){return vi}static get defaultClassName(){return yi}constructor({className:t=yi,templates:e,...s}={}){super({className:t,templates:{...vi,...e},...s}),this._bindings=new nn}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=Si(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)this._setSelected(n,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=Si(t.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)e[t]&&this._setSelected(n,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),n=[],i=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;n.push(Ei(t,c)),i.push({field:t,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[O(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Ii="miso-select";const Oi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,r=n?`data-role="${n}"`:"",o=t._getItems(e),a=o.find((t=>t.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(t,a)}\n  ${i.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:n}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:n}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>n.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:n}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${n.text(t,e)}</li>`},text:function(t,e){return O(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,((t,e)=>" "+e))||e||"")}});class xi extends Ks{static get type(){return"select"}static get defaultTemplates(){return Oi}static get defaultClassName(){return Ii}constructor({className:t=Ii,templates:e,...s}={}){super({className:t,templates:{...Oi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}rn(xi.prototype);const Ai="miso-more-button";const Ti=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${e.status!==Ee.READY?" disabled":""}>\n  ${i.text(t)}\n</div>\n`},text:function(t){return"More"}});class Ci extends Ks{static get type(){return"more-button"}static get defaultTemplates(){return Ti}static get defaultClassName(){return Ai}constructor({className:t=Ai,templates:e,...s}={}){super({className:t,templates:{...Ti,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var Ri=Object.freeze({__proto__:null,TemplateBasedLayout:Ks,ContainerLayout:Js,ErrorLayout:tn,BannerLayout:class extends Ks{static get type(){return"banner"}static get defaultTemplates(){return en}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...en,...e},...s})}},CollectionLayout:un,ListLayout:hn,HorizontalLayout:_n,CardsLayout:class extends un{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return pn}constructor({className:t=pn,...e}={}){super({className:t,...e})}},CarouselLayout:qn,GalleryLayout:Fn,SearchBoxLayout:Gn,OptionListLayout:Kn,FeedbackLayout:ei,TextLayout:ii,TypewriterLayout:di,AffiliationLayout:gi,FacetsLayout:ki,SelectLayout:xi,MoreButtonLayout:Ci});function Ni(t){return t&&t.value&&t.value.revision}function $i(t){const e=function(t){if(!t)return Ee.INITIAL;const{request:e,error:s,value:n}=t;return s?Ee.ERRONEOUS:n?Ee.READY:e?Ee.LOADING:Ee.INITIAL}(t);return d({status:e,ongoing:e===Ee.READY?t.ongoing:void 0,...t})}function Pi(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:n}=s;n&&(e.meta.miso_id=n)}function Li(t){const{request:e,value:s}=t;if(!e)return t;const{payload:n}=e||{},{q:i}=n||{};return i?{...t,value:{...s,keywords:i}}:t}function Ui(t){const{role:e,type:s,items:n}=t,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:d({property:e})}};switch(function(t){return we.has(t)}(s)&&(!function(t){return fe.has(t)}(e)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((t=>t.text||t.id||t))):i.product_ids=(n||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case ge.SUBMIT:i.context.custom_context.value=t.value;break;case ge.FEEDBACK:i.context.custom_context.value=i.value=t.value,i.context.custom_context.result_type=i.result_type=t.result_type}return d(i)}function qi(t={},e={}){return d({...t,...e,context:d({...t.context,...e.context,custom_context:d({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const ji=Object.freeze({}),Di=Object.freeze({[_e.CONTAINER]:Js.type,[_e.ERROR]:tn.type}),Mi=Object.freeze({}),Fi=Object.freeze({api:ji,layouts:Di,trackers:Mi}),zi=Object.freeze({mappings:{[_e.ERROR]:t=>t.error}});class Bi extends tt{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:n,defaults:i,options:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,t=Object.freeze({...t,plugin:s,client:n}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=r||new Ue(e&&e._options,i),this._hub=new We({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,n._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({name:t,roles:e}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new Ve(s),this._data=new Ye(s,{source:ks(n),options:i}),this._views=new bs(s,{extensions:r,layouts:o,roles:e,options:i,workflow:t}),this._interactions=new Ss(s,{client:n,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(He(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:n}){n||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[He(t)]||{};e.session&&e.status===Ee.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===Ee.READY,n=e===Ee.ERRONEOUS;this._emitLifecycleEvent(n?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||n)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(t);return n.add(t),!i}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=ce(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Ni(t);if(!_(s)){const t=Ni(this._hub.states.data);if(!_(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=$i(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:Ee.READY,session:this.session,...e},this._hub.update(He(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=Ui(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)e=n(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==_e.AFFILIATION)return t;const{items:s}=e;return qi(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return qi(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[He(e.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?qi(t,{miso_id:n}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function Qi(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Gi(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function Gi({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Hi)}}function Hi({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return d({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:Wi({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function Wi(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const r=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...Wi(i,r)}:{...s,[r]:i}}),{})}function Vi(t){z(t,Ki.prototype)}Me(Bi.prototype),Object.assign(Bi,{DEFAULT_API_OPTIONS:ji,DEFAULT_LAYOUTS:Di,DEFAULT_TRACKERS:Mi,DEFAULT_OPTIONS:Fi,ROLES_OPTIONS:zi});class Ki{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=e;else{window.open(e,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Yi=Object.freeze({...Bi.DEFAULT_API_OPTIONS,group:o.ASK,payload:{...Bi.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Zi=Object.freeze({actor:!1,api:{group:o.ASK,name:a.AUTOCOMPLETE}}),Ji=Object.freeze({...Bi.DEFAULT_LAYOUTS,[_e.QUERY]:[Gn.type,{placeholder:"Ask a question"}],[_e.QUESTION]:[ii.type,{tag:"h2"}],[_e.ANSWER]:di.type,[_e.FEEDBACK]:ei.type,[_e.IMAGES]:[Fn.type,{incremental:!0,itemType:"image"}],[_e.SOURCES]:[hn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[_e.AFFILIATION]:[gi.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Xi=Object.freeze({...Bi.DEFAULT_TRACKERS,[_e.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Te.click},[_e.IMAGES]:Te,[_e.SOURCES]:Te,[_e.AFFILIATION]:Te,[_e.PRODUCTS]:Te}),tr=Object.freeze({...Bi.DEFAULT_OPTIONS,api:Yi,autocomplete:Zi,layouts:Ji,trackers:Xi}),er=ie(Bi.ROLES_OPTIONS,{main:_e.ANSWER,members:Object.keys(Ji)});class sr extends Bi{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new Es(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(_e.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(_e.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[He(this._roles.main)]||{};t.session&&t.status!==Ee.INITIAL&&(t.status!==Ee.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,n=e===Ee.READY&&!t.ongoing,i=e===Ee.ERRONEOUS,r=n?"done":i?"error":e,o=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,t),(n||i)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){Qe.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||de}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==ze?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Qi(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_updateUrlIfNecessary({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:n}=this._autoQuery,i=t&&t.question||e&&e.payload&&e.payload.question,r=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source;if(!i)return;const o=new URL(window.location),a=o.searchParams.get(s),c=o.searchParams.get(n)||de;i===a&&r===c||(o.searchParams.set(s,i),r===de?o.searchParams.delete(n):o.searchParams.set(n,r),window.history.replaceState({},"",o))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=function(t,{event_target:e}={}){return e?qi(t,{context:{custom_context:{event_target:e}}}):t}(t=this._writeAnswerClickInteraction(t,e),e)}_writeAskPropertiesToInteraction(t={},e){return qi(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==_e.ANSWER)return t;const{items:s=[]}=e;return qi(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[He(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t,event:e}){if(ms(e))return;const{value:s}=this.states.data||{},{sources:n}=s||{},i=n&&n[t-1];i&&i.product_id&&(fs(e),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){ms(t)||(fs(t),this._views.trackers.answer.click([],{items:[e]}))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Vi(sr.prototype),Object.assign(sr,{DEFAULT_API_OPTIONS:Yi,DEFAULT_AUTOCOMPLETE_OPTIONS:Zi,DEFAULT_LAYOUTS:Ji,DEFAULT_TRACKERS:Xi,DEFAULT_OPTIONS:tr,ROLES_OPTIONS:er});const nr=Object.freeze({...sr.DEFAULT_API_OPTIONS,name:a.QUESTIONS,payload:{...sr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),ir=Object.freeze({...sr.DEFAULT_LAYOUTS,[_e.QUERY]:[Gn.type,{templates:{buttonIcon:"send"}}],[_e.RELATED_RESOURCES]:[hn.type,{incremental:!0,itemType:"article"}],[_e.QUERY_SUGGESTIONS]:Kn.type}),rr=Object.freeze({...sr.DEFAULT_TRACKERS,[_e.RELATED_RESOURCES]:Te,[_e.QUERY_SUGGESTIONS]:{...Te,click:{...Te.click,validate:t=>0===t.button}}}),or=Object.freeze({...sr.DEFAULT_OPTIONS,api:nr,layouts:ir,trackers:rr}),ar=ie(sr.ROLES_OPTIONS,{members:Object.keys(ir)});class cr extends sr{constructor(t,e){super({name:"ask",context:t,roles:ar,defaults:or,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;m(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states.data.value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:n}=this;let i=d({...s,question:t,parent_question_id:n,_meta:{...s._meta,question_source:e||de}});return i=this._writeWikiLinkTemplateToPayload(i),i}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let n,i,r,{property:o}=t.context&&t.context.custom_context||{};return e.role===_e.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(e)),qi(t,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class ur extends Ge{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new cr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new cr(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const lr=Object.freeze({...Bi.DEFAULT_API_OPTIONS,group:o.SEARCH,payload:{...Bi.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),hr=Object.freeze({...Bi.DEFAULT_LAYOUTS,[_e.QUERY]:[Gn.type],[_e.PRODUCTS]:[hn.type,{incremental:!0,infiniteScroll:!0}],[_e.KEYWORDS]:[ii.type,{raw:!0}],[_e.TOTAL]:[ii.type,{raw:!0,format:"number"}],[_e.FACETS]:[ki.type],[_e.SORT]:[xi.type],[_e.MORE]:[Ci.type]}),dr=Object.freeze({...Bi.DEFAULT_TRACKERS,[_e.PRODUCTS]:Te}),_r=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),pr=Object.freeze({...Bi.DEFAULT_OPTIONS,api:lr,layouts:hr,trackers:dr,pagination:_r}),mr=ie(Bi.ROLES_OPTIONS,{main:_e.PRODUCTS,members:Object.keys(hr),mappings:{[_e.FACETS]:"facet_counts",[_e.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=e.states.filters||{},r=i&&i.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(n).field;return r?n.map((t=>({...t,selected:t.field===r}))):n}}});class fr extends Bi{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(_e.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){Qe.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this._views.filters.reset({silent:!0}),this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==Ee.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:n}=e||{};return d({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const n=t[s];n&&n.length&&(e[s]={terms:n})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return l(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},n=s.map((t=>t.product_id)).filter((t=>t)),i=[...t.exclude||[],...n];return 0===i.length?t:{...t,exclude:i}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:n}=t;switch(s){case Ee.INITIAL:case Ee.LOADING:break;default:return t}return n&&n.facet_counts?t:{...t,value:{...n,facet_counts:e}}}(t=Li(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=_e.PRODUCTS}={}){const{status:s,request:n,value:i}=t;if(s!==Ee.READY||!n||!i)return t;const{[e]:r}=i;if(!r)return t;const{rows:o}=n.payload,{length:a}=r;return o>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=_e.PRODUCTS}={}){if(!e.value)return t;const{[s]:n=[],facet_counts:i,total:r}=t.value,{[s]:o=[]}=e.value;return{...e,value:{...e.value,facet_counts:i,total:r,[s]:[...n,...o]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}Me(fr.prototype,[ke.PAGINATION,ke.FILTERS]),Object.assign(fr,{DEFAULT_API_OPTIONS:lr,DEFAULT_LAYOUTS:hr,DEFAULT_TRACKERS:dr,DEFAULT_PAGINATION:_r,DEFAULT_OPTIONS:pr,ROLES_OPTIONS:mr});const gr=Object.freeze({members:[]});function yr({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function br(t){return t&&t.value&&t.value.trim()||void 0}class wr extends Bi{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:yr(e),roles:gr,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,br(t)===br(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!br(t))return void this._updateCompletions({session:s,status:Ee.INITIAL});const n=this._buildPayload(t);this._request({payload:n})}_buildPayload(t){return{q:br(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function vr(t){z(t,Er.prototype)}class Er{_initAutocomplete(t){this._autocomplete=new wr(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Sr=ie(sr.ROLES_OPTIONS,{mappings:{[_e.QUESTION]:_e.KEYWORDS}});class kr extends sr{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Sr,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset({silent:!0}),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._writeWikiLinkTemplateToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||de}}}_defaultProcessData(t){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:n}={}}=e;return n?{...t,meta:{...t.meta,miso_id:n}}:t}(t=Li(t=super._defaultProcessData(t))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_updateDataInHub(t){switch(t.status){case Ee.INITIAL:case Ee.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),Pi(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}vr(kr.prototype);const Ir={...fr.ROLES_OPTIONS,members:[_e.PRODUCTS,_e.KEYWORDS,_e.TOTAL,_e.FACETS,_e.SORT,_e.MORE,_e.ERROR]};class Or extends fr{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Ir,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:d({...t._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(t){return Pi(t=super._defaultProcessData(t)),t}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}}Object.assign(Or,{ROLES_OPTIONS:Ir});class xr{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return Or.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,n=this._getSubviews(s);if(!n._containers.has(t)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(t)){for(const n of t.components)if(s.containsElement(n))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}n.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const Ar=Object.freeze({group:o.ASK,name:a.SEARCH,payload:{...sr.DEFAULT_API_OPTIONS.payload,...fr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Tr=Object.freeze({...sr.DEFAULT_LAYOUTS,...fr.DEFAULT_LAYOUTS,[_e.QUERY]:[Gn.type,{placeholder:""}],[_e.QUESTION]:[ii.type,{raw:!0}],[_e.SOURCES]:[_n.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:xs,articleInfoBlock:Rs}}]}),Cr=Object.freeze({...sr.DEFAULT_TRACKERS,...fr.DEFAULT_TRACKERS}),Rr=Object.freeze({...fr.DEFAULT_PAGINATION,active:!0}),Nr=Object.freeze({api:{group:o.ASK,name:a.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),$r=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Pr=Object.freeze({...sr.DEFAULT_OPTIONS,...fr.DEFAULT_OPTIONS,api:Ar,layouts:Tr,trackers:Cr,autocomplete:Nr,pagination:Rr,filters:$r}),Lr=Object.freeze({main:_e.PRODUCTS,members:Object.keys(Tr),mappings:Object.freeze({...sr.ROLES_OPTIONS.mappings,...fr.ROLES_OPTIONS.mappings})});class Ur extends Bi{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Lr,defaults:Pr})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new kr(this),this._results=new Or(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){this._views=new xr(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return t=this._answer._defaultProcessInteraction0(t,e),t=this._results._defaultProcessInteraction0(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Me(Ur.prototype,[ke.PAGINATION,ke.FILTERS]);const qr=Object.freeze({group:o.SEARCH,name:a.SEARCH,payload:{fl:["*"]}}),jr=Object.freeze({api:{group:o.SEARCH,name:a.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Dr=Object.freeze({...fr.DEFAULT_LAYOUTS}),Mr=Object.freeze({...fr.DEFAULT_TRACKERS}),Fr=Object.freeze({...fr.DEFAULT_OPTIONS,api:qr,autocomplete:jr,layouts:Dr,trackers:Mr}),zr=fr.ROLES_OPTIONS;class Br extends fr{constructor(t,e){super({name:"search",plugin:t,client:e,roles:zr,defaults:Fr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=_e.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}vr(Br.prototype);class Qr extends Ge{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=he){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=he){return this._members.has(t)}get(t=he){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class Gr extends Bi{_initProperties(t){super._initProperties(t);const{id:e}=t;m(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return qi(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(Gr,{DEFAULT_API_OPTIONS:Bi.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Bi.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Bi.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Bi.DEFAULT_OPTIONS,ROLES_OPTIONS:Bi.ROLES_OPTIONS});const Hr=Object.freeze({...Gr.DEFAULT_API_OPTIONS,group:o.RECOMMENDATION,name:a.USER_TO_PRODUCTS,payload:{...Gr.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Wr=Object.freeze({...Gr.DEFAULT_LAYOUTS,[_e.PRODUCTS]:hn.type}),Vr=Object.freeze({...Gr.DEFAULT_TRACKERS,[_e.PRODUCTS]:Te}),Kr=Object.freeze({...Gr.DEFAULT_OPTIONS,api:Hr,layouts:Wr,trackers:Vr}),Yr=ie(Gr.ROLES_OPTIONS,{main:_e.PRODUCTS,members:Object.keys(Wr)});class Zr extends Gr{constructor(t,e){super({name:"recommendation",context:t,roles:Yr,defaults:Kr,id:e})}start(){return this._request(),this}notifyViewUpdate(t=_e.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class Jr extends Qr{constructor(t,e){super("recommendations",t,e)}_create(t){return new Zr(this,t)}}const Xr=Object.freeze({...Gr.DEFAULT_API_OPTIONS,group:o.ASK,name:a.RELATED_QUESTIONS}),to=Object.freeze({...Gr.DEFAULT_LAYOUTS,[_e.RELATED_QUESTIONS]:[hn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[_e.QUERY]:[Gn.type,{placeholder:"Ask a question"}]}),eo=Object.freeze({...Gr.DEFAULT_TRACKERS,[_e.RELATED_QUESTIONS]:Te,[_e.CONTAINER]:{...Te,itemless:!0},[_e.QUERY]:{[ge.SUBMIT]:{active:!0}}}),so=Object.freeze({...Gr.DEFAULT_OPTIONS,api:Xr,layouts:to,trackers:eo}),no=ie(Gr.ROLES_OPTIONS,{main:_e.RELATED_QUESTIONS,members:Object.keys(to)});class io extends Gr{constructor(t,e){super({name:"explore",context:t,roles:no,defaults:so,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(_e.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Ki.prototype.useLink.call(this,t,e),e&&this.useLayouts({[_e.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=_e.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Ki.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Vi(io.prototype);class ro extends Qr{constructor(t,e){super("explores",t,e)}_create(t){return new io(this,t)}}class oo extends tt{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new N)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var ao=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var co=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class uo{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class lo{constructor(t){this._context=t,m(this,{lowerCamelToKebab:y,kebabToLowerCamel:f,kebabOrSnakeToLowerCamel:g})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=g(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:n=!1}){const{classPrefix:i}=t;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${e}-phrase">${this.phraseText(t,f(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,n=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${y(t)}="${n}"`)}return s}}const ho=B(new lo({...ao,DEFAULT_PHRASES:co})),_o=B(new class extends uo{constructor(){super({helpers:ho})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=t;return n(t,{name:"related-resources"},!1===i.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:n={}}=t;return!1===n.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:ho}));function po(t={}){const{normalizeOptions:e,section:s,container:n}=ho,{querySuggestions:i,answerGroup:r}=_o;return s(t=e(t),{name:"follow-up"},[i(t),n(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var mo=Object.freeze({__proto__:null,helpers:ho,sections:_o,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=ho,{followUps:i,relatedResourcesSection:r,answerGroup:o}=_o;return""+s(t=e(t),{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+i(t)+r(t)},followUp:po});const fo=Object.freeze(ao),go=Object.freeze(co),yo=Object.freeze(mo);var bo=Object.freeze({__proto__:null,constants:fo,phrases:go,templates:yo,wireFollowUps:function(t,e,{template:s=po,...n}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const i=t.ui.asks,r=t.ui.ask;i.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:wo}=document,vo=Object.freeze({templates:yo,autostart:!0}),Eo=["templates","phrases","features"];class So{constructor(){this._defaults=vo,this._scriptSrc=function(){if(!wo||!wo.src)return{};const t=document.createElement("a");t.href=wo.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Oo(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Oo(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return d({apiKey:t,apiHost:e,templates:xo(s),phrases:n,...i})}(ko(this._defaults,this._scriptSrc,t,this._pageUrl))}}function ko(...t){let e={};for(const s of t)s&&(e=Io(e,s));return e}function Io(t,e){if(!e)return t;Object.assign(t,e);for(const s of Eo)s in e&&(t[s]={...t[s],...e[s]});return t}function Oo(t){return""===t||"false"!==t&&t}function xo(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(xo):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,xo);default:throw Error("Unsupported template type: "+t)}}class Ao{constructor(t,{classPrefix:e=fo.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");m(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class To extends oo{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new So,this._localOptions={}}config(t={}){t=ko(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;m(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Ao(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Co extends et{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Ro,No,$o;async function Po(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Ro||(Ro=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return No=No||e.any(),$o=$o||await No,$o.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),$o}const Lo="logo",Uo="auto",qo=Object.freeze([Lo]);function jo(t){if(!t)return Uo;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Do extends HTMLElement{static get observedAttributes(){return qo}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return jo(this.getAttribute(Lo))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Uo:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Lo,e):this.removeAttribute(Lo)}async connectedCallback(){const t=this._client=await Po(Do);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Lo)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){jo(t)!==jo(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Mo="parent-question-id",Fo=Object.freeze([...Do.observedAttributes,Mo]);const zo="unit-id",Bo=Object.freeze([...Do.observedAttributes,zo]);class Qo extends Do{static get observedAttributes(){return Bo}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(zo)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(zo,t):this.removeAttribute(zo)}attributeChangedCallback(t,e,s){if(t===zo)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Go=Object.freeze({__proto__:null,MisoAskElement:class extends Do{static get tagName(){return"miso-ask"}static get observedAttributes(){return Fo}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Mo)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Mo,t):this.removeAttribute(Mo))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Mo)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Qo{static get tagName(){return"miso-explore"}static get observedAttributes(){return Qo.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends Do{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Do.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Do{static get tagName(){return"miso-search"}static get observedAttributes(){return Do.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Qo{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Qo.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const Ho="role",Wo=Object.freeze([Ho]);class Vo extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Wo}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Ho);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ho}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Ho}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Ho&&this._container&&this._container._updateComponentRole(this,e,s)}}var Ko=Object.freeze({__proto__:null,MisoComponentElement:Vo,MisoQueryElement:class extends Vo{constructor(){super({role:_e.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Vo{constructor(){super({role:_e.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Vo{constructor(){super({role:_e.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Vo{constructor(){super({role:_e.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Vo{constructor(){super({role:_e.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Vo{constructor(){super({role:_e.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Vo{constructor(){super({role:_e.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Vo{constructor(){super({role:_e.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Vo{constructor(){super({role:_e.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Vo{constructor(){super({role:_e.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Vo{constructor(){super({role:_e.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends Vo{constructor(){super({role:_e.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Vo{constructor(){super({role:_e.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Vo{constructor(){super({role:_e.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Vo{constructor(){super({role:_e.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Vo{constructor(){super({role:_e.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Vo{constructor(){super({role:_e.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Vo{constructor(){super({role:_e.ERROR})}static get tagName(){return"miso-error"}}});class Yo extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Yo.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var Zo=Object.freeze({__proto__:null,containers:Go,roles:Ko,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Yo{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Ys});const Jo="miso-hybrid-search-combo";var Xo=Object.freeze({__proto__:null,CLASS_PREFIX:Jo,CONAINER_TAG:"miso-hybrid-search"});const ta="Show more",ea="Show less";var sa=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:ta,showLess:ea});const na=B(new lo({...Xo,DEFAULT_PHRASES:sa})),ia=B(new class extends uo{constructor(){super({helpers:na})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:na}));var ra=Object.freeze({__proto__:null,helpers:na,sections:ia,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=na;t=e(t);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=ia,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[i(t)]:r(t))+s(t,{name:"search-results"},o(t))}});const oa="answer-box-open",aa="answer-box-shown",ca='[data-role="answer-box-toggle"]';class ua{constructor(t,e,{classPrefix:s=Jo,phrases:n={},hideWhenUnanswerable:i=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=n,this._hideWhenUnanswerable=i,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(ca)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case Ee.ERRONEOUS:case Ee.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ea:this._phrases.showMore||ta;for(const e of this._element.querySelectorAll(ca))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const la={isOpen:oa,shown:aa},ha={toggleOpen:["toggle",oa],open:["open",oa],close:["remove",oa],toggleHidden:["toggle",aa],show:["add",aa],hide:["remove",aa]};for(const[t,e]of Object.entries(la))Object.defineProperty(ua.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(ha))ua.prototype[t]=function(){this._updateBoxStatus(e,s),s===oa&&(this._syncButtonText(),this._syncScroll())};const da=Object.freeze(Xo),_a=Object.freeze(sa),pa=Object.freeze(ra);var ma=Object.freeze({__proto__:null,constants:da,phrases:_a,templates:pa,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new ua(t,e,s)}});const fa=Object.freeze(bo),ga=Object.freeze(ma);var ya=Object.freeze({__proto__:null,ask:fa,hybridSearch:ga});const ba="ui";let wa,va;async function Ea(){return va||(va=U(wa||(wa=q(ba))))}class Sa{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class ka{constructor(t,e){this._plugin=t,this._client=e,m(this,{sources:{api:ks(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Br(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Ur(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Ia{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new To(this._plugin,this._MisoClient))}}Lt.plugins.use(class extends tt{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Co(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new N}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:ya};p(s,this,["layouts","combo","ready"]),m(this,{MisoClient:t}),m(t,{ui:s}),this.combo=new Ia(this,t);const n=Object.values(Ri).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:r,combos:o,...a}=Zo,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];Do.MisoClient=t,Yo.MisoClient=t;for(const e of c)e.MisoClient=t;await Ea();for(const t of c)S(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){m(t,{ui:new ka(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Sa(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new Jr(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new ro(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new ur(this,t)),e}});let Oa;const xa=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Oa="original",window.fetch;const t=document.createElement("iframe");return t.style.display="none",document.body.appendChild(t),Oa="restored",t.contentWindow.fetch})();class Aa extends tt{static get id(){return"idg"}constructor(){super("idg")}install(t,e){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(e.setCustomFetch(xa),function(...t){console.log("%cMiso","color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;","<plugin:idg>","[info]",...t)}(`Using ${Oa} native fetch`))}}const{currentScript:Ta}=document,Ca=Ta.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");function Ra(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${Ca}/${t}`}const Na=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",logo_image:"image/macworld.jpg",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",logo_image:"image/techhive.jpeg",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",logo_image:"image/pcwelt.jpg",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",logo_image:"image/macwelt.jpg",regions:[],ref_story:"2383200"}].map((({logo_image:t,...e})=>({logo_image:Ra(t),...e})));async function $a(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}function Pa(t){const e=new Date;return new Date(e.getFullYear()-t,e.getMonth(),e.getDate()).toISOString().substring(0,10)}function La({site:t,version:e,config:s}){const{aff_type:n}=s;return d({source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",aff_type:n,site:t.key,uuid:x()})}Na.reduce(((t,e)=>(t[e.key]=e,t)),{});const Ua=5e3;let qa,ja,Da=!1;async function Ma(){return ja||(ja=Promise.any([za(),Ba(),Fa(Ua)]))}async function Fa(t){return new Promise((e=>setTimeout((()=>{const t=x();Ha("Fallback",t),e(t)}),t)))}async function za(){const t=await $a((()=>window.gaGlobal&&window.gaGlobal.vid));return t&&Ha("GA4",t),t}async function Ba(){const t=(await(qa||(qa=async function(){return $a((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return t&&Ha("UA",t),t}const Qa="%cMiso",Ga="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Ha(s,n){!function(...s){(t.debug||e.indexOf("beta")>=0||"dev"===e)&&function(...t){console.log(Qa,Ga,...t)}(...s)}(`[${s}] Client ID: ${n}${Da?" (unused)":""}`),Da=!0}async function Wa(t){const e=await async function(t){let e=t.instances[0];if(e)return e;return new Promise((e=>{t.on("create",(()=>{e(t.instances[0])}))}))}(t);!function(t,e){t._logs=[];const s=e.meta.parent._pluginRoot.get("std:debug");for(const e of["_log","_logr"]){const n=s[e];s[e]=function(){n.apply(this,arguments),t._logs.push("_log"===e?Ka(arguments):arguments)}}}(t,e),function(t,e){const s=Date.now();function n({summary:e,timestamp:n,elapsed:i,operation:r,conflict:o}){t.debug("<progressive-markdown>",`[${(n-s)/1e3}](${i[0]/1e3}, ${i[1]/1e3})`,e,""+r,o)}e.ui.asks.useLayouts({answer:{onDebug:n}})}(t,e),function(t){const e=document.body,s=document.createElement("div");s.textContent="Miso Log",s.classList.add("miso-log-download-btn");const n=document.createElement("div");n.textContent=function(t){return"dev"===t||t.startsWith("v")?t:"v"+t}(window.miso_smart_answers_script_version),n.classList.add("miso-version");const i=document.createElement("div");i.classList.add("miso-log-container"),i.appendChild(n),i.appendChild(s),e.appendChild(i),s.addEventListener("click",(()=>function(t){const e=t._logs,s=new Blob([Va(e)],{type:"application/json"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=`miso-log.${(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}.jsonl`,i.click()}(t)))}(t),t.debug("<custom>","[ua]",""+navigator.userAgent)}function Va(t){return t.map((t=>JSON.stringify(Ja(t)))).join("\n")}function Ka(t){const[e,s,...n]=t;return[Ya(e),Za(s),...n]}function Ya(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}function Za(t){return`[${t}]`}function Ja(t,e=5){return"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>Ja(t,e-1))):function(t,e){const s=t.constructor.name,n="Object"===s?{}:{__type:s};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=Ja(i,e-1)))}return n}(t,e):t}function Xa({site:t,config:e,version:s}){Object.defineProperty(Lt,"name",{value:"smart-answers"});const n=s.indexOf("beta")>0,i=("dev"===s||n)&&e.logging;return("dev"===s||n||e.debug)&&Lt.plugins.use("std:debug",{console:{background:"#9033bb"}}),i&&Wa(Lt),Lt.plugins.use(Aa),e.test_product?(Lt.plugins.use("std:dry-run"),Lt.debug&&Lt.debug("[Answers] Test product: "+e.test_product)):!e.dry_run&&function(t){return window.location.hostname===t.hostname}(t)||Lt.plugins.use("std:dry-run"),window.MisoClientSA=Lt,Lt}async function tc({MisoClient:t,config:e}){const s={readConfigFromScriptUrl:!0};"staging"===e.api_host&&(s.apiHost="https://ask-api.askmiso-staging.com/v1");const n=window.misoSA=new t(s);return n.context.anonymous_id=await Ma(),n}const ec='<svg fill="currentColor" viewBox="0 0 24 24">\n<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z"/>\n</svg>';var sc={queryButton:"A.I. Search",home:{title:"Smart Answers from ${name}",queryPlaceholder:"Ask us a question",info:"What is this?"},story:{title:{nonempty:"Explore frequently asked questions",empty:"Explore with a question"},queryPlaceholder:{nonempty:"Ask your own question...",empty:"Ask a question..."}},answers:{title:"Smart Answers",subtitle:"Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.",feedback:{helpful:"Helpful",unhelpful:"Not Helpful"},sources:"My reply is based on the following",relatedResources:"Go beyond, and learn more about this topic",querySuggestions:"Related questions you can explore",followUp:{queryPlaceholder:"Ask a follow-up question",queryButton:"Ask"},affiliation:{title:"Best Prices Today: ${title}"},error:{title:"Oops!",description:"We are currently experiencing some difficulties. Would you please trying again later?"}},sponsor:{phrase:"Supported by",tooltip:"Our sponsors help keep Smart Answers running,<br>but do not influence our editorial independence."}},nc=Object.freeze({__proto__:null,default:sc,queryButton:sc.queryButton,home:sc.home,story:sc.story,answers:sc.answers,sponsor:sc.sponsor}),ic={queryButton:"KI-Suche",home:{title:"Smart Answers von ${name}",queryPlaceholder:"Stellen Sie uns eine Frage",info:"Was ist das?"},story:{title:{nonempty:"Hufig gestellte fragen entdecken",empty:"Hufig gestellte fragen entdecken"},queryPlaceholder:{nonempty:"Stellen Sie Ihre eigene Frage...",empty:"Stellen Sie Ihre eigene Frage..."}},answers:{title:"Smart Answers",subtitle:"Erhalten Sie Antworten auf Ihre Technikfragen durch KI, die ausschlielich auf Berichten und Tests unserer Experten basieren.",feedback:{helpful:"Hilfreich",unhelpful:"Nicht hilfreich"},sources:"Meine Antwort basiert auf folgenden Inhalten",relatedResources:"Erfahren Sie mehr ber dieses Thema",querySuggestions:"Verwandte Fragen, die Sie erforschen knnen",followUp:{queryPlaceholder:"Stellen Sie eine Anschlussfrage",queryButton:"Fragen Sie"},affiliation:{title:"Beste Preise heute: ${title}"},error:{title:"Hoppla!",description:"Wir erleben derzeit einige Schwierigkeiten. Wrden Sie es bitte spter noch einmal versuchen?"}},sponsor:{phrase:"Untersttzt von",tooltip:"Unsere Sponsoren helfen, Smart Answers am Leben zu halten, haben aber keinen Einfluss auf unsere redaktionelle Unabhngigkeit."}},rc=Object.freeze({__proto__:null,default:ic,queryButton:ic.queryButton,home:ic.home,story:ic.story,answers:ic.answers,sponsor:ic.sponsor});const oc=function(t){if("de"===t)return rc;return nc}("en");const ac="miso-smart-answers";function cc(t){return`\n<div class="miso-smart-answers">\n  ${function({sponsor:t}){return t?`\n<div class="${ac}__sponsor" data-brand="${t.key}">\n  <div class="${ac}__sponsor-text">${oc.sponsor.phrase}</div>\n  <div class="${ac}__sponsor-logo">\n    <img src="${Ra(t.image)}" alt="${t.name}">\n  </div>\n  <div class="${ac}__sponsor-info" tabindex="-1">\n    ${ec}\n    <div class="${ac}__sponsor-info-tooltip">${oc.sponsor.tooltip}</div>\n  </div>\n</div>`.trim():""}(t)}\n  <section class="question">\n    <div class="hero">\n      <div class="hero-inner">\n        <h2 class="title">${oc.answers.title}</h2>\n        <h4 class="slogan">${oc.answers.subtitle}</h4>\n      </div>\n    </div>\n    <miso-ask class="query-container">\n      <miso-query>\n        <input class="input" data-role="input">\n        <button class="button" data-role="button">\n          <i><svg fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg></i>\n          <span>${oc.queryButton}</span>\n        </button>\n        </miso-query>\n    </miso-ask>\n  </section>\n  <section class="answer">\n    ${dc()}\n    ${_c()}\n    ${pc()}\n  </section>\n  <section id="follow-ups" class="follow-ups">\n  </section>\n  <section id="related-resources" class="related-resources empty">\n    <miso-ask visible-when="ready" logo="false">\n      <div class="phrase related-resources">${oc.answers.relatedResources}</div>\n      <miso-related-resources></miso-related-resources>\n    </miso-ask>\n  </section>\n</div>`}function uc({title:t,block:e},s={}){return`\n<div class="affiliation">\n  ${s.title?function(t){return`<h3 class="title">${oc.answers.affiliation.title.replace("${title}",t)}</h3>`}(t):""}\n  ${e}\n</div>\n`}function lc(t,e){const{className:s}=t,{cover_image:n,title:i}=e;if(!n)return"";return`<div class="${s}__item-cover-image-container" aria-hidden="true">${`<img class="${s}__item-cover-image" src="${n}" alt="${i}">`}</div>`}function hc(t,e){const{className:s,templates:n}=t;return`\n<button type="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</button>\n`}function dc({parentQuestionId:t}={}){return`\n<miso-ask class="error-container" visible-when="erroneous" logo="false" ${mc(t)}>\n  ${t?"<hr>":""}\n  <h2 class="miso-error-header">${oc.answers.error.title}</h2>\n  <p class="miso-error-description">\n    ${oc.answers.error.description}\n  </p>\n  <miso-error></miso-error>\n</miso-ask>`}function _c({parentQuestionId:t}={}){return`\n<miso-ask visible-when="ready" logo="false" class="miso-circled-citation-index" ${mc(t)}>\n${t?"<hr>":""}\n  <miso-question></miso-question>\n  <miso-answer></miso-answer>\n  <miso-idg-affiliation></miso-idg-affiliation>\n  <miso-feedback></miso-feedback>\n</miso-ask>`}function pc({parentQuestionId:t}={}){return`\n<miso-ask class="sources-container miso-circled-citation-index" visible-when="ready" logo="false" ${mc(t)}>\n  <h4 class="phrase sources">${oc.answers.sources}</h4>\n  <miso-sources></miso-sources>\n</miso-ask>`}function mc(t){return t?`parent-question-id="${t}"`:""}const fc=new Map,gc=new Map;function yc(t){return t.startsWith("product_")?t.slice(8):t}async function bc(t){return vc(fc,t,Sc)}async function wc(t){return vc(fc,t,kc)}async function vc(t,e,s,...n){const i=e.filter((e=>!t.has(e)));if(i.length>0){const e=await s(i,...n);for(const s of i)t.set(s,e[s])}return e.reduce(((e,s)=>(e[s]=t.get(s),e)),{})}const Ec="111111";async function Sc(t){return await Oc("products-view",t,{product_block:"price-comparison",article_id:Ec})}async function kc(t){const e=await Oc("products-view",t,{article_id:Ec});for(const t in e)e[t]=Cc(e[t]);return e}async function Ic(t){const e=await async function(t,e,{fields:s}={}){if(0===e.length)return[];let n=`https://b2c-contenthub.com/wp-json/wp/v2/${t}?include=${e.join(",")}&per_page=100`;s&&(n+="&_fields="+s.join(","));const i=await window.fetch(n);return await i.json()}("product",t,{fields:["id","title"]});return function(t,e){const s={};for(const n of t)s[n[e]]=n;return s}(e,"id")}async function Oc(t,e,s={}){if(0===e.length)return[];let n=`/wp-json/idg/v2/${t}?include=${e.join(",")}&per_page=100&_embed=1`;for(const[t,e]of Object.entries(s))n+=`&${encodeURIComponent(t)}=${encodeURIComponent(e)}`;const i=await window.fetch(n);return await i.json()}const xc='data-vars-outbound-link="',Ac='data-vars-outbound-link="',Tc='data-miso-attribution="miso-smart-answers" data-miso-product-type="product" ';function Cc(t,e){return!!function({html:t}){return t.indexOf(xc)>=0}(t)&&(t=function(t){try{const{html:e}=t,s=e.indexOf(Ac);if(0>s)throw Error(`Cannot find '${Ac}' in product view HTML.`);t.html=e.substring(0,s)+Tc+e.substring(s)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t))}class Rc{constructor(t,e){this._workflow=t,this._context=Object.freeze({...e}),this._element=void 0,this._session=void 0,this._products=[],this._html=void 0,this._syncIndex=0,this._clicked=!1,t.on("data",(t=>this.updateData(t)))}async updateData({session:t,value:e}={}){if(!t)return;if(this._products.length>0&&this._session&&this._session.uuid===t.uuid)return;const s=this._getProducts(e);var n,i;(i=s,0===(n=this._products).length&&0===i.length||(n[0]&&n[0].product_id)===(i[0]&&i[0].product_id))||(this._session=t,this._products=s,this._sendInteraction("custom",{custom_action_name:"affiliation_response"}),this._syncView())}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=`.miso-smart-answers ${t?`miso-ask[parent-question-id="${CSS.escape(t)}"]`:"miso-ask:not([parent-question-id])"} miso-idg-affiliation`;if(this._element=document.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProducts(t){const{test_product:e}=this._context.config;if(e)return[{product_id:"product_"+e}];const{affiliation_products:s=[]}=t||{};return s||[]}async _syncView(){const t=this._syncIndex++;if(this._selected=await async function(t,e){const{debug:s}=e;if(0===t.length)return void s("[Affiliation] No affiliated products.");const[n,i]=await Promise.all([Nc(t,e),$c(t)]),r=[];for(const{product_id:e}of t){const t=n[e],s=i[e];if(t&&s){const n=yc(e);r.push({product_id:e,id:n,title:s,block:t})}}if(r.length>0)return Object.freeze(r[0]);return void s("[Affiliation] No non-empty views for affiliated products: "+t.map((({product_id:t})=>yc(t))).join(", "))}(this._products,this._context),this._syncIndex!==t+1)return;this._selected||this._sendInteraction("custom",{custom_action_name:"product_view_empty_response"});this._html=this._selected?uc(this._selected,{title:"product"!==this._context.config.aff_type}):"",this._requestRender(t)}async _requestRender(t){this._render(),this._selected&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._context.MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;const e=function(t,e,{root:s}){if("string"==typeof e){const t=e;e=e=>e.matches(t)?e:void 0}for(let n=t;n&&n!==s;n=n.parentElement){const t=e(n);if(t)return t}}(t,"a[href]",{root:this.element});e&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){const{client:s}=this._context,{questionId:n,parentQuestionId:i,rootQuestionId:r,session:o}=this._workflow,{question_source:a="_organic"}=o.meta||{},c=this._selected?[this._selected.product_id]:void 0,u=this._products.map((({product_id:t})=>t));s.api.interactions.upload(d({type:t,...e,product_ids:c,context:{custom_context:d({...La(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:r,parent_question_id:i,question_id:n,question_source:a,candidate_product_ids:u})}}))}}async function Nc(t,{config:e}){const s=t.map((({product_id:t})=>yc(t))),n=await("product"===e.aff_type?wc:bc)(s),i={};for(const{product_id:e}of t){const t=n[yc(e)];i[e]=t&&t.html&&t.html.trim()||""}return i}async function $c(t){const e={},s=[];for(const{product_id:n,title:i}of t)i?e[n]=i:s.push(n);if(s.length>0){const t=await async function(t){return vc(gc,t,Ic)}(s.map(yc));for(const n of s)e[n]=t[yc(n)].title}return e}const Pc="miso-smart-answers";let Lc,Uc,qc;function jc(t){const{config:e,site:s,client:n}=t,{aff_type:i}=e;Lc=document.querySelector(`.${Pc} #follow-ups`),Uc=document.querySelector(`.${Pc} #related-resources`),qc=document.querySelector(`.${Pc} #related-resources miso-ask`);const r=n.ui.asks,o=n.ui.ask;r.useApi("questions",{_meta:{site:s.key,aff_type:i},yearly_decay:.93,fq:Dc(t)});const a={imageBlock:lc};"de"===s.lang&&(a.date="de-DE"),r.useLayouts({answer:{onCitationLink:({setAttribute:t},{source:e={},index:s})=>{const{title:n}=e;t("aria-label",`Source ${s+1}: Read full article ${n}`)}},sources:{templates:a},related_resources:{templates:a},feedback:{templates:{option:hc,text:(t,e)=>oc.answers.feedback["helpful"===e?"helpful":"unhelpful"]}}}),r.on("feedback",(()=>{document.querySelectorAll(".miso-feedback").forEach((t=>{setTimeout((()=>{const e=t.dataset.selected,s=t.querySelector('button[data-value="helpful"]'),n=t.querySelector('button[data-value="unhelpful"]');s&&s.setAttribute("aria-pressed","helpful"===e?"true":"false"),n&&n.setAttribute("aria-pressed","unhelpful"===e?"true":"false")}),500)}))})),r.on("data",(({workflow:t,value:e})=>{const{sources:s,related_resources:n}=e||{};qc.workflow===t&&Qc(Uc,n),Qc(Bc(t,"sources-container"),s)})),r.useDataProcessor(Fc),r.useInteractions({preprocess:e=>function(t,e){return{...e,context:{...e.context,custom_context:{...La(t),...e.context&&e.context.custom_context}}}}(t,e)}),r.on("done",(({workflow:t})=>{Lc.insertAdjacentHTML("beforeend",function({parentQuestionId:t}){return`\n<div class="session">\n  <miso-ask class="query-suggestions-container" visible-when="initial" parent-question-id="${t}">\n    <h4 class="phrase query-suggestions">${oc.answers.querySuggestions}</h4>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="query-container" visible-when="initial loading" parent-question-id="${t}">\n    <miso-query>\n      <input class="input" data-role="input" placeholder="${oc.answers.followUp.queryPlaceholder}">\n      <button class="button" data-role="button">\n        <span>${oc.answers.followUp.queryButton}</span>\n      </button>\n    </miso-query>\n  </miso-ask>\n  ${dc({parentQuestionId:t})}\n  ${_c({parentQuestionId:t})}\n  ${pc({parentQuestionId:t})}\n</div>`}({parentQuestionId:t.questionId}))})),r.on("loading",(({workflow:t})=>{qc.workflow=t})),Mc(o,t),r.on("create",(e=>Mc(e,t))),o.on("loading",(()=>{Lc.innerHTML="",r.reset({root:!1})})),o.autoQuery()}function Dc(t){const{site:e}=t;return"de"===e.lang?`created_at:[${Pa(2)} TO *] AND type:story AND -custom_attributes.content_type:(DealPost BrandPost SponsoredContent) AND custom_attributes.languages:German`:`created_at:[${Pa(2)} TO *] AND type:story AND -custom_attributes.content_type:(DealPost BrandPost SponsoredContent) AND (custom_attributes.languages:English OR NOT _exists_:custom_attributes.languages)`}function Mc(t,e){t._affiliation=new Rc(t,e),Qc(Bc(t,"query-suggestions-container"),t.states.suggestions)}function Fc({value:t,...e}){if(!t)return e;const{sources:s=[],related_resources:n=[]}=t;return{value:{...t,sources:s.map(zc),related_resources:n.map(zc)},...e}}function zc({url:t,...e}){const{product_id:s}=e;if(t&&s&&t.indexOf("//b2c-contenthub.com/")>=0){const[e,n]=s.split("_");t=t.replace("//b2c-contenthub.com/",`//www.${n}.com/`)}return{url:t+=(0>t.indexOf("?")?"?":"&")+"utm=smart_answers",...e}}function Bc(t,e){const{parentQuestionId:s}=t,n=s?`[parent-question-id="${CSS.escape(s)}"]`:":not([parent-question-id])";return document.querySelector(`.${Pc} miso-ask.${e}${n}`)}function Qc(t,e){t&&t.classList[e&&0!==e.length?"remove":"add"]("empty")}const{currentScript:Gc}=document;async function Hc({MisoClient:t}){await Promise.all([Wc(t),Kc()])}async function Wc(t){await Yc(`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t.version}/dist/css/ui.css`)}let Vc=!1;async function Kc(){if(Vc)return;if(Vc=!0,!Gc)throw Error("currentScript not found");const t=Gc.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await Yc(s)}async function Yc(t){if(!document.querySelector(`link[href="${t}"]`))return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}const Zc=".layout--right-rail .wp-block-column";function Jc(t,e){const{aff_type:s}=t;return"random"!==s?s:function(t){let e=0;for(let s=0,n=t.length;n>s;s++)e=(e<<5)-e+t.charCodeAt(s)|0;return function(t){return t/2**32+.5}(e)}(e)>.2?"price_comparison":"product"}(async(t,s)=>{if("/smart-answers"!==window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=e;const i=Xa({site:t,config:s,version:e,sponsor:n}),r=i.debug||(()=>{});r("Miso Smart Answers script version: "+e);const o=document.querySelector(Zc);if(!o)return void console.error("Container not found: "+Zc);i.plugins.use("std:ui");const[a,c]=await Promise.all([tc({config:s,MisoClient:i}),Ma(),Hc({site:t,MisoClient:i})]);s={...s,aff_type:Jc(s,c)},o.innerHTML=cc({sponsor:n}),jc({site:t,config:s,client:a,MisoClient:i,debug:r,version:e,sponsor:n})})({key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},t)}();
