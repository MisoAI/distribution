!function(){"use strict";var t=Object.freeze({aff_type:"random",...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()}),e="1.0.19-beta.1";const s=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var n=function(){if(t.sponsor)return s.find((e=>e.key===t.sponsor))||void 0}();function i(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const o=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),r=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var a=Object.freeze({__proto__:null,GROUP:o,NAME:r});function c(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function l(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function u(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function h(t){return null==t}function d(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function _(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function p(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function m(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function f(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class g{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);b(s),b(n),b(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>y(this,t)),e):y(this,t),this._value=t}disconnect(){this._active=!1}}function y(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function b(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function w(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function v(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function E(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function S(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,o)=>{const r=new g((t=>{t&&(r.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),o(new DOMException("Aborted","AbortError"))}))}))}function k(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function O(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function I(t,e){const s=x((()=>window.localStorage.getItem(t))),n=x((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,o=e.indexOf(";",i);return decodeURIComponent(0>o?e.substring(i):e.substring(i,o))}(t))),i=s||n||""+e();return i&&!s&&x((()=>window.localStorage.setItem(t,i))),i&&!n&&x((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i))),i}function x(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function A(t){return new T(t)}class T{constructor(t){this._value=t;const e=t=>{this._value=t};_(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class C{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class R{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new C),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var N="1.12.7-beta.2";let $;try{$=document.currentScript}catch(t){}async function U(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(L(t))return;return new Promise((e=>{let s;s=setInterval((()=>{L(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function P(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${N}/dist/css/${t}.css`}function L(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function q(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function j(t,{depth:e=5,...s}={}){return D(t,e)}function D(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>D(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=D(i,e-1)))}return n}(t,e):t:"(...)"}function M(t,e){const s=Object.getOwnPropertyDescriptors(e),n=Object.getOwnPropertyDescriptors(t);for(const[e,i]of Object.entries(s))"constructor"!==e&&void 0===n[e]&&Object.defineProperty(t,e,i)}function z(t){const e={},s=new Set;for(let n=t;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:o}=i[n];o&&(e[n]="function"==typeof o?o.bind(t):o)}}return Object.freeze(e)}function F(t={},e={}){const s=t.metadata||e.metadata?u({...t.metadata,...e.metadata}):void 0,n=t._meta||e._meta?u({...t._meta,...e._meta}):void 0;return u({...t,...e,metadata:s,_meta:n})}function B(t={},e={}){const s=t.context&&t.context.custom_context||e.context&&e.context.custom_context?u({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context}):void 0,n=t.context||e.context?u({...t.context,...e.context,custom_context:s}):void 0;return u({...t,...e,context:n})}const Q=100,G=4;function W(t){const e=function({speed:t=Q,acceleration:e=G}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const o=e(n,s);return t+Math.max(i-n,0)*o/1e3}}const H=Symbol.for("miso:resources");class V{constructor(){this._resources=new Map;const t=window[H]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){Y(this._resources,t).resolve(e)}async get(t){return Y(this._resources,t).promise}}function Y(t,e){if(t.has(e))return t.get(e);const s=new C;return t.set(e,s),s}function K(){return window[H]||(window[H]=new V)}class Z{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new C;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class J{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)c(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&c(s,e)}}_injectSubscribeInterface(t){d(t,this,["on","once"])}}function X(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class tt{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:X(t,e),uuid:O()})}(t,e);_(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new J({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(tt,"miso:component");class et extends tt{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new C);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class st{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new g(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class nt{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:it}=document,ot=it.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function rt({}){await Promise.all([ct()])}let at=!1;async function ct(){if(at)return;if(at=!0,!it)throw Error("currentScript not found");const t=it.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}function lt(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${ot}/${t}`}const ut=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",logo_image:"image/macworld.jpg",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",logo_image:"image/techhive.jpeg",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",logo_image:"image/pcwelt.jpg",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",logo_image:"image/macwelt.jpg",regions:[],ref_story:"2383200"}].map((({logo_image:t,...e})=>({logo_image:lt(t),...e})));async function ht(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let o,r;function a(){o&&clearInterval(o),r&&clearTimeout(r)}o=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(r=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}function dt({site:t,version:e,config:s}){const{aff_type:n}=s;return u({source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",aff_type:n,site:t.key,uuid:O()})}function _t(){return u({page:u({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:pt()})}function pt(){const t=new URLSearchParams(window.location.search);let e=u({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}ut.reduce(((t,e)=>(t[e.key]=e,t)),{});const mt=5e3;let ft,gt,yt=!1;async function bt(){return gt||(gt=Promise.any([vt(),Et(),wt(mt)]))}async function wt(t){return new Promise((e=>setTimeout((()=>{const t=O();Ot("Fallback",t),e(t)}),t)))}async function vt(){const t=await ht((()=>window.gaGlobal&&window.gaGlobal.vid));return t&&Ot("GA4",t),t}async function Et(){const t=(await(ft||(ft=async function(){return ht((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return t&&Ot("UA",t),t}const St="%cMiso",kt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Ot(s,n){!function(...s){(t.debug||e.indexOf("beta")>=0||"dev"===e)&&function(...t){console.log(St,kt,...t)}(...s)}(`[${s}] Client ID: ${n}${yt?" (unused)":""}`),yt=!0}const It="%cMiso",xt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function At(...s){(t.debug||e.indexOf("beta")>=0||"dev"===e)&&function(...t){console.log(It,xt,...t)}(...s)}const Tt=new Map;async function Ct(t){return async function(t,e,s){if(t.has(e))return t.get(e);const n=await s(e);return t.set(e,n),n}(Tt,t,(async t=>await async function(t,e){return async function(t,e,{fields:s}={}){let n=`https://b2c-contenthub.com/wp-json/wp/v2/${t}/${e}`;s&&(n+="?_fields="+s.join(","));return async function(t){return(await window.fetch(t)).json()}(n)}("posts",t,e)}(t,{fields:["meta"]})))}async function Rt(t){const e={};let s;try{s=await Ct(t),At("Fetched post info",[s])}catch(s){return console.error("Cannot fetch post: "+t),console.error(s),e}try{if(e.contentType=s.meta.content_type,!e.contentType)throw Error("Blank meta.content_type: "+t)}catch(e){console.error("Cannot extract story type: "+t),console.error(e)}try{const{suppress_monetization:t='""'}=s.meta||{},n=JSON.parse(t);e.adSuppression=!0===n.content_ads}catch(e){console.error("Cannot extract suppress_monetization info: "+t),console.error(e)}return e}const Nt="home",$t="answers",Ut="search",Pt="article",Lt="other";var qt=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const jt={key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},Dt=window.location.hostname!==jt.hostname;var Mt={...jt,dev:Dt};var zt=Object.freeze(function(){const t=(e=window.location.pathname).endsWith("/")?e.substring(0,e.length-1):e;var e;switch(t){case"":return{type:Nt};case"/smart-answers":return{type:$t};case"/search":return{type:Ut};default:if(Mt.regions.indexOf(t.substring(1))>=0)return{type:Nt}}const s=t.substring(1).split("/");if("article"===s[0]){const t=""+s[1];return{type:Pt,postId:t,product_id:`article_${Mt.key}_${t}`}}return{type:Lt}}());const Ft="%cMiso",Bt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Qt=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var Gt=function(){if(qt.sponsor)return Qt.find((t=>t.key===qt.sponsor))||void 0}(),Wt=Object.freeze({__proto__:null,config:qt,version:e,site:Mt,page:zt,sponsor:Gt,debug:function(...t){(qt.debug||e.indexOf("beta")>=0||"dev"===e)&&function(...t){console.log(Ft,Bt,...t)}(...t)}}),Ht="1.12.7-beta.2";const Vt=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Yt{constructor(t,e){this._client=t,this._root=e,this._bulk=new Z(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i}={}){const{request:o={}}=this._client.options;i=i||o.timeout;const r="GET"!==s&&null!=e?JSON.stringify(e):void 0,a=i?AbortSignal.timeout(i):void 0,c=await(this._root._customFetch||window.fetch)(t,u({method:s,headers:n,body:r,cache:"no-cache",mode:"cors",signal:a})),l=await c.json();if(c.status>=400||l.errors){var h=Error(l.message);throw h.data=l,h.status=c.status,h}return l}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:o,body:r}=n[e];o>=400||i?s.reject({status_code:o,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t){const{apiKey:e}=this._client.options,s=t.filter((t=>t)).join("/");return`${`${this.getApiEndpoint(s)}/${s}`}?api_key=${window.encodeURIComponent(e)}`}getApiEndpoint(t){const{dataEndpoint:e=Vt.DATA_ENDPOINT,eventEndpoint:s=Vt.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const o of this._root._urlPasses)try{n=o({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){(t._error||console.error)(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const o of this._root._payloadPasses)try{n=o({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){(t._error||console.error)(e)}return n}applyHeaderPasses(t,{apiGroup:e,apiName:s,payload:n,headers:i,options:o}){const r=this._client;for(const a of this._root._headersPasses)try{i=a({client:r,apiGroup:e,apiName:s,payload:n,headers:i,options:o})||i}catch(e){(t._error||console.error)(e)}return i}}class Kt extends tt{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,o=this._apiPath,r=this._url({apiGroup:o,apiName:t,payload:e,options:s}),a=this._headers({apiGroup:o,apiName:t,payload:e,options:s}),c={apiGroup:o,apiName:t,payload:e=this._preprocess({apiGroup:o,apiName:t,payload:e,options:s}),url:r,headers:a,options:s};this._events.emit("request",{...c,...i});const l=await this._send(c),u={...c,response:l};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_headers({apiGroup:t,apiName:e,payload:s,options:n}){return this.helpers.applyHeaderPasses(this,{apiGroup:t,apiName:e,payload:s,headers:{},options:n})}_preprocess({apiGroup:t,apiName:e,payload:s,options:n}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s,options:n})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,headers:n,payload:i,options:{bulk:o,...r}={}}){return o?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,{...r,headers:n})}_postprocess({response:t}){return t.data}}const{GROUP:Zt,NAME:Jt}=a;class Xt extends Kt{constructor(t){super(t,Zt.INTERACTIONS)}async upload(t,e){try{return await this._run(Jt.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===Jt.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}class te{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const o=new nt(s);let r;e=i(this._ac.signal,o.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:o}={}){if(o&&o.aborted)return[];let r,a,c=0,l=!1;function u(){r&&clearInterval(r),l=!0}const d=new R;return r=setInterval((async()=>{let e,r,_;try{if([e,r,_]=await t(o?{signal:o}:{}),l||!h(a)&&a>=_)return;h(_)||(a=_),i&&i(e,r,_),c=0}catch(t){return n&&n(t),c++,void(c>s&&(u(),d.error(t)))}d.update(e,r),r&&u()}),e),o&&o.addEventListener&&o.addEventListener("abort",(()=>{u(),d.abort(o.reason)})),d}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?o.clear():this._isUpdated(r,t)&&o.touch(),r=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||se(t.answer)!==se(e.answer)||se(t.reasoning)!==se(e.reasoning)}_revisionOf(t){return t&&t.revision}}class ee extends te{constructor(t,e,s,n){super(n),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}function se(t=""){return t.length}const{GROUP:ne,NAME:ie}=a;class oe extends Kt{constructor(t){super(t,ne.ASK)}async questions(t,e={}){if(ce(t)&&(t={question_id:t}),t.question_id)return new re(this,t,e);const s=await this._run(ie.QUESTIONS,t,e);return new re(this,s,e)}async _questions(t,e){return this._run(ie.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${ie.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(ie.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(ie.TRENDING_QUESTIONS,t,e)}async search(t,e={}){if(ce(t)&&(t={question_id:t}),t.question_id)return new ae(this,t,e);const s=await this._run(ie.SEARCH,t,e);return s.question_id?new ae(this,s,e):s}async _searchGet(t,e){return this._run(`${ie.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(ie.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(ie.SEARCH_AUTOCOMPLETE,t,e)}}class re extends ee{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class ae extends ee{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),_(this,e),this._response=e}get questionId(){return this._id}}function ce(t){return"string"==typeof t&&"{"!==t.charAt(0)}const{GROUP:le,NAME:ue}=a;class he extends Kt{constructor(t){super(t,le.SEARCH)}async search(t,e){return this._run(ue.SEARCH,t,e)}async autocomplete(t,e){return this._run(ue.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(ue.MGET,t,e)}}const{GROUP:de,NAME:_e}=a;class pe extends Kt{constructor(t){super(t,de.RECOMMENDATION)}async userToProducts(t,e){return this._run(_e.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(_e.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(_e.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(_e.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(_e.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(_e.PRODUCT_TO_PRODUCTS,t,e)}}class me extends tt{constructor(t,e){super("api",t),this._client=t,this.helpers=new Yt(t,e),this.interactions=new Xt(this),this.ask=new oe(this),this.search=new he(this),this.recommendation=new pe(this)}}var fe=Object.freeze({__proto__:null,Api:me,ApiBase:Kt,ApiHelpers:Yt,Interactions:Xt,Ask:oe,Search:he,Recommendation:pe});class ge extends tt{constructor(t){super("context",t),this._client=t}}var ye={api:fe,context:{Context:ge}};class be{constructor(t){_(this,{install:t})}}class we extends et{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new ve(this,ye),this.plugins=new Ee(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new C);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addHeadersPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._headersPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return _(n,{id:t}),this._tryConfig(n,e),n;case"function":return new be(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,o=t.lastIndexOf("/",i)+1,r=t.indexOf(".",o),a=0>r?"":t.slice(r,i);return`${t.slice(0,o)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new K).get(s);!this.isRegistered(t)&&this.register(n)}}class ve{constructor(t,e){d(this,t,["getPluginClass","addSubtree","addPayloadPass","addHeadersPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),_(this,{classes:e})}}class Ee{constructor(t){d(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Se=new class extends tt{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new we(this),this._clients=[],this._payloadPasses=[],this._headersPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=Ht,this._cmdRes=new C}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var ke=Object.freeze({__proto__:null,viewable:S,debounce:q});const{currentScript:Oe}=document;class Ie extends tt{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Ie),window.MisoClient?window.MisoClient!==Ie&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Ie}static debug(){}constructor(t){super("client",Se),this._config(t),this.context=new ge(this),this.api=new me(this,Se),function(t){Se._clients.push(t),Se._events.emit("create",t)}(this)}get version(){return Ie.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.request&&t.request.sendApiKeyByHeader&&console.warn('`sendApiKeyByHeader` option is deprecated. Please call `MisoClient.plugins.use("std:header-api-key");` instead.'),t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,u(t)}_readConfigFromScriptUrl(){return u({apiKey:new URL(new Request(Oe.src||Oe.href).url).searchParams.get("api_key")||void 0})}}Ie.helpers=ke,_(Ie,{uuid:O()});var xe=function(t){const e=Se._pluginRoot;return Se.MisoClient=e.MisoClient=t,d(t,Se,["version","instances","any","meta","on","once","cmdDone"]),d(t,e,["plugins"]),t}(Ie);const{GROUP:Ae,NAME:Te}=a;let Ce;class Re{constructor(t){this._plugin=t,this._props={}}get anonymous_id(){return this._props.anonymous_id||Ce||(Ce=I("miso_anonymous_id",O))}set anonymous_id(t){this._requireString("anonymous_id",t),this._set("anonymous_id",t)}get user_id(){return this._props.user_id}set user_id(t){this._requireString("user_id",t),this._set("user_id",t)}get user_hash(){return this._props.user_hash}set user_hash(t){this._requireString("user_hash",t),this._set("user_hash",t)}get user_type(){return this._props.user_type}set user_type(t){this._requireString("user_type",t),this._set("user_type",t)}get site(){return this._props.site}set site(t){this._requireString("site",t),this._set("site",t)}get auth(){return this._props.auth}set auth(t){this._requireString("auth",t),this._set("auth",t)}_set(t,e){this._props[t]=e,this._plugin._events.emit("set",`${t} = '${e}'`)}_requireString(t,e){if("string"!=typeof e&&void 0!==e)throw Error(t+" must be a string");return e}}function Ne(){const t=new URLSearchParams(window.location.search);let e=u({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class $e{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Ue(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:Ht};return s.uuid||(s.uuid=O()),{...t,context:{...e,custom_context:s}}}const Pe="std:native-fetch";let Le,qe;const je=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Le="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Le="borrowed",t.contentWindow.fetch}catch(t){qe=t}})();const De="std:header-api-key";const Me="miso-logdump",ze="miso-logdump",Fe=ze+"__download-btn",Be="Miso Log";class Qe{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Ve||(Ve=U(P("logdump")))}();let t=document.getElementById(Me);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Be,e.classList.add(Fe),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Me,t.classList.add(ze),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Me),e=t&&t.querySelector("."+Fe);e&&(e.textContent=this._options.logDownloadButtonText||Be)}hideDownloadButton(){const t=document.getElementById(Me);t&&(t.style.display="none")}download(){const t=new Blob([We(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Ge()})}return t&&"string"==typeof t?t:`miso-log.${Ge()}.jsonl`}clear(){this._logs=[]}}function Ge(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function We(t){return t.map((t=>JSON.stringify(j(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),He(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function He(t){return t?j(t,{depth:2}):t}let Ve;const Ye="std:debug";function Ke(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}xe.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Qe(t)}static get id(){return Ye}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Ye,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...o}){const r=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+r),"interactions"===e){const t=o.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...o,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Ke)):this._log(t,e,Ke(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Pe}install(t,e){je?(e.setCustomFetch(je),t.debug(`<plugin:${Pe}>`,"[info]",`Using ${Le} native fetch`)):t.debug(`<plugin:${Pe}>`,"[error]","Failed to obtain native fetch: "+qe.message)}},class{static get id(){return De}install(t,e){e.addUrlPass(this._modifyUrl.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),t.debug(`<plugin:${De}>`,"[info]","Send API key in header")}_modifyUrl({url:t}){return t.replace(/[?&]api_key=[^&]*/g,"")}_modifyHeaders({client:t,headers:e}){const{apiKey:s}=t.options;return s?{...e,"X-API-KEY":s}:e}}),xe.plugins.use(class extends tt{static get id(){return"std:context"}constructor(){super("context")}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Re(this);var s,n;s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type","site","auth"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyHeaders({client:t,headers:e}){const{auth:s}=t.context;return s&&(e={...e,Authorization:s}),e}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return n?e===Ae.INTERACTIONS?s===Te.UPLOAD?this._modifyPayloadForInteractions(t,n):n:this._modifyPayloadForQueries(t,n):n}_modifyPayloadForQueries(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:o,site:r}=t.context;return F(e,{...s?{user_id:s,user_type:i,user_hash:n}:{anonymous_id:o},metadata:r?{site:r}:void 0})}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n,site:i}=t.context,o={anonymous_id:s,user_id:n},r=i?{site:i}:void 0,a=r?{custom_context:r}:void 0;return{data:e=e.map((t=>B(t,{...o,context:a})))}}}),xe.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...u({page:u({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Ne()}),...t.context}})))}}}),xe.plugins.use(class extends tt{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new $e(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===o.SEARCH)if(s===r.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),xe.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Ue)}}}),xe.plugins.use(class extends tt{static get id(){return"std:api-patch"}constructor(){super("api-patch")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._patchApiPayload.bind(this))}_patchApiPayload(t){let{payload:e,...s}=t;return e?(e=this._copyMetadataToMeta(e,s),e=this._suppressMetadata(e,s),e=this._suppressUserType(e,s),e):e}_copyMetadataToMeta(t,{apiGroup:e}){return e===o.ASK&&t.metadata?{...t,_meta:t.metadata}:t}_suppressMetadata(t,{apiGroup:e}){switch(e){case o.SEARCH:case o.RECOMMENDATION:const{_meta:e,metadata:s,...n}=t;return n;default:return t}}_suppressUserType(t,{apiGroup:e}){switch(e){case o.SEARCH:case o.RECOMMENDATION:const{user_type:e,...s}=t;return s;default:return t}}});const Ze="data-miso-product-id",Je="default",Xe=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ts=new Set([Xe.PRODUCTS,Xe.CATEGORIES,Xe.ATTRIBUTES,Xe.RESULTS,Xe.ITEMS,Xe.QUESTION,Xe.ANSWER,Xe.REASONING,Xe.IMAGES,Xe.SOURCES,Xe.RELATED_RESOURCES,Xe.FOLLOW_UP_QUESTIONS,Xe.QUERY_SUGGESTIONS,Xe.RELATED_QUESTIONS,Xe.AFFILIATION,Xe.FACETS,Xe.TOTAL]);function es(t){return ts.has(t)}const ss=new Set([Xe.PRODUCTS,Xe.IMAGES,Xe.SOURCES,Xe.RELATED_RESOURCES]);const ns=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),is=[ns.IMPRESSION,ns.VIEWABLE,ns.CLICK,ns.SUBMIT,ns.FEEDBACK],os=[ns.IMPRESSION,ns.VIEWABLE,ns.CLICK],rs=new Set(os);const as=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),cs=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),ls=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function us(t){if(0>is.indexOf(t))throw Error("Unrecognized event type: "+t)}const hs=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"}),ds=Object.freeze({QUERY:"query",REFINE:"refine",MORE:"more"});function _s(t,e){return Object.freeze({...t,...e,members:ps(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function ps(t=[],e=[]){return[...new Set([...t,...e])]}function ms(t,e){let s={};for(const n of t)n&&(s=e(s,n));return u(s)}function fs(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function gs(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>Object.assign(t,{...e,payload:F(t.payload,e.payload)})))}function ys(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function bs(t){if(void 0===t)return;let[e,s]=l(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function ws(t,e){return!1===(e=bs(e))[0]?e:t&&e?[e[0]||t[0],vs(t[1],e[1])]:e||t}function vs(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Es=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Ss(t={}){t=fs(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))ks(e);return t}function ks(t={}){return t=fs(t)}function Os(t={},e={}){const s={...t};for(const[n,i]of Object.entries(e))void 0!==i&&(s[n]=is.includes(n)?Is(t[n],i):i);return s}function Is(t={},e={}){return{...t,...e}}function xs(t){return void 0===t?void 0:"function"!=typeof t?()=>t:t}const As=[{key:hs.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return u({group:s,name:t,payload:e})},merge:gs},{key:hs.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${Xe.PRODUCTS}: ... }) instead`),t={...s,[Xe.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[ys(e)]=bs(s);return n},merge:function(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=ws(t[s],n);return t}))}},{key:hs.DATA_PROCESSOR,normalize:function(t){t=l(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:hs.TRACKERS,normalize:function(t={}){t=fs(t);const{active:e,...s}=t,n={};for(const[t,e]of Object.entries(s))n[t]=Ss(e);return{active:e,...n}},merge:function(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>{for(const[s,n]of Object.entries(e))void 0!==n&&(t[s]="active"===s?n:Os(t[s],n));return t}))}},{key:hs.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=l(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:hs.FILTERS,normalize:fs,merge:function(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>Object.assign(t,e)))}},{key:hs.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&ms(t,((t,e)=>Object.assign(t,e)))}},{key:hs.TEMPLATES,normalize:function(t={}){const e={};for(const[s,n]of Object.entries(t))e[s]=xs(n);return e},merge:function(...t){return ms(t,((t,e)=>{for(const[n,i]of Object.entries(e))t[n]=(s=t[n],xs(i)||s);var s;return t}))}}];class Ts{constructor(){this._events=new J({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Cs{constructor(t={},e={}){this._events=new J({target:this}),this._defaults=e,this._context=t||{},this._locals={},_(this,{resolved:new Rs(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Rs{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,n=s._context[t];this._cache[t]=e(s._defaults[t],n&&n.get(),s._locals[t])}return this._cache[t]}}class Ns{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of As){const{key:e,normalize:s,merge:n}=t;Object.defineProperty(Ts.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ns(this,this._globals,e,s,n))}}),Object.defineProperty(Cs.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ns(this,this._locals,e,s,n))}}),Object.defineProperty(Rs.prototype,e,{get:function(){return this._get(t)}})}const $s=[hs.API,hs.LAYOUTS,hs.DATA_PROCESSOR,hs.TRACKERS,hs.INTERACTIONS];function Us(t,e=$s){for(const s of e)Ps(t,s)}function Ps(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}const Ls="q",qs="qs";function js(t={}){const{setValue:e,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:n=Ls,sourceParam:i=qs,...o}={}){return{setValue:t,focus:e,updateUrl:s,param:n,sourceParam:i,...o}}(t),o=new URLSearchParams(window.location.search),r=o.get(n),a=o.get(i)||void 0,{layout:c}=this._views.get(Xe.QUERY);c&&(r&&e&&(c.value=r),!r&&s&&c.focus()),r&&this.query(u({q:r,qs:a}))}function Ds({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:n}=this._autoQuery,i=t&&(t.question||t.keyword)||e&&e.payload&&(e.payload.question||e.payload.q),o=e&&e.payload&&e.payload.metadata&&e.payload.metadata.question_source;if(!i)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(n)||ls.ORGANIC;i===a&&o===c||(r.searchParams.set(s,i),o===ls.ORGANIC?r.searchParams.delete(n):r.searchParams.set(n,o),window.history.replaceState({},"",r))}class Ms extends tt{constructor(t,e,s){super(t,e),this._name=t,this._plugin=e,this._client=s,this._options=new Ts}}function zs(t){return t?"view:"+t:"view"}Us(Ms.prototype);class Fs{constructor(t={}){(this._events=new J)._injectSubscribeInterface(this),this._options=t,this._states={},_(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const n=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(n),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(n)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Bs{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:O(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function Qs(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Gs{constructor(t,{source:e,options:s,polling:n=!0}){this._hub=t,this._source=e,this._options=s,this._polling=n,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t}async _handleRequest(t){if(!this.active)return;const{session:e,...s}=t;try{const{signal:n}=this._ac||{},i={...t.options,signal:n},o=await this._source({session:e,...s,options:i});if(o&&o[Symbol.asyncIterator]){if(o._response&&this._emitResponseWithSessionCheck({session:e,request:s,value:o._response}),this._polling){let t;for await(t of o){if(!Qs(this._hub,e))break;this._emitResponse({session:e,request:s,value:t})}}}else this._emitResponseWithSessionCheck({session:e,request:s,value:o})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:s,error:t})}}_emitResponseWithSessionCheck(t){Qs(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ws{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{c(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Hs,VIEWABLE:Vs,CLICK:Ys}=ns,{UNTRACKED:Ks,TRIGGERED:Zs}=as,Js=Object.freeze({[Hs]:Ks,[Vs]:Ks,[Ys]:Ks});class Xs{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Js}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Ks}set(t,e,s){us(e),function(t){if(t!==as.UNTRACKED&&t!==as.TRACKING&&t!==as.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of l(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Zs))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...Js}))))[e]=s}}const tn=[Symbol("itemless")];class en{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new Xs(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){us(t);const{options:n}=this;if(!n||!1===n.active)return;this._syncSession();const{deduplicated:i=!0,itemless:o=!1}=n;if(i){if(o&&(e=tn),0===(e=this._states.untriggered(l(e),t)).length)return;this._states.set(e,t,as.TRIGGERED)}this._sendToHub({type:t,items:o?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:ns.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(u({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Xs(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[zs(this._role)]}}for(const t of os)en.prototype[t]=function(e,s){this._trigger(t,e,s)};function sn(t){return t&&t.meta&&t.meta.empty}class nn{constructor(t,e){this._events=new J({target:this}),this._views=t,this._mapping=rn((t._roles.mappings||{})[e]||e),_(this,{role:e,interface:new on(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ws((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===Xe.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new en({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((i=e)===(o=n)||i&&o&&i.status===o.status&&i.error===o.error&&i.value===o.value&&i.ongoing===o.ongoing&&sn(i)===sn(o)&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(i.session,o.session)))return;var i,o;const{session:r,status:a,ongoing:c,request:l,meta:u,value:h}=e,d={session:r,status:a,ongoing:c,request:l,meta:u,data:h,...an(this.role,e)},_=(t={},e)=>{!1!==t&&this.updateState({...d,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:_})}catch(t){this._error(t),_({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?cs.ERRONEOUS:t.status;t=this._state=Object.freeze(u({...t,status:s}));const{role:n}=this;this.hub.update(zs(n),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:n,meta:i,...o}=t,r={value:this._mapping(t,this),status:n,data:e,meta:i,...o};return this.role===Xe.CONTAINER&&(r.meta={...i,empty:this._isContainerEmpty(t)}),u(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!es(s))continue;if(!cn(s,rn((this._views._roles.mappings||{})[s]||s)(t,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class on{constructor(t){d(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function rn(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function an(t,e){return function(t){return t.status===cs.READY&&!t.ongoing}(e)?{empty:!!cn(t,e&&e.value)}:{}}function cn(t,e){switch(t){case Xe.ANSWER:case Xe.REASONING:return!e||!e.value;default:return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}}function ln(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class un{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new J({target:this,error:s}),_(this,{facets:new hn(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return u({facets:Object.freeze({}),sort:ln(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(u({...t,...e,facets:Object.freeze(u({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class hn{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const dn=Symbol.for("miso:tracked");function _n(t){return!!t[dn]}function pn(t){t[dn]=!0}const mn=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function fn(t,e){return!!e&&{...t,...e}}class gn{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i,options:o}){this._hub=t,this._workflow=e,this._workflowName=e._name,this._extensions=s,this._layoutFactory=n,this._options=o,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new un(this);for(const t of i.members)t!==Xe.CONTAINER&&(this._views[t]=new nn(this,t));_(this,{interface:new yn(this),trackers:new bn(this,i.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on("data",(t=>this.refresh({data:t}))),o.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new nn(this,Xe.CONTAINER);e.layout=this._createLayout(Xe.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===Xe.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return u({...mn,...i,impression:fn(mn.impression,e),viewable:fn(mn.viewable,s),click:fn(mn.click,n)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=Xe.CONTAINER;this._containerTracker=new en({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class yn{constructor(t){this._actor=t,d(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class bn{constructor(t,e){this._views=t;for(const s of e)s!==Xe.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,Xe.CONTAINER,{get:()=>t._getContainerTracker()})}}class wn{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:ns.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class vn{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=l(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function En(t){return async({group:e,name:s,payload:n,options:i})=>{if(e===o.ASK)switch(s){case r.QUESTIONS:return t.api.ask.questions(n,i);case r.SEARCH:return t.api.ask.search(n,i)}return t.api[e]._run(s,n,i)}}class Sn{constructor({role:t,workflow:e,...s}={}){_(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=A(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,E((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),o=A([]),r=A({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:o.args,writeToState:r.merge,...e}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),n&&n(...o.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function kn(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function On(t,e,s,n){const{templates:i}=t,[o,r]=Fn(t,s);return""+o+(i.indexBlock||Mn)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Tn)(t,s,n)+r}function In(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Rn)(t,e,s)+(i.descriptionBlock||$n)(t,e,s)+(i.priceBlock||qn)(t,e,s)+(i.ctaBlock||zn)(t,e,s)}</div>`}function xn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Rn)(t,e,s)+(i.descriptionBlock||$n)(t,e,s)+(i.priceBlock||qn)(t,e,s)}</div>`}function An(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Rn)(t,e,s)+(i.dateBlock||Un)(t,e,s)+(i.descriptionBlock||$n)(t,e,s)+(i.ctaBlock||zn)(t,e,s)}</div>`}function Tn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Rn)(t,e,s)+(i.authorsAndDateBlock||Ln)(t,e,s)}</div>`}function Cn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Rn)(t,e,s)}</div>`}function Rn({className:t},{title:e,_title_with_markups:s}){const n=Wn(s)||k(e);return n?`<div class="${t}__item-title">${n}</div>`:""}function Nn({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function $n({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${Wn(e)}</div>`:s?`<div class="${t}__item-desc">${k(s)}</div>`:""}function Un({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const o=i||s||n;return o?`<div class="${t}__item-date">${Gn(o,e.date)}</div>`:""}function Pn({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function Ln(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-authors-and-date-container">${""+(i.authorsBlock||Pn)(t,e,s)+(i.dateBlock||Un)(t,e,s)}</div>`}function qn(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:o,currency:r="USD"}=e,a=i||o;if(!a)return"";const c=void 0!==o&&void 0!==i&&o>i,l=e.discount_rate_percent||(c?Math.floor(100*(1-i/o)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${o}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(n.discountRateText||jn)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function jn(t,{discount_rate_percent:e}){return`(${e}% off)`}function Dn(t,e,s={}){const{className:n,templates:i}=t,{cover_image:o,image_src:r,image_alt:a}=e;if(!o&&!r)return"";const c=r?"image":"cover-image";return`<div class="${n}__item-${c}-container">${"image"===c?`<img class="${n}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${n}__item-${c}" src="${o}">`}${"cover-image"===c&&s.brand?(i.brandBlock||Nn)(t,e,s):""}</div>`}function Mn({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function zn(t,e,s){const{className:n,templates:i}=t,o=Hn.asFunction(i.cta)(t,e,s);return o?`<div class="${n}__item-cta-container">${o}</div>`:""}function Fn({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:o="item",...r}={}){const a=!1!==r.link&&n?"a":"div",c=!1!==r.link&&n?`href="${n}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:n=!0}=t;let i="";n&&(e&&(i+=` target="${e}"`),s&&(i+=` rel="${s}"`));return i}(e.link)}`:"";return[`<${a} class="${t}__${i}" ${o?`data-role="${o}"`:""} ${s?`${Ze}="${s}"`:""} ${c}>`,`</${a}>`]}const Bn=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Qn="en-US";function Gn(t,e=Bn){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Bn.locale,e);default:throw Error("Invalid date format: "+e)}}function Wn(t){return t&&t.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Hn=Object.freeze({tagPair:Fn,formatDate:Gn,formatNumber:function(t,e=Qn){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||Qn.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},formatHtmlWithMarkup:Wn,escapeHtml:k,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Vn extends Sn{constructor({className:t,templates:e,...s}={}){super(s),_(this,{className:t,templates:{...kn("root"),...e,helpers:Hn}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Yn extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Yn.MisoClient.ui.layouts.create("banner").render(this)}}class Kn{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await S(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Zn extends Sn{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Kn}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Yn.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===Xe.PRODUCTS||t===Xe.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:o=!1,unanswerable:r=!1}={}}=e,a=[s,o?cs.EMPTY:cs.NONEMPTY];s===cs.READY&&a.push(n?cs.ONGOING:cs.DONE),r&&a.push(cs.UNANSWERABLE),t.setAttribute("status",a.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===cs.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Jn=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:o}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,o)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Xn extends Vn{static get type(){return"error"}static get defaultTemplates(){return Jn}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Jn,...e},...s})}}const ti=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function ei(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class si{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,o=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],l=Object.freeze({index:r,key:a,value:e[r],element:c});n.set(a,l),i.set(c,l),o.push(l)}return{k2b:n,e2b:i,entries:o}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},o=ei(i,n),r=ei(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:o,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function ni(t){M(t,ii.prototype)}class ii{_initTrackable(){this._bindings=new si,this._viewables=new Kn}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:o,unbounds:r}=this._bindings.update(n,s,i);this._onBindingsUpdate(o,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!_n(e)&&0===e.button&&!e.defaultPrevented&&!!w(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&(pn(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class oi{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===cs.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let n=!1;try{await S(e,{area:1,duration:0,signal:s.signal}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const ri=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[o,r]=Fn(t,s);return""+o+(i.imageBlock||Dn)(t,s,n)+(i.infoBlock||i.productInfoBlock||xn)(t,s,n)+r},article:function(t,e,s,n){const{templates:i}=t,[o,r]=Fn(t,s);return""+o+(i.imageBlock||Dn)(t,s,n)+(i.infoBlock||i.articleInfoBlock||An)(t,s,n)+(i.indexBlock||Mn)(t,s,n)+r},compactArticle:On,image:function(t,e,s,n){const{templates:i}=t,[o,r]=Fn(t,s);return""+o+(i.imageBlock||Dn)(t,s,n)+(i.infoBlock||i.imageInfoBlock||Cn)(t,s,n)+r},question:function(t,e,s){const[n,i]=Fn(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i,options:o}=t,{status:r}=e;return`<div class="${s} ${r}"${n?` data-role="${n}"`:""}${o.itemType?` data-item-type="${o.itemType}"`:""}>${r===cs.READY?i[r](t,e):""}${i.trigger(t,e)}${i.loading(t,e)}</div>`},[cs.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e)||[];return n.length>0||e.ongoing?s.body(t,e,n):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:n,templates:i,options:o}=t,r=i.ordered?"ol":"ul";return`<${r} class="${n}__list" data-role="list"${o.itemType?` data-item-type="${o.itemType}"`:""}>${i.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let o=n;return s.map((s=>i.item(t,e,s,o++))).join("")},item:function(t,e,s,n){const{className:i,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${i}__item">${o[a](t,e,s,{index:n})}</li>`},productInfoBlock:xn,articleInfoBlock:An,compactArticleInfoBlock:Tn,imageInfoBlock:Cn,brandBlock:Nn,titleBlock:Rn,descriptionBlock:$n,dateBlock:Un,authorsBlock:Pn,authorsAndDateBlock:Ln,priceBlock:qn,discountRateText:jn,ctaBlock:zn,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[o,r]=Fn(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Hn.asFunction(n.ctaText)(t,e,s);return a?`${o}${a}${r}`:""},imageBlock:Dn,indexBlock:Mn,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class ai extends Vn{static get defaultTemplates(){return ri}constructor({templates:t,itemType:e="product",...s}){super({templates:{...ri,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value&&(t.value.products||t.value)}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}ni(ai.prototype),M(ai.prototype,oi.prototype);const ci="miso-list";class li extends ai{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ci}constructor({className:t=ci,...e}={}){super({className:t,...e})}}const ui="miso-horizontal";class hi extends ai{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ui}constructor({className:t=ui,...e}={}){super({className:t,...e})}}const di="miso-cards";function _i(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function pi(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function mi(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),n=e[2]||"";return[s,n]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function fi(t){return void 0===t||t instanceof gi?t:new gi(t)}class gi{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=fi(t),fi([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class yi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,E((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),n=e.itemCount,i=e.itemCount=s?s.length:void 0;i!==n&&(void 0===i?e.itemIndex=void 0:void 0===n&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(_i(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let n=0;for(const e of s.children)pi(e,"active",n===t),n++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const bi="miso-ui-icon",wi=bi+"-svg-1_12_7-beta_2",vi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},Ei=`<symbol id="${bi}-${vi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Si=`<symbol id="${bi}-${vi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,ki=`<symbol id="${bi}-${vi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,Oi=`<svg id="${wi}" style="display:none;">${[Ei,Si,ki,`<symbol id="${bi}-${vi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${bi}-${vi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${bi}-${vi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${bi}-${vi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let Ii=!1;function xi(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${bi}-${t}"></use></svg>`}Ii||document.head.querySelector("#"+wi)||(Ii=!0,document.head.insertAdjacentHTML("beforeend",Oi));const Ai=new Set(Object.values(vi));xi(vi.SEND),xi(vi.SEARCH);const Ti=xi(vi.TRIANGLE);xi(vi.TRIANGLE_EQ);const Ci=xi(vi.CHEVRON),Ri=xi(vi.CHEVRON_NEGATIVE),Ni=xi(vi.BULB),$i="miso-carousel",Ui=Object.freeze({body:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__viewport"><div class="${n}__viewport-inner">${i.list(t,e,s)}</div></div>${i.controls(t,e,s)}`},controls:function(t,e,s){const{templates:n}=t;return`${n.controlContainer(t,e,"previous")}${n.controlContainer(t,e,"next")}${n.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-container-${s}">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?Ri:Ci},indexIndicator:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${n}__index-indicator-item">${i.indexIndicatorItem(t,e,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Pi=Object.freeze({...ai.defaultTemplates,...Ui});class Li extends ai{static get type(){return"carousel"}static get defaultTemplates(){return Pi}static get defaultClassName(){return $i}constructor({className:t=$i,templates:e,...s}={}){super({className:t,templates:{...Ui,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){M(t,yi.prototype)}(Li.prototype);const qi="16rem",ji=Object.freeze({...ai.defaultTemplates,item:function(t,e,s,n){const{className:i,templates:o,options:r}=t,{itemType:a}=r,c=o[a](t,e,s,{index:n});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),Di="miso-gallery";class Mi extends ai{static get type(){return"gallery"}static get defaultTemplates(){return ji}static get defaultClassName(){return Di}constructor({className:t=Di,templates:e,...s}={}){super({className:t,templates:{...ji,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=s?void 0:this._bodyHtml(t),i=this._itemsHtml(t,e);return{...t,...u({incremental:s,bodyHtml:n,itemsHtml:i})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const n=this._renderListElement(t,e,s);n&&(this._syncListAspectRatio(n),this._renderItems(n,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:n}=e;return s||(t.innerHTML=n),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,n=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,n)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const n=t.children.length,i=this._writeItemSizes((this._getItems(e)||[]).slice(n),s,n);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,i,{offset:n}))}_writeItemSizes(t,[e=0,s=0]=[],n=0){let i=0;n>0&&(i=Math.min(n,e),n-=i,e-=i),n>0&&(i=Math.min(n,s),n-=i,s-=i);const o=[];for(const n of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),o.push({...n,_size:t})}return o}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=fi(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:n}=e,{height:i=qi}=this.options,o=mi(i),r=t.clientWidth;if(0===r)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(r*n.width*2/(o*n.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),n=t;const i=Math.min(Math.floor(s/3),n);n-=i,s-=3*i;const o=Math.min(s,n);return n-=o,s-=o,[i,o,n]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,n=0]=e;const{className:i}=this;for(const e of t.children){let t=!1,o=!1;s>0?(t=!0,s--):n>0&&(o=!0,n--),pi(e,i+"__item-large",t),pi(e,i+"__item-medium",o),pi(e,i+"__item-small",!t&&!o)}}}const zi="miso-search-box";const Fi=Object.freeze({root:function(t){const{className:e,templates:s,role:n,options:i,autocomplete:o}=t,{placeholder:r}=i;return`\n<div class="${e}" ${n?`data-role="${n}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${o.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=e;var o;return("function"==typeof n?n(t):""+n)+("function"==typeof i?i(t):(Ai.has(o=i)?xi(o):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const o=[],r=[];for(const t of e)(t.product?o:r).push(t);return s.queries(t,r)+(r.length>0&&o.length>0?"<hr>":"")+s.products(t,o)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__${e}-list" data-role="${e}-list">${s.map((s=>i.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||k(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=s.helpers.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:Dn,productInfoBlock:xn}),Bi=Object.freeze({className:"miso-autocomplete",debounce:300});class Qi extends Vn{static get type(){return"search-box"}static get defaultTemplates(){return Fi}static get defaultClassName(){return zi}constructor({className:t=zi,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...Fi,...e},...n}),_(this,{autocomplete:{...Bi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=q(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=cs.INITIAL,session:o,value:r}=e.completions,{index:a}=o;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);pi(t,"nonempty",u.length>0),l.setAttribute("data-status",i),l.innerHTML=this.templates.completions(this,u),n({completions:{index:a,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Gi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Gi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&w(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),o=i&&i.text;return o&&(s&&(s.value=o),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(o)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ns.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Gi{static empty(){return Gi._empty||(Gi._empty=new Gi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const o of t[i])o.product&&!o.product.url||(o._index=e,o._field=i,s.set(e,o),n.push(o),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Wi="miso-option-list";const Hi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${k(e.text||e)}</li>`}});class Vi extends Vn{static get type(){return"option-list"}static get defaultTemplates(){return Hi}static get defaultClassName(){return Wi}constructor({className:t=Wi,templates:e,...s}={}){super({className:t,templates:{...Hi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncOptionValues(t,n)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;pi(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._select(n.text))}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}ni(Vi.prototype);const Yi=Object.freeze({...kn("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class Ki extends Vn{static get defaultTemplates(){return Yi}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...Yi,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=w(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],E((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Zi="miso-feedback",Ji=["helpful","unhelpful"];const Xi=Object.freeze({options:function(t){const{templates:e}=t;return Ji.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class to extends Ki{static get type(){return"feedback"}static get defaultTemplates(){return Xi}static get defaultClassName(){return Zi}constructor({className:t=Zi,templates:e,...s}={}){if(super({className:t,templates:{...Xi,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const eo="miso-text";const so=Object.freeze({root:function(t,{value:e}){const{className:s,role:n,options:{raw:i=!1,tag:o}}=t,r=n?`data-role="${n}"`:"",a=void 0!==e?k(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:n}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[i,o]=e;switch(i){case"date":return t=>s(t,o);case"number":return t=>n(t,o);default:return t=>""+t}}(t)(e)):"";return i?a:`<${o} class="${s}" ${r}>${a}</${o}>`}});class no extends Vn{static get type(){return"text"}static get defaultTemplates(){return so}static get defaultClassName(){return eo}constructor({className:t=eo,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...so,...e},tag:s,...n})}}class io extends Sn{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=A(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class oo{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:o}){const r=n.length;i=Math.min(i,r);const a=!!o&&i===r,c=e.substring(0,s),l=!n.startsWith(c);return a||l?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function ro(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:o=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,ao(e)];o&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${r} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||cs.INITIAL),n}function ao(t){return t+"__cursor"}function co(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:o,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${lo(n[0])}, ${lo(n[1])})`,e,""+o,i,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function lo(t){return Math.floor(100*t)/100+"ms"}const uo="miso-typewriter";class ho extends io{static get type(){return"typewriter"}static get defaultClassName(){return uo}constructor({className:t=uo,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:o,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:n,...a}),_(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:W({speed:i,acceleration:o}),this._readiness=new C,"markdown"===s&&ho.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=ao(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:co(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new oo}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:{value:s="",stage:n,finished:i}={},session:o,status:r}=t,a=(l=t,(c=e)&&l&&c.session&&l.session&&c.session.uuid===l.session.uuid);var c,l;const h=e?a&&n===e.stage?e.streak:e.streak+1:0,d=a&&e&&e.doneAt||(r===cs.READY&&i?performance.now():void 0);return this._prevState=Object.freeze(u({session:o,status:r,value:s,stage:n,streak:h,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:o}){const r=ro(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}i(a);const l=e.status===cs.READY&&!a.done;n({ongoing:l},{silent:l&&(!s||s.status===cs.READY)&&!c}),l&&o()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const n=e.closest('[data-role="follow-up-link"]');if(n){let{q:e}=n.dataset;return e=e?e.trim():void 0,void(e&&this._view._events.emit("follow-up-click",{event:t,q:e}))}const i=e.closest("a");if(i){if(!t.defaultPrevented){const{href:e,innerText:s,className:n}=i;e&&this._view._events.emit("link-click",u({event:t,url:e,text:s?s.trim():"",className:n||"",attributes:_o(i)}))}}else;}}function _o(t){const{attributes:e}=t,s={};for(const{name:t,value:n}of e)t.startsWith("data-")&&(s[t]=n);try{return JSON.stringify(s)}catch(t){return"{}"}}const po="miso-affiliation";const mo=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i,options:o}=t,{status:r}=e,a=n?` data-role="${n}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),h=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${o.itemType?` data-item-type="${o.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${r===cs.READY?i[r](t,e):""}</div>`},[cs.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Ti},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${i}__item"><div class="${i}__item-inner">${o.itemHeader(t,e,s,{index:n})}${o[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:o}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=o;return r=Hn.asFunction(r)(t,e,s,n),a=Hn.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${r}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[o,r]=Fn(t,s,{link:!1});return""+o+(i.infoBlock||i.affiliationInfoBlock||In)(t,s,n)+(i.imageBlock||Dn)(t,s,{brand:!0,...n})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:o}=t,r=Hn.asFunction(o.logoText)(t,e,s,n)||"",a=Hn.asFunction(o.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:o}=t,r=Hn.asFunction(o.logoUrl)(t,e,s,n);if(!r)return"";const a=Hn.asFunction(o.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),fo=Object.freeze({...ai.defaultTemplates,...mo});class go extends ai{static get type(){return"affiliation"}static get defaultTemplates(){return fo}static get defaultClassName(){return po}constructor({className:t=po,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...mo,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new st(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,E((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(_i(n,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const yo="miso-facets",bo="miso-facet",wo="custom_attributes.";const vo=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:n={}}=e.value||{};return Object.keys(n).map((i=>s.facet(t,{field:i,entries:n[i]},e)))},facet:function(t,e,s){const{facetClassName:n=bo,templates:i}=t,{field:o}=e;return`<div class="${n}" data-role="facet" data-field="${k(o)}">${i.header(t,e,s)}${i.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:n=bo,templates:i}=t;return`<div class="${n}__header">${i.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(wo)&&(e=e.substring(18)),k(e)},options:function(t,{field:e,entries:s},n){const{facetClassName:i=bo,templates:o}=t;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>o.option(t,{field:e,value:s,count:i},n))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:n=bo,templates:i}=t;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(t,e,s)}</span>\n  <span class="${n}__count">${i.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return k(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function Eo(t,e){return`${t}:::${e}`}function So(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class ko extends Vn{static get type(){return"facets"}static get defaultTemplates(){return vo}static get defaultClassName(){return yo}constructor({className:t=yo,templates:e,...s}={}){super({className:t,templates:{...vo,...e},...s}),this._bindings=new si}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=So(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)this._setSelected(n,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=So(t.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)e[t]&&this._setSelected(n,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),n=[],i=[],o=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),r=s[t];if(!r)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=r[e];if(!c)break;n.push(Eo(t,c)),i.push({field:t,value:c}),o.push(s)}}this._bindings.update(n,i,o)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[k(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;if(!n)return;const{field:i,value:o}=n;this._view.filters.facets.toggle(i,o),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Oo="miso-select";const Io=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,o=n?`data-role="${n}"`:"",r=t._getItems(e),a=r.find((t=>t.selected))||r[0];return`\n<div class="${s}" ${o}>\n  ${i.button(t,a)}\n  ${i.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:n}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:n}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>n.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:n}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${n.text(t,e)}</li>`},text:function(t,e){return k(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,((t,e)=>" "+e))||e||"")}});class xo extends Vn{static get type(){return"select"}static get defaultTemplates(){return Io}static get defaultClassName(){return Oo}constructor({className:t=Oo,templates:e,...s}={}){super({className:t,templates:{...Io,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}ni(xo.prototype);const Ao="miso-more-button";const To=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${e.status!==cs.READY?" disabled":""}>\n  ${i.text(t)}\n</div>\n`},text:function(t){return"More"}});class Co extends Vn{static get type(){return"more-button"}static get defaultTemplates(){return To}static get defaultClassName(){return Ao}constructor({className:t=Ao,templates:e,...s}={}){super({className:t,templates:{...To,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var Ro=Object.freeze({__proto__:null,TemplateBasedLayout:Vn,ContainerLayout:Zn,ErrorLayout:Xn,BannerLayout:class extends Vn{static get type(){return"banner"}static get defaultTemplates(){return ti}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...ti,...e},...s})}},CollectionLayout:ai,ListLayout:li,HorizontalLayout:hi,CardsLayout:class extends ai{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return di}constructor({className:t=di,...e}={}){super({className:t,...e})}},CarouselLayout:Li,GalleryLayout:Mi,SearchBoxLayout:Qi,OptionListLayout:Vi,FeedbackLayout:to,TextLayout:no,TypewriterLayout:ho,AffiliationLayout:go,FacetsLayout:ko,SelectLayout:xo,MoreButtonLayout:Co});function No({qs:t,...e}={}){return F(e,{metadata:{question_source:t||ls.ORGANIC}})}function $o(t){return t&&t.value&&t.value.revision}function Uo(t){const e=function(t){if(!t)return cs.INITIAL;const{request:e,error:s,value:n}=t;return s?cs.ERRONEOUS:n?cs.READY:e?cs.LOADING:cs.INITIAL}(t);return u({status:e,ongoing:e===cs.READY?t.ongoing:void 0,...t})}function Po(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:n}=s;n&&(e.meta.miso_id=n)}function Lo(t){const{request:e,value:s}=t;if(!e)return t;const{payload:n}=e||{},{q:i}=n||{};return i?{...t,value:{...s,keywords:i}}:t}function qo(t){const{role:e,type:s,items:n}=t,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:u({property:e})}};switch(function(t){return rs.has(t)}(s)&&(!function(t,e=[]){return function(t){return ss.has(t)}(t)||e.length>0&&"object"==typeof e[0]&&e[0].product_id}(e,n)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((t=>t.text||t.id||t))):i.product_ids=(n||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case ns.SUBMIT:i.context.custom_context.value=t.value;break;case ns.FEEDBACK:i.context.custom_context.value=i.value=t.value,i.context.custom_context.result_type=i.result_type=t.result_type}return u(i)}function jo(t,e){return t=function(t={},{data:e}={}){if(!e)return t;const{request:s={},value:n={}}=e,{question_source:i}=s.payload&&s.payload.metadata||{},{question_id:o}=n;return B(t,{context:{custom_context:{question_source:i,question_id:o}}})}(t,e),t=function(t,e){if(e.role!==Xe.ANSWER)return t;const{items:s=[]}=e;return B(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}(t,e),t=function(t,{event_target:e}={}){if(!e)return t;return B(t,{context:{custom_context:{event_target:e}}})}(t,e)}const Do=Object.freeze({}),Mo=Object.freeze({[Xe.CONTAINER]:Zn.type,[Xe.ERROR]:Xn.type}),zo=Object.freeze({}),Fo=Object.freeze({api:Do,layouts:Mo,trackers:zo}),Bo=Object.freeze({mappings:{[Xe.ERROR]:t=>t.error}});class Qo extends tt{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:n,defaults:i,options:o,extraOptions:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,t=Object.freeze({...t,plugin:s,client:n}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=o||new Cs(e&&e._options,i),this._extraOptions=r||{},this._hub=new Fs({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,n._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({roles:t}){const e=this._hub,s=this._client,n=this._options,i=this._extensions,o=this._plugin.layouts;this._sessions=new Bs(e),this._data=new Gs(e,{source:En(s),options:n,...this._extraOptions.api}),this._views=new gn(e,{extensions:i,layouts:o,roles:t,options:n,workflow:this}),this._interactions=new vn(e,{client:s,options:n})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("session",(t=>this._onSession(t))),this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(zs(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:n}){n||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[zs(t)]||{};e.session&&e.status===cs.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onSession(t){this.updateData({session:t})}_onMainViewUpdate(t){const{status:e}=t,s=e===cs.READY,n=e===cs.ERRONEOUS;this._emitLifecycleEvent(n?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||n)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(t);return n.add(t),!i}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=gs(this._options.resolved.api,t);this.updateData({session:e,request:s}),this._hub.update("request",{...s,session:e})}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=$o(t);if(!h(s)){const t=$o(this._hub.states.data);if(!h(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){const e=this._hub.states.data;t=this._defaultProcessData(t,e);for(const s of this._options.resolved.dataProcessor)t=s(t,e);this._updateDataInHub(t,e)}_defaultProcessData(t,e){return t=function(t,e){if(!t||!t.value||t.request||!e||!e.request)return t;const{request:s}=e;return{...t,request:s}}(t,e),t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=Uo(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:cs.READY,session:this.session,...e},this._hub.update(zs(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction({...t,data:this._hub.states.data,workflow:this});this._sendInteraction(e)}_buildInteraction(t){let e=qo(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)e=n(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){const{data:s}=e;if(!s)return t;const n=s.request&&s.request.payload;if(!n)return t;const{question:i,q:o,fq:r}=n;return B(t,{context:{custom_context:{question:i,q:o,fq:r}}})}(t=this._writeMisoIdToInteraction(t,e),e),t=function(t,e){const{data:s}=e;if(!s)return t;const n=s.request&&s.request.payload&&s.request.payload.metadata;return n?B(t,{context:{custom_context:n}}):t}(t,e),t=function(t,e){if(e.role!==Xe.AFFILIATION)return t;const{items:s}=e;return B(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t,e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return B(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[zs(e.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?B(t,{miso_id:n}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._emit("destroy"),this._destroy(t)}get destroyed(){return!!this._destroyed}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy(),this._destroyed=!0}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function Go(t){if(t.affiliation_products){const{affiliation_products:e,...s}=t;t={...s,affiliation:Wo(e)}}else if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Ho(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function Wo(t){return{channel:"miso",products:t}}function Ho({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Vo)}}function Vo({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:o,salePrice:r,discountRate:a,image:c,thumbnail:l,merchant:h,...d}){return u({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:o,sale_price:r,discount_rate_percent:a,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:Yo({sovrn_id:t,thumbnail:l,merchant:h,...d})})}function Yo(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const o=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...Yo(i,o)}:{...s,[o]:i}}),{})}function Ko(t){M(t,Zo.prototype)}Us(Qo.prototype),Object.assign(Qo,{DEFAULT_API_OPTIONS:Do,DEFAULT_LAYOUTS:Mo,DEFAULT_TRACKERS:zo,DEFAULT_OPTIONS:Fo,ROLES_OPTIONS:Bo});class Zo{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=e;else{window.open(e,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Jo=Object.freeze({...Qo.DEFAULT_API_OPTIONS,group:o.ASK,payload:{...Qo.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Xo=Object.freeze({actor:!1,api:{group:o.ASK,name:r.AUTOCOMPLETE}}),tr=Object.freeze({...Qo.DEFAULT_LAYOUTS,[Xe.QUERY]:[Qi.type,{placeholder:"Ask a question"}],[Xe.QUESTION]:[no.type,{tag:"h2"}],[Xe.ANSWER]:ho.type,[Xe.FEEDBACK]:to.type,[Xe.IMAGES]:[Mi.type,{incremental:!0,itemType:"image"}],[Xe.SOURCES]:[li.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Xe.AFFILIATION]:[go.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),er=Object.freeze({...Qo.DEFAULT_TRACKERS,[Xe.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Es.click},[Xe.IMAGES]:Es,[Xe.SOURCES]:Es,[Xe.AFFILIATION]:Es,[Xe.PRODUCTS]:Es}),sr=Object.freeze({...Qo.DEFAULT_OPTIONS,api:Jo,autocomplete:Xo,layouts:tr,trackers:er}),nr=_s(Qo.ROLES_OPTIONS,{main:Xe.ANSWER,members:Object.keys(tr),mappings:{[Xe.ANSWER]:function(t){if(!t||!t.value)return;const{answer:e="",answer_stage:s,finished:n}=t.value;return Object.freeze({value:e,stage:s,finished:!!n})},[Xe.REASONING]:function(t){if(!t||!t.value)return;const{reasoning:e="",reasoning_finished:s}=t.value;return Object.freeze({value:e,stage:"reasoning",finished:!!s})}}});class ir extends Qo{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new wn(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(Xe.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(Xe.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[zs(this._roles.main)]||{};t.session&&t.status!==cs.INITIAL&&(t.status!==cs.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,n=e===cs.READY&&!t.ongoing,i=e===cs.ERRONEOUS,o=n?"done":i?"error":e,r=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(o,t),(n||i)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){js.call(this,t)}query(t){if(!t.q&&!t.questionId)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||ls.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==Ls?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),Ds.call(this,t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t,e){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Go(e)}}(t=super._defaultProcessData(t,e)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_defaultProcessInteraction(t,e){return t=jo(t=super._defaultProcessInteraction(t,e),e)}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[zs(t.role)]||{},{payload:s}=e||{};return s&&s.metadata&&s.metadata.question_source||void 0}_onCitationClick({index:t,event:e}){if(0!==e.button)return;if(_n(e))return;const{value:s}=this._hub.states.data||{},{sources:n}=s||{},i=n&&n[t-1];i&&i.product_id&&(pn(e),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){0===t.button&&(_n(t)||(pn(t),this._views.trackers.answer.click([],{items:[e]})))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Ko(ir.prototype),Object.assign(ir,{DEFAULT_API_OPTIONS:Jo,DEFAULT_AUTOCOMPLETE_OPTIONS:Xo,DEFAULT_LAYOUTS:tr,DEFAULT_TRACKERS:er,DEFAULT_OPTIONS:sr,ROLES_OPTIONS:nr});var or=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var rr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class ar{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class cr{constructor(t){this._context=t,_(this,{lowerCamelToKebab:f,kebabToLowerCamel:p,kebabOrSnakeToLowerCamel:m})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=m(t))||"querySuggestions"===t?"followUpQuestions":t}phrase(t,{name:e,extraNames:s=[],tag:n="div",inline:i=!1}){const{classPrefix:o}=t;return`<${n} class="${i?o+"__phrase-inline":o+"__phrase"} ${[e,...s].map((t=>`${o}__${t}-phrase`)).join(" ")}">${this.phraseText(t,p(e))}</${n}>`}phraseText(t,e){const{phrases:s={}}=t,n=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s,workflow:n},{name:i,extraNames:o=[],visibleWhen:r,trait:a,logo:c=!1},l){const u=[i,...o].map((e=>`${t}__${e}-container`));return e&&u.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:u,visibleWhen:r,trait:a,logo:c,parentQuestionId:s,workflow:n},l)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${f(t)}="${n}"`)}return s}}const lr=z(new cr({...or,DEFAULT_PHRASES:rr})),ur=z(new class extends ar{constructor(){super({helpers:lr})}answerGroup(t){const{container:e}=this._helpers;return[this.question(t),this.reasoning(t),this.answer(t),this.affiliation(t),this.sources(t),this.followUpQuestions(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"question",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",s(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(t={}){const{phrases:e,reasoning:s={}}=t,{container:n,element:i,phraseText:o}=this._helpers,r=[];return s.expand&&r.push("expanded"),n(t,{name:"reasoning",visibleWhen:"nonempty"},[i("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[i("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||Ni}</div>`,`<div class="miso-collapsible__title" data-role="title">${o(e,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ci}</div>`]),i("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(t){const{container:e,phrase:s}=this._helpers,n="follow-up-questions",i=["query-suggestions"];return e(t,{name:n,extraNames:i,visibleWhen:"nonempty"},[s(t,{name:n,extraNames:i,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(t){const{features:e={}}=t;return!1===e.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(t){const{container:e,phrase:s,section:n}=this._helpers,{features:i={},logo:o=!0}=t;return n(t,{name:"related-resources"},!1===i.relatedResources?"":e({...t,workflow:"active"},{name:"related-resources",visibleWhen:"nonempty",logo:o},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:lr}));function hr(t={}){const{normalizeOptions:e,section:s,container:n}=lr,{answerGroup:i}=ur;return s(t=e(t),{name:"follow-up"},[n(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...i(t)])}var dr=Object.freeze({__proto__:null,helpers:lr,sections:ur,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=lr,{followUps:i,relatedResourcesSection:o,answerGroup:r}=ur;return""+s(t=e(t),{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},r(t))+i(t)+o(t)},followUp:hr});const _r=Object.freeze({...ir.DEFAULT_API_OPTIONS,name:r.QUESTIONS,payload:{...ir.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),pr=Object.freeze({...ir.DEFAULT_LAYOUTS,[Xe.QUERY]:[Qi.type,{templates:{buttonIcon:"send"}}],[Xe.REASONING]:ho.type,[Xe.RELATED_RESOURCES]:[li.type,{incremental:!0,itemType:"article"}],[Xe.QUERY_SUGGESTIONS]:Vi.type,[Xe.FOLLOW_UP_QUESTIONS]:Vi.type}),mr=Object.freeze({...ir.DEFAULT_TRACKERS,[Xe.RELATED_RESOURCES]:Es,[Xe.QUERY_SUGGESTIONS]:{...Es,click:{...Es.click,validate:t=>0===t.button}}}),fr=Object.freeze({followUp:hr}),gr=Object.freeze({...ir.DEFAULT_OPTIONS,api:_r,layouts:pr,trackers:mr,templates:fr}),yr=_s(ir.ROLES_OPTIONS,{members:Object.keys(pr),mappings:{[Xe.QUERY_SUGGESTIONS]:function(t,{workflow:e}={}){const s=e.previous,n=s&&s.states.data.value,i=n&&(n.suggested_followup_questions||n.followup_questions||[]);return i&&i.map((t=>({text:t})))},[Xe.FOLLOW_UP_QUESTIONS]:function(t){if(t&&t.value)return(t.value.followup_questions||[]).map((t=>({text:t})))}}});class br extends ir{constructor(t,e){super({name:"ask",context:t,roles:yr,defaults:gr,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;_(this,{parentQuestionId:e})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on(zs(Xe.REASONING),(t=>this._onReasoningViewUpdate(t))),this._views.get(Xe.ANSWER).on("follow-up-click",(t=>this._onFollowUpClick(t))),this._views.get(Xe.FOLLOW_UP_QUESTIONS).on("select",(t=>this._onFollowUpQuestionSelect(t))),this._views.get(Xe.QUERY_SUGGESTIONS).on("select",(t=>this._onQuerySuggestionSelect(t)))]}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){const{next:t}=this;t&&t.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,questionId:s,...n}={}){if(s)return u({...n,question_id:s});const{parentQuestionId:i}=this;let o=u({...n,question:t,parent_question_id:i});return o=No({...o,qs:e}),o=this._writeWikiLinkTemplateToPayload(o),o}_updateData(t){super._updateData(t),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:t}=this;if(!t)return;const e=t._views.get(Xe.QUERY_SUGGESTIONS);e&&e.refresh()}_onReasoningViewUpdate({status:t,ongoing:e}){if(t!==cs.READY||e)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAdditionalAskPropertiesToInteraction(t,e)}_writeAdditionalAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let n,i,o,{property:r}=t.context&&t.context.custom_context||{};return e.role!==Xe.FOLLOW_UP_QUESTIONS&&e.role!==Xe.QUERY_SUGGESTIONS||(r="suggested_followup_questions"),e.role===Xe.QUERY_SUGGESTIONS?(i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,o=this.previous&&this.previous.session.meta.question_source):i=this.parentQuestionId,B(t,{context:{custom_context:u({property:r,root_question_id:s,parent_question_id:i,question_id:n,question_source:o})}})}_onFollowUpClick({q:t,event:e}={}){0===e.button&&this._submitFollowUpQuestion({q:t,qs:ls.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:t}){this._submitFollowUpQuestion({q:t,qs:ls.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:t="",qs:e}={}){if(!(t=t.trim()))return;this.getOrCreateNext().query({q:t,qs:e})}_onQuerySuggestionSelect({value:t}){t&&this.query({q:t,qs:ls.SUGGESTED_QUESTIONS})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const t=this._views.get(Xe.REASONING),e=t&&t.element;return e&&e.closest('[data-role="reasoning-box"]')}_destroy(t){const{next:e,parentQuestionId:s,questionId:n}=this;e&&e.destroy(t),s&&this._context._byPqid.delete(s),n&&this._context._byQid.delete(n),super._destroy(t)}}const wr={event:"done"};class vr extends Ms{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new br(this),this._events.on("*",(t=>this._createNextIfNecessary(t))),this._events.on("loading",(t=>this._setActive(t.workflow))),this._events.on("destroy",(()=>this._requestEmitAfterDestroy())),this._events.on("after-destroy",(()=>this._syncActiveOnAfterDestroy())),this._autoNextFn=void 0,this._active=this._root}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}get active(){return this._active}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new br(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}autoNext(t){this._autoNextFn=function(t=wr){switch(!0===t&&(t=wr),"string"==typeof t&&(t={event:t}),typeof t){case"object":return e=>e&&t.event===e._event;case"function":return t;default:return()=>!1}}(t)}_createNextIfNecessary(t){if(!this._autoNextFn||!this._autoNextFn(t))return;const{workflow:e}=t;e&&e.getOrCreateNext()}_requestEmitAfterDestroy(){this._emitAfterDestroyRequested||(this._emitAfterDestroyRequested=!0,setTimeout((()=>{this._emitAfterDestroyRequested=!1,this._events.emit("after-destroy",{})}),0))}_syncActiveOnAfterDestroy(){if(!this._active.destroyed)return;let t=this._root;for(;t.next&&t.next.status!==cs.INITIAL;t=t.next);this._setActive(t)}_setActive(t){t!==this._active&&(this._active=t,this._events.emit("active",{workflow:t}))}}Us(vr.prototype,[hs.TEMPLATES]);const Er=Object.freeze({...Qo.DEFAULT_API_OPTIONS,group:o.SEARCH,payload:{...Qo.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Sr=Object.freeze({...Qo.DEFAULT_LAYOUTS,[Xe.QUERY]:[Qi.type],[Xe.PRODUCTS]:[li.type,{incremental:!0,infiniteScroll:!0}],[Xe.KEYWORDS]:[no.type,{raw:!0}],[Xe.TOTAL]:[no.type,{raw:!0,format:"number"}],[Xe.FACETS]:[ko.type],[Xe.SORT]:[xo.type],[Xe.MORE]:[Co.type]}),kr=Object.freeze({...Qo.DEFAULT_TRACKERS,[Xe.PRODUCTS]:Es}),Or=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Ir=Object.freeze({...Qo.DEFAULT_OPTIONS,api:Er,layouts:Sr,trackers:kr,pagination:Or}),xr=_s(Qo.ROLES_OPTIONS,{main:Xe.PRODUCTS,members:Object.keys(Sr),mappings:{[Xe.FACETS]:"facet_counts",[Xe.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=e.states.filters||{},o=i&&i.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(n).field;return o?n.map((t=>({...t,selected:t.field===o}))):n}}});class Ar extends Qo{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(Xe.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){js.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){if(this._linkFn)return void this._submitToPage(t);const e=ds.QUERY;this._views.filters.reset({silent:!0}),this.restart({type:e});const s=this._buildPayload(t,e);this._request({payload:s,type:e})}_refine(){const t=ds.REFINE,{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart({type:t});const s=this._getQuery(),n=this._buildPayload(s,t);this._request({payload:n,type:t})}_more(){if(this.status!==cs.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=ds.MORE,e=this._getQuery(),s=this._buildPayload(e,t);this._request({payload:s,type:t})}_getQuery(){return this._hub.states.query}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t,e){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),e===ds.MORE&&(t=this._processPayloadForMoreRequest(t)),t}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:n}=e||{};return u({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const n=t[s];n&&n.length&&(e[s]={terms:n})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return l(t)}_writePageInfoToPayload(t){return{...t,metadata:{...t.metadata,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},n=s.map((t=>t.product_id)).filter((t=>t)),i=[...t.exclude||[],...n];return 0===i.length?t:{...t,exclude:i}}_defaultProcessData(t,e){return t=function(t,e){if(!e)return t;const{status:s,value:n}=t;switch(s){case cs.INITIAL:case cs.LOADING:break;default:return t}return n&&n.facet_counts?t:{...t,value:{...n,facet_counts:e}}}(t=Lo(t=super._defaultProcessData(t,e)),this._currentFacetCounts),t=function(t,{role:e=Xe.PRODUCTS}={}){const{status:s,request:n,value:i}=t;if(s!==cs.READY||!n||!i)return t;const{[e]:o}=i;if(!o)return t;const{rows:r}=n.payload,{length:a}=o;return r>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateData(t){super._updateData(t),Ds.call(this,t)}_updateDataInHub(t,e){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t,e)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{metadata:s}=e.payload;if(!s||!s.page)return function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,value:{...e,root_miso_id:s}}:t}(t);return function(t,e,{role:s=Xe.PRODUCTS}={}){if(!e.value)return t;const{[s]:n=[],facet_counts:i,total:o,root_miso_id:r}=t.value,{[s]:a=[]}=e.value;return{...e,value:{...e.value,facet_counts:i,total:o,root_miso_id:r,[s]:[...n,...a]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeRootMisoIdToInteraction(t)}_writeRootMisoIdToInteraction(t){const e=this._hub.states.data,{root_miso_id:s}=e&&e.value||{};return s?B(t,{context:{custom_context:{root_miso_id:s}}}):t}}Us(Ar.prototype,[hs.PAGINATION,hs.FILTERS]),Ko(Ar.prototype),Object.assign(Ar,{DEFAULT_API_OPTIONS:Er,DEFAULT_LAYOUTS:Sr,DEFAULT_TRACKERS:kr,DEFAULT_PAGINATION:Or,DEFAULT_OPTIONS:Ir,ROLES_OPTIONS:xr});const Tr=ir.ROLES_OPTIONS;class Cr extends ir{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Tr,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_doLoading(t){const{session:e}=this;this.updateData({...t,session:e})}_queryWithQuestionId(t){const{session:e}=this,{request:s,value:n}=t;this.updateData({...t,session:e});const{question_id:i}=n;if(!i)return;const o={...s.payload,question_id:i};void 0!==o.metadata.page&&delete o.metadata.page,this._hub.update("request",{...s,payload:o,session:e})}_defaultProcessData(t,e){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:n}={}}=e;return n?{...t,meta:{...t.meta,miso_id:n}}:t}(t=Lo(t=super._defaultProcessData(t,e))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_handleHeadResponse(t){super._handleHeadResponse(t),Po(t)}_onTracker(t){this._superworkflow._onTracker(t)}}const Rr=Ar.ROLES_OPTIONS.members;class Nr{constructor(t){this._subviews=t,this._containers=new Set}get filters(){return this._subviews.results.filters}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._getAllSubviews())e.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getAllSubviews(){return Object.values(this._subviews)}_getSubviews(t){return this._subviews[function(t){return Rr.includes(t)?"results":"answer"}(t)]}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,n=this._getSubviews(s);if(!n._containers.has(t)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(t)){for(const n of t.components)if(s.containsElement(n))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}n.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const $r=Object.freeze({members:[]});function Ur({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function Pr(t){return t&&t.value&&t.value.trim()||void 0}class Lr extends Qo{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:Ur(e),roles:$r,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,Pr(t)===Pr(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!Pr(t))return void this._updateCompletions({session:s,status:cs.INITIAL});const n=this._buildPayload(t);this._request({payload:n})}_buildPayload(t){return{q:Pr(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function qr(t){M(t,jr.prototype)}class jr{_initAutocomplete(t){this._autocomplete=new Lr(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Dr=Object.freeze({group:o.ASK,name:r.SEARCH,payload:{...ir.DEFAULT_API_OPTIONS.payload,...Ar.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Mr=Object.freeze({...ir.DEFAULT_LAYOUTS,...Ar.DEFAULT_LAYOUTS,[Xe.QUERY]:[Qi.type,{placeholder:""}],[Xe.QUESTION]:[no.type,{raw:!0}],[Xe.SOURCES]:[hi.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:On,articleInfoBlock:Tn}}]}),zr=Object.freeze({...ir.DEFAULT_TRACKERS,...Ar.DEFAULT_TRACKERS}),Fr=Object.freeze({...Ar.DEFAULT_PAGINATION,active:!0}),Br=Object.freeze({api:{group:o.ASK,name:r.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Qr=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Gr=Object.freeze({...ir.DEFAULT_OPTIONS,...Ar.DEFAULT_OPTIONS,api:Dr,layouts:Mr,trackers:zr,autocomplete:Br,pagination:Fr,filters:Qr}),Wr=Object.freeze({main:Xe.PRODUCTS,members:Object.keys(Mr),mappings:Object.freeze({...ir.ROLES_OPTIONS.mappings,...Ar.ROLES_OPTIONS.mappings})}),Hr=Object.freeze({api:Object.freeze({polling:!1})});class Vr extends Ar{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Wr,defaults:Gr,extraOptions:Hr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._answer=new Cr(this)}_initActors(t){super._initActors(t),this._views=new Nr({results:this._views,answer:this._answer._views})}restart({type:t}={}){super.restart(),t&&t!==ds.QUERY||this._answer.restart()}get answer(){return this._answer}get questionId(){return this._answer.questionId}_buildPayload(t,e){return t=function(t,e){return e===ds.QUERY?t:{...t,answer:!1}}(t=super._buildPayload(t,e),e),t=No(t),!1!==(t=this._writeQuestionIdToPayload(t,e)).answer&&(t=ir.prototype._writeWikiLinkTemplateToPayload.call(this,t)),t}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t,e){if(e===ds.QUERY)return t;const s=this._answer.questionId;return s?F(t,{metadata:{question_id:s}}):t}_defaultProcessData(t,e){return Po(t=super._defaultProcessData(t,e)),t}_updateDataInHub(t,e){this._dispatchDataToAnswerWorkflow(t),t=function(t,e){const{question_id:s}=e&&e.value||{};return s?{...t,value:{...t.value,question_id:s}}:t}(t,e),super._updateDataInHub(t,e)}_dispatchDataToAnswerWorkflow(t){const{request:e}=t;if(!e)return;const{type:s,payload:n}=e;if(s===ds.QUERY&&n&&!1!==n.answer)switch(t.status){case cs.LOADING:this._answer._doLoading(t);break;case cs.READY:this._answer._queryWithQuestionId(t)}}_defaultProcessInteraction(t,e){return t=jo(t=super._defaultProcessInteraction(t,e),e)}_destroy(){this._answer.destroy(),super._destroy()}}Us(Vr.prototype,[hs.PAGINATION,hs.FILTERS]),qr(Vr.prototype);const Yr=Object.freeze({group:o.SEARCH,name:r.SEARCH,payload:{fl:["*"]}}),Kr=Object.freeze({api:{group:o.SEARCH,name:r.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Zr=Object.freeze({...Ar.DEFAULT_LAYOUTS}),Jr=Object.freeze({...Ar.DEFAULT_TRACKERS}),Xr=Object.freeze({...Ar.DEFAULT_OPTIONS,api:Yr,autocomplete:Kr,layouts:Zr,trackers:Jr}),ta=Ar.ROLES_OPTIONS;class ea extends Ar{constructor(t,e){super({name:"search",plugin:t,client:e,roles:ta,defaults:Xr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=Xe.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}qr(ea.prototype);class sa extends Ms{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=Je){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=Je){return this._members.has(t)}get(t=Je){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class na extends Qo{_initProperties(t){super._initProperties(t);const{id:e}=t;_(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return B(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(na,{DEFAULT_API_OPTIONS:Qo.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Qo.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Qo.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Qo.DEFAULT_OPTIONS,ROLES_OPTIONS:Qo.ROLES_OPTIONS});const ia=Object.freeze({...na.DEFAULT_API_OPTIONS,group:o.RECOMMENDATION,name:r.USER_TO_PRODUCTS,payload:{...na.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),oa=Object.freeze({...na.DEFAULT_LAYOUTS,[Xe.PRODUCTS]:li.type}),ra=Object.freeze({...na.DEFAULT_TRACKERS,[Xe.PRODUCTS]:Es}),aa=Object.freeze({...na.DEFAULT_OPTIONS,api:ia,layouts:oa,trackers:ra}),ca=_s(na.ROLES_OPTIONS,{main:Xe.PRODUCTS,members:Object.keys(oa)});class la extends na{constructor(t,e){super({name:"recommendation",context:t,roles:ca,defaults:aa,id:e})}start(){return this._request(),this}notifyViewUpdate(t=Xe.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class ua extends sa{constructor(t,e){super("recommendations",t,e)}_create(t){return new la(this,t)}}const ha=Object.freeze({...na.DEFAULT_API_OPTIONS,group:o.ASK,name:r.RELATED_QUESTIONS}),da=Object.freeze({...na.DEFAULT_LAYOUTS,[Xe.RELATED_QUESTIONS]:[li.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Xe.QUERY]:[Qi.type,{placeholder:"Ask a question"}]}),_a=Object.freeze({...na.DEFAULT_TRACKERS,[Xe.RELATED_QUESTIONS]:Es,[Xe.CONTAINER]:{...Es,itemless:!0},[Xe.QUERY]:{[ns.SUBMIT]:{active:!0}}}),pa=Object.freeze({...na.DEFAULT_OPTIONS,api:ha,layouts:da,trackers:_a}),ma=_s(na.ROLES_OPTIONS,{main:Xe.RELATED_QUESTIONS,members:Object.keys(da)});class fa extends na{constructor(t,e){super({name:"explore",context:t,roles:ma,defaults:pa,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(Xe.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Zo.prototype.useLink.call(this,t,e),e&&this.useLayouts({[Xe.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=Xe.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t,e){return t=super._defaultProcessData(t,e),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Zo.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Ko(fa.prototype);class ga extends sa{constructor(t,e){super("explores",t,e)}_create(t){return new fa(this,t)}}class ya extends tt{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new C)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const ba=Object.freeze(or),wa=Object.freeze(rr),va=Object.freeze(dr);var Ea=Object.freeze({__proto__:null,constants:ba,phrases:wa,templates:va,wireFollowUps:function(t,e,s){if(!t)throw Error("client is required");!function(t,{template:e=hr,...s}={}){if("function"!=typeof e)throw Error("template must be a function or undefined");const n=Object.keys(s).length>0;if(e===hr&&!n)return;t.ui.asks.useTemplates({followUp:n?t=>e({...s,...t}):e})}(t,s),function(t){if(!t||"miso-follow-ups"===t.tagName.toLowerCase())return;const e=document.createElement("miso-follow-ups");for(const{name:s,value:n}of t.attributes)e.setAttribute(s,n);t.parentNode.replaceChild(e,t)}(e)},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");if(e)for(const t of e.querySelectorAll("miso-ask"))t.setAttribute("workflow","active")}});const{currentScript:Sa}=document,ka=Object.freeze({templates:va,autostart:!0}),Oa=["templates","phrases","features"];class Ia{constructor(){this._defaults=ka,this._scriptSrc=function(){if(!Sa||!Sa.src)return{};const t=document.createElement("a");t.href=Sa.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Ta(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Ta(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return u({apiKey:t,apiHost:e,templates:Ca(s),phrases:n,...i})}(xa(this._defaults,this._scriptSrc,t,this._pageUrl))}}function xa(...t){let e={};for(const s of t)s&&(e=Aa(e,s));return e}function Aa(t,e){if(!e)return t;Object.assign(t,e);for(const s of Oa)s in e&&(t[s]={...t[s],...e[s]});return t}function Ta(t){return""===t||"false"!==t&&t}function Ca(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Ca):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,Ca);default:throw Error("Unsupported template type: "+t)}}class Ra{constructor(t,{classPrefix:e=ba.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");_(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Na extends ya{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Ia,this._localOptions={}}config(t={}){t=xa(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;_(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Ra(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:o}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=n,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&o(e,s.relatedResourcesSection),l.autoQuery()}}class $a extends et{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}const Ua="trait",Pa=Object.freeze([Ua]);class La extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return Pa}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const t of this._traits)this._destroyTrait(t);this._traits=[]}attributeChangedCallback(t){if(t===Ua)this._syncTraits()}_syncTraits(){const t=(this.getAttribute(Ua)||"").split(/\s+/).filter(Boolean),e=[];for(const s of this._traits)t.includes(s.constructor.traitName)?e.push(s):this._destroyTrait(s);if(t.length>0){const s=function(t){const e=t.ui&&t.ui.traits||{};return Object.values(e).reduce(((t,e)=>(t[e.traitName]=e,t)),{})}(La.MisoClient);for(const n of t){if(this._traits.find((t=>t.constructor.traitName===n)))continue;const t=s[n];if(!t){console.warn("Unknown trait: "+n);continue}const i=new t(this);e.push(i)}}this._traits=e}_destroyTrait(t){try{t._destroy&&t._destroy()}catch(t){console.error(t)}}}let qa,ja,Da;async function Ma(t){const e=await async function(t){return t.MisoClient||window.MisoClient||qa||(qa=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return ja=ja||e.any(),Da=Da||await ja,Da.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Da}const za="logo",Fa="auto",Ba=Object.freeze([...La.observedAttributes,za]);function Qa(t){if(!t)return Fa;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Ga extends La{static get observedAttributes(){return Ba}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Qa(this.getAttribute(za))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Fa:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(za,e):this.removeAttribute(za)}async connectedCallback(){super.connectedCallback();const t=this._client=await Ma(Ga);document.body.contains(this)&&(this._setWorkflow(this._getWorkflow(t)),this._onConnected(t))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_onConnected(t){}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===za)this._handleLogoUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleLogoUpdate(t,e){Qa(t)!==Qa(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Wa="workflow",Ha="parent-question-id",Va=Object.freeze([...Ga.observedAttributes,Wa,Ha]);const Ya="unit-id",Ka=Object.freeze([...Ga.observedAttributes,Ya]);class Za extends Ga{static get observedAttributes(){return Ka}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(Ya)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Ya,t):this.removeAttribute(Ya)}attributeChangedCallback(t,e,s){if(t===Ya)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Ja=Object.freeze({__proto__:null,MisoAskElement:class extends Ga{static get tagName(){return"miso-ask"}static get observedAttributes(){return Va}_getWorkflow(t){return this.boundToActiveWorkflow?t.ui.asks.active:this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Ha)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Ha,t):this.removeAttribute(Ha))}get boundToActiveWorkflow(){return"active"===this.getAttribute(Wa)}_setWorkflow(t){this._workflow!==t&&(super._setWorkflow(t),t&&(this.parentQuestionId=t.parentQuestionId))}async connectedCallback(){if(await super.connectedCallback(),document.body.contains(this)){this._unsubscribes=[...this._unsubscribes||[],this._client.ui.asks.on("active",(t=>{this.boundToActiveWorkflow&&(this.workflow=t.workflow)}))]}}disconnectedCallback(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],super.disconnectedCallback()}attributeChangedCallback(t,e,s){switch(t){case Ha:this._handleParentQuestionIdUpdate(e,s);break;case Wa:this._handleQuestionUpdate(e,s);break;default:super.attributeChangedCallback(t,e,s)}}_handleQuestionUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&e===ATTR_VALUE_ACTIVE&&this._setWorkflow(this._getWorkflow(this._client))}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Za{static get tagName(){return"miso-explore"}static get observedAttributes(){return Za.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends Ga{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Ga.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Ga{static get tagName(){return"miso-search"}static get observedAttributes(){return Ga.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Za{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Za.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const Xa="role",tc=Object.freeze([Xa]);class ec extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return tc}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Xa);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Xa}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Xa}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Xa&&this._container&&this._container._updateComponentRole(this,e,s)}}var sc=Object.freeze({__proto__:null,MisoComponentElement:ec,MisoQueryElement:class extends ec{constructor(){super({role:Xe.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends ec{constructor(){super({role:Xe.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends ec{constructor(){super({role:Xe.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends ec{constructor(){super({role:Xe.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends ec{constructor(){super({role:Xe.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends ec{constructor(){super({role:Xe.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends ec{constructor(){super({role:Xe.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends ec{constructor(){super({role:Xe.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends ec{constructor(){super({role:Xe.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends ec{constructor(){super({role:Xe.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends ec{constructor(){super({role:Xe.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends ec{constructor(){super({role:Xe.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends ec{constructor(){super({role:Xe.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends ec{constructor(){super({role:Xe.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends ec{constructor(){super({role:Xe.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends ec{constructor(){super({role:Xe.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends ec{constructor(){super({role:Xe.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends ec{constructor(){super({role:Xe.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends ec{constructor(){super({role:Xe.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends ec{constructor(){super({role:Xe.ERROR})}static get tagName(){return"miso-error"}}});class nc extends La{static get observedAttributes(){return La.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(t){this._setContext(t)}async connectedCallback(){super.connectedCallback();const t=this._client=await Ma(nc);document.body.contains(this)&&this._setContext(this._getContext(t))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(t){throw Error("Unimplemented")}_setContext(t){if(this._context===t)return;const e=this._context;this._context=t,this._onContext(t,e)}_onContext(){}}var ic=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends nc{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return nc.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(t){return t.ui.asks}_onContext(t,e){t!==e&&(this._unwire(),this._wire(t))}_unwire(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}_wire(t){t&&(t._autoNextFn||t.autoNext(),this._unsubscribes.push(t.on("create",(t=>{const{parentQuestionId:e}=t,s=t._options.resolved.templates.followUp;if(!e||!s)return;const n=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:e}));const i=this.children.length;for(const e of Array.prototype.slice.call(this.children,n,i))this._elementToWorkflow.set(e,t)}))),this._unsubscribes.push(t.on("loading",(({workflow:t})=>{for(const e of this.children)if(this._elementToWorkflow.get(e)===t){e.scrollIntoView({behavior:"smooth",block:"start"});break}}))),this._unsubscribes.push(t.on("destroy",(({workflow:t})=>{for(const e of this.children)this._elementToWorkflow.get(e)===t&&(this._elementToWorkflow.delete(e),e.remove())}))))}}});class oc extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(oc.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var rc=Object.freeze({__proto__:null,containers:Ja,roles:sc,contexts:ic,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends oc{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Yn,MisoStubElement:La});const ac="miso-hybrid-search-combo";var cc=Object.freeze({__proto__:null,CLASS_PREFIX:ac,CONAINER_TAG:"miso-hybrid-search"});const lc="Show more",uc="Show less";var hc=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:lc,showLess:uc});const dc=z(new cr({...cc,DEFAULT_PHRASES:hc})),_c=z(new class extends ar{constructor(){super({helpers:dc})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:dc}));var pc=Object.freeze({__proto__:null,helpers:dc,sections:_c,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=dc;t=e(t);const{answerBox:i,answerGroup:o,searchResultsGroup:r}=_c,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[i(t)]:o(t))+s(t,{name:"search-results"},r(t))}});const mc="answer-box-open",fc="answer-box-shown",gc='[data-role="answer-box-toggle"]';class yc{constructor(t,e,{classPrefix:s=ac,phrases:n={},hideWhenUnanswerable:i=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=n,this._hideWhenUnanswerable=i,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(gc)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case cs.ERRONEOUS:case cs.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||uc:this._phrases.showMore||lc;for(const e of this._element.querySelectorAll(gc))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const bc={isOpen:mc,shown:fc},wc={toggleOpen:["toggle",mc],open:["add",mc],close:["remove",mc],toggleHidden:["toggle",fc],show:["add",fc],hide:["remove",fc]};for(const[t,e]of Object.entries(bc))Object.defineProperty(yc.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(wc))yc.prototype[t]=function(){this._updateBoxStatus(e,s),s===mc&&(this._syncButtonText(),this._syncScroll())};const vc=Object.freeze(cc),Ec=Object.freeze(hc),Sc=Object.freeze(pc);var kc=Object.freeze({__proto__:null,constants:vc,phrases:Ec,templates:Sc,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new yc(t,e,s)}});const Oc=Object.freeze(Ea),Ic=Object.freeze(kc);var xc=Object.freeze({__proto__:null,ask:Oc,hybridSearch:Ic});function Ac(t){const e=t._element;if(!e)return()=>{};const s=e=>t._handleClick(e);return e.addEventListener("click",s),()=>e.removeEventListener("click",s)}const Tc="miso-collapsible",Cc="expanded",Rc=[{action:"expand",classAction:"add",className:Cc},{action:"collapse",classAction:"remove",className:Cc}];class Nc{static get traitName(){return"collapsible"}constructor(t){this._element=t,t.collapsible=this,t.classList.add(Tc),this._unsubscribes=[Ac(this)]}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(Tc),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(t,e){for(const s of e)Object.defineProperty(t,s,{get(){return this._element&&this._element.classList.contains(s)}})}(Nc.prototype,[Cc]),function(t,e){for(const{action:s,classAction:n,className:i}of e)t[s]=function(){this._element&&this._element.classList[n](i),this["_"+s]&&this["_"+s]()}}(Nc.prototype,Rc),function(t,e){t._handleClick=function(t){const{target:s,button:n}=t;if(0===n)for(let{role:n,selector:i,action:o}of e)if(i=i||`[data-role="${n}"]`,i&&s.closest(i))return this[o](),void t.stopPropagation()}}(Nc.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var $c=Object.freeze({__proto__:null,CollapsibleTrait:Nc});const Uc="ui";let Pc,Lc;async function qc(){return Lc||(Lc=U(Pc||(Pc=P(Uc))))}class jc{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Dc{constructor(t,e){this._plugin=t,this._client=e,_(this,{sources:{api:En(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new ea(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Vr(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Mc{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Na(this._plugin,this._MisoClient))}}async function zc(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(xe,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||e.debug;n&&xe.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&xe.plugins.use("std:dry-run");return window.MisoClientSA=xe,xe}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const n=window.misoSA=new e(s);return n.context.anonymous_id=await bt(),n}(t,{MisoClient:e});return await s.ui.ready,[e,s]}let Fc;async function Bc(){return Fc||(Fc=async function(){const[[t,e]]=await Promise.all([zc(Wt),rt(Wt)]);return{MisoClient:t,client:e}}())}xe.plugins.use(class extends tt{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new $a(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new C}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:xc,traits:$c};d(s,this,["layouts","combo","ready"]),_(this,{MisoClient:t}),_(t,{ui:s}),this.combo=new Mc(this,t);const n=Object.values(Ro).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:o,combos:r,contexts:a,...c}=rc,l=[...Object.values(r),...Object.values(a),...Object.values(i),...Object.values(o),...Object.values(c)],u=[Ga,nc,oc];for(const e of[...u,...l])e.MisoClient=t;await qc();for(const t of l)v(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){_(t,{ui:new Dc(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new jc(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new ua(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new ga(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new vr(this,t)),e}});const Qc='<svg fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',Gc='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',Wc='<svg fill="currentColor" viewBox="0 0 24 24">\n<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z"/>\n</svg>',Hc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Vc='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function Yc(t,e,s={}){const{className:n}=t,{cover_image:i,title:o}=e;if(!i)return"";return`<div class="${n}__item-cover-image-container" aria-hidden="true">${`<img class="${n}__item-cover-image" src="${i}" alt="${o}">`}</div>`}function Kc({className:t},{title:e}){let s="";return e&&(s+=`<div class="${t}__item-title">${e}</div>`),`<div class="${t}__item-info-container">${s}</div>`}function Zc(t){if(!t)return"";const{origin:e,hostname:s}=new URL(t);return`\n<div class="miso-list__item-brand-label">\n  <img class="miso-list__item-brand-logo" src="https://www.google.com/s2/favicons?sz=24&amp;domain=${e}">\n  <span>${s.replace(/^www\./,"")}</span>\n</div>\n`}Object.freeze({ordered:!0,article:function(t,e,s,n){const{templates:i}=t,[o,r]=i.helpers.tagPair(t,s);return""+o+Yc(t,s,n)+Kc(t,s)+i.indexBlock(t,s,n)+r},infoBlock:Kc}),Object.freeze({infoBlock:function({className:t},{title:e,snippet:s,created_at:n,updated_at:i,published_at:o,url:r}){const a=o||n||i;let c=`<div class="${t}__item-main-block">`;e&&(c+=`<div class="${t}__item-title">${e}</div>`);s&&(c+=`<div class="${t}__item-snippet">${s}</div>`);c+=`<div class="${t}__item-meta-group">${Zc(r)}`,a&&(c+=`<div class="${t}__item-dot"></div><div class="${t}__item-date">${function(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}(a)}</div>`);return c+="</div></div>",`<div class="${t}__item-info-container">${c}</div>`},imageBlock:Yc});const Jc="header #miso-search",Xc="#siteSearch-open-button";function tl(t){const{searchParams:e}=new URL(window.location.href);return e.set("q",t),"/search/?"+e}async function el(t){const e=document.querySelector(Jc);if(!e)return;const s=document.querySelector(Xc);if(t.page.type===Ut)return void(s&&s.addEventListener("click",(()=>{const t=document.querySelector("#siteSearch-close-button");t&&t.click();const e=document.querySelector(".miso-search-box__input");e&&e.focus()})));const{client:n}=await Bc(),i=n.ui.hybridSearch;i.useLink(tl,{open:!1}),i.autocomplete.enable(),e.classList.add("miso-hybrid-search-input"),e.innerHTML=`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${Hc}</span>\n        <input class="miso-search-box__input" placeholder="What are you searching for?" type="text" autocomplete="off" data-role="input">\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Vc}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}const{currentScript:sl}=document;async function nl({}){await Promise.all([ol()])}let il=!1;async function ol(){if(il)return;if(il=!0,!sl)throw Error("currentScript not found");const t=sl.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}var rl={queryButton:"A.I. Search",home:{title:"Smart Answers from ${name}",queryPlaceholder:"Ask us a question",info:"What is this?"},story:{title:{nonempty:"Explore frequently asked questions",empty:"Explore with a question"},queryPlaceholder:{nonempty:"Ask your own question...",empty:"Ask a question..."}},answers:{title:"Smart Answers",subtitle:"Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.",feedback:{helpful:"Helpful",unhelpful:"Not Helpful"},sources:"My reply is based on the following",relatedResources:"Go beyond, and learn more about this topic",querySuggestions:"Related questions you can explore",followUp:{queryPlaceholder:"Ask a follow-up question",queryButton:"Ask"},affiliation:{title:"Best Prices Today: ${title}"},error:{title:"Oops!",description:"We are currently experiencing some difficulties. Would you please trying again later?"}},sponsor:{phrase:"Supported by",tooltip:"Our sponsors help keep Smart Answers running,<br>but do not influence our editorial independence."}},al=Object.freeze({__proto__:null,default:rl,queryButton:rl.queryButton,home:rl.home,story:rl.story,answers:rl.answers,sponsor:rl.sponsor}),cl={queryButton:"KI-Suche",home:{title:"Smart Answers von ${name}",queryPlaceholder:"Stellen Sie uns eine Frage",info:"Was ist das?"},story:{title:{nonempty:"Hufig gestellte fragen entdecken",empty:"Hufig gestellte fragen entdecken"},queryPlaceholder:{nonempty:"Stellen Sie Ihre eigene Frage...",empty:"Stellen Sie Ihre eigene Frage..."}},answers:{title:"Smart Answers",subtitle:"Erhalten Sie Antworten auf Ihre Technikfragen durch KI, die ausschlielich auf Berichten und Tests unserer Experten basieren.",feedback:{helpful:"Hilfreich",unhelpful:"Nicht hilfreich"},sources:"Meine Antwort basiert auf folgenden Inhalten",relatedResources:"Erfahren Sie mehr ber dieses Thema",querySuggestions:"Verwandte Fragen, die Sie erforschen knnen",followUp:{queryPlaceholder:"Stellen Sie eine Anschlussfrage",queryButton:"Fragen Sie"},affiliation:{title:"Beste Preise heute: ${title}"},error:{title:"Hoppla!",description:"Wir erleben derzeit einige Schwierigkeiten. Wrden Sie es bitte spter noch einmal versuchen?"}},sponsor:{phrase:"Untersttzt von",tooltip:"Unsere Sponsoren helfen, Smart Answers am Leben zu halten, haben aber keinen Einfluss auf unsere redaktionelle Unabhngigkeit."}},ll=Object.freeze({__proto__:null,default:cl,queryButton:cl.queryButton,home:cl.home,story:cl.story,answers:cl.answers,sponsor:cl.sponsor});const ul=function(t){if("de"===t)return ll;return al}("en");const hl="miso-smart-answers";const dl="smart-answers-discovery";function _l(t){return ml("home",function({site:t}){const{name:e,ref_story:s}=t;return`\n<div class="${dl}__container">\n  <div class="${dl}__header">\n    <div class="${dl}__title">\n      ${ul.home.title.replace("${name}",e)}\n    </div>\n    ${fl(s)}\n  </div>\n  <div class="${dl}__body">\n    <div class="${dl}__search-box">\n      <input type="text" class="${dl}__search-box-input" placeholder="${ul.home.queryPlaceholder}" aria-label="${ul.home.queryPlaceholder}">\n      <button class="${dl}__search-box-button" data-role="button">\n        <i>${Qc}</i>\n        <span>${ul.queryButton}</span>\n      </button>\n    </div>\n  </div>\n  <div class="${dl}__footer">\n    ${fl(s)}\n  </div>\n</div>\n`}(t))}function pl(t,e={}){return ml("article",function(t,{questions:e=[]}){const s=0===e.length,n=ul.story.title[s?"empty":"nonempty"],i=ul.story.queryPlaceholder[s?"empty":"nonempty"];return`\n<div class="${dl}__header">\n  <i>${Gc.replace("<svg",'<svg aria-hidden="true" focusable="false"')}</i>\n  <h4 class="${dl}__title">${n}</h4>\n</div>\n<div class="${dl}__body">\n  <div class="${dl}__questions-container">\n    <ul class="${dl}__questions-list">${e.map((e=>function({page:t},{question:e}){return`\n<li class="${dl}__question-item">\n  <a href="/smart-answers?q=${encodeURIComponent(e)}&qs=${encodeURIComponent(t.storyId)}" class="${dl}__question-link" data-role="faq-item" target="_blank" rel="nofollow">${e}</a>\n</li>\n`}(t,{question:e}))).join("")}</ul>\n  </div>\n  ${function({sponsor:t}){return t?`\n<div class="${hl}__sponsor" data-brand="${t.key}">\n  <div class="${hl}__sponsor-text">${ul.sponsor.phrase}</div>\n  <div class="${hl}__sponsor-logo">\n    <img src="${lt(t.image)}" alt="${t.name}">\n  </div>\n  <div class="${hl}__sponsor-info" tabindex="-1">\n    ${Wc}\n    <div class="${hl}__sponsor-info-tooltip">${ul.sponsor.tooltip}</div>\n  </div>\n</div>`.trim():""}(t)}\n  <div class="${dl}__search-box">\n    <input type="text" class="${dl}__search-box-input" placeholder="${i}" aria-label="${i}">\n    <button class="${dl}__search-box-button" data-role="button">\n      <i>${Qc}</i>\n      <span>${ul.queryButton}</span>\n    </button>\n  </div>\n</div>\n`}(t,e))}function ml(t,e){const s=document.createElement("div");return s.classList.add(dl),s.classList.add(t),s.innerHTML=e,s}function fl(t){return t?`\n<div class="${dl}__info">\n  <span>${ul.home.info}</span>\n  <a class="${dl}__info-link" href="/?post_type=post&p=${t}" target="_blank" aria-label="${ul.home.info}">${Wc}</a>\n</div>\n`:""}const gl={impression:new Set,viewable_impression:new Set,click:new Set};function yl(t,e){bl("click",t,e)}function bl(t,e,s){s=function(t,e){const s=[],n=gl[t];for(const t of e)n.has(t)||(s.push(t),n.add(t));return s}(t,s),0!==s.length&&function(t,e,s){const{config:n,site:i,page:o,session_id:r,anonymous_id:a}=e,c="staging"===n.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1",l=["api_key="+n.api_key];!n.dry_run&&function(t){return window.location.hostname===t.hostname}(i)||l.push("&dry_run=1");const u=`${c}/interactions?${l.join("&")}`,h={data:[{type:t,anonymous_id:a,product_ids:[],...e.miso_id?{miso_id:e.miso_id}:{},context:{..._t(),custom_context:{...dt(e),api_group:"ask",api_name:"related_questions",property:"related_questions",page_story_id:o.storyId,session_id:r,...s}}}]};if(!window.navigator.sendBeacon(u,JSON.stringify(h)))throw Error("Send beacon unsuccessful: "+u);At("[Discovery] "+t,h.data)}(t,e,{items:s})}const wl=(()=>{let t="";for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&(t+=`&${encodeURIComponent(e)}=${encodeURIComponent(s)}`);return t})();function vl(t,e){const s=e.querySelector('input[type="text"]');if(!s)throw Error('input[type="text"] not found');s.addEventListener("keydown",(({key:e,isComposing:n})=>{n||"Enter"!==e||El(t,s.value)})),e.addEventListener("click",(({target:n})=>{for(let i=n;i&&i!==e;i=i.parentElement){if(i.matches('a[href][data-role="faq-item"]')){try{yl(t,[Sl(i)])}catch(t){console.error(t)}return}if(i.matches('[data-role="button"]'))return void El(t,s.value)}}))}function El(t,e){if(!e)return;window.open(`/smart-answers?q=${encodeURIComponent(e)}${wl}`,"_blank")}function Sl({href:t}){return new URL(t).searchParams.get("q")}async function kl({config:t,site:e,page:s,session_id:n}){At("[Discovery] Fetching suggested questions from Miso API...");const i=`${"staging"===t.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1"}/ask/related_questions?api_key=${t.api_key}`;try{const t=await window.fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_meta:{site:e.key,session_id:n},product_id:s.storyId})}),{data:o}=await t.json(),{related_questions:r,miso_id:a}=o;return 0===r.length&&At("[Discovery] No suggested questions found."),{related_questions:r,miso_id:a}}catch(t){return At("[Discovery] Failed to fetch suggested questions: "+t),console.error(t),[]}}async function Ol(t){const e=document.querySelector("#miso-smart-answers-faq");if(!e)return void At("[Discovery] No block shown: cannot find the reference position for discovery block.");t={...t,session_id:O()};const[{related_questions:s,miso_id:n}]=await Promise.all([kl(t),nl(t)]);t.miso_id=n;const i=pl(t,{questions:s});vl(t,i),e.insertAdjacentElement("afterend",i),e.parentNode.removeChild(e),function(t,e){bl("impression",t,e)}(t,s),await S(i),function(t,e){bl("viewable_impression",t,e)}(t,s)}async function Il(t){const{page:e}=t;switch(e.type){case"home":await async function(t){const e=document.querySelector(".layout--right-rail");if(!e)return void console.error("[Smart Answers] No block shown: cannot find the reference position for discovery block.");await nl(t);const s=_l(t);vl(t,s),e.insertAdjacentElement("beforebegin",s)}(t);break;case"story":const[s,n]=await Promise.all([Rt(e.postId),bt()]);await Ol({...t,story:s,anonymous_id:n});break;default:At("[Discovery] No discovery block for page type: "+e.type)}}(async(t,s)=>{if("/smart-answers"===window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=e;const i=function(t){const e=window.location.pathname;if("/"===e||t.regions.indexOf(e.substring(1))>=0)return{type:"home",site:t};const s=e.substring(1).split("/");if("article"===s[0]){const e=""+s[1];return{type:"story",site:t,postId:e,storyId:`story_${t.key}_${e}`}}return{type:"other",site:t}}(t),o={site:t,config:s,page:i,version:e,sponsor:n};await Promise.all([Il(o),el(o)])})({key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},t)}();
