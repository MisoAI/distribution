!function(){"use strict";var t=Object.freeze({aff_type:"price_comparison",...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,i]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===i||i);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"===e&&(t.q=s);return t}()}),e="0.9.22";function s(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}function i(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function n(t){return null!=t?""+t:t}function r(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function o(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function a(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}const c="➀➁➂➃➄➅➆➇➈➉",u="➊➋➌➍➎➏➐➑➒➓";function l(t,e){return(e?u:c).charAt(t-1)||""}class h{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);_(s),_(i),_(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>d(this,t)),e):d(this,t),this._value=t}disconnect(){this._active=!1}}function d(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function _(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function p(t){return"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE}function m(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function f(t){return t&&t.ownerDocument&&t.ownerDocument.contains(t)}function g(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function y(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async()=>{try{await t(),e()}catch(t){s(t)}}))}))}async function b(t,{area:e=.5,duration:s=1e3,signal:i}={}){var n;return t="string"==typeof(n=t)?document.querySelector(n):n,new Promise((n=>{const r=new h((t=>{t&&(r.disconnect(),o.disconnect(),n())}),{onDuration:s}),o=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});o.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{r.disconnect(),o.disconnect()}))}))}function w(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function v(t,e){const s=window.localStorage.getItem(t),i=function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t),n=s||i||""+e();return n&&!s&&window.localStorage.setItem(t,n),n&&!i&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n),n}function E(t){return new k(t)}class k{constructor(t){this._value=t;const e=t=>{this._value=t};a(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class R{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class S{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){for(let t=0;;t=this._index+1){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new R),await this._resolution.promise),this._aborted)break;if(yield this._value,this._done)break}}}function x(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const C=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),O=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var I=Object.freeze({__proto__:null,GROUP:C,NAME:O});const A=Symbol.for("miso:resources");class N{constructor(){this._resources=new Map;const t=window[A]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){T(this._resources,t).resolve(e)}async get(t){return T(this._resources,t).promise}}function T(t,e){if(t.has(e))return t.get(e);const s=new R;return t.set(e,s),s}function U(){return window[A]||(window[A]=new N)}class ${constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new R;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class P{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)s(this._unnamedCallbacks,e);else{const i=this._namedCallbacks[t];i&&s(i,e)}}_injectSubscribeInterface(t){o(t,this,["on","once"])}}function q(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class L{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:q(t,e),uuid:w()})}(t,e);a(this,{meta:s});const i=this._error=this._error.bind(this);(this._events=new P({error:i,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(L,"miso:component");class j extends L{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new R);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class D{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const M=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class z{constructor(t,e){this._client=t,this._root=e,this._bulk=new $(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:o}={}){const{apiKey:a,request:c={}}=this._client.options;n=n||c.timeout,(o=o||c.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":a});const u="GET"!==s&&null!=e?JSON.stringify(e):void 0,l=n?AbortSignal.timeout(n):void 0,h=await(this._root._customFetch||window.fetch)(t,r({method:s,headers:i,body:u,cache:"no-cache",mode:"cors",signal:l})),d=await h.json();if(h.status>=400||d.errors){var _=Error(d.message);throw _.data=d,_.status=h.status,_}return d}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=M.DATA_ENDPOINT,eventEndpoint:s=M.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){t.error(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){t.error(e)}return i}}class B extends L{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:Q,NAME:G}=I;class V extends B{constructor(t){super(t,Q.INTERACTIONS)}async upload(t,e){try{return await this._run(G.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===G.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}const{GROUP:F,NAME:W}=I;class H extends B{constructor(t){super(t,F.ASK)}async questions(t,e={}){if("string"==typeof t&&"{"!==t.charAt(0))return new K(this,{question_id:t},e);const s=await this._run(W.QUESTIONS,t,e);return new K(this,s,e)}async _questions(t,e){return this._run(W.QUESTIONS,t,e)}async _get(t,e){return this._run(`${W.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(W.RELATED_QUESTIONS,t,e)}}class K{constructor(t,{question_id:e},s={}){this._api=t,this._questionId=e,this._ac=new AbortController,this._options=s}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,{...this._options,...t})}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...i}=this._options;const n=new D(s);let r;e=x(this._ac.signal,n.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o=0;const a=new S,c=setInterval((async()=>{let e,u;try{[e,u]=await t(r?{signal:r}:{}),n&&n(e,u),o=0}catch(t){return i&&i(t),o++,void(o>s&&(clearInterval(c),a.error(t)))}a.update(e,u),u&&clearInterval(c)}),e);return r&&r.addEventListener&&r.addEventListener("abort",(()=>{clearInterval(c),a.abort(r.reason)})),a}((async({}={})=>{const t=await this.get();return[t,t.finished]}),{interval:t,signal:e,onResponse:(t,e)=>{var s,i;e?n.clear():(i=t,(s=r)&&s.answer_stage===i.answer_stage&&s.answer.length===i.answer.length||n.touch()),r=t},...i})[Symbol.asyncIterator]()}}const{GROUP:Y,NAME:Z}=I;class X extends B{constructor(t){super(t,Y.SEARCH)}async search(t,e){return this._run(Z.SEARCH,t,e)}async autocomplete(t,e){return this._run(Z.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(Z.MGET,t,e)}}const{GROUP:J,NAME:tt}=I;class et extends B{constructor(t){super(t,J.RECOMMENDATION)}async userToProducts(t,e){return this._run(tt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(tt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(tt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(tt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(tt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(tt.PRODUCT_TO_PRODUCTS,t,e)}}class st extends L{constructor(t,e){super("api",t),this._client=t,this.helpers=new z(t,e),this.interactions=new V(this),this.ask=new H(this),this.search=new X(this),this.recommendation=new et(this)}}var it=Object.freeze({__proto__:null,Api:st,ApiBase:B,ApiHelpers:z,Interactions:V,Ask:H,Search:X,Recommendation:et});class nt extends L{constructor(t){super("context",t),this._client=t}}var rt={api:it,context:{Context:nt}};class ot{constructor(t){a(this,{install:t})}}class at extends j{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new ct(this,rt),this.plugins=new ut(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new R);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return a(i,{id:t}),this._tryConfig(i,e),i;case"function":return new ot(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new U).get(s);!this.isRegistered(t)&&this.register(i)}}class ct{constructor(t,e){o(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),a(this,{classes:e})}}class ut{constructor(t){o(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const lt=new class extends L{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new at(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version="1.8.2-beta.7"}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}};var ht=Object.freeze({__proto__:null,viewable:b});class dt extends L{static attach(){(window.MisoClients||(window.MisoClients=[])).push(dt),window.MisoClient?window.MisoClient!==dt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=dt}constructor(t){super("client",lt),this._config(t),this.context=new nt(this),this.api=new st(this,lt),function(t){lt._clients.push(t),lt._events.emit("create",t)}(this)}get version(){return dt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,r(t)}_readConfigFromScriptUrl(){const t=document.currentScript;return r({apiKey:new URL(new Request(t.src||t.href).url).searchParams.get("api_key")||void 0})}}dt.helpers=ht,a(dt,{uuid:w()});var _t=function(t){const e=lt._pluginRoot;return lt.MisoClient=e.MisoClient=t,o(t,lt,["version","instances","any","meta","on","once"]),o(t,e,["plugins"]),t}(dt);class pt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=v("miso_anonymous_id",w))}set anonymous_id(t){t=n(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=n(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}}function mt(){const t=new URLSearchParams(window.location.search);let e=r({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class ft{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function gt({text:t="Miso"}={}){return"%c"+t}function yt({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}function bt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}_t.plugins.register(class{constructor(t={}){this._options=t}static get id(){return"std:debug"}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t)}config(t={}){this._options={...this._options,...t}}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const{type:t}=r.payload.data[0];a.push(t)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logr(...t){const e=this._options.console||{};console.log(gt(e),yt(e),...t)}_log(t,e,...s){const i=this._options.console||{};console.log(gt(i),yt(i),function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(bt)):this._log(t,e,bt(s))}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}}),_t.plugins.use(class extends L{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new pt(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return"interactions"===e&&"upload"===s?this._modifyPayloadForInteractions(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=r({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...n,...t})))}}}),_t.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...r({page:r({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:mt()}),...t.context}})))}}}),_t.plugins.use(class extends L{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new ft(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:i}){if(e===C.SEARCH)if(s===O.SEARCH)this._captureSearchApiRequest(t,i)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}});class wt{constructor(){(this._events=new P)._injectSubscribeInterface(this),this._states={},a(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}function vt(){return"data"}function Et(t){return t?"view:"+t:"view"}class kt{constructor(t){this._hub=t,this._sessionIndex=0,o(t,this,["active"])}get active(){const{session:t}=this._hub.states;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this.new({force:!0}),this.start()}_create(){return Object.freeze({active:!1,uuid:w(),index:this._sessionIndex++})}}class Rt{constructor(t){this._hub=t,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))],this._postProcess=t=>t}get source(){return this._source}set source(t){if(t&&"function"!=typeof t)throw Error("Expect source to be a function: "+t);this._source=t}set postProcess(t){if(t&&"function"!=typeof t)throw Error("Expect postProcess to be a function: "+t);this._postProcess=t||(t=>t)}_handleSession(t){this._source&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this._source)return;const{session:e}=this._hub.states;try{const{signal:s}=this._ac||{},i={...t.options,signal:s},n=await this._source({session:e,...t,options:i});if(n&&n[Symbol.asyncIterator]){let t;for await(t of n){if(!this._isCurrentSession(e))break;this._emitResponse({session:e,value:t})}}else this._emitResponseWithSessionCheck({session:e,value:n})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,error:t})}}_emitResponseWithSessionCheck(t){this._isCurrentSession(t.session)&&this._emitResponse(t)}_isCurrentSession(t){if(!t)return!1;const{session:e}=this._hub.states;return e&&e.index===t.index}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}const St="data-miso-product-id",xt="default",Ct=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",ERROR:"error"}),Ot=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",TEXT:"text",ERROR:"error"}),It=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click"}),At=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Nt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready"});function Tt(t){if(t!==It.IMPRESSION&&t!==It.VIEWABLE&&t!==It.CLICK)throw Error("Unrecognized event type: "+t)}class Ut{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{s(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}class $t{constructor(t,e){this._events=new P({target:this}),this._views=t,a(this,{role:e,interface:new Pt(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ut((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&"function"==typeof t.initialize&&t.initialize(this),this.refresh({force:!0})}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:n,status:r,ongoing:o,meta:a}=e;if(!t&&!(n&&n.active))return;if(!t&&((c=e)===(u=i)||c&&u&&c.status===u.status&&c.error===u.error&&c.value===u.value&&c.ongoing===u.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(c.session,u.session)))return;var c,u;const l=(t={},e)=>{!1!==t&&this.updateState({session:n,status:r,ongoing:o,meta:a,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:l})}catch(t){this._error(t),l({error:t})}}updateState({session:t,status:e,ongoing:s,meta:i,error:n},{silent:o=!1}={}){n&&(e=Nt.ERRONEOUS);const a=this._state=Object.freeze(r({session:t,status:e,ongoing:s,meta:i,error:n})),{role:c}=this;this.hub.update(Et(c),a,{silent:o})}_sliceData(t){const{value:e,error:s,...i}=t;return r({value:this.role===Ct.ERROR?s:e&&e[this.role],...i})}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Pt{constructor(t){o(this,t,["role","layout","element","proxyElement","refresh","on"])}}class qt{constructor(t,e,{roles:s=[],layouts:i={}}){this._hub=t,this._extensions=e,this._containers=new Map,this._views={};for(const t of s)this._views[t]=new $t(this,t);this._layoutFns=new Map,this.layouts=i,a(this,{interface:new Lt(this)});const n=()=>this.syncSize();window.addEventListener("resize",n),this._unsubscribes=[()=>window.removeEventListener("resize",n),t.on(vt(),(()=>this.refresh()))]}addContainer(t){if(this._containers.has(t))return;const e=new $t(this,Ct.CONTAINER);e.layout=this._layoutFns.get(Ct.CONTAINER)(),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}set layouts(t){for(let[e,s]of Object.entries(t))if(this._layoutFns.set(e,s),e===Ct.CONTAINER)for(const t of this._containers.values())t.layout=s();else this.get(e).layout=s()}get(t){return this._views[t]||(this._views[t]=new $t(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t}={}){const e=this._getData();await Promise.all(this._getViews(!0).map((s=>s.refresh({force:t,data:e}))))}_getData(){const{[vt()]:t}=this._hub.states;if(!this._data||this._data.data!==t){const e=t&&t.session&&t.session.active?t.error?Nt.ERRONEOUS:t.value?Nt.READY:Nt.LOADING:Nt.INITIAL,s=e===Nt.READY?!!t.ongoing:void 0;this._data=Object.freeze({...t,status:e,ongoing:s})}return this._data}_error(t){console.error(t)}destroy(){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Lt{constructor(t){this._actor=t,o(this,t,["syncSize","refresh"])}get(t){return this._actor.get(t).interface}get views(){return this._actor.views.map((t=>t.interface))}}function jt(t){return e=>Array.from(e.querySelectorAll(`[${t}]`)).map((e=>({element:e,value:{product_id:e.getAttribute(t)}})))}class Dt{constructor({keyAttrName:t="data-key",list:e}={}){this._list=e||jt(t),this._bindings=new Map,this._e2b=new WeakMap}list(){return[...this._bindings.values()]}get(t){if(!t)throw Error("Value or element is required.");if(this._root)return p(t)?m(t,(t=>this._e2b.get(t)||void 0),{root:this._root}):this._bindings.get(t)}refresh(t){if(!t)return this.unbindAll();this._root=t;const e=this._purge(),s=[];for(const i of this._list(t)){const[t,...n]=this._bind(i);t&&s.push(t);for(const t of n)e.push(t)}return{bounds:s,unbounds:e}}unbindAll(){const t=this.list();return this._bindings.clear(),this._root=void 0,{bounds:[],unbounds:t}}_bind({element:t,key:e,value:s}){if(!(e=e||s))throw Error("Key or value is required.");if(!t)throw Error("Element is required.");const i=this._bindings.get(e);if(i&&i.element===t)return[];const n=this._unbind(this.get(e)),r=this._unbind(this.get(t)),o=Object.freeze({key:e,value:s,element:t});this._bindings.set(e,o),this._e2b.set(t,o);const a=[o];return n&&a.push(n),r&&a.push(r),a}_purge(){const t=[];for(const e of this._bindings.values()){const{element:s}=e;f(s)||t.push(this._unbind(e))}return t}_unbind(t){return t&&(this._bindings.delete(t.key),this._e2b.delete(t.element)),t}_destroy(){this.unbindAll()}}const{IMPRESSION:Mt,VIEWABLE:zt,CLICK:Bt}=It,{UNTRACKED:Qt,TRIGGERED:Gt}=At;class Vt{static NEW={[Mt]:Qt,[zt]:Qt};static UNTRACKED=Object.freeze({[Mt]:Qt,[zt]:Qt,[Bt]:Qt});constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(t);return e?{...e}:Vt.UNTRACKED}get(t,e){const s=this._states.get(t);return s&&s[e]||Qt}set(t,e,s){Tt(e),function(t){if(t!==At.UNTRACKED&&t!==At.TRACKING&&t!==At.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of i(t))this._setOne(n,e,s)}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,t,(()=>({...Vt.NEW}))))[e]=s}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Gt))}}const{IMPRESSION:Ft,VIEWABLE:Wt,CLICK:Ht}=It,{UNTRACKED:Kt,TRACKING:Yt,TRIGGERED:Zt}=At;function Xt(t,e){return!!e&&{...t,...e}}const Jt=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});class te{constructor({proxyElement:t,element:e,sessionId:s="default",active:i=!0,bindings:n}={}){this._events=new P({target:this}),this._proxyElement=t||new Ut(e),this._getSessionId="function"==typeof s?s:()=>s,this._isActive="function"==typeof i?i:()=>i,this._bindings=new Dt(n),this._viewables=new WeakMap,this._options=Jt,this._unsubscribes=[this._proxyElement.on("click",(t=>this._handleClick(t))),this._proxyElement.on("element",(()=>this.refresh()))],this.refresh()}get active(){return this._isActive()}config(t){this._options=this._normalizeOptions(t)}_normalizeOptions({impression:t={},viewable:e={},click:s={},...i}={}){return r({...Jt,...i,impression:Xt(Jt.impression,t),viewable:Xt(Jt.viewable,e),click:Xt(Jt.click,s)})}refresh(){this._syncElement(),this._syncStates(),this._refreshBindings()}_syncStates(){const t=this._getSessionId();t&&(this._states&&t!==this._states.sessionId&&this._retireStates(),!this._states&&t&&(this._states=new Vt(t)))}impression(t,e){this._assertActive(),this._trigger(Ft,t,{manual:!0,...e})}viewable(t,e){this._assertActive(),this._trigger(Wt,t,{manual:!0,...e})}click(t,e){this._assertActive(),this._trigger(Ht,t,{manual:!0,...e})}_assertActive(){if(!this._isActive())throw Error("Tracker is not active.")}getState(t){return Object.freeze({[Ht]:this._proxyElement.current?Yt:Kt,...this._states.getFullState(t)})}_syncElement(){this._proxyElement.sync({silent:!0});const t=this._proxyElement.current;this._element!==t&&(this._retireElement(),t&&this._options.watch&&(this._mutationObserver=new MutationObserver((()=>this.refresh())),this._mutationObserver.observe(t,{childList:!0,subtree:!0})),this._element=t)}_retireElement(){this._element&&(this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=void 0),this._element=void 0)}_retireStates(){const{unbounds:t}=this._bindings.unbindAll();this._untrackViewables(t),this._states=void 0}_refreshBindings(){if(!this._states)return;const t=this._proxyElement.current,{bounds:e,unbounds:s}=this._bindings.refresh(t);this._untrackViewables(s),this._trackImpressions(e),this._trackViewables(e)}_trackImpressions(t){this._options.impression&&this._trigger(Ft,t.map((t=>t.value)),{bindings:t})}_trackViewables(t){if(this._options.viewable)for(const e of t)this._trackViewableOnElement(e)}async _trackViewableOnElement(t){const{value:e,element:s}=t;if(!e||!p(s)||this._viewables.has(s))return;if(this._states.get(e,Wt)!==Kt)return;this._states.set(e,Wt,Yt);const{area:i,duration:n}=this._options.viewable,r=new AbortController,{signal:o}=r;this._viewables.set(s,{ac:r}),await b(s,{area:i,duration:n,signal:o}),this._viewables.delete(s),this._trigger(Wt,[e],{bindings:[t]})}_untrackViewableOnElement({value:t,element:e}){const s=this._viewables.get(e);if(!s)return;s.ac.abort(),this._viewables.delete(e);const i=Wt;this._states.get(t,i)===Yt&&this._states.set(t,i,Kt)}_untrackViewables(t){for(const e of t)this._untrackViewableOnElement(e)}_handleClick(t){const e=this._options&&this._options.click;if(!e||!this._isActive())return;const s=this._bindings.get(t.target);if(s){if("function"==typeof e.validate){if(!e.validate(t,s))return}else if(!e.lenient){if(0!==t.button)return;if(t.defaultPrevented)return;if(!m(t.target,(t=>"A"===t.tagName&&t.href||void 0)))return}this._trigger(Ht,[s.value],{bindings:[s]})}}_trigger(t,e,{manual:s=!1,bindings:n}={}){Tt(t),this._isActive()&&0!==(e=this._states.untriggered(i(e),t)).length&&(this._states.set(e,t,Zt),this._events.emit(t,{event:t,values:e,manual:s,bindings:n}))}destroy(){this._retireElement(),this._retireStates(),this._bindings._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}const ee=new Set([Ct.PRODUCTS,Ct.SOURCES,Ct.RELATED_RESOURCES]);function se({property:t,misoId:e},{event:s,values:i,manual:n}){let o;if(e)try{o=function(t){const e=t.split("-"),s=""+e[2].substring(1)+e[1]+e[0];return Math.floor(parseInt(s,16)/1e7)-12219292800}(e)}catch(t){}const a=function(t){return ee.has(t)}(t);return r({type:"viewable"===s?"viewable_impression":s,product_ids:a?i.map((t=>t.product_id)).filter((t=>t)):[],miso_id:e,context:{custom_context:r({api_ts:o,property:t,items:a?void 0:i.map((t=>t.text||t)),trigger:n?"manual":"auto"})}})}function ie(t){return t&&t.status===Nt.READY}class ne{constructor(t,e,{active:s,bindings:i,...n}={}){this._hub=t,this._view=e,this._bindings=i;const r=this._role=e.role;this._tracker=new te({bindings:{list:t=>this._listBindingsFn()(t)},proxyElement:e.proxyElement,sessionId:()=>this._getSessionId(),active:s||(()=>this._isViewReady()),...n}),this._unsubscribes=[this._tracker.on("*",(t=>this._handleEvent(t))),t.on(Et(r),(()=>this.refresh()))],this.refresh()}config(t){const{active:e}=this._hub;if(e)throw Error("Cannot change configuration after workflow starts.");this._tracker.config(t)}start(){throw Error("workflow.tracker.start() is deprecated. Use workflow.startTracker() instead.")}refresh(){this._tracker.refresh()}impression(t,e){this._assertViewReady(),this._tracker.impression(t.map((t=>({product_id:t}))),e)}viewable(t,e){this._assertViewReady(),this._tracker.viewable(t.map((t=>({product_id:t}))),e)}click(t,e){this._assertViewReady(),this._tracker.click(t.map((t=>({product_id:t}))),e)}_listBindingsFn(){if(this._bindings&&"function"==typeof this._bindings.list)return this._bindings.list;const{layout:t}=this._view;return t&&t.bindings&&"function"==typeof t.bindings.list?t.bindings.list:jt(St)}_assertViewReady(){if(!this._hub.active)throw Error("Workflow is not active. Call workflow.start() to activate it.");if(!ie(this._getViewState()))throw Error("Workflow is not rendered yet. If you handle rendering by yourself, call workflow.notifyViewUpdate() when DOM is ready.")}_getViewState(){return this._hub.states[Et(this._role)]}_isViewReady(){return this._hub.active&&ie(this._getViewState())}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||this._element&&this._element.getAttribute("miso-id")||void 0}getState(t){return this._tracker.getState(t)}_handleEvent(t){const e="results"===this._role?"products":this._role,s=this._getMisoId();this._hub.trigger("interaction",se({property:e,misoId:s},t))}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._tracker.destroy()}}class re{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[vt()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};s&&this._hub.trigger("interaction",this._buildInteraction(s,t))}_buildInteraction(t,{value:e,unselected:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_id:t,value:s?"unselected":e}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class oe{constructor(t,e,s={}){this._client=e,this.config(s),this._unsubscribes=[t.on("interaction",(t=>this._send(t)))]}config(t={}){if(t.preprocess&&"function"!=typeof t.preprocess)throw Error("preprocess must be a function");this._options=t}_send(t){t=i(t);const{preprocess:e}=this._options;e&&(t=t.map(e)),t.length>0&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ae(t){return async({group:e,name:s,payload:i,options:n})=>e===C.ASK&&s===O.QUESTIONS?t.api.ask.questions(i,n):t.api[e]._run(s,i,n)}class ce{constructor({role:t,...e}={}){a(this,{role:t,options:e}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=E(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,y((()=>this._doRaf())))}_doRaf(){this._requested&&(this._requested=!1,this._applyRender())}_applyRender(t={}){if(!this._pending)return;const e=Date.now();let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const n=this._rendered.get(this._element),r=E([]),o=E({});this._render(this._element,{state:s,rendered:n,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),this._rendered.set(this._element,Object.freeze({...s,...o.value})),i&&i(...r.value)}_render(){throw Error("Unimplemented")}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ue(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function le({className:t},{title:e,description:s,sale_price:i,original_price:n}){let r="";e&&(r+=`<div class="${t}__item-title">${e}</div>`),s&&(r+=`<div class="${t}__item-desc">${s}</div>`);const o=i||n;return o&&(r+=`<hr><div class="${t}__item-price">${o}</div>`),`<div class="${t}__item-info-container">${r}</div>`}function he({className:t,templates:e},{title:s,snippet:i,description:n,created_at:r,updated_at:o,published_at:a}){const c=o||a||r;let u="";return s&&(u+=`<div class="${t}__item-title">${s}</div>`),c&&(u+=`<div class="${t}__item-date">${(e.date||me)(c)}</div>`),i?u+=`<div class="${t}__item-snippet">${i}</div>`:n&&(u+=`<div class="${t}__item-desc">${n}</div>`),`<div class="${t}__item-info-container">${u}</div>`}function de({className:t},{product_id:e,url:s}){const i=s?"a":"div";return[`<${i} class="${t}__item-body" data-role="item" ${e?`${St}="${e}"`:""} ${s?`href="${s}" target="_blank" rel="noopener"`:""}>`,`</${i}>`]}function _e({className:t},{cover_image:e}){if(!e)return"";return`<div class="${t}__item-cover-image-container">${`<img class="${t}__item-cover-image" src="${e}">`}</div>`}function pe({className:t},e,{index:s}){const i=s+1;return`<div class="${t}__item-index" data-index="${i}" data-char="${l(i)}" data-char-negative="${l(i,!0)}"></div>`}function me(t){return new Date(t).toLocaleDateString()}class fe extends ce{constructor({className:t,templates:e,...s}={}){super(s),a(this,{className:t,templates:{...ue("root"),...e}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class ge extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){ge.MisoClient.ui.layouts.create("banner").render(this)}}class ye extends ce{static get category(){return Ot.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e})}_render(t,{state:e}){this._syncBanner(t),this._syncStatus(t,{state:e})}_syncBanner(t){const e=ge.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===Ct.PRODUCTS||t===Ct.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,meta:{miso_id:i}={}}=e;t.setAttribute("status",s),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}}const be=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class we extends fe{static get category(){return Ot.ERROR}static get type(){return"error"}static get defaultTemplates(){return be}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...be,...e},...s})}}const ve='<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';const Ee=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});const ke=Symbol.for("miso.value");const Re=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=de(t,s);return""+r+(n.indexBlock||pe)(t,s,i)+(n.imageBlock||_e)(t,s,i)+(n.infoBlock||le)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=de(t,s);return""+r+(n.indexBlock||pe)(t,s,i)+(n.imageBlock||_e)(t,s,i)+(n.infoBlock||he)(t,s,i)+o},question:function(t,e,s){const[i,n]=de(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===Nt.READY?n[r](t,e):""}</div>`},[Nt.READY]:function(t,e){const{templates:s}=t,i=e.value;return i&&i.length>0||e.ongoing?s.list(t,e,i):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-item-type="${r.itemType}">${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map((s=>n.item(t,e,s,r++))).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`}});class Se extends fe{static get category(){return Ot.LIST}static get defaultTemplates(){return Re}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Re,...t},itemType:e,...s}),a(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})}),this._view=void 0}initialize(t){this._view=t;const{proxyElement:e}=this._view=t;this._unsubscribes.push(e.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===Nt.READY&&e.status===Nt.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=t.value.slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n;this._syncValues(t,e)}_syncValues(t,e){if(!t)return;const s=e.value||[];let i=0;for(const e of this._listItemElements(t))e[ke]=s[i++]}_getListElement(t){return t.querySelector(`.${this.className}__list`)}_listItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_listBindings(t){return this._listItemElements(t).map((t=>{const e=t[ke];return{element:t,key:"product"===this.options.itemType?e.product_id:e,value:e}}))}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=e[ke],{session:i}=this._view._state;this._view._events.emit("click",{session:i,value:s,element:e})}destroy(){this._view=void 0,super.destroy()}}const xe="miso-list";class Ce extends Se{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return xe}constructor({className:t=xe,...e}={}){super({className:t,...e})}}const Oe="miso-cards";const Ie="miso-carousel",Ae=Object.freeze({ready:function(t,e){const{templates:s}=t,i=e.value&&e.value.length>0,n=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,n):n},carousel:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-previous" data-role="previous">${n.previous(t,e)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(t,e)}</div>`},previous:Te,next:Te}),Ne=Object.freeze({...Se.defaultTemplates,...Ae});function Te(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Ue="miso-search-box";const $e=Object.freeze({root:function(t){const{className:e,role:s,templates:i,options:n}=t,{autocomplete:r,placeholder:o,buttonText:a="Search"}=n;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit">${a}</button>\n  </div>\n  ${r?i.autocomplete(t):""}\n</div>\n`},autocomplete:function(t){const{className:e,templates:s}=t;return`\n<div class="${e}__autocomplete" data-role="autocomplete">\n  ${s.suggestionList(t)}\n</div>\n`},suggestionList:function(t){const{className:e}=t;return`<ol class="${e}__suggestion-list" data-role="suggestion-list"></ol>`},suggestionItem:function(t,e){const{className:s}=t;return`<li class="${s}__suggestion-item" data-role="suggestion-item" tabindex="0">${e.text||e}</li>`}});class Pe extends fe{static get category(){return Ot.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return $e}static get defaultClassName(){return Ue}constructor({className:t=Ue,templates:e,...s}={}){super({className:t,templates:{...$e,...e},...s}),this._contexts=new WeakMap,this._suggestionItems=new WeakMap}initialize(t){const{autocomplete:e}=this.options;this._view=t;const{proxyElement:s,hub:i}=t;this._unsubscribes=[...this._unsubscribes,s.on("keydown",(t=>this._handleKeyDown(t))),s.on("click",(t=>this._handleClick(t)))],e&&this._unsubscribes.push(i.on("suggestions",(()=>this._handleInput())))}_preprocess({state:t}){t=super._preprocess({state:t});const{autocomplete:e}=this.options;if(!e)return t;const s=this._view.hub.states.suggestions;return{...t,suggestions:s}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._setupAutocomplete(t),this._renderSuggestions(t,e,s)}_setupAutocomplete(t){const{autocomplete:e}=this.options;e&&this._context(t).setupAutocomplete()}_renderSuggestions(t,{state:e},{writeToState:s}={}){const{autocomplete:i}=this.options;if(!i)return;const{suggestionListElement:n,autocompleteElement:r}=this._context(t);if(!n)return void(s&&s({suggestions:{value:[]}}));const{suggestions:o={}}=e,a=o.value||[];r.classList[0===a.length?"add":"remove"]("empty"),n.innerHTML=a.map((t=>this.templates.suggestionItem(this,t))).join("");let c=0;for(const t of n.children)this._suggestionItems.set(t,a[c++])}_context(t){if(!(t=t||this._view.element))return qe.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new qe(t)),e}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick({target:t}){const{inputElement:e}=this._context();for(let s=t;s&&s!==this._view.element;s=s.parentElement)if(s.matches('[type="submit"]')||s.matches('[data-role="button"]'))return void(e&&(e.blur(),this._submit(e.value)));const{autocomplete:s}=this.options;if(s)for(let s=t;s&&s!==this._view.element;s=s.parentElement){const t=this._suggestionItems.get(s);if(!t)continue;const i=t.text||t;return e&&(e.value=i),void this._submit(i)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}class qe{static empty(){return qe._empty||(qe._empty=new qe)}constructor(t){this._element=t,this._cache={}}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get suggestionListElement(){return this._get("suggestion-list")}setupAutocomplete(){if(!this._element||this._autocompleteSetup)return;this._autocompleteSetup=!0;const{inputElement:t,autocompleteElement:e}=this;t&&e&&(t.addEventListener("focus",(()=>{e.classList.add("open")})),t.addEventListener("blur",(()=>{e.classList.remove("open")})))}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Le=Symbol.for("miso.option-value"),je="miso-option-list";const De=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${e.text||e}</li>`}});class Me extends fe{static get category(){return Ot.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return De}static get defaultClassName(){return je}constructor({className:t=je,templates:e,...s}={}){super({className:t,templates:{...De,...e},...s}),a(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})})}initialize(t){this._view=t;const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s),this._syncOptionValues(t,e)}_syncOptionValues(t,{state:e}){if(!t)return;const s=this._getOptionsElement(t);if(!s)return;const i=e.value||[];s.classList[0===i.length?"add":"remove"]("empty");let n=0;for(const t of this._listOptionElements(s))t[Le]=i[n++]}_listBindings(t){if(!t)return[];const e=this._getOptionsElement(t);return this._listOptionElements(e).map((t=>{const e=t[Le];return{key:e.text||e,value:e,element:t}}))}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_listOptionElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){for(let e=t.target;e&&e!==this._view.element;e=e.parentElement){const t=e[Le];if(t)return void this._submit(t.text)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}const ze=Object.freeze({...ue("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Be extends fe{static get category(){return Ot.RADIO}static get defaultTemplates(){return ze}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...ze,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=this._view=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=m(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],y((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Qe="miso-feedback",Ge=[{text:"Helpful",value:"helpful",icon:ve},{text:"Not helpful",value:"unhelpful",icon:ve}];const Ve=Object.freeze({options:function(t){const{templates:e}=t;return Ge.map((s=>e.option(t,s))).join("")},content:function(t,{text:e,icon:s}){const{className:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${i}__icon">${s}</i>`:""}\n${!1!==n.text?`<span class="${i}__text">${e}</span>`:""}\n`}});class Fe extends Be{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return Ve}static get defaultClassName(){return Qe}constructor({className:t=Qe,templates:e,...s}={}){if(super({className:t,templates:{...Ve,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const We="miso-text";const He=Object.freeze({root:function(t,e){const{className:s,role:i,options:{tag:n}}=t;return`<${n} class="${s}" ${i?`data-role="${i}"`:""}>${e.value||""}</${n}>`}});class Ke extends fe{static get category(){return Ot.TEXT}static get type(){return"text"}static get defaultTemplates(){return He}static get defaultClassName(){return We}constructor({className:t=We,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...He,...e},tag:s,...i})}}class Ye extends ce{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t={}){const e=E(!1);super._applyRender({...t,loop:e.t}),e.value&&this._requestRaf()}}class Ze{constructor(t={}){this._cps=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return({doneAt:s,timestamp:i})=>{let n=t*(Math.random()+.5);return e>0&&void 0!==s&&(n*=1+(i-s)*e/1e3),n}}(t)}get(t,e){const s=this._cps(e);return t.cursor+Math.floor((e.timestamp-t.timestamp)*s/1e3)}}class Xe{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),u=!i.startsWith(c);return a||u?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function Je(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,ts(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||Nt.INITIAL),i}function ts(t){return t+"__cursor"}const es="miso-typewriter";class ss extends Ye{static get category(){return Ot.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return es}constructor({className:t=es,tag:e="auto",format:s="markdown",...i}={}){super({tag:e,format:s,...i}),a(this,{className:t}),this._prevState=void 0,this._progress=new Ze(i),this._readiness=new R,"markdown"===s&&ss.MisoClient.plugins.install("std:ui-markdown")}initialize(t){this._view=t,this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown"),e=ts(this.className);this._renderer=t.createRenderer({onRefChange:(t,s)=>{t&&t.classList.remove(e),s&&s.classList.add(e)},onDone:t=>{t.classList.add("done")},onDebug:this.options.onDebug||void 0}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._handleClick(t))))}async _setupForPlaintext(){this._renderer=new Xe}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:n,status:o,ongoing:a}=t,c=i&&i.answer_stage||"result",u=(h=t,(l=e)&&h&&l.session&&h.session&&l.session.uuid===h.session.uuid);var l,h;const d=e?u&&c===e.stage?e.streak:e.streak+1:0,_=u&&e&&e.doneAt||(o!==Nt.READY||a?void 0:Date.now());return this._prevState=Object.freeze(r({session:n,status:o,value:s,stage:c,streak:d,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=Je(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._progress.get(s,e);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);n(a);const c=e.status===Nt.READY&&!a.done;i({ongoing:c},{silent:c&&(!s||s.status===Nt.READY)}),c&&r()}_handleClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}var is=Object.freeze({__proto__:null,TemplateBasedLayout:fe,ContainerLayout:ye,ErrorLayout:we,BannerLayout:class extends fe{static get category(){return Ot.BANNER}static get type(){return"banner"}static get defaultTemplates(){return Ee}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Ee,...e},...s})}},CollectionLayout:Se,ListLayout:Ce,CardsLayout:class extends Se{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Oe}constructor({className:t=Oe,...e}={}){super({className:t,...e})}},CarouselLayout:class extends Se{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return Ne}static get defaultClassName(){return Ie}constructor({className:t=Ie,templates:e,...s}={}){super({className:t,templates:{...Ae,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._itemCount=i.value?i.value.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:Pe,OptionListLayout:Me,FeedbackLayout:Fe,TextLayout:Ke,TypewriterLayout:ss});function ns(t={},e={}){return Object.freeze({...t,...e,payload:Object.freeze({...t.payload,...e.payload})})}function rs(t={},e={}){return!1!==e&&Object.freeze({...t,...e,preprocess:(s=t.preprocess,i=e.preprocess,s?i?(...t)=>i(s(...t)):s:i)});var s,i}function os(t){let[e,s]=i(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}const as=t=>t;class cs extends L{constructor(t,e,{name:s,roles:i,layouts:n={},defaultApiParams:r,interactionsOptions:o}){super(s||"workflow",t),this._plugin=t,this._client=e,this._name=s,this._roles=i;const a=t._getExtensions(e);this._defaultLayouts={[Ct.CONTAINER]:ye.type,[Ct.ERROR]:we.type,...n},this._apiParams=this._defaultApiParams=r,this._defaultInteractionsOptions=o=rs({preprocess:t=>this._preprocessInteraction(t)},o);const c=this._hub=function(t,e){const{update:s,trigger:i}=t;return t.update=(i,n,r)=>(r&&r.silent||e("update",i,n,r),s.call(t,i,n,r)),t.trigger=(...s)=>(e("trigger",...s),i.apply(t,s)),t}(new wt,((...t)=>this._log(...t)));this._sessions=new kt(c),this._data=new Rt(c),this._views=new qt(c,a,{roles:i,layouts:this._generateLayoutFactoryFunctions(this._defaultLayouts)}),this._interactions=new oe(c,e,o),this._data.source=ae(this._client),this._customProcessData=as,this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t)))]}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this.reset(),this.start(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid===this.session.uuid)return this._sessions.start(),t=this._customProcessData(this._defaultProcessData(t)),this._hub.update(vt(),t),this}_defaultProcessData(t){const{value:e}=t;return e&&e.miso_id?{...t,meta:{...t.meta,miso_id:e.miso_id}}:t}useDataProcessor(t){if(t&&"function"!=typeof t)throw Error("Data processor must be a function or undefined.");return this._customProcessData=t||as,this}notifyViewUpdate(t,e){return this._assertActive(),e={status:Nt.READY,session:this.session,...e},this._hub.update(Et(t),e),this}useApi(t,e){return!1===t?this._data.source=!1:"object"==typeof t&&void 0===e?(e=t,t=void 0):this._apiParams=ns(this._defaultApiParams,r({name:t,payload:e})),this}useLayouts(t={}){return this._views.layouts=this._generateLayoutFactoryFunctions(t),this}_generateLayoutFactoryFunctions(t){const e={};for(const[s,i]of Object.entries(t)){if(!1===i){e[s]=()=>!1;continue}let[t,n]=os(this._defaultLayouts[s]),[r,o]=os(i);if(r=r||t,o={...n,...o},!r)throw Error("Layout name is required for role "+s);e[s]=t=>this._plugin.layouts.create(r,{...o,...t,role:s})}return e}useInteractions(t){return this._interactions.config(rs(this._defaultInteractionsOptions,t)),this}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:i,name:n}=this._apiParams;return{...s,context:{...e,custom_context:{api_group:i,api_name:n,...t}}}}destroy(){this._events.emit("destroy"),this._destroy()}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views.destroy(),this._data.destroy()}_log(t,e,s){this._events.emit(e,{_action:t,...s})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}const us=Object.freeze({group:C.ASK,name:O.QUESTIONS,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),ls=Object.freeze({[Ct.QUERY]:[Pe.type,{buttonText:"Ask"}],[Ct.QUESTION]:[Ke.type,{tag:"h2"}],[Ct.ANSWER]:ss.type,[Ct.FEEDBACK]:Fe.type,[Ct.SOURCES]:[Ce.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Ct.RELATED_RESOURCES]:[Ce.type,{incremental:!0,itemType:"article"}],[Ct.QUERY_SUGGESTIONS]:Me.type});function hs(t){return t?{...ls,[Ct.QUERY]:[Pe.type,{buttonText:"Ask"}]}:ls}class ds extends cs{constructor(t,e){super(t._plugin,t._client,{name:"ask",roles:Object.keys(ls),layouts:hs(e),defaultApiParams:us}),this._context=t,a(this,{parentQuestionId:e}),this._feedback=new re(this._hub),this._trackers={sources:new ne(this._hub,this._views.get(Ct.SOURCES)),relatedResources:new ne(this._hub,this._views.get(Ct.RELATED_RESOURCES))},this._setSuggestedQuestions(),Object.freeze(this._trackers),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this.query(t))),this._hub.on(vt(),(t=>this._onDataUpdate(t))),this._hub.on(Et(Ct.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Ct.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))],e&&t._byPqid.set(e,this),t._events.emit("create",this),this.reset()}get questionId(){return this._questionId}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}query({q:t,...e}={}){e={...e,question:t},this.parentQuestionId&&(e.parent_question_id=this.parentQuestionId),this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0),this.restart();const{session:s}=this;return this._hub.update("request",ns(this._apiParams,{payload:e,session:s})),this}restart(){const{session:t,status:e,ongoing:s}=this._hub.states[Et(Ct.ANSWER)]||{};if(t&&e!==Nt.INITIAL&&(e!==Nt.READY||s)){const i=Object.freeze({session:t,status:e,ongoing:s});this._events.emit("interrupt",i),this._events.emit("finally",i)}super.restart()}_defaultProcessData(t){t=super._defaultProcessData(t);const{value:e}=t;return e?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:e.answer_stage}}:t}_onDataUpdate(t){if(this._questionId)return;const e=t&&t.value&&t.value.question_id;e&&(this._questionId=e,this._context._byQid.set(e,this))}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===Nt.INITIAL)return;const i=e===Nt.READY&&!s,n=e===Nt.ERRONEOUS,r=i?"done":n?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._events.emit(r,o),(i||n)&&this._events.emit("finally",o)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[vt()].value,s=e.suggested_followup_questions||e.followup_questions||[];if(s.length>0){const t=this._views.get(Ct.QUERY_SUGGESTIONS);(this._trackers.querySuggestions=new ne(this._hub,t,{active:!0})).config({click:{validate:t=>0===t.button}})}this._hub.update("suggestions",{value:s.map((t=>({text:t})))})}_onCitationClick({index:t}){const{value:e}=this.states[vt()]||{},{sources:s}=e||{},i=s&&s[t-1];i&&i.product_id&&this._trackers.sources.click([i.product_id],{manual:!1})}get trackers(){return this._trackers}useTrackers({sources:t,relatedResources:e}={}){return this._trackers.sources.config(t),this._trackers.relatedResources.config(e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;let{rootQuestionId:i,parentQuestionId:n,questionId:o}=this;return s.property===Ct.QUERY_SUGGESTIONS&&(o=n,n=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions"),t.context={...e,custom_context:r({root_question_id:i,parent_question_id:n,question_id:o,...s})},t}_destroy(){const{parentQuestionId:t,questionId:e}=this;t&&this._context._byPqid.delete(t),e&&this._context._byQid.delete(e),this._feedback._destroy(),this._trackers.sources._destroy(),this._trackers.relatedResources._destroy(),super._destroy()}}class _s extends L{constructor(t,e){super("asks",t),this._plugin=t,this._client=e,this._byQid=new Map,this._byPqid=new Map,this._root=new ds(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new ds(this,t)),s}}const ps=Object.freeze({group:C.ASK,name:O.RELATED_QUESTIONS}),ms=Object.freeze({[Ct.RELATED_QUESTIONS]:[Ce.type,{itemType:"question"}]});class fs extends cs{constructor(t,e){super(t,e,{name:"explore",roles:Object.keys(ms),layouts:ms,defaultApiParams:ps}),this._productId=void 0,this._linkFn=void 0,this._tracker=new ne(this._hub,this._views.get(Ct.RELATED_QUESTIONS)),this._unsubscribes.push(this._views.get(Ct.RELATED_QUESTIONS).on("click",(t=>this._handleQuestionClick(t))))}get tracker(){return this._tracker}get productId(){return this._productId}set productId(t){this._productId=t}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start(){if(!this._productId)throw Error("Set productId before calling start()");if(void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:t}=this;return this._hub.update("request",{...this._apiParams,payload:{...this._apiParams.payload,product_id:this._productId},session:t}),this}notifyViewUpdate(t=Ct.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._linkFn(t)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}useTracker(t){return this._tracker.config(t),this}_destroy(){this._tracker._destroy(),super._destroy()}}const gs=Object.freeze({group:C.SEARCH,name:O.SEARCH,payload:{fl:["*"]}}),ys=Object.freeze({[Ct.QUERY]:Pe.type,[Ct.PRODUCTS]:Ce.type});class bs extends cs{constructor(t,e){super(t,e,{name:"search",roles:Object.keys(ys),layouts:ys,defaultApiParams:gs}),this._unsubscribes.push(this._hub.on("query",(t=>this.query(t))))}useLayouts({[Ct.RESULTS]:t,...e}={}){void 0!==t&&(console.warn(`useLayouts({ ${[Ct.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Ct.PRODUCTS]}: ... }) instead`),e[Ct.PRODUCTS]=t),super.useLayouts(e)}query(t){this.restart();const{session:e}=this;return this._hub.update("request",ns(this._apiParams,{payload:t,session:e})),this}notifyViewUpdate(t=Ct.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}const ws=Object.freeze({group:C.RECOMMENDATION,name:O.USER_TO_PRODUCTS,payload:{fl:["*"]}}),vs=Object.freeze({[Ct.PRODUCTS]:Ce.type});class Es extends cs{constructor(t,e){super(t._plugin,t._client,{name:"recommendation",roles:Object.keys(vs),layouts:vs,defaultApiParams:ws}),this._tracker=new ne(this._hub,this._views.get(Ct.PRODUCTS)),a(this,{id:e}),this._context=t,t._members.set(e,this)}get tracker(){return this._tracker}useLayouts({[Ct.RESULTS]:t,...e}={}){void 0!==t&&(console.warn(`useLayouts({ ${[Ct.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Ct.PRODUCTS]}: ... }) instead`),e[Ct.PRODUCTS]=t),super.useLayouts(e)}start(){this._sessions.start();const{session:t}=this;return this._hub.update("request",{...this._apiParams,session:t}),this}startTracker(){return this.useApi(!1),this.useLayouts({[Ct.PRODUCTS]:!1}),this._sessions.start(),this.notifyViewUpdate(Ct.PRODUCTS),this}notifyViewUpdate(t=Ct.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}useTracker(t){return this._tracker.config(t),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:r({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(){this._context._members.delete(this.id),this._tracker._destroy(),super._destroy()}}class ks{constructor(t,e){this._plugin=t,this._client=e,this._members=new Map}workflows(){return[...this._members.values()]}create(t=xt){if(this._members.has(t))throw Error("Unit already exists: "+t);return new Es(this,t)}has(t=xt){return this._members.has(t)}get(t=xt){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new Es(this,t)}}class Rs extends j{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Ss,xs,Cs;async function Os(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Ss||(Ss=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return xs=xs||e.any(),Cs=Cs||await xs,Cs.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Cs}const Is="logo",As="auto",Ns=Object.freeze([Is]);function Ts(t){if(!t)return As;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Us extends HTMLElement{static get observedAttributes(){return Ns}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Ts(this.getAttribute(Is))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case As:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Is,e):this.removeAttribute(Is)}async connectedCallback(){const t=this._client=await Os(Us);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Is)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Ts(t)!==Ts(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const $s="parent-question-id",Ps=Object.freeze([...Us.observedAttributes,$s]);const qs="unit-id",Ls=Object.freeze([...Us.observedAttributes,qs]);var js=Object.freeze({__proto__:null,MisoAskElement:class extends Us{static get tagName(){return"miso-ask"}static get observedAttributes(){return Ps}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute($s)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute($s,t):this.removeAttribute($s))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===$s)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Us{static get observedAttributes(){return Us.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoSearchElement:class extends Us{static get observedAttributes(){return Us.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Us{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Ls}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(qs)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(qs,t):this.removeAttribute(qs)}attributeChangedCallback(t,e,s){if(t===qs)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const Ds="role",Ms=Object.freeze([Ds]);class zs extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Ms}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Ds);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ds}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Ds}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Ds&&this._container&&this._container._updateComponentRole(this,e,s)}}var Bs=Object.freeze({__proto__:null,MisoBannerElement:ge,containers:js,roles:Object.freeze({__proto__:null,MisoComponentElement:zs,MisoQueryElement:class extends zs{constructor(){super({role:Ct.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends zs{constructor(){super({role:Ct.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends zs{constructor(){super({role:Ct.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends zs{constructor(){super({role:Ct.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends zs{constructor(){super({role:Ct.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends zs{constructor(){super({role:Ct.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends zs{constructor(){super({role:Ct.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends zs{constructor(){super({role:Ct.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends zs{constructor(){super({role:Ct.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends zs{constructor(){super({role:Ct.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoErrorElement:class extends zs{constructor(){super({role:Ct.ERROR})}static get tagName(){return"miso-error"}}})});class Qs{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Gs{constructor(t,e){this._plugin=t,this._client=e,a(this,{sources:{api:ae(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new bs(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get explore(){return this._explore||(this._explore=new fs(this._plugin,this._client))}}function Vs(t){const e=new Date;return new Date(e.getFullYear()-t,e.getMonth(),e.getDate()).toISOString().substring(0,10)}function Fs({site:t,version:e,config:s}){const{aff_type:i}=s;return{source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",aff_type:i,site:t.key,uuid:w()}}let Ws;async function Hs(){return Ws||(Ws=async function(){return async function(t,{interval:e=300,timeout:s}={}){const i=t();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),i(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}function Ks({site:t,config:e,version:s}){Object.defineProperty(_t,"name",{value:"smart-answers"});return("dev"===s||s.indexOf("beta")>0||e.debug)&&_t.plugins.use("std:debug",{console:{background:"#9033bb"}}),e.test_product?(_t.plugins.use("std:dry-run"),_t.debug&&_t.debug("[Answers] Test product: "+e.test_product)):!e.dry_run&&function(t){return window.location.hostname===t.hostname}(t)||_t.plugins.use("std:dry-run"),window.MisoClientSA=_t,_t}async function Ys({MisoClient:t,config:e}){const s={readConfigFromScriptUrl:!0};"staging"===e.api_host&&(s.apiHost="https://ask-api.askmiso-staging.com/v1");const i=window.misoSA=new t(s);return i.context.anonymous_id=await async function(){return(await Hs()).get("clientId")}(),i}_t.plugins.register(class extends L{static get id(){return"std:ui"}constructor({loadStyles:t=!0}={}){super("ui"),this.layouts=new Rs(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={};o(s,this,["layouts"]),a(this,{MisoClient:t}),a(t,{ui:s});const i=Object.values(is).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,...c}=Bs,u=[...Object.values(n),...Object.values(r),...Object.values(c)];Us.MisoClient=t;for(const e of u)e.MisoClient=t;for(const t of u)g(t)}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}_injectClient(t){a(t,{ui:new Gs(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Qs(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new ks(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new _s(this,t)),e}});const Zs=new Map,Xs=new Map;function Js(t){return t.startsWith("product_")?t.slice(8):t}async function ti(t){return si(Zs,t,ni)}async function ei(t){return si(Zs,t,ri)}async function si(t,e,s,...i){const n=e.filter((e=>!t.has(e)));if(n.length>0){const e=await s(n,...i);for(const s of n)t.set(s,e[s])}return e.reduce(((e,s)=>(e[s]=t.get(s),e)),{})}const ii="111111";async function ni(t){return await ai("products-view",t,{product_block:"price-comparison",article_id:ii})}async function ri(t){const e=await ai("products-view",t,{article_id:ii});for(const t in e)e[t]=hi(e[t]);return e}async function oi(t){const e=await async function(t,e,{fields:s}={}){if(0===e.length)return[];let i=`https://b2c-contenthub.com/wp-json/wp/v2/${t}?include=${e.join(",")}&per_page=100`;s&&(i+="&_fields="+s.join(","));const n=await window.fetch(i);return await n.json()}("product",t,{fields:["id","title"]});return function(t,e){const s={};for(const i of t)s[i[e]]=i;return s}(e,"id")}async function ai(t,e,s={}){if(0===e.length)return[];let i=`/wp-json/idg/v2/${t}?include=${e.join(",")}&per_page=100&_embed=1`;for(const[t,e]of Object.entries(s))i+=`&${encodeURIComponent(t)}=${encodeURIComponent(e)}`;const n=await window.fetch(i);return await n.json()}const ci='data-vars-outbound-link="',ui='data-vars-outbound-link="',li='data-miso-attribution="miso-smart-answers" data-miso-product-type="product" ';function hi(t,e){return!!function({html:t}){return t.indexOf(ci)>=0}(t)&&(t=function(t){try{const{html:e}=t,s=e.indexOf(ui);if(0>s)throw Error(`Cannot find '${ui}' in product view HTML.`);t.html=e.substring(0,s)+li+e.substring(s)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t))}class di{constructor(t,e){this._workflow=t,this._context=Object.freeze({...e}),this._element=void 0,this._session=void 0,this._products=[],this._html=void 0,this._syncIndex=0,this._clicked=!1,t.on("data",(t=>this.updateData(t)))}async updateData({session:t,value:e}={}){if(!t)return;if(this._products.length>0&&this._session&&this._session.uuid===t.uuid)return;const s=this._getProducts(e);var i,n;(n=s,0===(i=this._products).length&&0===n.length||(i[0]&&i[0].product_id)===(n[0]&&n[0].product_id))||(this._session=t,this._products=s,this._sendInteraction("custom",{custom_action_name:"affiliation_response"}),this._syncView())}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=`.miso-smart-answers ${t?`miso-ask[parent-question-id="${CSS.escape(t)}"]`:"miso-ask:not([parent-question-id])"} miso-affiliation`;if(this._element=document.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProducts(t){const{test_product:e}=this._context.config;if(e)return[{product_id:"product_"+e}];const{affiliation_products:s=[]}=t||{};return s||[]}async _syncView(){const t=this._syncIndex++;if(this._selected=await async function(t,e){const{debug:s}=e;if(0===t.length)return void s("[Affiliation] No affiliated products.");const[i,n]=await Promise.all([_i(t,e),pi(t)]),r=[];for(const{product_id:e}of t){const t=i[e],s=n[e];if(t&&s){const i=Js(e);r.push({product_id:e,id:i,title:s,block:t})}}if(r.length>0)return Object.freeze(r[0]);return void s("[Affiliation] No non-empty views for affiliated products: "+t.map((({product_id:t})=>Js(t))).join(", "))}(this._products,this._context),this._syncIndex!==t+1)return;this._selected||this._sendInteraction("custom",{custom_action_name:"product_view_empty_response"});this._html=this._selected?function({title:t,block:e},s={}){return`\n<div class="affiliation">\n  ${s.title?function(t){return`<h4 class="title">Best Prices Today: ${t}</h4>`}(t):""}\n  ${e}\n</div>\n`}(this._selected,{title:"product"!==this._context.config.aff_type}):"",this._requestRender(t)}async _requestRender(t){this._render(),this._selected&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._context.MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;const e=function(t,e,{root:s}){if("string"==typeof e){const t=e;e=e=>e.matches(t)?e:void 0}for(let i=t;i&&i!==s;i=i.parentElement){const t=e(i);if(t)return t}}(t,"a[href]",{root:this.element});e&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){const{client:s}=this._context,{questionId:i,parentQuestionId:n,rootQuestionId:o}=this._workflow,a=this._selected?[this._selected.product_id]:void 0,c=this._products.map((({product_id:t})=>t));s.api.interactions.upload(r({type:t,...e,product_ids:a,context:{custom_context:r({...Fs(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:o,parent_question_id:n,question_id:i,candidate_product_ids:c})}}))}}async function _i(t,{config:e}){const s=t.map((({product_id:t})=>Js(t))),i=await("product"===e.aff_type?ei:ti)(s),n={};for(const{product_id:e}of t){const t=i[Js(e)];n[e]=t&&t.html&&t.html.trim()||""}return n}async function pi(t){const e={},s=[];for(const{product_id:i,title:n}of t)n?e[i]=n:s.push(i);if(s.length>0){const t=await async function(t){return si(Xs,t,oi)}(s.map(Js));for(const i of s)e[i]=t[Js(i)].title}return e}const mi="miso-smart-answers";let fi,gi,yi,bi;function wi(t,e){const{site:s}=e;t.useApi("questions",{_meta:{site:s.key},yearly_decay:.93,fq:`created_at:[${Vs(2)} TO *] AND type:story AND -custom_attributes.content_type:(DealPost BrandPost SponsoredContent) AND (custom_attributes.languages:English OR NOT _exists_:custom_attributes.languages)`}),t._affiliation=new di(t,e),Ri(ki(t,"query-suggestions-container"),t.states.suggestions),t.on("data",(({value:e})=>{const{sources:s,related_resources:i}=e||{};bi.workflow===t&&Ri(yi,i),Ri(ki(t,"sources-container"),s)})),t.useDataProcessor(vi),t.useInteractions({preprocess:t=>({...t,context:{...t.context,custom_context:{...Fs(e),...t.context&&t.context.custom_context}}})}),t.on("done",(()=>{gi.insertAdjacentHTML("beforeend",function({parentQuestionId:t}){return`\n<div class="session">\n  <miso-ask class="query-suggestions-container" visible-when="initial" parent-question-id="${t}">\n    <div class="phrase query-suggestions">Related questions you can explore</div>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="query-container" visible-when="initial loading" parent-question-id="${t}">\n    <miso-query>\n      <input class="input" data-role="input" placeholder="Ask a follow-up question">\n      <button class="button" data-role="button">\n        <span>Ask</span>\n      </button>\n    </miso-query>\n  </miso-ask>\n  <miso-ask class="error-container" visible-when="erroneous" logo="false" parent-question-id="${t}">\n    <hr>\n    <h2 class="miso-error-header">Oops!</h2>\n    <p class="miso-error-description">\n      We are currently experiencing some difficulties. Would you please trying again later?\n    </p>\n    <miso-error></miso-error>\n  </miso-ask>\n  <miso-ask visible-when="ready" logo="false" class="dingbat" parent-question-id="${t}">\n    <hr>\n    <miso-question></miso-question>\n    <miso-answer></miso-answer>\n    <miso-affiliation></miso-affiliation>\n    <miso-feedback></miso-feedback>\n  </miso-ask>\n  <miso-ask class="sources-container dingbat" visible-when="ready" logo="false" parent-question-id="${t}">\n    <div class="phrase sources">My reply is based on the following</div>\n    <miso-sources></miso-sources>\n  </miso-ask>\n</div>\n`}({parentQuestionId:t.questionId}))})),t.on("loading",(()=>{bi.workflow=t}))}function vi({value:t,...e}){if(!t)return e;const{sources:s=[],related_resources:i=[]}=t;return{value:{...t,sources:s.map(Ei),related_resources:i.map(Ei)},...e}}function Ei({url:t,...e}){const{product_id:s}=e;if(t&&s&&t.indexOf("//b2c-contenthub.com/")>=0){const[e,i]=s.split("_");t=t.replace("//b2c-contenthub.com/",`//www.${i}.com/`)}return{url:t+=(0>t.indexOf("?")?"?":"&")+"utm=smart_answers",...e}}function ki(t,e){const{parentQuestionId:s}=t,i=s?`[parent-question-id="${CSS.escape(s)}"]`:":not([parent-question-id])";return document.querySelector(`.${mi} miso-ask.${e}${i}`)}function Ri(t,e){t&&t.classList[e&&0!==e.length?"remove":"add"]("empty")}const{currentScript:Si}=document;async function xi({MisoClient:t}){await Promise.all([Ci(t),Ii()])}async function Ci(t){await Ai(`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t.version}/dist/css/ui.css`)}let Oi=!1;async function Ii(){if(Oi)return;if(Oi=!0,!Si)throw Error("currentScript not found");const t=Si.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await Ai(s)}async function Ai(t){if(!document.querySelector(`link[href="${t}"]`))return new Promise(((e,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=s,i.href=t,document.head.appendChild(i)}))}const Ni=".layout--right-rail .wp-block-column";(async(t,s)=>{if("/smart-answers"!==window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=e;const i=Ks({site:t,config:s,version:e}),n=i.debug||(()=>{});n("Miso Smart Answers script version: "+e);const r=document.querySelector(Ni);if(!r)return void console.error("Container not found: "+Ni);i.plugins.use("std:ui");const[o]=await Promise.all([Ys({config:s,MisoClient:i}),xi({site:t,MisoClient:i})]);r.innerHTML='\n<div class="miso-smart-answers">\n  <section class="question">\n    <div class="hero">\n      <div class="hero-inner">\n        <h2 class="title">Smart Answers</h2>\n        <h4 class="slogan">Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.</h4>\n      </div>\n    </div>\n    <miso-ask class="query-container">\n      <miso-query>\n        <input class="input" data-role="input">\n        <button class="button" data-role="button">\n          <i><svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg></i>\n          <span>A.I. Search</span>\n        </button>\n        </miso-query>\n    </miso-ask>\n  </section>\n  <section class="answer">\n    <miso-ask class="error-container" visible-when="erroneous" logo="false">\n      <h2 class="miso-error-header">Oops!</h2>\n      <p class="miso-error-description">\n        We are currently experiencing some difficulties. Would you please trying again later?\n      </p>\n      <miso-error></miso-error>\n    </miso-ask>\n    <miso-ask visible-when="ready" logo="false" class="dingbat">\n      <miso-question></miso-question>\n      <miso-answer></miso-answer>\n      <miso-affiliation></miso-affiliation>\n      <miso-feedback></miso-feedback>\n    </miso-ask>\n    <miso-ask class="sources-container dingbat" visible-when="ready" logo="false">\n      <div class="phrase sources">My reply is based on the following</div>\n      <miso-sources></miso-sources>\n    </miso-ask>\n  </section>\n  <section id="follow-ups" class="follow-ups">\n  </section>\n  <section id="related-resources" class="related-resources empty">\n    <miso-ask visible-when="ready" logo="false">\n      <div class="phrase related-resources">Go beyond, and learn more about this topic</div>\n      <miso-related-resources></miso-related-resources>\n    </miso-ask>\n  </section>\n</div>\n',function(t){const{config:e,client:s}=t;fi=document.querySelector(`.${mi} miso-ask miso-query input`),gi=document.querySelector(`.${mi} #follow-ups`),yi=document.querySelector(`.${mi} #related-resources`),bi=document.querySelector(`.${mi} #related-resources miso-ask`);const i=s.ui.ask;wi(i,t),s.ui.asks.on("create",(e=>wi(e,t))),i.on("loading",(()=>{gi.innerHTML="";for(const t of s.ui.asks.workflows)t!==i&&t.destroy()}));const{q:n}=e;n?(fi.value=n,i.query({q:n})):fi.focus()}({site:t,config:s,client:o,MisoClient:i,debug:n,version:e})})({key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",ref_story:"2013610"},t)}();
