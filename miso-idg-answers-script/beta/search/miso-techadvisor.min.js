!function(){"use strict";const e="home",t="answers",s="search",i="article",n="other",r=["cover_image","custom_attributes.contenthub_url","custom_attributes.site","created_at","product_id","published_at","snippet","title","updated_at","url"];var o="1.0.15-beta.1";var a=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,i]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===i||i);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const c={key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},u=window.location.hostname!==c.hostname;var l={...c,dev:u};function h(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const _=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),d=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var p=Object.freeze({__proto__:null,GROUP:_,NAME:d});function m(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function f(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function g(e){return null!=e?""+e:e}function y(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function b(e){return null==e}function w(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function v(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function E(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function S(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function k(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class O{constructor(e,{duration:t=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);x(s),x(i),x(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==i?i:t})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>I(this,e)),t):I(this,e),this._value=e}disconnect(){this._active=!1}}function I(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function x(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function T(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function C(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function A(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async i=>{try{await e(i),t()}catch(e){s(e)}}))}))}async function R(e,{area:t=.5,duration:s=1e3,signal:i}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((n,r)=>{const o=new O((e=>{e&&(o.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((e=>{o.value=e[0].isIntersecting}),{threshold:t});a.observe(e),i&&i.addEventListener&&i.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function N(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function $(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function P(e,t){const s=L((()=>window.localStorage.getItem(e))),i=L((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,i=t.indexOf(s);if(0>i)return;const n=i+s.length,r=t.indexOf(";",n);return decodeURIComponent(0>r?t.substring(n):t.substring(n,r))}(e))),n=s||i||""+t();return n&&!s&&L((()=>window.localStorage.setItem(e,n))),n&&!i&&L((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,n))),n}function L(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function U(e){return new q(e)}class q{constructor(e){this._value=e;const t=e=>{this._value=e};v(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class j{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class D{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new j),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var M="1.11.4";let z;try{z=document.currentScript}catch(e){}async function F(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let i;e.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{e.sheet&&(i&&clearInterval(i),t())}),100)}))}(e),await async function(e){if(Q(e))return;return new Promise((t=>{let s;s=setInterval((()=>{Q(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function B(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${M}/dist/css/${e}.css`}function Q(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function G(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function H(e,{depth:t=5,...s}={}){return W(e,t)}function W(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>W(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const i={};if(0>=t)return i;for(const s in e){const n=e[s];"function"!=typeof n&&(s.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(i[s]=W(n,t-1)))}return i}(e,t):e:"(...)"}function K(e,t){const s=Object.getOwnPropertyDescriptors(t),i=Object.getOwnPropertyDescriptors(e);for(const[t,n]of Object.entries(s))"constructor"!==t&&void 0===i[t]&&Object.defineProperty(e,t,n)}function V(e){const t={},s=new Set;for(let i=e;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=n[i];r&&(t[i]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}const Y=100,Z=4;function J(e){const t=function({speed:e=Y,acceleration:t=Z}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,i)=>{let n=e*(Math.random()+.5);return t>0&&void 0!==i&&s>i&&(n*=1+(s-i)*t/1e3),n}}(e);return(e,s,i,n)=>{const r=t(i,s);return e+Math.max(n-i,0)*r/1e3}}const X=Symbol.for("miso:resources");class ee{constructor(){this._resources=new Map;const e=window[X]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){te(this._resources,e).resolve(t)}async get(e){return te(this._resources,e).promise}}function te(e,t){if(e.has(t))return e.get(t);const s=new j;return e.set(t,s),s}function se(){return window[X]||(window[X]=new ee)}class ie{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new j;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class ne{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},i=this._namedCallbacks[e];if(i)for(const e of i)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,i)=>{const n=t._on(e,(e=>{setTimeout((()=>n()));try{s(e)}catch(e){i(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:i})=>{try{e(s,i)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)m(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&m(s,t)}}_injectSubscribeInterface(e){w(e,this,["on","once"])}}function re(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class oe{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:re(e,t),uuid:$()})}(e,t);v(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new ne({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(oe,"miso:component");class ae extends oe{constructor(e,t,{libName:s,keyName:i}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=e=>e[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new j);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class ce{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new O(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class ue{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:le}=document,he=le.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function _e({}){await Promise.all([pe()])}let de=!1;async function pe(){if(de)return;if(de=!0,!le)throw Error("currentScript not found");const e=le.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=t,i.onerror=s,i.href=e,document.head.appendChild(i)}))}(s)}function me(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${he}/${e}`}const fe=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",logo_image:"image/macworld.jpg",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",logo_image:"image/techhive.jpeg",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",logo_image:"image/pcwelt.jpg",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",logo_image:"image/macwelt.jpg",regions:[],ref_story:"2383200"}].map((({logo_image:e,...t})=>({logo_image:me(e),...t}))),ge=fe.reduce(((e,t)=>(e[t.key]=t,e)),{});function ye(e){return ge[e]}async function be(e,{interval:t=300,timeout:s}={}){const i=e();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const t=e();null!=t&&(a(),i(t))}),t),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}var we=Object.freeze(function(){const r=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(r){case"":return{type:e};case"/smart-answers":return{type:t};case"/search":return{type:s};default:if(l.regions.indexOf(r.substring(1))>=0)return{type:e}}const a=r.substring(1).split("/");if("article"===a[0]){const e=""+a[1];return{type:i,postId:e,product_id:`article_${l.key}_${e}`}}return{type:n}}());const ve="%cMiso",Ee="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Se=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var ke=function(){if(a.sponsor)return Se.find((e=>e.key===a.sponsor))||void 0}(),Oe=Object.freeze({__proto__:null,config:a,version:o,site:l,page:we,sponsor:ke,debug:function(...e){(a.debug||o.indexOf("beta")>=0||"dev"===o)&&function(...e){console.log(ve,Ee,...e)}(...e)}}),Ie="1.11.4";const xe=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Te{constructor(e,t){this._client=e,this._root=t,this._bulk=new ie(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,u=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(e,y({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:i}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:n,status_code:r,body:o}=i[t];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:i={}}=this._client.options,n=t.sendApiKeyByHeader||i.sendApiKeyByHeader,r=e.filter((e=>e)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=xe.DATA_ENDPOINT,eventEndpoint:s=xe.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:t,apiName:s,url:i})||i}catch(t){(e._error||console.error)(t)}return i}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:t,apiName:s,payload:i})||i}catch(t){(e._error||console.error)(t)}return i}}class Ce extends oe{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(e,t,i):this.helpers.fetch(s,i,r)}_postprocess({response:e}){return e.data}}const{GROUP:Ae,NAME:Re}=p;class Ne extends Ce{constructor(e){super(e,Ae.INTERACTIONS)}async upload(e,t){try{return await this._run(Re.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Re.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:i}=s;return this.helpers.sendBeacon(e,i,t),{}}return super._send({...s,options:t})}}class $e{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...i}=this._options;const n=new ue(s);let r;t=h(this._ac.signal,n.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new D;return o=setInterval((async()=>{let t,o,_;try{if([t,o,_]=await e(r?{signal:r}:{}),u||!b(a)&&a>=_)return;b(_)||(a=_),n&&n(t,o,_),c=0}catch(e){return i&&i(e),c++,void(c>s&&(l(),h.error(e)))}h.update(t,o),o&&l()}),t),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?n.clear():this._isUpdated(r,e)&&n.touch(),r=e},...i})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class Pe extends $e{constructor(e,t,s,i){super(i),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:Le,NAME:Ue}=p;class qe extends Ce{constructor(e){super(e,Le.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new je(this,e,t);const s=await this._run(Ue.QUESTIONS,e,t);return new je(this,s,t)}async _questions(e,t){return this._run(Ue.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${Ue.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(Ue.RELATED_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(Ue.SEARCH,e,t);return s.question_id?new De(this,s,t):s}async _searchGet(e,t){return this._run(`${Ue.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(Ue.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(Ue.SEARCH_AUTOCOMPLETE,e,t)}}class je extends Pe{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class De extends Pe{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),v(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:Me,NAME:ze}=p;class Fe extends Ce{constructor(e){super(e,Me.SEARCH)}async search(e,t){return this._run(ze.SEARCH,e,t)}async autocomplete(e,t){return this._run(ze.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(ze.MGET,e,t)}}const{GROUP:Be,NAME:Qe}=p;class Ge extends Ce{constructor(e){super(e,Be.RECOMMENDATION)}async userToProducts(e,t){return this._run(Qe.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(Qe.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(Qe.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(Qe.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(Qe.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(Qe.PRODUCT_TO_PRODUCTS,e,t)}}class He extends oe{constructor(e,t){super("api",e),this._client=e,this.helpers=new Te(e,t),this.interactions=new Ne(this),this.ask=new qe(this),this.search=new Fe(this),this.recommendation=new Ge(this)}}var We=Object.freeze({__proto__:null,Api:He,ApiBase:Ce,ApiHelpers:Te,Interactions:Ne,Ask:qe,Search:Fe,Recommendation:Ge});class Ke extends oe{constructor(e){super("context",e),this._client=e}}var Ve={api:We,context:{Context:Ke}};class Ye{constructor(e){v(this,{install:e})}}class Ze extends ae{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Je(this,Ve),this.plugins=new Xe(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new j);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const i=new s;return v(i,{id:e}),this._tryConfig(i,t),i;case"function":return new Ye(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(e,t,s){const i=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),n=0>t?e.length:t,r=e.lastIndexOf("/",n)+1,o=e.indexOf(".",r),a=0>o?"":e.slice(o,n);return`${e.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${i}.min.js`}(e,t,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new se).get(s);!this.isRegistered(e)&&this.register(i)}}class Je{constructor(e,t){w(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),v(this,{classes:t})}}class Xe{constructor(e){w(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const et=new class extends oe{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Ze(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=Ie,this._cmdRes=new j}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var tt=Object.freeze({__proto__:null,viewable:R,debounce:G});const{currentScript:st}=document;class it extends oe{static attach(){(window.MisoClients||(window.MisoClients=[])).push(it),window.MisoClient?window.MisoClient!==it&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=it}static debug(){}constructor(e){super("client",et),this._config(e),this.context=new Ke(this),this.api=new He(this,et),function(e){et._clients.push(e),et._events.emit("create",e)}(this)}get version(){return it.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,y(e)}_readConfigFromScriptUrl(){return y({apiKey:new URL(new Request(st.src||st.href).url).searchParams.get("api_key")||void 0})}}it.helpers=tt,v(it,{uuid:$()});var nt=function(e){const t=et._pluginRoot;return et.MisoClient=t.MisoClient=e,w(e,et,["version","instances","any","meta","on","once","cmdDone"]),w(e,t,["plugins"]),e}(it);const{GROUP:rt,NAME:ot}=p;let at;class ct{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||at||(at=P("miso_anonymous_id",$))}set anonymous_id(e){e=g(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=g(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function ut(){const e=new URLSearchParams(window.location.search);let t=y({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class lt{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],i=e[t];i!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function ht(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:Ie};return s.uuid||(s.uuid=$()),{...e,context:{...t,custom_context:s}}}const _t="std:native-fetch";let dt,pt;const mt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return dt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),dt="borrowed",e.contentWindow.fetch}catch(e){pt=e}})();const ft="miso-logdump",gt="miso-logdump",yt=gt+"__download-btn",bt="Miso Log";class wt{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return kt||(kt=F(B("logdump")))}();let e=document.getElementById(ft);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||bt,t.classList.add(yt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=ft,e.classList.add(gt),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(ft),t=e&&e.querySelector("."+yt);t&&(t.textContent=this._options.logDownloadButtonText||bt)}hideDownloadButton(){const e=document.getElementById(ft);e&&(e.style.display="none")}download(){const e=new Blob([Et(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:vt()})}return e&&"string"==typeof e?e:`miso-log.${vt()}.jsonl`}clear(){this._logs=[]}}function vt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Et(e){return e.map((e=>JSON.stringify(H(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),St(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function St(e){return e?H(e,{depth:2}):e}let kt;const Ot="std:debug";function It(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function xt(e,t){return Object.freeze({...e,...t,members:Tt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Tt(e=[],t=[]){return[...new Set([...e,...t])]}function Ct(e,t){let s={};for(const i of e)i&&(s=t(s,i));return y(s)}function At(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Rt(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,i=t.payload,{...s,...i,...Nt("_meta",s,i)})});var s,i}))}function Nt(e,t,s){const i=t&&t[e],n=s&&s[e],r=i?n?{...i,...n}:i:n;return void 0!==r?{[e]:r}:{}}nt.plugins.register(class{constructor(e={}){this._options=e,this._logs=new wt(e)}static get id(){return Ot}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Ot,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,i)=>this._handleEvent(e,i,s,t)))}_handleEvent(e,{name:t},s,i=[]){if("child"===t||"subtree"===t)return;const n=i.concat(e.meta.path);if(n.length||"create"!==t){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(t,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(n[1],n.slice(2),t,s))}this._logw(n.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",e];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=e,n="custom"===t&&s?`${t}:${s}`:t;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,i){this._logw([e,t.join(".")],s,i)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(It)):this._log(e,t,It(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return _t}install(e,t){mt?(t.setCustomFetch(mt),e.debug(`<plugin:${_t}>`,"[info]",`Using ${dt} native fetch`)):e.debug(`<plugin:${_t}>`,"[error]","Failed to obtain native fetch: "+pt.message)}}),nt.plugins.use(class extends oe{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new ct(this);var s,i;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:i}){return t===rt.INTERACTIONS&&s===ot.UPLOAD?this._modifyPayloadForInteractions(e,i):t===rt.ASK&&s===ot.QUESTIONS?this._modifyPayloadForAsk(e,i):this._modifyPayloadForOthers(e,i)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:i,anonymous_id:n}=e.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=e.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:i}=e.context,n=y({anonymous_id:s,user_id:i});return{data:t=t.map((e=>({...n,...e})))}}}),nt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...y({page:y({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:ut()}),...e.context}})))}}}),nt.plugins.use(class extends oe{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new lt(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:i}){if(t===_.SEARCH)if(s===d.SEARCH)this._captureSearchApiRequest(e,i)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),nt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(ht)}}}),nt.plugins.use(class extends oe{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case _.SEARCH:case _.RECOMMENDATION:return!0}return!1}});const $t="data-miso-product-id",Pt="default",Lt="_organic",Ut=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),qt=new Set([Ut.PRODUCTS,Ut.CATEGORIES,Ut.ATTRIBUTES,Ut.RESULTS,Ut.ITEMS,Ut.QUESTION,Ut.ANSWER,Ut.SOURCES,Ut.RELATED_RESOURCES,Ut.QUERY_SUGGESTIONS,Ut.RELATED_QUESTIONS,Ut.AFFILIATION,Ut.FACETS,Ut.TOTAL]);function jt(e){return qt.has(e)}const Dt=new Set([Ut.PRODUCTS,Ut.SOURCES,Ut.RELATED_RESOURCES]);const Mt=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),zt=[Mt.IMPRESSION,Mt.VIEWABLE,Mt.CLICK,Mt.SUBMIT,Mt.FEEDBACK],Ft=[Mt.IMPRESSION,Mt.VIEWABLE,Mt.CLICK],Bt=new Set(Ft);const Qt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Gt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function Ht(e){if(0>zt.indexOf(e))throw Error("Unrecognized event type: "+e)}const Wt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function Kt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function Vt(e){if(void 0===e)return;let[t,s]=f(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function Yt(e,t){return!1===(t=Vt(t))[0]?t:e&&t?[t[0]||e[0],Zt(e[1],t[1])]:t||e}function Zt(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const Jt=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Xt(e={}){e=At(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))es(t);return e}function es(e={}){return e=At(e)}function ts(e={},t={}){const s={...e};for(const[i,n]of Object.entries(t))void 0!==n&&(s[i]=zt.includes(i)?ss(e[i],n):n);return s}function ss(e={},t={}){return{...e,...t}}const is=[{key:Wt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return y({group:s,name:e,payload:t})},merge:Rt},{key:Wt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${Ut.PRODUCTS}: ... }) instead`),e={...s,[Ut.PRODUCTS]:t});const i={};for(const[t,s]of Object.entries(e))i[Kt(t)]=Vt(s);return i},merge:function(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>{for(const[s,i]of Object.entries(t))e[s]=Yt(e[s],i);return e}))}},{key:Wt.DATA_PROCESSOR,normalize:function(e){e=f(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:Wt.TRACKERS,normalize:function(e={}){e=At(e);const{active:t,...s}=e,i={};for(const[e,t]of Object.entries(s))i[e]=Xt(t);return{active:t,...i}},merge:function(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>{for(const[s,i]of Object.entries(t))void 0!==i&&(e[s]="active"===s?i:ts(e[s],i));return e}))}},{key:Wt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=f(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,i=t.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:Wt.FILTERS,normalize:At,merge:function(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>Object.assign(e,t)))}},{key:Wt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&Ct(e,((e,t)=>Object.assign(e,t)))}}];class ns{constructor(){this._events=new ne({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class rs{constructor(e={},t={}){this._events=new ne({target:this}),this._defaults=t,this._context=e||{},this._locals={},v(this,{resolved:new os(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class os{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,i=s._context[e];this._cache[e]=t(s._defaults[e],i&&i.get(),s._locals[e])}return this._cache[e]}}class as{constructor(e,t,s,i,n){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?i(e):void 0,this._merge=n}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of is){const{key:t,normalize:s,merge:i}=e;Object.defineProperty(ns.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new as(this,this._globals,t,s,i))}}),Object.defineProperty(rs.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new as(this,this._locals,t,s,i))}}),Object.defineProperty(os.prototype,t,{get:function(){return this._get(e)}})}const cs=[Wt.API,Wt.LAYOUTS,Wt.DATA_PROCESSOR,Wt.TRACKERS,Wt.INTERACTIONS];function us(e,t=cs){for(const s of t)ls(e,s)}function ls(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+i](e){return this._options[t].merge(e),this},["clear"+i](){return this._options[t].set(),this}})}var s}class hs extends oe{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new ns}}function _s(e){return e?"view:"+e:"view"}us(hs.prototype);class ds{constructor(){(this._events=new ne)._injectSubscribeInterface(this),this._states={},v(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,{silent:s=!1}={}){this._states[e]=Object.freeze(t),s||this._events.emit(e,t)}trigger(e,t){this._events.emit(e,t)}}class ps{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:$(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function ms(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class fs{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this.active&&(this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e}))}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...i}=e;this._emitResponse({session:t,request:i});try{const{signal:s}=this._ac||{},n={...e.options,signal:s},r=await this._source({session:t,...e,options:n});if(r&&r[Symbol.asyncIterator]){let e;for await(e of(r._response&&this._emitResponseWithSessionCheck({session:t,request:i,value:r._response}),r)){if(!ms(this._hub,t))break;this._emitResponse({session:t,request:i,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:i,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:i,error:e})}}_emitResponseWithSessionCheck(e){ms(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class gs{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{m(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:ys,VIEWABLE:bs,CLICK:ws}=Mt,{UNTRACKED:vs,TRIGGERED:Es}=Qt,Ss=Object.freeze({[ys]:vs,[bs]:vs,[ws]:vs});class ks{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Ss}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||vs}set(e,t,s){Ht(t),function(e){if(e!==Qt.UNTRACKED&&e!==Qt.TRACKING&&e!==Qt.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const i of f(e))this._setOne(i,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Es))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const i=s(t);return e.set(t,i),i}(this._states,this._getKey(e),(()=>({...Ss}))))[t]=s}}const Os=[Symbol("itemless")];class Is{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new ks(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){Ht(e);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:n=!0,itemless:r=!1}=i;if(n){if(r&&(t=Os),0===(t=this._states.untriggered(f(t),e)).length)return;this._states.set(t,e,Qt.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:Mt.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(y({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new ks(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[_s(this._role)]}}for(const e of Ft)Is.prototype[e]=function(t,s){this._trigger(e,t,s)};class xs{constructor(e,t){this._events=new ne({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),v(this,{role:t,interface:new Ts(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new gs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===Ut.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Is({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((n=t)===(r=i)||n&&r&&n.status===r.status&&n.error===r.error&&n.value===r.value&&n.ongoing===r.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(n.session,r.session)))return;var n,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=t,_={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...Cs(t)},d=(e={},t)=>{!1!==e&&this.updateState({..._,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:d})}catch(e){this._error(e),d({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?Gt.ERRONEOUS:e.status;e=this._state=Object.freeze(y({...e,status:s}));const{role:i}=this;this.hub.update(_s(i),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:i,meta:n,...r}=e,o={value:this._mapping(e,this),status:i,data:t,meta:n,...r};return this.role===Ut.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(t)}),y(o)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!jt(s))return!1;let t=e&&e[s];if(s===Ut.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ts{constructor(e){w(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Cs(e){return function(e){return e.status===Gt.READY&&!e.ongoing}(e)?{empty:!!As(e)}:{}}function As(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function Rs(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class Ns{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new ne({target:this,error:s}),v(this,{facets:new $s(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return y({facets:Object.freeze({}),sort:Rs(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(y({...e,...t,facets:Object.freeze(y({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset(){const e=this.states;this._states=void 0;const t=this._getStates();this._events.emit("reset",{states:t,oldStates:e})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class $s{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const Ps=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function Ls(e,t){return!!t&&{...e,...t}}class Us{constructor(e,{workflow:t,extensions:s,layouts:i,roles:n,options:r}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=i,this._options=r,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new Ns(this);for(const e of n.members)e!==Ut.CONTAINER&&(this._views[e]=new xs(this,e));v(this,{interface:new qs(this),trackers:new js(this,n.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),e.on("data",(e=>this.refresh({data:e}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new xs(this,Ut.CONTAINER);t.layout=this._createLayout(Ut.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,i]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName});if(t===Ut.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,i]=t;return this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:i}=t._inst;e&&(s=s.filter((t=>t.role===Ut.CONTAINER||e.includes(t.role)))),i&&(s=s.filter((e=>!i.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:i={},...n}=e;return y({...Ps,...n,impression:Ls(Ps.impression,t),viewable:Ls(Ps.viewable,s),click:Ls(Ps.click,i)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=Ut.CONTAINER;this._containerTracker=new Is({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class qs{constructor(e){this._actor=e,w(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class js{constructor(e,t){this._views=e;for(const s of t)s!==Ut.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,Ut.CONTAINER,{get:()=>e._getContainerTracker()})}}class Ds{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:Mt.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ms{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=f(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function zs(e){return async({group:t,name:s,payload:i,options:n})=>{if(t===_.ASK)switch(s){case d.QUESTIONS:return e.api.ask.questions(i,n);case d.SEARCH:return e.api.ask.search(i,n)}return e.api[t]._run(s,i,n)}}class Fs{constructor({role:e,workflow:t,...s}={}){v(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const i=this._rendered.get(e),n=U(!1);t=this._preprocess({state:t,rendered:i},{skip:n.t})||t,this._updatePending(t,s),n.value||this._handleInput({state:t,rendered:i},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,A((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const n=this._rendered.get(this._element),r=U([]),o=U({});this._render(this._element,{state:s,rendered:n,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Bs(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function Qs(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ws)(e,t,s)+(n.descriptionBlock||Vs)(e,t,s)+(n.priceBlock||Zs)(e,t,s)+(n.ctaBlock||ti)(e,t,s)}</div>`}function Gs(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ws)(e,t,s)+(n.descriptionBlock||Vs)(e,t,s)+(n.priceBlock||Zs)(e,t,s)}</div>`}function Hs(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ws)(e,t,s)+(n.dateBlock||Ys)(e,t,s)+(n.descriptionBlock||Vs)(e,t,s)+(n.ctaBlock||ti)(e,t,s)}</div>`}function Ws({className:e},{title:t}){return t?`<div class="${e}__item-title">${N(t)}</div>`:""}function Ks({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function Vs({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${N(s)}</div>`:""}function Ys({className:e,templates:t},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${e}__item-date">${ri(r,t.date)}</div>`:""}function Zs(e,t){const{className:s,templates:i}=e,{sale_price:n,original_price:r,currency:o="USD"}=t,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,u=t.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Js)(e,{...t,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Js(e,{discount_rate_percent:t}){return`(${t}% off)`}function Xs(e,t,s={}){const{className:i,templates:n}=e,{cover_image:r}=t;if(!r)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${r}">`}${s.brand?(n.brandBlock||Ks)(e,t,s):""}</div>`}function ei({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function ti(e,t,s){const{className:i,templates:n}=e,r=oi.asFunction(n.cta)(e,t,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function si({className:e,options:t={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const{link:a={}}=t,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&i?"a":"div";return[`<${l} class="${e}__${n}" ${r?`data-role="${r}"`:""} ${s?`${$t}="${s}"`:""} ${!1!==o.link&&i?`href="${i}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const ii=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),ni="en-US";function ri(e,t=ii){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||ii.locale,t);default:throw Error("Invalid date format: "+t)}}const oi=Object.freeze({tagPair:si,formatDate:ri,formatNumber:function(e,t=ni){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||ni.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:N,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class ai extends Fs{constructor({className:e,templates:t,...s}={}){super(s),v(this,{className:e,templates:{...Bs("root"),...t,helpers:oi}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class ci extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){ci.MisoClient.ui.layouts.create("banner").render(this)}}class ui{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(e,{ac:s});let n=!1;try{await R(e,{...t,signal:i}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return n}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class li extends Fs{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new ui}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=ci.tagName,s=this._shallRenderBanner(e),i=e.querySelector(t);s&&!i?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&i&&i.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,i=void 0!==s&&"auto"!==s?s:t;return"auto"===i?e.components.some((({role:e})=>function(e){return e===Ut.PRODUCTS||e===Ut.ANSWER}(e))):!!i}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1}={}}=t,o=[s,r?Gt.EMPTY:Gt.NONEMPTY];s===Gt.READY&&o.push(i?Gt.ONGOING:Gt.DONE),e.setAttribute("status",o.join(" ")),n?e.setAttribute("miso-id",n):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===Gt.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const hi=Object.freeze({root:function(e,t){const{className:s,templates:i}=e,{status:n,value:r}=t;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class _i extends ai{static get type(){return"error"}static get defaultTemplates(){return hi}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...hi,...t},...s})}}const di=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function pi(e,t){const s=[];for(const i of t.entries){const t=e.e2b.get(i.element);t&&t.key===i.key||s.push(i)}return s}class mi{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const i=function(e,t,s){const i=new Map,n=new Map,r=[];for(let o=0;e.length>o;o++){const a=e[o],c=s[o],u=Object.freeze({index:o,key:a,value:t[o],element:c});i.set(a,u),n.set(c,u),r.push(u)}return{k2b:i,e2b:n,entries:r}}(e,t,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=pi(n,i),o=pi(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function fi(e){K(e,gi.prototype)}class gi{_initTrackable(){this._bindings=new mi,this._viewables=new ui}_syncBindings(e,t){const s=this._getItems(t)||[],i=s.map((e=>this._getItemKey(e))),n=this._getItemElements(e),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:i}of e)(async()=>{await this._viewables.track(i,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||0===t.button&&!t.defaultPrevented&&!!T(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&this._view.tracker.click([t.value])}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class yi{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===Gt.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let i=!1;try{await R(t,{area:1,duration:0,signal:s.signal}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const bi=Object.freeze({product:function(e,t,s,i){const{templates:n}=e,[r,o]=si(e,s);return""+r+(n.imageBlock||Xs)(e,s,i)+(n.infoBlock||n.productInfoBlock||Gs)(e,s,i)+o},article:function(e,t,s,i){const{templates:n}=e,[r,o]=si(e,s);return""+r+(n.imageBlock||Xs)(e,s,i)+(n.infoBlock||n.articleInfoBlock||Hs)(e,s,i)+(n.indexBlock||ei)(e,s,i)+o},question:function(e,t,s){const[i,n]=si(e,s);return`${i}${s.value||s.text||s}${n}`},root:function(e,t){const{className:s,role:i,templates:n}=e,{status:r}=t;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===Gt.READY?n[r](e,t):""}${n.trigger(e,t)}${n.loading(e,t)}</div>`},[Gt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t);return i&&i.length>0||t.ongoing?s.list(e,t,i):s.empty(e,t)},empty:()=>"",list:function(e,t,s){const{className:i,templates:n,options:r}=e,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list" data-item-type="${r.itemType}">${n.items(e,t,s)}</${o}>`},ordered:!1,items:function(e,t,s,{offset:i=0}={}){const{templates:n}=e;let r=i;return s.map((s=>n.item(e,t,s,r++))).join("")},item:function(e,t,s,i){const{className:n,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${n}__item">${r[a](e,t,s,{index:i})}</li>`},productInfoBlock:Gs,articleInfoBlock:Hs,brandBlock:Ks,titleBlock:Ws,descriptionBlock:Vs,dateBlock:Ys,priceBlock:Zs,discountRateText:Js,ctaBlock:ti,cta:function(e,t,s){const{templates:i}=e,{url:n}=t;if(!n)return"";const[r,o]=si(e,{url:n},{classSuffix:"item-cta",role:"cta"}),a=oi.asFunction(i.ctaText)(e,t,s);return a?`${r}${a}${o}`:""},imageBlock:Xs,indexBlock:ei,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class wi extends ai{static get defaultTemplates(){return bi}constructor({templates:e,itemType:t="product",...s}){super({templates:{...bi,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=this._html(e,t,s);return{...e,incremental:s,html:i}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:i,html:n}=t;if(i)if(n){this._getListElement(e).insertAdjacentHTML("beforeend",n)}else s(!1);else e.innerHTML=n}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:i,element:n}=t;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}fi(wi.prototype),K(wi.prototype,yi.prototype);const vi="miso-list";class Ei extends wi{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return vi}constructor({className:e=vi,...t}={}){super({className:e,...t})}}const Si="miso-cards";const ki="miso-carousel",Oi=Object.freeze({ready:function(e,t){const{templates:s}=e,i=e._getItems(t),n=i&&i.length>0,r=Object.getPrototypeOf(e.constructor).defaultTemplates.ready(e,t);return n?s.carousel(e,t,r):r},carousel:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-previous" data-role="previous">${n.previous(e,t)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(e,t)}</div>`},previous:xi,next:xi}),Ii=Object.freeze({...wi.defaultTemplates,...Oi});function xi(e){const{className:t}=e;return`<svg class="${t}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Ti="miso-ui-icon",Ci=Ti+"-svg-1_11_4",Ai={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},Ri=`<symbol id="${Ti}-${Ai.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Ni=`<symbol id="${Ti}-${Ai.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,$i=`<symbol id="${Ti}-${Ai.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,i=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-i} ${i}L${i} ${t-i}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,Pi=`<svg id="${Ci}" style="display:none;">${[Ri,Ni,$i].join("")}</svg>`;let Li=!1;function Ui(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${Ti}-${e}"></use></svg>`}Li||document.head.querySelector("#"+Ci)||(Li=!0,document.head.insertAdjacentHTML("beforeend",Pi));const qi=new Set(Object.values(Ai));Ui(Ai.SEND),Ui(Ai.SEARCH);const ji=Ui(Ai.TRIANGLE),Di="miso-search-box";const Mi=Object.freeze({root:function(e){const{className:t,templates:s,role:i,options:n,autocomplete:r}=e,{placeholder:o}=n;return`\n<div class="${t}" ${i?`data-role="${i}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=t;var r;return("function"==typeof i?i(e):""+i)+("function"==typeof n?n(e):(qi.has(r=n)?Ui(r):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:i,autocomplete:n}=e;e={templates:s,workflow:i,...n};const r=[],o=[];for(const e of t)(e.product?r:o).push(e);return s.queries(e,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:i,templates:n}=e;return`<ul class="${i}__${t}-list" data-role="${t}-list">${s.map((s=>n.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:i,templates:n}=e;return`\n<li class="${i}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${n[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||N(t)},product:function(e,{product:t}){const{templates:s}=e,[i,n]=s.helpers.tagPair(e,t,{role:!1});return""+i+s.imageBlock(e,t)+s.productInfoBlock(e,t)+n},imageBlock:Xs,productInfoBlock:Gs}),zi=Object.freeze({className:"miso-autocomplete",debounce:300});class Fi extends ai{static get type(){return"search-box"}static get defaultTemplates(){return Mi}static get defaultClassName(){return Di}constructor({className:e=Di,templates:t,autocomplete:s,...i}={}){super({className:e,templates:{...Mi,...t},...i}),v(this,{autocomplete:{...zi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=G(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:i}){if(!t.completions)return;const{status:n=Gt.INITIAL,session:r,value:o}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(e),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);e.classList[l.length>0?"add":"remove"]("nonempty"),u.setAttribute("data-status",n),u.innerHTML=this.templates.completions(this,l),i({completions:{index:a,status:n}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return Bi.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new Bi(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&T(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let i=t;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const t=i.getAttribute("data-index"),n=this._context().data.get(parseInt(t)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[Mt.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class Bi{static empty(){return Bi._empty||(Bi._empty=new Bi)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,i=[];for(const n in e)for(const r of e[n])r.product&&!r.product.url||(r._index=t,r._field=n,s.set(t,r),i.push(r),t++);return i}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const Qi="miso-option-list";const Gi=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:i}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>i.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${N(t.text||t)}</li>`}});class Hi extends ai{static get type(){return"option-list"}static get defaultTemplates(){return Gi}static get defaultClassName(){return Qi}constructor({className:e=Qi,templates:t,...s}={}){super({className:e,templates:{...Gi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:i}=t;this._syncOptionValues(e,i)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;const i=this._getItems(t)||[];s.classList[0===i.length?"add":"remove"]("empty")}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;i&&(this._trackClick(e,s),this._submit(i.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}fi(Hi.prototype);const Wi=Object.freeze({...Bs("options"),root:function(e){const{className:t,role:s,templates:i}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${i.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:i}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${i.content(e,t)}\n</div>\n`}});class Ki extends ai{static get defaultTemplates(){return Wi}constructor({className:e,templates:t,field:s,defaultValue:i,...n}={}){super({className:e,templates:{...Wi,...t},...n}),this._field=s,this._defaultValue=i}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=T(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=t.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],A((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:i}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",i),this._state=void 0}_select(e){this._submit({value:e})}_clear(){this._submit({unselected:!0})}async _submit(e){this._view.hub.update(this._field,e)}}const Vi="miso-feedback",Yi=["helpful","unhelpful"];const Zi=Object.freeze({options:function(e){const{templates:t}=e;return Yi.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:i,options:n={}}=e;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(e,t)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Ji extends Ki{static get type(){return"feedback"}static get defaultTemplates(){return Zi}static get defaultClassName(){return Vi}constructor({className:e=Vi,templates:t,...s}={}){if(super({className:e,templates:{...Zi,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Xi="miso-text";const en=Object.freeze({root:function(e,{value:t}){const{className:s,role:i,options:{raw:n=!1,tag:r}}=e,o=i?`data-role="${i}"`:"",a=void 0!==t?N(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:i}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[n,r]=t;switch(n){case"date":return e=>s(e,r);case"number":return e=>i(e,r);default:return e=>""+e}}(e)(t)):"";return n?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class tn extends ai{static get type(){return"text"}static get defaultTemplates(){return en}static get defaultClassName(){return Xi}constructor({className:e=Xi,templates:t,tag:s="p",...i}={}){super({className:e,templates:{...en,...t},tag:s,...i})}}class sn extends Fs{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=U(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class nn{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=t.substring(0,s),u=!i.startsWith(c);return a||u?e.innerText=i:e.insertAdjacentText("beforeend",i.substring(s,n)),a&&e.classList.add("done"),{cursor:n,done:a}}}function rn(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=e;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[t,on(t)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(e));const i=t.children[0];return i.setAttribute("data-status",s||Gt.INITIAL),i}function on(e){return e+"__cursor"}function an(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:i,ref:n,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${cn(i[0])}, ${cn(i[1])})`,t,""+r,n,o)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function cn(e){return Math.floor(100*e)/100+"ms"}const un="miso-typewriter";class ln extends sn{static get type(){return"typewriter"}static get defaultClassName(){return un}constructor({className:e=un,tag:t="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:t,format:s,tooltip:i,...a}),v(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:J({speed:n,acceleration:r}),this._readiness=new j,"markdown"===s&&ln.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=on(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:i,onDebug:an(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new nn}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=e,a=i&&i.answer_stage||"result",c=(l=e,(u=t)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=t?c&&a===t.stage?t.streak:t.streak+1:0,_=c&&t&&t.doneAt||(r!==Gt.READY||o?void 0:Date.now());return this._prevState=Object.freeze(y({session:n,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(e,{state:t,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=rn(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(o,s,{...t,cursor:e})}n(a);const u=t.status===Gt.READY&&!a.done;i({ongoing:u},{silent:u&&(!s||s.status===Gt.READY)&&!c}),u&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{index:e}))}const i=t.closest("a");if(i){if(!e.defaultPrevented){const{href:e,innerText:t,className:s}=i;e&&this._view._events.emit("link-click",y({url:e,text:t?t.trim():"",className:s||"",attributes:hn(i)}))}}else;}}function hn(e){const{attributes:t}=e,s={};for(const{name:e,value:i}of t)e.startsWith("data-")&&(s[e]=i);try{return JSON.stringify(s)}catch(e){return"{}"}}const _n="miso-affiliation";const dn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e,{status:r}=t,o=i?` data-role="${i}"`:"",a=t.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=e._getItems(t),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===Gt.READY?n[r](e,t):""}</div>`},[Gt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t);return i&&i.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}-container">${n.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return ji},body:function(e,t){const{className:s,templates:i}=e,n=e._getItems(t);return`<div class="${s}__body">${i.list(e,t,n)}</div>`},item:function(e,t,s,i){const{className:n,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(e,t,s,{index:i})}${r[a](e,t,s,{index:i})}</div></li>`},itemHeader:function(e,t,s,i){const{className:n,templates:r}=e;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=oi.asFunction(o)(e,t,s,i),a=oi.asFunction(a)(e,t,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,i){const{templates:n}=e,[r,o]=si(e,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||Qs)(e,s,i)+(n.imageBlock||Xs)(e,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,i){const{className:n,templates:r}=e,o=oi.asFunction(r.logoText)(e,t,s,i)||"",a=oi.asFunction(r.logoImg)(e,t,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(e,t,s,i){const{className:n,templates:r}=e,o=oi.asFunction(r.logoUrl)(e,t,s,i);if(!o)return"";const a=oi.asFunction(r.logoAltText)(e,t,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),pn=Object.freeze({...wi.defaultTemplates,...dn});class mn extends wi{static get type(){return"affiliation"}static get defaultTemplates(){return pn}static get defaultClassName(){return _n}constructor({className:e=_n,templates:t,autoplay:s,...i}={}){super({className:e,itemType:"affiliation",templates:{...dn,...t},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new ce(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,A((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(this._displayedCount=s,void 0===s?i.removeAttribute("data-item-count"):i.setAttribute("data-item-count",s))}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const fn="miso-facets",gn="miso-facet",yn="custom_attributes.";const bn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:i={}}=t.value||{};return Object.keys(i).map((n=>s.facet(e,{field:n,entries:i[n]},t)))},facet:function(e,t,s){const{facetClassName:i=gn,templates:n}=e,{field:r}=t;return`<div class="${i}" data-role="facet" data-field="${N(r)}">${n.header(e,t,s)}${n.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:i=gn,templates:n}=e;return`<div class="${i}__header">${n.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(yn)&&(t=t.substring(18)),N(t)},options:function(e,{field:t,entries:s},i){const{facetClassName:n=gn,templates:r}=e;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>r.option(e,{field:t,value:s,count:n},i))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:i=gn,templates:n}=e;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(e,t,s)}</span>\n  <span class="${i}__count">${n.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return N(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function wn(e,t){return`${e}:::${t}`}function vn(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class En extends ai{static get type(){return"facets"}static get defaultTemplates(){return bn}static get defaultClassName(){return fn}constructor({className:e=fn,templates:t,...s}={}){super({className:e,templates:{...bn,...t},...s}),this._bindings=new mi}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=vn(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)this._setSelected(i,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=vn(e.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)t[e]&&this._setSelected(i,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),i=[],n=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),o=s[e];if(!o)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=o[t];if(!c)break;i.push(wn(e,c)),n.push({field:e,value:c}),r.push(s)}}this._bindings.update(i,n,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[N(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;if(!i)return;const{field:n,value:r}=i;this._view.filters.facets.toggle(n,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Sn="miso-select";const kn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e,r=i?`data-role="${i}"`:"",o=e._getItems(t),a=o.find((e=>e.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${n.button(e,a)}\n  ${n.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:i}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:i}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>i.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:i}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${i.text(e,t)}</li>`},text:function(e,t){return N(t&&t.text&&t.text.replace(/[-_][a-zA-Z]/g," $1")||t||"")}});class On extends ai{static get type(){return"select"}static get defaultTemplates(){return kn}static get defaultClassName(){return Sn}constructor({className:e=Sn,templates:t,...s}={}){super({className:e,templates:{...kn,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}fi(On.prototype);const In="miso-more-button";const xn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${t.status!==Gt.READY?" disabled":""}>\n  ${n.text(e)}\n</div>\n`},text:function(e){return"More"}});class Tn extends ai{static get type(){return"more-button"}static get defaultTemplates(){return xn}static get defaultClassName(){return In}constructor({className:e=In,templates:t,...s}={}){super({className:e,templates:{...xn,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var Cn=Object.freeze({__proto__:null,TemplateBasedLayout:ai,ContainerLayout:li,ErrorLayout:_i,BannerLayout:class extends ai{static get type(){return"banner"}static get defaultTemplates(){return di}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...di,...t},...s})}},CollectionLayout:wi,ListLayout:Ei,CardsLayout:class extends wi{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Si}constructor({className:e=Si,...t}={}){super({className:e,...t})}},CarouselLayout:class extends wi{static get type(){return"carousel"}static get defaultTemplates(){return Ii}static get defaultClassName(){return ki}constructor({className:e=ki,templates:t,...s}={}){super({className:e,templates:{...Oi,...t},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(e,t,s){super._render(e,t,s);const{state:i}=t,n=this._getItems(i);this._itemCount=n?n.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const e=this._findGridElement();if(!e)return;const t=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(e).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(t/s))}_setPage(e){if(0>e?e=this._pageCount-1:this._pageCount>e||(e=0),e===this._page)return;this._page=e;const t=this._findGridElement();if(t){t.style.setProperty("grid-template-rows",(0===e?"":`repeat(${e}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:e}=this._view;return e&&e.querySelector(`.${this.className}__list`)}_onClick(e){super._onClick(e);const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:Fi,OptionListLayout:Hi,FeedbackLayout:Ji,TextLayout:tn,TypewriterLayout:ln,AffiliationLayout:mn,FacetsLayout:En,SelectLayout:On,MoreButtonLayout:Tn});function An(e){return e&&e.value&&e.value.revision}function Rn(e){const t=function(e){if(!e)return Gt.INITIAL;const{request:t,error:s,value:i}=e;return s?Gt.ERRONEOUS:i?Gt.READY:t?Gt.LOADING:Gt.INITIAL}(e);return y({status:t,ongoing:t===Gt.READY?e.ongoing:void 0,...e})}function Nn(e){const{request:t,value:s}=e;if(!t)return e;const{payload:i}=t||{},{q:n}=i||{};return n?{...e,value:{...s,keywords:n}}:e}function $n(e){const{role:t,type:s,items:i}=e,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:y({property:t})}};switch(function(e){return Bt.has(e)}(s)&&(!function(e){return Dt.has(e)}(t)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map((e=>e.text||e.id||e))):n.product_ids=(i||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case Mt.SUBMIT:n.context.custom_context.value=e.value;break;case Mt.FEEDBACK:n.context.custom_context.value=n.value=e.value,n.context.custom_context.result_type=n.result_type=e.result_type}return y(n)}function Pn(e={},t={}){return y({...e,...t,context:y({...e.context,...t.context,custom_context:y({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const Ln=Object.freeze({}),Un=Object.freeze({[Ut.CONTAINER]:li.type,[Ut.ERROR]:_i.type}),qn=Object.freeze({}),jn=Object.freeze({api:Ln,layouts:Un,trackers:qn}),Dn=Object.freeze({mappings:{[Ut.ERROR]:e=>e.error}});class Mn extends oe{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:i,defaults:n,options:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=i=i||t._client,e=Object.freeze({...e,plugin:s,client:i}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=r||new rs(t&&t._options,n),this._hub=function(e,t){const{update:s,trigger:i}=e;return e.update=(i,n,r)=>(r&&r.silent||t("update",i,n,r),s.call(e,i,n,r)),e.trigger=(...s)=>(t("trigger",...s),i.apply(e,s)),e}(new ds,((...e)=>this._log(...e))),this._sessionContext=new WeakMap,this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,i=this._client,n=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new ps(s),this._data=new fs(s,{source:zs(i),options:n}),this._views=new Us(s,{extensions:r,layouts:o,roles:t,options:n,workflow:e}),this._interactions=new Ms(s,{client:i,options:n})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(_s(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[_s(e)]||{};t.session&&t.status===Gt.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===Gt.READY,i=t===Gt.ERRONEOUS;this._emitLifecycleEvent(i?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||i)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(e);return i.add(e),!n}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Rt(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=An(e);if(!b(s)){const e=An(this._hub.states.data);if(!b(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=Rn(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:Gt.READY,session:this.session,...t},this._hub.update(_s(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=$n(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)t=i(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==Ut.AFFILIATION)return e;const{items:s}=t;return Pn(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return Pn(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[_s(t.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?Pn(e,{miso_id:i}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_log(e,t,s){this._emit(t,{_action:e,...s})}_emit(e,t){this._events.emit(e,t),this._context&&this._context._events.emit(e,{workflow:this,...t})}}function zn(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Fn(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:i}=t;if(!i)return e;i=i.map((e=>({...e})));let n=0;for(const e of i)s&&(e.channel=s),e.position=n++;return{...e,affiliation:{...t,products:i}}}(e)}function Fn({products:e,...t}){return{channel:"sovrn",...t,products:e.map(Bn)}}function Bn({id:e,deeplink:t,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return y({id:"sovrn-"+e,title:s,description:i,cover_image:c,url:t,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:Qn({sovrn_id:e,thumbnail:u,merchant:l,...h})})}function Qn(e,t=""){return Object.keys(e).reduce(((s,i)=>{const n=e[i];if(void 0===n)return s;const r=t?`${t}_${i}`:i;return"object"==typeof n?{...s,...Qn(n,r)}:{...s,[r]:n}}),{})}function Gn(e){K(e,Hn.prototype)}us(Mn.prototype),Object.assign(Mn,{DEFAULT_API_OPTIONS:Ln,DEFAULT_LAYOUTS:Un,DEFAULT_TRACKERS:qn,DEFAULT_OPTIONS:jn,ROLES_OPTIONS:Dn});class Hn{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=t;else{window.open(t,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl(e){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e.q)}}const Wn=Object.freeze({...Mn.DEFAULT_API_OPTIONS,group:_.ASK,payload:{...Mn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Kn=Object.freeze({actor:!1,api:{group:_.ASK,name:d.AUTOCOMPLETE}}),Vn=Object.freeze({...Mn.DEFAULT_LAYOUTS,[Ut.QUERY]:[Fi.type,{placeholder:"Ask a question"}],[Ut.QUESTION]:[tn.type,{tag:"h2"}],[Ut.ANSWER]:ln.type,[Ut.FEEDBACK]:Ji.type,[Ut.SOURCES]:[Ei.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Ut.AFFILIATION]:[mn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Yn=Object.freeze({...Mn.DEFAULT_TRACKERS,[Ut.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Jt.click},[Ut.SOURCES]:Jt,[Ut.AFFILIATION]:Jt,[Ut.PRODUCTS]:Jt}),Zn=Object.freeze({...Mn.DEFAULT_OPTIONS,api:Wn,autocomplete:Kn,layouts:Vn,trackers:Yn}),Jn=xt(Mn.ROLES_OPTIONS,{main:Ut.ANSWER,members:Object.keys(Vn)});class Xn extends Mn{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new Ds(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(Ut.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(Ut.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[_s(this._roles.main)]||{};e.session&&e.status!==Gt.INITIAL&&(e.status!==Gt.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,i=t===Gt.READY&&!e.ongoing,n=t===Gt.ERRONEOUS,r=i?"done":n?"error":t,o=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,e),(i||n)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){const{setValue:t,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:e=!0,focus:t=!0,param:s="q",sourceParam:i="qs",...n}={}){return{setValue:e,focus:t,param:s,sourceParam:i,...n}}(e),r=new URLSearchParams(window.location.search),o=r.get(i),a=r.get(n),{layout:c}=this._views.get(Ut.QUERY);c&&(o&&t&&(c.value=o),!o&&s&&c.focus()),o&&this.query({q:o,qs:a})}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||Lt}_buildPayload(){throw Error("Not implemented")}_updateData(e){!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){this._writeQuestionIdFromData(e)}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:zn(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){if(!e)return;const{question_id:t}=e;this._writeQuestionId(t)}_updateUrlIfNecessary({value:e,request:t}){if(!e||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{param:s}=this._autoQuery,{question:i}=e,n=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source===Lt,r=new URL(window.location);i===r.searchParams.get(s)||n&&!0!==this._autoQuery.updateUrl||(r.searchParams.set(s,i),window.history.replaceState({},"",r))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=this._writeAnswerClickInteraction(e,t)}_writeAskPropertiesToInteraction(e={},t){return Pn(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==Ut.ANSWER)return e;console.log("writeAnswerClickInteraction",e,t);const{items:s=[]}=t;return Pn(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[_s(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e}){const{value:t}=this.states.data||{},{sources:s}=t||{},i=s&&s[e-1];i&&i.product_id&&this._views.trackers.sources.click([i.product_id])}_onAnswerLinkClick(e){this._views.trackers.answer.click([],{items:[e]})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Gn(Xn.prototype),Object.assign(Xn,{DEFAULT_API_OPTIONS:Wn,DEFAULT_AUTOCOMPLETE_OPTIONS:Kn,DEFAULT_LAYOUTS:Vn,DEFAULT_TRACKERS:Yn,DEFAULT_OPTIONS:Zn,ROLES_OPTIONS:Jn});const er=Object.freeze({...Xn.DEFAULT_API_OPTIONS,name:d.QUESTIONS,payload:{...Xn.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),tr=Object.freeze({...Xn.DEFAULT_LAYOUTS,[Ut.QUERY]:[Fi.type,{templates:{buttonIcon:"send"}}],[Ut.RELATED_RESOURCES]:[Ei.type,{incremental:!0,itemType:"article"}],[Ut.QUERY_SUGGESTIONS]:Hi.type}),sr=Object.freeze({...Xn.DEFAULT_TRACKERS,[Ut.RELATED_RESOURCES]:Jt,[Ut.QUERY_SUGGESTIONS]:{...Jt,click:{...Jt.click,validate:e=>0===e.button}}}),ir=Object.freeze({...Xn.DEFAULT_OPTIONS,api:er,layouts:tr,trackers:sr}),nr=xt(Xn.ROLES_OPTIONS,{members:Object.keys(tr)});class rr extends Xn{constructor(e,t){super({name:"ask",context:e,roles:nr,defaults:ir,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;v(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:i}=this;return y({...s,question:e,parent_question_id:i,_meta:{...s._meta,question_source:t||Lt}})}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let i,n,r,{property:o}=e.context&&e.context.custom_context||{};return t.role===Ut.QUERY_SUGGESTIONS?(o="suggested_followup_questions",n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,r=this._getQuestionSourceFromViewState(t)),Pn(e,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:n,question_id:i,question_source:r}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class or extends hs{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new rr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new rr(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const ar=Object.freeze({...Mn.DEFAULT_API_OPTIONS,group:_.SEARCH,payload:{...Mn.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),cr=Object.freeze({...Mn.DEFAULT_LAYOUTS,[Ut.QUERY]:[Fi.type],[Ut.PRODUCTS]:[Ei.type,{incremental:!0,infiniteScroll:!0}],[Ut.KEYWORDS]:[tn.type,{raw:!0}],[Ut.TOTAL]:[tn.type,{raw:!0,format:"number"}],[Ut.FACETS]:[En.type],[Ut.SORT]:[On.type],[Ut.MORE]:[Tn.type]}),ur=Object.freeze({...Mn.DEFAULT_TRACKERS,[Ut.PRODUCTS]:Jt}),lr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),hr=Object.freeze({...Mn.DEFAULT_OPTIONS,api:ar,layouts:cr,trackers:ur,pagination:lr}),_r=xt(Mn.ROLES_OPTIONS,{main:Ut.PRODUCTS,members:Object.keys(cr),mappings:{[Ut.FACETS]:"facet_counts",[Ut.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=t.states.filters||{},r=n&&n.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(i).field;return r?i.map((e=>({...e,selected:e.field===r}))):i}}});class dr extends Mn{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(Ut.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==Gt.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:i}=t||{};return y({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const i=e[s];i&&i.length&&(t[s]={terms:i})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return f(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},i=s.map((e=>e.product_id)).filter((e=>e)),n=[...e.exclude||[],...i];return 0===n.length?e:{...e,exclude:n}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:i}=e;switch(s){case Gt.INITIAL:case Gt.LOADING:break;default:return e}return i&&i.facet_counts?e:{...e,value:{...i,facet_counts:t}}}(e=Nn(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=Ut.PRODUCTS}={}){const{status:s,request:i,value:n}=e;if(s!==Gt.READY||!i||!n)return e;const{[t]:r}=n;if(!r)return e;const{rows:o}=i.payload,{length:a}=r;return o>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=Ut.PRODUCTS}={}){if(!t.value)return e;const{[s]:i=[],facet_counts:n,total:r}=e.value,{[s]:o=[]}=t.value;return{...t,facet_counts:n,total:r,value:{...t.value,[s]:[...i,...o]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}us(dr.prototype,[Wt.PAGINATION,Wt.FILTERS]),Object.assign(dr,{DEFAULT_API_OPTIONS:ar,DEFAULT_LAYOUTS:cr,DEFAULT_TRACKERS:ur,DEFAULT_PAGINATION:lr,DEFAULT_OPTIONS:hr,ROLES_OPTIONS:_r});const pr=Object.freeze({members:[]});function mr({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function fr(e){return e&&e.value&&e.value.trim()||void 0}class gr extends Mn{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:mr(t),roles:pr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,fr(e)===fr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!fr(e))return void this._updateCompletions({session:s,status:Gt.INITIAL});const i=this._buildPayload(e);this._request({payload:i})}_buildPayload(e){return{q:fr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function yr(e){K(e,br.prototype)}class br{_initAutocomplete(e){this._autocomplete=new gr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const wr=xt(Xn.ROLES_OPTIONS,{mappings:{[Ut.QUESTION]:Ut.KEYWORDS}});class vr extends Xn{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:wr,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset(),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||Lt}}}_defaultProcessData(e){return e=Nn(e=super._defaultProcessData(e))}_updateDataInHub(e){switch(e.status){case Gt.INITIAL:case Gt.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}yr(vr.prototype);const Er={...dr.ROLES_OPTIONS,members:[Ut.PRODUCTS,Ut.KEYWORDS,Ut.TOTAL,Ut.FACETS,Ut.SORT,Ut.MORE,Ut.ERROR]};class Sr extends dr{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:Er,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:y({...e._meta,question_id:this._superworkflow._answer.questionId})}}}Object.assign(Sr,{ROLES_OPTIONS:Er});class kr{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return Sr.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,i=this._getSubviews(s);if(!i._containers.has(e)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(e)){for(const i of e.components)if(s.containsElement(i))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}i.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const Or=Object.freeze({group:_.ASK,name:d.SEARCH,payload:{...Xn.DEFAULT_API_OPTIONS.payload,...dr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Ir=Object.freeze({...Xn.DEFAULT_LAYOUTS,...dr.DEFAULT_LAYOUTS,[Ut.QUERY]:[Fi.type,{placeholder:""}],[Ut.QUESTION]:[tn.type,{raw:!0}]}),xr=Object.freeze({...Xn.DEFAULT_TRACKERS,...dr.DEFAULT_TRACKERS}),Tr=Object.freeze({...dr.DEFAULT_PAGINATION,active:!0}),Cr=Object.freeze({api:{group:_.ASK,name:d.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Ar=Object.freeze({...Xn.DEFAULT_OPTIONS,...dr.DEFAULT_OPTIONS,api:Or,layouts:Ir,trackers:xr,autocomplete:Cr,pagination:Tr}),Rr=Object.freeze({main:Ut.PRODUCTS,members:Object.keys(Ir),mappings:Object.freeze({...Xn.ROLES_OPTIONS.mappings,...dr.ROLES_OPTIONS.mappings})});class Nr extends Mn{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Rr,defaults:Ar})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new vr(this),this._results=new Sr(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){const e=this._hub,t=this._client,s=this._options;this._views=new kr(this),this._interactions=new Ms(e,{client:t,options:s})}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return this._answer._defaultProcessInteraction(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}us(Nr.prototype,[Wt.PAGINATION,Wt.FILTERS]);const $r=Object.freeze({...Mn.DEFAULT_API_OPTIONS,group:_.ASK,name:d.RELATED_QUESTIONS}),Pr=Object.freeze({...Mn.DEFAULT_LAYOUTS,[Ut.RELATED_QUESTIONS]:[Ei.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Ut.QUERY]:[Fi.type,{placeholder:"Ask a question"}]}),Lr=Object.freeze({...Mn.DEFAULT_TRACKERS,[Ut.RELATED_QUESTIONS]:Jt,[Ut.CONTAINER]:{...Jt,itemless:!0},[Ut.QUERY]:{[Mt.SUBMIT]:{active:!0}}}),Ur=Object.freeze({...Mn.DEFAULT_OPTIONS,api:$r,layouts:Pr,trackers:Lr}),qr=xt(Mn.ROLES_OPTIONS,{main:Ut.RELATED_QUESTIONS,members:Object.keys(Pr)});class jr extends Mn{constructor(e,t){super({name:"explore",plugin:e,client:t,roles:qr,defaults:Ur})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(Ut.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(e){const{product_id:t}=e;return t&&(this._productId=t),super.useApi(e)}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=Ut.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e},{generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage(e)}_getSubmitUrl(e,{generated:t=!1}={}){let s=Hn.prototype._getSubmitUrl.call(this,e);return t&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}Gn(jr.prototype);const Dr=Object.freeze({group:_.SEARCH,name:d.SEARCH,payload:{fl:["*"]}}),Mr=Object.freeze({api:{group:_.SEARCH,name:d.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),zr=Object.freeze({...dr.DEFAULT_LAYOUTS}),Fr=Object.freeze({...dr.DEFAULT_TRACKERS}),Br=Object.freeze({...dr.DEFAULT_OPTIONS,api:Dr,autocomplete:Mr,layouts:zr,trackers:Fr}),Qr=dr.ROLES_OPTIONS;class Gr extends dr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:Qr,defaults:Br})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}autoQuery({setValue:e=!0,focus:t=!0,param:s="q"}={}){const i=new URLSearchParams(window.location.search).get(s),{layout:n}=this._views.get(Ut.QUERY);n&&(i&&e&&(n.value=i),!i&&t&&n.focus()),i&&this.query({q:i})}notifyViewUpdate(e=Ut.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._feedback._destroy(),this._destroyAutocomplete(),super._destroy(e)}}yr(Gr.prototype);const Hr=Object.freeze({...Mn.DEFAULT_API_OPTIONS,group:_.RECOMMENDATION,name:d.USER_TO_PRODUCTS,payload:{...Mn.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Wr=Object.freeze({...Mn.DEFAULT_LAYOUTS,[Ut.PRODUCTS]:Ei.type}),Kr=Object.freeze({...Mn.DEFAULT_TRACKERS,[Ut.PRODUCTS]:Jt}),Vr=Object.freeze({...Mn.DEFAULT_OPTIONS,api:Hr,layouts:Wr,trackers:Kr}),Yr=xt(Mn.ROLES_OPTIONS,{main:Ut.PRODUCTS,members:Object.keys(Wr)});class Zr extends Mn{constructor(e,t){super({name:"recommendation",context:e,roles:Yr,defaults:Vr,id:t})}_initProperties(e){super._initProperties(e);const{id:t}=e;v(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}start(){return this._request(),this}notifyViewUpdate(e=Ut.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return Pn(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}class Jr extends hs{constructor(e,t){super("recommendations",e,t),this._members=new Map}workflows(){return[...this._members.values()]}create(e=Pt){if(this._members.has(e))throw Error("Unit already exists: "+e);return new Zr(this,e)}has(e=Pt){return this._members.has(e)}get(e=Pt){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||new Zr(this,e)}}class Xr extends oe{constructor({name:e,plugin:t,MisoClient:s,...i}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new j)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var eo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var to=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class so{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class io{constructor(e){this._context=e,v(this,{lowerCamelToKebab:k,kebabToLowerCamel:E,kebabOrSnakeToLowerCamel:S})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...i}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=S(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:i=!1}){const{classPrefix:n}=e;return`<${s} class="${i?n+"__phrase-inline":n+"__phrase"} ${n}__${t}-phrase">${this.phraseText(e,E(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,i=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof i){case"function":return i(e);case"string":return i;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${e}__${i}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const i=t[e];void 0!==i&&(s+=` ${k(e)}="${i}"`)}return s}}const no=V(new io({...eo,DEFAULT_PHRASES:to})),ro=V(new class extends so{constructor(){super({helpers:no})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:i}=this._helpers,{features:n={},logo:r=!0}=e;return i(e,{name:"related-resources"},!1===n.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:i={}}=e;return!1===i.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:no}));function oo(e={}){const{normalizeOptions:t,section:s,container:i}=no,{querySuggestions:n,answerGroup:r}=ro;return s(e=t(e),{name:"follow-up"},[n(e),i(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(e)])}var ao=Object.freeze({__proto__:null,helpers:no,sections:ro,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=no,{followUps:n,relatedResourcesSection:r,answerGroup:o}=ro;return""+s(e=t(e),{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},o(e))+n(e)+r(e)},followUp:oo});const co=Object.freeze(eo),uo=Object.freeze(to),lo=Object.freeze(ao);var ho=Object.freeze({__proto__:null,constants:co,phrases:uo,templates:lo,wireFollowUps:function(e,t,{template:s=oo,...i}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const n=e.ui.asks,r=e.ui.ask;n.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:e.workflow.questionId}))})),r.on("loading",(()=>{t.innerHTML="",n.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:_o}=document,po=Object.freeze({templates:lo,autostart:!0}),mo=["templates","phrases","features"];class fo{constructor(){this._defaults=po,this._scriptSrc=function(){if(!_o||!_o.src)return{};const e=document.createElement("a");e.href=_o.src;const t={};for(const[s,i]of new URLSearchParams(e.search))"q"!==s&&(t[s]=bo(i));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=bo(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:i,...n}={}){return y({apiKey:e,apiHost:t,templates:wo(s),phrases:i,...n})}(go(this._defaults,this._scriptSrc,e,this._pageUrl))}}function go(...e){let t={};for(const s of e)s&&(t=yo(t,s));return t}function yo(e,t){if(!t)return e;Object.assign(e,t);for(const s of mo)s in t&&(e[s]={...e[s],...t[s]});return e}function bo(e){return""===e||"false"!==e&&e}function wo(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(wo):function(e,t){const s={};for(const[i,n]of Object.entries(e))s[i]=t(n);return s}(e,wo);default:throw Error("Unsupported template type: "+e)}}class vo{constructor(e,{classPrefix:t=co.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");v(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class Eo extends Xr{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new fo,this._localOptions={}}config(e={}){e=go(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;v(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new vo(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=e.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,u=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(t,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),u.autoQuery()}}class So extends ae{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let ko,Oo,Io;async function xo(e){const t=await async function(e){return e.MisoClient||window.MisoClient||ko||(ko=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return Oo=Oo||t.any(),Io=Io||await Oo,Io.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),Io}const To="logo",Co="auto",Ao=Object.freeze([To]);function Ro(e){if(!e)return Co;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class No extends HTMLElement{static get observedAttributes(){return Ao}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Ro(this.getAttribute(To))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Co:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(To,t):this.removeAttribute(To)}async connectedCallback(){const e=this._client=await xo(No);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===To)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){Ro(e)!==Ro(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const $o="parent-question-id",Po=Object.freeze([...No.observedAttributes,$o]);const Lo="unit-id",Uo=Object.freeze([...No.observedAttributes,Lo]);var qo=Object.freeze({__proto__:null,MisoAskElement:class extends No{static get tagName(){return"miso-ask"}static get observedAttributes(){return Po}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute($o)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute($o,e):this.removeAttribute($o))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===$o)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends No{static get observedAttributes(){return No.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(e){return e.ui.explore}},MisoHybridSearchElement:class extends No{static get observedAttributes(){return No.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends No{static get observedAttributes(){return No.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends No{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Uo}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}get unitId(){return this.getAttribute(Lo)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(Lo,e):this.removeAttribute(Lo)}attributeChangedCallback(e,t,s){if(e===Lo)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}});const jo="role",Do=Object.freeze([jo]);class Mo extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Do}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(jo);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${jo}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${jo}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===jo&&this._container&&this._container._updateComponentRole(this,t,s)}}var zo=Object.freeze({__proto__:null,MisoComponentElement:Mo,MisoQueryElement:class extends Mo{constructor(){super({role:Ut.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Mo{constructor(){super({role:Ut.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Mo{constructor(){super({role:Ut.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Mo{constructor(){super({role:Ut.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Mo{constructor(){super({role:Ut.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Mo{constructor(){super({role:Ut.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Mo{constructor(){super({role:Ut.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Mo{constructor(){super({role:Ut.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends Mo{constructor(){super({role:Ut.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Mo{constructor(){super({role:Ut.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends Mo{constructor(){super({role:Ut.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Mo{constructor(){super({role:Ut.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Mo{constructor(){super({role:Ut.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Mo{constructor(){super({role:Ut.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Mo{constructor(){super({role:Ut.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Mo{constructor(){super({role:Ut.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Mo{constructor(){super({role:Ut.ERROR})}static get tagName(){return"miso-error"}}});class Fo extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Fo.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Bo=Object.freeze({__proto__:null,containers:qo,roles:zo,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Fo{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:ci});const Qo="miso-hybrid-search-combo";var Go=Object.freeze({__proto__:null,CLASS_PREFIX:Qo,CONAINER_TAG:"miso-hybrid-search"});const Ho="Show more",Wo="Show less";var Ko=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:Ho,showLess:Wo});const Vo=V(new io({...Go,DEFAULT_PHRASES:Ko})),Yo=V(new class extends so{constructor(){super({helpers:Vo})}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Vo}));var Zo=Object.freeze({__proto__:null,helpers:Vo,sections:Yo,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=Vo;e=t(e);const{answerBox:n,answerGroup:r,searchResultsGroup:o}=Yo,{answerBox:a=!0}=e;return""+s(e,{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[n(e)]:r(e))+s(e,{name:"search-results"},o(e))}});const Jo="answer-box-open",Xo="answer-box-shown",ea='[data-role="answer-box-toggle"]';class ta{constructor(e,t,{classPrefix:s=Qo,phrases:i={}}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=i,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(ea)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer;switch(e){case Gt.ERRONEOUS:case Gt.READY:this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||Wo:this._phrases.showMore||Ho;for(const t of this._element.querySelectorAll(ea))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const sa={isOpen:Jo,shown:Xo},ia={toggleOpen:["toggle",Jo],open:["open",Jo],close:["remove",Jo],toggleHidden:["toggle",Xo],show:["add",Xo],hide:["remove",Xo]};for(const[e,t]of Object.entries(sa))Object.defineProperty(ta.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(ia))ta.prototype[e]=function(){this._updateBoxStatus(t,s),s===Jo&&(this._syncButtonText(),this._syncScroll())};const na=Object.freeze(Go),ra=Object.freeze(Ko),oa=Object.freeze(Zo);var aa=Object.freeze({__proto__:null,constants:na,phrases:ra,templates:oa,wireAnswerBox:function(e,t){if(!e)throw Error("client is required");t&&new ta(e,t)}});const ca=Object.freeze(ho),ua=Object.freeze(aa);var la=Object.freeze({__proto__:null,ask:ca,hybridSearch:ua});const ha="ui";let _a,da;async function pa(){return da||(da=F(_a||(_a=B(ha))))}class ma{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class fa{constructor(e,t){this._plugin=e,this._client=t,v(this,{sources:{api:zs(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Gr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Nr(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new jr(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class ga{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new Eo(this._plugin,this._MisoClient))}}nt.plugins.use(class extends oe{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new So(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new j}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:la};w(s,this,["layouts","combo","ready"]),v(this,{MisoClient:e}),v(e,{ui:s}),this.combo=new ga(this,e);const i=Object.values(Cn).filter((e=>e.type));for(const t of i)t.MisoClient=e;for(const e of i)this.layouts.register(e);const{containers:n,roles:r,combos:o,...a}=Bo,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];No.MisoClient=e,Fo.MisoClient=e;for(const t of c)t.MisoClient=e;await pa();for(const e of c)C(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){v(e,{ui:new fa(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new ma(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Jr(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new or(this,e)),t}});var ya=Object.freeze({aff_type:"random",...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,i]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===i||i);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const ba=5e3;let wa,va,Ea=!1;async function Sa(e){return new Promise((t=>setTimeout((()=>{const e=$();Ta("Fallback",e),t(e)}),e)))}async function ka(){const e=await be((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&Ta("GA4",e),e}async function Oa(){const e=(await(wa||(wa=async function(){return be((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&Ta("UA",e),e}const Ia="%cMiso",xa="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Ta(e,t){!function(...e){(ya.debug||o.indexOf("beta")>=0||"dev"===o)&&function(...e){console.log(Ia,xa,...e)}(...e)}(`[${e}] Client ID: ${t}${Ea?" (unused)":""}`),Ea=!0}async function Ca(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(nt,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||t.debug;i&&nt.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&nt.plugins.use("std:dry-run");return window.MisoClientSA=nt,nt}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const i=window.misoSA=new t(s);return i.context.anonymous_id=await async function(){return va||(va=Promise.any([ka(),Oa(),Sa(ba)]))}(),i}(e,{MisoClient:t});return await s.ui.ready,[t,s]}function Aa(e){return t=>({...t,context:{...t.context,custom_context:{...Ra(e),...t.context&&t.context.custom_context}}})}function Ra({site:e,page:t,config:s,version:i}){return y({source:"miso-client-script",script_version:i,attribution:"miso-smart-answers",site:e.key,user_geo:s.geo,page_type:t.type,post_id:t.postId,uuid:$()})}let Na;async function $a(){return Na||(Na=async function(){const[[e,t]]=await Promise.all([Ca(Oe),_e(Oe)]);return{MisoClient:e,client:t}}())}const Pa='<svg viewBox="0 0 15 14" fill="currentColor">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.92319V5.46173C0.000125254 5.46173 0.000250509 5.46173 0.000375766 5.46173C2.12455 5.46173 3.84653 7.18371 3.84653 9.30789C3.84653 9.3079 3.84653 9.30791 3.84653 9.30792H5.38499C5.38499 9.30791 5.38499 9.3079 5.38499 9.30789C5.38499 7.18384 7.10677 5.46194 9.23077 5.46173V3.92327C7.10678 3.92307 5.38501 2.20118 5.38499 0.0771484H3.8466C3.84655 2.20127 2.12459 3.92319 0.000450868 3.92319C0.000300577 3.92319 0.000150287 3.92319 0 3.92319Z" />\n<path fill-rule="evenodd" clip-rule="evenodd" d="M8 9.83844V11.005C9.61039 11.0056 10.9157 12.3112 10.9157 13.9217C10.9157 13.9222 10.9157 13.9226 10.9157 13.923H12.0822C12.0822 13.9226 12.0822 13.9222 12.0822 13.9217C12.0822 12.3109 13.388 11.005 14.9989 11.005C14.9993 11.005 14.9997 11.005 15.0002 11.005V9.83854C14.9997 9.83854 14.9993 9.83854 14.9989 9.83854C13.3884 9.83854 12.0827 8.53324 12.0822 6.92285H10.9156C10.915 8.53281 9.60996 9.83783 8 9.83844Z" />\n</svg>',La='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Ua='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>',qa={question:"Mini Smart Answers Overview"};function ja(e){return`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  ${Da()}\n</section>\n<div class="miso-hybrid-search-combo_section_container">\n  ${function(e){const t='\n<li class="miso-carousel__item">\n  <div class="miso-carousel__item-body">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:90px;width:90px;margin-bottom:0;border-radius:10px;flex-shrink:0;"></div>\n    <div style="width:100%;">\n      <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:100%;"></div>\n      <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:60%;margin-bottom:0;"></div>\n    </div>\n  </div>\n</li>\n';return`\n<section class="miso-hybrid-search-combo__skeleton miso-hidden">\n  <div class="miso-hybrid-search-combo__question-phrase">\n    <div class="miso-hybrid-search-combo__question-phrase-main">\n      <i>${Pa}</i>\n      <span>${Ma(e)}</span>\n    </div>\n  </div>\n  <div class="miso-hybrid-search-combo__skeleton-answer-block" style="margin-top:0.5rem;">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:92%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:70%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:95%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:65%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:90%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:100%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:60%;"></div>\n  </div>\n  <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">Sources</h3>\n  <div class="miso-carousel">\n    <ol class="miso-carousel__list">\n      ${t}\n      ${t}\n    </ol>\n  </div>\n</section>\n`}(e)}\n  <section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n    <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="miso-hybrid-search-combo__question-phrase">\n        <div class="miso-hybrid-search-combo__question-phrase-main">\n          <i>${Pa}</i>\n          <span>${Ma(e)}</span>\n        </div>\n      </div>\n      <miso-answer></miso-answer>\n    </miso-hybrid-search>\n    <miso-hybrid-search class="miso-hybrid-search-combo__sources-container miso-circled-citation-index" visible-when="ready" logo="false">\n      <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">Sources</h3>\n      <miso-sources></miso-sources>\n    </miso-hybrid-search>\n    <miso-hybrid-search class="miso-hybrid-search-combo__buttons-container miso-hidden">\n      <a class="miso-hybrid-search-combo__smart-answers-link" href="/smart-answers" target="_blank" rel="noopener nofollow">\n        <i>${Pa}</i>\n        <span>Learn more</span>\n      </a>\n      <miso-feedback></miso-feedback>\n    </ miso-hybrid-search>\n    \x3c!-- whitepaper --\x3e\n    \x3c!--\n    <miso-hybrid-search class="miso-hybrid-search-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <miso-affiliation></miso-affiliation>\n    </miso-hybrid-search>\n    --\x3e\n  </section>\n</div>\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__search-results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__search-results-container miso-circled-citation-index" visible-when="loading ready" logo="false">\n    <div class="miso-hybrid-search-combo__search-results-info">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__keywords-phrase">You searched for “<miso-keywords></miso-keywords>”</div>\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase"><miso-total></miso-total> Results</div>\n    </div>\n    <div class="miso-hybrid-search-combo__search-results-info">\n      <div class="miso-hybrid-search-combo__search-results-filters"><miso-facets></miso-facets></div>\n      <div class="miso-hybrid-search-combo__sort-dropdown">Sort: <miso-sort></div>\n    </div>\n    <miso-products></miso-products>\n    <miso-more></miso-more>\n  </miso-hybrid-search>\n</section>`.trim()}function Da(e){return`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${La}</span>\n        <input class="miso-search-box__input" placeholder="What are you searching for?" type="text" autocomplete="off" data-role="input">\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Ua}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}function Ma(e){const{site:t}=e;return qa.question.replaceAll("${site}",t.name)}const za=Object.freeze({ordered:!0,article:function(e,t,s,i){const{templates:n}=e,[r,o]=n.helpers.tagPair(e,s);return""+r+Fa(e,s,i)+Ba(e,s)+n.indexBlock(e,s,i)+o},infoBlock:Ba});function Fa(e,t,s={}){const{className:i}=e,{cover_image:n}=t;if(!n)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${n}">`}</div>`}function Ba({className:e},{title:t}){let s="";return t&&(s+=`<div class="${e}__item-title">${t}</div>`),`<div class="${e}__item-info-container">${s}</div>`}const Qa=Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,created_at:i,updated_at:n,published_at:r}){const o=r||i||n;let a=`<div class="${e}__item-main-block">`;t&&(a+=`<div class="${e}__item-title">${t}</div>`);s&&(a+=`<div class="${e}__item-snippet">${s}</div>`);o&&(a+=`<div class="${e}__item-date">${function(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}(o)}</div>`);return a+="</div>",`<div class="${e}__item-info-container">${a}</div>`}});function Ga(e,{MisoClient:t,client:s,rootElement:i}){const{site:n,config:o}=e,a=s.ui.hybridSearch;a.autocomplete.enable(),a.useApi({_meta:y({site:n.key,user_geo:o.geo}),facets:["type"],fl:r,source_fl:r}),a.useDataProcessor((({value:e,...t})=>{if(!e)return t;const{sources:s=[],products:i=[]}=e;return{value:{...e,sources:s.map(Wa),products:i.map(Ka)},...t}})),a.useInteractions({preprocess:Aa(e)}),a.useFilters({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),a.useLayouts({sources:["carousel",{templates:za}],products:{templates:Qa,infiniteScroll:!1},more:{templates:{text:()=>"show more"}}}),a.answer.on("request",(e=>{const t=new URL(window.location.href);t.searchParams.set("q",e.payload.q),window.history.replaceState({},"",t);const s=document.querySelector(".miso-hybrid-search-combo__smart-answers-link");s&&(s.href="/smart-answers?q="+encodeURIComponent(e.payload.q));document.querySelectorAll(".miso-hidden").forEach((e=>{e.classList.remove("miso-hidden")})),function(){const e=Va();e&&e.classList.add("miso-hybrid-search-combo__skeleton--show");Ya().forEach((e=>{e&&e.setAttribute("visible-when","done")}))}()})),a.answer.on("answer-stage",(e=>{"Generating summary"===e.answer_stage&&function(){const e=Va();e&&e.classList.remove("miso-hybrid-search-combo__skeleton--show");Ya().forEach((e=>{e&&e.setAttribute("visible-when","ready")}))}()}));const c=document.createElement("div");c.id="miso-search",c.classList.add("miso-hybrid-search-combo"),i.insertAdjacentElement("afterend",c),i.remove(),(i=c).innerHTML=ja(e);const{wireAnswerBox:u}=t.ui.defaults.hybridSearch;u(s,i),a.autoQuery()}function Ha(e,t,s){if(!e||!s)return t;const i=ye(e).hostname,{pathname:n}=new URL(s);return`https://${i}${n}`}function Wa({cover_image:e,url:t,custom_attributes:s,...i}){const{site:n,contenthub_url:r}=s;return console.log(ye(n)),console.log(ye(n).logo_image),{cover_image:e||n&&ye(n).logo_image,url:Ha(n,t,r),custom_attributes:s,...i}}function Ka({cover_image:e,url:t,custom_attributes:s,...i}){const{site:n,contenthub_url:r}=s;return{cover_image:e||n&&ye(n).logo_image,url:Ha(n,t,r),custom_attributes:s,...i}}function Va(){return document.querySelector(".miso-hybrid-search-combo__skeleton")}function Ya(){return[document.querySelector(".miso-hybrid-search-combo__answer-container"),document.querySelector(".miso-hybrid-search-combo__sources-container")]}const Za="header #miso-search",Ja="#siteSearch-open-button";function Xa(e){const{searchParams:t}=new URL(window.location.href);return t.set("q",e),"/search/?"+t}async function ec(e){const t=document.querySelector(Za);if(!t)return;const i=document.querySelector(Ja);if(e.page.type===s)return void(i&&i.addEventListener("click",(()=>{const e=document.querySelector("#siteSearch-close-button");e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()})));const{client:n}=await $a(),r=n.ui.hybridSearch;r.useLink(Xa,{open:!1}),r.autocomplete.enable(),t.classList.add("miso-hybrid-search-input"),t.innerHTML=Da()}const tc="#miso-search";async function sc(e){const t=function(){for(const e of document.querySelectorAll(tc))if(!e.closest("header"))return e}();if(!t)return;const{MisoClient:s,client:i}=await $a();Ga(e,{MisoClient:s,client:i,rootElement:t})}(async e=>{e.page.type===s&&function(e){const{version:t,debug:s}=e;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=t,s("Miso Smart Answers script version: "+t),!0)}(e)&&await Promise.all([sc(e),ec(e)])})(Oe)}();
