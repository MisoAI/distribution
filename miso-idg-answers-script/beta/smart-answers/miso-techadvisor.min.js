!function(){"use strict";var t=Object.freeze({aff_type:"random",...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()}),e="1.0.15-beta.2";const s=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var n=function(){if(t.sponsor)return s.find((e=>e.key===t.sponsor))||void 0}(),i="1.11.4";function r(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const o=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),a=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var c=Object.freeze({__proto__:null,GROUP:o,NAME:a});function u(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function l(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function h(t){return null!=t?""+t:t}function d(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function _(t){return null==t}function p(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function m(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function f(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function g(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function y(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class b{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);v(s),v(n),v(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>w(this,t)),e):w(this,t),this._value=t}disconnect(){this._active=!1}}function w(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function v(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function E(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function S(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function k(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function O(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,r)=>{const o=new b((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function I(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function T(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function A(t,e){const s=x((()=>window.localStorage.getItem(t))),n=x((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,r=e.indexOf(";",i);return decodeURIComponent(0>r?e.substring(i):e.substring(i,r))}(t))),i=s||n||""+e();return i&&!s&&x((()=>window.localStorage.setItem(t,i))),i&&!n&&x((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i))),i}function x(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function C(t){return new R(t)}class R{constructor(t){this._value=t;const e=t=>{this._value=t};m(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class N{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class ${constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new N),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var P="1.11.4";let q;try{q=document.currentScript}catch(t){}async function L(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(j(t))return;return new Promise((e=>{let s;s=setInterval((()=>{j(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function U(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${P}/dist/css/${t}.css`}function j(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function D(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function M(t,{depth:e=5,...s}={}){return z(t,e)}function z(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>z(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=z(i,e-1)))}return n}(t,e):t:"(...)"}function F(t,e){const s=Object.getOwnPropertyDescriptors(e),n=Object.getOwnPropertyDescriptors(t);for(const[e,i]of Object.entries(s))"constructor"!==e&&void 0===n[e]&&Object.defineProperty(t,e,i)}function B(t){const e={},s=new Set;for(let n=t;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(e[n]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}const Q=100,G=4;function W(t){const e=function({speed:t=Q,acceleration:e=G}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const r=e(n,s);return t+Math.max(i-n,0)*r/1e3}}const H=Symbol.for("miso:resources");class K{constructor(){this._resources=new Map;const t=window[H]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){V(this._resources,t).resolve(e)}async get(t){return V(this._resources,t).promise}}function V(t,e){if(t.has(e))return t.get(e);const s=new N;return t.set(e,s),s}function Y(){return window[H]||(window[H]=new K)}class Z{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new N;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class J{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)u(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&u(s,e)}}_injectSubscribeInterface(t){p(t,this,["on","once"])}}function X(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class tt{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:X(t,e),uuid:T()})}(t,e);m(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new J({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(tt,"miso:component");class et extends tt{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new N);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class st{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new b(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class nt{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const it=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class rt{constructor(t,e){this._client=t,this._root=e,this._bulk=new Z(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,d({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:r,body:o}=n[e];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=it.DATA_ENDPOINT,eventEndpoint:s=it.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){(t._error||console.error)(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){(t._error||console.error)(e)}return n}}class ot extends tt{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,r)}_postprocess({response:t}){return t.data}}const{GROUP:at,NAME:ct}=c;class ut extends ot{constructor(t){super(t,at.INTERACTIONS)}async upload(t,e){try{return await this._run(ct.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===ct.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}class lt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new nt(s);let o;e=r(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new $;return o=setInterval((async()=>{let e,o,d;try{if([e,o,d]=await t(r?{signal:r}:{}),u||!_(a)&&a>=d)return;_(d)||(a=d),i&&i(e,o,d),c=0}catch(t){return n&&n(t),c++,void(c>s&&(l(),h.error(t)))}h.update(e,o),o&&l()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?i.clear():this._isUpdated(o,t)&&i.touch(),o=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class ht extends lt{constructor(t,e,s,n){super(n),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:dt,NAME:_t}=c;class pt extends ot{constructor(t){super(t,dt.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new mt(this,t,e);const s=await this._run(_t.QUESTIONS,t,e);return new mt(this,s,e)}async _questions(t,e){return this._run(_t.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${_t.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(_t.RELATED_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(_t.SEARCH,t,e);return s.question_id?new ft(this,s,e):s}async _searchGet(t,e){return this._run(`${_t.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(_t.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(_t.SEARCH_AUTOCOMPLETE,t,e)}}class mt extends ht{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class ft extends ht{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),m(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:gt,NAME:yt}=c;class bt extends ot{constructor(t){super(t,gt.SEARCH)}async search(t,e){return this._run(yt.SEARCH,t,e)}async autocomplete(t,e){return this._run(yt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(yt.MGET,t,e)}}const{GROUP:wt,NAME:vt}=c;class Et extends ot{constructor(t){super(t,wt.RECOMMENDATION)}async userToProducts(t,e){return this._run(vt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(vt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(vt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(vt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(vt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(vt.PRODUCT_TO_PRODUCTS,t,e)}}class St extends tt{constructor(t,e){super("api",t),this._client=t,this.helpers=new rt(t,e),this.interactions=new ut(this),this.ask=new pt(this),this.search=new bt(this),this.recommendation=new Et(this)}}var kt=Object.freeze({__proto__:null,Api:St,ApiBase:ot,ApiHelpers:rt,Interactions:ut,Ask:pt,Search:bt,Recommendation:Et});class Ot extends tt{constructor(t){super("context",t),this._client=t}}var It={api:kt,context:{Context:Ot}};class Tt{constructor(t){m(this,{install:t})}}class At extends et{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new xt(this,It),this.plugins=new Ct(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new N);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return m(n,{id:t}),this._tryConfig(n,e),n;case"function":return new Tt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,r=t.lastIndexOf("/",i)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,i);return`${t.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new Y).get(s);!this.isRegistered(t)&&this.register(n)}}class xt{constructor(t,e){p(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),m(this,{classes:e})}}class Ct{constructor(t){p(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Rt=new class extends tt{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new At(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=i,this._cmdRes=new N}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Nt=Object.freeze({__proto__:null,viewable:O,debounce:D});const{currentScript:$t}=document;class Pt extends tt{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Pt),window.MisoClient?window.MisoClient!==Pt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Pt}static debug(){}constructor(t){super("client",Rt),this._config(t),this.context=new Ot(this),this.api=new St(this,Rt),function(t){Rt._clients.push(t),Rt._events.emit("create",t)}(this)}get version(){return Pt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,d(t)}_readConfigFromScriptUrl(){return d({apiKey:new URL(new Request($t.src||$t.href).url).searchParams.get("api_key")||void 0})}}Pt.helpers=Nt,m(Pt,{uuid:T()});var qt=function(t){const e=Rt._pluginRoot;return Rt.MisoClient=e.MisoClient=t,p(t,Rt,["version","instances","any","meta","on","once","cmdDone"]),p(t,e,["plugins"]),t}(Pt);const{GROUP:Lt,NAME:Ut}=c;let jt;class Dt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||jt||(jt=A("miso_anonymous_id",T))}set anonymous_id(t){t=h(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=h(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Mt(){const t=new URLSearchParams(window.location.search);let e=d({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class zt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Ft(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:i};return s.uuid||(s.uuid=T()),{...t,context:{...e,custom_context:s}}}const Bt="std:native-fetch";let Qt,Gt;const Wt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Qt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Qt="borrowed",t.contentWindow.fetch}catch(t){Gt=t}})();const Ht="miso-logdump",Kt="miso-logdump",Vt=Kt+"__download-btn",Yt="Miso Log";class Zt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return ee||(ee=L(U("logdump")))}();let t=document.getElementById(Ht);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Yt,e.classList.add(Vt),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Ht,t.classList.add(Kt),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Ht),e=t&&t.querySelector("."+Vt);e&&(e.textContent=this._options.logDownloadButtonText||Yt)}hideDownloadButton(){const t=document.getElementById(Ht);t&&(t.style.display="none")}download(){const t=new Blob([Xt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Jt()})}return t&&"string"==typeof t?t:`miso-log.${Jt()}.jsonl`}clear(){this._logs=[]}}function Jt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Xt(t){return t.map((t=>JSON.stringify(M(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),te(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function te(t){return t?M(t,{depth:2}):t}let ee;const se="std:debug";function ne(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function ie(t,e){return Object.freeze({...t,...e,members:re(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function re(t=[],e=[]){return[...new Set([...t,...e])]}function oe(t,e){let s={};for(const n of t)n&&(s=e(s,n));return d(s)}function ae(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function ce(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...ue("_meta",s,n)})});var s,n}))}function ue(t,e,s){const n=e&&e[t],i=s&&s[t],r=n?i?{...n,...i}:n:i;return void 0!==r?{[t]:r}:{}}qt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Zt(t)}static get id(){return se}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(se,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(ne)):this._log(t,e,ne(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Bt}install(t,e){Wt?(e.setCustomFetch(Wt),t.debug(`<plugin:${Bt}>`,"[info]",`Using ${Qt} native fetch`)):t.debug(`<plugin:${Bt}>`,"[error]","Failed to obtain native fetch: "+Gt.message)}}),qt.plugins.use(class extends tt{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Dt(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return e===Lt.INTERACTIONS&&s===Ut.UPLOAD?this._modifyPayloadForInteractions(t,n):e===Lt.ASK&&s===Ut.QUESTIONS?this._modifyPayloadForAsk(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=d({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),qt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...d({page:d({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Mt()}),...t.context}})))}}}),qt.plugins.use(class extends tt{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new zt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===o.SEARCH)if(s===a.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),qt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Ft)}}}),qt.plugins.use(class extends tt{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case o.SEARCH:case o.RECOMMENDATION:return!0}return!1}});const le="data-miso-product-id",he="default",de="_organic",_e=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),pe=new Set([_e.PRODUCTS,_e.CATEGORIES,_e.ATTRIBUTES,_e.RESULTS,_e.ITEMS,_e.QUESTION,_e.ANSWER,_e.SOURCES,_e.RELATED_RESOURCES,_e.QUERY_SUGGESTIONS,_e.RELATED_QUESTIONS,_e.AFFILIATION,_e.FACETS,_e.TOTAL]);function me(t){return pe.has(t)}const fe=new Set([_e.PRODUCTS,_e.SOURCES,_e.RELATED_RESOURCES]);const ge=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ye=[ge.IMPRESSION,ge.VIEWABLE,ge.CLICK,ge.SUBMIT,ge.FEEDBACK],be=[ge.IMPRESSION,ge.VIEWABLE,ge.CLICK],we=new Set(be);const ve=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Ee=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function Se(t){if(0>ye.indexOf(t))throw Error("Unrecognized event type: "+t)}const ke=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function Oe(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function Ie(t){if(void 0===t)return;let[e,s]=l(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function Te(t,e){return!1===(e=Ie(e))[0]?e:t&&e?[e[0]||t[0],Ae(t[1],e[1])]:e||t}function Ae(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const xe=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Ce(t={}){t=ae(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Re(e);return t}function Re(t={}){return t=ae(t)}function Ne(t={},e={}){const s={...t};for(const[n,i]of Object.entries(e))void 0!==i&&(s[n]=ye.includes(n)?$e(t[n],i):i);return s}function $e(t={},e={}){return{...t,...e}}const Pe=[{key:ke.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return d({group:s,name:t,payload:e})},merge:ce},{key:ke.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${_e.PRODUCTS}: ... }) instead`),t={...s,[_e.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[Oe(e)]=Ie(s);return n},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=Te(t[s],n);return t}))}},{key:ke.DATA_PROCESSOR,normalize:function(t){t=l(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:ke.TRACKERS,normalize:function(t={}){t=ae(t);const{active:e,...s}=t,n={};for(const[t,e]of Object.entries(s))n[t]=Ce(e);return{active:e,...n}},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{for(const[s,n]of Object.entries(e))void 0!==n&&(t[s]="active"===s?n:Ne(t[s],n));return t}))}},{key:ke.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=l(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:ke.FILTERS,normalize:ae,merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>Object.assign(t,e)))}},{key:ke.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&oe(t,((t,e)=>Object.assign(t,e)))}}];class qe{constructor(){this._events=new J({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Le{constructor(t={},e={}){this._events=new J({target:this}),this._defaults=e,this._context=t||{},this._locals={},m(this,{resolved:new Ue(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ue{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,n=s._context[t];this._cache[t]=e(s._defaults[t],n&&n.get(),s._locals[t])}return this._cache[t]}}class je{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Pe){const{key:e,normalize:s,merge:n}=t;Object.defineProperty(qe.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new je(this,this._globals,e,s,n))}}),Object.defineProperty(Le.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new je(this,this._locals,e,s,n))}}),Object.defineProperty(Ue.prototype,e,{get:function(){return this._get(t)}})}const De=[ke.API,ke.LAYOUTS,ke.DATA_PROCESSOR,ke.TRACKERS,ke.INTERACTIONS];function Me(t,e=De){for(const s of e)ze(t,s)}function ze(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}class Fe extends tt{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new qe}}function Be(t){return t?"view:"+t:"view"}Me(Fe.prototype);class Qe{constructor(){(this._events=new J)._injectSubscribeInterface(this),this._states={},m(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class Ge{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:T(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function We(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class He{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},r=await this._source({session:e,...t,options:i});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:n,value:r._response}),r)){if(!We(this._hub,e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){We(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ke{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{u(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Ve,VIEWABLE:Ye,CLICK:Ze}=ge,{UNTRACKED:Je,TRIGGERED:Xe}=ve,ts=Object.freeze({[Ve]:Je,[Ye]:Je,[Ze]:Je});class es{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:ts}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Je}set(t,e,s){Se(e),function(t){if(t!==ve.UNTRACKED&&t!==ve.TRACKING&&t!==ve.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of l(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Xe))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...ts}))))[e]=s}}const ss=[Symbol("itemless")];class ns{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new es(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){Se(t);const{options:n}=this;if(!n)return;this._syncSession();const{deduplicated:i=!0,itemless:r=!1}=n;if(i){if(r&&(e=ss),0===(e=this._states.untriggered(l(e),t)).length)return;this._states.set(e,t,ve.TRIGGERED)}this._sendToHub({type:t,items:r?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:ge.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(d({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new es(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[Be(this._role)]}}for(const t of be)ns.prototype[t]=function(e,s){this._trigger(t,e,s)};class is{constructor(t,e){this._events=new J({target:this}),this._views=t,this._mapping=function(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}((t._roles.mappings||{})[e]||e),m(this,{role:e,interface:new rs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ke((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===_e.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new ns({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((i=e)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=e,d={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...os(e)},_=(t={},e)=>{!1!==t&&this.updateState({...d,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:_})}catch(t){this._error(t),_({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?Ee.ERRONEOUS:t.status;t=this._state=Object.freeze(d({...t,status:s}));const{role:n}=this;this.hub.update(Be(n),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:n,meta:i,...r}=t,o={value:this._mapping(t,this),status:n,data:e,meta:i,...r};return this.role===_e.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(e)}),d(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!me(s))return!1;let e=t&&t[s];if(s===_e.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class rs{constructor(t){p(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function os(t){return function(t){return t.status===Ee.READY&&!t.ongoing}(t)?{empty:!!as(t)}:{}}function as(t){const{value:e}=t;return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}function cs(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class us{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new J({target:this,error:s}),m(this,{facets:new ls(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return d({facets:Object.freeze({}),sort:cs(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(d({...t,...e,facets:Object.freeze(d({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset(){const t=this.states;this._states=void 0;const e=this._getStates();this._events.emit("reset",{states:e,oldStates:t})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ls{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const hs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ds(t,e){return!!e&&{...t,...e}}class _s{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i,options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new us(this);for(const t of i.members)t!==_e.CONTAINER&&(this._views[t]=new is(this,t));m(this,{interface:new ps(this),trackers:new ms(this,i.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on("data",(t=>this.refresh({data:t}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new is(this,_e.CONTAINER);e.layout=this._createLayout(_e.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===_e.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:n}=e._inst;t&&(s=s.filter((e=>e.role===_e.CONTAINER||t.includes(e.role)))),n&&(s=s.filter((t=>!n.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return d({...hs,...i,impression:ds(hs.impression,e),viewable:ds(hs.viewable,s),click:ds(hs.click,n)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=_e.CONTAINER;this._containerTracker=new ns({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class ps{constructor(t){this._actor=t,p(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class ms{constructor(t,e){this._views=t;for(const s of e)s!==_e.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,_e.CONTAINER,{get:()=>t._getContainerTracker()})}}class fs{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:ge.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class gs{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=l(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ys(t){return async({group:e,name:s,payload:n,options:i})=>{if(e===o.ASK)switch(s){case a.QUESTIONS:return t.api.ask.questions(n,i);case a.SEARCH:return t.api.ask.search(n,i)}return t.api[e]._run(s,n,i)}}class bs{constructor({role:t,workflow:e,...s}={}){m(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=C(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,k((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),r=C([]),o=C({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ws(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function vs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||ks)(t,e,s)+(i.descriptionBlock||Is)(t,e,s)+(i.priceBlock||As)(t,e,s)+(i.ctaBlock||Ns)(t,e,s)}</div>`}function Es(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||ks)(t,e,s)+(i.descriptionBlock||Is)(t,e,s)+(i.priceBlock||As)(t,e,s)}</div>`}function Ss(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||ks)(t,e,s)+(i.dateBlock||Ts)(t,e,s)+(i.descriptionBlock||Is)(t,e,s)+(i.ctaBlock||Ns)(t,e,s)}</div>`}function ks({className:t},{title:e}){return e?`<div class="${t}__item-title">${I(e)}</div>`:""}function Os({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Is({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${I(s)}</div>`:""}function Ts({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${t}__item-date">${Ls(r,e.date)}</div>`:""}function As(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:r,currency:o="USD"}=e,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,u=e.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||xs)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function xs(t,{discount_rate_percent:e}){return`(${e}% off)`}function Cs(t,e,s={}){const{className:n,templates:i}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${n}__item-cover-image-container">${`<img class="${n}__item-cover-image" src="${r}">`}${s.brand?(i.brandBlock||Os)(t,e,s):""}</div>`}function Rs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Ns(t,e,s){const{className:n,templates:i}=t,r=Us.asFunction(i.cta)(t,e,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function $s({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&n?"a":"div";return[`<${l} class="${t}__${i}" ${r?`data-role="${r}"`:""} ${s?`${le}="${s}"`:""} ${!1!==o.link&&n?`href="${n}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const Ps=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),qs="en-US";function Ls(t,e=Ps){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Ps.locale,e);default:throw Error("Invalid date format: "+e)}}const Us=Object.freeze({tagPair:$s,formatDate:Ls,formatNumber:function(t,e=qs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||qs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:I,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class js extends bs{constructor({className:t,templates:e,...s}={}){super(s),m(this,{className:t,templates:{...ws("root"),...e,helpers:Us}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Ds extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ds.MisoClient.ui.layouts.create("banner").render(this)}}class Ms{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await O(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class zs extends bs{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ms}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Ds.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===_e.PRODUCTS||t===_e.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1}={}}=e,o=[s,r?Ee.EMPTY:Ee.NONEMPTY];s===Ee.READY&&o.push(n?Ee.ONGOING:Ee.DONE),t.setAttribute("status",o.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===Ee.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Fs=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:r}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Bs extends js{static get type(){return"error"}static get defaultTemplates(){return Fs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Fs,...e},...s})}}const Qs=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Gs(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class Ws{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});n.set(a,u),i.set(c,u),r.push(u)}return{k2b:n,e2b:i,entries:r}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Gs(i,n),o=Gs(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function Hs(t){F(t,Ks.prototype)}class Ks{_initTrackable(){this._bindings=new Ws,this._viewables=new Ms}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!E(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class Vs{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===Ee.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let n=!1;try{await O(e,{area:1,duration:0,signal:s.signal}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Ys=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[r,o]=$s(t,s);return""+r+(i.imageBlock||Cs)(t,s,n)+(i.infoBlock||i.productInfoBlock||Es)(t,s,n)+o},article:function(t,e,s,n){const{templates:i}=t,[r,o]=$s(t,s);return""+r+(i.imageBlock||Cs)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Ss)(t,s,n)+(i.indexBlock||Rs)(t,s,n)+o},question:function(t,e,s){const[n,i]=$s(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e;return`<div class="${s} ${r}" ${n?`data-role="${n}"`:""}>${r===Ee.READY?i[r](t,e):""}${i.trigger(t,e)}${i.loading(t,e)}</div>`},[Ee.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0||e.ongoing?s.list(t,e,n):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:n,templates:i,options:r}=t,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list" data-item-type="${r.itemType}">${i.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let r=n;return s.map((s=>i.item(t,e,s,r++))).join("")},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item">${r[a](t,e,s,{index:n})}</li>`},productInfoBlock:Es,articleInfoBlock:Ss,brandBlock:Os,titleBlock:ks,descriptionBlock:Is,dateBlock:Ts,priceBlock:As,discountRateText:xs,ctaBlock:Ns,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[r,o]=$s(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Us.asFunction(n.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Cs,indexBlock:Rs,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Zs extends js{static get defaultTemplates(){return Ys}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Ys,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Hs(Zs.prototype),F(Zs.prototype,Vs.prototype);const Js="miso-list";class Xs extends Zs{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Js}constructor({className:t=Js,...e}={}){super({className:t,...e})}}const tn="miso-cards";const en="miso-carousel",sn=Object.freeze({ready:function(t,e){const{templates:s}=t,n=t._getItems(e),i=n&&n.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-previous" data-role="previous">${i.previous(t,e)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(t,e)}</div>`},previous:rn,next:rn}),nn=Object.freeze({...Zs.defaultTemplates,...sn});function rn(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const on="miso-ui-icon",an=on+"-svg-1_11_4",cn={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},un=`<symbol id="${on}-${cn.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ln=`<symbol id="${on}-${cn.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,hn=`<symbol id="${on}-${cn.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,dn=`<svg id="${an}" style="display:none;">${[un,ln,hn].join("")}</svg>`;let _n=!1;function pn(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${on}-${t}"></use></svg>`}_n||document.head.querySelector("#"+an)||(_n=!0,document.head.insertAdjacentHTML("beforeend",dn));const mn=new Set(Object.values(cn));pn(cn.SEND),pn(cn.SEARCH);const fn=pn(cn.TRIANGLE),gn="miso-search-box";const yn=Object.freeze({root:function(t){const{className:e,templates:s,role:n,options:i,autocomplete:r}=t,{placeholder:o}=i;return`\n<div class="${e}" ${n?`data-role="${n}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=e;var r;return("function"==typeof n?n(t):""+n)+("function"==typeof i?i(t):(mn.has(r=i)?pn(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__${e}-list" data-role="${e}-list">${s.map((s=>i.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||I(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=s.helpers.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:Cs,productInfoBlock:Es}),bn=Object.freeze({className:"miso-autocomplete",debounce:300});class wn extends js{static get type(){return"search-box"}static get defaultTemplates(){return yn}static get defaultClassName(){return gn}constructor({className:t=gn,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...yn,...e},...n}),m(this,{autocomplete:{...bn,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=D(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=Ee.INITIAL,session:r,value:o}=e.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(t),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);t.classList[l.length>0?"add":"remove"]("nonempty"),u.setAttribute("data-status",i),u.innerHTML=this.templates.completions(this,l),n({completions:{index:a,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return vn.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new vn(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&E(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ge.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class vn{static empty(){return vn._empty||(vn._empty=new vn)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const r of t[i])r.product&&!r.product.url||(r._index=e,r._field=i,s.set(e,r),n.push(r),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const En="miso-option-list";const Sn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${I(e.text||e)}</li>`}});class kn extends js{static get type(){return"option-list"}static get defaultTemplates(){return Sn}static get defaultClassName(){return En}constructor({className:t=En,templates:e,...s}={}){super({className:t,templates:{...Sn,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncOptionValues(t,n)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const n=this._getItems(e)||[];s.classList[0===n.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._submit(n.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}Hs(kn.prototype);const On=Object.freeze({...ws("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class In extends js{static get defaultTemplates(){return On}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...On,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=E(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],k((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Tn="miso-feedback",An=["helpful","unhelpful"];const xn=Object.freeze({options:function(t){const{templates:e}=t;return An.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Cn extends In{static get type(){return"feedback"}static get defaultTemplates(){return xn}static get defaultClassName(){return Tn}constructor({className:t=Tn,templates:e,...s}={}){if(super({className:t,templates:{...xn,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Rn="miso-text";const Nn=Object.freeze({root:function(t,{value:e}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=t,o=n?`data-role="${n}"`:"",a=void 0!==e?I(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:n}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[i,r]=e;switch(i){case"date":return t=>s(t,r);case"number":return t=>n(t,r);default:return t=>""+t}}(t)(e)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class $n extends js{static get type(){return"text"}static get defaultTemplates(){return Nn}static get defaultClassName(){return Rn}constructor({className:t=Rn,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...Nn,...e},tag:s,...n})}}class Pn extends bs{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=C(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class qn{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function Ln(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,Un(e)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||Ee.INITIAL),n}function Un(t){return t+"__cursor"}function jn(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${Dn(n[0])}, ${Dn(n[1])})`,e,""+r,i,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function Dn(t){return Math.floor(100*t)/100+"ms"}const Mn="miso-typewriter";class zn extends Pn{static get type(){return"typewriter"}static get defaultClassName(){return Mn}constructor({className:t=Mn,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:n,...a}),m(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:W({speed:i,acceleration:r}),this._readiness=new N,"markdown"===s&&zn.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=Un(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:jn(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new qn}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==Ee.READY||o?void 0:Date.now());return this._prevState=Object.freeze(d({session:i,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=Ln(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}i(a);const u=e.status===Ee.READY&&!a.done;n({ongoing:u},{silent:u&&(!s||s.status===Ee.READY)&&!c}),u&&r()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{index:t}))}const n=e.closest("a");if(n){if(!t.defaultPrevented){const{href:t,innerText:e,className:s}=n;t&&this._view._events.emit("link-click",d({url:t,text:e?e.trim():"",className:s||"",attributes:Fn(n)}))}}else;}}function Fn(t){const{attributes:e}=t,s={};for(const{name:t,value:n}of e)t.startsWith("data-")&&(s[t]=n);try{return JSON.stringify(s)}catch(t){return"{}"}}const Bn="miso-affiliation";const Qn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e,o=n?` data-role="${n}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===Ee.READY?i[r](t,e):""}</div>`},[Ee.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return fn},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(t,e,s,{index:n})}${r[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=Us.asFunction(o)(t,e,s,n),a=Us.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[r,o]=$s(t,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||vs)(t,s,n)+(i.imageBlock||Cs)(t,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:r}=t,o=Us.asFunction(r.logoText)(t,e,s,n)||"",a=Us.asFunction(r.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:r}=t,o=Us.asFunction(r.logoUrl)(t,e,s,n);if(!o)return"";const a=Us.asFunction(r.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Gn=Object.freeze({...Zs.defaultTemplates,...Qn});class Wn extends Zs{static get type(){return"affiliation"}static get defaultTemplates(){return Gn}static get defaultClassName(){return Bn}constructor({className:t=Bn,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...Qn,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new st(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,k((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(this._displayedCount=s,void 0===s?n.removeAttribute("data-item-count"):n.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const Hn="miso-facets",Kn="miso-facet",Vn="custom_attributes.";const Yn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:n={}}=e.value||{};return Object.keys(n).map((i=>s.facet(t,{field:i,entries:n[i]},e)))},facet:function(t,e,s){const{facetClassName:n=Kn,templates:i}=t,{field:r}=e;return`<div class="${n}" data-role="facet" data-field="${I(r)}">${i.header(t,e,s)}${i.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:n=Kn,templates:i}=t;return`<div class="${n}__header">${i.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(Vn)&&(e=e.substring(18)),I(e)},options:function(t,{field:e,entries:s},n){const{facetClassName:i=Kn,templates:r}=t;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(t,{field:e,value:s,count:i},n))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:n=Kn,templates:i}=t;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(t,e,s)}</span>\n  <span class="${n}__count">${i.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return I(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function Zn(t,e){return`${t}:::${e}`}function Jn(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class Xn extends js{static get type(){return"facets"}static get defaultTemplates(){return Yn}static get defaultClassName(){return Hn}constructor({className:t=Hn,templates:e,...s}={}){super({className:t,templates:{...Yn,...e},...s}),this._bindings=new Ws}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=Jn(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)this._setSelected(n,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=Jn(t.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)e[t]&&this._setSelected(n,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),n=[],i=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;n.push(Zn(t,c)),i.push({field:t,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[I(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const ti="miso-select";const ei=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,r=n?`data-role="${n}"`:"",o=t._getItems(e),a=o.find((t=>t.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(t,a)}\n  ${i.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:n}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:n}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>n.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:n}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${n.text(t,e)}</li>`},text:function(t,e){return I(e&&e.text&&e.text.replace(/[-_][a-zA-Z]/g," $1")||e||"")}});class si extends js{static get type(){return"select"}static get defaultTemplates(){return ei}static get defaultClassName(){return ti}constructor({className:t=ti,templates:e,...s}={}){super({className:t,templates:{...ei,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}Hs(si.prototype);const ni="miso-more-button";const ii=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${e.status!==Ee.READY?" disabled":""}>\n  ${i.text(t)}\n</div>\n`},text:function(t){return"More"}});class ri extends js{static get type(){return"more-button"}static get defaultTemplates(){return ii}static get defaultClassName(){return ni}constructor({className:t=ni,templates:e,...s}={}){super({className:t,templates:{...ii,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var oi=Object.freeze({__proto__:null,TemplateBasedLayout:js,ContainerLayout:zs,ErrorLayout:Bs,BannerLayout:class extends js{static get type(){return"banner"}static get defaultTemplates(){return Qs}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Qs,...e},...s})}},CollectionLayout:Zs,ListLayout:Xs,CardsLayout:class extends Zs{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return tn}constructor({className:t=tn,...e}={}){super({className:t,...e})}},CarouselLayout:class extends Zs{static get type(){return"carousel"}static get defaultTemplates(){return nn}static get defaultClassName(){return en}constructor({className:t=en,templates:e,...s}={}){super({className:t,templates:{...sn,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:n}=e,i=this._getItems(n);this._itemCount=i?i.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:wn,OptionListLayout:kn,FeedbackLayout:Cn,TextLayout:$n,TypewriterLayout:zn,AffiliationLayout:Wn,FacetsLayout:Xn,SelectLayout:si,MoreButtonLayout:ri});function ai(t){return t&&t.value&&t.value.revision}function ci(t){const e=function(t){if(!t)return Ee.INITIAL;const{request:e,error:s,value:n}=t;return s?Ee.ERRONEOUS:n?Ee.READY:e?Ee.LOADING:Ee.INITIAL}(t);return d({status:e,ongoing:e===Ee.READY?t.ongoing:void 0,...t})}function ui(t){const{request:e,value:s}=t;if(!e)return t;const{payload:n}=e||{},{q:i}=n||{};return i?{...t,value:{...s,keywords:i}}:t}function li(t){const{role:e,type:s,items:n}=t,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:d({property:e})}};switch(function(t){return we.has(t)}(s)&&(!function(t){return fe.has(t)}(e)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((t=>t.text||t.id||t))):i.product_ids=(n||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case ge.SUBMIT:i.context.custom_context.value=t.value;break;case ge.FEEDBACK:i.context.custom_context.value=i.value=t.value,i.context.custom_context.result_type=i.result_type=t.result_type}return d(i)}function hi(t={},e={}){return d({...t,...e,context:d({...t.context,...e.context,custom_context:d({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const di=Object.freeze({}),_i=Object.freeze({[_e.CONTAINER]:zs.type,[_e.ERROR]:Bs.type}),pi=Object.freeze({}),mi=Object.freeze({api:di,layouts:_i,trackers:pi}),fi=Object.freeze({mappings:{[_e.ERROR]:t=>t.error}});class gi extends tt{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:n,defaults:i,options:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,t=Object.freeze({...t,plugin:s,client:n}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=r||new Le(e&&e._options,i),this._hub=function(t,e){const{update:s,trigger:n}=t;return t.update=(n,i,r)=>(r&&r.silent||e("update",n,i,r),s.call(t,n,i,r)),t.trigger=(...s)=>(e("trigger",...s),n.apply(t,s)),t}(new Qe,((...t)=>this._log(...t))),this._sessionContext=new WeakMap,this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({name:t,roles:e}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new Ge(s),this._data=new He(s,{source:ys(n),options:i}),this._views=new _s(s,{extensions:r,layouts:o,roles:e,options:i,workflow:t}),this._interactions=new gs(s,{client:n,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(Be(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[Be(t)]||{};e.session&&e.status===Ee.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===Ee.READY,n=e===Ee.ERRONEOUS;this._emitLifecycleEvent(n?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||n)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(t);return n.add(t),!i}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=ce(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=ai(t);if(!_(s)){const t=ai(this._hub.states.data);if(!_(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=ci(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:Ee.READY,session:this.session,...e},this._hub.update(Be(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=li(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)e=n(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==_e.AFFILIATION)return t;const{items:s}=e;return hi(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return hi(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[Be(e.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?hi(t,{miso_id:n}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}}function yi(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:bi(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function bi({products:t,...e}){return{channel:"sovrn",...e,products:t.map(wi)}}function wi({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return d({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:vi({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function vi(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const r=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...vi(i,r)}:{...s,[r]:i}}),{})}function Ei(t){F(t,Si.prototype)}Me(gi.prototype),Object.assign(gi,{DEFAULT_API_OPTIONS:di,DEFAULT_LAYOUTS:_i,DEFAULT_TRACKERS:pi,DEFAULT_OPTIONS:mi,ROLES_OPTIONS:fi});class Si{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=e;else{window.open(e,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl(t){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t.q)}}const ki=Object.freeze({...gi.DEFAULT_API_OPTIONS,group:o.ASK,payload:{...gi.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Oi=Object.freeze({actor:!1,api:{group:o.ASK,name:a.AUTOCOMPLETE}}),Ii=Object.freeze({...gi.DEFAULT_LAYOUTS,[_e.QUERY]:[wn.type,{placeholder:"Ask a question"}],[_e.QUESTION]:[$n.type,{tag:"h2"}],[_e.ANSWER]:zn.type,[_e.FEEDBACK]:Cn.type,[_e.SOURCES]:[Xs.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[_e.AFFILIATION]:[Wn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Ti=Object.freeze({...gi.DEFAULT_TRACKERS,[_e.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:xe.click},[_e.SOURCES]:xe,[_e.AFFILIATION]:xe,[_e.PRODUCTS]:xe}),Ai=Object.freeze({...gi.DEFAULT_OPTIONS,api:ki,autocomplete:Oi,layouts:Ii,trackers:Ti}),xi=ie(gi.ROLES_OPTIONS,{main:_e.ANSWER,members:Object.keys(Ii)});class Ci extends gi{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new fs(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(_e.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(_e.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[Be(this._roles.main)]||{};t.session&&t.status!==Ee.INITIAL&&(t.status!==Ee.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,n=e===Ee.READY&&!t.ongoing,i=e===Ee.ERRONEOUS,r=n?"done":i?"error":e,o=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,t),(n||i)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){const{setValue:e,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:t=!0,focus:e=!0,param:s="q",sourceParam:n="qs",...i}={}){return{setValue:t,focus:e,param:s,sourceParam:n,...i}}(t),r=new URLSearchParams(window.location.search),o=r.get(n),a=r.get(i),{layout:c}=this._views.get(_e.QUERY);c&&(o&&e&&(c.value=o),!o&&s&&c.focus()),o&&this.query({q:o,qs:a})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||de}_buildPayload(){throw Error("Not implemented")}_updateData(t){!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){this._writeQuestionIdFromData(t)}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:yi(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){if(!t)return;const{question_id:e}=t;this._writeQuestionId(e)}_updateUrlIfNecessary({value:t,request:e}){if(!t||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{param:s}=this._autoQuery,{question:n}=t,i=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source===de,r=new URL(window.location);n===r.searchParams.get(s)||i&&!0!==this._autoQuery.updateUrl||(r.searchParams.set(s,n),window.history.replaceState({},"",r))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=this._writeAnswerClickInteraction(t,e)}_writeAskPropertiesToInteraction(t={},e){return hi(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==_e.ANSWER)return t;console.log("writeAnswerClickInteraction",t,e);const{items:s=[]}=e;return hi(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[Be(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t}){const{value:e}=this.states.data||{},{sources:s}=e||{},n=s&&s[t-1];n&&n.product_id&&this._views.trackers.sources.click([n.product_id])}_onAnswerLinkClick(t){this._views.trackers.answer.click([],{items:[t]})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Ei(Ci.prototype),Object.assign(Ci,{DEFAULT_API_OPTIONS:ki,DEFAULT_AUTOCOMPLETE_OPTIONS:Oi,DEFAULT_LAYOUTS:Ii,DEFAULT_TRACKERS:Ti,DEFAULT_OPTIONS:Ai,ROLES_OPTIONS:xi});const Ri=Object.freeze({...Ci.DEFAULT_API_OPTIONS,name:a.QUESTIONS,payload:{...Ci.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Ni=Object.freeze({...Ci.DEFAULT_LAYOUTS,[_e.QUERY]:[wn.type,{templates:{buttonIcon:"send"}}],[_e.RELATED_RESOURCES]:[Xs.type,{incremental:!0,itemType:"article"}],[_e.QUERY_SUGGESTIONS]:kn.type}),$i=Object.freeze({...Ci.DEFAULT_TRACKERS,[_e.RELATED_RESOURCES]:xe,[_e.QUERY_SUGGESTIONS]:{...xe,click:{...xe.click,validate:t=>0===t.button}}}),Pi=Object.freeze({...Ci.DEFAULT_OPTIONS,api:Ri,layouts:Ni,trackers:$i}),qi=ie(Ci.ROLES_OPTIONS,{members:Object.keys(Ni)});class Li extends Ci{constructor(t,e){super({name:"ask",context:t,roles:qi,defaults:Pi,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;m(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states.data.value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:n}=this;return d({...s,question:t,parent_question_id:n,_meta:{...s._meta,question_source:e||de}})}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let n,i,r,{property:o}=t.context&&t.context.custom_context||{};return e.role===_e.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(e)),hi(t,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class Ui extends Fe{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Li(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Li(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const ji=Object.freeze({...gi.DEFAULT_API_OPTIONS,group:o.SEARCH,payload:{...gi.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Di=Object.freeze({...gi.DEFAULT_LAYOUTS,[_e.QUERY]:[wn.type],[_e.PRODUCTS]:[Xs.type,{incremental:!0,infiniteScroll:!0}],[_e.KEYWORDS]:[$n.type,{raw:!0}],[_e.TOTAL]:[$n.type,{raw:!0,format:"number"}],[_e.FACETS]:[Xn.type],[_e.SORT]:[si.type],[_e.MORE]:[ri.type]}),Mi=Object.freeze({...gi.DEFAULT_TRACKERS,[_e.PRODUCTS]:xe}),zi=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Fi=Object.freeze({...gi.DEFAULT_OPTIONS,api:ji,layouts:Di,trackers:Mi,pagination:zi}),Bi=ie(gi.ROLES_OPTIONS,{main:_e.PRODUCTS,members:Object.keys(Di),mappings:{[_e.FACETS]:"facet_counts",[_e.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=e.states.filters||{},r=i&&i.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(n).field;return r?n.map((t=>({...t,selected:t.field===r}))):n}}});class Qi extends gi{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(_e.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==Ee.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:n}=e||{};return d({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const n=t[s];n&&n.length&&(e[s]={terms:n})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return l(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},n=s.map((t=>t.product_id)).filter((t=>t)),i=[...t.exclude||[],...n];return 0===i.length?t:{...t,exclude:i}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:n}=t;switch(s){case Ee.INITIAL:case Ee.LOADING:break;default:return t}return n&&n.facet_counts?t:{...t,value:{...n,facet_counts:e}}}(t=ui(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=_e.PRODUCTS}={}){const{status:s,request:n,value:i}=t;if(s!==Ee.READY||!n||!i)return t;const{[e]:r}=i;if(!r)return t;const{rows:o}=n.payload,{length:a}=r;return o>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=_e.PRODUCTS}={}){if(!e.value)return t;const{[s]:n=[],facet_counts:i,total:r}=t.value,{[s]:o=[]}=e.value;return{...e,facet_counts:i,total:r,value:{...e.value,[s]:[...n,...o]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}Me(Qi.prototype,[ke.PAGINATION,ke.FILTERS]),Object.assign(Qi,{DEFAULT_API_OPTIONS:ji,DEFAULT_LAYOUTS:Di,DEFAULT_TRACKERS:Mi,DEFAULT_PAGINATION:zi,DEFAULT_OPTIONS:Fi,ROLES_OPTIONS:Bi});const Gi=Object.freeze({members:[]});function Wi({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function Hi(t){return t&&t.value&&t.value.trim()||void 0}class Ki extends gi{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:Wi(e),roles:Gi,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,Hi(t)===Hi(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!Hi(t))return void this._updateCompletions({session:s,status:Ee.INITIAL});const n=this._buildPayload(t);this._request({payload:n})}_buildPayload(t){return{q:Hi(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function Vi(t){F(t,Yi.prototype)}class Yi{_initAutocomplete(t){this._autocomplete=new Ki(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Zi=ie(Ci.ROLES_OPTIONS,{mappings:{[_e.QUESTION]:_e.KEYWORDS}});class Ji extends Ci{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Zi,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset(),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||de}}}_defaultProcessData(t){return t=ui(t=super._defaultProcessData(t))}_updateDataInHub(t){switch(t.status){case Ee.INITIAL:case Ee.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}Vi(Ji.prototype);const Xi={...Qi.ROLES_OPTIONS,members:[_e.PRODUCTS,_e.KEYWORDS,_e.TOTAL,_e.FACETS,_e.SORT,_e.MORE,_e.ERROR]};class tr extends Qi{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Xi,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:d({...t._meta,question_id:this._superworkflow._answer.questionId})}}}Object.assign(tr,{ROLES_OPTIONS:Xi});class er{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return tr.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,n=this._getSubviews(s);if(!n._containers.has(t)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(t)){for(const n of t.components)if(s.containsElement(n))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}n.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const sr=Object.freeze({group:o.ASK,name:a.SEARCH,payload:{...Ci.DEFAULT_API_OPTIONS.payload,...Qi.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),nr=Object.freeze({...Ci.DEFAULT_LAYOUTS,...Qi.DEFAULT_LAYOUTS,[_e.QUERY]:[wn.type,{placeholder:""}],[_e.QUESTION]:[$n.type,{raw:!0}]}),ir=Object.freeze({...Ci.DEFAULT_TRACKERS,...Qi.DEFAULT_TRACKERS}),rr=Object.freeze({...Qi.DEFAULT_PAGINATION,active:!0}),or=Object.freeze({api:{group:o.ASK,name:a.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),ar=Object.freeze({...Ci.DEFAULT_OPTIONS,...Qi.DEFAULT_OPTIONS,api:sr,layouts:nr,trackers:ir,autocomplete:or,pagination:rr}),cr=Object.freeze({main:_e.PRODUCTS,members:Object.keys(nr),mappings:Object.freeze({...Ci.ROLES_OPTIONS.mappings,...Qi.ROLES_OPTIONS.mappings})});class ur extends gi{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:cr,defaults:ar})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Ji(this),this._results=new tr(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){const t=this._hub,e=this._client,s=this._options;this._views=new er(this),this._interactions=new gs(t,{client:e,options:s})}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return this._answer._defaultProcessInteraction(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Me(ur.prototype,[ke.PAGINATION,ke.FILTERS]);const lr=Object.freeze({...gi.DEFAULT_API_OPTIONS,group:o.ASK,name:a.RELATED_QUESTIONS}),hr=Object.freeze({...gi.DEFAULT_LAYOUTS,[_e.RELATED_QUESTIONS]:[Xs.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[_e.QUERY]:[wn.type,{placeholder:"Ask a question"}]}),dr=Object.freeze({...gi.DEFAULT_TRACKERS,[_e.RELATED_QUESTIONS]:xe,[_e.CONTAINER]:{...xe,itemless:!0},[_e.QUERY]:{[ge.SUBMIT]:{active:!0}}}),_r=Object.freeze({...gi.DEFAULT_OPTIONS,api:lr,layouts:hr,trackers:dr}),pr=ie(gi.ROLES_OPTIONS,{main:_e.RELATED_QUESTIONS,members:Object.keys(hr)});class mr extends gi{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:pr,defaults:_r})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(_e.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=_e.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t},{generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage(t)}_getSubmitUrl(t,{generated:e=!1}={}){let s=Si.prototype._getSubmitUrl.call(this,t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}Ei(mr.prototype);const fr=Object.freeze({group:o.SEARCH,name:a.SEARCH,payload:{fl:["*"]}}),gr=Object.freeze({api:{group:o.SEARCH,name:a.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),yr=Object.freeze({...Qi.DEFAULT_LAYOUTS}),br=Object.freeze({...Qi.DEFAULT_TRACKERS}),wr=Object.freeze({...Qi.DEFAULT_OPTIONS,api:fr,autocomplete:gr,layouts:yr,trackers:br}),vr=Qi.ROLES_OPTIONS;class Er extends Qi{constructor(t,e){super({name:"search",plugin:t,client:e,roles:vr,defaults:wr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}autoQuery({setValue:t=!0,focus:e=!0,param:s="q"}={}){const n=new URLSearchParams(window.location.search).get(s),{layout:i}=this._views.get(_e.QUERY);i&&(n&&t&&(i.value=n),!n&&e&&i.focus()),n&&this.query({q:n})}notifyViewUpdate(t=_e.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._feedback._destroy(),this._destroyAutocomplete(),super._destroy(t)}}Vi(Er.prototype);const Sr=Object.freeze({...gi.DEFAULT_API_OPTIONS,group:o.RECOMMENDATION,name:a.USER_TO_PRODUCTS,payload:{...gi.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),kr=Object.freeze({...gi.DEFAULT_LAYOUTS,[_e.PRODUCTS]:Xs.type}),Or=Object.freeze({...gi.DEFAULT_TRACKERS,[_e.PRODUCTS]:xe}),Ir=Object.freeze({...gi.DEFAULT_OPTIONS,api:Sr,layouts:kr,trackers:Or}),Tr=ie(gi.ROLES_OPTIONS,{main:_e.PRODUCTS,members:Object.keys(kr)});class Ar extends gi{constructor(t,e){super({name:"recommendation",context:t,roles:Tr,defaults:Ir,id:e})}_initProperties(t){super._initProperties(t);const{id:e}=t;m(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}start(){return this._request(),this}notifyViewUpdate(t=_e.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return hi(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class xr extends Fe{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=he){if(this._members.has(t))throw Error("Unit already exists: "+t);return new Ar(this,t)}has(t=he){return this._members.has(t)}get(t=he){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new Ar(this,t)}}class Cr extends tt{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new N)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var Rr=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var Nr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class $r{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Pr{constructor(t){this._context=t,m(this,{lowerCamelToKebab:y,kebabToLowerCamel:f,kebabOrSnakeToLowerCamel:g})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=g(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:n=!1}){const{classPrefix:i}=t;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${e}-phrase">${this.phraseText(t,f(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,n=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${y(t)}="${n}"`)}return s}}const qr=B(new Pr({...Rr,DEFAULT_PHRASES:Nr})),Lr=B(new class extends $r{constructor(){super({helpers:qr})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=t;return n(t,{name:"related-resources"},!1===i.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:n={}}=t;return!1===n.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:qr}));function Ur(t={}){const{normalizeOptions:e,section:s,container:n}=qr,{querySuggestions:i,answerGroup:r}=Lr;return s(t=e(t),{name:"follow-up"},[i(t),n(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var jr=Object.freeze({__proto__:null,helpers:qr,sections:Lr,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=qr,{followUps:i,relatedResourcesSection:r,answerGroup:o}=Lr;return""+s(t=e(t),{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+i(t)+r(t)},followUp:Ur});const Dr=Object.freeze(Rr),Mr=Object.freeze(Nr),zr=Object.freeze(jr);var Fr=Object.freeze({__proto__:null,constants:Dr,phrases:Mr,templates:zr,wireFollowUps:function(t,e,{template:s=Ur,...n}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const i=t.ui.asks,r=t.ui.ask;i.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:Br}=document,Qr=Object.freeze({templates:zr,autostart:!0}),Gr=["templates","phrases","features"];class Wr{constructor(){this._defaults=Qr,this._scriptSrc=function(){if(!Br||!Br.src)return{};const t=document.createElement("a");t.href=Br.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Vr(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Vr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return d({apiKey:t,apiHost:e,templates:Yr(s),phrases:n,...i})}(Hr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Hr(...t){let e={};for(const s of t)s&&(e=Kr(e,s));return e}function Kr(t,e){if(!e)return t;Object.assign(t,e);for(const s of Gr)s in e&&(t[s]={...t[s],...e[s]});return t}function Vr(t){return""===t||"false"!==t&&t}function Yr(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Yr):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,Yr);default:throw Error("Unsupported template type: "+t)}}class Zr{constructor(t,{classPrefix:e=Dr.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");m(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Jr extends Cr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Wr,this._localOptions={}}config(t={}){t=Hr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;m(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Zr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Xr extends et{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let to,eo,so;async function no(t){const e=await async function(t){return t.MisoClient||window.MisoClient||to||(to=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return eo=eo||e.any(),so=so||await eo,so.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),so}const io="logo",ro="auto",oo=Object.freeze([io]);function ao(t){if(!t)return ro;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class co extends HTMLElement{static get observedAttributes(){return oo}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return ao(this.getAttribute(io))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case ro:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(io,e):this.removeAttribute(io)}async connectedCallback(){const t=this._client=await no(co);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===io)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){ao(t)!==ao(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const uo="parent-question-id",lo=Object.freeze([...co.observedAttributes,uo]);const ho="unit-id",_o=Object.freeze([...co.observedAttributes,ho]);var po=Object.freeze({__proto__:null,MisoAskElement:class extends co{static get tagName(){return"miso-ask"}static get observedAttributes(){return lo}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(uo)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(uo,t):this.removeAttribute(uo))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===uo)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends co{static get observedAttributes(){return co.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoHybridSearchElement:class extends co{static get observedAttributes(){return co.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends co{static get observedAttributes(){return co.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends co{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return _o}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(ho)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(ho,t):this.removeAttribute(ho)}attributeChangedCallback(t,e,s){if(t===ho)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const mo="role",fo=Object.freeze([mo]);class go extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return fo}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(mo);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${mo}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${mo}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===mo&&this._container&&this._container._updateComponentRole(this,e,s)}}var yo=Object.freeze({__proto__:null,MisoComponentElement:go,MisoQueryElement:class extends go{constructor(){super({role:_e.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends go{constructor(){super({role:_e.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends go{constructor(){super({role:_e.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends go{constructor(){super({role:_e.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends go{constructor(){super({role:_e.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends go{constructor(){super({role:_e.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends go{constructor(){super({role:_e.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends go{constructor(){super({role:_e.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends go{constructor(){super({role:_e.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends go{constructor(){super({role:_e.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends go{constructor(){super({role:_e.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends go{constructor(){super({role:_e.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends go{constructor(){super({role:_e.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends go{constructor(){super({role:_e.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends go{constructor(){super({role:_e.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends go{constructor(){super({role:_e.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends go{constructor(){super({role:_e.ERROR})}static get tagName(){return"miso-error"}}});class bo extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(bo.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var wo=Object.freeze({__proto__:null,containers:po,roles:yo,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends bo{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Ds});const vo="miso-hybrid-search-combo";var Eo=Object.freeze({__proto__:null,CLASS_PREFIX:vo,CONAINER_TAG:"miso-hybrid-search"});const So="Show more",ko="Show less";var Oo=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:So,showLess:ko});const Io=B(new Pr({...Eo,DEFAULT_PHRASES:Oo})),To=B(new class extends $r{constructor(){super({helpers:Io})}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Io}));var Ao=Object.freeze({__proto__:null,helpers:Io,sections:To,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=Io;t=e(t);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=To,{answerBox:a=!0}=t;return""+s(t,{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[i(t)]:r(t))+s(t,{name:"search-results"},o(t))}});const xo="answer-box-open",Co="answer-box-shown",Ro='[data-role="answer-box-toggle"]';class No{constructor(t,e,{classPrefix:s=vo,phrases:n={}}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=n,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(Ro)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer;switch(t){case Ee.ERRONEOUS:case Ee.READY:this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ko:this._phrases.showMore||So;for(const e of this._element.querySelectorAll(Ro))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const $o={isOpen:xo,shown:Co},Po={toggleOpen:["toggle",xo],open:["open",xo],close:["remove",xo],toggleHidden:["toggle",Co],show:["add",Co],hide:["remove",Co]};for(const[t,e]of Object.entries($o))Object.defineProperty(No.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(Po))No.prototype[t]=function(){this._updateBoxStatus(e,s),s===xo&&(this._syncButtonText(),this._syncScroll())};const qo=Object.freeze(Eo),Lo=Object.freeze(Oo),Uo=Object.freeze(Ao);var jo=Object.freeze({__proto__:null,constants:qo,phrases:Lo,templates:Uo,wireAnswerBox:function(t,e){if(!t)throw Error("client is required");e&&new No(t,e)}});const Do=Object.freeze(Fr),Mo=Object.freeze(jo);var zo=Object.freeze({__proto__:null,ask:Do,hybridSearch:Mo});const Fo="ui";let Bo,Qo;async function Go(){return Qo||(Qo=L(Bo||(Bo=U(Fo))))}class Wo{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Ho{constructor(t,e){this._plugin=t,this._client=e,m(this,{sources:{api:ys(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Er(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new ur(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new mr(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Ko{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Jr(this._plugin,this._MisoClient))}}qt.plugins.use(class extends tt{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Xr(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new N}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:zo};p(s,this,["layouts","combo","ready"]),m(this,{MisoClient:t}),m(t,{ui:s}),this.combo=new Ko(this,t);const n=Object.values(oi).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:r,combos:o,...a}=wo,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];co.MisoClient=t,bo.MisoClient=t;for(const e of c)e.MisoClient=t;await Go();for(const t of c)S(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){m(t,{ui:new Ho(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Wo(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new xr(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Ui(this,t)),e}});let Vo;const Yo=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Vo="original",window.fetch;const t=document.createElement("iframe");return t.style.display="none",document.body.appendChild(t),Vo="restored",t.contentWindow.fetch})();class Zo extends tt{static get id(){return"idg"}constructor(){super("idg")}install(t,e){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(e.setCustomFetch(Yo),function(...t){console.log("%cMiso","color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;","<plugin:idg>","[info]",...t)}(`Using ${Vo} native fetch`))}}const{currentScript:Jo}=document,Xo=Jo.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");function ta(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${Xo}/${t}`}const ea=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",logo_image:"image/pcworld.jpg",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",logo_image:"image/macworld.jpg",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",logo_image:"image/techhive.jpeg",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",logo_image:"image/pcwelt.jpg",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",logo_image:"image/macwelt.jpg",regions:[],ref_story:"2383200"}].map((({logo_image:t,...e})=>({logo_image:ta(t),...e})));async function sa(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}function na(t){const e=new Date;return new Date(e.getFullYear()-t,e.getMonth(),e.getDate()).toISOString().substring(0,10)}function ia({site:t,version:e,config:s}){const{aff_type:n}=s;return d({source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",aff_type:n,site:t.key,uuid:T()})}ea.reduce(((t,e)=>(t[e.key]=e,t)),{});const ra=5e3;let oa,aa,ca=!1;async function ua(){return aa||(aa=Promise.any([ha(),da(),la(ra)]))}async function la(t){return new Promise((e=>setTimeout((()=>{const t=T();ma("Fallback",t),e(t)}),t)))}async function ha(){const t=await sa((()=>window.gaGlobal&&window.gaGlobal.vid));return t&&ma("GA4",t),t}async function da(){const t=(await(oa||(oa=async function(){return sa((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return t&&ma("UA",t),t}const _a="%cMiso",pa="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function ma(s,n){!function(...s){(t.debug||e.indexOf("beta")>=0||"dev"===e)&&function(...t){console.log(_a,pa,...t)}(...s)}(`[${s}] Client ID: ${n}${ca?" (unused)":""}`),ca=!0}async function fa(t){const e=await async function(t){let e=t.instances[0];if(e)return e;return new Promise((e=>{t.on("create",(()=>{e(t.instances[0])}))}))}(t);!function(t,e){t._logs=[];const s=e.meta.parent._pluginRoot.get("std:debug");for(const e of["_log","_logr"]){const n=s[e];s[e]=function(){n.apply(this,arguments),t._logs.push("_log"===e?ya(arguments):arguments)}}}(t,e),function(t,e){const s=Date.now();function n({summary:e,timestamp:n,elapsed:i,operation:r,conflict:o}){t.debug("<progressive-markdown>",`[${(n-s)/1e3}](${i[0]/1e3}, ${i[1]/1e3})`,e,""+r,o)}e.ui.asks.useLayouts({answer:{onDebug:n}})}(t,e),function(t){const e=document.body,s=document.createElement("div");s.textContent="Miso Log",s.classList.add("miso-log-download-btn");const n=document.createElement("div");n.textContent=function(t){return"dev"===t||t.startsWith("v")?t:"v"+t}(window.miso_smart_answers_script_version),n.classList.add("miso-version");const i=document.createElement("div");i.classList.add("miso-log-container"),i.appendChild(n),i.appendChild(s),e.appendChild(i),s.addEventListener("click",(()=>function(t){const e=t._logs,s=new Blob([ga(e)],{type:"application/json"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=`miso-log.${(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}.jsonl`,i.click()}(t)))}(t),t.debug("<custom>","[ua]",""+navigator.userAgent)}function ga(t){return t.map((t=>JSON.stringify(va(t)))).join("\n")}function ya(t){const[e,s,...n]=t;return[ba(e),wa(s),...n]}function ba(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}function wa(t){return`[${t}]`}function va(t,e=5){return"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>va(t,e-1))):function(t,e){const s=t.constructor.name,n="Object"===s?{}:{__type:s};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=va(i,e-1)))}return n}(t,e):t}function Ea({site:t,config:e,version:s}){Object.defineProperty(qt,"name",{value:"smart-answers"});const n=s.indexOf("beta")>0,i=("dev"===s||n)&&e.logging;return("dev"===s||n||e.debug)&&qt.plugins.use("std:debug",{console:{background:"#9033bb"}}),i&&fa(qt),qt.plugins.use(Zo),e.test_product?(qt.plugins.use("std:dry-run"),qt.debug&&qt.debug("[Answers] Test product: "+e.test_product)):!e.dry_run&&function(t){return window.location.hostname===t.hostname}(t)||qt.plugins.use("std:dry-run"),window.MisoClientSA=qt,qt}async function Sa({MisoClient:t,config:e}){const s={readConfigFromScriptUrl:!0};"staging"===e.api_host&&(s.apiHost="https://ask-api.askmiso-staging.com/v1");const n=window.misoSA=new t(s);return n.context.anonymous_id=await ua(),n}const ka='<svg fill="currentColor" viewBox="0 0 24 24">\n<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z"/>\n</svg>';var Oa={queryButton:"A.I. Search",home:{title:"Smart Answers from ${name}",queryPlaceholder:"Ask us a question",info:"What is this?"},story:{title:{nonempty:"Explore frequently asked questions",empty:"Explore with a question"},queryPlaceholder:{nonempty:"Ask your own question...",empty:"Ask a question..."}},answers:{title:"Smart Answers",subtitle:"Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.",feedback:{helpful:"Helpful",unhelpful:"Not Helpful"},sources:"My reply is based on the following",relatedResources:"Go beyond, and learn more about this topic",querySuggestions:"Related questions you can explore",followUp:{queryPlaceholder:"Ask a follow-up question",queryButton:"Ask"},affiliation:{title:"Best Prices Today: ${title}"},error:{title:"Oops!",description:"We are currently experiencing some difficulties. Would you please trying again later?"}},sponsor:{phrase:"Supported by",tooltip:"Our sponsors help keep Smart Answers running,<br>but do not influence our editorial independence."}},Ia=Object.freeze({__proto__:null,default:Oa,queryButton:Oa.queryButton,home:Oa.home,story:Oa.story,answers:Oa.answers,sponsor:Oa.sponsor}),Ta={queryButton:"KI-Suche",home:{title:"Smart Answers von ${name}",queryPlaceholder:"Stellen Sie uns eine Frage",info:"Was ist das?"},story:{title:{nonempty:"Hufig gestellte fragen entdecken",empty:"Hufig gestellte fragen entdecken"},queryPlaceholder:{nonempty:"Stellen Sie Ihre eigene Frage...",empty:"Stellen Sie Ihre eigene Frage..."}},answers:{title:"Smart Answers",subtitle:"Erhalten Sie Antworten auf Ihre Technikfragen durch KI, die ausschlielich auf Berichten und Tests unserer Experten basieren.",feedback:{helpful:"Hilfreich",unhelpful:"Nicht hilfreich"},sources:"Meine Antwort basiert auf folgenden Inhalten",relatedResources:"Erfahren Sie mehr ber dieses Thema",querySuggestions:"Verwandte Fragen, die Sie erforschen knnen",followUp:{queryPlaceholder:"Stellen Sie eine Anschlussfrage",queryButton:"Fragen Sie"},affiliation:{title:"Beste Preise heute: ${title}"},error:{title:"Hoppla!",description:"Wir erleben derzeit einige Schwierigkeiten. Wrden Sie es bitte spter noch einmal versuchen?"}},sponsor:{phrase:"Untersttzt von",tooltip:"Unsere Sponsoren helfen, Smart Answers am Leben zu halten, haben aber keinen Einfluss auf unsere redaktionelle Unabhngigkeit."}},Aa=Object.freeze({__proto__:null,default:Ta,queryButton:Ta.queryButton,home:Ta.home,story:Ta.story,answers:Ta.answers,sponsor:Ta.sponsor});const xa=function(t){if("de"===t)return Aa;return Ia}("en");const Ca="miso-smart-answers";function Ra(t){return`\n<div class="miso-smart-answers">\n  ${function({sponsor:t}){return t?`\n<div class="${Ca}__sponsor" data-brand="${t.key}">\n  <div class="${Ca}__sponsor-text">${xa.sponsor.phrase}</div>\n  <div class="${Ca}__sponsor-logo">\n    <img src="${ta(t.image)}" alt="${t.name}">\n  </div>\n  <div class="${Ca}__sponsor-info" tabindex="-1">\n    ${ka}\n    <div class="${Ca}__sponsor-info-tooltip">${xa.sponsor.tooltip}</div>\n  </div>\n</div>`.trim():""}(t)}\n  <section class="question">\n    <div class="hero">\n      <div class="hero-inner">\n        <h2 class="title">${xa.answers.title}</h2>\n        <h4 class="slogan">${xa.answers.subtitle}</h4>\n      </div>\n    </div>\n    <miso-ask class="query-container">\n      <miso-query>\n        <input class="input" data-role="input">\n        <button class="button" data-role="button">\n          <i><svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg></i>\n          <span>${xa.queryButton}</span>\n        </button>\n        </miso-query>\n    </miso-ask>\n  </section>\n  <section class="answer">\n    ${$a()}\n    ${Pa()}\n    ${qa()}\n  </section>\n  <section id="follow-ups" class="follow-ups">\n  </section>\n  <section id="related-resources" class="related-resources empty">\n    <miso-ask visible-when="ready" logo="false">\n      <div class="phrase related-resources">${xa.answers.relatedResources}</div>\n      <miso-related-resources></miso-related-resources>\n    </miso-ask>\n  </section>\n</div>`}function Na({title:t,block:e},s={}){return`\n<div class="affiliation">\n  ${s.title?function(t){return`<h4 class="title">${xa.answers.affiliation.title.replace("${title}",t)}</h4>`}(t):""}\n  ${e}\n</div>\n`}function $a({parentQuestionId:t}={}){return`\n<miso-ask class="error-container" visible-when="erroneous" logo="false" ${La(t)}>\n  ${t?"<hr>":""}\n  <h2 class="miso-error-header">${xa.answers.error.title}</h2>\n  <p class="miso-error-description">\n    ${xa.answers.error.description}\n  </p>\n  <miso-error></miso-error>\n</miso-ask>`}function Pa({parentQuestionId:t}={}){return`\n<miso-ask visible-when="ready" logo="false" class="miso-circled-citation-index" ${La(t)}>\n${t?"<hr>":""}\n  <miso-question></miso-question>\n  <miso-answer></miso-answer>\n  <miso-idg-affiliation></miso-idg-affiliation>\n  <miso-feedback></miso-feedback>\n</miso-ask>`}function qa({parentQuestionId:t}={}){return`\n<miso-ask class="sources-container miso-circled-citation-index" visible-when="ready" logo="false" ${La(t)}>\n  <div class="phrase sources">${xa.answers.sources}</div>\n  <miso-sources></miso-sources>\n</miso-ask>`}function La(t){return t?`parent-question-id="${t}"`:""}const Ua=new Map,ja=new Map;function Da(t){return t.startsWith("product_")?t.slice(8):t}async function Ma(t){return Fa(Ua,t,Qa)}async function za(t){return Fa(Ua,t,Ga)}async function Fa(t,e,s,...n){const i=e.filter((e=>!t.has(e)));if(i.length>0){const e=await s(i,...n);for(const s of i)t.set(s,e[s])}return e.reduce(((e,s)=>(e[s]=t.get(s),e)),{})}const Ba="111111";async function Qa(t){return await Ha("products-view",t,{product_block:"price-comparison",article_id:Ba})}async function Ga(t){const e=await Ha("products-view",t,{article_id:Ba});for(const t in e)e[t]=Za(e[t]);return e}async function Wa(t){const e=await async function(t,e,{fields:s}={}){if(0===e.length)return[];let n=`https://b2c-contenthub.com/wp-json/wp/v2/${t}?include=${e.join(",")}&per_page=100`;s&&(n+="&_fields="+s.join(","));const i=await window.fetch(n);return await i.json()}("product",t,{fields:["id","title"]});return function(t,e){const s={};for(const n of t)s[n[e]]=n;return s}(e,"id")}async function Ha(t,e,s={}){if(0===e.length)return[];let n=`/wp-json/idg/v2/${t}?include=${e.join(",")}&per_page=100&_embed=1`;for(const[t,e]of Object.entries(s))n+=`&${encodeURIComponent(t)}=${encodeURIComponent(e)}`;const i=await window.fetch(n);return await i.json()}const Ka='data-vars-outbound-link="',Va='data-vars-outbound-link="',Ya='data-miso-attribution="miso-smart-answers" data-miso-product-type="product" ';function Za(t,e){return!!function({html:t}){return t.indexOf(Ka)>=0}(t)&&(t=function(t){try{const{html:e}=t,s=e.indexOf(Va);if(0>s)throw Error(`Cannot find '${Va}' in product view HTML.`);t.html=e.substring(0,s)+Ya+e.substring(s)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t))}class Ja{constructor(t,e){this._workflow=t,this._context=Object.freeze({...e}),this._element=void 0,this._session=void 0,this._products=[],this._html=void 0,this._syncIndex=0,this._clicked=!1,t.on("data",(t=>this.updateData(t)))}async updateData({session:t,value:e}={}){if(!t)return;if(this._products.length>0&&this._session&&this._session.uuid===t.uuid)return;const s=this._getProducts(e);var n,i;(i=s,0===(n=this._products).length&&0===i.length||(n[0]&&n[0].product_id)===(i[0]&&i[0].product_id))||(this._session=t,this._products=s,this._sendInteraction("custom",{custom_action_name:"affiliation_response"}),this._syncView())}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=`.miso-smart-answers ${t?`miso-ask[parent-question-id="${CSS.escape(t)}"]`:"miso-ask:not([parent-question-id])"} miso-idg-affiliation`;if(this._element=document.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProducts(t){const{test_product:e}=this._context.config;if(e)return[{product_id:"product_"+e}];const{affiliation_products:s=[]}=t||{};return s||[]}async _syncView(){const t=this._syncIndex++;if(this._selected=await async function(t,e){const{debug:s}=e;if(0===t.length)return void s("[Affiliation] No affiliated products.");const[n,i]=await Promise.all([Xa(t,e),tc(t)]),r=[];for(const{product_id:e}of t){const t=n[e],s=i[e];if(t&&s){const n=Da(e);r.push({product_id:e,id:n,title:s,block:t})}}if(r.length>0)return Object.freeze(r[0]);return void s("[Affiliation] No non-empty views for affiliated products: "+t.map((({product_id:t})=>Da(t))).join(", "))}(this._products,this._context),this._syncIndex!==t+1)return;this._selected||this._sendInteraction("custom",{custom_action_name:"product_view_empty_response"});this._html=this._selected?Na(this._selected,{title:"product"!==this._context.config.aff_type}):"",this._requestRender(t)}async _requestRender(t){this._render(),this._selected&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._context.MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;const e=function(t,e,{root:s}){if("string"==typeof e){const t=e;e=e=>e.matches(t)?e:void 0}for(let n=t;n&&n!==s;n=n.parentElement){const t=e(n);if(t)return t}}(t,"a[href]",{root:this.element});e&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){const{client:s}=this._context,{questionId:n,parentQuestionId:i,rootQuestionId:r,session:o}=this._workflow,{question_source:a="_organic"}=o.meta||{},c=this._selected?[this._selected.product_id]:void 0,u=this._products.map((({product_id:t})=>t));s.api.interactions.upload(d({type:t,...e,product_ids:c,context:{custom_context:d({...ia(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:r,parent_question_id:i,question_id:n,question_source:a,candidate_product_ids:u})}}))}}async function Xa(t,{config:e}){const s=t.map((({product_id:t})=>Da(t))),n=await("product"===e.aff_type?za:Ma)(s),i={};for(const{product_id:e}of t){const t=n[Da(e)];i[e]=t&&t.html&&t.html.trim()||""}return i}async function tc(t){const e={},s=[];for(const{product_id:n,title:i}of t)i?e[n]=i:s.push(n);if(s.length>0){const t=await async function(t){return Fa(ja,t,Wa)}(s.map(Da));for(const n of s)e[n]=t[Da(n)].title}return e}const ec="miso-smart-answers";let sc,nc,ic;function rc(t){const{config:e,site:s,client:n}=t,{aff_type:i}=e;sc=document.querySelector(`.${ec} #follow-ups`),nc=document.querySelector(`.${ec} #related-resources`),ic=document.querySelector(`.${ec} #related-resources miso-ask`);const r=n.ui.asks,o=n.ui.ask;r.useApi("questions",{_meta:{site:s.key,aff_type:i},yearly_decay:.93,fq:oc(t)}),r.useLayouts({feedback:{templates:{text:(t,e)=>xa.answers.feedback["helpful"===e?"helpful":"unhelpful"]}}}),"de"===s.lang&&r.useLayouts({sources:{templates:{date:"de-DE"}},related_resources:{templates:{date:"de-DE"}}}),r.on("data",(({workflow:t,value:e})=>{const{sources:s,related_resources:n}=e||{};ic.workflow===t&&hc(nc,n),hc(lc(t,"sources-container"),s)})),r.useDataProcessor(cc),r.useInteractions({preprocess:e=>function(t,e){return{...e,context:{...e.context,custom_context:{...ia(t),...e.context&&e.context.custom_context}}}}(t,e)}),r.on("done",(({workflow:t})=>{sc.insertAdjacentHTML("beforeend",function({parentQuestionId:t}){return`\n<div class="session">\n  <miso-ask class="query-suggestions-container" visible-when="initial" parent-question-id="${t}">\n    <div class="phrase query-suggestions">${xa.answers.querySuggestions}</div>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="query-container" visible-when="initial loading" parent-question-id="${t}">\n    <miso-query>\n      <input class="input" data-role="input" placeholder="${xa.answers.followUp.queryPlaceholder}">\n      <button class="button" data-role="button">\n        <span>${xa.answers.followUp.queryButton}</span>\n      </button>\n    </miso-query>\n  </miso-ask>\n  ${$a({parentQuestionId:t})}\n  ${Pa({parentQuestionId:t})}\n  ${qa({parentQuestionId:t})}\n</div>`}({parentQuestionId:t.questionId}))})),r.on("loading",(({workflow:t})=>{ic.workflow=t})),ac(o,t),r.on("create",(e=>ac(e,t))),o.on("loading",(()=>{sc.innerHTML="",r.reset({root:!1})})),o.autoQuery()}function oc(t){const{site:e}=t;return"de"===e.lang?`created_at:[${na(2)} TO *] AND type:story AND -custom_attributes.content_type:(DealPost BrandPost SponsoredContent) AND custom_attributes.languages:German`:`created_at:[${na(2)} TO *] AND type:story AND -custom_attributes.content_type:(DealPost BrandPost SponsoredContent) AND (custom_attributes.languages:English OR NOT _exists_:custom_attributes.languages)`}function ac(t,e){t._affiliation=new Ja(t,e),hc(lc(t,"query-suggestions-container"),t.states.suggestions)}function cc({value:t,...e}){if(!t)return e;const{sources:s=[],related_resources:n=[]}=t;return{value:{...t,sources:s.map(uc),related_resources:n.map(uc)},...e}}function uc({url:t,...e}){const{product_id:s}=e;if(t&&s&&t.indexOf("//b2c-contenthub.com/")>=0){const[e,n]=s.split("_");t=t.replace("//b2c-contenthub.com/",`//www.${n}.com/`)}return{url:t+=(0>t.indexOf("?")?"?":"&")+"utm=smart_answers",...e}}function lc(t,e){const{parentQuestionId:s}=t,n=s?`[parent-question-id="${CSS.escape(s)}"]`:":not([parent-question-id])";return document.querySelector(`.${ec} miso-ask.${e}${n}`)}function hc(t,e){t&&t.classList[e&&0!==e.length?"remove":"add"]("empty")}const{currentScript:dc}=document;async function _c({MisoClient:t}){await Promise.all([pc(t),fc()])}async function pc(t){await gc(`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t.version}/dist/css/ui.css`)}let mc=!1;async function fc(){if(mc)return;if(mc=!0,!dc)throw Error("currentScript not found");const t=dc.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await gc(s)}async function gc(t){if(!document.querySelector(`link[href="${t}"]`))return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}const yc=".layout--right-rail .wp-block-column";function bc(t,e){const{aff_type:s}=t;return"random"!==s?s:function(t){let e=0;for(let s=0,n=t.length;n>s;s++)e=(e<<5)-e+t.charCodeAt(s)|0;return function(t){return t/2**32+.5}(e)}(e)>.2?"price_comparison":"product"}(async(t,s)=>{if("/smart-answers"!==window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=e;const i=Ea({site:t,config:s,version:e,sponsor:n}),r=i.debug||(()=>{});r("Miso Smart Answers script version: "+e);const o=document.querySelector(yc);if(!o)return void console.error("Container not found: "+yc);i.plugins.use("std:ui");const[a,c]=await Promise.all([Sa({config:s,MisoClient:i}),ua(),_c({site:t,MisoClient:i})]);s={...s,aff_type:bc(s,c)},o.innerHTML=Ra({sponsor:n}),rc({site:t,config:s,client:a,MisoClient:i,debug:r,version:e,sponsor:n})})({key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",logo_image:"image/techadvisor.jpeg",regions:["en-gb"],ref_story:"2013602"},t)}();
