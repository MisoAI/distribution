!function(){"use strict";var e=Object.freeze({aff_type:"random",...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()}),t="1.0.15-beta.0";const s=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var n=function(){if(e.sponsor)return s.find((t=>t.key===e.sponsor))||void 0}();function i(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const r=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),o=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var a=Object.freeze({__proto__:null,GROUP:r,NAME:o});function c(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function u(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function l(e){return null!=e?""+e:e}function h(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function _(e){return null==e}function d(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function p(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function m(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function f(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function g(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class y{constructor(e,{duration:t=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);w(s),w(n),w(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==n?n:t})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>b(this,e)),t):b(this,e),this._value=e}disconnect(){this._active=!1}}function b(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function w(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function v(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function E(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function S(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async n=>{try{await e(n),t()}catch(e){s(e)}}))}))}async function k(e,{area:t=.5,duration:s=1e3,signal:n}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((i,r)=>{const o=new y((e=>{e&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((e=>{o.value=e[0].isIntersecting}),{threshold:t});a.observe(e),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function O(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function I(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function T(e,t){const s=x((()=>window.localStorage.getItem(e))),n=x((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,n=t.indexOf(s);if(0>n)return;const i=n+s.length,r=t.indexOf(";",i);return decodeURIComponent(0>r?t.substring(i):t.substring(i,r))}(e))),i=s||n||""+t();return i&&!s&&x((()=>window.localStorage.setItem(e,i))),i&&!n&&x((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,i))),i}function x(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function C(e){return new A(e)}class A{constructor(e){this._value=e;const t=e=>{this._value=e};p(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class R{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class ${constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new R),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var N="1.11.4";let P;try{P=document.currentScript}catch(e){}async function q(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let n;e.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{e.sheet&&(n&&clearInterval(n),t())}),100)}))}(e),await async function(e){if(U(e))return;return new Promise((t=>{let s;s=setInterval((()=>{U(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function L(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${N}/dist/css/${e}.css`}function U(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function j(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function D(e,{depth:t=5,...s}={}){return z(e,t)}function z(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>z(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const n={};if(0>=t)return n;for(const s in e){const i=e[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=z(i,t-1)))}return n}(e,t):e:"(...)"}function M(e,t){const s=Object.getOwnPropertyDescriptors(t),n=Object.getOwnPropertyDescriptors(e);for(const[t,i]of Object.entries(s))"constructor"!==t&&void 0===n[t]&&Object.defineProperty(e,t,i)}function F(e){const t={},s=new Set;for(let n=e;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(t[n]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}const B=100,Q=4;function G(e){const t=function({speed:e=B,acceleration:t=Q}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,n)=>{let i=e*(Math.random()+.5);return t>0&&void 0!==n&&s>n&&(i*=1+(s-n)*t/1e3),i}}(e);return(e,s,n,i)=>{const r=t(n,s);return e+Math.max(i-n,0)*r/1e3}}const W=Symbol.for("miso:resources");class H{constructor(){this._resources=new Map;const e=window[W]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){K(this._resources,e).resolve(t)}async get(e){return K(this._resources,e).promise}}function K(e,t){if(e.has(t))return e.get(t);const s=new R;return e.set(t,s),s}function V(){return window[W]||(window[W]=new H)}class Y{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new R;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class Z{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},n=this._namedCallbacks[e];if(n)for(const e of n)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,n)=>{const i=t._on(e,(e=>{setTimeout((()=>i()));try{s(e)}catch(e){n(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:n})=>{try{e(s,n)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)c(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&c(s,t)}}_injectSubscribeInterface(e){d(e,this,["on","once"])}}function J(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class X{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:J(e,t),uuid:I()})}(e,t);p(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new Z({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(X,"miso:component");class ee extends X{constructor(e,t,{libName:s,keyName:n}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=e=>e[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new R);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class te{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new y(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class se{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:ne}=document,ie=ne.src.replace(/\/[^/]+$/,"").replace(/\/smart-answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function re({}){await Promise.all([ae()])}let oe=!1;async function ae(){if(oe)return;if(oe=!0,!ne)throw Error("currentScript not found");const e=ne.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}function ce(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${ie}/${e}`}const ue=[{key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",regions:[],ref_story:"2013610"},{key:"macworld",hostname:"www.macworld.com",name:"Macworld",lang:"en",regions:["en-gb"],ref_story:"2012667"},{key:"techadvisor",hostname:"www.techadvisor.com",name:"Tech Advisor",lang:"en",regions:["en-gb"],ref_story:"2013602"},{key:"techhive",hostname:"www.techhive.com",name:"TechHive",lang:"en",regions:[],ref_story:"2013617"},{key:"pcwelt",hostname:"www.pcwelt.de",name:"PC-WELT",lang:"de",regions:[],ref_story:"2385340"},{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",regions:[],ref_story:"2383200"}].map((({logo_image:e,...t})=>({logo_image:ce(e),...t}))),le=ue.reduce(((e,t)=>(e[t.key]=t,e)),{});function he(e){return le[e]}async function _e(e,{interval:t=300,timeout:s}={}){const n=e();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const t=e();null!=t&&(a(),n(t))}),t),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}function de({site:e,version:t,config:s}){const{aff_type:n}=s;return h({source:"miso-client-script",script_version:t,attribution:"miso-smart-answers",aff_type:n,site:e.key,uuid:I()})}function pe(){return h({page:h({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:me()})}function me(){const e=new URLSearchParams(window.location.search);let t=h({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}const fe=5e3;let ge,ye,be=!1;async function we(){return ye||(ye=Promise.any([Ee(),Se(),ve(fe)]))}async function ve(e){return new Promise((t=>setTimeout((()=>{const e=I();Ie("Fallback",e),t(e)}),e)))}async function Ee(){const e=await _e((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&Ie("GA4",e),e}async function Se(){const e=(await(ge||(ge=async function(){return _e((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&Ie("UA",e),e}const ke="%cMiso",Oe="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Ie(s,n){!function(...s){(e.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(ke,Oe,...e)}(...s)}(`[${s}] Client ID: ${n}${be?" (unused)":""}`),be=!0}const Te="%cMiso",xe="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Ce(...s){(e.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(Te,xe,...e)}(...s)}const Ae=new Map;async function Re(e){return async function(e,t,s){if(e.has(t))return e.get(t);const n=await s(t);return e.set(t,n),n}(Ae,e,(async e=>await async function(e,t){return async function(e,t,{fields:s}={}){let n=`https://b2c-contenthub.com/wp-json/wp/v2/${e}/${t}`;s&&(n+="?_fields="+s.join(","));return async function(e){return(await window.fetch(e)).json()}(n)}("posts",e,t)}(e,{fields:["meta"]})))}async function $e(e){const t={};let s;try{s=await Re(e),Ce("Fetched post info",[s])}catch(s){return console.error("Cannot fetch post: "+e),console.error(s),t}try{if(t.contentType=s.meta.content_type,!t.contentType)throw Error("Blank meta.content_type: "+e)}catch(t){console.error("Cannot extract story type: "+e),console.error(t)}try{const{suppress_monetization:e='""'}=s.meta||{},n=JSON.parse(e);t.adSuppression=!0===n.content_ads}catch(t){console.error("Cannot extract suppress_monetization info: "+e),console.error(t)}return t}const Ne="home",Pe="answers",qe="search",Le="article",Ue="other";var je=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const De={key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",regions:[],ref_story:"2013610"},ze=window.location.hostname!==De.hostname;var Me={...De,dev:ze};var Fe=Object.freeze(function(){const e=(t=window.location.pathname).endsWith("/")?t.substring(0,t.length-1):t;var t;switch(e){case"":return{type:Ne};case"/smart-answers":return{type:Pe};case"/search":return{type:qe};default:if(Me.regions.indexOf(e.substring(1))>=0)return{type:Ne}}const s=e.substring(1).split("/");if("article"===s[0]){const e=""+s[1];return{type:Le,postId:e,product_id:`article_${Me.key}_${e}`}}return{type:Ue}}());const Be="%cMiso",Qe="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Ge=[{key:"dell",name:"Dell",image:"image/sponsor/dell.svg"},{key:"nvidia",name:"NVIDIA",image:"image/sponsor/nvidia.svg"}];var We=function(){if(je.sponsor)return Ge.find((e=>e.key===je.sponsor))||void 0}(),He=Object.freeze({__proto__:null,config:je,version:t,site:Me,page:Fe,sponsor:We,debug:function(...e){(je.debug||t.indexOf("beta")>=0||"dev"===t)&&function(...e){console.log(Be,Qe,...e)}(...e)}}),Ke="1.11.4";const Ve=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Ye{constructor(e,t){this._client=e,this._root=t,this._bulk=new Y(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(e,h({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),_=await l.json();if(l.status>=400||_.errors){var d=Error(_.message);throw d.data=_,d.status=l.status,d}return _}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:n}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:i,status_code:r,body:o}=n[t];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:n={}}=this._client.options,i=t.sendApiKeyByHeader||n.sendApiKeyByHeader,r=e.filter((e=>e)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=Ve.DATA_ENDPOINT,eventEndpoint:s=Ve.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:t,apiName:s,url:n})||n}catch(t){(e._error||console.error)(t)}return n}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:t,apiName:s,payload:n})||n}catch(t){(e._error||console.error)(t)}return n}}class Ze extends X{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(e,t,n):this.helpers.fetch(s,n,r)}_postprocess({response:e}){return e.data}}const{GROUP:Je,NAME:Xe}=a;class et extends Ze{constructor(e){super(e,Je.INTERACTIONS)}async upload(e,t){try{return await this._run(Xe.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Xe.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:n}=s;return this.helpers.sendBeacon(e,n,t),{}}return super._send({...s,options:t})}}class tt{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...n}=this._options;const r=new se(s);let o;t=i(this._ac.signal,r.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new $;return o=setInterval((async()=>{let t,o,d;try{if([t,o,d]=await e(r?{signal:r}:{}),u||!_(a)&&a>=d)return;_(d)||(a=d),i&&i(t,o,d),c=0}catch(e){return n&&n(e),c++,void(c>s&&(l(),h.error(e)))}h.update(t,o),o&&l()}),t),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?r.clear():this._isUpdated(o,e)&&r.touch(),o=e},...n})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class st extends tt{constructor(e,t,s,n){super(n),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:nt,NAME:it}=a;class rt extends Ze{constructor(e){super(e,nt.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new ot(this,e,t);const s=await this._run(it.QUESTIONS,e,t);return new ot(this,s,t)}async _questions(e,t){return this._run(it.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${it.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(it.RELATED_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(it.SEARCH,e,t);return s.question_id?new at(this,s,t):s}async _searchGet(e,t){return this._run(`${it.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(it.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(it.SEARCH_AUTOCOMPLETE,e,t)}}class ot extends st{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class at extends st{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),p(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:ct,NAME:ut}=a;class lt extends Ze{constructor(e){super(e,ct.SEARCH)}async search(e,t){return this._run(ut.SEARCH,e,t)}async autocomplete(e,t){return this._run(ut.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(ut.MGET,e,t)}}const{GROUP:ht,NAME:_t}=a;class dt extends Ze{constructor(e){super(e,ht.RECOMMENDATION)}async userToProducts(e,t){return this._run(_t.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(_t.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(_t.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(_t.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(_t.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(_t.PRODUCT_TO_PRODUCTS,e,t)}}class pt extends X{constructor(e,t){super("api",e),this._client=e,this.helpers=new Ye(e,t),this.interactions=new et(this),this.ask=new rt(this),this.search=new lt(this),this.recommendation=new dt(this)}}var mt=Object.freeze({__proto__:null,Api:pt,ApiBase:Ze,ApiHelpers:Ye,Interactions:et,Ask:rt,Search:lt,Recommendation:dt});class ft extends X{constructor(e){super("context",e),this._client=e}}var gt={api:mt,context:{Context:ft}};class yt{constructor(e){p(this,{install:e})}}class bt extends ee{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new wt(this,gt),this.plugins=new vt(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new R);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const n=new s;return p(n,{id:e}),this._tryConfig(n,t),n;case"function":return new yt(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(e,t,s){const n=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),i=0>t?e.length:t,r=e.lastIndexOf("/",i)+1,o=e.indexOf(".",r),a=0>o?"":e.slice(o,i);return`${e.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${n}.min.js`}(e,t,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new V).get(s);!this.isRegistered(e)&&this.register(n)}}class wt{constructor(e,t){d(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),p(this,{classes:t})}}class vt{constructor(e){d(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Et=new class extends X{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new bt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=Ke,this._cmdRes=new R}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var St=Object.freeze({__proto__:null,viewable:k,debounce:j});const{currentScript:kt}=document;class Ot extends X{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Ot),window.MisoClient?window.MisoClient!==Ot&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Ot}static debug(){}constructor(e){super("client",Et),this._config(e),this.context=new ft(this),this.api=new pt(this,Et),function(e){Et._clients.push(e),Et._events.emit("create",e)}(this)}get version(){return Ot.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,h(e)}_readConfigFromScriptUrl(){return h({apiKey:new URL(new Request(kt.src||kt.href).url).searchParams.get("api_key")||void 0})}}Ot.helpers=St,p(Ot,{uuid:I()});var It=function(e){const t=Et._pluginRoot;return Et.MisoClient=t.MisoClient=e,d(e,Et,["version","instances","any","meta","on","once","cmdDone"]),d(e,t,["plugins"]),e}(Ot);const{GROUP:Tt,NAME:xt}=a;let Ct;class At{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||Ct||(Ct=T("miso_anonymous_id",I))}set anonymous_id(e){e=l(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=l(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function Rt(){const e=new URLSearchParams(window.location.search);let t=h({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class $t{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],n=e[t];n!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Nt(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:Ke};return s.uuid||(s.uuid=I()),{...e,context:{...t,custom_context:s}}}const Pt="std:native-fetch";let qt,Lt;const Ut=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return qt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),qt="borrowed",e.contentWindow.fetch}catch(e){Lt=e}})();const jt="miso-logdump",Dt="miso-logdump",zt=Dt+"__download-btn",Mt="Miso Log";class Ft{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return Wt||(Wt=q(L("logdump")))}();let e=document.getElementById(jt);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||Mt,t.classList.add(zt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=jt,e.classList.add(Dt),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(jt),t=e&&e.querySelector("."+zt);t&&(t.textContent=this._options.logDownloadButtonText||Mt)}hideDownloadButton(){const e=document.getElementById(jt);e&&(e.style.display="none")}download(){const e=new Blob([Qt(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:Bt()})}return e&&"string"==typeof e?e:`miso-log.${Bt()}.jsonl`}clear(){this._logs=[]}}function Bt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Qt(e){return e.map((e=>JSON.stringify(D(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Gt(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function Gt(e){return e?D(e,{depth:2}):e}let Wt;const Ht="std:debug";function Kt(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function Vt(e,t){return Object.freeze({...e,...t,members:Yt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Yt(e=[],t=[]){return[...new Set([...e,...t])]}function Zt(e,t){let s={};for(const n of e)n&&(s=t(s,n));return h(s)}function Jt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Xt(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,n=t.payload,{...s,...n,...es("_meta",s,n)})});var s,n}))}function es(e,t,s){const n=t&&t[e],i=s&&s[e],r=n?i?{...n,...i}:n:i;return void 0!==r?{[e]:r}:{}}It.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Ft(e)}static get id(){return Ht}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Ht,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,n)=>this._handleEvent(e,n,s,t)))}_handleEvent(e,{name:t},s,n=[]){if("child"===t||"subtree"===t)return;const i=n.concat(e.meta.path);if(i.length||"create"!==t){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(t,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(i[1],i.slice(2),t,s))}this._logw(i.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",e];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=e,i="custom"===t&&s?`${t}:${s}`:t;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,n){this._logw([e,t.join(".")],s,n)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Kt)):this._log(e,t,Kt(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Pt}install(e,t){Ut?(t.setCustomFetch(Ut),e.debug(`<plugin:${Pt}>`,"[info]",`Using ${qt} native fetch`)):e.debug(`<plugin:${Pt}>`,"[error]","Failed to obtain native fetch: "+Lt.message)}}),It.plugins.use(class extends X{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new At(this);var s,n;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:n}){return t===Tt.INTERACTIONS&&s===xt.UPLOAD?this._modifyPayloadForInteractions(e,n):t===Tt.ASK&&s===xt.QUESTIONS?this._modifyPayloadForAsk(e,n):this._modifyPayloadForOthers(e,n)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:n,anonymous_id:i}=e.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=e.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:n}=e.context,i=h({anonymous_id:s,user_id:n});return{data:t=t.map((e=>({...i,...e})))}}}),It.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...h({page:h({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Rt()}),...e.context}})))}}}),It.plugins.use(class extends X{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new $t(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:n}){if(t===r.SEARCH)if(s===o.SEARCH)this._captureSearchApiRequest(e,n)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),It.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(Nt)}}}),It.plugins.use(class extends X{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case r.SEARCH:case r.RECOMMENDATION:return!0}return!1}});const ts="data-miso-product-id",ss="default",ns="_organic",is=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),rs=new Set([is.PRODUCTS,is.CATEGORIES,is.ATTRIBUTES,is.RESULTS,is.ITEMS,is.QUESTION,is.ANSWER,is.SOURCES,is.RELATED_RESOURCES,is.QUERY_SUGGESTIONS,is.RELATED_QUESTIONS,is.AFFILIATION,is.FACETS,is.TOTAL]);function os(e){return rs.has(e)}const as=new Set([is.PRODUCTS,is.SOURCES,is.RELATED_RESOURCES]);const cs=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),us=[cs.IMPRESSION,cs.VIEWABLE,cs.CLICK,cs.SUBMIT,cs.FEEDBACK],ls=[cs.IMPRESSION,cs.VIEWABLE,cs.CLICK],hs=new Set(ls);const _s=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),ds=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function ps(e){if(0>us.indexOf(e))throw Error("Unrecognized event type: "+e)}const ms=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function fs(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function gs(e){if(void 0===e)return;let[t,s]=u(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function ys(e,t){return!1===(t=gs(t))[0]?t:e&&t?[t[0]||e[0],bs(e[1],t[1])]:t||e}function bs(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const ws=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function vs(e={}){e=Jt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))Es(t);return e}function Es(e={}){return e=Jt(e)}function Ss(e={},t={}){const s={...e};for(const[n,i]of Object.entries(t))void 0!==i&&(s[n]=us.includes(n)?ks(e[n],i):i);return s}function ks(e={},t={}){return{...e,...t}}const Os=[{key:ms.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return h({group:s,name:e,payload:t})},merge:Xt},{key:ms.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${is.PRODUCTS}: ... }) instead`),e={...s,[is.PRODUCTS]:t});const n={};for(const[t,s]of Object.entries(e))n[fs(t)]=gs(s);return n},merge:function(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>{for(const[s,n]of Object.entries(t))e[s]=ys(e[s],n);return e}))}},{key:ms.DATA_PROCESSOR,normalize:function(e){e=u(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:ms.TRACKERS,normalize:function(e={}){e=Jt(e);const{active:t,...s}=e,n={};for(const[e,t]of Object.entries(s))n[e]=vs(t);return{active:t,...n}},merge:function(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>{for(const[s,n]of Object.entries(t))void 0!==n&&(e[s]="active"===s?n:Ss(e[s],n));return e}))}},{key:ms.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=u(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,n=t.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:ms.FILTERS,normalize:Jt,merge:function(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>Object.assign(e,t)))}},{key:ms.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&Zt(e,((e,t)=>Object.assign(e,t)))}}];class Is{constructor(){this._events=new Z({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class Ts{constructor(e={},t={}){this._events=new Z({target:this}),this._defaults=t,this._context=e||{},this._locals={},p(this,{resolved:new xs(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class xs{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,n=s._context[e];this._cache[e]=t(s._defaults[e],n&&n.get(),s._locals[e])}return this._cache[e]}}class Cs{constructor(e,t,s,n,i){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?n(e):void 0,this._merge=i}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of Os){const{key:t,normalize:s,merge:n}=e;Object.defineProperty(Is.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new Cs(this,this._globals,t,s,n))}}),Object.defineProperty(Ts.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new Cs(this,this._locals,t,s,n))}}),Object.defineProperty(xs.prototype,t,{get:function(){return this._get(e)}})}const As=[ms.API,ms.LAYOUTS,ms.DATA_PROCESSOR,ms.TRACKERS,ms.INTERACTIONS];function Rs(e,t=As){for(const s of t)$s(e,s)}function $s(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+n](e){return this._options[t].merge(e),this},["clear"+n](){return this._options[t].set(),this}})}var s}class Ns extends X{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new Is}}function Ps(e){return e?"view:"+e:"view"}Rs(Ns.prototype);class qs{constructor(){(this._events=new Z)._injectSubscribeInterface(this),this._states={},p(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,{silent:s=!1}={}){this._states[e]=Object.freeze(t),s||this._events.emit(e,t)}trigger(e,t){this._events.emit(e,t)}}class Ls{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:I(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function Us(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class js{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this.active&&(this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e}))}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...n}=e;this._emitResponse({session:t,request:n});try{const{signal:s}=this._ac||{},i={...e.options,signal:s},r=await this._source({session:t,...e,options:i});if(r&&r[Symbol.asyncIterator]){let e;for await(e of(r._response&&this._emitResponseWithSessionCheck({session:t,request:n,value:r._response}),r)){if(!Us(this._hub,t))break;this._emitResponse({session:t,request:n,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:n,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:n,error:e})}}_emitResponseWithSessionCheck(e){Us(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ds{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{c(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:zs,VIEWABLE:Ms,CLICK:Fs}=cs,{UNTRACKED:Bs,TRIGGERED:Qs}=_s,Gs=Object.freeze({[zs]:Bs,[Ms]:Bs,[Fs]:Bs});class Ws{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Gs}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||Bs}set(e,t,s){ps(t),function(e){if(e!==_s.UNTRACKED&&e!==_s.TRACKING&&e!==_s.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const n of u(e))this._setOne(n,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Qs))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const n=s(t);return e.set(t,n),n}(this._states,this._getKey(e),(()=>({...Gs}))))[t]=s}}const Hs=[Symbol("itemless")];class Ks{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Ws(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){ps(e);const{options:n}=this;if(!n)return;this._syncSession();const{deduplicated:i=!0,itemless:r=!1}=n;if(i){if(r&&(t=Hs),0===(t=this._states.untriggered(u(t),e)).length)return;this._states.set(t,e,_s.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:cs.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(h({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Ws(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[Ps(this._role)]}}for(const e of ls)Ks.prototype[e]=function(t,s){this._trigger(e,t,s)};class Vs{constructor(e,t){this._events=new Z({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),p(this,{role:t,interface:new Ys(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ds((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===is.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Ks({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((i=t)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=t,_={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...Zs(t)},d=(e={},t)=>{!1!==e&&this.updateState({..._,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:d})}catch(e){this._error(e),d({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?ds.ERRONEOUS:e.status;e=this._state=Object.freeze(h({...e,status:s}));const{role:n}=this;this.hub.update(Ps(n),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:n,meta:i,...r}=e,o={value:this._mapping(e,this),status:n,data:t,meta:i,...r};return this.role===is.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(t)}),h(o)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!os(s))return!1;let t=e&&e[s];if(s===is.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ys{constructor(e){d(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Zs(e){return function(e){return e.status===ds.READY&&!e.ongoing}(e)?{empty:!!Js(e)}:{}}function Js(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function Xs(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class en{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new Z({target:this,error:s}),p(this,{facets:new tn(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return h({facets:Object.freeze({}),sort:Xs(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(h({...e,...t,facets:Object.freeze(h({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset(){const e=this.states;this._states=void 0;const t=this._getStates();this._events.emit("reset",{states:t,oldStates:e})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class tn{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const sn=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function nn(e,t){return!!t&&{...e,...t}}class rn{constructor(e,{workflow:t,extensions:s,layouts:n,roles:i,options:r}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new en(this);for(const e of i.members)e!==is.CONTAINER&&(this._views[e]=new Vs(this,e));p(this,{interface:new on(this),trackers:new an(this,i.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),e.on("data",(e=>this.refresh({data:e}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Vs(this,is.CONTAINER);t.layout=this._createLayout(is.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,n]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName});if(t===is.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,n]=t;return this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:n}=t._inst;e&&(s=s.filter((t=>t.role===is.CONTAINER||e.includes(t.role)))),n&&(s=s.filter((e=>!n.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:n={},...i}=e;return h({...sn,...i,impression:nn(sn.impression,t),viewable:nn(sn.viewable,s),click:nn(sn.click,n)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=is.CONTAINER;this._containerTracker=new Ks({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class on{constructor(e){this._actor=e,d(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class an{constructor(e,t){this._views=e;for(const s of t)s!==is.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,is.CONTAINER,{get:()=>e._getContainerTracker()})}}class cn{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:cs.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class un{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=u(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function ln(e){return async({group:t,name:s,payload:n,options:i})=>{if(t===r.ASK)switch(s){case o.QUESTIONS:return e.api.ask.questions(n,i);case o.SEARCH:return e.api.ask.search(n,i)}return e.api[t]._run(s,n,i)}}class hn{constructor({role:e,workflow:t,...s}={}){p(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const n=this._rendered.get(e),i=C(!1);t=this._preprocess({state:t,rendered:n},{skip:i.t})||t,this._updatePending(t,s),i.value||this._handleInput({state:t,rendered:n},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,S((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),r=C([]),o=C({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function _n(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function dn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||fn)(e,t,s)+(i.descriptionBlock||yn)(e,t,s)+(i.priceBlock||wn)(e,t,s)+(i.ctaBlock||kn)(e,t,s)}</div>`}function pn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||fn)(e,t,s)+(i.descriptionBlock||yn)(e,t,s)+(i.priceBlock||wn)(e,t,s)}</div>`}function mn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||fn)(e,t,s)+(i.dateBlock||bn)(e,t,s)+(i.descriptionBlock||yn)(e,t,s)+(i.ctaBlock||kn)(e,t,s)}</div>`}function fn({className:e},{title:t}){return t?`<div class="${e}__item-title">${O(t)}</div>`:""}function gn({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function yn({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${O(s)}</div>`:""}function bn({className:e,templates:t},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${e}__item-date">${xn(r,t.date)}</div>`:""}function wn(e,t){const{className:s,templates:n}=e,{sale_price:i,original_price:r,currency:o="USD"}=t,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,u=t.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||vn)(e,{...t,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function vn(e,{discount_rate_percent:t}){return`(${t}% off)`}function En(e,t,s={}){const{className:n,templates:i}=e,{cover_image:r}=t;if(!r)return"";return`<div class="${n}__item-cover-image-container">${`<img class="${n}__item-cover-image" src="${r}">`}${s.brand?(i.brandBlock||gn)(e,t,s):""}</div>`}function Sn({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function kn(e,t,s){const{className:n,templates:i}=e,r=Cn.asFunction(i.cta)(e,t,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function On({className:e,options:t={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const{link:a={}}=t,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&n?"a":"div";return[`<${l} class="${e}__${i}" ${r?`data-role="${r}"`:""} ${s?`${ts}="${s}"`:""} ${!1!==o.link&&n?`href="${n}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const In=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Tn="en-US";function xn(e,t=In){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||In.locale,t);default:throw Error("Invalid date format: "+t)}}const Cn=Object.freeze({tagPair:On,formatDate:xn,formatNumber:function(e,t=Tn){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||Tn.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:O,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class An extends hn{constructor({className:e,templates:t,...s}={}){super(s),p(this,{className:e,templates:{..._n("root"),...t,helpers:Cn}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Rn extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Rn.MisoClient.ui.layouts.create("banner").render(this)}}class $n{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(e,{ac:s});let i=!1;try{await k(e,{...t,signal:n}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return i}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class Nn extends hn{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new $n}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Rn.tagName,s=this._shallRenderBanner(e),n=e.querySelector(t);s&&!n?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&n&&n.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,n=void 0!==s&&"auto"!==s?s:t;return"auto"===n?e.components.some((({role:e})=>function(e){return e===is.PRODUCTS||e===is.ANSWER}(e))):!!n}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1}={}}=t,o=[s,r?ds.EMPTY:ds.NONEMPTY];s===ds.READY&&o.push(n?ds.ONGOING:ds.DONE),e.setAttribute("status",o.join(" ")),i?e.setAttribute("miso-id",i):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===ds.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const Pn=Object.freeze({root:function(e,t){const{className:s,templates:n}=e,{status:i,value:r}=t;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class qn extends An{static get type(){return"error"}static get defaultTemplates(){return Pn}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...Pn,...t},...s})}}const Ln=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Un(e,t){const s=[];for(const n of t.entries){const t=e.e2b.get(n.element);t&&t.key===n.key||s.push(n)}return s}class jn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const n=function(e,t,s){const n=new Map,i=new Map,r=[];for(let o=0;e.length>o;o++){const a=e[o],c=s[o],u=Object.freeze({index:o,key:a,value:t[o],element:c});n.set(a,u),i.set(c,u),r.push(u)}return{k2b:n,e2b:i,entries:r}}(e,t,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Un(i,n),o=Un(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function Dn(e){M(e,zn.prototype)}class zn{_initTrackable(){this._bindings=new jn,this._viewables=new $n}_syncBindings(e,t){const s=this._getItems(t)||[],n=s.map((e=>this._getItemKey(e))),i=this._getItemElements(e),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:n}of e)(async()=>{await this._viewables.track(n,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||0===t.button&&!t.defaultPrevented&&!!v(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&this._view.tracker.click([t.value])}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Mn{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===ds.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let n=!1;try{await k(t,{area:1,duration:0,signal:s.signal}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Fn=Object.freeze({product:function(e,t,s,n){const{templates:i}=e,[r,o]=On(e,s);return""+r+(i.imageBlock||En)(e,s,n)+(i.infoBlock||i.productInfoBlock||pn)(e,s,n)+o},article:function(e,t,s,n){const{templates:i}=e,[r,o]=On(e,s);return""+r+(i.imageBlock||En)(e,s,n)+(i.infoBlock||i.articleInfoBlock||mn)(e,s,n)+(i.indexBlock||Sn)(e,s,n)+o},question:function(e,t,s){const[n,i]=On(e,s);return`${n}${s.value||s.text||s}${i}`},root:function(e,t){const{className:s,role:n,templates:i}=e,{status:r}=t;return`<div class="${s} ${r}" ${n?`data-role="${n}"`:""}>${r===ds.READY?i[r](e,t):""}${i.trigger(e,t)}${i.loading(e,t)}</div>`},[ds.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t);return n&&n.length>0||t.ongoing?s.list(e,t,n):s.empty(e,t)},empty:()=>"",list:function(e,t,s){const{className:n,templates:i,options:r}=e,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list" data-item-type="${r.itemType}">${i.items(e,t,s)}</${o}>`},ordered:!1,items:function(e,t,s,{offset:n=0}={}){const{templates:i}=e;let r=n;return s.map((s=>i.item(e,t,s,r++))).join("")},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item">${r[a](e,t,s,{index:n})}</li>`},productInfoBlock:pn,articleInfoBlock:mn,brandBlock:gn,titleBlock:fn,descriptionBlock:yn,dateBlock:bn,priceBlock:wn,discountRateText:vn,ctaBlock:kn,cta:function(e,t,s){const{templates:n}=e,{url:i}=t;if(!i)return"";const[r,o]=On(e,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Cn.asFunction(n.ctaText)(e,t,s);return a?`${r}${a}${o}`:""},imageBlock:En,indexBlock:Sn,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Bn extends An{static get defaultTemplates(){return Fn}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Fn,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=this._html(e,t,s);return{...e,incremental:s,html:n}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:n,html:i}=t;if(n)if(i){this._getListElement(e).insertAdjacentHTML("beforeend",i)}else s(!1);else e.innerHTML=i}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:n,element:i}=t;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Dn(Bn.prototype),M(Bn.prototype,Mn.prototype);const Qn="miso-list";class Gn extends Bn{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Qn}constructor({className:e=Qn,...t}={}){super({className:e,...t})}}const Wn="miso-cards";const Hn="miso-carousel",Kn=Object.freeze({ready:function(e,t){const{templates:s}=e,n=e._getItems(t),i=n&&n.length>0,r=Object.getPrototypeOf(e.constructor).defaultTemplates.ready(e,t);return i?s.carousel(e,t,r):r},carousel:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-previous" data-role="previous">${i.previous(e,t)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(e,t)}</div>`},previous:Yn,next:Yn}),Vn=Object.freeze({...Bn.defaultTemplates,...Kn});function Yn(e){const{className:t}=e;return`<svg class="${t}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Zn="miso-ui-icon",Jn=Zn+"-svg-1_11_4",Xn={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},ei=`<symbol id="${Zn}-${Xn.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ti=`<symbol id="${Zn}-${Xn.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,si=`<symbol id="${Zn}-${Xn.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,n=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-n} ${n}L${n} ${t-n}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,ni=`<svg id="${Jn}" style="display:none;">${[ei,ti,si].join("")}</svg>`;let ii=!1;function ri(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${Zn}-${e}"></use></svg>`}ii||document.head.querySelector("#"+Jn)||(ii=!0,document.head.insertAdjacentHTML("beforeend",ni));const oi=new Set(Object.values(Xn));ri(Xn.SEND),ri(Xn.SEARCH);const ai=ri(Xn.TRIANGLE),ci="miso-search-box";const ui=Object.freeze({root:function(e){const{className:t,templates:s,role:n,options:i,autocomplete:r}=e,{placeholder:o}=i;return`\n<div class="${t}" ${n?`data-role="${n}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=t;var r;return("function"==typeof n?n(e):""+n)+("function"==typeof i?i(e):(oi.has(r=i)?ri(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:n,autocomplete:i}=e;e={templates:s,workflow:n,...i};const r=[],o=[];for(const e of t)(e.product?r:o).push(e);return s.queries(e,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__${t}-list" data-role="${t}-list">${s.map((s=>i.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:n,templates:i}=e;return`\n<li class="${n}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${i[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||O(t)},product:function(e,{product:t}){const{templates:s}=e,[n,i]=s.helpers.tagPair(e,t,{role:!1});return""+n+s.imageBlock(e,t)+s.productInfoBlock(e,t)+i},imageBlock:En,productInfoBlock:pn}),li=Object.freeze({className:"miso-autocomplete",debounce:300});class hi extends An{static get type(){return"search-box"}static get defaultTemplates(){return ui}static get defaultClassName(){return ci}constructor({className:e=ci,templates:t,autocomplete:s,...n}={}){super({className:e,templates:{...ui,...t},...n}),p(this,{autocomplete:{...li,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=j(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:n}){if(!t.completions)return;const{status:i=ds.INITIAL,session:r,value:o}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(e),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);e.classList[l.length>0?"add":"remove"]("nonempty"),u.setAttribute("data-status",i),u.innerHTML=this.templates.completions(this,l),n({completions:{index:a,status:i}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return _i.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new _i(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&v(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let n=t;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const t=n.getAttribute("data-index"),i=this._context().data.get(parseInt(t)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[cs.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class _i{static empty(){return _i._empty||(_i._empty=new _i)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,n=[];for(const i in e)for(const r of e[i])r.product&&!r.product.url||(r._index=t,r._field=i,s.set(t,r),n.push(r),t++);return n}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const di="miso-option-list";const pi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:n}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>n.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${O(t.text||t)}</li>`}});class mi extends An{static get type(){return"option-list"}static get defaultTemplates(){return pi}static get defaultClassName(){return di}constructor({className:e=di,templates:t,...s}={}){super({className:e,templates:{...pi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:n}=t;this._syncOptionValues(e,n)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;const n=this._getItems(t)||[];s.classList[0===n.length?"add":"remove"]("empty")}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;n&&(this._trackClick(e,s),this._submit(n.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}Dn(mi.prototype);const fi=Object.freeze({..._n("options"),root:function(e){const{className:t,role:s,templates:n}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${n.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:n}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${n.content(e,t)}\n</div>\n`}});class gi extends An{static get defaultTemplates(){return fi}constructor({className:e,templates:t,field:s,defaultValue:n,...i}={}){super({className:e,templates:{...fi,...t},...i}),this._field=s,this._defaultValue=n}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=v(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=t.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],S((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:n}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",n),this._state=void 0}_select(e){this._submit({value:e})}_clear(){this._submit({unselected:!0})}async _submit(e){this._view.hub.update(this._field,e)}}const yi="miso-feedback",bi=["helpful","unhelpful"];const wi=Object.freeze({options:function(e){const{templates:t}=e;return bi.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:n,options:i={}}=e;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(e,t)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class vi extends gi{static get type(){return"feedback"}static get defaultTemplates(){return wi}static get defaultClassName(){return yi}constructor({className:e=yi,templates:t,...s}={}){if(super({className:e,templates:{...wi,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Ei="miso-text";const Si=Object.freeze({root:function(e,{value:t}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=e,o=n?`data-role="${n}"`:"",a=void 0!==t?O(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:n}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[i,r]=t;switch(i){case"date":return e=>s(e,r);case"number":return e=>n(e,r);default:return e=>""+e}}(e)(t)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class ki extends An{static get type(){return"text"}static get defaultTemplates(){return Si}static get defaultClassName(){return Ei}constructor({className:e=Ei,templates:t,tag:s="p",...n}={}){super({className:e,templates:{...Si,...t},tag:s,...n})}}class Oi extends hn{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=C(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Ii{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=t.substring(0,s),u=!n.startsWith(c);return a||u?e.innerText=n:e.insertAdjacentText("beforeend",n.substring(s,i)),a&&e.classList.add("done"),{cursor:i,done:a}}}function Ti(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=e;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[t,xi(t)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(e));const n=t.children[0];return n.setAttribute("data-status",s||ds.INITIAL),n}function xi(e){return e+"__cursor"}function Ci(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Ai(n[0])}, ${Ai(n[1])})`,t,""+r,i,o)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Ai(e){return Math.floor(100*e)/100+"ms"}const Ri="miso-typewriter";class $i extends Oi{static get type(){return"typewriter"}static get defaultClassName(){return Ri}constructor({className:e=Ri,tag:t="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:t,format:s,tooltip:n,...a}),p(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:G({speed:i,acceleration:r}),this._readiness=new R,"markdown"===s&&$i.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=xi(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:n,onDebug:Ci(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Ii}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=e,a=n&&n.answer_stage||"result",c=(l=e,(u=t)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const _=t?c&&a===t.stage?t.streak:t.streak+1:0,d=c&&t&&t.doneAt||(r!==ds.READY||o?void 0:Date.now());return this._prevState=Object.freeze(h({session:i,status:r,value:s,stage:a,streak:_,doneAt:d,done:void 0!==d}))}_render(e,{state:t,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=Ti(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(o,s,{...t,cursor:e})}i(a);const u=t.status===ds.READY&&!a.done;n({ongoing:u},{silent:u&&(!s||s.status===ds.READY)&&!c}),u&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{index:e}))}const n=t.closest("a");if(n){if(!e.defaultPrevented){const{href:e,innerText:t,className:s}=n;e&&this._view._events.emit("link-click",h({url:e,text:t?t.trim():"",className:s||"",attributes:Ni(n)}))}}else;}}function Ni(e){const{attributes:t}=e,s={};for(const{name:e,value:n}of t)e.startsWith("data-")&&(s[e]=n);try{return JSON.stringify(s)}catch(e){return"{}"}}const Pi="miso-affiliation";const qi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e,{status:r}=t,o=n?` data-role="${n}"`:"",a=t.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=e._getItems(t),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===ds.READY?i[r](e,t):""}</div>`},[ds.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t);return n&&n.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}-container">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return ai},body:function(e,t){const{className:s,templates:n}=e,i=e._getItems(t);return`<div class="${s}__body">${n.list(e,t,i)}</div>`},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(e,t,s,{index:n})}${r[a](e,t,s,{index:n})}</div></li>`},itemHeader:function(e,t,s,n){const{className:i,templates:r}=e;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=Cn.asFunction(o)(e,t,s,n),a=Cn.asFunction(a)(e,t,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,n){const{templates:i}=e,[r,o]=On(e,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||dn)(e,s,n)+(i.imageBlock||En)(e,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,n){const{className:i,templates:r}=e,o=Cn.asFunction(r.logoText)(e,t,s,n)||"",a=Cn.asFunction(r.logoImg)(e,t,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(e,t,s,n){const{className:i,templates:r}=e,o=Cn.asFunction(r.logoUrl)(e,t,s,n);if(!o)return"";const a=Cn.asFunction(r.logoAltText)(e,t,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Li=Object.freeze({...Bn.defaultTemplates,...qi});class Ui extends Bn{static get type(){return"affiliation"}static get defaultTemplates(){return Li}static get defaultClassName(){return Pi}constructor({className:e=Pi,templates:t,autoplay:s,...n}={}){super({className:e,itemType:"affiliation",templates:{...qi,...t},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new te(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,S((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(this._displayedCount=s,void 0===s?n.removeAttribute("data-item-count"):n.setAttribute("data-item-count",s))}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const ji="miso-facets",Di="miso-facet",zi="custom_attributes.";const Mi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:n={}}=t.value||{};return Object.keys(n).map((i=>s.facet(e,{field:i,entries:n[i]},t)))},facet:function(e,t,s){const{facetClassName:n=Di,templates:i}=e,{field:r}=t;return`<div class="${n}" data-role="facet" data-field="${O(r)}">${i.header(e,t,s)}${i.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:n=Di,templates:i}=e;return`<div class="${n}__header">${i.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(zi)&&(t=t.substring(18)),O(t)},options:function(e,{field:t,entries:s},n){const{facetClassName:i=Di,templates:r}=e;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(e,{field:t,value:s,count:i},n))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:n=Di,templates:i}=e;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(e,t,s)}</span>\n  <span class="${n}__count">${i.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return O(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function Fi(e,t){return`${e}:::${t}`}function Bi(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class Qi extends An{static get type(){return"facets"}static get defaultTemplates(){return Mi}static get defaultClassName(){return ji}constructor({className:e=ji,templates:t,...s}={}){super({className:e,templates:{...Mi,...t},...s}),this._bindings=new jn}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=Bi(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)this._setSelected(n,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=Bi(e.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)t[e]&&this._setSelected(n,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),n=[],i=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),o=s[e];if(!o)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=o[t];if(!c)break;n.push(Fi(e,c)),i.push({field:e,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[O(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Gi="miso-select";const Wi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e,r=n?`data-role="${n}"`:"",o=e._getItems(t),a=o.find((e=>e.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(e,a)}\n  ${i.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:n}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:n}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>n.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:n}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${n.text(e,t)}</li>`},text:function(e,t){return O(t&&t.text&&t.text.replace(/[-_][a-zA-Z]/g," $1")||t||"")}});class Hi extends An{static get type(){return"select"}static get defaultTemplates(){return Wi}static get defaultClassName(){return Gi}constructor({className:e=Gi,templates:t,...s}={}){super({className:e,templates:{...Wi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}Dn(Hi.prototype);const Ki="miso-more-button";const Vi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${t.status!==ds.READY?" disabled":""}>\n  ${i.text(e)}\n</div>\n`},text:function(e){return"More"}});class Yi extends An{static get type(){return"more-button"}static get defaultTemplates(){return Vi}static get defaultClassName(){return Ki}constructor({className:e=Ki,templates:t,...s}={}){super({className:e,templates:{...Vi,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var Zi=Object.freeze({__proto__:null,TemplateBasedLayout:An,ContainerLayout:Nn,ErrorLayout:qn,BannerLayout:class extends An{static get type(){return"banner"}static get defaultTemplates(){return Ln}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Ln,...t},...s})}},CollectionLayout:Bn,ListLayout:Gn,CardsLayout:class extends Bn{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Wn}constructor({className:e=Wn,...t}={}){super({className:e,...t})}},CarouselLayout:class extends Bn{static get type(){return"carousel"}static get defaultTemplates(){return Vn}static get defaultClassName(){return Hn}constructor({className:e=Hn,templates:t,...s}={}){super({className:e,templates:{...Kn,...t},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(e,t,s){super._render(e,t,s);const{state:n}=t,i=this._getItems(n);this._itemCount=i?i.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const e=this._findGridElement();if(!e)return;const t=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(e).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(t/s))}_setPage(e){if(0>e?e=this._pageCount-1:this._pageCount>e||(e=0),e===this._page)return;this._page=e;const t=this._findGridElement();if(t){t.style.setProperty("grid-template-rows",(0===e?"":`repeat(${e}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:e}=this._view;return e&&e.querySelector(`.${this.className}__list`)}_onClick(e){super._onClick(e);const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:hi,OptionListLayout:mi,FeedbackLayout:vi,TextLayout:ki,TypewriterLayout:$i,AffiliationLayout:Ui,FacetsLayout:Qi,SelectLayout:Hi,MoreButtonLayout:Yi});function Ji(e){return e&&e.value&&e.value.revision}function Xi(e){const t=function(e){if(!e)return ds.INITIAL;const{request:t,error:s,value:n}=e;return s?ds.ERRONEOUS:n?ds.READY:t?ds.LOADING:ds.INITIAL}(e);return h({status:t,ongoing:t===ds.READY?e.ongoing:void 0,...e})}function er(e){const{request:t,value:s}=e;if(!t)return e;const{payload:n}=t||{},{q:i}=n||{};return i?{...e,value:{...s,keywords:i}}:e}function tr(e){const{role:t,type:s,items:n}=e,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:h({property:t})}};switch(function(e){return hs.has(e)}(s)&&(!function(e){return as.has(e)}(t)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((e=>e.text||e.id||e))):i.product_ids=(n||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case cs.SUBMIT:i.context.custom_context.value=e.value;break;case cs.FEEDBACK:i.context.custom_context.value=i.value=e.value,i.context.custom_context.result_type=i.result_type=e.result_type}return h(i)}function sr(e={},t={}){return h({...e,...t,context:h({...e.context,...t.context,custom_context:h({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const nr=Object.freeze({}),ir=Object.freeze({[is.CONTAINER]:Nn.type,[is.ERROR]:qn.type}),rr=Object.freeze({}),or=Object.freeze({api:nr,layouts:ir,trackers:rr}),ar=Object.freeze({mappings:{[is.ERROR]:e=>e.error}});class cr extends X{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:n,defaults:i,options:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=n=n||t._client,e=Object.freeze({...e,plugin:s,client:n}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=r||new Ts(t&&t._options,i),this._hub=function(e,t){const{update:s,trigger:n}=e;return e.update=(n,i,r)=>(r&&r.silent||t("update",n,i,r),s.call(e,n,i,r)),e.trigger=(...s)=>(t("trigger",...s),n.apply(e,s)),e}(new qs,((...e)=>this._log(...e))),this._sessionContext=new WeakMap,this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new Ls(s),this._data=new js(s,{source:ln(n),options:i}),this._views=new rn(s,{extensions:r,layouts:o,roles:t,options:i,workflow:e}),this._interactions=new un(s,{client:n,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(Ps(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[Ps(e)]||{};t.session&&t.status===ds.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===ds.READY,n=t===ds.ERRONEOUS;this._emitLifecycleEvent(n?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||n)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(e);return n.add(e),!i}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Xt(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=Ji(e);if(!_(s)){const e=Ji(this._hub.states.data);if(!_(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=Xi(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:ds.READY,session:this.session,...t},this._hub.update(Ps(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=tr(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)t=n(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==is.AFFILIATION)return e;const{items:s}=t;return sr(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return sr(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[Ps(t.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?sr(e,{miso_id:n}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_log(e,t,s){this._emit(t,{_action:e,...s})}_emit(e,t){this._events.emit(e,t),this._context&&this._context._events.emit(e,{workflow:this,...t})}}function ur(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:lr(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:n}=t;if(!n)return e;n=n.map((e=>({...e})));let i=0;for(const e of n)s&&(e.channel=s),e.position=i++;return{...e,affiliation:{...t,products:n}}}(e)}function lr({products:e,...t}){return{channel:"sovrn",...t,products:e.map(hr)}}function hr({id:e,deeplink:t,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,..._}){return h({id:"sovrn-"+e,title:s,description:n,cover_image:c,url:t,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:_r({sovrn_id:e,thumbnail:u,merchant:l,..._})})}function _r(e,t=""){return Object.keys(e).reduce(((s,n)=>{const i=e[n];if(void 0===i)return s;const r=t?`${t}_${n}`:n;return"object"==typeof i?{...s,..._r(i,r)}:{...s,[r]:i}}),{})}function dr(e){M(e,pr.prototype)}Rs(cr.prototype),Object.assign(cr,{DEFAULT_API_OPTIONS:nr,DEFAULT_LAYOUTS:ir,DEFAULT_TRACKERS:rr,DEFAULT_OPTIONS:or,ROLES_OPTIONS:ar});class pr{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=t;else{window.open(t,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl(e){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e.q)}}const mr=Object.freeze({...cr.DEFAULT_API_OPTIONS,group:r.ASK,payload:{...cr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),fr=Object.freeze({actor:!1,api:{group:r.ASK,name:o.AUTOCOMPLETE}}),gr=Object.freeze({...cr.DEFAULT_LAYOUTS,[is.QUERY]:[hi.type,{placeholder:"Ask a question"}],[is.QUESTION]:[ki.type,{tag:"h2"}],[is.ANSWER]:$i.type,[is.FEEDBACK]:vi.type,[is.SOURCES]:[Gn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[is.AFFILIATION]:[Ui.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),yr=Object.freeze({...cr.DEFAULT_TRACKERS,[is.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:ws.click},[is.SOURCES]:ws,[is.AFFILIATION]:ws,[is.PRODUCTS]:ws}),br=Object.freeze({...cr.DEFAULT_OPTIONS,api:mr,autocomplete:fr,layouts:gr,trackers:yr}),wr=Vt(cr.ROLES_OPTIONS,{main:is.ANSWER,members:Object.keys(gr)});class vr extends cr{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new cn(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(is.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(is.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[Ps(this._roles.main)]||{};e.session&&e.status!==ds.INITIAL&&(e.status!==ds.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,n=t===ds.READY&&!e.ongoing,i=t===ds.ERRONEOUS,r=n?"done":i?"error":t,o=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,e),(n||i)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){const{setValue:t,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:e=!0,focus:t=!0,param:s="q",sourceParam:n="qs",...i}={}){return{setValue:e,focus:t,param:s,sourceParam:n,...i}}(e),r=new URLSearchParams(window.location.search),o=r.get(n),a=r.get(i),{layout:c}=this._views.get(is.QUERY);c&&(o&&t&&(c.value=o),!o&&s&&c.focus()),o&&this.query({q:o,qs:a})}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||ns}_buildPayload(){throw Error("Not implemented")}_updateData(e){!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){this._writeQuestionIdFromData(e)}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:ur(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){if(!e)return;const{question_id:t}=e;this._writeQuestionId(t)}_updateUrlIfNecessary({value:e,request:t}){if(!e||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{param:s}=this._autoQuery,{question:n}=e,i=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source===ns,r=new URL(window.location);n===r.searchParams.get(s)||i&&!0!==this._autoQuery.updateUrl||(r.searchParams.set(s,n),window.history.replaceState({},"",r))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=this._writeAnswerClickInteraction(e,t)}_writeAskPropertiesToInteraction(e={},t){return sr(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==is.ANSWER)return e;console.log("writeAnswerClickInteraction",e,t);const{items:s=[]}=t;return sr(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[Ps(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e}){const{value:t}=this.states.data||{},{sources:s}=t||{},n=s&&s[e-1];n&&n.product_id&&this._views.trackers.sources.click([n.product_id])}_onAnswerLinkClick(e){this._views.trackers.answer.click([],{items:[e]})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}dr(vr.prototype),Object.assign(vr,{DEFAULT_API_OPTIONS:mr,DEFAULT_AUTOCOMPLETE_OPTIONS:fr,DEFAULT_LAYOUTS:gr,DEFAULT_TRACKERS:yr,DEFAULT_OPTIONS:br,ROLES_OPTIONS:wr});const Er=Object.freeze({...vr.DEFAULT_API_OPTIONS,name:o.QUESTIONS,payload:{...vr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Sr=Object.freeze({...vr.DEFAULT_LAYOUTS,[is.QUERY]:[hi.type,{templates:{buttonIcon:"send"}}],[is.RELATED_RESOURCES]:[Gn.type,{incremental:!0,itemType:"article"}],[is.QUERY_SUGGESTIONS]:mi.type}),kr=Object.freeze({...vr.DEFAULT_TRACKERS,[is.RELATED_RESOURCES]:ws,[is.QUERY_SUGGESTIONS]:{...ws,click:{...ws.click,validate:e=>0===e.button}}}),Or=Object.freeze({...vr.DEFAULT_OPTIONS,api:Er,layouts:Sr,trackers:kr}),Ir=Vt(vr.ROLES_OPTIONS,{members:Object.keys(Sr)});class Tr extends vr{constructor(e,t){super({name:"ask",context:e,roles:Ir,defaults:Or,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;p(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:n}=this;return h({...s,question:e,parent_question_id:n,_meta:{...s._meta,question_source:t||ns}})}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let n,i,r,{property:o}=e.context&&e.context.custom_context||{};return t.role===is.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(t)),sr(e,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class xr extends Ns{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Tr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Tr(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const Cr=Object.freeze({...cr.DEFAULT_API_OPTIONS,group:r.SEARCH,payload:{...cr.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Ar=Object.freeze({...cr.DEFAULT_LAYOUTS,[is.QUERY]:[hi.type],[is.PRODUCTS]:[Gn.type,{incremental:!0,infiniteScroll:!0}],[is.KEYWORDS]:[ki.type,{raw:!0}],[is.TOTAL]:[ki.type,{raw:!0,format:"number"}],[is.FACETS]:[Qi.type],[is.SORT]:[Hi.type],[is.MORE]:[Yi.type]}),Rr=Object.freeze({...cr.DEFAULT_TRACKERS,[is.PRODUCTS]:ws}),$r=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Nr=Object.freeze({...cr.DEFAULT_OPTIONS,api:Cr,layouts:Ar,trackers:Rr,pagination:$r}),Pr=Vt(cr.ROLES_OPTIONS,{main:is.PRODUCTS,members:Object.keys(Ar),mappings:{[is.FACETS]:"facet_counts",[is.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=t.states.filters||{},r=i&&i.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(n).field;return r?n.map((e=>({...e,selected:e.field===r}))):n}}});class qr extends cr{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(is.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==ds.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:n}=t||{};return h({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const n=e[s];n&&n.length&&(t[s]={terms:n})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return u(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},n=s.map((e=>e.product_id)).filter((e=>e)),i=[...e.exclude||[],...n];return 0===i.length?e:{...e,exclude:i}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:n}=e;switch(s){case ds.INITIAL:case ds.LOADING:break;default:return e}return n&&n.facet_counts?e:{...e,value:{...n,facet_counts:t}}}(e=er(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=is.PRODUCTS}={}){const{status:s,request:n,value:i}=e;if(s!==ds.READY||!n||!i)return e;const{[t]:r}=i;if(!r)return e;const{rows:o}=n.payload,{length:a}=r;return o>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=is.PRODUCTS}={}){if(!t.value)return e;const{[s]:n=[],facet_counts:i,total:r}=e.value,{[s]:o=[]}=t.value;return{...t,facet_counts:i,total:r,value:{...t.value,[s]:[...n,...o]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}Rs(qr.prototype,[ms.PAGINATION,ms.FILTERS]),Object.assign(qr,{DEFAULT_API_OPTIONS:Cr,DEFAULT_LAYOUTS:Ar,DEFAULT_TRACKERS:Rr,DEFAULT_PAGINATION:$r,DEFAULT_OPTIONS:Nr,ROLES_OPTIONS:Pr});const Lr=Object.freeze({members:[]});function Ur({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function jr(e){return e&&e.value&&e.value.trim()||void 0}class Dr extends cr{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:Ur(t),roles:Lr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,jr(e)===jr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!jr(e))return void this._updateCompletions({session:s,status:ds.INITIAL});const n=this._buildPayload(e);this._request({payload:n})}_buildPayload(e){return{q:jr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function zr(e){M(e,Mr.prototype)}class Mr{_initAutocomplete(e){this._autocomplete=new Dr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Fr=Vt(vr.ROLES_OPTIONS,{mappings:{[is.QUESTION]:is.KEYWORDS}});class Br extends vr{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:Fr,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset(),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||ns}}}_defaultProcessData(e){return e=er(e=super._defaultProcessData(e))}_updateDataInHub(e){switch(e.status){case ds.INITIAL:case ds.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}zr(Br.prototype);const Qr={...qr.ROLES_OPTIONS,members:[is.PRODUCTS,is.KEYWORDS,is.TOTAL,is.FACETS,is.SORT,is.MORE,is.ERROR]};class Gr extends qr{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:Qr,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:h({...e._meta,question_id:this._superworkflow._answer.questionId})}}}Object.assign(Gr,{ROLES_OPTIONS:Qr});class Wr{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return Gr.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,n=this._getSubviews(s);if(!n._containers.has(e)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(e)){for(const n of e.components)if(s.containsElement(n))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}n.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const Hr=Object.freeze({group:r.ASK,name:o.SEARCH,payload:{...vr.DEFAULT_API_OPTIONS.payload,...qr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Kr=Object.freeze({...vr.DEFAULT_LAYOUTS,...qr.DEFAULT_LAYOUTS,[is.QUERY]:[hi.type,{placeholder:""}],[is.QUESTION]:[ki.type,{raw:!0}]}),Vr=Object.freeze({...vr.DEFAULT_TRACKERS,...qr.DEFAULT_TRACKERS}),Yr=Object.freeze({...qr.DEFAULT_PAGINATION,active:!0}),Zr=Object.freeze({api:{group:r.ASK,name:o.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Jr=Object.freeze({...vr.DEFAULT_OPTIONS,...qr.DEFAULT_OPTIONS,api:Hr,layouts:Kr,trackers:Vr,autocomplete:Zr,pagination:Yr}),Xr=Object.freeze({main:is.PRODUCTS,members:Object.keys(Kr),mappings:Object.freeze({...vr.ROLES_OPTIONS.mappings,...qr.ROLES_OPTIONS.mappings})});class eo extends cr{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Xr,defaults:Jr})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new Br(this),this._results=new Gr(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){const e=this._hub,t=this._client,s=this._options;this._views=new Wr(this),this._interactions=new un(e,{client:t,options:s})}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return this._answer._defaultProcessInteraction(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}Rs(eo.prototype,[ms.PAGINATION,ms.FILTERS]);const to=Object.freeze({...cr.DEFAULT_API_OPTIONS,group:r.ASK,name:o.RELATED_QUESTIONS}),so=Object.freeze({...cr.DEFAULT_LAYOUTS,[is.RELATED_QUESTIONS]:[Gn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[is.QUERY]:[hi.type,{placeholder:"Ask a question"}]}),no=Object.freeze({...cr.DEFAULT_TRACKERS,[is.RELATED_QUESTIONS]:ws,[is.CONTAINER]:{...ws,itemless:!0},[is.QUERY]:{[cs.SUBMIT]:{active:!0}}}),io=Object.freeze({...cr.DEFAULT_OPTIONS,api:to,layouts:so,trackers:no}),ro=Vt(cr.ROLES_OPTIONS,{main:is.RELATED_QUESTIONS,members:Object.keys(so)});class oo extends cr{constructor(e,t){super({name:"explore",plugin:e,client:t,roles:ro,defaults:io})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(is.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(e){const{product_id:t}=e;return t&&(this._productId=t),super.useApi(e)}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=is.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e},{generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage(e)}_getSubmitUrl(e,{generated:t=!1}={}){let s=pr.prototype._getSubmitUrl.call(this,e);return t&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}dr(oo.prototype);const ao=Object.freeze({group:r.SEARCH,name:o.SEARCH,payload:{fl:["*"]}}),co=Object.freeze({api:{group:r.SEARCH,name:o.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),uo=Object.freeze({...qr.DEFAULT_LAYOUTS}),lo=Object.freeze({...qr.DEFAULT_TRACKERS}),ho=Object.freeze({...qr.DEFAULT_OPTIONS,api:ao,autocomplete:co,layouts:uo,trackers:lo}),_o=qr.ROLES_OPTIONS;class po extends qr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:_o,defaults:ho})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}autoQuery({setValue:e=!0,focus:t=!0,param:s="q"}={}){const n=new URLSearchParams(window.location.search).get(s),{layout:i}=this._views.get(is.QUERY);i&&(n&&e&&(i.value=n),!n&&t&&i.focus()),n&&this.query({q:n})}notifyViewUpdate(e=is.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._feedback._destroy(),this._destroyAutocomplete(),super._destroy(e)}}zr(po.prototype);const mo=Object.freeze({...cr.DEFAULT_API_OPTIONS,group:r.RECOMMENDATION,name:o.USER_TO_PRODUCTS,payload:{...cr.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),fo=Object.freeze({...cr.DEFAULT_LAYOUTS,[is.PRODUCTS]:Gn.type}),go=Object.freeze({...cr.DEFAULT_TRACKERS,[is.PRODUCTS]:ws}),yo=Object.freeze({...cr.DEFAULT_OPTIONS,api:mo,layouts:fo,trackers:go}),bo=Vt(cr.ROLES_OPTIONS,{main:is.PRODUCTS,members:Object.keys(fo)});class wo extends cr{constructor(e,t){super({name:"recommendation",context:e,roles:bo,defaults:yo,id:t})}_initProperties(e){super._initProperties(e);const{id:t}=e;p(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}start(){return this._request(),this}notifyViewUpdate(e=is.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return sr(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}class vo extends Ns{constructor(e,t){super("recommendations",e,t),this._members=new Map}workflows(){return[...this._members.values()]}create(e=ss){if(this._members.has(e))throw Error("Unit already exists: "+e);return new wo(this,e)}has(e=ss){return this._members.has(e)}get(e=ss){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||new wo(this,e)}}class Eo extends X{constructor({name:e,plugin:t,MisoClient:s,...n}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new R)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var So=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var ko=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Oo{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Io{constructor(e){this._context=e,p(this,{lowerCamelToKebab:g,kebabToLowerCamel:m,kebabOrSnakeToLowerCamel:f})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...n}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=f(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:n=!1}){const{classPrefix:i}=e;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${t}-phrase">${this.phraseText(e,m(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,n=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof n){case"function":return n(e);case"string":return n;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${e}__${n}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const n=t[e];void 0!==n&&(s+=` ${g(e)}="${n}"`)}return s}}const To=F(new Io({...So,DEFAULT_PHRASES:ko})),xo=F(new class extends Oo{constructor(){super({helpers:To})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=e;return n(e,{name:"related-resources"},!1===i.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:n={}}=e;return!1===n.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:To}));function Co(e={}){const{normalizeOptions:t,section:s,container:n}=To,{querySuggestions:i,answerGroup:r}=xo;return s(e=t(e),{name:"follow-up"},[i(e),n(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(e)])}var Ao=Object.freeze({__proto__:null,helpers:To,sections:xo,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=To,{followUps:i,relatedResourcesSection:r,answerGroup:o}=xo;return""+s(e=t(e),{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},o(e))+i(e)+r(e)},followUp:Co});const Ro=Object.freeze(So),$o=Object.freeze(ko),No=Object.freeze(Ao);var Po=Object.freeze({__proto__:null,constants:Ro,phrases:$o,templates:No,wireFollowUps:function(e,t,{template:s=Co,...n}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const i=e.ui.asks,r=e.ui.ask;i.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:e.workflow.questionId}))})),r.on("loading",(()=>{t.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:qo}=document,Lo=Object.freeze({templates:No,autostart:!0}),Uo=["templates","phrases","features"];class jo{constructor(){this._defaults=Lo,this._scriptSrc=function(){if(!qo||!qo.src)return{};const e=document.createElement("a");e.href=qo.src;const t={};for(const[s,n]of new URLSearchParams(e.search))"q"!==s&&(t[s]=Mo(n));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=Mo(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:n,...i}={}){return h({apiKey:e,apiHost:t,templates:Fo(s),phrases:n,...i})}(Do(this._defaults,this._scriptSrc,e,this._pageUrl))}}function Do(...e){let t={};for(const s of e)s&&(t=zo(t,s));return t}function zo(e,t){if(!t)return e;Object.assign(e,t);for(const s of Uo)s in t&&(e[s]={...e[s],...t[s]});return e}function Mo(e){return""===e||"false"!==e&&e}function Fo(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(Fo):function(e,t){const s={};for(const[n,i]of Object.entries(e))s[n]=t(i);return s}(e,Fo);default:throw Error("Unsupported template type: "+e)}}class Bo{constructor(e,{classPrefix:t=Ro.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");p(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class Qo extends Eo{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new jo,this._localOptions={}}config(e={}){e=Do(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;p(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new Bo(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=e.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,u=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(t,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),u.autoQuery()}}class Go extends ee{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let Wo,Ho,Ko;async function Vo(e){const t=await async function(e){return e.MisoClient||window.MisoClient||Wo||(Wo=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return Ho=Ho||t.any(),Ko=Ko||await Ho,Ko.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),Ko}const Yo="logo",Zo="auto",Jo=Object.freeze([Yo]);function Xo(e){if(!e)return Zo;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class ea extends HTMLElement{static get observedAttributes(){return Jo}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Xo(this.getAttribute(Yo))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Zo:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(Yo,t):this.removeAttribute(Yo)}async connectedCallback(){const e=this._client=await Vo(ea);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===Yo)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){Xo(e)!==Xo(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const ta="parent-question-id",sa=Object.freeze([...ea.observedAttributes,ta]);const na="unit-id",ia=Object.freeze([...ea.observedAttributes,na]);var ra=Object.freeze({__proto__:null,MisoAskElement:class extends ea{static get tagName(){return"miso-ask"}static get observedAttributes(){return sa}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(ta)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(ta,e):this.removeAttribute(ta))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===ta)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends ea{static get observedAttributes(){return ea.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(e){return e.ui.explore}},MisoHybridSearchElement:class extends ea{static get observedAttributes(){return ea.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends ea{static get observedAttributes(){return ea.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends ea{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return ia}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}get unitId(){return this.getAttribute(na)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(na,e):this.removeAttribute(na)}attributeChangedCallback(e,t,s){if(e===na)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}});const oa="role",aa=Object.freeze([oa]);class ca extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return aa}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(oa);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${oa}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${oa}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===oa&&this._container&&this._container._updateComponentRole(this,t,s)}}var ua=Object.freeze({__proto__:null,MisoComponentElement:ca,MisoQueryElement:class extends ca{constructor(){super({role:is.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends ca{constructor(){super({role:is.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends ca{constructor(){super({role:is.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends ca{constructor(){super({role:is.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends ca{constructor(){super({role:is.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends ca{constructor(){super({role:is.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends ca{constructor(){super({role:is.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends ca{constructor(){super({role:is.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends ca{constructor(){super({role:is.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends ca{constructor(){super({role:is.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends ca{constructor(){super({role:is.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends ca{constructor(){super({role:is.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends ca{constructor(){super({role:is.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends ca{constructor(){super({role:is.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends ca{constructor(){super({role:is.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends ca{constructor(){super({role:is.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends ca{constructor(){super({role:is.ERROR})}static get tagName(){return"miso-error"}}});class la extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(la.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var ha=Object.freeze({__proto__:null,containers:ra,roles:ua,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends la{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Rn});const _a="miso-hybrid-search-combo";var da=Object.freeze({__proto__:null,CLASS_PREFIX:_a,CONAINER_TAG:"miso-hybrid-search"});const pa="Show more",ma="Show less";var fa=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:pa,showLess:ma});const ga=F(new Io({...da,DEFAULT_PHRASES:fa})),ya=F(new class extends Oo{constructor(){super({helpers:ga})}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:ga}));var ba=Object.freeze({__proto__:null,helpers:ga,sections:ya,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=ga;e=t(e);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=ya,{answerBox:a=!0}=e;return""+s(e,{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[i(e)]:r(e))+s(e,{name:"search-results"},o(e))}});const wa="answer-box-open",va="answer-box-shown",Ea='[data-role="answer-box-toggle"]';class Sa{constructor(e,t,{classPrefix:s=_a,phrases:n={}}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=n,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Ea)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer;switch(e){case ds.ERRONEOUS:case ds.READY:this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||ma:this._phrases.showMore||pa;for(const t of this._element.querySelectorAll(Ea))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const ka={isOpen:wa,shown:va},Oa={toggleOpen:["toggle",wa],open:["open",wa],close:["remove",wa],toggleHidden:["toggle",va],show:["add",va],hide:["remove",va]};for(const[e,t]of Object.entries(ka))Object.defineProperty(Sa.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(Oa))Sa.prototype[e]=function(){this._updateBoxStatus(t,s),s===wa&&(this._syncButtonText(),this._syncScroll())};const Ia=Object.freeze(da),Ta=Object.freeze(fa),xa=Object.freeze(ba);var Ca=Object.freeze({__proto__:null,constants:Ia,phrases:Ta,templates:xa,wireAnswerBox:function(e,t){if(!e)throw Error("client is required");t&&new Sa(e,t)}});const Aa=Object.freeze(Po),Ra=Object.freeze(Ca);var $a=Object.freeze({__proto__:null,ask:Aa,hybridSearch:Ra});const Na="ui";let Pa,qa;async function La(){return qa||(qa=q(Pa||(Pa=L(Na))))}class Ua{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class ja{constructor(e,t){this._plugin=e,this._client=t,p(this,{sources:{api:ln(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new po(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new eo(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new oo(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Da{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new Qo(this._plugin,this._MisoClient))}}async function za(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(It,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||t.debug;n&&It.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&It.plugins.use("std:dry-run");return window.MisoClientSA=It,It}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const n=window.misoSA=new t(s);return n.context.anonymous_id=await we(),n}(e,{MisoClient:t});return await s.ui.ready,[t,s]}let Ma;async function Fa(){return Ma||(Ma=async function(){const[[e,t]]=await Promise.all([za(He),re(He)]);return{MisoClient:e,client:t}}())}It.plugins.use(class extends X{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Go(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new R}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:$a};d(s,this,["layouts","combo","ready"]),p(this,{MisoClient:e}),p(e,{ui:s}),this.combo=new Da(this,e);const n=Object.values(Zi).filter((e=>e.type));for(const t of n)t.MisoClient=e;for(const e of n)this.layouts.register(e);const{containers:i,roles:r,combos:o,...a}=ha,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];ea.MisoClient=e,la.MisoClient=e;for(const t of c)t.MisoClient=e;await La();for(const e of c)E(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){p(e,{ui:new ja(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new Ua(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new vo(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new xr(this,e)),t}});const Ba='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',Qa='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',Ga='<svg fill="currentColor" viewBox="0 0 24 24">\n<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.696-3.534c.63 0 1.332-.288 2.196-1.458l.911-1.22a.334.334 0 0 0-.074-.472.38.38 0 0 0-.505.06l-1.475 1.679a.241.241 0 0 1-.279.061.211.211 0 0 1-.12-.244l1.858-7.446a.499.499 0 0 0-.575-.613l-3.35.613a.35.35 0 0 0-.276.258l-.086.334a.25.25 0 0 0 .243.312h1.73l-1.476 5.922c-.054.234-.144.63-.144.918 0 .666.396 1.296 1.422 1.296zm1.83-10.536c.702 0 1.242-.414 1.386-1.044.036-.144.054-.306.054-.414 0-.504-.396-.972-1.134-.972-.702 0-1.242.414-1.386 1.044a1.868 1.868 0 0 0-.054.414c0 .504.396.972 1.134.972z"/>\n</svg>',Wa='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Ha='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function Ka({className:e},{title:t,created_at:s,updated_at:n,published_at:i,custom_attributes:r={}}){const o=he(r.site),a=i||s||n;let c="";t&&(c+=`<div class="${e}__item-title">${t}</div>`);const u=[];return o&&u.push(`<div class="${e}__item-site">${o.name}</div>`),a&&u.push(`<div class="${e}__item-date">${Va(a)}</div>`),u.length>0&&(c+=`<div class="${e}__item-supplementals">${u.join("&nbsp;&nbsp;•&nbsp;&nbsp;")}</div>`),`<div class="${e}__item-info-container">${c}</div>`}function Va(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}Object.freeze({ordered:!0,article:function(e,t,s,n){const{templates:i}=e,[r,o]=i.helpers.tagPair(e,s);return""+r+i.indexBlock(e,s,n)+Ka(e,s)+o},infoBlock:Ka}),Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,description:n,created_at:i,updated_at:r,published_at:o,custom_attributes:a={}}){he(a.site);const c=o||i||r;let u=`<div class="${e}__item-main-block">`;a.content_type&&(u+=`<div class="${e}__item-content-type">${a.content_type}</div>`);t&&(u+=`<div class="${e}__item-title">${t}</div>`);s?u+=`<div class="${e}__item-snippet">${s}</div>`:n&&(u+=`<div class="${e}__item-desc">${n}</div>`);u+=`</div><div class="${e}__item-supplementals-block">`,c&&(u+=`<div class="${e}__item-date">${Va(c)}</div>`);return u+="</div>",`<div class="${e}__item-info-container">${u}</div>`}});const Ya="header #miso-search",Za="#siteSearch-open-button";function Ja(e){const{searchParams:t}=new URL(window.location.href);return t.set("q",e),"/search/?"+t}async function Xa(e){const t=document.querySelector(Ya);if(!t)return;const s=document.querySelector(Za);if(e.page.type===qe)return void(s&&s.addEventListener("click",(()=>{const e=document.querySelector("#siteSearch-close-button");e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()})));const{client:n}=await Fa(),i=n.ui.hybridSearch;i.useLink(Ja,{open:!1}),i.autocomplete.enable(),t.classList.add("miso-hybrid-search-input"),t.innerHTML=`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${Wa}</span>\n        <input class="miso-search-box__input" placeholder="What are you searching for?" type="text" autocomplete="off" data-role="input">\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Ha}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}const{currentScript:ec}=document;async function tc({}){await Promise.all([nc()])}let sc=!1;async function nc(){if(sc)return;if(sc=!0,!ec)throw Error("currentScript not found");const e=ec.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}var ic={queryButton:"A.I. Search",home:{title:"Smart Answers from ${name}",queryPlaceholder:"Ask us a question",info:"What is this?"},story:{title:{nonempty:"Explore frequently asked questions",empty:"Explore with a question"},queryPlaceholder:{nonempty:"Ask your own question...",empty:"Ask a question..."}},answers:{title:"Smart Answers",subtitle:"Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.",feedback:{helpful:"Helpful",unhelpful:"Not Helpful"},sources:"My reply is based on the following",relatedResources:"Go beyond, and learn more about this topic",querySuggestions:"Related questions you can explore",followUp:{queryPlaceholder:"Ask a follow-up question",queryButton:"Ask"},affiliation:{title:"Best Prices Today: ${title}"},error:{title:"Oops!",description:"We are currently experiencing some difficulties. Would you please trying again later?"}},sponsor:{phrase:"Supported by",tooltip:"Our sponsors help keep Smart Answers running,<br>but do not influence our editorial independence."}},rc=Object.freeze({__proto__:null,default:ic,queryButton:ic.queryButton,home:ic.home,story:ic.story,answers:ic.answers,sponsor:ic.sponsor}),oc={queryButton:"KI-Suche",home:{title:"Smart Answers von ${name}",queryPlaceholder:"Stellen Sie uns eine Frage",info:"Was ist das?"},story:{title:{nonempty:"Häufig gestellte fragen entdecken",empty:"Häufig gestellte fragen entdecken"},queryPlaceholder:{nonempty:"Stellen Sie Ihre eigene Frage...",empty:"Stellen Sie Ihre eigene Frage..."}},answers:{title:"Smart Answers",subtitle:"Erhalten Sie Antworten auf Ihre Technikfragen durch KI, die ausschließlich auf Berichten und Tests unserer Experten basieren.",feedback:{helpful:"Hilfreich",unhelpful:"Nicht hilfreich"},sources:"Meine Antwort basiert auf folgenden Inhalten",relatedResources:"Erfahren Sie mehr über dieses Thema",querySuggestions:"Verwandte Fragen, die Sie erforschen können",followUp:{queryPlaceholder:"Stellen Sie eine Anschlussfrage",queryButton:"Fragen Sie"},affiliation:{title:"Beste Preise heute: ${title}"},error:{title:"Hoppla!",description:"Wir erleben derzeit einige Schwierigkeiten. Würden Sie es bitte später noch einmal versuchen?"}},sponsor:{phrase:"Unterstützt von",tooltip:"Unsere Sponsoren helfen, Smart Answers am Leben zu halten, haben aber keinen Einfluss auf unsere redaktionelle Unabhängigkeit."}},ac=Object.freeze({__proto__:null,default:oc,queryButton:oc.queryButton,home:oc.home,story:oc.story,answers:oc.answers,sponsor:oc.sponsor});const cc=function(e){if("de"===e)return ac;return rc}("en");const uc="miso-smart-answers";const lc="smart-answers-discovery";function hc(e){return dc("home",function({site:e}){const{name:t,ref_story:s}=e;return`\n<div class="${lc}__container">\n  <div class="${lc}__header">\n    <div class="${lc}__title">\n      ${cc.home.title.replace("${name}",t)}\n    </div>\n    ${pc(s)}\n  </div>\n  <div class="${lc}__body">\n    <div class="${lc}__search-box">\n      <input type="text" class="${lc}__search-box-input" placeholder="${cc.home.queryPlaceholder}" aria-label="${cc.home.queryPlaceholder}">\n      <button class="${lc}__search-box-button" data-role="button">\n        <i>${Ba}</i>\n        <span>${cc.queryButton}</span>\n      </button>\n    </div>\n  </div>\n  <div class="${lc}__footer">\n    ${pc(s)}\n  </div>\n</div>\n`}(e))}function _c(e,t={}){return dc("article",function(e,{questions:t=[]}){const s=0===t.length,n=cc.story.title[s?"empty":"nonempty"],i=cc.story.queryPlaceholder[s?"empty":"nonempty"];return`\n<div class="${lc}__header">\n  <i>${Qa.replace("<svg",'<svg aria-hidden="true" focusable="false"')}</i>\n  <h4 class="${lc}__title">${n}</h4>\n</div>\n<div class="${lc}__body">\n  <div class="${lc}__questions-container">\n    <ul class="${lc}__questions-list">${t.map((t=>function({page:e},{question:t}){return`\n<li class="${lc}__question-item">\n  <a href="/smart-answers?q=${encodeURIComponent(t)}&qs=${encodeURIComponent(e.storyId)}" class="${lc}__question-link" data-role="faq-item" target="_blank" rel="nofollow">${t}</a>\n</li>\n`}(e,{question:t}))).join("")}</ul>\n  </div>\n  ${function({sponsor:e}){return e?`\n<div class="${uc}__sponsor" data-brand="${e.key}">\n  <div class="${uc}__sponsor-text">${cc.sponsor.phrase}</div>\n  <div class="${uc}__sponsor-logo">\n    <img src="${ce(e.image)}" alt="${e.name}">\n  </div>\n  <div class="${uc}__sponsor-info" tabindex="-1">\n    ${Ga}\n    <div class="${uc}__sponsor-info-tooltip">${cc.sponsor.tooltip}</div>\n  </div>\n</div>`.trim():""}(e)}\n  <div class="${lc}__search-box">\n    <input type="text" class="${lc}__search-box-input" placeholder="${i}" aria-label="${i}">\n    <button class="${lc}__search-box-button" data-role="button">\n      <i>${Ba}</i>\n      <span>${cc.queryButton}</span>\n    </button>\n  </div>\n</div>\n`}(e,t))}function dc(e,t){const s=document.createElement("div");return s.classList.add(lc),s.classList.add(e),s.innerHTML=t,s}function pc(e){return e?`\n<div class="${lc}__info">\n  <span>${cc.home.info}</span>\n  <a class="${lc}__info-link" href="/?post_type=post&p=${e}" target="_blank" aria-label="${cc.home.info}">${Ga}</a>\n</div>\n`:""}const mc={impression:new Set,viewable_impression:new Set,click:new Set};function fc(e,t){gc("click",e,t)}function gc(e,t,s){s=function(e,t){const s=[],n=mc[e];for(const e of t)n.has(e)||(s.push(e),n.add(e));return s}(e,s),0!==s.length&&function(e,t,s){const{config:n,site:i,page:r,session_id:o,anonymous_id:a}=t,c="staging"===n.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1",u=["api_key="+n.api_key];!n.dry_run&&function(e){return window.location.hostname===e.hostname}(i)||u.push("&dry_run=1");const l=`${c}/interactions?${u.join("&")}`,h={data:[{type:e,anonymous_id:a,product_ids:[],context:{...pe(),custom_context:{...de(t),api_group:"ask",api_name:"related_questions",property:"related_questions",page_story_id:r.storyId,session_id:o,...s}}}]};if(!window.navigator.sendBeacon(l,JSON.stringify(h)))throw Error("Send beacon unsuccessful: "+l);Ce("[Discovery] "+e,h.data)}(e,t,{items:s})}const yc=(()=>{let e="";for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&(e+=`&${encodeURIComponent(t)}=${encodeURIComponent(s)}`);return e})();function bc(e,t){const s=t.querySelector('input[type="text"]');if(!s)throw Error('input[type="text"] not found');s.addEventListener("keydown",(({key:t,isComposing:n})=>{n||"Enter"!==t||wc(e,s.value)})),t.addEventListener("click",(({target:n})=>{for(let i=n;i&&i!==t;i=i.parentElement){if(i.matches('a[href][data-role="faq-item"]')){try{fc(e,[vc(i)])}catch(e){console.error(e)}return}if(i.matches('[data-role="button"]'))return void wc(e,s.value)}}))}function wc(e,t){if(!t)return;window.open(`/smart-answers?q=${encodeURIComponent(t)}${yc}`,"_blank")}function vc({href:e}){return new URL(e).searchParams.get("q")}async function Ec({config:e,site:t,page:s,session_id:n}){Ce("[Discovery] Fetching suggested questions from Miso API...");const i=`${"staging"===e.api_host?"https://ask-api.askmiso-staging.com/v1":"https://api.askmiso.com/v1"}/ask/related_questions?api_key=${e.api_key}`;try{const e=await window.fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_meta:{site:t.key,session_id:n},product_id:s.storyId})}),{data:r}=await e.json(),{related_questions:o}=r;return 0===o.length&&Ce("[Discovery] No suggested questions found."),o}catch(e){return Ce("[Discovery] Failed to fetch suggested questions: "+e),console.error(e),[]}}async function Sc(e){const t=document.querySelector("#miso-smart-answers-faq");if(!t)return void Ce("[Discovery] No block shown: cannot find the reference position for discovery block.");e={...e,session_id:I()};const[s]=await Promise.all([Ec(e),tc(e)]),n=_c(e,{questions:s});bc(e,n),t.insertAdjacentElement("afterend",n),t.parentNode.removeChild(t),function(e,t){gc("impression",e,t)}(e,s),await k(n),function(e,t){gc("viewable_impression",e,t)}(e,s)}async function kc(e){const{page:t}=e;switch(t.type){case"home":await async function(e){const t=document.querySelector(".layout--right-rail");if(!t)return void console.error("[Smart Answers] No block shown: cannot find the reference position for discovery block.");await tc(e);const s=hc(e);bc(e,s),t.insertAdjacentElement("beforebegin",s)}(e);break;case"story":const[s,n]=await Promise.all([$e(t.postId),we()]);await Sc({...e,story:s,anonymous_id:n});break;default:Ce("[Discovery] No discovery block for page type: "+t.type)}}(async(e,s)=>{if("/smart-answers"===window.location.pathname)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=t;const i=function(e){const t=window.location.pathname;if("/"===t||e.regions.indexOf(t.substring(1))>=0)return{type:"home",site:e};const s=t.substring(1).split("/");if("article"===s[0]){const t=""+s[1];return{type:"story",site:e,postId:t,storyId:`story_${e.key}_${t}`}}return{type:"other",site:e}}(e),r={site:e,config:s,page:i,version:t,sponsor:n};await Promise.all([kc(r),Xa(r)])})({key:"pcworld",hostname:"www.pcworld.com",name:"PCWorld",lang:"en",regions:[],ref_story:"2013610"},e)}();
