!function(){"use strict";!function(e,t){void 0===t&&(t={});var s=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===s&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('@charset "UTF-8";#miso-explore.miso-explore{--theme-color:#000;--background-color:#f3f3f3;--link-color:#0067d1;background-color:var(--background-color);border-top:5px solid var(--theme-color);padding:2.25rem 2.5rem}#miso-explore.miso-explore h2{font-size:1.75rem;font-weight:700;margin:0 0 .25rem;text-align:center}#miso-explore.miso-explore p{margin:0}#miso-explore.miso-explore miso-explore{display:flex;flex-direction:column;gap:1.5rem;margin-top:1rem}#miso-explore.miso-explore miso-explore a{color:var(--link-color)}#miso-explore.miso-explore miso-explore a:hover{text-decoration:underline}#miso-explore.miso-explore miso-explore li::marker{color:var(--link-color)}#miso-explore.miso-explore miso-explore .miso-list__list{line-height:1.5;margin-left:-.75rem!important}#miso-explore.miso-explore miso-explore .miso-list__item{margin-bottom:0}#miso-explore.miso-explore miso-explore .miso-list__item:before{height:6px;top:14px;width:6px}#miso-explore.miso-explore miso-query{--miso-search-box-border-radius:0;--miso-box-shadow-hover:none}#miso-explore.miso-explore miso-query .miso-search-box__input-group,#miso-explore.miso-explore miso-query .miso-search-box__input-group:hover{border:none}#miso-explore.miso-explore miso-query .miso-search-box__input{background-color:#fff}#miso-explore.miso-explore miso-query .miso-search-box__input::-moz-placeholder{color:#000;opacity:.5}#miso-explore.miso-explore miso-query .miso-search-box__input::placeholder{color:#000;opacity:.5}#miso-explore.miso-explore miso-query .miso-search-box__button{background-color:var(--theme-color);color:#fff;flex-shrink:0;padding:.5rem 2rem;text-transform:none;width:-moz-fit-content;width:fit-content}#miso-explore.miso-explore .crn-sponsored-question{position:relative}#miso-explore.miso-explore .crn-sponsored-question:after{color:grey;content:"*";position:absolute;right:-.625rem}#miso-explore.miso-explore .crn-explore-footnote{color:grey;font-size:.75rem;margin-left:1.25rem;margin-top:.625rem}.miso-ask-combo-container{border-top:5px solid #000}.miso-ask-combo-container #crn-answers{text-align:center}#miso-ask-combo.miso-ask-combo{--miso-crn-color-primary:#000;--miso-crn-color-primary-text:#fff;--miso-crn-color-secondary:#e81d22;--miso-crn-color-background:#f3f3f3;--miso-crn-color-link:#0067d1;--miso-crn-color-mark:#d8ebff;--miso-ask-combo-section-padding:0;--miso-ask-combo-content-padding:0;--miso-ask-combo-content-spacing:0;font-size:1.115rem}#miso-ask-combo.miso-ask-combo .miso-crn-info-style-block-container{padding:0 2rem}#miso-ask-combo.miso-ask-combo .miso-crn-info-style-block{display:flex;flex-direction:column;gap:1rem;padding:1rem 2rem 2rem}#miso-ask-combo.miso-ask-combo .miso-crn-info-style-block h1{margin:0;text-align:center}#miso-ask-combo.miso-ask-combo .miso-crn-info-style-block__description{display:flex;flex-direction:column;gap:.5rem;line-height:1.25;margin-bottom:.5rem}#miso-ask-combo.miso-ask-combo miso-query{--miso-search-box-border-radius:0;--miso-box-shadow-hover:none}#miso-ask-combo.miso-ask-combo miso-query .miso-search-box__input-group,#miso-ask-combo.miso-ask-combo miso-query .miso-search-box__input-group:hover{border:none}#miso-ask-combo.miso-ask-combo miso-query .miso-search-box__input::-moz-placeholder{color:#000;opacity:.5}#miso-ask-combo.miso-ask-combo miso-query .miso-search-box__input::placeholder{color:#000;opacity:.5}#miso-ask-combo.miso-ask-combo miso-query .miso-search-box__button{flex-shrink:0;padding:.5rem 2rem;text-transform:none;width:-moz-fit-content;width:fit-content}#miso-ask-combo.miso-ask-combo .miso-ask-combo__question .miso-search-box__input{background-color:var(--miso-crn-color-background)}#miso-ask-combo.miso-ask-combo .miso-ask-combo__question .miso-search-box__button{background-color:var(--miso-crn-color-primary);color:var(--miso-crn-color-primary-text)}#miso-ask-combo.miso-ask-combo .miso-ask-combo__follow-ups .miso-search-box__input{background-color:var(--miso-crn-color-background)}#miso-ask-combo.miso-ask-combo .miso-ask-combo__follow-ups .miso-search-box__button{background-color:var(--miso-crn-color-primary);color:var(--miso-crn-color-primary-text)}#miso-ask-combo.miso-ask-combo .miso-ask-combo__follow-ups .miso-ask-combo__answer-container,#miso-ask-combo.miso-ask-combo .miso-crn-answer-block{background-color:var(--miso-crn-color-background);border:1px solid var(--miso-crn-color-primary);padding:1.8rem 3.6rem}#miso-ask-combo.miso-ask-combo .miso-ask-combo__question-phrase{--miso-ask-combo-question-phrase-color:var(--miso-crn-color-link);font-weight:600!important;margin-bottom:.6rem!important}#miso-ask-combo.miso-ask-combo miso-answer li,#miso-ask-combo.miso-ask-combo miso-answer p{line-height:1.5}#miso-ask-combo.miso-ask-combo miso-answer li:not(:first-child){margin-top:.5rem}#miso-ask-combo.miso-ask-combo .miso-citation-link{color:var(--miso-crn-color-link)}#miso-ask-combo.miso-ask-combo .miso-ask-source{margin-top:2.5rem}#miso-ask-combo.miso-ask-combo miso-sources{--miso-list-item-gap:0;--miso-list-image-height:6rem}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item{border:none!important;border-radius:0!important}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item:not(:first-child){border-top:2px dotted var(--miso-border-color-medium)!important}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body{padding:1rem 0!important}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-cover-image-container{aspect-ratio:16/9;border-radius:0}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-cover-image{-o-object-fit:cover!important;object-fit:cover!important}#miso-ask-combo.miso-ask-combo miso-sources .miso-citation-index{color:var(--miso-crn-color-link);font-size:1.3rem!important;margin-top:-.3rem}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="1"]:before{content:"➊"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="2"]:before{content:"➋"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="3"]:before{content:"➌"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="4"]:before{content:"➍"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="5"]:before{content:"➎"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="6"]:before{content:"➏"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="7"]:before{content:"➐"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="8"]:before{content:"➑"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="9"]:before{content:"➒"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="10"]:before{content:"➓"}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-section{color:var(--miso-crn-color-secondary);font-size:.9rem;letter-spacing:.02rem}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-authors,#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-section,#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-snippet,#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-title{line-height:1.3;margin-bottom:.2rem}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-snippet mark{background-color:var(--miso-crn-color-mark);padding:2px 0}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-authors{color:#e81d22;font-size:.9rem}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-authors span{color:var(--miso-crn-color-secondary)}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-date{color:var(--miso-text-color);font-size:.68rem;letter-spacing:.02rem;margin-bottom:0;text-transform:uppercase}#miso-ask-combo.miso-ask-combo miso-sources .miso-list__item-sponsored{color:var(--miso-text-color);font-size:.825rem;font-style:italic;font-weight:700;line-height:2.5}#miso-ask-combo.miso-ask-combo .miso-ask-affiliation{margin-bottom:2.5rem;margin-top:2.5rem}#miso-ask-combo.miso-ask-combo .miso-ask-combo__whitepaper-phrase{margin-bottom:1rem!important}#miso-ask-combo.miso-ask-combo miso-whitepaper .miso-list__item{background-color:var(--miso-crn-color-background)!important;padding:.8rem 1rem}#miso-ask-combo.miso-ask-combo miso-whitepaper .miso-list__item-body{flex-direction:column}#miso-ask-combo.miso-ask-combo miso-whitepaper .miso-whitepaper__description{color:#181818;font-size:.625rem;font-weight:700;text-align:center}#miso-ask-combo.miso-ask-combo miso-whitepaper .miso-whitepaper__content{align-items:center;display:flex;gap:var(--miso-list-item-content-spacing);justify-content:space-between}#miso-ask-combo.miso-ask-combo miso-whitepaper .miso-list__item-desc{-webkit-line-clamp:4;margin-bottom:0}#miso-ask-combo.miso-ask-combo .miso-ask-combo__follow-ups{margin-top:2rem}#miso-ask-combo.miso-ask-combo miso-query-suggestions .miso-option-list__options{list-style-type:disc}#miso-ask-combo.miso-ask-combo miso-query-suggestions .miso-option-list__option{background-color:transparent;border:none;box-shadow:none;color:var(--miso-crn-color-link);font-size:1.115rem;padding:0}#miso-ask-combo.miso-ask-combo .miso-crn-disclaimer{margin-top:8rem}#miso-hybrid-search-combo.miso-hybrid-search-combo{--color-primary:#00aeca;--miso-hybrid-search-combo-content-spacing:0!important;--miso-search-box-border-radius:0!important;--miso-box-shadow-hover:none!important;--miso-border-color-medium:var(--miso-border-color-light)!important;--miso-facet-background-selected:var(--color-primary)!important;--miso-facet-border-color-selected:var(--color-primary)!important;--miso-select-width:8rem!important;--miso-select-border-radius:0!important;--miso-select-border-radius-computed:0!important}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__header{padding:1rem 0}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__header h1{font-weight:500}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__header miso-question{font-weight:700}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__search-results-header{align-items:center;border:1px solid var(--miso-border-color-light);display:flex;justify-content:space-between;margin-bottom:1rem;margin-top:2rem;padding:.5rem}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__search-results-header-total{align-items:center;display:flex;font-size:.875rem;gap:.5rem}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__search-results-header-total miso-total{font-weight:700}#miso-hybrid-search-combo.miso-hybrid-search-combo .crn-search-container__search-results-header-sort{align-items:center;display:flex;font-size:1rem;gap:.5rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-sort{font-size:1rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-sort .miso-select__button{color:#1b1b1b;font-family:arial,sans-serif;font-weight:400;margin:0;text-transform:capitalize}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products{--color-primary:#e81d22;--miso-list-item-gap:0;--miso-list-image-height:6rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item{border:none!important;border-radius:0!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item:not(:first-child){border-top:2px dotted var(--miso-border-color-medium)!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-body{padding:1rem 0!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products div.miso-list__item-cover-image-container{aspect-ratio:16/9;border-radius:0;height:6rem!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-cover-image{-o-object-fit:cover!important;object-fit:cover!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-section{color:var(--color-primary);font-size:.9rem;letter-spacing:.02rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__info-link{color:var(--miso-text-color)}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-authors,#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-section,#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-snippet,#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-title{line-height:1.4;margin-bottom:.2rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-title{color:var(--miso-text-color);font-size:1rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-title mark{background-color:transparent!important;font-weight:600!important}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-snippet{-webkit-line-clamp:2}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-snippet mark{padding:2px 0}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-authors{font-size:.9rem}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-authors span{color:var(--color-primary)}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-date{color:var(--miso-text-color)!important;font-size:.68rem!important;letter-spacing:.02rem;margin-bottom:0;text-transform:uppercase}#miso-hybrid-search-combo.miso-hybrid-search-combo miso-products .miso-list__item-sponsored{color:var(--miso-text-color);font-size:.825rem;font-style:italic;font-weight:700;line-height:2.5}#miso-hybrid-search-combo.miso-hybrid-search-combo .miso-cards mark,#miso-hybrid-search-combo.miso-hybrid-search-combo .miso-list mark,#miso-hybrid-search-combo.miso-hybrid-search-combo .miso-option-list mark,#miso-hybrid-search-combo.miso-hybrid-search-combo .miso-search-box mark{background-color:#d8ebff!important;font-weight:500;padding:0}.crn-empty-search{--color-primary:#00aeca;--color-primary-hover:#0099b3}.crn-empty-search .crn-empty-search__header h1{font-weight:500}.crn-empty-search .crn-empty-search__main{margin-top:2rem;padding:4rem 8rem}.crn-empty-search .crn-empty-search__form{align-items:center;display:flex;gap:.5rem}.crn-empty-search .crn-empty-search__input{border:2px solid var(--color-primary);border-radius:.25rem;flex:1;font-size:1.1rem;margin-bottom:0;outline:none;padding:1rem}.crn-empty-search .crn-empty-search__button{align-items:center;background-color:var(--color-primary);border:none;border-radius:.25rem;color:#fff;display:flex;flex-shrink:0;font-size:1rem;font-weight:500;gap:.5rem;height:3.5rem;justify-content:center;padding:0 1rem;width:-moz-fit-content;width:fit-content}.crn-empty-search .crn-empty-search__button:hover{background-color:var(--color-primary-hover)}.crn-empty-search .crn-empty-search__suggestions{margin-bottom:2rem}.crn-empty-search .crn-empty-search__suggestions h3{color:#666;font-size:1.1rem;margin-bottom:1rem;margin-top:3rem;text-align:center}.crn-empty-search .crn-empty-search__items{align-items:center;display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center}.crn-empty-search .crn-empty-search__item{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:2rem;color:var(--color-primary)!important;font-size:.9rem;padding:.5rem 1rem;text-decoration:none;transition:all .2s ease}.crn-empty-search .crn-empty-search__item:hover{background-color:var(--color-primary);color:#fff!important}@media (max-width:767px){.miso-ask-combo .miso-crn-info-style-block-container{padding:0}.miso-ask-combo .miso-crn-info-style-block{padding-left:0;padding-right:0}.miso-ask-combo .miso-crn-answer-block{padding-left:2rem;padding-right:2rem}.crn-empty-search .crn-empty-search__main{padding:1rem}.crn-empty-search .crn-empty-search__form{flex-wrap:wrap}.crn-empty-search .crn-empty-search__button,.crn-empty-search .crn-empty-search__input{min-width:100%}.crn-empty-search .crn-empty-search__item{font-size:.8rem}}');var e="1.12.0";function t(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),o=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var i=Object.freeze({__proto__:null,GROUP:s,NAME:o});function n(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function r(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function a(e){return null!=e?""+e:e}function c(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function l(e){return null==e}function u(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function h(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function d(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function m(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function _(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class p{constructor(e,{duration:t=0,onDuration:s,offDuration:o,state:i}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);b(s),b(o),b(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==o?o:t})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>f(this,e)),t):f(this,e),this._value=e}disconnect(){this._active=!1}}function f(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function b(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function g(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function y(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function w(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async o=>{try{await e(o),t()}catch(e){s(e)}}))}))}async function v(e,{area:t=.5,duration:s=1e3,signal:o}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((i,n)=>{const r=new p((e=>{e&&(r.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((e=>{r.value=e[0].isIntersecting}),{threshold:t});a.observe(e),o&&o.addEventListener&&o.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),n(new DOMException("Aborted","AbortError"))}))}))}function k(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function E(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function S(e,t){const s=x((()=>window.localStorage.getItem(e))),o=x((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,o=t.indexOf(s);if(0>o)return;const i=o+s.length,n=t.indexOf(";",i);return decodeURIComponent(0>n?t.substring(i):t.substring(i,n))}(e))),i=s||o||""+t();return i&&!s&&x((()=>window.localStorage.setItem(e,i))),i&&!o&&x((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,i))),i}function x(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function I(e){return new O(e)}class O{constructor(e){this._value=e;const t=e=>{this._value=e};h(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class A{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class C{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new A),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}function T(e,t){const s=window[e]||(window[e]=[]);if(s._processed)return;s._processed=!0;const o=e=>function(e,{onError:t=e=>console.error(e),transform:s=e=>e}={}){try{s(e)()}catch(e){t(e)}}(e,t);Object.defineProperty(s,"push",{value:o});for(const e of s)o(e)}let R;try{R=document.currentScript}catch(e){}async function N(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let o;e.onerror=()=>{o&&clearInterval(o),s()},o=setInterval((()=>{e.sheet&&(o&&clearInterval(o),t())}),100)}))}(e),await async function(e){if(P(e))return;return new Promise((t=>{let s;s=setInterval((()=>{P(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function $(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.0/dist/css/${e}.css`}function P(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function q(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function L(e,{depth:t=5,...s}={}){return U(e,t)}function U(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>U(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t){const s={};if(0>=t)return s;for(const o in e){const i=e[o];"function"!=typeof i&&(o.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(s[o]=U(i,t-1)))}return s}(e,t):e:"(...)"}function j(e,t){const s=Object.getOwnPropertyDescriptors(t),o=Object.getOwnPropertyDescriptors(e);for(const[t,i]of Object.entries(s))"constructor"!==t&&void 0===o[t]&&Object.defineProperty(e,t,i)}function D(e){const t={},s=new Set;for(let o=e;o!==Object.prototype;o=Object.getPrototypeOf(o)){const i=Object.getOwnPropertyDescriptors(o);for(const o in i){if("constructor"===o||o.startsWith("_")||s.has(o))continue;s.add(o);const{value:n}=i[o];n&&(t[o]="function"==typeof n?n.bind(e):n)}}return Object.freeze(t)}function z(e){const t=function({speed:e=100,acceleration:t=4}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,o)=>{let i=e*(Math.random()+.5);return t>0&&void 0!==o&&s>o&&(i*=1+(s-o)*t/1e3),i}}(e);return(e,s,o,i)=>{const n=t(o,s);return e+Math.max(i-o,0)*n/1e3}}const M=Symbol.for("miso:resources");class F{constructor(){this._resources=new Map;const e=window[M]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){B(this._resources,e).resolve(t)}async get(e){return B(this._resources,e).promise}}function B(e,t){if(e.has(t))return e.get(t);const s=new A;return e.set(t,s),s}function Q(){return window[M]||(window[M]=new F)}class G{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new A;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class H{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},o=this._namedCallbacks[e];if(o)for(const e of o)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,o)=>{const i=t._on(e,(e=>{setTimeout((()=>i()));try{s(e)}catch(e){o(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:o})=>{try{e(s,o)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)n(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&n(s,t)}}_injectSubscribeInterface(e){u(e,this,["on","once"])}}function W(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class V{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:W(e,t),uuid:E()})}(e,t);h(this,{meta:s});const o=this._error=this._error.bind(this);this._events=new H({target:this,error:o,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(V,"miso:component");class K extends V{constructor(e,t,{libName:s,keyName:o}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof o){case"string":this._keyFn=e=>e[o];break;case"function":this._keyFn=o;break;default:throw Error("Expect keyName to be a string or a function: "+o)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new A);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class Y{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new p(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class Z{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const J=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class X{constructor(e,t){this._client=e,this._root=t,this._bulk=new G(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:o,timeout:i,sendApiKeyByHeader:n}={}){const{apiKey:r,request:a={}}=this._client.options;i=i||a.timeout,(n=n||a.sendApiKeyByHeader)&&(o={...o,"X-API-KEY":r});const l="GET"!==s&&null!=t?JSON.stringify(t):void 0,u=i?AbortSignal.timeout(i):void 0,h=await(this._root._customFetch||window.fetch)(e,c({method:s,headers:o,body:l,cache:"no-cache",mode:"cors",signal:u})),d=await h.json();if(h.status>=400||d.errors){var m=Error(d.message);throw m.data=d,m.status=h.status,m}return d}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:o}={}){if(o&&"POST"!==o)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:o}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:i,status_code:n,body:r}=o[t];n>=400||i?s.reject({status_code:n,body:r}):s.resolve(r)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:o={}}=this._client.options,i=t.sendApiKeyByHeader||o.sendApiKeyByHeader,n=e.filter((e=>e)).join("/"),r=`${this.getApiEndpoint(n)}/${n}`;return i?r:`${r}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=J.DATA_ENDPOINT,eventEndpoint:s=J.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:o}){const i=this._client;for(const n of this._root._urlPasses)try{o=n({client:i,apiGroup:t,apiName:s,url:o})||o}catch(t){(e._error||console.error)(t)}return o}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:o}){const i=this._client;for(const n of this._root._payloadPasses)try{o=n({client:i,apiGroup:t,apiName:s,payload:o})||o}catch(t){(e._error||console.error)(t)}return o}}class ee extends V{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:o}=s,i=o?{bulk:this.helpers.bulkInfo}:void 0,n=this._apiPath,r=this._url({apiGroup:n,apiName:e,payload:t,options:s}),a={apiGroup:n,apiName:e,payload:t=this._preprocess({apiGroup:n,apiName:e,payload:t,options:s}),url:r,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...i}),this._postprocess(l)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const o=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:o,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:o,options:{bulk:i,...n}={}}){return i?this.helpers.fetchForBulk(e,t,o):this.helpers.fetch(s,o,n)}_postprocess({response:e}){return e.data}}const{GROUP:te,NAME:se}=i;class oe extends ee{constructor(e){super(e,te.INTERACTIONS)}async upload(e,t){try{return await this._run(se.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const o=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:o,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===se.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:o}=s;return this.helpers.sendBeacon(e,o,t),{}}return super._send({...s,options:t})}}class ie{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:s,stallTimeout:o=12e4,...i}=this._options;const n=new Z(o);let r;s=t(this._ac.signal,n.signal,s);return function(e,{interval:t=1e3,errorLimit:s=10,onError:o,onResponse:i,signal:n}={}){if(n&&n.aborted)return[];let r,a,c=0,u=!1;function h(){r&&clearInterval(r),u=!0}const d=new C;return r=setInterval((async()=>{let t,r,m;try{if([t,r,m]=await e(n?{signal:n}:{}),u||!l(a)&&a>=m)return;l(m)||(a=m),i&&i(t,r,m),c=0}catch(e){return o&&o(e),c++,void(c>s&&(h(),d.error(e)))}d.update(t,r),r&&h()}),t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{h(),d.abort(n.reason)})),d}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:s,onResponse:(e,t)=>{t?n.clear():this._isUpdated(r,e)&&n.touch(),r=e},...i})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class ne extends ie{constructor(e,t,s,o){super(o),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:re,NAME:ae}=i;class ce extends ee{constructor(e){super(e,re.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new le(this,e,t);const s=await this._run(ae.QUESTIONS,e,t);return new le(this,s,t)}async _questions(e,t){return this._run(ae.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${ae.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(ae.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(ae.TRENDING_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(ae.SEARCH,e,t);return s.question_id?new ue(this,s,t):s}async _searchGet(e,t){return this._run(`${ae.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(ae.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(ae.SEARCH_AUTOCOMPLETE,e,t)}}class le extends ne{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class ue extends ne{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),h(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:he,NAME:de}=i;class me extends ee{constructor(e){super(e,he.SEARCH)}async search(e,t){return this._run(de.SEARCH,e,t)}async autocomplete(e,t){return this._run(de.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(de.MGET,e,t)}}const{GROUP:_e,NAME:pe}=i;class fe extends ee{constructor(e){super(e,_e.RECOMMENDATION)}async userToProducts(e,t){return this._run(pe.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(pe.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(pe.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(pe.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(pe.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(pe.PRODUCT_TO_PRODUCTS,e,t)}}class be extends V{constructor(e,t){super("api",e),this._client=e,this.helpers=new X(e,t),this.interactions=new oe(this),this.ask=new ce(this),this.search=new me(this),this.recommendation=new fe(this)}}var ge=Object.freeze({__proto__:null,Api:be,ApiBase:ee,ApiHelpers:X,Interactions:oe,Ask:ce,Search:me,Recommendation:fe});class ye extends V{constructor(e){super("context",e),this._client=e}}var we={api:ge,context:{Context:ye}};class ve{constructor(e){h(this,{install:e})}}class ke extends K{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Ee(this,we),this.plugins=new Se(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new A);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const o=new s;return h(o,{id:e}),this._tryConfig(o,t),o;case"function":return new ve(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const o=document.createElement("script");o.async=!0,o.src=function(e,t,s){const o=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),i=0>t?e.length:t,n=e.lastIndexOf("/",i)+1,r=e.indexOf(".",n),a=0>r?"":e.slice(r,i);return`${e.slice(0,n)}plugins/${o}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${o}.min.js`}(e,t,this._currentScript),o.setAttribute("data-request",s),document.head.appendChild(o)}const o=await(new Q).get(s);!this.isRegistered(e)&&this.register(o)}}class Ee{constructor(e,t){u(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),h(this,{classes:t})}}class Se{constructor(e){u(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const xe=new class extends V{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new ke(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=e,this._cmdRes=new A}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Ie=Object.freeze({__proto__:null,viewable:v,debounce:q});const{currentScript:Oe}=document;class Ae extends V{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Ae),window.MisoClient?window.MisoClient!==Ae&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Ae}static debug(){}constructor(e){super("client",xe),this._config(e),this.context=new ye(this),this.api=new be(this,xe),function(e){xe._clients.push(e),xe._events.emit("create",e)}(this)}get version(){return Ae.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,c(e)}_readConfigFromScriptUrl(){return c({apiKey:new URL(new Request(Oe.src||Oe.href).url).searchParams.get("api_key")||void 0})}}Ae.helpers=Ie,h(Ae,{uuid:E()});var Ce=function(e){const t=xe._pluginRoot;return xe.MisoClient=t.MisoClient=e,u(e,xe,["version","instances","any","meta","on","once","cmdDone"]),u(e,t,["plugins"]),e}(Ae);const{GROUP:Te,NAME:Re}=i;let Ne;class $e{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||Ne||(Ne=S("miso_anonymous_id",E))}set anonymous_id(e){e=a(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=a(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function Pe(){const e=new URLSearchParams(window.location.search);let t=c({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class qe{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],o=e[t];o!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${o}`))}return Object.freeze({...this._config})}}function Le(t){const{context:s={}}=t,o={...s.custom_context,sdk_version:e};return o.uuid||(o.uuid=E()),{...t,context:{...s,custom_context:o}}}const Ue="std:native-fetch";let je,De;const ze=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return je="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),je="borrowed",e.contentWindow.fetch}catch(e){De=e}})();const Me="miso-logdump",Fe="miso-logdump",Be=Fe+"__download-btn",Qe="Miso Log";class Ge{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return Ke||(Ke=N($("logdump")))}();let e=document.getElementById(Me);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||Qe,t.classList.add(Be),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=Me,e.classList.add(Fe),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(Me),t=e&&e.querySelector("."+Be);t&&(t.textContent=this._options.logDownloadButtonText||Qe)}hideDownloadButton(){const e=document.getElementById(Me);e&&(e.style.display="none")}download(){const e=new Blob([We(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:He()})}return e&&"string"==typeof e?e:`miso-log.${He()}.jsonl`}clear(){this._logs=[]}}function He(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function We(e){return e.map((e=>JSON.stringify(L(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Ve(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function Ve(e){return e?L(e,{depth:2}):e}let Ke;const Ye="std:debug";function Ze(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function Je(e,t){return Object.freeze({...e,...t,members:Xe(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Xe(e=[],t=[]){return[...new Set([...e,...t])]}function et(e,t){let s={};for(const o of e)o&&(s=t(s,o));return c(s)}function tt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function st(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,o=t.payload,{...s,...o,...ot("_meta",s,o)})});var s,o}))}function ot(e,t,s){const o=t&&t[e],i=s&&s[e],n=o?i?{...o,...i}:o:i;return void 0!==n?{[e]:n}:{}}Ce.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Ge(e)}static get id(){return Ye}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Ye,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,o)=>this._handleEvent(e,o,s,t)))}_handleEvent(e,{name:t},s,o=[]){if("child"===t||"subtree"===t)return;const i=o.concat(e.meta.path);if(i.length||"create"!==t){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(t,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(i[1],i.slice(2),t,s))}this._logw(i.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:o,bulk:i,...n}){const r=new URL(o).pathname,a=["api",e];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+r),"interactions"===t){const e=n.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:o}={}}={}}=e,i="custom"===t&&s?`${t}:${s}`:t;a.push(o?`${i} (${o})`:""+i)}a.push([{...n,url:o}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,o){this._logw([e,t.join(".")],s,o)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Ze)):this._log(e,t,Ze(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Ue}install(e,t){ze?(t.setCustomFetch(ze),e.debug(`<plugin:${Ue}>`,"[info]",`Using ${je} native fetch`)):e.debug(`<plugin:${Ue}>`,"[error]","Failed to obtain native fetch: "+De.message)}}),Ce.plugins.use(class extends V{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new $e(this);var s,o;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(o="string"==typeof(o=["anonymous_id","user_id","user_hash","user_type"])?[o]:o).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:o}){return t===Te.INTERACTIONS&&s===Re.UPLOAD?this._modifyPayloadForInteractions(e,o):t===Te.ASK&&s===Re.QUESTIONS?this._modifyPayloadForAsk(e,o):this._modifyPayloadForOthers(e,o)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:o,anonymous_id:i}=e.context;return{...s?{user_id:s,user_hash:o}:{anonymous_id:i},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:o,user_type:i,anonymous_id:n}=e.context,r=s?{user_id:s,user_hash:o}:{anonymous_id:n};return s&&i&&(r.user_type=i),{...r,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:o}=e.context,i=c({anonymous_id:s,user_id:o});return{data:t=t.map((e=>({...i,...e})))}}}),Ce.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...c({page:c({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Pe()}),...e.context}})))}}}),Ce.plugins.use(class extends V{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new qe(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:i,payload:n}){if(t===s.SEARCH)if(i===o.SEARCH)this._captureSearchApiRequest(e,n)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),Ce.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(Le)}}}),Ce.plugins.use(class extends V{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case s.SEARCH:case s.RECOMMENDATION:return!0}return!1}});const it="default",nt="_organic",rt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),at=new Set([rt.PRODUCTS,rt.CATEGORIES,rt.ATTRIBUTES,rt.RESULTS,rt.ITEMS,rt.QUESTION,rt.ANSWER,rt.IMAGES,rt.SOURCES,rt.RELATED_RESOURCES,rt.QUERY_SUGGESTIONS,rt.RELATED_QUESTIONS,rt.AFFILIATION,rt.FACETS,rt.TOTAL]);function ct(e){return at.has(e)}const lt=new Set([rt.PRODUCTS,rt.IMAGES,rt.SOURCES,rt.RELATED_RESOURCES]);const ut=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ht=[ut.IMPRESSION,ut.VIEWABLE,ut.CLICK,ut.SUBMIT,ut.FEEDBACK],dt=[ut.IMPRESSION,ut.VIEWABLE,ut.CLICK],mt=new Set(dt);const _t=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),pt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function ft(e){if(0>ht.indexOf(e))throw Error("Unrecognized event type: "+e)}const bt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function gt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function yt(e){if(void 0===e)return;let[t,s]=r(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function wt(e,t){return!1===(t=yt(t))[0]?t:e&&t?[t[0]||e[0],vt(e[1],t[1])]:t||e}function vt(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const kt=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Et(e={}){e=tt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))St(t);return e}function St(e={}){return e=tt(e)}function xt(e={},t={}){const s={...e};for(const[o,i]of Object.entries(t))void 0!==i&&(s[o]=ht.includes(o)?It(e[o],i):i);return s}function It(e={},t={}){return{...e,...t}}const Ot=[{key:bt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return c({group:s,name:e,payload:t})},merge:st},{key:bt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${rt.PRODUCTS}: ... }) instead`),e={...s,[rt.PRODUCTS]:t});const o={};for(const[t,s]of Object.entries(e))o[gt(t)]=yt(s);return o},merge:function(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>{for(const[s,o]of Object.entries(t))e[s]=wt(e[s],o);return e}))}},{key:bt.DATA_PROCESSOR,normalize:function(e){e=r(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:bt.TRACKERS,normalize:function(e={}){e=tt(e);const{active:t,...s}=e,o={};for(const[e,t]of Object.entries(s))o[e]=Et(t);return{active:t,...o}},merge:function(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>{for(const[s,o]of Object.entries(t))void 0!==o&&(e[s]="active"===s?o:xt(e[s],o));return e}))}},{key:bt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=r(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,o=t.preprocess,s&&s.length?o&&o.length?[...s,...o]:s:o)});var s,o}))}},{key:bt.FILTERS,normalize:tt,merge:function(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>Object.assign(e,t)))}},{key:bt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&et(e,((e,t)=>Object.assign(e,t)))}}];class At{constructor(){this._events=new H({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class Ct{constructor(e={},t={}){this._events=new H({target:this}),this._defaults=t,this._context=e||{},this._locals={},h(this,{resolved:new Tt(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class Tt{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,o=s._context[e];this._cache[e]=t(s._defaults[e],o&&o.get(),s._locals[e])}return this._cache[e]}}class Rt{constructor(e,t,s,o,i){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?o(e):void 0,this._merge=i}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of Ot){const{key:t,normalize:s,merge:o}=e;Object.defineProperty(At.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new Rt(this,this._globals,t,s,o))}}),Object.defineProperty(Ct.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new Rt(this,this._locals,t,s,o))}}),Object.defineProperty(Tt.prototype,t,{get:function(){return this._get(e)}})}const Nt=[bt.API,bt.LAYOUTS,bt.DATA_PROCESSOR,bt.TRACKERS,bt.INTERACTIONS];function $t(e,t=Nt){for(const s of t)Pt(e,s)}function Pt(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const o=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+o](e){return this._options[t].merge(e),this},["clear"+o](){return this._options[t].set(),this}})}var s}function qt(e={}){const{setValue:t,focus:s,param:o,sourceParam:i}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:o="q",sourceParam:i="qs",...n}={}){return{setValue:e,focus:t,updateUrl:s,param:o,sourceParam:i,...n}}(e),n=new URLSearchParams(window.location.search),r=n.get(o),a=n.get(i)||void 0,{layout:l}=this._views.get(rt.QUERY);l&&(r&&t&&(l.value=r),!r&&s&&l.focus()),r&&this.query(c({q:r,qs:a}))}class Lt extends V{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new At}}function Ut(e){return e?"view:"+e:"view"}$t(Lt.prototype);class jt{constructor(e={}){(this._events=new H)._injectSubscribeInterface(this),this._options=e,this._states={},h(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const o=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(o),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(o)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Dt{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:E(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function zt(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class Mt{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e})}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...o}=e;this._emitResponse({session:t,request:o});try{const{signal:s}=this._ac||{},i={...e.options,signal:s},n=await this._source({session:t,...e,options:i});if(n&&n[Symbol.asyncIterator]){let e;for await(e of(n._response&&this._emitResponseWithSessionCheck({session:t,request:o,value:n._response}),n)){if(!zt(this._hub,t))break;this._emitResponse({session:t,request:o,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:o,value:n})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:o,error:e})}}_emitResponseWithSessionCheck(e){zt(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ft{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{n(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Bt,VIEWABLE:Qt,CLICK:Gt}=ut,{UNTRACKED:Ht,TRIGGERED:Wt}=_t,Vt=Object.freeze({[Bt]:Ht,[Qt]:Ht,[Gt]:Ht});class Kt{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Vt}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||Ht}set(e,t,s){ft(t),function(e){if(e!==_t.UNTRACKED&&e!==_t.TRACKING&&e!==_t.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const o of r(e))this._setOne(o,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Wt))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const o=s(t);return e.set(t,o),o}(this._states,this._getKey(e),(()=>({...Vt}))))[t]=s}}const Yt=[Symbol("itemless")];class Zt{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Kt(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){ft(e);const{options:o}=this;if(!o)return;this._syncSession();const{deduplicated:i=!0,itemless:n=!1}=o;if(i){if(n&&(t=Yt),0===(t=this._states.untriggered(r(t),e)).length)return;this._states.set(t,e,_t.TRIGGERED)}this._sendToHub({type:e,items:n?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:ut.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(c({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Kt(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[Ut(this._role)]}}for(const e of dt)Zt.prototype[e]=function(t,s){this._trigger(e,t,s)};class Jt{constructor(e,t){this._events=new H({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),h(this,{role:t,interface:new Xt(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ft((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===rt.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Zt({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const o=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((i=t)===(n=o)||i&&n&&i.status===n.status&&i.error===n.error&&i.value===n.value&&i.ongoing===n.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(i.session,n.session)))return;var i,n;const{session:r,status:a,ongoing:c,request:l,meta:u,value:h}=t,d={session:r,status:a,ongoing:c,request:l,meta:u,data:h,...es(t)},m=(e={},t)=>{!1!==e&&this.updateState({...d,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:m})}catch(e){this._error(e),m({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?pt.ERRONEOUS:e.status;e=this._state=Object.freeze(c({...e,status:s}));const{role:o}=this;this.hub.update(Ut(o),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:o,meta:i,...n}=e,r={value:this._mapping(e,this),status:o,data:t,meta:i,...n};return this.role===rt.CONTAINER&&(r.meta={...i,empty:this._isContainerEmpty(t)}),c(r)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!ct(s))continue;let t=e&&e[s];if(s===rt.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Xt{constructor(e){u(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function es(e){return function(e){return e.status===pt.READY&&!e.ongoing}(e)?{empty:!!ts(e)}:{}}function ts(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function ss(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class os{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new H({target:this,error:s}),h(this,{facets:new is(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return c({facets:Object.freeze({}),sort:ss(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(c({...e,...t,facets:Object.freeze(c({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class is{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const ns=Symbol.for("miso:tracked");function rs(e){return!!e[ns]}function as(e){e[ns]=!0}const cs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ls(e,t){return!!t&&{...e,...t}}class us{constructor(e,{workflow:t,extensions:s,layouts:o,roles:i,options:n}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=o,this._options=n,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new os(this);for(const e of i.members)e!==rt.CONTAINER&&(this._views[e]=new Jt(this,e));h(this,{interface:new hs(this),trackers:new ds(this,i.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),e.on("data",(e=>this.refresh({data:e}))),n.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Jt(this,rt.CONTAINER);t.layout=this._createLayout(rt.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,o]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...o,role:t,workflow:this._workflowName});if(t===rt.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,o]=t;return this._layoutFactory.create(s,{...o,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:o}=t._inst;e&&(s=s.filter((t=>t.role===rt.CONTAINER||e.includes(t.role)))),o&&(s=s.filter((e=>!o.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:o={},...i}=e;return c({...cs,...i,impression:ls(cs.impression,t),viewable:ls(cs.viewable,s),click:ls(cs.click,o)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=rt.CONTAINER;this._containerTracker=new Zt({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class hs{constructor(e){this._actor=e,u(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class ds{constructor(e,t){this._views=e;for(const s of t)s!==rt.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,rt.CONTAINER,{get:()=>e._getContainerTracker()})}}class ms{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:ut.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class _s{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=r(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function ps(e){return async({group:t,name:i,payload:n,options:r})=>{if(t===s.ASK)switch(i){case o.QUESTIONS:return e.api.ask.questions(n,r);case o.SEARCH:return e.api.ask.search(n,r)}return e.api[t]._run(i,n,r)}}class fs{constructor({role:e,workflow:t,...s}={}){h(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const o=this._rendered.get(e),i=I(!1);t=this._preprocess({state:t,rendered:o},{skip:i.t})||t,this._updatePending(t,s),i.value||this._handleInput({state:t,rendered:o},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,w((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:o}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),n=I([]),r=I({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:n.args,writeToState:r.merge,...t}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),o&&o(...n.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function bs(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function gs(e,t,s,o){const{templates:i}=e,[n,r]=qs(e,s);return""+n+(i.indexBlock||$s)(e,s,o)+(i.infoBlock||i.articleInfoBlock||ks)(e,s,o)+r}function ys(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-info-container">${""+(i.titleBlock||Ss)(e,t,s)+(i.descriptionBlock||Is)(e,t,s)+(i.priceBlock||Ts)(e,t,s)+(i.ctaBlock||Ps)(e,t,s)}</div>`}function ws(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-info-container">${""+(i.titleBlock||Ss)(e,t,s)+(i.descriptionBlock||Is)(e,t,s)+(i.priceBlock||Ts)(e,t,s)}</div>`}function vs(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-info-container">${""+(i.titleBlock||Ss)(e,t,s)+(i.dateBlock||Os)(e,t,s)+(i.descriptionBlock||Is)(e,t,s)+(i.ctaBlock||Ps)(e,t,s)}</div>`}function ks(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-info-container">${""+(i.titleBlock||Ss)(e,t,s)+(i.authorsAndDateBlock||Cs)(e,t,s)}</div>`}function Es(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-info-container">${""+(i.titleBlock||Ss)(e,t,s)}</div>`}function Ss({className:e},{title:t,_title_with_markups:s}){const o=s||k(t);return o?`<div class="${e}__item-title">${o}</div>`:""}function xs({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function Is({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${k(s)}</div>`:""}function Os({className:e,templates:t},{created_at:s,updated_at:o,published_at:i}){const n=i||s||o;return n?`<div class="${e}__item-date">${js(n,t.date)}</div>`:""}function As({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function Cs(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__item-authors-and-date-container">${""+(i.authorsBlock||As)(e,t,s)+(i.dateBlock||Os)(e,t,s)}</div>`}function Ts(e,t){const{className:s,templates:o}=e,{sale_price:i,original_price:n,currency:r="USD"}=t,a=i||n;if(!a)return"";const c=void 0!==n&&void 0!==i&&n>i,l=t.discount_rate_percent||(c?Math.floor(100*(1-i/n)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${n}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(o.discountRateText||Rs)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function Rs(e,{discount_rate_percent:t}){return`(${t}% off)`}function Ns(e,t,s={}){const{className:o,templates:i}=e,{cover_image:n,image_src:r,image_alt:a}=t;if(!n&&!r)return"";const c=r?"image":"cover-image";return`<div class="${o}__item-${c}-container">${"image"===c?`<img class="${o}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${o}__item-${c}" src="${n}">`}${"cover-image"===c&&s.brand?(i.brandBlock||xs)(e,t,s):""}</div>`}function $s({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Ps(e,t,s){const{className:o,templates:i}=e,n=Ds.asFunction(i.cta)(e,t,s);return n?`<div class="${o}__item-cta-container">${n}</div>`:""}function qs({className:e,options:t={}},{product_id:s,url:o},{classSuffix:i="item-body",role:n="item",...r}={}){const a=!1!==r.link&&o?"a":"div";return[`<${a} class="${e}__${i}" ${n?`data-role="${n}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==r.link&&o?`href="${o}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:o=!0}=e;let i="";o&&(t&&(i+=` target="${t}"`),s&&(i+=` rel="${s}"`));return i}(t.link)}`:""}>`,`</${a}>`]}const Ls=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Us="en-US";function js(e,t=Ls){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||Ls.locale,t);default:throw Error("Invalid date format: "+t)}}const Ds=Object.freeze({tagPair:qs,formatDate:js,formatNumber:function(e,t=Us){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||Us.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:k,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class zs extends fs{constructor({className:e,templates:t,...s}={}){super(s),h(this,{className:e,templates:{...bs("root"),...t,helpers:Ds}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Ms extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ms.MisoClient.ui.layouts.create("banner").render(this)}}class Fs{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:o}=s;this._entries.set(e,{ac:s});let i=!1;try{await v(e,{...t,signal:o}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return i}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class Bs extends fs{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new Fs}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Ms.tagName,s=this._shallRenderBanner(e),o=e.querySelector(t);s&&!o?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&o&&o.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,o=void 0!==s&&"auto"!==s?s:t;return"auto"===o?e.components.some((({role:e})=>function(e){return e===rt.PRODUCTS||e===rt.ANSWER}(e))):!!o}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:o,meta:{miso_id:i,empty:n=!1,unanswerable:r=!1}={}}=t,a=[s,n?pt.EMPTY:pt.NONEMPTY];s===pt.READY&&a.push(o?pt.ONGOING:pt.DONE),r&&a.push(pt.UNANSWERABLE),e.setAttribute("status",a.join(" ")),i?e.setAttribute("miso-id",i):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===pt.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const Qs=Object.freeze({root:function(e,t){const{className:s,templates:o}=e,{status:i,value:n}=t;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${o.message(e,n)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class Gs extends zs{static get type(){return"error"}static get defaultTemplates(){return Qs}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...Qs,...t},...s})}}const Hs=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Ws(e,t){const s=[];for(const o of t.entries){const t=e.e2b.get(o.element);t&&t.key===o.key||s.push(o)}return s}class Vs{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const o=function(e,t,s){const o=new Map,i=new Map,n=[];for(let r=0;e.length>r;r++){const a=e[r],c=s[r],l=Object.freeze({index:r,key:a,value:t[r],element:c});o.set(a,l),i.set(c,l),n.push(l)}return{k2b:o,e2b:i,entries:n}}(e,t,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},n=Ws(i,o),r=Ws(o,i);return this._k2b=o.k2b,this._e2b=o.e2b,this._entries=o.entries,{bounds:n,unbounds:r}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function Ks(e){j(e,Ys.prototype)}class Ys{_initTrackable(){this._bindings=new Vs,this._viewables=new Fs}_syncBindings(e,t){const s=this._getItems(t)||[],o=s.map((e=>this._getItemKey(e))),i=this._getItemElements(e),{bounds:n,unbounds:r}=this._bindings.update(o,s,i);this._onBindingsUpdate(n,r)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:o}of e)(async()=>{await this._viewables.track(o,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!rs(t)&&0===t.button&&!t.defaultPrevented&&!!g(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(as(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Zs{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===pt.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let o=!1;try{await v(t,{area:1,duration:0,signal:s.signal}),o=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}o&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Js=Object.freeze({product:function(e,t,s,o){const{templates:i}=e,[n,r]=qs(e,s);return""+n+(i.imageBlock||Ns)(e,s,o)+(i.infoBlock||i.productInfoBlock||ws)(e,s,o)+r},article:function(e,t,s,o){const{templates:i}=e,[n,r]=qs(e,s);return""+n+(i.imageBlock||Ns)(e,s,o)+(i.infoBlock||i.articleInfoBlock||vs)(e,s,o)+(i.indexBlock||$s)(e,s,o)+r},compactArticle:gs,image:function(e,t,s,o){const{templates:i}=e,[n,r]=qs(e,s);return""+n+(i.imageBlock||Ns)(e,s,o)+(i.infoBlock||i.imageInfoBlock||Es)(e,s,o)+r},question:function(e,t,s){const[o,i]=qs(e,s);return`${o}${s.value||s.text||s}${i}`},root:function(e,t){const{className:s,role:o,templates:i,options:n}=e,{status:r}=t;return`<div class="${s} ${r}"${o?` data-role="${o}"`:""}${n.itemType?` data-item-type="${n.itemType}"`:""}>${r===pt.READY?i[r](e,t):""}${i.trigger(e,t)}${i.loading(e,t)}</div>`},[pt.READY]:function(e,t){const{templates:s}=e,o=e._getItems(t)||[];return o.length>0||t.ongoing?s.body(e,t,o):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:o,templates:i,options:n}=e,r=i.ordered?"ol":"ul";return`<${r} class="${o}__list" data-role="list"${n.itemType?` data-item-type="${n.itemType}"`:""}>${i.items(e,t,s)}</${r}>`},ordered:!1,items:function(e,t,s,{offset:o=0}={}){const{templates:i}=e;let n=o;return s.map((s=>i.item(e,t,s,n++))).join("")},item:function(e,t,s,o){const{className:i,templates:n,options:r}=e,{itemType:a}=r;return`<li class="${i}__item">${n[a](e,t,s,{index:o})}</li>`},productInfoBlock:ws,articleInfoBlock:vs,compactArticleInfoBlock:ks,imageInfoBlock:Es,brandBlock:xs,titleBlock:Ss,descriptionBlock:Is,dateBlock:Os,authorsBlock:As,authorsAndDateBlock:Cs,priceBlock:Ts,discountRateText:Rs,ctaBlock:Ps,cta:function(e,t,s){const{templates:o}=e,{url:i}=t;if(!i)return"";const[n,r]=qs(e,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Ds.asFunction(o.ctaText)(e,t,s);return a?`${n}${a}${r}`:""},imageBlock:Ns,indexBlock:$s,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Xs extends zs{static get defaultTemplates(){return Js}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Js,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),o=this._html(e,t,s);return{...e,incremental:s,html:o}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,o=(this._getItems(e)||[]).slice(s);return o.length>0?this.templates.items(this,e,o,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:o,html:i}=t;if(o)if(i){this._getListElement(e).insertAdjacentHTML("beforeend",i)}else s(!1);else e.innerHTML=i}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:o,element:i}=t;this._view._events.emit("click",{session:s,value:o,element:i,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Ks(Xs.prototype),j(Xs.prototype,Zs.prototype);const eo="miso-list";class to extends Xs{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return eo}constructor({className:e=eo,...t}={}){super({className:e,...t})}}const so="miso-horizontal";class oo extends Xs{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return so}constructor({className:e=so,...t}={}){super({className:e,...t})}}const io="miso-cards";function no(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function ro(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function ao(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),o=t[2]||"";return[s,o]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function co(e){return void 0===e||e instanceof lo?e:new lo(e)}class lo{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=co(e),co([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class uo{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,w((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),o=t.itemCount,i=t.itemCount=s?s.length:void 0;i!==o&&(void 0===i?t.itemIndex=void 0:void 0===o&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(no(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let o=0;for(const t of s.children)ro(t,"active",o===e),o++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const ho="miso-ui-icon",mo=ho+"-svg-1_12_0",_o={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},po=`<symbol id="${ho}-${_o.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,fo=`<symbol id="${ho}-${_o.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,bo=`<symbol id="${ho}-${_o.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,o=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-o} ${o}L${o} ${t-o}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,go=`<svg id="${mo}" style="display:none;">${[po,fo,bo,`<symbol id="${ho}-${_o.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${ho}-${_o.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${ho}-${_o.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let yo=!1;function wo(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${ho}-${e}"></use></svg>`}yo||document.head.querySelector("#"+mo)||(yo=!0,document.head.insertAdjacentHTML("beforeend",go));const vo=new Set(Object.values(_o));wo(_o.SEND),wo(_o.SEARCH);const ko=wo(_o.TRIANGLE);wo(_o.TRIANGLE_EQ);const Eo=wo(_o.CHEVRON),So=wo(_o.CHEVRON_NEGATIVE),xo="miso-carousel",Io=Object.freeze({body:function(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__viewport"><div class="${o}__viewport-inner">${i.list(e,t,s)}</div></div>${i.controls(e,t,s)}`},controls:function(e,t,s){const{templates:o}=e;return`${o.controlContainer(e,t,"previous")}${o.controlContainer(e,t,"next")}${o.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__control-container-${s}">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?So:Eo},indexIndicator:function(e,t,s){const{className:o,templates:i}=e;return`<ul class="${o}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${o}__index-indicator-item">${i.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Oo=Object.freeze({...Xs.defaultTemplates,...Io});class Ao extends Xs{static get type(){return"carousel"}static get defaultTemplates(){return Oo}static get defaultClassName(){return xo}constructor({className:e=xo,templates:t,...s}={}){super({className:e,templates:{...Io,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){j(e,uo.prototype)}(Ao.prototype);const Co="16rem",To=Object.freeze({...Xs.defaultTemplates,item:function(e,t,s,o){const{className:i,templates:n,options:r}=e,{itemType:a}=r,c=n[a](e,t,s,{index:o});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),Ro="miso-gallery";class No extends Xs{static get type(){return"gallery"}static get defaultTemplates(){return To}static get defaultClassName(){return Ro}constructor({className:e=Ro,templates:t,...s}={}){super({className:e,templates:{...To,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),o=s?void 0:this._bodyHtml(e),i=this._itemsHtml(e,t);return{...e,...c({incremental:s,bodyHtml:o,itemsHtml:i})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,o=(this._getItems(e)||[]).slice(s);return o.length>0?this.templates.items(this,e,o,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const o=this._renderListElement(e,t,s);o&&(this._syncListAspectRatio(o),this._renderItems(o,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:o}=t;return s||(e.innerHTML=o),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,o=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,o)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const o=e.children.length,i=this._writeItemSizes((this._getItems(t)||[]).slice(o),s,o);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,i,{offset:o}))}_writeItemSizes(e,[t=0,s=0]=[],o=0){let i=0;o>0&&(i=Math.min(o,t),o-=i,t-=i),o>0&&(i=Math.min(o,s),o-=i,s-=i);const n=[];for(const o of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),n.push({...o,_size:e})}return n}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=co(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:o}=t,{height:i=Co}=this.options,n=ao(i),r=e.clientWidth;if(0===r)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(r*o.width*2/(n*o.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),o=e;const i=Math.min(Math.floor(s/3),o);o-=i,s-=3*i;const n=Math.min(s,o);return o-=n,s-=n,[i,n,o]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,o=0]=t;const{className:i}=this;for(const t of e.children){let e=!1,n=!1;s>0?(e=!0,s--):o>0&&(n=!0,o--),ro(t,i+"__item-large",e),ro(t,i+"__item-medium",n),ro(t,i+"__item-small",!e&&!n)}}}const $o="miso-search-box";const Po=Object.freeze({root:function(e){const{className:t,templates:s,role:o,options:i,autocomplete:n}=e,{placeholder:r}=i;return`\n<div class="${t}" ${o?`data-role="${o}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${n.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:o,buttonIcon:i}=t;var n;return("function"==typeof o?o(e):""+o)+("function"==typeof i?i(e):(vo.has(n=i)?wo(n):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:o,autocomplete:i}=e;e={templates:s,workflow:o,...i};const n=[],r=[];for(const e of t)(e.product?n:r).push(e);return s.queries(e,r)+(r.length>0&&n.length>0?"<hr>":"")+s.products(e,n)},completionList:function(e,t,s){const{className:o,templates:i}=e;return`<ul class="${o}__${t}-list" data-role="${t}-list">${s.map((s=>i.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:o,templates:i}=e;return`\n<li class="${o}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${i[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||k(t)},product:function(e,{product:t}){const{templates:s}=e,[o,i]=s.helpers.tagPair(e,t,{role:!1});return""+o+s.imageBlock(e,t)+s.productInfoBlock(e,t)+i},imageBlock:Ns,productInfoBlock:ws}),qo=Object.freeze({className:"miso-autocomplete",debounce:300});class Lo extends zs{static get type(){return"search-box"}static get defaultTemplates(){return Po}static get defaultClassName(){return $o}constructor({className:e=$o,templates:t,autocomplete:s,...o}={}){super({className:e,templates:{...Po,...t},...o}),h(this,{autocomplete:{...qo,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=q(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:o}){if(!t.completions)return;const{status:i=pt.INITIAL,session:n,value:r}=t.completions,{index:a}=n;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);ro(e,"nonempty",u.length>0),l.setAttribute("data-status",i),l.innerHTML=this.templates.completions(this,u),o({completions:{index:a,status:i}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return Uo.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new Uo(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&g(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let o=t;o&&o!==this._element;o=o.parentElement){if(o.matches('[data-role="submit"]')||o.matches('[data-role="button"]')||o.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(o.matches('[data-role="query-item"]')){const t=o.getAttribute("data-index"),i=this._context().data.get(parseInt(t)),n=i&&i.text;return n&&(s&&(s.value=n),this._view._events.emit("select",Object.freeze({value:i,index:t,domEvent:e})),e.defaultPrevented||this._submit(n)),void this.close()}if(o.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[ut.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class Uo{static empty(){return Uo._empty||(Uo._empty=new Uo)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,o=[];for(const i in e)for(const n of e[i])n.product&&!n.product.url||(n._index=t,n._field=i,s.set(t,n),o.push(n),t++);return o}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const jo="miso-option-list";const Do=Object.freeze({root:function(e,t){const{className:s,role:o,templates:i}=e;return`\n<div class="${s}" ${o?`data-role="${o}"`:""}>\n  ${i.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:o}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>o.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${k(t.text||t)}</li>`}});class zo extends zs{static get type(){return"option-list"}static get defaultTemplates(){return Do}static get defaultClassName(){return jo}constructor({className:e=jo,templates:t,...s}={}){super({className:e,templates:{...Do,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:o}=t;this._syncOptionValues(e,o)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;ro(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),o=s&&s.value;o&&(this._trackClick(e,s),this._submit(o.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}Ks(zo.prototype);const Mo=Object.freeze({...bs("options"),root:function(e){const{className:t,role:s,templates:o}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${o.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:o}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${o.content(e,t)}\n</div>\n`}});class Fo extends zs{static get defaultTemplates(){return Mo}constructor({className:e,templates:t,field:s,defaultValue:o,...i}={}){super({className:e,templates:{...Mo,...t},...i}),this._field=s,this._defaultValue=o}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=g(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:o}=this._view.hub.states[this._field];s=s||void 0===o;const i=t.getAttribute("data-value");s||void 0===o||o!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],w((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:o}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",o),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const Bo="miso-feedback",Qo=["helpful","unhelpful"];const Go=Object.freeze({options:function(e){const{templates:t}=e;return Qo.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:o,options:i={}}=e;return`\n${!1!==i.icon?`<i class="${s}__icon">${o.icon(e,t)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${o.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Ho extends Fo{static get type(){return"feedback"}static get defaultTemplates(){return Go}static get defaultClassName(){return Bo}constructor({className:e=Bo,templates:t,...s}={}){if(super({className:e,templates:{...Go,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Wo="miso-text";const Vo=Object.freeze({root:function(e,{value:t}){const{className:s,role:o,options:{raw:i=!1,tag:n}}=e,r=o?`data-role="${o}"`:"",a=void 0!==t?k(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:o}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[i,n]=t;switch(i){case"date":return e=>s(e,n);case"number":return e=>o(e,n);default:return e=>""+e}}(e)(t)):"";return i?a:`<${n} class="${s}" ${r}>${a}</${n}>`}});class Ko extends zs{static get type(){return"text"}static get defaultTemplates(){return Vo}static get defaultClassName(){return Wo}constructor({className:e=Wo,templates:t,tag:s="p",...o}={}){super({className:e,templates:{...Vo,...t},tag:s,...o})}}class Yo extends fs{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=I(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Zo{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:o,cursor:i,done:n}){const r=o.length;i=Math.min(i,r);const a=!!n&&i===r,c=t.substring(0,s),l=!o.startsWith(c);return a||l?e.innerText=o:e.insertAdjacentText("beforeend",o.substring(s,i)),a&&e.classList.add("done"),{cursor:i,done:a}}}function Jo(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:o,format:i,builtInStyles:n=!0}}=e;"auto"===o&&(o="markdown"===i?"div":"p");const r=s?`data-role="${s}"`:"",a=[t,Xo(t)];n&&"markdown"===i&&a.push("miso-markdown");return`<${o} class="${a.join(" ")}" ${r} data-format="${i}"></${o}>`}(e));const o=t.children[0];return o.setAttribute("data-status",s||pt.INITIAL),o}function Xo(e){return e+"__cursor"}function ei(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:o,ref:i,operation:n,conflict:r}){MisoClient.debug("<progressive-markdown>",`[${function(e){return Math.floor(e)/1e3+"s"}(s-e)}](${ti(o[0])}, ${ti(o[1])})`,t,""+n,i,r)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function ti(e){return Math.floor(100*e)/100+"ms"}const si="miso-typewriter";class oi extends Yo{static get type(){return"typewriter"}static get defaultClassName(){return si}constructor({className:e=si,tag:t="auto",format:s="markdown",tooltip:o=!1,speed:i,acceleration:n,nextCursorFn:r,...a}={}){super({tag:t,format:s,tooltip:o,...a}),h(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:z({speed:i,acceleration:n}),this._readiness=new A,"markdown"===s&&oi.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=Xo(this.className),{onDebug:s,onCitationLink:o,variant:i}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:o,onDebug:ei(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Zo}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:o,session:i,status:n,ongoing:r}=e,a=o&&o.answer_stage||"result",l=(h=e,(u=t)&&h&&u.session&&h.session&&u.session.uuid===h.session.uuid);var u,h;const d=t?l&&a===t.stage?t.streak:t.streak+1:0,m=l&&t&&t.doneAt||(n!==pt.READY||r?void 0:Date.now());return this._prevState=Object.freeze(c({session:i,status:n,value:s,stage:a,streak:d,doneAt:m,done:void 0!==m}))}_render(e,{state:t,rendered:s},{notifyUpdate:o,writeToState:i,loop:n}){const r=Jo(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(r,s,{...t,cursor:e})}i(a);const l=t.status===pt.READY&&!a.done;o({ongoing:l},{silent:l&&(!s||s.status===pt.READY)&&!c}),l&&n()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const o=t.closest("a");if(o){if(!e.defaultPrevented){const{href:t,innerText:s,className:i}=o;t&&this._view._events.emit("link-click",c({event:e,url:t,text:s?s.trim():"",className:i||"",attributes:ii(o)}))}}else;}}function ii(e){const{attributes:t}=e,s={};for(const{name:e,value:o}of t)e.startsWith("data-")&&(s[e]=o);try{return JSON.stringify(s)}catch(e){return"{}"}}const ni="miso-affiliation";const ri=Object.freeze({root:function(e,t){const{className:s,role:o,templates:i,options:n}=e,{status:r}=t,a=o?` data-role="${o}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${n.itemType?` data-item-type="${n.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${r===pt.READY?i[r](e,t):""}</div>`},[pt.READY]:function(e,t){const{templates:s}=e,o=e._getItems(t);return o&&o.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__control-${s}-container">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:o,templates:i}=e;return`<div class="${o}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return ko},body:function(e,t){const{className:s,templates:o}=e,i=e._getItems(t);return`<div class="${s}__body">${o.list(e,t,i)}</div>`},item:function(e,t,s,o){const{className:i,templates:n,options:r}=e,{itemType:a}=r;return`<li class="${i}__item"><div class="${i}__item-inner">${n.itemHeader(e,t,s,{index:o})}${n[a](e,t,s,{index:o})}</div></li>`},itemHeader:function(e,t,s,o){const{className:i,templates:n}=e;let{itemHeaderLeftText:r,itemHeaderRightText:a}=n;return r=Ds.asFunction(r)(e,t,s,o),a=Ds.asFunction(a)(e,t,s,o),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${r}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,o){const{templates:i}=e,[n,r]=qs(e,s,{link:!1});return""+n+(i.infoBlock||i.affiliationInfoBlock||ys)(e,s,o)+(i.imageBlock||Ns)(e,s,{brand:!0,...o})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,o){const{className:i,templates:n}=e,r=Ds.asFunction(n.logoText)(e,t,s,o)||"",a=Ds.asFunction(n.logoImg)(e,t,s,o);return a?`<span class="${i}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(e,t,s,o){const{className:i,templates:n}=e,r=Ds.asFunction(n.logoUrl)(e,t,s,o);if(!r)return"";const a=Ds.asFunction(n.logoAltText)(e,t,s,o);return`<img class="${i}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),ai=Object.freeze({...Xs.defaultTemplates,...ri});class ci extends Xs{static get type(){return"affiliation"}static get defaultTemplates(){return ai}static get defaultClassName(){return ni}constructor({className:e=ni,templates:t,autoplay:s,...o}={}){super({className:e,itemType:"affiliation",templates:{...ri,...t},...o}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new Y(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,w((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:o}=this._view;o=o.firstElementChild,o&&(no(o,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const li="miso-facets",ui="miso-facet",hi="custom_attributes.";const di=Object.freeze({root:function(e,t){const{className:s,role:o,templates:i}=e;return`<div class="${s}" ${o?`data-role="${o}"`:""}>${i.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:o={}}=t.value||{};return Object.keys(o).map((i=>s.facet(e,{field:i,entries:o[i]},t)))},facet:function(e,t,s){const{facetClassName:o=ui,templates:i}=e,{field:n}=t;return`<div class="${o}" data-role="facet" data-field="${k(n)}">${i.header(e,t,s)}${i.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:o=ui,templates:i}=e;return`<div class="${o}__header">${i.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(hi)&&(t=t.substring(18)),k(t)},options:function(e,{field:t,entries:s},o){const{facetClassName:i=ui,templates:n}=e;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>n.option(e,{field:t,value:s,count:i},o))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:o=ui,templates:i}=e;return`\n<li class="${o}__option" data-role="option" tabindex="0">\n  <span class="${o}__value">${i.value(e,t,s)}</span>\n  <span class="${o}__count">${i.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return k(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function mi(e,t){return`${e}:::${t}`}function _i(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class pi extends zs{static get type(){return"facets"}static get defaultTemplates(){return di}static get defaultClassName(){return li}constructor({className:e=li,templates:t,...s}={}){super({className:e,templates:{...di,...t},...s}),this._bindings=new Vs}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=_i(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:o}of this._bindings.entries)this._setSelected(o,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=_i(e.facets);for(const{value:{field:e,value:s},element:o}of this._bindings.entries)t[e]&&this._setSelected(o,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),o=[],i=[],n=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),r=s[e];if(!r)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=r[t];if(!c)break;o.push(mi(e,c)),i.push({field:e,value:c}),n.push(s)}}this._bindings.update(o,i,n)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[k(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),o=s&&s.value;if(!o)return;const{field:i,value:n}=o;this._view.filters.facets.toggle(i,n),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const fi="miso-select";const bi=Object.freeze({root:function(e,t){const{className:s,role:o,templates:i}=e,n=o?`data-role="${o}"`:"",r=e._getItems(t),a=r.find((e=>e.selected))||r[0];return`\n<div class="${s}" ${n}>\n  ${i.button(e,a)}\n  ${i.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:o}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${o.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:o}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>o.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:o}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${o.text(e,t)}</li>`},text:function(e,t){return k(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,((e,t)=>" "+t))||t||"")}});class gi extends zs{static get type(){return"select"}static get defaultTemplates(){return bi}static get defaultClassName(){return fi}constructor({className:e=fi,templates:t,...s}={}){super({className:e,templates:{...bi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}Ks(gi.prototype);const yi="miso-more-button";const wi=Object.freeze({root:function(e,t){const{className:s,role:o,templates:i}=e;return`\n<div class="${s}"${o?` data-role="${o}"`:""}${t.status!==pt.READY?" disabled":""}>\n  ${i.text(e)}\n</div>\n`},text:function(e){return"More"}});class vi extends zs{static get type(){return"more-button"}static get defaultTemplates(){return wi}static get defaultClassName(){return yi}constructor({className:e=yi,templates:t,...s}={}){super({className:e,templates:{...wi,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var ki=Object.freeze({__proto__:null,TemplateBasedLayout:zs,ContainerLayout:Bs,ErrorLayout:Gs,BannerLayout:class extends zs{static get type(){return"banner"}static get defaultTemplates(){return Hs}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Hs,...t},...s})}},CollectionLayout:Xs,ListLayout:to,HorizontalLayout:oo,CardsLayout:class extends Xs{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return io}constructor({className:e=io,...t}={}){super({className:e,...t})}},CarouselLayout:Ao,GalleryLayout:No,SearchBoxLayout:Lo,OptionListLayout:zo,FeedbackLayout:Ho,TextLayout:Ko,TypewriterLayout:oi,AffiliationLayout:ci,FacetsLayout:pi,SelectLayout:gi,MoreButtonLayout:vi});function Ei(e){return e&&e.value&&e.value.revision}function Si(e){const t=function(e){if(!e)return pt.INITIAL;const{request:t,error:s,value:o}=e;return s?pt.ERRONEOUS:o?pt.READY:t?pt.LOADING:pt.INITIAL}(e);return c({status:t,ongoing:t===pt.READY?e.ongoing:void 0,...e})}function xi(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:o}=s;o&&(t.meta.miso_id=o)}function Ii(e){const{request:t,value:s}=e;if(!t)return e;const{payload:o}=t||{},{q:i}=o||{};return i?{...e,value:{...s,keywords:i}}:e}function Oi(e){const{role:t,type:s,items:o}=e,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:c({property:t})}};switch(function(e){return mt.has(e)}(s)&&(!function(e){return lt.has(e)}(t)?(i.product_ids=[],i.context.custom_context.items=(o||[]).map((e=>e.text||e.id||e))):i.product_ids=(o||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case ut.SUBMIT:i.context.custom_context.value=e.value;break;case ut.FEEDBACK:i.context.custom_context.value=i.value=e.value,i.context.custom_context.result_type=i.result_type=e.result_type}return c(i)}function Ai(e={},t={}){return c({...e,...t,context:c({...e.context,...t.context,custom_context:c({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const Ci=Object.freeze({}),Ti=Object.freeze({[rt.CONTAINER]:Bs.type,[rt.ERROR]:Gs.type}),Ri=Object.freeze({}),Ni=Object.freeze({api:Ci,layouts:Ti,trackers:Ri}),$i=Object.freeze({mappings:{[rt.ERROR]:e=>e.error}});class Pi extends V{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:o,defaults:i,options:n}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=o=o||t._client,e=Object.freeze({...e,plugin:s,client:o}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(o),this._defaults=i,this._options=n||new Ct(t&&t._options,i),this._hub=new jt({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,o._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,o=this._client,i=this._options,n=this._extensions,r=this._plugin.layouts;this._sessions=new Dt(s),this._data=new Mt(s,{source:ps(o),options:i}),this._views=new us(s,{extensions:n,layouts:r,roles:t,options:i,workflow:e}),this._interactions=new _s(s,{client:o,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(Ut(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:o}){o||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[Ut(e)]||{};t.session&&t.status===pt.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===pt.READY,o=t===pt.ERRONEOUS;this._emitLifecycleEvent(o?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||o)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),o=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=o.has(e);return o.add(e),!i}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=st(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=Ei(e);if(!l(s)){const e=Ei(this._hub.states.data);if(!l(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=Si(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:pt.READY,session:this.session,...t},this._hub.update(Ut(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=Oi(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const o of s)t=o(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==rt.AFFILIATION)return e;const{items:s}=t;return Ai(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return Ai(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[Ut(t.role)]||{},o=s.meta&&s.meta.miso_id||void 0;return o?Ai(e,{miso_id:o}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function qi(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Li(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:o}=t;if(!o)return e;o=o.map((e=>({...e})));let i=0;for(const e of o)s&&(e.channel=s),e.position=i++;return{...e,affiliation:{...t,products:o}}}(e)}function Li({products:e,...t}){return{channel:"sovrn",...t,products:e.map(Ui)}}function Ui({id:e,deeplink:t,headline:s,description:o,currency:i,retailPrice:n,salePrice:r,discountRate:a,image:l,thumbnail:u,merchant:h,...d}){return c({id:"sovrn-"+e,title:s,description:o,cover_image:l,url:t,currency:i,original_price:n,sale_price:r,discount_rate_percent:a,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:ji({sovrn_id:e,thumbnail:u,merchant:h,...d})})}function ji(e,t=""){return Object.keys(e).reduce(((s,o)=>{const i=e[o];if(void 0===i)return s;const n=t?`${t}_${o}`:o;return"object"==typeof i?{...s,...ji(i,n)}:{...s,[n]:i}}),{})}function Di(e){j(e,zi.prototype)}$t(Pi.prototype),Object.assign(Pi,{DEFAULT_API_OPTIONS:Ci,DEFAULT_LAYOUTS:Ti,DEFAULT_TRACKERS:Ri,DEFAULT_OPTIONS:Ni,ROLES_OPTIONS:$i});class zi{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,o={}]=this._linkFn;if(!1===o.open)window.location.href=t;else{window.open(t,o.target||"_blank",o.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const Mi=Object.freeze({...Pi.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Pi.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Fi=Object.freeze({actor:!1,api:{group:s.ASK,name:o.AUTOCOMPLETE}}),Bi=Object.freeze({...Pi.DEFAULT_LAYOUTS,[rt.QUERY]:[Lo.type,{placeholder:"Ask a question"}],[rt.QUESTION]:[Ko.type,{tag:"h2"}],[rt.ANSWER]:oi.type,[rt.FEEDBACK]:Ho.type,[rt.IMAGES]:[No.type,{incremental:!0,itemType:"image"}],[rt.SOURCES]:[to.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[rt.AFFILIATION]:[ci.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Qi=Object.freeze({...Pi.DEFAULT_TRACKERS,[rt.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:kt.click},[rt.IMAGES]:kt,[rt.SOURCES]:kt,[rt.AFFILIATION]:kt,[rt.PRODUCTS]:kt}),Gi=Object.freeze({...Pi.DEFAULT_OPTIONS,api:Mi,autocomplete:Fi,layouts:Bi,trackers:Qi}),Hi=Je(Pi.ROLES_OPTIONS,{main:rt.ANSWER,members:Object.keys(Bi)});class Wi extends Pi{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new ms(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(rt.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(rt.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[Ut(this._roles.main)]||{};e.session&&e.status!==pt.INITIAL&&(e.status!==pt.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,o=t===pt.READY&&!e.ongoing,i=t===pt.ERRONEOUS,n=o?"done":i?"error":t,r=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(n,e),(o||i)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){qt.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||nt}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:qi(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_updateUrlIfNecessary({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:o}=this._autoQuery,i=e&&e.question||t&&t.payload&&t.payload.question,n=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source;if(!i)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(o)||nt;i===a&&n===c||(r.searchParams.set(s,i),n===nt?r.searchParams.delete(o):r.searchParams.set(o,n),window.history.replaceState({},"",r))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=function(e,{event_target:t}={}){return t?Ai(e,{context:{custom_context:{event_target:t}}}):e}(e=this._writeAnswerClickInteraction(e,t),t)}_writeAskPropertiesToInteraction(e={},t){return Ai(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==rt.ANSWER)return e;const{items:s=[]}=t;return Ai(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[Ut(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e,event:t}){if(rs(t))return;const{value:s}=this.states.data||{},{sources:o}=s||{},i=o&&o[e-1];i&&i.product_id&&(as(t),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){rs(e)||(as(e),this._views.trackers.answer.click([],{items:[t]}))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Di(Wi.prototype),Object.assign(Wi,{DEFAULT_API_OPTIONS:Mi,DEFAULT_AUTOCOMPLETE_OPTIONS:Fi,DEFAULT_LAYOUTS:Bi,DEFAULT_TRACKERS:Qi,DEFAULT_OPTIONS:Gi,ROLES_OPTIONS:Hi});const Vi=Object.freeze({...Wi.DEFAULT_API_OPTIONS,name:o.QUESTIONS,payload:{...Wi.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Ki=Object.freeze({...Wi.DEFAULT_LAYOUTS,[rt.QUERY]:[Lo.type,{templates:{buttonIcon:"send"}}],[rt.RELATED_RESOURCES]:[to.type,{incremental:!0,itemType:"article"}],[rt.QUERY_SUGGESTIONS]:zo.type}),Yi=Object.freeze({...Wi.DEFAULT_TRACKERS,[rt.RELATED_RESOURCES]:kt,[rt.QUERY_SUGGESTIONS]:{...kt,click:{...kt.click,validate:e=>0===e.button}}}),Zi=Object.freeze({...Wi.DEFAULT_OPTIONS,api:Vi,layouts:Ki,trackers:Yi}),Ji=Je(Wi.ROLES_OPTIONS,{members:Object.keys(Ki)});class Xi extends Wi{constructor(e,t){super({name:"ask",context:e,roles:Ji,defaults:Zi,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;h(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:o}=this;let i=c({...s,question:e,parent_question_id:o,_meta:{...s._meta,question_source:t||nt}});return i=this._writeWikiLinkTemplateToPayload(i),i}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let o,i,n,{property:r}=e.context&&e.context.custom_context||{};return t.role===rt.QUERY_SUGGESTIONS?(r="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,o=this.parentQuestionId,n=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,o=this.questionId,n=this._getQuestionSourceFromViewState(t)),Ai(e,{context:{custom_context:{property:r,root_question_id:s,parent_question_id:i,question_id:o,question_source:n}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class en extends Lt{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Xi(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Xi(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const tn=Object.freeze({...Pi.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Pi.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),sn=Object.freeze({...Pi.DEFAULT_LAYOUTS,[rt.QUERY]:[Lo.type],[rt.PRODUCTS]:[to.type,{incremental:!0,infiniteScroll:!0}],[rt.KEYWORDS]:[Ko.type,{raw:!0}],[rt.TOTAL]:[Ko.type,{raw:!0,format:"number"}],[rt.FACETS]:[pi.type],[rt.SORT]:[gi.type],[rt.MORE]:[vi.type]}),on=Object.freeze({...Pi.DEFAULT_TRACKERS,[rt.PRODUCTS]:kt}),nn=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),rn=Object.freeze({...Pi.DEFAULT_OPTIONS,api:tn,layouts:sn,trackers:on,pagination:nn}),an=Je(Pi.ROLES_OPTIONS,{main:rt.PRODUCTS,members:Object.keys(sn),mappings:{[rt.FACETS]:"facet_counts",[rt.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:o=[]}={}}=s.filters||{};if(!o.length)return[];const{sort:i}=t.states.filters||{},n=i&&i.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(o).field;return n?o.map((e=>({...e,selected:e.field===n}))):o}}});class cn extends Pi{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(rt.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){qt.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this._views.filters.reset({silent:!0}),this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==pt.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:o}=t||{};return c({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(o)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const o=e[s];o&&o.length&&(t[s]={terms:o})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return r(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},o=s.map((e=>e.product_id)).filter((e=>e)),i=[...e.exclude||[],...o];return 0===i.length?e:{...e,exclude:i}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:o}=e;switch(s){case pt.INITIAL:case pt.LOADING:break;default:return e}return o&&o.facet_counts?e:{...e,value:{...o,facet_counts:t}}}(e=Ii(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=rt.PRODUCTS}={}){const{status:s,request:o,value:i}=e;if(s!==pt.READY||!o||!i)return e;const{[t]:n}=i;if(!n)return e;const{rows:r}=o.payload,{length:a}=n;return r>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=rt.PRODUCTS}={}){if(!t.value)return e;const{[s]:o=[],facet_counts:i,total:n}=e.value,{[s]:r=[]}=t.value;return{...t,value:{...t.value,facet_counts:i,total:n,[s]:[...o,...r]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}$t(cn.prototype,[bt.PAGINATION,bt.FILTERS]),Object.assign(cn,{DEFAULT_API_OPTIONS:tn,DEFAULT_LAYOUTS:sn,DEFAULT_TRACKERS:on,DEFAULT_PAGINATION:nn,DEFAULT_OPTIONS:rn,ROLES_OPTIONS:an});const ln=Object.freeze({members:[]});function un({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function hn(e){return e&&e.value&&e.value.trim()||void 0}class dn extends Pi{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:un(t),roles:ln,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,hn(e)===hn(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!hn(e))return void this._updateCompletions({session:s,status:pt.INITIAL});const o=this._buildPayload(e);this._request({payload:o})}_buildPayload(e){return{q:hn(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function mn(e){j(e,_n.prototype)}class _n{_initAutocomplete(e){this._autocomplete=new dn(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const pn=Je(Wi.ROLES_OPTIONS,{mappings:{[rt.QUESTION]:rt.KEYWORDS}});class fn extends Wi{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:pn,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset({silent:!0}),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._writeWikiLinkTemplateToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||nt}}}_defaultProcessData(e){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:o}={}}=t;return o?{...e,meta:{...e.meta,miso_id:o}}:e}(e=Ii(e=super._defaultProcessData(e))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_updateDataInHub(e){switch(e.status){case pt.INITIAL:case pt.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),xi(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}mn(fn.prototype);const bn={...cn.ROLES_OPTIONS,members:[rt.PRODUCTS,rt.KEYWORDS,rt.TOTAL,rt.FACETS,rt.SORT,rt.MORE,rt.ERROR]};class gn extends cn{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:bn,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:c({...e._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(e){return xi(e=super._defaultProcessData(e)),e}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}}Object.assign(gn,{ROLES_OPTIONS:bn});class yn{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return gn.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,o=this._getSubviews(s);if(!o._containers.has(e)){for(const s of this._getAllSubviews())if(s!==o&&s._containers.has(e)){for(const o of e.components)if(s.containsElement(o))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${o.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}o.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const wn=Object.freeze({group:s.ASK,name:o.SEARCH,payload:{...Wi.DEFAULT_API_OPTIONS.payload,...cn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),vn=Object.freeze({...Wi.DEFAULT_LAYOUTS,...cn.DEFAULT_LAYOUTS,[rt.QUERY]:[Lo.type,{placeholder:""}],[rt.QUESTION]:[Ko.type,{raw:!0}],[rt.SOURCES]:[oo.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:gs,articleInfoBlock:ks}}]}),kn=Object.freeze({...Wi.DEFAULT_TRACKERS,...cn.DEFAULT_TRACKERS}),En=Object.freeze({...cn.DEFAULT_PAGINATION,active:!0}),Sn=Object.freeze({api:{group:s.ASK,name:o.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),xn=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),In=Object.freeze({...Wi.DEFAULT_OPTIONS,...cn.DEFAULT_OPTIONS,api:wn,layouts:vn,trackers:kn,autocomplete:Sn,pagination:En,filters:xn}),On=Object.freeze({main:rt.PRODUCTS,members:Object.keys(vn),mappings:Object.freeze({...Wi.ROLES_OPTIONS.mappings,...cn.ROLES_OPTIONS.mappings})});class An extends Pi{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:On,defaults:In})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new fn(this),this._results=new gn(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){this._views=new yn(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return e=this._answer._defaultProcessInteraction0(e,t),e=this._results._defaultProcessInteraction0(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}$t(An.prototype,[bt.PAGINATION,bt.FILTERS]);const Cn=Object.freeze({group:s.SEARCH,name:o.SEARCH,payload:{fl:["*"]}}),Tn=Object.freeze({api:{group:s.SEARCH,name:o.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Rn=Object.freeze({...cn.DEFAULT_LAYOUTS}),Nn=Object.freeze({...cn.DEFAULT_TRACKERS}),$n=Object.freeze({...cn.DEFAULT_OPTIONS,api:Cn,autocomplete:Tn,layouts:Rn,trackers:Nn}),Pn=cn.ROLES_OPTIONS;class qn extends cn{constructor(e,t){super({name:"search",plugin:e,client:t,roles:Pn,defaults:$n})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=rt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}mn(qn.prototype);class Ln extends Lt{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=it){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=it){return this._members.has(e)}get(e=it){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class Un extends Pi{_initProperties(e){super._initProperties(e);const{id:t}=e;h(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return Ai(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign(Un,{DEFAULT_API_OPTIONS:Pi.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Pi.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Pi.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Pi.DEFAULT_OPTIONS,ROLES_OPTIONS:Pi.ROLES_OPTIONS});const jn=Object.freeze({...Un.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:o.USER_TO_PRODUCTS,payload:{...Un.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Dn=Object.freeze({...Un.DEFAULT_LAYOUTS,[rt.PRODUCTS]:to.type}),zn=Object.freeze({...Un.DEFAULT_TRACKERS,[rt.PRODUCTS]:kt}),Mn=Object.freeze({...Un.DEFAULT_OPTIONS,api:jn,layouts:Dn,trackers:zn}),Fn=Je(Un.ROLES_OPTIONS,{main:rt.PRODUCTS,members:Object.keys(Dn)});class Bn extends Un{constructor(e,t){super({name:"recommendation",context:e,roles:Fn,defaults:Mn,id:t})}start(){return this._request(),this}notifyViewUpdate(e=rt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class Qn extends Ln{constructor(e,t){super("recommendations",e,t)}_create(e){return new Bn(this,e)}}const Gn=Object.freeze({...Un.DEFAULT_API_OPTIONS,group:s.ASK,name:o.RELATED_QUESTIONS}),Hn=Object.freeze({...Un.DEFAULT_LAYOUTS,[rt.RELATED_QUESTIONS]:[to.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[rt.QUERY]:[Lo.type,{placeholder:"Ask a question"}]}),Wn=Object.freeze({...Un.DEFAULT_TRACKERS,[rt.RELATED_QUESTIONS]:kt,[rt.CONTAINER]:{...kt,itemless:!0},[rt.QUERY]:{[ut.SUBMIT]:{active:!0}}}),Vn=Object.freeze({...Un.DEFAULT_OPTIONS,api:Gn,layouts:Hn,trackers:Wn}),Kn=Je(Un.ROLES_OPTIONS,{main:rt.RELATED_QUESTIONS,members:Object.keys(Hn)});class Yn extends Un{constructor(e,t){super({name:"explore",context:e,roles:Kn,defaults:Vn,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(rt.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return zi.prototype.useLink.call(this,e,t),t&&this.useLayouts({[rt.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=rt.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=zi.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}Di(Yn.prototype);class Zn extends Ln{constructor(e,t){super("explores",e,t)}_create(e){return new Yn(this,e)}}class Jn extends V{constructor({name:e,plugin:t,MisoClient:s,...o}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=o}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new A)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var Xn=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var er=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class tr{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class sr{constructor(e){this._context=e,h(this,{lowerCamelToKebab:_,kebabToLowerCamel:d,kebabOrSnakeToLowerCamel:m})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...o}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...o}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=m(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:o=!1}){const{classPrefix:i}=e;return`<${s} class="${o?i+"__phrase-inline":i+"__phrase"} ${i}__${t}-phrase">${this.phraseText(e,d(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,o=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof o){case"function":return o(e);case"string":return o;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:o,visibleWhen:i,logo:n=!1},r){const a=[`${e}__${o}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:n,parentQuestionId:s},r)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const o=t[e];void 0!==o&&(s+=` ${_(e)}="${o}"`)}return s}}const or=D(new sr({...Xn,DEFAULT_PHRASES:er})),ir=D(new class extends tr{constructor(){super({helpers:or})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:o}=this._helpers,{features:i={},logo:n=!0}=e;return o(e,{name:"related-resources"},!1===i.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:n},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:o={}}=e;return!1===o.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:or}));function nr(e={}){const{normalizeOptions:t,section:s,container:o}=or,{querySuggestions:i,answerGroup:n}=ir;return s(e=t(e),{name:"follow-up"},[i(e),o(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...n(e)])}var rr=Object.freeze({__proto__:null,helpers:or,sections:ir,root:function(e={}){const{normalizeOptions:t,section:s,container:o}=or,{followUps:i,relatedResourcesSection:n,answerGroup:r}=ir;return""+s(e=t(e),{name:"question"},[o(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},r(e))+i(e)+n(e)},followUp:nr});const ar=Object.freeze(Xn),cr=Object.freeze(er),lr=Object.freeze(rr);var ur=Object.freeze({__proto__:null,constants:ar,phrases:cr,templates:lr,wireFollowUps:function(e,t,{template:s=nr,...o}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const i=e.ui.asks,n=e.ui.ask;i.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...o,parentQuestionId:e.workflow.questionId}))})),n.on("loading",(()=>{t.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:hr}=document,dr=Object.freeze({templates:lr,autostart:!0}),mr=["templates","phrases","features"];class _r{constructor(){this._defaults=dr,this._scriptSrc=function(){if(!hr||!hr.src)return{};const e=document.createElement("a");e.href=hr.src;const t={};for(const[s,o]of new URLSearchParams(e.search))"q"!==s&&(t[s]=br(o));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=br(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:o,...i}={}){return c({apiKey:e,apiHost:t,templates:gr(s),phrases:o,...i})}(pr(this._defaults,this._scriptSrc,e,this._pageUrl))}}function pr(...e){let t={};for(const s of e)s&&(t=fr(t,s));return t}function fr(e,t){if(!t)return e;Object.assign(e,t);for(const s of mr)s in t&&(e[s]={...e[s],...t[s]});return e}function br(e){return""===e||"false"!==e&&e}function gr(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(gr):function(e,t){const s={};for(const[o,i]of Object.entries(e))s[o]=t(i);return s}(e,gr);default:throw Error("Unsupported template type: "+e)}}class yr{constructor(e,{classPrefix:t=ar.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");h(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class wr extends Jn{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new _r,this._localOptions={}}config(e={}){e=pr(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;h(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new yr(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:o}=this,{wireFollowUps:i,wireRelatedResources:n}=e.ui.defaults.ask,{templates:r={},features:a={},api:c}=o,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(t,s.followUpsSection,{...o,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&n(t,s.relatedResourcesSection),l.autoQuery()}}class vr extends K{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let kr,Er,Sr;async function xr(e){const t=await async function(e){return e.MisoClient||window.MisoClient||kr||(kr=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return Er=Er||t.any(),Sr=Sr||await Er,Sr.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),Sr}const Ir="logo",Or="auto",Ar=Object.freeze([Ir]);function Cr(e){if(!e)return Or;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class Tr extends HTMLElement{static get observedAttributes(){return Ar}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Cr(this.getAttribute(Ir))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Or:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(Ir,t):this.removeAttribute(Ir)}async connectedCallback(){const e=this._client=await xr(Tr);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===Ir)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){Cr(e)!==Cr(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const Rr="parent-question-id",Nr=Object.freeze([...Tr.observedAttributes,Rr]);const $r="unit-id",Pr=Object.freeze([...Tr.observedAttributes,$r]);class qr extends Tr{static get observedAttributes(){return Pr}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute($r)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute($r,e):this.removeAttribute($r)}attributeChangedCallback(e,t,s){if(e===$r)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var Lr=Object.freeze({__proto__:null,MisoAskElement:class extends Tr{static get tagName(){return"miso-ask"}static get observedAttributes(){return Nr}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Rr)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(Rr,e):this.removeAttribute(Rr))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===Rr)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends qr{static get tagName(){return"miso-explore"}static get observedAttributes(){return qr.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends Tr{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Tr.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends Tr{static get tagName(){return"miso-search"}static get observedAttributes(){return Tr.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends qr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return qr.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const Ur="role",jr=Object.freeze([Ur]);class Dr extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return jr}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(Ur);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ur}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${Ur}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===Ur&&this._container&&this._container._updateComponentRole(this,t,s)}}var zr=Object.freeze({__proto__:null,MisoComponentElement:Dr,MisoQueryElement:class extends Dr{constructor(){super({role:rt.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Dr{constructor(){super({role:rt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Dr{constructor(){super({role:rt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Dr{constructor(){super({role:rt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Dr{constructor(){super({role:rt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Dr{constructor(){super({role:rt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Dr{constructor(){super({role:rt.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Dr{constructor(){super({role:rt.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Dr{constructor(){super({role:rt.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Dr{constructor(){super({role:rt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Dr{constructor(){super({role:rt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends Dr{constructor(){super({role:rt.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Dr{constructor(){super({role:rt.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Dr{constructor(){super({role:rt.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Dr{constructor(){super({role:rt.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Dr{constructor(){super({role:rt.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Dr{constructor(){super({role:rt.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Dr{constructor(){super({role:rt.ERROR})}static get tagName(){return"miso-error"}}});class Mr extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Mr.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Fr=Object.freeze({__proto__:null,containers:Lr,roles:zr,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Mr{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Ms});const Br="miso-hybrid-search-combo";var Qr=Object.freeze({__proto__:null,CLASS_PREFIX:Br,CONAINER_TAG:"miso-hybrid-search"});const Gr="Show more",Hr="Show less";var Wr=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:Gr,showLess:Hr});const Vr=D(new sr({...Qr,DEFAULT_PHRASES:Wr})),Kr=D(new class extends tr{constructor(){super({helpers:Vr})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Vr}));var Yr=Object.freeze({__proto__:null,helpers:Vr,sections:Kr,root:function(e={}){const{normalizeOptions:t,section:s,container:o}=Vr;e=t(e);const{answerBox:i,answerGroup:n,searchResultsGroup:r}=Kr,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[o(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[i(e)]:n(e))+s(e,{name:"search-results"},r(e))}});const Zr="answer-box-open",Jr="answer-box-shown",Xr='[data-role="answer-box-toggle"]';class ea{constructor(e,t,{classPrefix:s=Br,phrases:o={},hideWhenUnanswerable:i=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=o,this._hideWhenUnanswerable=i,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Xr)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case pt.ERRONEOUS:case pt.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||Hr:this._phrases.showMore||Gr;for(const t of this._element.querySelectorAll(Xr))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const ta={isOpen:Zr,shown:Jr},sa={toggleOpen:["toggle",Zr],open:["open",Zr],close:["remove",Zr],toggleHidden:["toggle",Jr],show:["add",Jr],hide:["remove",Jr]};for(const[e,t]of Object.entries(ta))Object.defineProperty(ea.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(sa))ea.prototype[e]=function(){this._updateBoxStatus(t,s),s===Zr&&(this._syncButtonText(),this._syncScroll())};const oa=Object.freeze(Qr),ia=Object.freeze(Wr),na=Object.freeze(Yr);var ra=Object.freeze({__proto__:null,constants:oa,phrases:ia,templates:na,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new ea(e,t,s)}});const aa=Object.freeze(ur),ca=Object.freeze(ra);var la=Object.freeze({__proto__:null,ask:aa,hybridSearch:ca});let ua,ha;async function da(){return ha||(ha=N(ua||(ua=$("ui"))))}class ma{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class _a{constructor(e,t){this._plugin=e,this._client=t,h(this,{sources:{api:ps(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new qn(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new An(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class pa{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new wr(this._plugin,this._MisoClient))}}Ce.plugins.use(class extends V{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new vr(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new A}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:la};u(s,this,["layouts","combo","ready"]),h(this,{MisoClient:e}),h(e,{ui:s}),this.combo=new pa(this,e);const o=Object.values(ki).filter((e=>e.type));for(const t of o)t.MisoClient=e;for(const e of o)this.layouts.register(e);const{containers:i,roles:n,combos:r,...a}=Fr,c=[...Object.values(r),...Object.values(i),...Object.values(n),...Object.values(a)];Tr.MisoClient=e,Mr.MisoClient=e;for(const t of c)t.MisoClient=e;await da();for(const e of c)y(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){h(e,{ui:new _a(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new ma(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Qn(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new Zn(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new en(this,e)),t}}),Ce.attach(),function(e){const t=[];function s(e){t.push(e)}T("misodev",{transform:e=>()=>e({addCmdTransform:s})});const o=e=>{for(const s of t)e=s(e);return e};setTimeout((()=>{T("misocmd",{transform:o}),e&&e()}))}((function(){xe._cmdRes.resolve()}));const fa="/crn-answers",ba=/^\/(news)\/.+/,ga={key:"crnasia",name:"CRN",domain:"www.crnasia.com",locale:"en",fq:'custom_attributes.site:"crnasia.com" OR (NOT custom_attributes.site:*)',contentWrapperSelector:".middle-section"},ya={en:{"button.ask":"Ask {siteName}","placeholder.query":"What do you want to know?","header.answers":"{siteName} Answers","header.answers.description":"Trusted, in-depth answers — right now.","header.explore.description":"Uncover more expert insights.","header.showing_results":"Showing results for","header.search":"Search","header.search.description":"Enter your search terms below to find articles, news, and more.","text.generated_by":"Generated by {siteName} Answers","sources.title":"This answer is based on the following articles","followup.explore_related":"Explore related questions","sponsored.label":"Sponsored","sponsored.by":"Sponsored by {sponsor}","sponsored.content":"SPONSORED CONTENT","sponsored.from":"From Our {siteName} Answers Sponsor","sponsored.from_sponsors":"* From our {siteName} Sponsors","search.results":"results","search.sort_by":"Sort by:","search.sort_by.relevance":"Relevance","search.sort_by.date":"Date","search.placeholder":"Search for articles, news, companies...","search.button":"Search","search.popular":"Popular Searches","search.popular.ai":"Artificial Intelligence","search.popular.cloud":"Cloud Computing","search.popular.security":"Cybersecurity","search.popular.analytics":"Data Analytics","search.popular.transformation":"Digital Transformation","search.popular.software":"Enterprise Software","about.title":"About {siteName} Answers","common.by":"BY"},de:{"button.ask":"{siteName} fragen","placeholder.query":"Was möchten Sie wissen?","header.answers":"{siteName} Antworten","header.answers.description":"Vertrauenswürdige, tiefgreifende Antworten — jetzt.","header.explore.description":"Entdecken Sie weitere Experteneinblicke.","header.showing_results":"Ergebnisse anzeigen für","header.search":"Suche","header.search.description":"Geben Sie unten Ihre Suchbegriffe ein, um Artikel, Nachrichten und mehr zu finden.","text.generated_by":"Generiert von {siteName} Antworten","sources.title":"Diese Antwort basiert auf den folgenden Artikeln","followup.explore_related":"Verwandte Fragen erkunden","sponsored.label":"Gesponsert","sponsored.by":"Gesponsert von {sponsor}","search.sort_by.relevance":"Relevance","search.sort_by.date":"Date","sponsored.content":"GESPONSERTER INHALT","sponsored.from":"Von unserem {siteName} Antworten Sponsor","sponsored.from_sponsors":"* Von unseren {siteName} Sponsoren","search.results":"Ergebnisse","search.sort_by":"Sortieren nach:","search.placeholder":"Suche nach Artikeln, Nachrichten, Unternehmen...","search.button":"Suchen","search.popular":"Beliebte Suchen","search.popular.ai":"Künstliche Intelligenz","search.popular.cloud":"Cloud Computing","search.popular.security":"Cybersicherheit","search.popular.analytics":"Datenanalyse","search.popular.transformation":"Digitale Transformation","search.popular.software":"Unternehmenssoftware","about.title":"Über {siteName} Antworten","common.by":"VON"}};function wa(e,t={}){let s=(ya[ga.locale||"en"]||ya.en)[e]||ya.en[e]||e;const o={siteName:ga.name||"CRN",...t};return Object.keys(o).forEach((e=>{const t=RegExp(`\\{${e}\\}`,"g");s=s.replace(t,o[e])})),s}function va(){return ga.fq||"NOT custom_attributes.site:*"}const ka={key:"crnasia",name:"CRN",domain:"www.crnasia.com",locale:"en",fq:'custom_attributes.site:"crnasia.com" OR (NOT custom_attributes.site:*)',contentWrapperSelector:".middle-section"},Ea={crn:'\n<section class="miso-crn-disclaimer">\n  <h2>About CRN Answers</h2>\n  <p>CRN Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://crn.com/" target="_blank" rel="noopener">CRN.com</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The CRN Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via CRN Answers to help us better understand reader interest. CRN Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',crnasia:'\n<section class="miso-crn-disclaimer">\n  <h2>About CRN Answers</h2>\n  <p>CRN Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://crnasia.com/" target="_blank" rel="noopener">CRN Asia</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The CRN Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via CRN Answers to help us better understand reader interest. CRN Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',crnau:'\n<section class="miso-crn-disclaimer">\n  <h2>About CRN Answers</h2>\n  <p>CRN Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://crn.com.au/" target="_blank" rel="noopener">CRN Australia</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The CRN Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via CRN Answers to help us better understand reader interest. CRN Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',channelwebuk:'\n<section class="miso-crn-disclaimer">\n  <h2>About CRN Answers</h2>\n  <p>CRN Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://channelweb.co.uk/" target="_blank" rel="noopener">Channel Web UK</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The CRN Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via CRN Answers to help us better understand reader interest. CRN Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',computinguk:'\n<section class="miso-crn-disclaimer">\n  <h2>About Computing Answers</h2>\n  <p>Computing Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://computing.co.uk/" target="_blank" rel="noopener">Computing UK</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The Computing Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via Computing Answers to help us better understand reader interest. Computing Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',mescomputing:'\n<section class="miso-crn-disclaimer">\n  <h2>About MES Computing Answers</h2>\n  <p>MES Computing Answers is an AI-powered search tool designed to provide answers based on our own content rather than pulling from the open web.</p>\n  <p>It provides responses based on the latest available content, including new articles, Industry Voices sites, and referenced sources from <a href="https://mescomputing.com/" target="_blank" rel="noopener">MES Computing</a>.</p>\n  <p>By using this search feature, you acknowledge that:</p>\n  <ul>\n    <li>AI-generated results are for informational purposes only and should not be considered professional advice.</li>\n    <li>Sources used to generate responses will be cited for transparency.</li>\n    <li>Some results may include sponsored content, which will be clearly marked as "Sponsored" to distinguish it from editorial content.</li>\n    <li>The AI system continuously evolves, and it may not always reflect the latest industry updates or standards.</li>\n  </ul>\n  <p>For verified information, we recommend consulting official sources or reaching out to our support team.</p>\n  <p>The MES Computing Answers tool is made available for use “as is” with no representations or warranties under the <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>. We are recording queries submitted via MES Computing Answers to help us better understand reader interest. MES Computing Answers also collects anonymized user data that allows us to better understand the interests and intent of readers visiting our websites. See the <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Privacy Policy | Miso Technologies</a>.</p>\n</section>\n',crnde:'\n<section class="miso-crn-disclaimer">\n  <h2>Über CRN Antworten</h2>\n  <p>CRN Germany Antworten ist ein KI-gestütztes Suchwerkzeug, das Antworten basierend auf unseren eigenen Inhalten bereitstellt, anstatt aus dem offenen Web zu ziehen.</p>\n  <p>Es liefert Antworten basierend auf den neuesten verfügbaren Inhalten, einschließlich neuer Artikel, Industry Voices-Sites und referenzierter Quellen von <a href="https://crn.de/" target="_blank" rel="noopener">CRN Germany</a>.</p>\n  <p>Durch die Nutzung dieser Suchfunktion erkennen Sie an, dass:</p>\n  <ul>\n    <li>KI-generierte Ergebnisse nur zu Informationszwecken dienen und nicht als professionelle Beratung angesehen werden sollten.</li>\n    <li>Quellen, die zur Generierung von Antworten verwendet werden, werden aus Gründen der Transparenz zitiert.</li>\n    <li>Einige Ergebnisse können gesponserte Inhalte enthalten, die eindeutig als "Gesponsert" gekennzeichnet werden, um sie von redaktionellen Inhalten zu unterscheiden.</li>\n    <li>Das KI-System entwickelt sich ständig weiter und spiegelt möglicherweise nicht immer die neuesten Branchenupdates oder -standards wider.</li>\n  </ul>\n  <p>Für verifizierte Informationen empfehlen wir, offizielle Quellen zu konsultieren oder sich an unser Support-Team zu wenden.</p>\n  <p>Das CRN Antworten-Tool wird “wie besehen” ohne Zusicherungen oder Gewährleistungen gemäß den <a href="https://miso.ai/terms-of-service/" target="_blank" rel="noopener">Geschäftsbedingungen</a> zur Verfügung gestellt. Wir zeichnen über CRN Antworten übermittelte Anfragen auf, um das Interesse der Leser besser zu verstehen. CRN Antworten sammelt auch anonymisierte Benutzerdaten, die es uns ermöglichen, die Interessen und Absichten der Besucher unserer Websites besser zu verstehen. Siehe die <a href="https://askmiso.com/privacy-policy" target="_blank" rel="noopener">Datenschutzrichtlinie | Miso Technologies</a>.</p>\n</section>\n'};const Sa=`\n<h2>${wa("header.answers")}</h2>\n<p>${wa("header.explore.description")}</p>\n<miso-explore>\n  <miso-related-questions></miso-related-questions>\n  <miso-query></miso-query>\n</miso-explore>\n`,xa=`\n<div class="miso-crn-info-style-block-container">\n  <div class="miso-crn-info-style-block miso-crn-info-style-block__main">\n    <div class="miso-crn-info-style-block__description">\n      <div>${wa("header.answers.description")}</div>\n    </div>\n    <section class="miso-ask-combo__section miso-ask-combo__question">\n      <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" logo="false">\n        <miso-query></miso-query>\n      </miso-ask>\n    </section>\n  </div>\n</div>\n<div class="miso-crn-answer-block">\n  <section class="miso-ask-combo__section miso-ask-combo__answer">\n    <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">${wa("text.generated_by")}</div>\n      <miso-question></miso-question>\n      <miso-answer></miso-answer>\n    </miso-ask>\n  </section>\n</div>\n<section class="miso-ask-combo__section miso-ask-affiliation">\n  <miso-ask class="miso-ask-combo__affiliation-container" logo="false"></miso-ask>\n</section>\n<section class="miso-ask-combo__section miso-ask-source">\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">${wa("sources.title")}</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n</section>\n<div id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></div>\n${Ea[ka.key||"crn"]||Ea.crn}\n`,Ia=({className:e},{tags:t,url:s=""})=>s.includes("/sponsored/")?`<div class="${e}__item-section">${wa("sponsored.label")}</div>`:t&&Array.isArray(t)&&t.length?`<div class="${e}__item-section">${t[0]}</div>`:"",Oa=({className:e},{authors:t})=>t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${wa("common.by")} <span>${t.join(", ")}</span></div>`:"",Aa=({className:e},{custom_attributes:t={}})=>{const{sponsoredby:s}=t;return s?`<div class="${e}__item-sponsored">${wa("sponsored.by",{sponsor:s})}</div>`:""},Ca=(e,t,s)=>{const{className:o,templates:{titleBlock:i,descriptionBlock:n,dateBlock:r}}=e,{url:a}=t;return`<div class="${o}__item-info-container">${`<a href="${Ua(t)}" target="_blank" rel="noopener">`+Ia(e,t)+"</a>"+`<a href="${a}" target="_blank" rel="noopener" class="${o}__info-link">`+i(e,t,s)+n(e,t,s)+Oa(e,t)+r(e,t,s)+Aa(e,t)+"</a>"}</div>`},Ta=(e,t,s,o)=>{const{templates:{helpers:{tagPair:i},imageBlock:n,indexBlock:r}}=e,{url:a}=s,[c,l]=La(i(e,s));return[c,`<a href="${a}" target="_blank" rel="noopener">`,n(e,s),"</a>",Ca(e,s,o),r(e,s,o),l].join("")},Ra=({parentQuestionId:e})=>`\n<section class="miso-ask-combo__section miso-ask-combo__follow-up">\n  <miso-ask class="miso-ask-combo__query-suggestions-container miso-circled-citation-index" visible-when="initial+nonempty" logo="false" parent-question-id="${e}">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__query-suggestions-phrase">${wa("followup.explore_related")}</h3>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" visible-when="initial loading" logo="false" parent-question-id="${e}">\n    <miso-query></miso-query>\n  </miso-ask>\n</section>\n<miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${e}">\n  <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">${wa("text.generated_by")}</div>\n  <miso-question></miso-question>\n  <miso-answer></miso-answer>\n</miso-ask>\n<section class="miso-ask-combo__section miso-ask-affiliation">\n  <miso-ask class="miso-ask-combo__affiliation-container" logo="false" parent-question-id="${e}"></miso-ask>\n</section>\n<section class="miso-ask-combo__section miso-ask-source">\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${e}">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">${wa("sources.title")}</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n</section>\n`,Na=`\n<div class="crn-search-container">\n  <div class="crn-search-container__header">\n    <miso-hybrid-search visible-when="ready" logo="false">\n      <h1>${wa("header.showing_results")} <miso-question></miso-question></h1>\n    </miso-hybrid-search>\n  </div>\n  <div class="crn-search-container__body">\n    <miso-hybrid-search class="crn-search-container__search-bar" logo="false">\n      <miso-query></miso-query>\n    </miso-hybrid-search>\n    <miso-hybrid-search visible-when="loading ready" logo="false">\n      <div class="crn-search-container__search-results-header">\n        <div class="crn-search-container__search-results-header-total">\n          <miso-total></miso-total> ${wa("search.results")}\n        </div>\n        <div class="crn-search-container__search-results-header-sort">\n          ${wa("search.sort_by")} <miso-sort></miso-sort>\n        </div>\n      </div>\n      <div class="crn-search-container__search-results-body">\n        <miso-products></miso-products>\n      </div>\n    </miso-hybrid-search>\n  </div>\n</div>\n`,$a=(e,t)=>{const{className:s,templates:{titleBlock:o,descriptionBlock:i,dateBlock:n}}=e,{url:r}=t;return`<div class="${s}__item-info-container">${[`<a href="${Ua(t)}" target="_blank" rel="noopener">`,Ia(e,t),"</a>",`<a href="${r}" target="_blank" rel="noopener" class="${s}__info-link">`,o(e,t),i(e,t),Oa(e,t),n(e,t),Aa(e,t),"</a>"].join("")}</div>`},Pa=(e,t,s)=>{const{templates:{helpers:{tagPair:o},imageBlock:i}}=e,{url:n}=s,[r,a]=La(o(e,s));return[r,`<a href="${n}" target="_blank" rel="noopener">`,i(e,s),"</a>",$a(e,s),a].join("")},qa=`\n<div class="crn-empty-search">\n  <div class="crn-empty-search__header">\n    <h1>${wa("header.search")}</h1>\n    <p>${wa("header.search.description")}</p>\n  </div>\n  <div class="crn-empty-search__main">\n    <form action="/search" method="get" class="crn-empty-search__form">\n      <input type="search" name="q" placeholder="${wa("search.placeholder")}" aria-label="${wa("header.search")}" class="crn-empty-search__input" autocomplete="off" autofocus="">\n      <button type="submit" class="crn-empty-search__button">\n        <svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M10.9845 2.498C12.0529 2.498 12.919 1.63188 12.919 0.563477H13.8118C13.8118 1.63188 14.6779 2.498 15.7464 2.498V3.39086C14.6779 3.39086 13.8118 4.25698 13.8118 5.32538H12.919C12.919 4.25698 12.0529 3.39086 10.9845 3.39086V2.498ZM0.666992 7.70633C3.29692 7.70633 5.4289 5.57436 5.4289 2.94443H7.0162C7.0162 5.57436 9.14818 7.70633 11.7781 7.70633V9.29364C9.14818 9.29364 7.0162 11.4256 7.0162 14.0555H5.4289C5.4289 11.4256 3.29692 9.29364 0.666992 9.29364V7.70633ZM3.74319 8.49998C4.78379 9.07745 5.64511 9.93871 6.22255 10.9793C6.79998 9.93871 7.6613 9.07745 8.70191 8.49998C7.6613 7.92252 6.79998 7.06125 6.22255 6.02063C5.64511 7.06125 4.78379 7.92252 3.74319 8.49998ZM13.5638 10.0873C13.5638 11.5118 12.409 12.6667 10.9845 12.6667V13.8571C12.409 13.8571 13.5638 15.012 13.5638 16.4365H14.7543C14.7543 15.012 15.9091 13.8571 17.3337 13.8571V12.6667C15.9091 12.6667 14.7543 11.5118 14.7543 10.0873H13.5638Z" fill="currentColor"></path>\n        </svg>\n        ${wa("search.button")}\n      </button>\n    </form>\n    <div class="crn-empty-search__suggestions">\n      <h3>${wa("search.popular")}</h3>\n      <div class="crn-empty-search__items">\n        <a href="/search?q=artificial+intelligence" class="crn-empty-search__item">${wa("search.popular.ai")}</a>\n        <a href="/search?q=cloud+computing" class="crn-empty-search__item">${wa("search.popular.cloud")}</a>\n        <a href="/search?q=cybersecurity" class="crn-empty-search__item">${wa("search.popular.security")}</a>\n        <a href="/search?q=data+analytics" class="crn-empty-search__item">${wa("search.popular.analytics")}</a>\n        <a href="/search?q=digital+transformation" class="crn-empty-search__item">${wa("search.popular.transformation")}</a>\n        <a href="/search?q=enterprise+software" class="crn-empty-search__item">${wa("search.popular.software")}</a>\n      </div>\n    </div>\n  </div>\n</div>`,La=e=>{const[t]=e;return[t.replace(/<a\b([^>]*)>/gi,"<div$1>").replace(/\s*(href|target|rel)="[^"]*"/gi,""),"</div>"]},Ua=({url:e,type:t,tags:s=[]})=>{if(!e)return e;const o=new URL(e);if(e.includes("/sponsored/")||Array.isArray(s)&&s.length>0&&"Sponsored"===s[0])return"/sponsored";if("whitepaper"===t)return o.origin;if("https://www.crn.com"===o.origin){const t=o.pathname.split("/");return t.length>=3&&t[1]&&t[2]?`${o.origin}/${t[1]}/${t[2]}`:e}return`${o.origin}/tag/${s[0]}`},ja=(e,t,s)=>{const{templates:{helpers:{tagPair:o}}}=e,{text:i}=s,[n,r]=o(e,s);if(i.endsWith("*")){return`${n.replace(/class="([^"]*)"/,((e,t)=>`class="${t} crn-sponsored-question"`))}${i.slice(0,-1)}${r}`}return`${n}${i}${r}`},Da=()=>{const e=document.querySelectorAll(ga.contentWrapperSelector||".content-section .default-content-wrapper");if(0===e.length)return;const t=document.createElement("div");t.id="miso-explore",t.className="miso-explore";const s=e[e.length-1],o=s.querySelectorAll("p"),i=s.querySelector(".ad-wrapper"),n=i?Array.from(o).findIndex((e=>e.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING)):-1;return 8>o.length?(s.appendChild(t),t):(3>8-n?o[n+3].insertAdjacentElement("beforebegin",t):o[8].insertAdjacentElement("beforebegin",t),t)};let za;const Ma=(e,t)=>{const s=document.querySelectorAll(".miso-ask-combo__affiliation-container"),o=s[s.length-1];o.innerHTML=(({product_id:e,cover_image:t,title:s,description:o,url:i})=>`\n<miso-whitepaper>\n  <h3 class="miso-ask-combo__phrase miso-ask-combo__whitepaper-phrase">${wa("sponsored.from")}</h4>\n  <div class="miso-whitepaper miso-list" data-item-type="article">\n    <ul class="miso-list__list" data-item-type="article">\n      <li class="miso-list__item">\n        <a class="miso-list__item-body" data-whitepaper-product-id="${e}" href="${i}" target="_blank" rel="noopener">\n          <div class="miso-whitepaper__description">${wa("sponsored.content")}</div>\n          <div class="miso-whitepaper__content">\n            <div class="miso-list__item-cover-image-container">\n              <img class="miso-list__item-cover-image" src="${t}">\n            </div>\n            <div class="miso-list__item-info-container">\n              <div class="miso-list__item-title">${s}</div>\n              <div class="miso-list__item-desc">${o}</div>\n            </div>\n          </div>\n        </a>\n      </li>\n    </ul>\n  </div>\n</miso-whitepaper>\n`)(t);const i=o.querySelector(".miso-list__item-body");i&&Ba(i,e,t)},Fa=(e,t,s)=>{const{questionId:o,rootQuestionId:i,parentQuestionId:n,session:r}=t,{question_source:a}=r.meta||{};za.api.interactions.upload({type:e,product_ids:[s.product_id],context:{custom_context:{api_group:"ask",api_name:"questions",property:"affiliation",question_id:o,root_question_id:i,...n&&{parent_question_id:n},question_source:a||"_organic"}}})},Ba=(e,t,s)=>{Fa("impression",t,s),(async(e,t,s)=>{await Ce.helpers.viewable(e),Fa("viewable_impression",t,s)})(e,t,s),((e,t,s)=>{e.addEventListener("click",(()=>{Fa("click",t,s)}))})(e,t,s)};!function(){const e={_client:!1,_init(){if(this._client)return;const e=new Ce("2YGOfJTHVwn6PNQY8VmP7Z9K55zzmEEKGjI6DD0g");this._client=e},explore(){(async e=>{const t=document.querySelector('meta[name="miso-explore"]');if(t&&"false"===t.content)return;await e.ui.ready;const s=e.ui.explore,o=`${window.location.origin}${window.location.pathname}`;s.useApi({product_id:o}),s.useLayouts({query:{placeholder:wa("placeholder.query"),buttonText:wa("button.ask")},related_questions:["list",{templates:{question:ja}}]}),s.on("done",(({empty:e,data:t=[]})=>{e&&(i.style.display="none");const s=t.some((({text:e=""})=>e.endsWith("*"))),o=i.querySelector("miso-explore miso-query");if(s&&o){const e=document.createElement("div");e.className="crn-explore-footnote",e.innerHTML=wa("sponsored.from_sponsors"),o.appendChild(e)}})),s.useLink((e=>{const t=e.endsWith("*"),s=encodeURIComponent(t?e.slice(0,-1):e);return`${fa}?q=${s}`}));const i=document.querySelector("#miso-explore")||Da();i&&(i.innerHTML=Sa,s.start())})(this._client)},answer(){(async e=>{za=e,await e.ui.ready;const t=e.ui.ask,s=e.ui.asks,o=Ce.ui.defaults.ask.wireFollowUps,i=document.querySelector("#miso-ask-combo");i.innerHTML=xa,s.useApi({fq:va(),source_fl:["cover_image","url","published_at","authors","tags","type","custom_attributes"]}),s.useLayouts({query:{placeholder:wa("placeholder.query"),buttonText:wa("button.ask")},sources:["list",{templates:{article:Ta}}]}),s.on("request",(()=>{})),s.on("data",(({workflow:e,value:t={}})=>{const{affiliation_products:s}=t;s&&Array.isArray(s)&&0!==s.length&&Ma(e,s[0])})),o(e,i.querySelector(".miso-ask-combo__follow-ups"),{template:Ra}),t.autoQuery()})(this._client)},renderEmptySearch(){document.querySelector("#miso-hybrid-search-combo").innerHTML=qa},search(){(async e=>{const t=e.ui.hybridSearch;await e.ui.ready,document.querySelector("#miso-hybrid-search-combo").innerHTML=Na,t.useApi({answer:!1,fq:va(),fl:["cover_image","url","created_at","updated_at","published_at","authors","tags","type","custom_attributes"]}),t.useFilters({sort:{options:[{field:"relevance",text:wa("search.sort_by.relevance"),default:!0},{field:"published_at",text:wa("search.sort_by.date")}]}}),t.useLayouts({products:[{templates:{product:Pa}}]}),t.autoQuery()})(this._client)}};e._init();const t=window.location.pathname;if(t===fa)e.answer();else if("/search"===t){new URLSearchParams(window.location.search||"").get("q")?e.search():e.renderEmptySearch()}else ba.test(t)&&e.explore()}()}();
