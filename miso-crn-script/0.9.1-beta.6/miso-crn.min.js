!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===s&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('@charset "UTF-8";.miso-explore{--theme-color:#000;--background-color:#f3f3f3;--link-color:#0067d1;background-color:var(--background-color);border-top:5px solid var(--theme-color);padding:2.25rem 2.5rem}.miso-explore h1{font-size:1.75rem;font-weight:700;margin:0 0 .25rem;text-align:center}.miso-explore p{margin:0}.miso-explore miso-explore{display:flex;flex-direction:column;gap:1.5rem;margin-top:1rem}.miso-explore miso-explore a{color:var(--link-color)}.miso-explore miso-explore a:hover{text-decoration:underline}.miso-explore miso-explore li::marker{color:var(--link-color)}.miso-explore miso-explore .miso-list__list{line-height:1.5;margin-left:-.75rem!important}.miso-explore miso-query{--miso-search-box-border-radius:0;--miso-box-shadow-hover:none}.miso-explore miso-query .miso-search-box__input-group,.miso-explore miso-query .miso-search-box__input-group:hover{border:none}.miso-explore miso-query .miso-search-box__input{background-color:#fff}.miso-explore miso-query .miso-search-box__input::-moz-placeholder{color:#000;opacity:.5}.miso-explore miso-query .miso-search-box__input::placeholder{color:#000;opacity:.5}.miso-explore miso-query .miso-search-box__button{background-color:var(--theme-color);color:#fff;flex-shrink:0;padding:.5rem 2rem;text-transform:none}.miso-ask-combo-container{border-top:5px solid #000}.miso-ask-combo-container #crn-answers{text-align:center}.miso-ask-combo{--miso-crn-color-primary:#000;--miso-crn-color-primary-text:#fff;--miso-crn-color-secondary:#e81d22;--miso-crn-color-background:#f3f3f3;--miso-crn-color-link:#0067d1;--miso-crn-color-mark:#d8ebff;--miso-ask-combo-section-padding:0;--miso-ask-combo-content-padding:0;--miso-ask-combo-content-spacing:0}.miso-ask-combo .miso-crn-info-style-block-container{padding:0 2rem}.miso-ask-combo .miso-crn-info-style-block{display:flex;flex-direction:column;gap:1rem;padding:1rem 2rem 2rem}.miso-ask-combo .miso-crn-info-style-block h1{margin:0;text-align:center}.miso-ask-combo .miso-crn-info-style-block__description{display:flex;flex-direction:column;gap:.5rem;line-height:1.25;margin-bottom:.5rem}.miso-ask-combo miso-query{--miso-search-box-border-radius:0;--miso-box-shadow-hover:none}.miso-ask-combo miso-query .miso-search-box__input-group,.miso-ask-combo miso-query .miso-search-box__input-group:hover{border:none}.miso-ask-combo miso-query .miso-search-box__input::-moz-placeholder{color:#000;opacity:.5}.miso-ask-combo miso-query .miso-search-box__input::placeholder{color:#000;opacity:.5}.miso-ask-combo miso-query .miso-search-box__button{flex-shrink:0;padding:.5rem 2rem;text-transform:none}.miso-ask-combo .miso-ask-combo__question .miso-search-box__input{background-color:var(--miso-crn-color-background)}.miso-ask-combo .miso-ask-combo__question .miso-search-box__button{background-color:var(--miso-crn-color-primary);color:var(--miso-crn-color-primary-text)}.miso-ask-combo .miso-ask-combo__follow-ups .miso-search-box__input{background-color:var(--miso-crn-color-background)}.miso-ask-combo .miso-ask-combo__follow-ups .miso-search-box__button{background-color:var(--miso-crn-color-primary);color:var(--miso-crn-color-primary-text)}.miso-ask-combo .miso-ask-combo__follow-ups .miso-ask-combo__answer-container,.miso-ask-combo .miso-crn-answer-block{background-color:var(--miso-crn-color-background);border:1px solid var(--miso-crn-color-primary);padding:1.8rem 3.6rem}.miso-ask-combo .miso-ask-combo__question-phrase{--miso-ask-combo-question-phrase-color:var(--miso-crn-color-link);font-weight:600!important;margin-bottom:.6rem!important}.miso-ask-combo miso-answer li,.miso-ask-combo miso-answer p{line-height:1.5}.miso-ask-combo miso-answer li:not(:first-child){margin-top:.5rem}.miso-ask-combo .miso-citation-link{color:var(--miso-crn-color-link)}.miso-ask-combo .miso-ask-source{margin-top:2.5rem}.miso-ask-combo miso-sources{--miso-list-item-gap:0;--miso-list-image-height:6rem}.miso-ask-combo miso-sources .miso-list__item{border:none!important;border-radius:0!important}.miso-ask-combo miso-sources .miso-list__item:not(:first-child){border-top:2px dotted var(--miso-border-color-medium)!important}.miso-ask-combo miso-sources .miso-list__item-body{padding:1rem 0!important}.miso-ask-combo miso-sources .miso-list__item-cover-image-container{aspect-ratio:16/9;border-radius:0}.miso-ask-combo miso-sources .miso-list__item-cover-image{-o-object-fit:cover!important;object-fit:cover!important}.miso-ask-combo miso-sources .miso-citation-index{color:var(--miso-crn-color-link);font-size:1.3rem!important;margin-top:-.3rem}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="1"]:before{content:"➊"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="2"]:before{content:"➋"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="3"]:before{content:"➌"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="4"]:before{content:"➍"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="5"]:before{content:"➎"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="6"]:before{content:"➏"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="7"]:before{content:"➐"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="8"]:before{content:"➑"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="9"]:before{content:"➒"}.miso-ask-combo miso-sources .miso-list__item-body:hover .miso-citation-index[data-index="10"]:before{content:"➓"}.miso-ask-combo miso-sources .miso-list__item-section{color:var(--miso-crn-color-secondary);font-size:.9rem;letter-spacing:.02rem}.miso-ask-combo miso-sources .miso-list__item-authors,.miso-ask-combo miso-sources .miso-list__item-section,.miso-ask-combo miso-sources .miso-list__item-snippet,.miso-ask-combo miso-sources .miso-list__item-title{line-height:1.3;margin-bottom:.2rem}.miso-ask-combo miso-sources .miso-list__item-snippet mark{background-color:var(--miso-crn-color-mark);padding:2px 0}.miso-ask-combo miso-sources .miso-list__item-authors{font-size:.9rem}.miso-ask-combo miso-sources .miso-list__item-authors span{color:var(--miso-crn-color-secondary)}.miso-ask-combo miso-sources .miso-list__item-date{color:var(--miso-text-color);font-size:.68rem;letter-spacing:.02rem;margin-bottom:0;text-transform:uppercase}.miso-ask-combo .miso-ask-affiliation{margin-bottom:2.5rem;margin-top:1rem}.miso-ask-combo .miso-ask-combo__whitepaper-phrase{margin-bottom:1rem!important}.miso-ask-combo miso-whitepaper .miso-list__item{background-color:var(--miso-crn-color-background)!important;padding:.8rem 1rem}.miso-ask-combo miso-whitepaper .miso-list__item-body{flex-direction:column}.miso-ask-combo miso-whitepaper .miso-whitepaper__description{color:#181818;font-size:.625rem;font-weight:700;text-align:center}.miso-ask-combo miso-whitepaper .miso-whitepaper__content{align-items:center;display:flex;gap:var(--miso-list-item-content-spacing);justify-content:space-between}.miso-ask-combo .miso-ask-combo__follow-ups{margin-top:2rem}.miso-ask-combo miso-query-suggestions .miso-option-list__options{list-style-type:disc}.miso-ask-combo miso-query-suggestions .miso-option-list__option{background-color:transparent;border:none;box-shadow:none;color:var(--miso-crn-color-link);font-size:var(--body-font-size-m);padding:0}');var t="1.12.0";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var o=Object.freeze({__proto__:null,GROUP:s,NAME:i});function n(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function r(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){return null!=t?""+t:t}function c(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function l(t){return null==t}function u(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function _(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function h(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function d(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function m(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class p{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:o}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);g(s),g(i),g(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!o,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>f(this,t)),e):f(this,t),this._value=t}disconnect(){this._active=!1}}function f(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function g(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function b(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function y(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function w(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async i=>{try{await t(i),e()}catch(t){s(t)}}))}))}async function v(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((o,n)=>{const r=new p((t=>{t&&(r.disconnect(),a.disconnect(),o())}),{onDuration:s}),a=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),n(new DOMException("Aborted","AbortError"))}))}))}function k(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function E(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function S(t,e){const s=x((()=>window.localStorage.getItem(t))),i=x((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const o=i+s.length,n=e.indexOf(";",o);return decodeURIComponent(0>n?e.substring(o):e.substring(o,n))}(t))),o=s||i||""+e();return o&&!s&&x((()=>window.localStorage.setItem(t,o))),o&&!i&&x((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,o))),o}function x(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function O(t){return new I(t)}class I{constructor(t){this._value=t;const e=t=>{this._value=t};_(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class T{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class C{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new T),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function A(t,e){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,{onError:e=t=>console.error(t),transform:s=t=>t}={}){try{s(t)()}catch(t){e(t)}}(t,e);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let R;try{R=document.currentScript}catch(t){}async function N(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if(P(t))return;return new Promise((e=>{let s;s=setInterval((()=>{P(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function $(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.0/dist/css/${t}.css`}function P(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function L(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function U(t,{depth:e=5,...s}={}){return q(t,e)}function q(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>q(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const o=t[i];"function"!=typeof o&&(i.startsWith("_")&&"object"==typeof o&&"Object"!==o.constructor.name||(s[i]=q(o,e-1)))}return s}(t,e):t:"(...)"}function j(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,o]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,o)}function D(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const o=Object.getOwnPropertyDescriptors(i);for(const i in o){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:n}=o[i];n&&(e[i]="function"==typeof n?n.bind(t):n)}}return Object.freeze(e)}function z(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let o=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(o*=1+(s-i)*e/1e3),o}}(t);return(t,s,i,o)=>{const n=e(i,s);return t+Math.max(o-i,0)*n/1e3}}const F=Symbol.for("miso:resources");class M{constructor(){this._resources=new Map;const t=window[F]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){B(this._resources,t).resolve(e)}async get(t){return B(this._resources,t).promise}}function B(t,e){if(t.has(e))return t.get(e);const s=new T;return t.set(e,s),s}function Q(){return window[F]||(window[F]=new M)}class G{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new T;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class H{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const o=e._on(t,(t=>{setTimeout((()=>o()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)n(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&n(s,e)}}_injectSubscribeInterface(t){u(t,this,["on","once"])}}function W(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class V{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:W(t,e),uuid:E()})}(t,e);_(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new H({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(V,"miso:component");class K extends V{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new T);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Y{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new p(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class Z{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const J=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class X{constructor(t,e){this._client=t,this._root=e,this._bulk=new G(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:o,sendApiKeyByHeader:n}={}){const{apiKey:r,request:a={}}=this._client.options;o=o||a.timeout,(n=n||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":r});const l="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=o?AbortSignal.timeout(o):void 0,_=await(this._root._customFetch||window.fetch)(t,c({method:s,headers:i,body:l,cache:"no-cache",mode:"cors",signal:u})),h=await _.json();if(_.status>=400||h.errors){var d=Error(h.message);throw d.data=h,d.status=_.status,d}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:o,status_code:n,body:r}=i[e];n>=400||o?s.reject({status_code:n,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,o=e.sendApiKeyByHeader||i.sendApiKeyByHeader,n=t.filter((t=>t)).join("/"),r=`${this.getApiEndpoint(n)}/${n}`;return o?r:`${r}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=J.DATA_ENDPOINT,eventEndpoint:s=J.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const o=this._client;for(const n of this._root._urlPasses)try{i=n({client:o,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const o=this._client;for(const n of this._root._payloadPasses)try{i=n({client:o,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}}class tt extends V{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,o=i?{bulk:this.helpers.bulkInfo}:void 0,n=this._apiPath,r=this._url({apiGroup:n,apiName:t,payload:e,options:s}),a={apiGroup:n,apiName:t,payload:e=this._preprocess({apiGroup:n,apiName:t,payload:e,options:s}),url:r,options:s};this._events.emit("request",{...a,...o});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...o}),this._postprocess(l)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:o,...n}={}}){return o?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,n)}_postprocess({response:t}){return t.data}}const{GROUP:et,NAME:st}=o;class it extends tt{constructor(t){super(t,et.INTERACTIONS)}async upload(t,e){try{return await this._run(st.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===st.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class ot{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...o}=this._options;const n=new Z(i);let r;s=e(this._ac.signal,n.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:o,signal:n}={}){if(n&&n.aborted)return[];let r,a,c=0,u=!1;function _(){r&&clearInterval(r),u=!0}const h=new C;return r=setInterval((async()=>{let e,r,d;try{if([e,r,d]=await t(n?{signal:n}:{}),u||!l(a)&&a>=d)return;l(d)||(a=d),o&&o(e,r,d),c=0}catch(t){return i&&i(t),c++,void(c>s&&(_(),h.error(t)))}h.update(e,r),r&&_()}),e),n&&n.addEventListener&&n.addEventListener("abort",(()=>{_(),h.abort(n.reason)})),h}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:s,onResponse:(t,e)=>{e?n.clear():this._isUpdated(r,t)&&n.touch(),r=t},...o})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class nt extends ot{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:rt,NAME:at}=o;class ct extends tt{constructor(t){super(t,rt.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new lt(this,t,e);const s=await this._run(at.QUESTIONS,t,e);return new lt(this,s,e)}async _questions(t,e){return this._run(at.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${at.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(at.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(at.TRENDING_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(at.SEARCH,t,e);return s.question_id?new ut(this,s,e):s}async _searchGet(t,e){return this._run(`${at.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(at.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(at.SEARCH_AUTOCOMPLETE,t,e)}}class lt extends nt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class ut extends nt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),_(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:_t,NAME:ht}=o;class dt extends tt{constructor(t){super(t,_t.SEARCH)}async search(t,e){return this._run(ht.SEARCH,t,e)}async autocomplete(t,e){return this._run(ht.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(ht.MGET,t,e)}}const{GROUP:mt,NAME:pt}=o;class ft extends tt{constructor(t){super(t,mt.RECOMMENDATION)}async userToProducts(t,e){return this._run(pt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(pt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(pt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(pt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(pt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(pt.PRODUCT_TO_PRODUCTS,t,e)}}class gt extends V{constructor(t,e){super("api",t),this._client=t,this.helpers=new X(t,e),this.interactions=new it(this),this.ask=new ct(this),this.search=new dt(this),this.recommendation=new ft(this)}}var bt=Object.freeze({__proto__:null,Api:gt,ApiBase:tt,ApiHelpers:X,Interactions:it,Ask:ct,Search:dt,Recommendation:ft});class yt extends V{constructor(t){super("context",t),this._client=t}}var wt={api:bt,context:{Context:yt}};class vt{constructor(t){_(this,{install:t})}}class kt extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Et(this,wt),this.plugins=new St(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new T);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return _(i,{id:t}),this._tryConfig(i,e),i;case"function":return new vt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),o=0>e?t.length:e,n=t.lastIndexOf("/",o)+1,r=t.indexOf(".",n),a=0>r?"":t.slice(r,o);return`${t.slice(0,n)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new Q).get(s);!this.isRegistered(t)&&this.register(i)}}class Et{constructor(t,e){u(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),_(this,{classes:e})}}class St{constructor(t){u(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const xt=new class extends V{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new kt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=t,this._cmdRes=new T}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Ot=Object.freeze({__proto__:null,viewable:v,debounce:L});const{currentScript:It}=document;class Tt extends V{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Tt),window.MisoClient?window.MisoClient!==Tt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Tt}static debug(){}constructor(t){super("client",xt),this._config(t),this.context=new yt(this),this.api=new gt(this,xt),function(t){xt._clients.push(t),xt._events.emit("create",t)}(this)}get version(){return Tt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,c(t)}_readConfigFromScriptUrl(){return c({apiKey:new URL(new Request(It.src||It.href).url).searchParams.get("api_key")||void 0})}}Tt.helpers=Ot,_(Tt,{uuid:E()});var Ct=function(t){const e=xt._pluginRoot;return xt.MisoClient=e.MisoClient=t,u(t,xt,["version","instances","any","meta","on","once","cmdDone"]),u(t,e,["plugins"]),t}(Tt);const{GROUP:At,NAME:Rt}=o;let Nt;class $t{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||Nt||(Nt=S("miso_anonymous_id",E))}set anonymous_id(t){t=a(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=a(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Pt(){const t=new URLSearchParams(window.location.search);let e=c({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Lt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function Ut(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=E()),{...e,context:{...s,custom_context:i}}}const qt="std:native-fetch";let jt,Dt;const zt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return jt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),jt="borrowed",t.contentWindow.fetch}catch(t){Dt=t}})();const Ft="miso-logdump",Mt="miso-logdump",Bt=Mt+"__download-btn",Qt="Miso Log";class Gt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Kt||(Kt=N($("logdump")))}();let t=document.getElementById(Ft);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Qt,e.classList.add(Bt),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Ft,t.classList.add(Mt),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Ft),e=t&&t.querySelector("."+Bt);e&&(e.textContent=this._options.logDownloadButtonText||Qt)}hideDownloadButton(){const t=document.getElementById(Ft);t&&(t.style.display="none")}download(){const t=new Blob([Wt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Ht()})}return t&&"string"==typeof t?t:`miso-log.${Ht()}.jsonl`}clear(){this._logs=[]}}function Ht(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Wt(t){return t.map((t=>JSON.stringify(U(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Vt(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function Vt(t){return t?U(t,{depth:2}):t}let Kt;const Yt="std:debug";function Zt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function Jt(t,e){return Object.freeze({...t,...e,members:Xt(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function Xt(t=[],e=[]){return[...new Set([...t,...e])]}function te(t,e){let s={};for(const i of t)i&&(s=e(s,i));return c(s)}function ee(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function se(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...ie("_meta",s,i)})});var s,i}))}function ie(t,e,s){const i=e&&e[t],o=s&&s[t],n=i?o?{...i,...o}:i:o;return void 0!==n?{[t]:n}:{}}Ct.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Gt(t)}static get id(){return Yt}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Yt,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const o=i.concat(t.meta.path);if(o.length||"create"!==e){switch(o[0]){case"client":if("api"===o[1])return void this._handleApiEvent(e,{...s,groupName:o[2]});break;case"plugins":return void(1===o.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(o[1],o.slice(2),e,s))}this._logw(o.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:o,...n}){const r=new URL(i).pathname,a=["api",t];if(o&&a.push(`(bulk ${o.bulkId})`),a.push("POST "+r),"interactions"===e){const t=n.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,o="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${o} (${i})`:""+o)}a.push([{...n,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Zt)):this._log(t,e,Zt(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return qt}install(t,e){zt?(e.setCustomFetch(zt),t.debug(`<plugin:${qt}>`,"[info]",`Using ${jt} native fetch`)):t.debug(`<plugin:${qt}>`,"[error]","Failed to obtain native fetch: "+Dt.message)}}),Ct.plugins.use(class extends V{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new $t(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===At.INTERACTIONS&&s===Rt.UPLOAD?this._modifyPayloadForInteractions(t,i):e===At.ASK&&s===Rt.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:o}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:o},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:o,anonymous_id:n}=t.context,r=s?{user_id:s,user_hash:i}:{anonymous_id:n};return s&&o&&(r.user_type=o),{...r,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,o=c({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...o,...t})))}}}),Ct.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...c({page:c({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Pt()}),...t.context}})))}}}),Ct.plugins.use(class extends V{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Lt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:o,payload:n}){if(e===s.SEARCH)if(o===i.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Ct.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Ut)}}}),Ct.plugins.use(class extends V{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:return!0}return!1}});const oe="default",ne="_organic",re=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ae=new Set([re.PRODUCTS,re.CATEGORIES,re.ATTRIBUTES,re.RESULTS,re.ITEMS,re.QUESTION,re.ANSWER,re.IMAGES,re.SOURCES,re.RELATED_RESOURCES,re.QUERY_SUGGESTIONS,re.RELATED_QUESTIONS,re.AFFILIATION,re.FACETS,re.TOTAL]);function ce(t){return ae.has(t)}const le=new Set([re.PRODUCTS,re.IMAGES,re.SOURCES,re.RELATED_RESOURCES]);const ue=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),_e=[ue.IMPRESSION,ue.VIEWABLE,ue.CLICK,ue.SUBMIT,ue.FEEDBACK],he=[ue.IMPRESSION,ue.VIEWABLE,ue.CLICK],de=new Set(he);const me=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),pe=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function fe(t){if(0>_e.indexOf(t))throw Error("Unrecognized event type: "+t)}const ge=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function be(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function ye(t){if(void 0===t)return;let[e,s]=r(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function we(t,e){return!1===(e=ye(e))[0]?e:t&&e?[e[0]||t[0],ve(t[1],e[1])]:e||t}function ve(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const ke=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Ee(t={}){t=ee(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Se(e);return t}function Se(t={}){return t=ee(t)}function xe(t={},e={}){const s={...t};for(const[i,o]of Object.entries(e))void 0!==o&&(s[i]=_e.includes(i)?Oe(t[i],o):o);return s}function Oe(t={},e={}){return{...t,...e}}const Ie=[{key:ge.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return c({group:s,name:t,payload:e})},merge:se},{key:ge.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${re.PRODUCTS}: ... }) instead`),t={...s,[re.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[be(e)]=ye(s);return i},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=we(t[s],i);return t}))}},{key:ge.DATA_PROCESSOR,normalize:function(t){t=r(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:ge.TRACKERS,normalize:function(t={}){t=ee(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=Ee(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:xe(t[s],i));return t}))}},{key:ge.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=r(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:ge.FILTERS,normalize:ee,merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>Object.assign(t,e)))}},{key:ge.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>Object.assign(t,e)))}}];class Te{constructor(){this._events=new H({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Ce{constructor(t={},e={}){this._events=new H({target:this}),this._defaults=e,this._context=t||{},this._locals={},_(this,{resolved:new Ae(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ae{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class Re{constructor(t,e,s,i,o){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=o}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Ie){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Te.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Re(this,this._globals,e,s,i))}}),Object.defineProperty(Ce.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Re(this,this._locals,e,s,i))}}),Object.defineProperty(Ae.prototype,e,{get:function(){return this._get(t)}})}const Ne=[ge.API,ge.LAYOUTS,ge.DATA_PROCESSOR,ge.TRACKERS,ge.INTERACTIONS];function $e(t,e=Ne){for(const s of e)Pe(t,s)}function Pe(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function Le(t={}){const{setValue:e,focus:s,param:i,sourceParam:o}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:i="q",sourceParam:o="qs",...n}={}){return{setValue:t,focus:e,updateUrl:s,param:i,sourceParam:o,...n}}(t),n=new URLSearchParams(window.location.search),r=n.get(i),a=n.get(o)||void 0,{layout:l}=this._views.get(re.QUERY);l&&(r&&e&&(l.value=r),!r&&s&&l.focus()),r&&this.query(c({q:r,qs:a}))}class Ue extends V{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Te}}function qe(t){return t?"view:"+t:"view"}$e(Ue.prototype);class je{constructor(t={}){(this._events=new H)._injectSubscribeInterface(this),this._options=t,this._states={},_(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const i=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class De{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:E(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function ze(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Fe{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t})}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},o={...t.options,signal:s},n=await this._source({session:e,...t,options:o});if(n&&n[Symbol.asyncIterator]){let t;for await(t of(n._response&&this._emitResponseWithSessionCheck({session:e,request:i,value:n._response}),n)){if(!ze(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:n})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){ze(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Me{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{n(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Be,VIEWABLE:Qe,CLICK:Ge}=ue,{UNTRACKED:He,TRIGGERED:We}=me,Ve=Object.freeze({[Be]:He,[Qe]:He,[Ge]:He});class Ke{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ve}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||He}set(t,e,s){fe(e),function(t){if(t!==me.UNTRACKED&&t!==me.TRACKING&&t!==me.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of r(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==We))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),(()=>({...Ve}))))[e]=s}}const Ye=[Symbol("itemless")];class Ze{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new Ke(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){fe(t);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:o=!0,itemless:n=!1}=i;if(o){if(n&&(e=Ye),0===(e=this._states.untriggered(r(e),t)).length)return;this._states.set(e,t,me.TRIGGERED)}this._sendToHub({type:t,items:n?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:ue.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(c({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Ke(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[qe(this._role)]}}for(const t of he)Ze.prototype[t]=function(e,s){this._trigger(t,e,s)};class Je{constructor(t,e){this._events=new H({target:this}),this._views=t,this._mapping=function(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}((t._roles.mappings||{})[e]||e),_(this,{role:e,interface:new Xe(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Me((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===re.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Ze({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((o=e)===(n=i)||o&&n&&o.status===n.status&&o.error===n.error&&o.value===n.value&&o.ongoing===n.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(o.session,n.session)))return;var o,n;const{session:r,status:a,ongoing:c,request:l,meta:u,value:_}=e,h={session:r,status:a,ongoing:c,request:l,meta:u,data:_,...ts(e)},d=(t={},e)=>{!1!==t&&this.updateState({...h,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:d})}catch(t){this._error(t),d({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?pe.ERRONEOUS:t.status;t=this._state=Object.freeze(c({...t,status:s}));const{role:i}=this;this.hub.update(qe(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:o,...n}=t,r={value:this._mapping(t,this),status:i,data:e,meta:o,...n};return this.role===re.CONTAINER&&(r.meta={...o,empty:this._isContainerEmpty(e)}),c(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!ce(s))continue;let e=t&&t[s];if(s===re.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Xe{constructor(t){u(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function ts(t){return function(t){return t.status===pe.READY&&!t.ongoing}(t)?{empty:!!es(t)}:{}}function es(t){const{value:e}=t;return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}function ss(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class is{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new H({target:this,error:s}),_(this,{facets:new os(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return c({facets:Object.freeze({}),sort:ss(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(c({...t,...e,facets:Object.freeze(c({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class os{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const ns=Symbol.for("miso:tracked");function rs(t){return!!t[ns]}function as(t){t[ns]=!0}const cs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ls(t,e){return!!e&&{...t,...e}}class us{constructor(t,{workflow:e,extensions:s,layouts:i,roles:o,options:n}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=i,this._options=n,this._roles=o,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new is(this);for(const t of o.members)t!==re.CONTAINER&&(this._views[t]=new Je(this,t));_(this,{interface:new _s(this),trackers:new hs(this,o.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on("data",(t=>this.refresh({data:t}))),n.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new Je(this,re.CONTAINER);e.layout=this._createLayout(re.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===re.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:i}=e._inst;t&&(s=s.filter((e=>e.role===re.CONTAINER||t.includes(e.role)))),i&&(s=s.filter((t=>!i.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...o}=t;return c({...cs,...o,impression:ls(cs.impression,e),viewable:ls(cs.viewable,s),click:ls(cs.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=re.CONTAINER;this._containerTracker=new Ze({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class _s{constructor(t){this._actor=t,u(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class hs{constructor(t,e){this._views=t;for(const s of e)s!==re.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,re.CONTAINER,{get:()=>t._getContainerTracker()})}}class ds{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:ue.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ms{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=r(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ps(t){return async({group:e,name:o,payload:n,options:r})=>{if(e===s.ASK)switch(o){case i.QUESTIONS:return t.api.ask.questions(n,r);case i.SEARCH:return t.api.ask.search(n,r)}return t.api[e]._run(o,n,r)}}class fs{constructor({role:t,workflow:e,...s}={}){_(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),o=O(!1);e=this._preprocess({state:e,rendered:i},{skip:o.t})||e,this._updatePending(e,s),o.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,w((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const o=this._rendered.get(this._element),n=O([]),r=O({});this._render(this._element,{state:s,rendered:o,timestamp:t},{notifyUpdate:n.args,writeToState:r.merge,...e}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),i&&i(...n.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function gs(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function bs(t,e,s,i){const{templates:o}=t,[n,r]=Ls(t,s);return""+n+(o.indexBlock||$s)(t,s,i)+(o.infoBlock||o.articleInfoBlock||ks)(t,s,i)+r}function ys(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Ss)(t,e,s)+(o.descriptionBlock||Os)(t,e,s)+(o.priceBlock||As)(t,e,s)+(o.ctaBlock||Ps)(t,e,s)}</div>`}function ws(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Ss)(t,e,s)+(o.descriptionBlock||Os)(t,e,s)+(o.priceBlock||As)(t,e,s)}</div>`}function vs(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Ss)(t,e,s)+(o.dateBlock||Is)(t,e,s)+(o.descriptionBlock||Os)(t,e,s)+(o.ctaBlock||Ps)(t,e,s)}</div>`}function ks(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Ss)(t,e,s)+(o.authorsAndDateBlock||Cs)(t,e,s)}</div>`}function Es(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Ss)(t,e,s)}</div>`}function Ss({className:t},{title:e,_title_with_markups:s}){const i=s||k(e);return i?`<div class="${t}__item-title">${i}</div>`:""}function xs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Os({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${k(s)}</div>`:""}function Is({className:t,templates:e},{created_at:s,updated_at:i,published_at:o}){const n=o||s||i;return n?`<div class="${t}__item-date">${js(n,e.date)}</div>`:""}function Ts({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function Cs(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-authors-and-date-container">${""+(o.authorsBlock||Ts)(t,e,s)+(o.dateBlock||Is)(t,e,s)}</div>`}function As(t,e){const{className:s,templates:i}=t,{sale_price:o,original_price:n,currency:r="USD"}=e,a=o||n;if(!a)return"";const c=void 0!==n&&void 0!==o&&n>o,l=e.discount_rate_percent||(c?Math.floor(100*(1-o/n)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${n}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Rs)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function Rs(t,{discount_rate_percent:e}){return`(${e}% off)`}function Ns(t,e,s={}){const{className:i,templates:o}=t,{cover_image:n,image_src:r,image_alt:a}=e;if(!n&&!r)return"";const c=r?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${n}">`}${"cover-image"===c&&s.brand?(o.brandBlock||xs)(t,e,s):""}</div>`}function $s({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Ps(t,e,s){const{className:i,templates:o}=t,n=Ds.asFunction(o.cta)(t,e,s);return n?`<div class="${i}__item-cta-container">${n}</div>`:""}function Ls({className:t,options:e={}},{product_id:s,url:i},{classSuffix:o="item-body",role:n="item",...r}={}){const a=!1!==r.link&&i?"a":"div";return[`<${a} class="${t}__${o}" ${n?`data-role="${n}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==r.link&&i?`href="${i}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:i=!0}=t;let o="";i&&(e&&(o+=` target="${e}"`),s&&(o+=` rel="${s}"`));return o}(e.link)}`:""}>`,`</${a}>`]}const Us=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),qs="en-US";function js(t,e=Us){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Us.locale,e);default:throw Error("Invalid date format: "+e)}}const Ds=Object.freeze({tagPair:Ls,formatDate:js,formatNumber:function(t,e=qs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||qs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:k,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class zs extends fs{constructor({className:t,templates:e,...s}={}){super(s),_(this,{className:t,templates:{...gs("root"),...e,helpers:Ds}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Fs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Fs.MisoClient.ui.layouts.create("banner").render(this)}}class Ms{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let o=!1;try{await v(t,{...e,signal:i}),o=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return o}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Bs extends fs{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ms}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Fs.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===re.PRODUCTS||t===re.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:o,empty:n=!1,unanswerable:r=!1}={}}=e,a=[s,n?pe.EMPTY:pe.NONEMPTY];s===pe.READY&&a.push(i?pe.ONGOING:pe.DONE),r&&a.push(pe.UNANSWERABLE),t.setAttribute("status",a.join(" ")),o?t.setAttribute("miso-id",o):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===pe.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Qs=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:o,value:n}=e;return"erroneous"!==o?"":`<div class="${s}"><div class="${s}__message">${i.message(t,n)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Gs extends zs{static get type(){return"error"}static get defaultTemplates(){return Qs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Qs,...e},...s})}}const Hs=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Ws(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class Vs{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,o=new Map,n=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],l=Object.freeze({index:r,key:a,value:e[r],element:c});i.set(a,l),o.set(c,l),n.push(l)}return{k2b:i,e2b:o,entries:n}}(t,e,s),o={k2b:this._k2b,e2b:this._e2b,entries:this._entries},n=Ws(o,i),r=Ws(i,o);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:n,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function Ks(t){j(t,Ys.prototype)}class Ys{_initTrackable(){this._bindings=new Vs,this._viewables=new Ms}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map((t=>this._getItemKey(t))),o=this._getItemElements(t),{bounds:n,unbounds:r}=this._bindings.update(i,s,o);this._onBindingsUpdate(n,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!rs(e)&&0===e.button&&!e.defaultPrevented&&!!b(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&(as(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class Zs{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===pe.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await v(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Js=Object.freeze({product:function(t,e,s,i){const{templates:o}=t,[n,r]=Ls(t,s);return""+n+(o.imageBlock||Ns)(t,s,i)+(o.infoBlock||o.productInfoBlock||ws)(t,s,i)+r},article:function(t,e,s,i){const{templates:o}=t,[n,r]=Ls(t,s);return""+n+(o.imageBlock||Ns)(t,s,i)+(o.infoBlock||o.articleInfoBlock||vs)(t,s,i)+(o.indexBlock||$s)(t,s,i)+r},compactArticle:bs,image:function(t,e,s,i){const{templates:o}=t,[n,r]=Ls(t,s);return""+n+(o.imageBlock||Ns)(t,s,i)+(o.infoBlock||o.imageInfoBlock||Es)(t,s,i)+r},question:function(t,e,s){const[i,o]=Ls(t,s);return`${i}${s.value||s.text||s}${o}`},root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e;return`<div class="${s} ${r}"${i?` data-role="${i}"`:""}${n.itemType?` data-item-type="${n.itemType}"`:""}>${r===pe.READY?o[r](t,e):""}${o.trigger(t,e)}${o.loading(t,e)}</div>`},[pe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e)||[];return i.length>0||e.ongoing?s.body(t,e,i):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:i,templates:o,options:n}=t,r=o.ordered?"ol":"ul";return`<${r} class="${i}__list" data-role="list"${n.itemType?` data-item-type="${n.itemType}"`:""}>${o.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:o}=t;let n=i;return s.map((s=>o.item(t,e,s,n++))).join("")},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item">${n[a](t,e,s,{index:i})}</li>`},productInfoBlock:ws,articleInfoBlock:vs,compactArticleInfoBlock:ks,imageInfoBlock:Es,brandBlock:xs,titleBlock:Ss,descriptionBlock:Os,dateBlock:Is,authorsBlock:Ts,authorsAndDateBlock:Cs,priceBlock:As,discountRateText:Rs,ctaBlock:Ps,cta:function(t,e,s){const{templates:i}=t,{url:o}=e;if(!o)return"";const[n,r]=Ls(t,{url:o},{classSuffix:"item-cta",role:"cta"}),a=Ds.asFunction(i.ctaText)(t,e,s);return a?`${n}${a}${r}`:""},imageBlock:Ns,indexBlock:$s,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Xs extends zs{static get defaultTemplates(){return Js}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Js,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:o}=e;if(i)if(o){this._getListElement(t).insertAdjacentHTML("beforeend",o)}else s(!1);else t.innerHTML=o}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:o}=e;this._view._events.emit("click",{session:s,value:i,element:o,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Ks(Xs.prototype),j(Xs.prototype,Zs.prototype);const ti="miso-list";class ei extends Xs{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ti}constructor({className:t=ti,...e}={}){super({className:t,...e})}}const si="miso-horizontal";class ii extends Xs{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return si}constructor({className:t=si,...e}={}){super({className:t,...e})}}const oi="miso-cards";function ni(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function ri(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function ai(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),i=e[2]||"";return[s,i]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function ci(t){return void 0===t||t instanceof li?t:new li(t)}class li{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=ci(t),ci([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class ui{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,w((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),i=e.itemCount,o=e.itemCount=s?s.length:void 0;o!==i&&(void 0===o?e.itemIndex=void 0:void 0===i&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(ni(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let i=0;for(const e of s.children)ri(e,"active",i===t),i++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const _i="miso-ui-icon",hi=_i+"-svg-1_12_0",di={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},mi=`<symbol id="${_i}-${di.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,pi=`<symbol id="${_i}-${di.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,fi=`<symbol id="${_i}-${di.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,gi=`<svg id="${hi}" style="display:none;">${[mi,pi,fi,`<symbol id="${_i}-${di.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${_i}-${di.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${_i}-${di.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let bi=!1;function yi(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${_i}-${t}"></use></svg>`}bi||document.head.querySelector("#"+hi)||(bi=!0,document.head.insertAdjacentHTML("beforeend",gi));const wi=new Set(Object.values(di));yi(di.SEND),yi(di.SEARCH);const vi=yi(di.TRIANGLE);yi(di.TRIANGLE_EQ);const ki=yi(di.CHEVRON),Ei=yi(di.CHEVRON_NEGATIVE),Si="miso-carousel",xi=Object.freeze({body:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${o.list(t,e,s)}</div></div>${o.controls(t,e,s)}`},controls:function(t,e,s){const{templates:i}=t;return`${i.controlContainer(t,e,"previous")}${i.controlContainer(t,e,"next")}${i.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-container-${s}">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?Ei:ki},indexIndicator:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${i}__index-indicator-item">${o.indexIndicatorItem(t,e,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Oi=Object.freeze({...Xs.defaultTemplates,...xi});class Ii extends Xs{static get type(){return"carousel"}static get defaultTemplates(){return Oi}static get defaultClassName(){return Si}constructor({className:t=Si,templates:e,...s}={}){super({className:t,templates:{...xi,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){j(t,ui.prototype)}(Ii.prototype);const Ti="16rem",Ci=Object.freeze({...Xs.defaultTemplates,item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r,c=n[a](t,e,s,{index:i});return`<li class="${o}__item${s._size?` ${o}__item-${s._size}`:""}">${c}</li>`}}),Ai="miso-gallery";class Ri extends Xs{static get type(){return"gallery"}static get defaultTemplates(){return Ci}static get defaultClassName(){return Ai}constructor({className:t=Ai,templates:e,...s}={}){super({className:t,templates:{...Ci,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=s?void 0:this._bodyHtml(t),o=this._itemsHtml(t,e);return{...t,...c({incremental:s,bodyHtml:i,itemsHtml:o})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const i=this._renderListElement(t,e,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:i}=e;return s||(t.innerHTML=i),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,i)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const i=t.children.length,o=this._writeItemSizes((this._getItems(e)||[]).slice(i),s,i);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,o,{offset:i}))}_writeItemSizes(t,[e=0,s=0]=[],i=0){let o=0;i>0&&(o=Math.min(i,e),i-=o,e-=o),i>0&&(o=Math.min(i,s),i-=o,s-=o);const n=[];for(const i of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),n.push({...i,_size:t})}return n}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=ci(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:i}=e,{height:o=Ti}=this.options,n=ai(o),r=t.clientWidth;if(0===r)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(r*i.width*2/(n*i.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),i=t;const o=Math.min(Math.floor(s/3),i);i-=o,s-=3*o;const n=Math.min(s,i);return i-=n,s-=n,[o,n,i]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,i=0]=e;const{className:o}=this;for(const e of t.children){let t=!1,n=!1;s>0?(t=!0,s--):i>0&&(n=!0,i--),ri(e,o+"__item-large",t),ri(e,o+"__item-medium",n),ri(e,o+"__item-small",!t&&!n)}}}const Ni="miso-search-box";const $i=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:o,autocomplete:n}=t,{placeholder:r}=o;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${n.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:o}=e;var n;return("function"==typeof i?i(t):""+i)+("function"==typeof o?o(t):(wi.has(n=o)?yi(n):"")||""+o)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:o}=t;t={templates:s,workflow:i,...o};const n=[],r=[];for(const t of e)(t.product?n:r).push(t);return s.queries(t,r)+(r.length>0&&n.length>0?"<hr>":"")+s.products(t,n)},completionList:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map((s=>o.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:o}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${o[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||k(e)},product:function(t,{product:e}){const{templates:s}=t,[i,o]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+o},imageBlock:Ns,productInfoBlock:ws}),Pi=Object.freeze({className:"miso-autocomplete",debounce:300});class Li extends zs{static get type(){return"search-box"}static get defaultTemplates(){return $i}static get defaultClassName(){return Ni}constructor({className:t=Ni,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...$i,...e},...i}),_(this,{autocomplete:{...Pi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=L(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:o=pe.INITIAL,session:n,value:r}=e.completions,{index:a}=n;if(s&&s.completions.index===a&&s.completions.status===o)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);ri(t,"nonempty",u.length>0),l.setAttribute("data-status",o),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:o}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Ui.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Ui(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&b(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),o=this._context().data.get(parseInt(e)),n=o&&o.text;return n&&(s&&(s.value=n),this._view._events.emit("select",Object.freeze({value:o,index:e,domEvent:t})),t.defaultPrevented||this._submit(n)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ue.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Ui{static empty(){return Ui._empty||(Ui._empty=new Ui)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const o in t)for(const n of t[o])n.product&&!n.product.url||(n._index=e,n._field=o,s.set(e,n),i.push(n),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const qi="miso-option-list";const ji=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${o.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${k(e.text||e)}</li>`}});class Di extends zs{static get type(){return"option-list"}static get defaultTemplates(){return ji}static get defaultClassName(){return qi}constructor({className:t=qi,templates:e,...s}={}){super({className:t,templates:{...ji,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;ri(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}Ks(Di.prototype);const zi=Object.freeze({...gs("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Fi extends zs{static get defaultTemplates(){return zi}constructor({className:t,templates:e,field:s,defaultValue:i,...o}={}){super({className:t,templates:{...zi,...e},...o}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=b(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const o=e.getAttribute("data-value");s||void 0===i||i!==o?this._select(o):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],w((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Mi="miso-feedback",Bi=["helpful","unhelpful"];const Qi=Object.freeze({options:function(t){const{templates:e}=t;return Bi.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:o={}}=t;return`\n${!1!==o.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==o.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Gi extends Fi{static get type(){return"feedback"}static get defaultTemplates(){return Qi}static get defaultClassName(){return Mi}constructor({className:t=Mi,templates:e,...s}={}){if(super({className:t,templates:{...Qi,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Hi="miso-text";const Wi=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:o=!1,tag:n}}=t,r=i?`data-role="${i}"`:"",a=void 0!==e?k(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[o,n]=e;switch(o){case"date":return t=>s(t,n);case"number":return t=>i(t,n);default:return t=>""+t}}(t)(e)):"";return o?a:`<${n} class="${s}" ${r}>${a}</${n}>`}});class Vi extends zs{static get type(){return"text"}static get defaultTemplates(){return Wi}static get defaultClassName(){return Hi}constructor({className:t=Hi,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Wi,...e},tag:s,...i})}}class Ki extends fs{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=O(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class Yi{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:o,done:n}){const r=i.length;o=Math.min(o,r);const a=!!n&&o===r,c=e.substring(0,s),l=!i.startsWith(c);return a||l?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,o)),a&&t.classList.add("done"),{cursor:o,done:a}}}function Zi(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:o,builtInStyles:n=!0}}=t;"auto"===i&&(i="markdown"===o?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,Ji(e)];n&&"markdown"===o&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${r} data-format="${o}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||pe.INITIAL),i}function Ji(t){return t+"__cursor"}function Xi(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:o,operation:n,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${to(i[0])}, ${to(i[1])})`,e,""+n,o,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function to(t){return Math.floor(100*t)/100+"ms"}const eo="miso-typewriter";class so extends Ki{static get type(){return"typewriter"}static get defaultClassName(){return eo}constructor({className:t=eo,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:o,acceleration:n,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:i,...a}),_(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:z({speed:o,acceleration:n}),this._readiness=new T,"markdown"===s&&so.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=Ji(this.className),{onDebug:s,onCitationLink:i,variant:o}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:Xi(s),variant:o}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new Yi}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:o,status:n,ongoing:r}=t,a=i&&i.answer_stage||"result",l=(_=t,(u=e)&&_&&u.session&&_.session&&u.session.uuid===_.session.uuid);var u,_;const h=e?l&&a===e.stage?e.streak:e.streak+1:0,d=l&&e&&e.doneAt||(n!==pe.READY||r?void 0:Date.now());return this._prevState=Object.freeze(c({session:o,status:n,value:s,stage:a,streak:h,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:o,loop:n}){const r=Zi(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}o(a);const l=e.status===pe.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===pe.READY)&&!c}),l&&n()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const i=e.closest("a");if(i){if(!t.defaultPrevented){const{href:e,innerText:s,className:o}=i;e&&this._view._events.emit("link-click",c({event:t,url:e,text:s?s.trim():"",className:o||"",attributes:io(i)}))}}else;}}function io(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const oo="miso-affiliation";const no=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e,a=i?` data-role="${i}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),_=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${n.itemType?` data-item-type="${n.itemType}"`:""}${void 0!==_?` data-item-count="${_}"`:""}>${r===pe.READY?o[r](t,e):""}</div>`},[pe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}-container">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return vi},body:function(t,e){const{className:s,templates:i}=t,o=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,o)}</div>`},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item"><div class="${o}__item-inner">${n.itemHeader(t,e,s,{index:i})}${n[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:o,templates:n}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=n;return r=Ds.asFunction(r)(t,e,s,i),a=Ds.asFunction(a)(t,e,s,i),`<div class="${o}__item-header">\n  <div class="${o}__item-header-left">${r}</div>\n  <div class="${o}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:o}=t,[n,r]=Ls(t,s,{link:!1});return""+n+(o.infoBlock||o.affiliationInfoBlock||ys)(t,s,i)+(o.imageBlock||Ns)(t,s,{brand:!0,...i})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:o,templates:n}=t,r=Ds.asFunction(n.logoText)(t,e,s,i)||"",a=Ds.asFunction(n.logoImg)(t,e,s,i);return a?`<span class="${o}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:o,templates:n}=t,r=Ds.asFunction(n.logoUrl)(t,e,s,i);if(!r)return"";const a=Ds.asFunction(n.logoAltText)(t,e,s,i);return`<img class="${o}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),ro=Object.freeze({...Xs.defaultTemplates,...no});class ao extends Xs{static get type(){return"affiliation"}static get defaultTemplates(){return ro}static get defaultClassName(){return oo}constructor({className:t=oo,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...no,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Y(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,w((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(ni(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const co="miso-facets",lo="miso-facet",uo="custom_attributes.";const _o=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${o.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map((o=>s.facet(t,{field:o,entries:i[o]},e)))},facet:function(t,e,s){const{facetClassName:i=lo,templates:o}=t,{field:n}=e;return`<div class="${i}" data-role="facet" data-field="${k(n)}">${o.header(t,e,s)}${o.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=lo,templates:o}=t;return`<div class="${i}__header">${o.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(uo)&&(e=e.substring(18)),k(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:o=lo,templates:n}=t;return`<ul class="${o}__options" data-role="options">${s.map((([s,o])=>n.option(t,{field:e,value:s,count:o},i))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=lo,templates:o}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${o.value(t,e,s)}</span>\n  <span class="${i}__count">${o.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return k(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function ho(t,e){return`${t}:::${e}`}function mo(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class po extends zs{static get type(){return"facets"}static get defaultTemplates(){return _o}static get defaultClassName(){return co}constructor({className:t=co,templates:e,...s}={}){super({className:t,templates:{..._o,...e},...s}),this._bindings=new Vs}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=mo(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=mo(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],o=[],n=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),r=s[t];if(!r)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=r[e];if(!c)break;i.push(ho(t,c)),o.push({field:t,value:c}),n.push(s)}}this._bindings.update(i,o,n)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[k(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:o,value:n}=i;this._view.filters.facets.toggle(o,n),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const fo="miso-select";const go=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t,n=i?`data-role="${i}"`:"",r=t._getItems(e),a=r.find((t=>t.selected))||r[0];return`\n<div class="${s}" ${n}>\n  ${o.button(t,a)}\n  ${o.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>i.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return k(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,((t,e)=>" "+e))||e||"")}});class bo extends zs{static get type(){return"select"}static get defaultTemplates(){return go}static get defaultClassName(){return fo}constructor({className:t=fo,templates:e,...s}={}){super({className:t,templates:{...go,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}Ks(bo.prototype);const yo="miso-more-button";const wo=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==pe.READY?" disabled":""}>\n  ${o.text(t)}\n</div>\n`},text:function(t){return"More"}});class vo extends zs{static get type(){return"more-button"}static get defaultTemplates(){return wo}static get defaultClassName(){return yo}constructor({className:t=yo,templates:e,...s}={}){super({className:t,templates:{...wo,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var ko=Object.freeze({__proto__:null,TemplateBasedLayout:zs,ContainerLayout:Bs,ErrorLayout:Gs,BannerLayout:class extends zs{static get type(){return"banner"}static get defaultTemplates(){return Hs}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Hs,...e},...s})}},CollectionLayout:Xs,ListLayout:ei,HorizontalLayout:ii,CardsLayout:class extends Xs{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return oi}constructor({className:t=oi,...e}={}){super({className:t,...e})}},CarouselLayout:Ii,GalleryLayout:Ri,SearchBoxLayout:Li,OptionListLayout:Di,FeedbackLayout:Gi,TextLayout:Vi,TypewriterLayout:so,AffiliationLayout:ao,FacetsLayout:po,SelectLayout:bo,MoreButtonLayout:vo});function Eo(t){return t&&t.value&&t.value.revision}function So(t){const e=function(t){if(!t)return pe.INITIAL;const{request:e,error:s,value:i}=t;return s?pe.ERRONEOUS:i?pe.READY:e?pe.LOADING:pe.INITIAL}(t);return c({status:e,ongoing:e===pe.READY?t.ongoing:void 0,...t})}function xo(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:i}=s;i&&(e.meta.miso_id=i)}function Oo(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:o}=i||{};return o?{...t,value:{...s,keywords:o}}:t}function Io(t){const{role:e,type:s,items:i}=t,o={type:"viewable"===s?"viewable_impression":s,context:{custom_context:c({property:e})}};switch(function(t){return de.has(t)}(s)&&(!function(t){return le.has(t)}(e)?(o.product_ids=[],o.context.custom_context.items=(i||[]).map((t=>t.text||t.id||t))):o.product_ids=(i||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case ue.SUBMIT:o.context.custom_context.value=t.value;break;case ue.FEEDBACK:o.context.custom_context.value=o.value=t.value,o.context.custom_context.result_type=o.result_type=t.result_type}return c(o)}function To(t={},e={}){return c({...t,...e,context:c({...t.context,...e.context,custom_context:c({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const Co=Object.freeze({}),Ao=Object.freeze({[re.CONTAINER]:Bs.type,[re.ERROR]:Gs.type}),Ro=Object.freeze({}),No=Object.freeze({api:Co,layouts:Ao,trackers:Ro}),$o=Object.freeze({mappings:{[re.ERROR]:t=>t.error}});class Po extends V{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:o,options:n}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=o,this._options=n||new Ce(e&&e._options,o),this._hub=new je({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({name:t,roles:e}){const s=this._hub,i=this._client,o=this._options,n=this._extensions,r=this._plugin.layouts;this._sessions=new De(s),this._data=new Fe(s,{source:ps(i),options:o}),this._views=new us(s,{extensions:n,layouts:r,roles:e,options:o,workflow:t}),this._interactions=new ms(s,{client:i,options:o})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(qe(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:i}){i||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[qe(t)]||{};e.session&&e.status===pe.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===pe.READY,i=e===pe.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),o=i.has(t);return i.add(t),!o}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=se(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Eo(t);if(!l(s)){const t=Eo(this._hub.states.data);if(!l(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=So(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:pe.READY,session:this.session,...e},this._hub.update(qe(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=Io(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==re.AFFILIATION)return t;const{items:s}=e;return To(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return To(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[qe(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?To(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function Lo(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Uo(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map((t=>({...t})));let o=0;for(const t of i)s&&(t.channel=s),t.position=o++;return{...t,affiliation:{...e,products:i}}}(t)}function Uo({products:t,...e}){return{channel:"sovrn",...e,products:t.map(qo)}}function qo({id:t,deeplink:e,headline:s,description:i,currency:o,retailPrice:n,salePrice:r,discountRate:a,image:l,thumbnail:u,merchant:_,...h}){return c({id:"sovrn-"+t,title:s,description:i,cover_image:l,url:e,currency:o,original_price:n,sale_price:r,discount_rate_percent:a,brand:_&&_.name,brand_logo:_&&_.logo,custom_attributes:jo({sovrn_id:t,thumbnail:u,merchant:_,...h})})}function jo(t,e=""){return Object.keys(t).reduce(((s,i)=>{const o=t[i];if(void 0===o)return s;const n=e?`${e}_${i}`:i;return"object"==typeof o?{...s,...jo(o,n)}:{...s,[n]:o}}),{})}function Do(t){j(t,zo.prototype)}$e(Po.prototype),Object.assign(Po,{DEFAULT_API_OPTIONS:Co,DEFAULT_LAYOUTS:Ao,DEFAULT_TRACKERS:Ro,DEFAULT_OPTIONS:No,ROLES_OPTIONS:$o});class zo{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Fo=Object.freeze({...Po.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Po.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Mo=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),Bo=Object.freeze({...Po.DEFAULT_LAYOUTS,[re.QUERY]:[Li.type,{placeholder:"Ask a question"}],[re.QUESTION]:[Vi.type,{tag:"h2"}],[re.ANSWER]:so.type,[re.FEEDBACK]:Gi.type,[re.IMAGES]:[Ri.type,{incremental:!0,itemType:"image"}],[re.SOURCES]:[ei.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[re.AFFILIATION]:[ao.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Qo=Object.freeze({...Po.DEFAULT_TRACKERS,[re.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:ke.click},[re.IMAGES]:ke,[re.SOURCES]:ke,[re.AFFILIATION]:ke,[re.PRODUCTS]:ke}),Go=Object.freeze({...Po.DEFAULT_OPTIONS,api:Fo,autocomplete:Mo,layouts:Bo,trackers:Qo}),Ho=Jt(Po.ROLES_OPTIONS,{main:re.ANSWER,members:Object.keys(Bo)});class Wo extends Po{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new ds(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(re.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(re.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[qe(this._roles.main)]||{};t.session&&t.status!==pe.INITIAL&&(t.status!==pe.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===pe.READY&&!t.ongoing,o=e===pe.ERRONEOUS,n=i?"done":o?"error":e,r=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(n,t),(i||o)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){Le.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||ne}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Lo(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_updateUrlIfNecessary({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,o=t&&t.question||e&&e.payload&&e.payload.question,n=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source;if(!o)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(i)||ne;o===a&&n===c||(r.searchParams.set(s,o),n===ne?r.searchParams.delete(i):r.searchParams.set(i,n),window.history.replaceState({},"",r))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=function(t,{event_target:e}={}){return e?To(t,{context:{custom_context:{event_target:e}}}):t}(t=this._writeAnswerClickInteraction(t,e),e)}_writeAskPropertiesToInteraction(t={},e){return To(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==re.ANSWER)return t;const{items:s=[]}=e;return To(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[qe(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t,event:e}){if(rs(e))return;const{value:s}=this.states.data||{},{sources:i}=s||{},o=i&&i[t-1];o&&o.product_id&&(as(e),this._views.trackers.sources.click([o.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){rs(t)||(as(t),this._views.trackers.answer.click([],{items:[e]}))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Do(Wo.prototype),Object.assign(Wo,{DEFAULT_API_OPTIONS:Fo,DEFAULT_AUTOCOMPLETE_OPTIONS:Mo,DEFAULT_LAYOUTS:Bo,DEFAULT_TRACKERS:Qo,DEFAULT_OPTIONS:Go,ROLES_OPTIONS:Ho});const Vo=Object.freeze({...Wo.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...Wo.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Ko=Object.freeze({...Wo.DEFAULT_LAYOUTS,[re.QUERY]:[Li.type,{templates:{buttonIcon:"send"}}],[re.RELATED_RESOURCES]:[ei.type,{incremental:!0,itemType:"article"}],[re.QUERY_SUGGESTIONS]:Di.type}),Yo=Object.freeze({...Wo.DEFAULT_TRACKERS,[re.RELATED_RESOURCES]:ke,[re.QUERY_SUGGESTIONS]:{...ke,click:{...ke.click,validate:t=>0===t.button}}}),Zo=Object.freeze({...Wo.DEFAULT_OPTIONS,api:Vo,layouts:Ko,trackers:Yo}),Jo=Jt(Wo.ROLES_OPTIONS,{members:Object.keys(Ko)});class Xo extends Wo{constructor(t,e){super({name:"ask",context:t,roles:Jo,defaults:Zo,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;_(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states.data.value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:i}=this;let o=c({...s,question:t,parent_question_id:i,_meta:{...s._meta,question_source:e||ne}});return o=this._writeWikiLinkTemplateToPayload(o),o}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,o,n,{property:r}=t.context&&t.context.custom_context||{};return e.role===re.QUERY_SUGGESTIONS?(r="suggested_followup_questions",o=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,n=this.previous&&this.previous.session.meta.question_source):(o=this.parentQuestionId,i=this.questionId,n=this._getQuestionSourceFromViewState(e)),To(t,{context:{custom_context:{property:r,root_question_id:s,parent_question_id:o,question_id:i,question_source:n}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class tn extends Ue{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Xo(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Xo(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const en=Object.freeze({...Po.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Po.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),sn=Object.freeze({...Po.DEFAULT_LAYOUTS,[re.QUERY]:[Li.type],[re.PRODUCTS]:[ei.type,{incremental:!0,infiniteScroll:!0}],[re.KEYWORDS]:[Vi.type,{raw:!0}],[re.TOTAL]:[Vi.type,{raw:!0,format:"number"}],[re.FACETS]:[po.type],[re.SORT]:[bo.type],[re.MORE]:[vo.type]}),on=Object.freeze({...Po.DEFAULT_TRACKERS,[re.PRODUCTS]:ke}),nn=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),rn=Object.freeze({...Po.DEFAULT_OPTIONS,api:en,layouts:sn,trackers:on,pagination:nn}),an=Jt(Po.ROLES_OPTIONS,{main:re.PRODUCTS,members:Object.keys(sn),mappings:{[re.FACETS]:"facet_counts",[re.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:o}=e.states.filters||{},n=o&&o.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return n?i.map((t=>({...t,selected:t.field===n}))):i}}});class cn extends Po{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(re.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){Le.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this._views.filters.reset({silent:!0}),this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==pe.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return c({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return r(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map((t=>t.product_id)).filter((t=>t)),o=[...t.exclude||[],...i];return 0===o.length?t:{...t,exclude:o}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case pe.INITIAL:case pe.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=Oo(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=re.PRODUCTS}={}){const{status:s,request:i,value:o}=t;if(s!==pe.READY||!i||!o)return t;const{[e]:n}=o;if(!n)return t;const{rows:r}=i.payload,{length:a}=n;return r>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=re.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:o,total:n}=t.value,{[s]:r=[]}=e.value;return{...e,value:{...e.value,facet_counts:o,total:n,[s]:[...i,...r]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}$e(cn.prototype,[ge.PAGINATION,ge.FILTERS]),Object.assign(cn,{DEFAULT_API_OPTIONS:en,DEFAULT_LAYOUTS:sn,DEFAULT_TRACKERS:on,DEFAULT_PAGINATION:nn,DEFAULT_OPTIONS:rn,ROLES_OPTIONS:an});const ln=Object.freeze({members:[]});function un({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function _n(t){return t&&t.value&&t.value.trim()||void 0}class hn extends Po{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:un(e),roles:ln,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,_n(t)===_n(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!_n(t))return void this._updateCompletions({session:s,status:pe.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:_n(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function dn(t){j(t,mn.prototype)}class mn{_initAutocomplete(t){this._autocomplete=new hn(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const pn=Jt(Wo.ROLES_OPTIONS,{mappings:{[re.QUESTION]:re.KEYWORDS}});class fn extends Wo{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:pn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset({silent:!0}),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._writeWikiLinkTemplateToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||ne}}}_defaultProcessData(t){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:i}={}}=e;return i?{...t,meta:{...t.meta,miso_id:i}}:t}(t=Oo(t=super._defaultProcessData(t))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_updateDataInHub(t){switch(t.status){case pe.INITIAL:case pe.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),xo(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}dn(fn.prototype);const gn={...cn.ROLES_OPTIONS,members:[re.PRODUCTS,re.KEYWORDS,re.TOTAL,re.FACETS,re.SORT,re.MORE,re.ERROR]};class bn extends cn{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:gn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:c({...t._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(t){return xo(t=super._defaultProcessData(t)),t}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}}Object.assign(bn,{ROLES_OPTIONS:gn});class yn{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return bn.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const wn=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...Wo.DEFAULT_API_OPTIONS.payload,...cn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),vn=Object.freeze({...Wo.DEFAULT_LAYOUTS,...cn.DEFAULT_LAYOUTS,[re.QUERY]:[Li.type,{placeholder:""}],[re.QUESTION]:[Vi.type,{raw:!0}],[re.SOURCES]:[ii.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:bs,articleInfoBlock:ks}}]}),kn=Object.freeze({...Wo.DEFAULT_TRACKERS,...cn.DEFAULT_TRACKERS}),En=Object.freeze({...cn.DEFAULT_PAGINATION,active:!0}),Sn=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),xn=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),On=Object.freeze({...Wo.DEFAULT_OPTIONS,...cn.DEFAULT_OPTIONS,api:wn,layouts:vn,trackers:kn,autocomplete:Sn,pagination:En,filters:xn}),In=Object.freeze({main:re.PRODUCTS,members:Object.keys(vn),mappings:Object.freeze({...Wo.ROLES_OPTIONS.mappings,...cn.ROLES_OPTIONS.mappings})});class Tn extends Po{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:In,defaults:On})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new fn(this),this._results=new bn(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){this._views=new yn(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return t=this._answer._defaultProcessInteraction0(t,e),t=this._results._defaultProcessInteraction0(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}$e(Tn.prototype,[ge.PAGINATION,ge.FILTERS]);const Cn=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),An=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Rn=Object.freeze({...cn.DEFAULT_LAYOUTS}),Nn=Object.freeze({...cn.DEFAULT_TRACKERS}),$n=Object.freeze({...cn.DEFAULT_OPTIONS,api:Cn,autocomplete:An,layouts:Rn,trackers:Nn}),Pn=cn.ROLES_OPTIONS;class Ln extends cn{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Pn,defaults:$n})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=re.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}dn(Ln.prototype);class Un extends Ue{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=oe){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=oe){return this._members.has(t)}get(t=oe){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class qn extends Po{_initProperties(t){super._initProperties(t);const{id:e}=t;_(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return To(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(qn,{DEFAULT_API_OPTIONS:Po.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Po.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Po.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Po.DEFAULT_OPTIONS,ROLES_OPTIONS:Po.ROLES_OPTIONS});const jn=Object.freeze({...qn.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...qn.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Dn=Object.freeze({...qn.DEFAULT_LAYOUTS,[re.PRODUCTS]:ei.type}),zn=Object.freeze({...qn.DEFAULT_TRACKERS,[re.PRODUCTS]:ke}),Fn=Object.freeze({...qn.DEFAULT_OPTIONS,api:jn,layouts:Dn,trackers:zn}),Mn=Jt(qn.ROLES_OPTIONS,{main:re.PRODUCTS,members:Object.keys(Dn)});class Bn extends qn{constructor(t,e){super({name:"recommendation",context:t,roles:Mn,defaults:Fn,id:e})}start(){return this._request(),this}notifyViewUpdate(t=re.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class Qn extends Un{constructor(t,e){super("recommendations",t,e)}_create(t){return new Bn(this,t)}}const Gn=Object.freeze({...qn.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),Hn=Object.freeze({...qn.DEFAULT_LAYOUTS,[re.RELATED_QUESTIONS]:[ei.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[re.QUERY]:[Li.type,{placeholder:"Ask a question"}]}),Wn=Object.freeze({...qn.DEFAULT_TRACKERS,[re.RELATED_QUESTIONS]:ke,[re.CONTAINER]:{...ke,itemless:!0},[re.QUERY]:{[ue.SUBMIT]:{active:!0}}}),Vn=Object.freeze({...qn.DEFAULT_OPTIONS,api:Gn,layouts:Hn,trackers:Wn}),Kn=Jt(qn.ROLES_OPTIONS,{main:re.RELATED_QUESTIONS,members:Object.keys(Hn)});class Yn extends qn{constructor(t,e){super({name:"explore",context:t,roles:Kn,defaults:Vn,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(re.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return zo.prototype.useLink.call(this,t,e),e&&this.useLayouts({[re.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=re.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=zo.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Do(Yn.prototype);class Zn extends Un{constructor(t,e){super("explores",t,e)}_create(t){return new Yn(this,t)}}class Jn extends V{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new T)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var Xn=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var tr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class er{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class sr{constructor(t){this._context=t,_(this,{lowerCamelToKebab:m,kebabToLowerCamel:h,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=d(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:i=!1}){const{classPrefix:o}=t;return`<${s} class="${i?o+"__phrase-inline":o+"__phrase"} ${o}__${e}-phrase">${this.phraseText(t,h(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:o,logo:n=!1},r){const a=[`${t}__${i}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:o,logo:n,parentQuestionId:s},r)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${m(t)}="${i}"`)}return s}}const ir=D(new sr({...Xn,DEFAULT_PHRASES:tr})),or=D(new class extends er{constructor(){super({helpers:ir})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:o={},logo:n=!0}=t;return i(t,{name:"related-resources"},!1===o.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:n},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:i={}}=t;return!1===i.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:ir}));function nr(t={}){const{normalizeOptions:e,section:s,container:i}=ir,{querySuggestions:o,answerGroup:n}=or;return s(t=e(t),{name:"follow-up"},[o(t),i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...n(t)])}var rr=Object.freeze({__proto__:null,helpers:ir,sections:or,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=ir,{followUps:o,relatedResourcesSection:n,answerGroup:r}=or;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},r(t))+o(t)+n(t)},followUp:nr});const ar=Object.freeze(Xn),cr=Object.freeze(tr),lr=Object.freeze(rr);var ur=Object.freeze({__proto__:null,constants:ar,phrases:cr,templates:lr,wireFollowUps:function(t,e,{template:s=nr,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const o=t.ui.asks,n=t.ui.ask;o.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))})),n.on("loading",(()=>{e.innerHTML="",o.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:_r}=document,hr=Object.freeze({templates:lr,autostart:!0}),dr=["templates","phrases","features"];class mr{constructor(){this._defaults=hr,this._scriptSrc=function(){if(!_r||!_r.src)return{};const t=document.createElement("a");t.href=_r.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=gr(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=gr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...o}={}){return c({apiKey:t,apiHost:e,templates:br(s),phrases:i,...o})}(pr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function pr(...t){let e={};for(const s of t)s&&(e=fr(e,s));return e}function fr(t,e){if(!e)return t;Object.assign(t,e);for(const s of dr)s in e&&(t[s]={...t[s],...e[s]});return t}function gr(t){return""===t||"false"!==t&&t}function br(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(br):function(t,e){const s={};for(const[i,o]of Object.entries(t))s[i]=e(o);return s}(t,br);default:throw Error("Unsupported template type: "+t)}}class yr{constructor(t,{classPrefix:e=ar.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");_(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class wr extends Jn{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new mr,this._localOptions={}}config(t={}){t=pr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;_(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new yr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:o,wireRelatedResources:n}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=i,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&o(e,s.followUpsSection,{...i,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&n(e,s.relatedResourcesSection),l.autoQuery()}}class vr extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let kr,Er,Sr;async function xr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||kr||(kr=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Er=Er||e.any(),Sr=Sr||await Er,Sr.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Sr}const Or="logo",Ir="auto",Tr=Object.freeze([Or]);function Cr(t){if(!t)return Ir;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Ar extends HTMLElement{static get observedAttributes(){return Tr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Cr(this.getAttribute(Or))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Ir:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Or,e):this.removeAttribute(Or)}async connectedCallback(){const t=this._client=await xr(Ar);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Or)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Cr(t)!==Cr(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Rr="parent-question-id",Nr=Object.freeze([...Ar.observedAttributes,Rr]);const $r="unit-id",Pr=Object.freeze([...Ar.observedAttributes,$r]);class Lr extends Ar{static get observedAttributes(){return Pr}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute($r)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute($r,t):this.removeAttribute($r)}attributeChangedCallback(t,e,s){if(t===$r)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Ur=Object.freeze({__proto__:null,MisoAskElement:class extends Ar{static get tagName(){return"miso-ask"}static get observedAttributes(){return Nr}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Rr)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Rr,t):this.removeAttribute(Rr))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Rr)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Lr{static get tagName(){return"miso-explore"}static get observedAttributes(){return Lr.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends Ar{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Ar.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Ar{static get tagName(){return"miso-search"}static get observedAttributes(){return Ar.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Lr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Lr.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const qr="role",jr=Object.freeze([qr]);class Dr extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return jr}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(qr);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${qr}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${qr}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===qr&&this._container&&this._container._updateComponentRole(this,e,s)}}var zr=Object.freeze({__proto__:null,MisoComponentElement:Dr,MisoQueryElement:class extends Dr{constructor(){super({role:re.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Dr{constructor(){super({role:re.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Dr{constructor(){super({role:re.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Dr{constructor(){super({role:re.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Dr{constructor(){super({role:re.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Dr{constructor(){super({role:re.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Dr{constructor(){super({role:re.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Dr{constructor(){super({role:re.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Dr{constructor(){super({role:re.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Dr{constructor(){super({role:re.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Dr{constructor(){super({role:re.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends Dr{constructor(){super({role:re.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Dr{constructor(){super({role:re.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Dr{constructor(){super({role:re.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Dr{constructor(){super({role:re.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Dr{constructor(){super({role:re.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Dr{constructor(){super({role:re.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Dr{constructor(){super({role:re.ERROR})}static get tagName(){return"miso-error"}}});class Fr extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Fr.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var Mr=Object.freeze({__proto__:null,containers:Ur,roles:zr,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Fr{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Fs});const Br="miso-hybrid-search-combo";var Qr=Object.freeze({__proto__:null,CLASS_PREFIX:Br,CONAINER_TAG:"miso-hybrid-search"});const Gr="Show more",Hr="Show less";var Wr=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:Gr,showLess:Hr});const Vr=D(new sr({...Qr,DEFAULT_PHRASES:Wr})),Kr=D(new class extends er{constructor(){super({helpers:Vr})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Vr}));var Yr=Object.freeze({__proto__:null,helpers:Vr,sections:Kr,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=Vr;t=e(t);const{answerBox:o,answerGroup:n,searchResultsGroup:r}=Kr,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[o(t)]:n(t))+s(t,{name:"search-results"},r(t))}});const Zr="answer-box-open",Jr="answer-box-shown",Xr='[data-role="answer-box-toggle"]';class ta{constructor(t,e,{classPrefix:s=Br,phrases:i={},hideWhenUnanswerable:o=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=o,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(Xr)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case pe.ERRONEOUS:case pe.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||Hr:this._phrases.showMore||Gr;for(const e of this._element.querySelectorAll(Xr))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const ea={isOpen:Zr,shown:Jr},sa={toggleOpen:["toggle",Zr],open:["open",Zr],close:["remove",Zr],toggleHidden:["toggle",Jr],show:["add",Jr],hide:["remove",Jr]};for(const[t,e]of Object.entries(ea))Object.defineProperty(ta.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(sa))ta.prototype[t]=function(){this._updateBoxStatus(e,s),s===Zr&&(this._syncButtonText(),this._syncScroll())};const ia=Object.freeze(Qr),oa=Object.freeze(Wr),na=Object.freeze(Yr);var ra=Object.freeze({__proto__:null,constants:ia,phrases:oa,templates:na,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new ta(t,e,s)}});const aa=Object.freeze(ur),ca=Object.freeze(ra);var la=Object.freeze({__proto__:null,ask:aa,hybridSearch:ca});let ua,_a;async function ha(){return _a||(_a=N(ua||(ua=$("ui"))))}class da{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class ma{constructor(t,e){this._plugin=t,this._client=e,_(this,{sources:{api:ps(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Ln(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Tn(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class pa{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new wr(this._plugin,this._MisoClient))}}Ct.plugins.use(class extends V{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new vr(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new T}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:la};u(s,this,["layouts","combo","ready"]),_(this,{MisoClient:t}),_(t,{ui:s}),this.combo=new pa(this,t);const i=Object.values(ko).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:o,roles:n,combos:r,...a}=Mr,c=[...Object.values(r),...Object.values(o),...Object.values(n),...Object.values(a)];Ar.MisoClient=t,Fr.MisoClient=t;for(const e of c)e.MisoClient=t;await ha();for(const t of c)y(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){_(t,{ui:new ma(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new da(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new Qn(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new Zn(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new tn(this,t)),e}}),Ct.attach(),function(t){const e=[];function s(t){e.push(t)}A("misodev",{transform:t=>()=>t({addCmdTransform:s})});const i=t=>{for(const s of e)t=s(t);return t};setTimeout((()=>{A("misocmd",{transform:i}),t&&t()}))}((function(){xt._cmdRes.resolve()}));const fa="/crn-answers",ga=/^\/(news)\/.+/;function ba({className:t},{tags:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-section">${e[0]}</div>`:""}function ya({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">BY <span>${e.join(", ")}</span></div>`:""}const wa=(t,e,s)=>{const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+ba(t,e)+o.titleBlock(t,e,s)+o.descriptionBlock(t,e,s)+ya(t,e)+o.dateBlock(t,e,s)}</div>`},va=({parentQuestionId:t})=>`\n<section class="miso-ask-combo__section miso-ask-combo__follow-up">\n  <miso-ask class="miso-ask-combo__query-suggestions-container miso-circled-citation-index" visible-when="initial+nonempty" logo="false" parent-question-id="${t}">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__query-suggestions-phrase">Related questions</h3>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" visible-when="initial loading" logo="false" parent-question-id="${t}">\n    <miso-query></miso-query>\n  </miso-ask>\n</section>\n<miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${t}">\n  <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">You asked:</div>\n  <miso-question></miso-question>\n  <miso-answer></miso-answer>\n</miso-ask>\n<section class="miso-ask-combo__section miso-ask-source">\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">This answer is based on the following articles</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n</section>\n<section class="miso-ask-combo__section miso-ask-affiliation">\n  <miso-ask class="miso-ask-combo__affiliation-container" logo="false" parent-question-id="${t}"></miso-ask>\n</section>\n`,ka=async t=>{const e=document.querySelector('meta[name="miso-explore"]');if(e&&"false"===e.content)return;await t.ui.ready;const s=t.ui.explore,i="https://www.crn.com"+window.location.pathname;s.useApi({product_id:i}),s.useLayouts({query:{placeholder:"Ask any question",buttonText:"Ask CRN"}}),s.on("done",(({empty:t})=>{t&&(o.style.display="none")})),s.useLink((t=>`${fa}?q=${encodeURIComponent(t)}`));const o=document.querySelector("#miso-explore")||(()=>{const t=document.querySelectorAll(".content-section .default-content-wrapper");if(0===t.length)return;const e=t[t.length-1],s=e.querySelectorAll("p"),i=document.createElement("div");return i.id="miso-explore",i.className="miso-explore",9>s.length?e.appendChild(i):s[8].insertAdjacentElement("beforebegin",i),i})();o&&(o.innerHTML="\n<h1>CRN Answers</h1>\n<p>Let CRN’s AI answer your tech questions using CRN articles and content from our experts. CRN Answers is a AI tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.</p>\n<miso-explore>\n  <miso-related-questions></miso-related-questions>\n  <miso-query></miso-query>\n</miso-explore>\n",s.start())};!function(){const t={_client:!1,_init(){if(this._client)return;const t=new Ct("2YGOfJTHVwn6PNQY8VmP7Z9K55zzmEEKGjI6DD0g");this._client=t},explore(){ka(this._client)},answer(){(async t=>{await t.ui.ready;const e=t.ui.ask,s=t.ui.asks,i=Ct.ui.defaults.ask.wireFollowUps,o=document.querySelector("#miso-ask-combo");o.innerHTML='\n<div class="miso-crn-info-style-block-container">\n  <div class="miso-crn-info-style-block miso-crn-info-style-block__main">\n    <div class="miso-crn-info-style-block__description">\n      <div>Let CRN Answers help you discover content, answer questions, and go deep on the topics that matter to you</div>\n    </div>\n    <section class="miso-ask-combo__section miso-ask-combo__question">\n      <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" logo="false">\n        <miso-query></miso-query>\n      </miso-ask>\n    </section>\n  </div>\n</div>\n<div class="miso-crn-answer-block">\n  <section class="miso-ask-combo__section miso-ask-combo__answer">\n    <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">You asked:</div>\n      <miso-question></miso-question>\n      <miso-answer></miso-answer>\n    </miso-ask>\n  </section>\n</div>\n<div class="miso-crn-info-style-block-container">\n  <div class="miso-crn-info-style-block miso-crn-info-style-block__tail"></div>\n</div>\n<section class="miso-ask-combo__section miso-ask-source">\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">This answer is based on the following articles</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n</section>\n<section class="miso-ask-combo__section miso-ask-affiliation">\n  <miso-ask class="miso-ask-combo__affiliation-container" logo="false"></miso-ask>\n</section>\n<div id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></div>\n',s.useApi({source_fl:["cover_image","url","published_at","authors","tags"]}),s.useLayouts({query:{placeholder:"Ask any question",buttonText:"Ask CRN"},sources:["list",{templates:{articleInfoBlock:wa}}]}),s.on("done",(({workflow:t})=>{const e=t?.states?.data?.value?.affiliation_products?.[0];if(!e)return;const s=document.querySelectorAll(".miso-ask-combo__affiliation-container");s[s.length-1].innerHTML=(({product_id:t,cover_image:e,title:s,description:i,url:o})=>`\n<miso-whitepaper>\n  <h3 class="miso-ask-combo__phrase miso-ask-combo__whitepaper-phrase">From Our CRN Answers Sponsor</h4>\n  <div class="miso-whitepaper miso-list" data-item-type="article">\n    <ul class="miso-list__list" data-item-type="article">\n      <li class="miso-list__item">\n        <a class="miso-list__item-body" data-whitepaper-product-id="${t}" href="${o}" target="_blank" rel="noopener">\n          <div class="miso-whitepaper__description">SPONSORED CONTENT</div>\n          <div class="miso-whitepaper__content">\n            <div class="miso-list__item-cover-image-container">\n              <img class="miso-list__item-cover-image" src="${e}">\n            </div>\n            <div class="miso-list__item-info-container">\n              <div class="miso-list__item-title">${s}</div>\n              <div class="miso-list__item-desc">${i}</div>\n            </div>\n          </div>\n        </a>\n      </li>\n    </ul>\n  </div>\n</miso-whitepaper>\n`)(e)})),i(t,o.querySelector(".miso-ask-combo__follow-ups"),{template:va}),e.autoQuery()})(this._client)}};t._init();const e=window.location.pathname;e===fa?t.answer():ga.test(e)&&t.explore()}()}();
