!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===s&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}('@charset "UTF-8";@import url("https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");:root{font-family:Open Sans,sans-serif;font-optical-sizing:auto;font-style:normal;font-variation-settings:"wdth" 100;font-weight:400}.miso-ask-combo__question-phrase{font-family:Cormorant Garamond,serif;font-size:1rem!important;font-style:italic;font-weight:400;letter-spacing:.05em;margin-bottom:1.5rem!important}miso-question .miso-text{font-family:Josefin Sans,sans-serif;font-optical-sizing:auto;font-size:2.2rem!important;letter-spacing:-.05em}miso-answer h2,miso-question .miso-text{margin-bottom:1rem!important}miso-answer p{margin-top:1rem!important}miso-answer h1{font-size:1.8rem!important}miso-answer h2{font-size:1.6rem!important}miso-answer h3{font-size:1.4rem!important}miso-answer h1,miso-answer h2,miso-answer h3{display:block;font-family:Josefin Sans,sans-serif;font-optical-sizing:auto;font-weight:400;letter-spacing:-.04em}miso-answer p strong{background-color:#fdefe3;font-weight:500!important;padding-left:.3rem!important;padding-right:.3rem!important}miso-answer h1{-webkit-text-decoration:underline .175rem #f36f21!important;text-decoration:underline .175rem #f36f21!important;text-underline-offset:.25rem!important}miso-answer table{font-size:.9rem!important}miso-answer table thead tr{background-color:#fdece2!important;border:none!important}miso-answer table thead tr th{background-color:#fdefe3!important;border-bottom-width:0!important;font-family:Josefin Sans,sans-serif;font-weight:600!important;padding:.5rem 1rem!important;vertical-align:middle!important}miso-answer table thead tr th:first-child{border-top-left-radius:10px!important}miso-answer table thead tr th:last-child{border-top-right-radius:10px!important}miso-answer table tbody{border:none!important}miso-answer table tbody tr{background-color:#fff!important;border-color:oklch(87% 0 0deg)!important;border-left:none!important;border-right:none!important}miso-answer table tbody tr:first-child{border-top:none!important}miso-answer table tbody tr td{border-color:oklch(87% 0 0deg)!important;padding:.5rem 1rem!important;vertical-align:middle!important}miso-answer table tbody tr a:not(.miso-citation-link){color:inherit!important;text-decoration:underline!important}miso-answer a,miso-answer table tbody tr .miso-citation-link{color:#f36f21!important}miso-answer ol{counter-reset:item!important;margin-top:1rem!important;padding-left:3rem!important}miso-answer ol>li{counter-increment:item!important;line-height:1.8!important;list-style:none!important;margin-bottom:.5rem!important}miso-answer ol>li:before{color:#f36f21!important;content:counter(item) "."!important;font-family:Josefin Sans,sans-serif;font-size:1.1rem!important;font-weight:600!important;margin-left:-1.6rem!important;margin-right:1rem!important;min-width:.8rem!important;position:absolute!important;text-align:center!important}miso-answer ul{margin-top:1rem!important;padding-left:3rem!important}miso-answer ul>li{line-height:1.8!important;list-style:none!important;margin-bottom:.5rem!important;position:relative!important}miso-answer ul>li:before{background-color:#f36f21!important;border-radius:50%!important;content:""!important;height:.4rem!important;left:.2rem!important;margin-left:-1.6rem!important;margin-right:1rem!important;position:absolute!important;top:.75rem!important;width:.4rem!important}miso-answer li strong{background-color:#fdefe3;font-weight:400!important;margin-left:-.3rem!important;margin-right:.3rem!important;padding-left:.3rem!important;padding-right:.3rem!important}miso-answer table{margin-bottom:2rem!important;margin-top:.5rem!important}miso-answer blockquote{align-items:center!important;display:flex!important;justify-content:center!important}miso-answer blockquote p{background-color:#fdefe3!important;border-radius:10px!important;font-family:Cormorant Garamond,serif;font-size:1.3rem!important;font-style:italic;font-weight:700;line-height:1.4!important;margin-bottom:2rem!important;padding:1.5rem 2rem!important;position:relative!important;width:-moz-fit-content!important;width:fit-content!important}miso-answer blockquote a{font-size:1.2rem!important;font-style:normal!important}miso-answer blockquote p:before{bottom:calc(100% - 3.4rem)!important;content:"“︁"!important;left:1rem!important}miso-answer blockquote p:after,miso-answer blockquote p:before{color:#f36f21!important;font-family:Open Sans,sans-serif!important;font-size:3.6rem!important;position:absolute!important}miso-answer blockquote p:after{content:"”︁"!important;right:1rem!important;top:calc(100% - 1.8rem)!important}miso-answer blockquote p em:last-child{color:oklch(50% .02 280deg)!important;display:block!important;font-family:Open Sans,sans-serif!important;font-size:.9rem!important;font-style:normal!important;font-weight:400!important;margin-top:.5rem!important}');var t="1.12.1";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",()=>s.abort(e.reason))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var n=Object.freeze({__proto__:null,GROUP:s,NAME:i});function r(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function o(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){return null!=t?""+t:t}function c(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function l(t){return null==t}function u(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t),{}))}function h(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function _(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function d(t){return t.replace(/[-_][a-z]/g,t=>t[1].toUpperCase())}function p(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class m{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);g(s),g(i),g(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout(()=>f(this,t),e):f(this,t),this._value=t}disconnect(){this._active=!1}}function f(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function g(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function y(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function b(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function w(t){return new Promise((e,s)=>{window.requestAnimationFrame(async i=>{try{await t(i),e()}catch(t){s(t)}})})}async function v(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise((n,r)=>{const o=new m(t=>{t&&(o.disconnect(),a.disconnect(),n())},{onDuration:s}),a=new IntersectionObserver(t=>{o.value=t[0].isIntersecting},{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))})})}function E(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function S(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function k(t,e){const s=O(()=>window.localStorage.getItem(t)),i=O(()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t)),n=s||i||""+e();return n&&!s&&O(()=>window.localStorage.setItem(t,n)),n&&!i&&O(()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n)),n}function O(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function I(t){return new T(t)}class T{constructor(t){this._value=t;const e=t=>{this._value=t};h(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class x{constructor(){const t=this;t.promise=new Promise((e,s)=>{t.resolve=e,t.reject=s}),Object.freeze(this)}}class C{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new x),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function A(t,e){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,{onError:e=t=>console.error(t),transform:s=t=>t}={}){try{s(t)()}catch(t){e(t)}}(t,e);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let R;try{R=document.currentScript}catch(t){}async function N(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval(()=>{t.sheet&&(i&&clearInterval(i),e())},100)})}(t),await async function(t){if(P(t))return;return new Promise(e=>{let s;s=setInterval(()=>{P(t)&&(s&&clearInterval(s),e())},100)})}(t)}(e)}catch(t){console.error(t)}}function $(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.1/dist/css/${t}.css`}function P(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function L(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout(()=>{e=void 0,s()},t)}}function U(t,{depth:e=5,...s}={}){return q(t,e)}function q(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,t=>q(t,e-1)):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const n=t[i];"function"!=typeof n&&(i.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(s[i]=q(n,e-1)))}return s}(t,e):t:"(...)"}function j(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,n]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,n)}function D(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=n[i];r&&(e[i]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}function z(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let n=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(n*=1+(s-i)*e/1e3),n}}(t);return(t,s,i,n)=>{const r=e(i,s);return t+Math.max(n-i,0)*r/1e3}}const F=Symbol.for("miso:resources");class M{constructor(){this._resources=new Map;const t=window[F]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){B(this._resources,t).resolve(e)}async get(t){return B(this._resources,t).promise}}function B(t,e){if(t.has(e))return t.get(e);const s=new x;return t.set(e,s),s}function Q(){return window[F]||(window[F]=new M)}class G{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new x;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class H{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise((s,i)=>{const n=e._on(t,t=>{setTimeout(()=>n());try{s(t)}catch(t){i(t)}})})}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)r(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&r(s,e)}}_injectSubscribeInterface(t){u(t,this,["on","once"])}}function W(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class V{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:W(t,e),uuid:S()})}(t,e);h(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new H({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(V,"miso:component");class K extends V{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new x);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Y{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new m(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class Z{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout(()=>this.abort(),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const J=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class X{constructor(t,e){this._client=t,this._root=e,this._bulk=new G(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const l="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=n?AbortSignal.timeout(n):void 0,h=await(this._root._customFetch||window.fetch)(t,c({method:s,headers:i,body:l,cache:"no-cache",mode:"cors",signal:u})),_=await h.json();if(h.status>=400||_.errors){var d=Error(_.message);throw d.data=_,d.status=h.status,d}return _}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map(({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s}))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter(t=>t).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=J.DATA_ENDPOINT,eventEndpoint:s=J.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}}class tt extends V{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...n}),this._postprocess(l)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:et,NAME:st}=n;class it extends tt{constructor(t){super(t,et.INTERACTIONS)}async upload(t,e){try{return await this._run(st.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===st.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class nt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...n}=this._options;const r=new Z(i);let o;s=e(this._ac.signal,r.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function h(){o&&clearInterval(o),u=!0}const _=new C;return o=setInterval(async()=>{let e,o,d;try{if([e,o,d]=await t(r?{signal:r}:{}),u||!l(a)&&a>=d)return;l(d)||(a=d),n&&n(e,o,d),c=0}catch(t){return i&&i(t),c++,void(c>s&&(h(),_.error(t)))}_.update(e,o),o&&h()},e),r&&r.addEventListener&&r.addEventListener("abort",()=>{h(),_.abort(r.reason)}),_}(async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]},{interval:t,signal:s,onResponse:(t,e)=>{e?r.clear():this._isUpdated(o,t)&&r.touch(),o=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||ot(t.answer)!==ot(e.answer)||ot(t.reasoning)!==ot(e.reasoning)}_revisionOf(t){return t&&t.revision}}class rt extends nt{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}function ot(t=""){return t.length}const{GROUP:at,NAME:ct}=n;class lt extends tt{constructor(t){super(t,at.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new ut(this,t,e);const s=await this._run(ct.QUESTIONS,t,e);return new ut(this,s,e)}async _questions(t,e){return this._run(ct.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${ct.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(ct.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(ct.TRENDING_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(ct.SEARCH,t,e);return s.question_id?new ht(this,s,e):s}async _searchGet(t,e){return this._run(`${ct.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(ct.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(ct.SEARCH_AUTOCOMPLETE,t,e)}}class ut extends rt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class ht extends rt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),h(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:_t,NAME:dt}=n;class pt extends tt{constructor(t){super(t,_t.SEARCH)}async search(t,e){return this._run(dt.SEARCH,t,e)}async autocomplete(t,e){return this._run(dt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(dt.MGET,t,e)}}const{GROUP:mt,NAME:ft}=n;class gt extends tt{constructor(t){super(t,mt.RECOMMENDATION)}async userToProducts(t,e){return this._run(ft.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(ft.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(ft.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(ft.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(ft.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(ft.PRODUCT_TO_PRODUCTS,t,e)}}class yt extends V{constructor(t,e){super("api",t),this._client=t,this.helpers=new X(t,e),this.interactions=new it(this),this.ask=new lt(this),this.search=new pt(this),this.recommendation=new gt(this)}}var bt=Object.freeze({__proto__:null,Api:yt,ApiBase:tt,ApiHelpers:X,Interactions:it,Ask:lt,Search:pt,Recommendation:gt});class wt extends V{constructor(t){super("context",t),this._client=t}}var vt={api:bt,context:{Context:wt}};class Et{constructor(t){h(this,{install:t})}}class St extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new kt(this,vt),this.plugins=new Ot(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new x);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return h(i,{id:t}),this._tryConfig(i,e),i;case"function":return new Et(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new Q).get(s);!this.isRegistered(t)&&this.register(i)}}class kt{constructor(t,e){u(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),h(this,{classes:e})}}class Ot{constructor(t){u(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const It=new class extends V{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new St(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=t,this._cmdRes=new x}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Tt=Object.freeze({__proto__:null,viewable:v,debounce:L});const{currentScript:xt}=document;class Ct extends V{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Ct),window.MisoClient?window.MisoClient!==Ct&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Ct}static debug(){}constructor(t){super("client",It),this._config(t),this.context=new wt(this),this.api=new yt(this,It),function(t){It._clients.push(t),It._events.emit("create",t)}(this)}get version(){return Ct.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,c(t)}_readConfigFromScriptUrl(){return c({apiKey:new URL(new Request(xt.src||xt.href).url).searchParams.get("api_key")||void 0})}}Ct.helpers=Tt,h(Ct,{uuid:S()});var At=function(t){const e=It._pluginRoot;return It.MisoClient=e.MisoClient=t,u(t,It,["version","instances","any","meta","on","once","cmdDone"]),u(t,e,["plugins"]),t}(Ct);const{GROUP:Rt,NAME:Nt}=n;let $t;class Pt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||$t||($t=k("miso_anonymous_id",S))}set anonymous_id(t){t=a(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=a(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Lt(){const t=new URLSearchParams(window.location.search);let e=c({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Ut{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function qt(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=S()),{...e,context:{...s,custom_context:i}}}const jt="std:native-fetch";let Dt,zt;const Ft=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Dt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Dt="borrowed",t.contentWindow.fetch}catch(t){zt=t}})();const Mt="miso-logdump",Bt="miso-logdump",Qt=Bt+"__download-btn",Gt="Miso Log";class Ht{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Yt||(Yt=N($("logdump")))}();let t=document.getElementById(Mt);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Gt,e.classList.add(Qt),e.addEventListener("click",()=>this.download()),t=document.createElement("div"),t.id=Mt,t.classList.add(Bt),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Mt),e=t&&t.querySelector("."+Qt);e&&(e.textContent=this._options.logDownloadButtonText||Gt)}hideDownloadButton(){const t=document.getElementById(Mt);t&&(t.style.display="none")}download(){const t=new Blob([Vt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Wt()})}return t&&"string"==typeof t?t:`miso-log.${Wt()}.jsonl`}clear(){this._logs=[]}}function Wt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Vt(t){return t.map(t=>JSON.stringify(U(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Kt(t[e-1])]}return t}(t),{depth:10}))).join("\n")}function Kt(t){return t?U(t,{depth:2}):t}let Yt;const Zt="std:debug";function Jt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function Xt(t,e){return Object.freeze({...t,...e,members:te(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function te(t=[],e=[]){return[...new Set([...t,...e])]}function ee(t,e){let s={};for(const i of t)i&&(s=e(s,i));return c(s)}function se(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function ie(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...ne("_meta",s,i)})});var s,i})}function ne(t,e,s){const i=e&&e[t],n=s&&s[t],r=i?n?{...i,...n}:i:n;return void 0!==r?{[t]:r}:{}}At.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Ht(t)}static get id(){return Zt}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Zt,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",t=>this._injectComponents(t,e)),t.on("subtree",s=>this._injectComponents(s,e.concat(t.meta.path))),t.on("*",(s,i)=>this._handleEvent(t,i,s,e))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,n="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Jt)):this._log(t,e,Jt(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter(t=>t).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return jt}install(t,e){Ft?(e.setCustomFetch(Ft),t.debug(`<plugin:${jt}>`,"[info]",`Using ${Dt} native fetch`)):t.debug(`<plugin:${jt}>`,"[error]","Failed to obtain native fetch: "+zt.message)}}),At.plugins.use(class extends V{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Pt(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===Rt.INTERACTIONS&&s===Nt.UPLOAD?this._modifyPayloadForInteractions(t,i):e===Rt.ASK&&s===Nt.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=c({anonymous_id:s,user_id:i});return{data:e=e.map(t=>({...n,...t}))}}}),At.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map(t=>({...t,context:{...c({page:c({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Lt()}),...t.context}}))}}}),At.plugins.use(class extends V{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Ut(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:n,payload:r}){if(e===s.SEARCH)if(n===i.SEARCH)this._captureSearchApiRequest(t,r)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),At.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(qt)}}}),At.plugins.use(class extends V{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:return!0}return!1}});const re="default",oe="_organic",ae=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ce=new Set([ae.PRODUCTS,ae.CATEGORIES,ae.ATTRIBUTES,ae.RESULTS,ae.ITEMS,ae.QUESTION,ae.ANSWER,ae.REASONING,ae.IMAGES,ae.SOURCES,ae.RELATED_RESOURCES,ae.QUERY_SUGGESTIONS,ae.RELATED_QUESTIONS,ae.AFFILIATION,ae.FACETS,ae.TOTAL]);function le(t){return ce.has(t)}const ue=new Set([ae.PRODUCTS,ae.IMAGES,ae.SOURCES,ae.RELATED_RESOURCES]);const he=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),_e=[he.IMPRESSION,he.VIEWABLE,he.CLICK,he.SUBMIT,he.FEEDBACK],de=[he.IMPRESSION,he.VIEWABLE,he.CLICK],pe=new Set(de);const me=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),fe=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function ge(t){if(0>_e.indexOf(t))throw Error("Unrecognized event type: "+t)}const ye=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function be(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,t=>"_"+t.toLowerCase()))}function we(t){if(void 0===t)return;let[e,s]=o(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function ve(t,e){return!1===(e=we(e))[0]?e:t&&e?[e[0]||t[0],Ee(t[1],e[1])]:e||t}function Ee(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Se=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function ke(t={}){t=se(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Oe(e);return t}function Oe(t={}){return t=se(t)}function Ie(t={},e={}){const s={...t};for(const[i,n]of Object.entries(e))void 0!==n&&(s[i]=_e.includes(i)?Te(t[i],n):n);return s}function Te(t={},e={}){return{...t,...e}}const xe=[{key:ye.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return c({group:s,name:t,payload:e})},merge:ie},{key:ye.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${ae.PRODUCTS}: ... }) instead`),t={...s,[ae.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[be(e)]=we(s);return i},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{for(const[s,i]of Object.entries(e))t[s]=ve(t[s],i);return t})}},{key:ye.DATA_PROCESSOR,normalize:function(t){t=o(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:ye.TRACKERS,normalize:function(t={}){t=se(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=ke(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:Ie(t[s],i));return t})}},{key:ye.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=o(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i})}},{key:ye.FILTERS,normalize:se,merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>Object.assign(t,e))}},{key:ye.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>Object.assign(t,e))}}];class Ce{constructor(){this._events=new H({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Ae{constructor(t={},e={}){this._events=new H({target:this}),this._defaults=e,this._context=t||{},this._locals={},h(this,{resolved:new Re(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",t=>this._notify(t))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Re{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class Ne{constructor(t,e,s,i,n){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=n}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of xe){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Ce.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ne(this,this._globals,e,s,i))}}),Object.defineProperty(Ae.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ne(this,this._locals,e,s,i))}}),Object.defineProperty(Re.prototype,e,{get:function(){return this._get(t)}})}const $e=[ye.API,ye.LAYOUTS,ye.DATA_PROCESSOR,ye.TRACKERS,ye.INTERACTIONS];function Pe(t,e=$e){for(const s of e)Le(t,s)}function Le(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function Ue(t={}){const{setValue:e,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:i="q",sourceParam:n="qs",...r}={}){return{setValue:t,focus:e,updateUrl:s,param:i,sourceParam:n,...r}}(t),r=new URLSearchParams(window.location.search),o=r.get(i),a=r.get(n)||void 0,{layout:l}=this._views.get(ae.QUERY);l&&(o&&e&&(l.value=o),!o&&s&&l.focus()),o&&this.query(c({q:o,qs:a}))}class qe extends V{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Ce}}function je(t){return t?"view:"+t:"view"}Pe(qe.prototype);class De{constructor(t={}){(this._events=new H)._injectSubscribeInterface(this),this._options=t,this._states={},h(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const i=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class ze{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:S(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function Fe(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Me{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",t=>this._handleSession(t)),t.on("request",t=>this._handleRequest(t))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t})}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},n={...t.options,signal:s},r=await this._source({session:e,...t,options:n});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:i,value:r._response}),r)){if(!Fe(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){Fe(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Be{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,t=>t.handler===e)}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{r(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Qe,VIEWABLE:Ge,CLICK:He}=he,{UNTRACKED:We,TRIGGERED:Ve}=me,Ke=Object.freeze({[Qe]:We,[Ge]:We,[He]:We});class Ye{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ke}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||We}set(t,e,s){ge(e),function(t){if(t!==me.UNTRACKED&&t!==me.TRACKING&&t!==me.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of o(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter(t=>this.get(t,e)!==Ve)}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),()=>({...Ke})))[e]=s}}const Ze=[Symbol("itemless")];class Je{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new Ye(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){ge(t);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:n=!0,itemless:r=!1}=i;if(n){if(r&&(e=Ze),0===(e=this._states.untriggered(o(e),t)).length)return;this._states.set(e,t,me.TRIGGERED)}this._sendToHub({type:t,items:r?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:he.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(c({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Ye(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[je(this._role)]}}for(const t of de)Je.prototype[t]=function(e,s){this._trigger(t,e,s)};function Xe(t){return t&&t.meta&&t.meta.empty}class ts{constructor(t,e){this._events=new H({target:this}),this._views=t,this._mapping=ss((t._roles.mappings||{})[e]||e),h(this,{role:e,interface:new es(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Be(()=>this.element)),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===ae.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Je({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((n=e)===(r=i)||n&&r&&n.status===r.status&&n.error===r.error&&n.value===r.value&&n.ongoing===r.ongoing&&Xe(n)===Xe(r)&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(n.session,r.session)))return;var n,r;const{session:o,status:a,ongoing:c,request:l,meta:u,value:h}=e,_={session:o,status:a,ongoing:c,request:l,meta:u,data:h,...is(this.role,e)},d=(t={},e)=>{!1!==t&&this.updateState({..._,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:d})}catch(t){this._error(t),d({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?fe.ERRONEOUS:t.status;t=this._state=Object.freeze(c({...t,status:s}));const{role:i}=this;this.hub.update(je(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:n,...r}=t,o={value:this._mapping(t,this),status:i,data:e,meta:n,...r};return this.role===ae.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(t)}),c(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!le(s))continue;if(!ns(s,ss((this._views._roles.mappings||{})[s]||s)(t,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class es{constructor(t){u(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function ss(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function is(t,e){return function(t){return t.status===fe.READY&&!t.ongoing}(e)?{empty:!!ns(t,e&&e.value)}:{}}function ns(t,e){switch(t){case ae.ANSWER:case ae.REASONING:return!e||!e.value;default:return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}}function rs(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class os{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new H({target:this,error:s}),h(this,{facets:new as(this,e)}),this._unsubscribes=[t._options.on("filters",()=>this._syncOptions())],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return c({facets:Object.freeze({}),sort:rs(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(c({...t,...e,facets:Object.freeze(c({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class as{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter(t=>t!==e);0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const cs=Symbol.for("miso:tracked");function ls(t){return!!t[cs]}function us(t){t[cs]=!0}const hs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function _s(t,e){return!!e&&{...t,...e}}class ds{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n,options:r}){this._hub=t,this._workflow=e,this._workflowName=e._name,this._extensions=s,this._layoutFactory=i,this._options=r,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new os(this);for(const t of n.members)t!==ae.CONTAINER&&(this._views[t]=new ts(this,t));h(this,{interface:new ps(this),trackers:new ms(this,n.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on("data",t=>this.refresh({data:t})),r.on("layouts",()=>this._syncLayouts())],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new ts(this,ae.CONTAINER);e.layout=this._createLayout(ae.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===ae.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);await Promise.all(s.map(s=>s.refresh({force:t,data:e})))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return c({...hs,...n,impression:_s(hs.impression,e),viewable:_s(hs.viewable,s),click:_s(hs.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=ae.CONTAINER;this._containerTracker=new Je({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class ps{constructor(t){this._actor=t,u(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map(t=>t.interface)}}class ms{constructor(t,e){this._views=t;for(const s of e)s!==ae.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,ae.CONTAINER,{get:()=>t._getContainerTracker()})}}class fs{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",t=>this._trigger(t))]}_trigger(t){this._hub.trigger("tracker",{type:he.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class gs{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",t=>this._handle(t))]}_handle(t){0!==(t=o(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ys(t){return async({group:e,name:n,payload:r,options:o})=>{if(e===s.ASK)switch(n){case i.QUESTIONS:return t.api.ask.questions(r,o);case i.SEARCH:return t.api.ask.search(r,o)}return t.api[e]._run(n,r,o)}}class bs{constructor({role:t,workflow:e,...s}={}){h(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=I(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,w(t=>this._doRaf(t)))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const n=this._rendered.get(this._element),r=I([]),o=I({});this._render(this._element,{state:s,rendered:n,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ws(...t){return t.reduce((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t),{})}function vs(t,e,s,i){const{templates:n}=t,[r,o]=js(t,s);return""+r+(n.indexBlock||Us)(t,s,i)+(n.infoBlock||n.articleInfoBlock||Os)(t,s,i)+o}function Es(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ts)(t,e,s)+(n.descriptionBlock||Cs)(t,e,s)+(n.priceBlock||$s)(t,e,s)+(n.ctaBlock||qs)(t,e,s)}</div>`}function Ss(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ts)(t,e,s)+(n.descriptionBlock||Cs)(t,e,s)+(n.priceBlock||$s)(t,e,s)}</div>`}function ks(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ts)(t,e,s)+(n.dateBlock||As)(t,e,s)+(n.descriptionBlock||Cs)(t,e,s)+(n.ctaBlock||qs)(t,e,s)}</div>`}function Os(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ts)(t,e,s)+(n.authorsAndDateBlock||Ns)(t,e,s)}</div>`}function Is(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Ts)(t,e,s)}</div>`}function Ts({className:t},{title:e,_title_with_markups:s}){const i=Ms(s)||E(e);return i?`<div class="${t}__item-title">${i}</div>`:""}function xs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Cs({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${Ms(e)}</div>`:s?`<div class="${t}__item-desc">${E(s)}</div>`:""}function As({className:t,templates:e},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${t}__item-date">${Fs(r,e.date)}</div>`:""}function Rs({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function Ns(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-authors-and-date-container">${""+(n.authorsBlock||Rs)(t,e,s)+(n.dateBlock||As)(t,e,s)}</div>`}function $s(t,e){const{className:s,templates:i}=t,{sale_price:n,original_price:r,currency:o="USD"}=e,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,l=e.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Ps)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function Ps(t,{discount_rate_percent:e}){return`(${e}% off)`}function Ls(t,e,s={}){const{className:i,templates:n}=t,{cover_image:r,image_src:o,image_alt:a}=e;if(!r&&!o)return"";const c=o?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${o}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(n.brandBlock||xs)(t,e,s):""}</div>`}function Us({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function qs(t,e,s){const{className:i,templates:n}=t,r=Bs.asFunction(n.cta)(t,e,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function js({className:t,options:e={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const a=!1!==o.link&&i?"a":"div";return[`<${a} class="${t}__${n}" ${r?`data-role="${r}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==o.link&&i?`href="${i}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:i=!0}=t;let n="";i&&(e&&(n+=` target="${e}"`),s&&(n+=` rel="${s}"`));return n}(e.link)}`:""}>`,`</${a}>`]}const Ds=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),zs="en-US";function Fs(t,e=Ds){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Ds.locale,e);default:throw Error("Invalid date format: "+e)}}function Ms(t){return t&&t.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Bs=Object.freeze({tagPair:js,formatDate:Fs,formatNumber:function(t,e=zs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||zs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},formatHtmlWithMarkup:Ms,escapeHtml:E,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Qs extends bs{constructor({className:t,templates:e,...s}={}){super(s),h(this,{className:t,templates:{...ws("root"),...e,helpers:Bs}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Gs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Gs.MisoClient.ui.layouts.create("banner").render(this)}}class Hs{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let n=!1;try{await v(t,{...e,signal:i}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return n}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Ws extends bs{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Hs}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Gs.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some(({role:t})=>function(t){return t===ae.PRODUCTS||t===ae.ANSWER}(t)):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1,unanswerable:o=!1}={}}=e,a=[s,r?fe.EMPTY:fe.NONEMPTY];s===fe.READY&&a.push(i?fe.ONGOING:fe.DONE),o&&a.push(fe.UNANSWERABLE),t.setAttribute("status",a.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===fe.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Vs=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Ks extends Qs{static get type(){return"error"}static get defaultTemplates(){return Vs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Vs,...e},...s})}}const Ys=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Zs(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class Js{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,n=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],l=Object.freeze({index:o,key:a,value:e[o],element:c});i.set(a,l),n.set(c,l),r.push(l)}return{k2b:i,e2b:n,entries:r}}(t,e,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Zs(n,i),o=Zs(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function Xs(t){j(t,ti.prototype)}class ti{_initTrackable(){this._bindings=new Js,this._viewables=new Hs}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map(t=>this._getItemKey(t)),n=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map(({value:t})=>t))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!ls(e)&&0===e.button&&!e.defaultPrevented&&!!y(e.target,t=>"A"===t.tagName&&t.href||void 0))})(s,t)&&(us(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class ei{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===fe.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await v(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const si=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=js(t,s);return""+r+(n.imageBlock||Ls)(t,s,i)+(n.infoBlock||n.productInfoBlock||Ss)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=js(t,s);return""+r+(n.imageBlock||Ls)(t,s,i)+(n.infoBlock||n.articleInfoBlock||ks)(t,s,i)+(n.indexBlock||Us)(t,s,i)+o},compactArticle:vs,image:function(t,e,s,i){const{templates:n}=t,[r,o]=js(t,s);return""+r+(n.imageBlock||Ls)(t,s,i)+(n.infoBlock||n.imageInfoBlock||Is)(t,s,i)+o},question:function(t,e,s){const[i,n]=js(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n,options:r}=t,{status:o}=e;return`<div class="${s} ${o}"${i?` data-role="${i}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${o===fe.READY?n[o](t,e):""}${n.trigger(t,e)}${n.loading(t,e)}</div>`},[fe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e)||[];return i.length>0||e.ongoing?s.body(t,e,i):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map(s=>n.item(t,e,s,r++)).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`},productInfoBlock:Ss,articleInfoBlock:ks,compactArticleInfoBlock:Os,imageInfoBlock:Is,brandBlock:xs,titleBlock:Ts,descriptionBlock:Cs,dateBlock:As,authorsBlock:Rs,authorsAndDateBlock:Ns,priceBlock:$s,discountRateText:Ps,ctaBlock:qs,cta:function(t,e,s){const{templates:i}=t,{url:n}=e;if(!n)return"";const[r,o]=js(t,{url:n},{classSuffix:"item-cta",role:"cta"}),a=Bs.asFunction(i.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Ls,indexBlock:Us,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class ii extends Qs{static get defaultTemplates(){return si}constructor({templates:t,itemType:e="product",...s}){super({templates:{...si,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:n}=e;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Xs(ii.prototype),j(ii.prototype,ei.prototype);const ni="miso-list";class ri extends ii{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ni}constructor({className:t=ni,...e}={}){super({className:t,...e})}}const oi="miso-horizontal";class ai extends ii{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return oi}constructor({className:t=oi,...e}={}){super({className:t,...e})}}const ci="miso-cards";function li(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function ui(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function hi(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),i=e[2]||"";return[s,i]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function _i(t){return void 0===t||t instanceof di?t:new di(t)}class di{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=_i(t),_i([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class pi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,w(()=>this._syncDisplayedSwipeableItemIndex()))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),i=e.itemCount,n=e.itemCount=s?s.length:void 0;n!==i&&(void 0===n?e.itemIndex=void 0:void 0===i&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(li(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let i=0;for(const e of s.children)ui(e,"active",i===t),i++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const mi="miso-ui-icon",fi=mi+"-svg-1_12_1",gi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},yi=`<symbol id="${mi}-${gi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,bi=`<symbol id="${mi}-${gi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,wi=`<symbol id="${mi}-${gi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,vi=`<svg id="${fi}" style="display:none;">${[yi,bi,wi,`<symbol id="${mi}-${gi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${mi}-${gi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${mi}-${gi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${mi}-${gi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let Ei=!1;function Si(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${mi}-${t}"></use></svg>`}Ei||document.head.querySelector("#"+fi)||(Ei=!0,document.head.insertAdjacentHTML("beforeend",vi));const ki=new Set(Object.values(gi));Si(gi.SEND),Si(gi.SEARCH);const Oi=Si(gi.TRIANGLE);Si(gi.TRIANGLE_EQ);const Ii=Si(gi.CHEVRON),Ti=Si(gi.CHEVRON_NEGATIVE),xi=Si(gi.BULB),Ci="miso-carousel",Ai=Object.freeze({body:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${n.list(t,e,s)}</div></div>${n.controls(t,e,s)}`},controls:function(t,e,s){const{templates:i}=t;return`${i.controlContainer(t,e,"previous")}${i.controlContainer(t,e,"next")}${i.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-container-${s}">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?Ti:Ii},indexIndicator:function(t,e,s){const{className:i,templates:n}=t;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map(s=>`<li class="${i}__index-indicator-item">${n.indexIndicatorItem(t,e,s)}</li>`).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Ri=Object.freeze({...ii.defaultTemplates,...Ai});class Ni extends ii{static get type(){return"carousel"}static get defaultTemplates(){return Ri}static get defaultClassName(){return Ci}constructor({className:t=Ci,templates:e,...s}={}){super({className:t,templates:{...Ai,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){j(t,pi.prototype)}(Ni.prototype);const $i="16rem",Pi=Object.freeze({...ii.defaultTemplates,item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o,c=r[a](t,e,s,{index:i});return`<li class="${n}__item${s._size?` ${n}__item-${s._size}`:""}">${c}</li>`}}),Li="miso-gallery";class Ui extends ii{static get type(){return"gallery"}static get defaultTemplates(){return Pi}static get defaultClassName(){return Li}constructor({className:t=Li,templates:e,...s}={}){super({className:t,templates:{...Pi,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=s?void 0:this._bodyHtml(t),n=this._itemsHtml(t,e);return{...t,...c({incremental:s,bodyHtml:i,itemsHtml:n})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const i=this._renderListElement(t,e,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:i}=e;return s||(t.innerHTML=i),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,i)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const i=t.children.length,n=this._writeItemSizes((this._getItems(e)||[]).slice(i),s,i);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,n,{offset:i}))}_writeItemSizes(t,[e=0,s=0]=[],i=0){let n=0;i>0&&(n=Math.min(i,e),i-=n,e-=n),i>0&&(n=Math.min(i,s),i-=n,s-=n);const r=[];for(const i of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),r.push({...i,_size:t})}return r}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=_i(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:i}=e,{height:n=$i}=this.options,r=hi(n),o=t.clientWidth;if(0===o)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(o*i.width*2/(r*i.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),i=t;const n=Math.min(Math.floor(s/3),i);i-=n,s-=3*n;const r=Math.min(s,i);return i-=r,s-=r,[n,r,i]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,i=0]=e;const{className:n}=this;for(const e of t.children){let t=!1,r=!1;s>0?(t=!0,s--):i>0&&(r=!0,i--),ui(e,n+"__item-large",t),ui(e,n+"__item-medium",r),ui(e,n+"__item-small",!t&&!r)}}}const qi="miso-search-box";const ji=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:n,autocomplete:r}=t,{placeholder:o}=n;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=e;var r;return("function"==typeof i?i(t):""+i)+("function"==typeof n?n(t):(ki.has(r=n)?Si(r):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:n}=t;t={templates:s,workflow:i,...n};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:i,templates:n}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map(s=>n.completionItem(t,e,s)).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:n}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${n[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||E(e)},product:function(t,{product:e}){const{templates:s}=t,[i,n]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+n},imageBlock:Ls,productInfoBlock:Ss}),Di=Object.freeze({className:"miso-autocomplete",debounce:300});class zi extends Qs{static get type(){return"search-box"}static get defaultTemplates(){return ji}static get defaultClassName(){return qi}constructor({className:t=qi,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...ji,...e},...i}),h(this,{autocomplete:{...Di,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=L(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",t=>this._syncInput(t)),e.on("keydown",t=>this._handleKeyDown(t)),e.on("click",t=>this._handleClick(t)),e.on("focusin",t=>this._handleFocusIn(t)),e.on("focusout",t=>this._handleFocusOut(t)),s.on("completions",()=>t.refresh({force:!0}))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:n=fe.INITIAL,session:r,value:o}=e.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(o);ui(t,"nonempty",u.length>0),l.setAttribute("data-status",n),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:n}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Fi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Fi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce(()=>s._view.hub.update("input",{value:e}))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&y(t,t=>t===this._element||void 0)||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),n=this._context().data.get(parseInt(e)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[he.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Fi{static empty(){return Fi._empty||(Fi._empty=new Fi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const n in t)for(const r of t[n])r.product&&!r.product.url||(r._index=e,r._field=n,s.set(e,r),i.push(r),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Mi="miso-option-list";const Bi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map((e,s)=>i.option(t,e,{index:s})).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${E(e.text||e)}</li>`}});class Qi extends Qs{static get type(){return"option-list"}static get defaultTemplates(){return Bi}static get defaultClassName(){return Mi}constructor({className:t=Mi,templates:e,...s}={}){super({className:t,templates:{...Bi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;ui(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}Xs(Qi.prototype);const Gi=Object.freeze({...ws("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Hi extends Qs{static get defaultTemplates(){return Gi}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...Gi,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,()=>this._refresh()),e.on("click",t=>this._handleClick(t))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=y(t,t=>t.hasAttribute("data-value")?t:void 0);if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],w(()=>this._syncValueAttribute())}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Wi="miso-feedback",Vi=["helpful","unhelpful"];const Ki=Object.freeze({options:function(t){const{templates:e}=t;return Vi.map(s=>e.option(t,{value:s})).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Yi extends Hi{static get type(){return"feedback"}static get defaultTemplates(){return Ki}static get defaultClassName(){return Wi}constructor({className:t=Wi,templates:e,...s}={}){if(super({className:t,templates:{...Ki,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Zi="miso-text";const Ji=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:n=!1,tag:r}}=t,o=i?`data-role="${i}"`:"",a=void 0!==e?E(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[n,r]=e;switch(n){case"date":return t=>s(t,r);case"number":return t=>i(t,r);default:return t=>""+t}}(t)(e)):"";return n?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Xi extends Qs{static get type(){return"text"}static get defaultTemplates(){return Ji}static get defaultClassName(){return Zi}constructor({className:t=Zi,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Ji,...e},tag:s,...i})}}class tn extends bs{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=I(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class en{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),l=!i.startsWith(c);return a||l?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function sn(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,nn(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||fe.INITIAL),i}function nn(t){return t+"__cursor"}function rn(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:n,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${on(i[0])}, ${on(i[1])})`,e,""+r,n,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function on(t){return Math.floor(100*t)/100+"ms"}const an="miso-typewriter";class cn extends tn{static get type(){return"typewriter"}static get defaultClassName(){return an}constructor({className:t=an,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:i,...a}),h(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:z({speed:n,acceleration:r}),this._readiness=new x,"markdown"===s&&cn.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=nn(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:rn(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",t=>this._onClick(t)))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new en}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:{value:s="",stage:i,finished:n}={},session:r,status:o}=t,a=(u=t,(l=e)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const h=e?a&&i===e.stage?e.streak:e.streak+1:0,_=a&&e&&e.doneAt||(o===fe.READY&&n?performance.now():void 0);return this._prevState=Object.freeze(c({session:r,status:o,value:s,stage:i,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=sn(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}n(a);const l=e.status===fe.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===fe.READY)&&!c}),l&&r()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const i=e.closest("a");if(i){if(!t.defaultPrevented){const{href:e,innerText:s,className:n}=i;e&&this._view._events.emit("link-click",c({event:t,url:e,text:s?s.trim():"",className:n||"",attributes:ln(i)}))}}else;}}function ln(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const un="miso-affiliation";const hn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n,options:r}=t,{status:o}=e,a=i?` data-role="${i}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),h=u?u.length:void 0;return`<div class="${s} ${o}"${a}${l}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${o===fe.READY?n[o](t,e):""}</div>`},[fe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}-container">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Oi},body:function(t,e){const{className:s,templates:i}=t,n=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,n)}</div>`},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(t,e,s,{index:i})}${r[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:n,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=Bs.asFunction(o)(t,e,s,i),a=Bs.asFunction(a)(t,e,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:n}=t,[r,o]=js(t,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||Es)(t,s,i)+(n.imageBlock||Ls)(t,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:n,templates:r}=t,o=Bs.asFunction(r.logoText)(t,e,s,i)||"",a=Bs.asFunction(r.logoImg)(t,e,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:n,templates:r}=t,o=Bs.asFunction(r.logoUrl)(t,e,s,i);if(!o)return"";const a=Bs.asFunction(r.logoAltText)(t,e,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),_n=Object.freeze({...ii.defaultTemplates,...hn});class dn extends ii{static get type(){return"affiliation"}static get defaultTemplates(){return _n}static get defaultClassName(){return un}constructor({className:t=un,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...hn,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Y(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,w(()=>this._syncItemIndex()))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(li(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const pn="miso-facets",mn="miso-facet",fn="custom_attributes.";const gn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map(n=>s.facet(t,{field:n,entries:i[n]},e))},facet:function(t,e,s){const{facetClassName:i=mn,templates:n}=t,{field:r}=e;return`<div class="${i}" data-role="facet" data-field="${E(r)}">${n.header(t,e,s)}${n.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=mn,templates:n}=t;return`<div class="${i}__header">${n.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(fn)&&(e=e.substring(18)),E(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:n=mn,templates:r}=t;return`<ul class="${n}__options" data-role="options">${s.map(([s,n])=>r.option(t,{field:e,value:s,count:n},i)).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=mn,templates:n}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(t,e,s)}</span>\n  <span class="${i}__count">${n.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return E(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function yn(t,e){return`${t}:::${e}`}function bn(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class wn extends Qs{static get type(){return"facets"}static get defaultTemplates(){return gn}static get defaultClassName(){return pn}constructor({className:t=pn,templates:e,...s}={}){super({className:t,templates:{...gn,...e},...s}),this._bindings=new Js}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t)),s.on("update",t=>this._updateSelections(t)),s.on("reset",()=>this._syncSelections())]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=bn(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=bn(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],n=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;i.push(yn(t,c)),n.push({field:t,value:c}),r.push(s)}}this._bindings.update(i,n,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[E(t)]=e[t].map(([t])=>t);return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:n,value:r}=i;this._view.filters.facets.toggle(n,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const vn="miso-select";const En=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,r=i?`data-role="${i}"`:"",o=t._getItems(e),a=o.find(t=>t.selected)||o[0];return`\n<div class="${s}" ${r}>\n  ${n.button(t,a)}\n  ${n.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map((e,s)=>i.option(t,e,{index:s})).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return E(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,(t,e)=>" "+e)||e||"")}});class Sn extends Qs{static get type(){return"select"}static get defaultTemplates(){return En}static get defaultClassName(){return vn}constructor({className:t=vn,templates:e,...s}={}){super({className:t,templates:{...En,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}Xs(Sn.prototype);const kn="miso-more-button";const On=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==fe.READY?" disabled":""}>\n  ${n.text(t)}\n</div>\n`},text:function(t){return"More"}});class In extends Qs{static get type(){return"more-button"}static get defaultTemplates(){return On}static get defaultClassName(){return kn}constructor({className:t=kn,templates:e,...s}={}){super({className:t,templates:{...On,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",t=>this._handleClick(t))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var Tn=Object.freeze({__proto__:null,TemplateBasedLayout:Qs,ContainerLayout:Ws,ErrorLayout:Ks,BannerLayout:class extends Qs{static get type(){return"banner"}static get defaultTemplates(){return Ys}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Ys,...e},...s})}},CollectionLayout:ii,ListLayout:ri,HorizontalLayout:ai,CardsLayout:class extends ii{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ci}constructor({className:t=ci,...e}={}){super({className:t,...e})}},CarouselLayout:Ni,GalleryLayout:Ui,SearchBoxLayout:zi,OptionListLayout:Qi,FeedbackLayout:Yi,TextLayout:Xi,TypewriterLayout:cn,AffiliationLayout:dn,FacetsLayout:wn,SelectLayout:Sn,MoreButtonLayout:In});function xn(t){return t&&t.value&&t.value.revision}function Cn(t){const e=function(t){if(!t)return fe.INITIAL;const{request:e,error:s,value:i}=t;return s?fe.ERRONEOUS:i?fe.READY:e?fe.LOADING:fe.INITIAL}(t);return c({status:e,ongoing:e===fe.READY?t.ongoing:void 0,...t})}function An(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:i}=s;i&&(e.meta.miso_id=i)}function Rn(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:n}=i||{};return n?{...t,value:{...s,keywords:n}}:t}function Nn(t){const{role:e,type:s,items:i}=t,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:c({property:e})}};switch(function(t){return pe.has(t)}(s)&&(!function(t){return ue.has(t)}(e)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map(t=>t.text||t.id||t)):n.product_ids=(i||[]).map(t=>"string"==typeof t?t:t.product_id).filter(t=>t)),s){case he.SUBMIT:n.context.custom_context.value=t.value;break;case he.FEEDBACK:n.context.custom_context.value=n.value=t.value,n.context.custom_context.result_type=n.result_type=t.result_type}return c(n)}function $n(t={},e={}){return c({...t,...e,context:c({...t.context,...e.context,custom_context:c({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const Pn=Object.freeze({}),Ln=Object.freeze({[ae.CONTAINER]:Ws.type,[ae.ERROR]:Ks.type}),Un=Object.freeze({}),qn=Object.freeze({api:Pn,layouts:Ln,trackers:Un}),jn=Object.freeze({mappings:{[ae.ERROR]:t=>t.error}});class Dn extends V{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:n,options:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=r||new Ae(e&&e._options,n),this._hub=new De({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({roles:t}){const e=this._hub,s=this._client,i=this._options,n=this._extensions,r=this._plugin.layouts;this._sessions=new ze(e),this._data=new Me(e,{source:ys(s),options:i}),this._views=new ds(e,{extensions:n,layouts:r,roles:t,options:i,workflow:this}),this._interactions=new gs(e,{client:s,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",t=>this.updateData(t)),this._hub.on("tracker",t=>this._onTracker(t))],t.main&&this._unsubscribes.push(this._hub.on(je(t.main),t=>this._onMainViewUpdate(t)))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:i}){i||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[je(t)]||{};e.session&&e.status===fe.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===fe.READY,i=e===fe.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(t);return i.add(t),!n}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=ie(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=xn(t);if(!l(s)){const t=xn(this._hub.states.data);if(!l(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=Cn(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:fe.READY,session:this.session,...e},this._hub.update(je(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=Nn(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==ae.AFFILIATION)return t;const{items:s}=e;return $n(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map(t=>t.position)}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return $n(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[je(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?$n(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function zn(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Fn(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map(t=>({...t}));let n=0;for(const t of i)s&&(t.channel=s),t.position=n++;return{...t,affiliation:{...e,products:i}}}(t)}function Fn({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Mn)}}function Mn({id:t,deeplink:e,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:l,thumbnail:u,merchant:h,..._}){return c({id:"sovrn-"+t,title:s,description:i,cover_image:l,url:e,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:Bn({sovrn_id:t,thumbnail:u,merchant:h,..._})})}function Bn(t,e=""){return Object.keys(t).reduce((s,i)=>{const n=t[i];if(void 0===n)return s;const r=e?`${e}_${i}`:i;return"object"==typeof n?{...s,...Bn(n,r)}:{...s,[r]:n}},{})}function Qn(t){j(t,Gn.prototype)}Pe(Dn.prototype),Object.assign(Dn,{DEFAULT_API_OPTIONS:Pn,DEFAULT_LAYOUTS:Ln,DEFAULT_TRACKERS:Un,DEFAULT_OPTIONS:qn,ROLES_OPTIONS:jn});class Gn{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Hn=Object.freeze({...Dn.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Dn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Wn=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),Vn=Object.freeze({...Dn.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{placeholder:"Ask a question"}],[ae.QUESTION]:[Xi.type,{tag:"h2"}],[ae.ANSWER]:cn.type,[ae.FEEDBACK]:Yi.type,[ae.IMAGES]:[Ui.type,{incremental:!0,itemType:"image"}],[ae.SOURCES]:[ri.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[ae.AFFILIATION]:[dn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Kn=Object.freeze({...Dn.DEFAULT_TRACKERS,[ae.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Se.click},[ae.IMAGES]:Se,[ae.SOURCES]:Se,[ae.AFFILIATION]:Se,[ae.PRODUCTS]:Se}),Yn=Object.freeze({...Dn.DEFAULT_OPTIONS,api:Hn,autocomplete:Wn,layouts:Vn,trackers:Kn}),Zn=Xt(Dn.ROLES_OPTIONS,{main:ae.ANSWER,members:Object.keys(Vn),mappings:{[ae.ANSWER]:function(t){if(!t||!t.value)return;const{answer:e="",answer_stage:s,finished:i}=t.value;return Object.freeze({value:e,stage:s,finished:!!i})},[ae.REASONING]:function(t){if(!t||!t.value)return;const{reasoning:e="",reasoning_finished:s}=t.value;return Object.freeze({value:e,stage:"reasoning",finished:!!s})}}});class Jn extends Dn{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new fs(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._views.get(ae.ANSWER).on("citation-click",t=>this._onCitationClick(t)),this._views.get(ae.ANSWER).on("link-click",t=>this._onAnswerLinkClick(t))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[je(this._roles.main)]||{};t.session&&t.status!==fe.INITIAL&&(t.status!==fe.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===fe.READY&&!t.ongoing,n=e===fe.ERRONEOUS,r=i?"done":n?"error":e,o=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,t),(i||n)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){Ue.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||oe}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:zn(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_updateUrlIfNecessary({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,n=t&&t.question||e&&e.payload&&e.payload.question,r=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source;if(!n)return;const o=new URL(window.location),a=o.searchParams.get(s),c=o.searchParams.get(i)||oe;n===a&&r===c||(o.searchParams.set(s,n),r===oe?o.searchParams.delete(i):o.searchParams.set(i,r),window.history.replaceState({},"",o))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=function(t,{event_target:e}={}){return e?$n(t,{context:{custom_context:{event_target:e}}}):t}(t=this._writeAnswerClickInteraction(t,e),e)}_writeAskPropertiesToInteraction(t={},e){return $n(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==ae.ANSWER)return t;const{items:s=[]}=e;return $n(t,{context:{custom_context:{urls:s.map(t=>t.url),texts:s.map(t=>t.text),class_names:s.map(t=>t.className),attributes:s.map(t=>t.attributes)}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[je(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t,event:e}){if(ls(e))return;const{value:s}=this.states.data||{},{sources:i}=s||{},n=i&&i[t-1];n&&n.product_id&&(us(e),this._views.trackers.sources.click([n.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){ls(t)||(us(t),this._views.trackers.answer.click([],{items:[e]}))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Qn(Jn.prototype),Object.assign(Jn,{DEFAULT_API_OPTIONS:Hn,DEFAULT_AUTOCOMPLETE_OPTIONS:Wn,DEFAULT_LAYOUTS:Vn,DEFAULT_TRACKERS:Kn,DEFAULT_OPTIONS:Yn,ROLES_OPTIONS:Zn});const Xn=Object.freeze({...Jn.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...Jn.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),tr=Object.freeze({...Jn.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{templates:{buttonIcon:"send"}}],[ae.REASONING]:cn.type,[ae.RELATED_RESOURCES]:[ri.type,{incremental:!0,itemType:"article"}],[ae.QUERY_SUGGESTIONS]:Qi.type}),er=Object.freeze({...Jn.DEFAULT_TRACKERS,[ae.RELATED_RESOURCES]:Se,[ae.QUERY_SUGGESTIONS]:{...Se,click:{...Se.click,validate:t=>0===t.button}}}),sr=Object.freeze({...Jn.DEFAULT_OPTIONS,api:Xn,layouts:tr,trackers:er}),ir=Xt(Jn.ROLES_OPTIONS,{members:Object.keys(tr),mappings:{[ae.QUERY_SUGGESTIONS]:function(t,{workflow:e}={}){const s=e.previous,i=s&&s.states.data.value,n=i&&(i.suggested_followup_questions||i.followup_questions||[]);return n&&n.map(t=>({text:t}))}}});class nr extends Jn{constructor(t,e){super({name:"ask",context:t,roles:ir,defaults:sr,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;h(this,{parentQuestionId:e})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on(je(ae.REASONING),t=>this._onReasoningViewUpdate(t))]}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:i}=this;let n=c({...s,question:t,parent_question_id:i,_meta:{...s._meta,question_source:e||oe}});return n=this._writeWikiLinkTemplateToPayload(n),n}_updateData(t){super._updateData(t),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:t}=this;if(!t)return;const e=t._views.get(ae.QUERY_SUGGESTIONS);e&&e.refresh()}_onReasoningViewUpdate({status:t,ongoing:e}){if(t!==fe.READY||e)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,n,r,{property:o}=t.context&&t.context.custom_context||{};return e.role===ae.QUERY_SUGGESTIONS?(o="suggested_followup_questions",n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,r=this._getQuestionSourceFromViewState(e)),$n(t,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:n,question_id:i,question_source:r}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const t=this._views.get(ae.REASONING),e=t&&t.element;return e&&e.closest('[data-role="reasoning-box"]')}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class rr extends qe{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new nr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new nr(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const or=Object.freeze({...Dn.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Dn.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),ar=Object.freeze({...Dn.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type],[ae.PRODUCTS]:[ri.type,{incremental:!0,infiniteScroll:!0}],[ae.KEYWORDS]:[Xi.type,{raw:!0}],[ae.TOTAL]:[Xi.type,{raw:!0,format:"number"}],[ae.FACETS]:[wn.type],[ae.SORT]:[Sn.type],[ae.MORE]:[In.type]}),cr=Object.freeze({...Dn.DEFAULT_TRACKERS,[ae.PRODUCTS]:Se}),lr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),ur=Object.freeze({...Dn.DEFAULT_OPTIONS,api:or,layouts:ar,trackers:cr,pagination:lr}),hr=Xt(Dn.ROLES_OPTIONS,{main:ae.PRODUCTS,members:Object.keys(ar),mappings:{[ae.FACETS]:"facet_counts",[ae.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=e.states.filters||{},r=n&&n.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return r?i.map(t=>({...t,selected:t.field===r})):i}}});class _r extends Dn{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._hub.on("filters",()=>this._refine()),this._hub.on("more",()=>this._more()),this._views.get(ae.SORT).on("select",t=>this._handleSortSelect(t))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){Ue.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this._views.filters.reset({silent:!0}),this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==fe.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return c({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return o(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map(t=>t.product_id).filter(t=>t),n=[...t.exclude||[],...i];return 0===n.length?t:{...t,exclude:n}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case fe.INITIAL:case fe.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=Rn(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=ae.PRODUCTS}={}){const{status:s,request:i,value:n}=t;if(s!==fe.READY||!i||!n)return t;const{[e]:r}=n;if(!r)return t;const{rows:o}=i.payload,{length:a}=r;return o>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=ae.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:n,total:r}=t.value,{[s]:o=[]}=e.value;return{...e,value:{...e.value,facet_counts:n,total:r,[s]:[...i,...o]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}Pe(_r.prototype,[ye.PAGINATION,ye.FILTERS]),Object.assign(_r,{DEFAULT_API_OPTIONS:or,DEFAULT_LAYOUTS:ar,DEFAULT_TRACKERS:cr,DEFAULT_PAGINATION:lr,DEFAULT_OPTIONS:ur,ROLES_OPTIONS:hr});const dr=Object.freeze({members:[]});function pr({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function mr(t){return t&&t.value&&t.value.trim()||void 0}class fr extends Dn{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:pr(e),roles:dr,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",t=>this._query(t))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,mr(t)===mr(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!mr(t))return void this._updateCompletions({session:s,status:fe.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:mr(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function gr(t){j(t,yr.prototype)}class yr{_initAutocomplete(t){this._autocomplete=new fr(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const br=Xt(Jn.ROLES_OPTIONS,{mappings:{[ae.QUESTION]:ae.KEYWORDS}});class wr extends Jn{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:br,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset({silent:!0}),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._writeWikiLinkTemplateToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||oe}}}_defaultProcessData(t){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:i}={}}=e;return i?{...t,meta:{...t.meta,miso_id:i}}:t}(t=Rn(t=super._defaultProcessData(t))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_updateDataInHub(t){switch(t.status){case fe.INITIAL:case fe.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),An(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}gr(wr.prototype);const vr={..._r.ROLES_OPTIONS,members:[ae.PRODUCTS,ae.KEYWORDS,ae.TOTAL,ae.FACETS,ae.SORT,ae.MORE,ae.ERROR]};class Er extends _r{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:vr,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:c({...t._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(t){return An(t=super._defaultProcessData(t)),t}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}}Object.assign(Er,{ROLES_OPTIONS:vr});class Sr{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return Er.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap(t=>t._views)}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const kr=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...Jn.DEFAULT_API_OPTIONS.payload,..._r.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Or=Object.freeze({...Jn.DEFAULT_LAYOUTS,..._r.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{placeholder:""}],[ae.QUESTION]:[Xi.type,{raw:!0}],[ae.SOURCES]:[ai.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:vs,articleInfoBlock:Os}}]}),Ir=Object.freeze({...Jn.DEFAULT_TRACKERS,..._r.DEFAULT_TRACKERS}),Tr=Object.freeze({..._r.DEFAULT_PAGINATION,active:!0}),xr=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Cr=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Ar=Object.freeze({...Jn.DEFAULT_OPTIONS,..._r.DEFAULT_OPTIONS,api:kr,layouts:Or,trackers:Ir,autocomplete:xr,pagination:Tr,filters:Cr}),Rr=Object.freeze({main:ae.PRODUCTS,members:Object.keys(Or),mappings:Object.freeze({...Jn.ROLES_OPTIONS.mappings,..._r.ROLES_OPTIONS.mappings})});class Nr extends Dn{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Rr,defaults:Ar})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new wr(this),this._results=new Er(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){this._views=new Sr(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return t=this._answer._defaultProcessInteraction0(t,e),t=this._results._defaultProcessInteraction0(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Pe(Nr.prototype,[ye.PAGINATION,ye.FILTERS]);const $r=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),Pr=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Lr=Object.freeze({..._r.DEFAULT_LAYOUTS}),Ur=Object.freeze({..._r.DEFAULT_TRACKERS}),qr=Object.freeze({..._r.DEFAULT_OPTIONS,api:$r,autocomplete:Pr,layouts:Lr,trackers:Ur}),jr=_r.ROLES_OPTIONS;class Dr extends _r{constructor(t,e){super({name:"search",plugin:t,client:e,roles:jr,defaults:qr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=ae.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}gr(Dr.prototype);class zr extends qe{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=re){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=re){return this._members.has(t)}get(t=re){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class Fr extends Dn{_initProperties(t){super._initProperties(t);const{id:e}=t;h(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return $n(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(Fr,{DEFAULT_API_OPTIONS:Dn.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Dn.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Dn.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Dn.DEFAULT_OPTIONS,ROLES_OPTIONS:Dn.ROLES_OPTIONS});const Mr=Object.freeze({...Fr.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...Fr.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Br=Object.freeze({...Fr.DEFAULT_LAYOUTS,[ae.PRODUCTS]:ri.type}),Qr=Object.freeze({...Fr.DEFAULT_TRACKERS,[ae.PRODUCTS]:Se}),Gr=Object.freeze({...Fr.DEFAULT_OPTIONS,api:Mr,layouts:Br,trackers:Qr}),Hr=Xt(Fr.ROLES_OPTIONS,{main:ae.PRODUCTS,members:Object.keys(Br)});class Wr extends Fr{constructor(t,e){super({name:"recommendation",context:t,roles:Hr,defaults:Gr,id:e})}start(){return this._request(),this}notifyViewUpdate(t=ae.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class Vr extends zr{constructor(t,e){super("recommendations",t,e)}_create(t){return new Wr(this,t)}}const Kr=Object.freeze({...Fr.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),Yr=Object.freeze({...Fr.DEFAULT_LAYOUTS,[ae.RELATED_QUESTIONS]:[ri.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[ae.QUERY]:[zi.type,{placeholder:"Ask a question"}]}),Zr=Object.freeze({...Fr.DEFAULT_TRACKERS,[ae.RELATED_QUESTIONS]:Se,[ae.CONTAINER]:{...Se,itemless:!0},[ae.QUERY]:{[he.SUBMIT]:{active:!0}}}),Jr=Object.freeze({...Fr.DEFAULT_OPTIONS,api:Kr,layouts:Yr,trackers:Zr}),Xr=Xt(Fr.ROLES_OPTIONS,{main:ae.RELATED_QUESTIONS,members:Object.keys(Yr)});class to extends Fr{constructor(t,e){super({name:"explore",context:t,roles:Xr,defaults:Jr,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(ae.RELATED_QUESTIONS).on("click",t=>this._handleRelatedQuestionClick(t)),this._hub.on("query",t=>this._query(t))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Gn.prototype.useLink.call(this,t,e),e&&this.useLayouts({[ae.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=ae.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Gn.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Qn(to.prototype);class eo extends zr{constructor(t,e){super("explores",t,e)}_create(t){return new to(this,t)}}class so extends V{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new x)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var io=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var no=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class ro{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class oo{constructor(t){this._context=t,h(this,{lowerCamelToKebab:p,kebabToLowerCamel:_,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=d(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:i=!1}){const{classPrefix:n}=t;return`<${s} class="${i?n+"__phrase-inline":n+"__phrase"} ${n}__${e}-phrase">${this.phraseText(t,_(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:n,trait:r,logo:o=!1},a){const c=[`${t}__${i}-container`];return e&&c.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:c,visibleWhen:n,trait:r,logo:o,parentQuestionId:s},a)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${p(t)}="${i}"`)}return s}}const ao=D(new oo({...io,DEFAULT_PHRASES:no})),co=D(new class extends ro{constructor(){super({helpers:ao})}answerGroup(t){const{container:e}=this._helpers;return[this.question(t),this.reasoning(t),this.answer(t),this.affiliation(t),this.sources(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"question",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",s(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(t={}){const{phrases:e,reasoning:s={}}=t,{container:i,element:n,phraseText:r}=this._helpers,o=[];return s.expand&&o.push("expanded"),i(t,{name:"reasoning",visibleWhen:"nonempty"},[n("miso-stub",{classes:o,trait:"collapsible","data-role":"reasoning-box"},[n("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||xi}</div>`,`<div class="miso-collapsible__title" data-role="title">${r(e,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ii}</div>`]),n("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:n={},logo:r=!0}=t;return i(t,{name:"related-resources"},!1===n.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:i={}}=t;return!1===i.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:ao}));function lo(t={}){const{normalizeOptions:e,section:s,container:i}=ao,{querySuggestions:n,answerGroup:r}=co;return s(t=e(t),{name:"follow-up"},[n(t),i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var uo=Object.freeze({__proto__:null,helpers:ao,sections:co,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=ao,{followUps:n,relatedResourcesSection:r,answerGroup:o}=co;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+n(t)+r(t)},followUp:lo});const ho=Object.freeze(io),_o=Object.freeze(no),po=Object.freeze(uo);var mo=Object.freeze({__proto__:null,constants:ho,phrases:_o,templates:po,wireFollowUps:function(t,e,{template:s=lo,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const n=t.ui.asks,r=t.ui.ask;n.on("done",t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))}),r.on("loading",()=>{e.innerHTML="",n.reset({root:!1})})},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow})}});const{currentScript:fo}=document,go=Object.freeze({templates:po,autostart:!0}),yo=["templates","phrases","features"];class bo{constructor(){this._defaults=go,this._scriptSrc=function(){if(!fo||!fo.src)return{};const t=document.createElement("a");t.href=fo.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Eo(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Eo(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return c({apiKey:t,apiHost:e,templates:So(s),phrases:i,...n})}(wo(this._defaults,this._scriptSrc,t,this._pageUrl))}}function wo(...t){let e={};for(const s of t)s&&(e=vo(e,s));return e}function vo(t,e){if(!e)return t;Object.assign(t,e);for(const s of yo)s in e&&(t[s]={...t[s],...e[s]});return t}function Eo(t){return""===t||"false"!==t&&t}function So(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(So):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,So);default:throw Error("Unsupported template type: "+t)}}class ko{constructor(t,{classPrefix:e=ho.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");h(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Oo extends so{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new bo,this._localOptions={}}config(t={}){t=wo(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})})}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;h(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new ko(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(e,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),l.autoQuery()}}class Io extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}const To="trait",xo=Object.freeze([To]);class Co extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return xo}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const t of this._traits)this._destroyTrait(t);this._traits=[]}attributeChangedCallback(t){if(t===To)this._syncTraits()}_syncTraits(){const t=(this.getAttribute(To)||"").split(/\s+/).filter(Boolean),e=[];for(const s of this._traits)t.includes(s.constructor.traitName)?e.push(s):this._destroyTrait(s);if(t.length>0){const s=function(t){const e=t.ui&&t.ui.traits||{};return Object.values(e).reduce((t,e)=>(t[e.traitName]=e,t),{})}(Co.MisoClient);for(const i of t){if(this._traits.find(t=>t.constructor.traitName===i))continue;const t=s[i];if(!t){console.warn("Unknown trait: "+i);continue}const n=new t(this);e.push(n)}}this._traits=e}_destroyTrait(t){try{t._destroy&&t._destroy()}catch(t){console.error(t)}}}let Ao,Ro,No;async function $o(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Ao||(Ao=async function(){return new Promise(t=>{(window.misocmd||(window.misocmd=[])).push(()=>t(window.MisoClient))})}())}(t);var s;return Ro=Ro||e.any(),No=No||await Ro,No.ui||await(s=0,new Promise(t=>setTimeout(t,s))),No}const Po="logo",Lo="auto",Uo=Object.freeze([...Co.observedAttributes,Po]);function qo(t){if(!t)return Lo;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class jo extends Co{static get observedAttributes(){return Uo}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return qo(this.getAttribute(Po))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Lo:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Po,e):this.removeAttribute(Po)}async connectedCallback(){super.connectedCallback();const t=this._client=await $o(jo);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Po)this._handleLogoUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleLogoUpdate(t,e){qo(t)!==qo(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Do="parent-question-id",zo=Object.freeze([...jo.observedAttributes,Do]);const Fo="unit-id",Mo=Object.freeze([...jo.observedAttributes,Fo]);class Bo extends jo{static get observedAttributes(){return Mo}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(Fo)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Fo,t):this.removeAttribute(Fo)}attributeChangedCallback(t,e,s){if(t===Fo)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Qo=Object.freeze({__proto__:null,MisoAskElement:class extends jo{static get tagName(){return"miso-ask"}static get observedAttributes(){return zo}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Do)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Do,t):this.removeAttribute(Do))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Do)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Bo{static get tagName(){return"miso-explore"}static get observedAttributes(){return Bo.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends jo{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return jo.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends jo{static get tagName(){return"miso-search"}static get observedAttributes(){return jo.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Bo{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Bo.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const Go="role",Ho=Object.freeze([Go]);class Wo extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Ho}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Go);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Go}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Go}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Go&&this._container&&this._container._updateComponentRole(this,e,s)}}var Vo=Object.freeze({__proto__:null,MisoComponentElement:Wo,MisoQueryElement:class extends Wo{constructor(){super({role:ae.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Wo{constructor(){super({role:ae.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Wo{constructor(){super({role:ae.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Wo{constructor(){super({role:ae.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Wo{constructor(){super({role:ae.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Wo{constructor(){super({role:ae.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Wo{constructor(){super({role:ae.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends Wo{constructor(){super({role:ae.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends Wo{constructor(){super({role:ae.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Wo{constructor(){super({role:ae.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Wo{constructor(){super({role:ae.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Wo{constructor(){super({role:ae.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends Wo{constructor(){super({role:ae.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Wo{constructor(){super({role:ae.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Wo{constructor(){super({role:ae.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Wo{constructor(){super({role:ae.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Wo{constructor(){super({role:ae.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Wo{constructor(){super({role:ae.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Wo{constructor(){super({role:ae.ERROR})}static get tagName(){return"miso-error"}}});class Ko extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Ko.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var Yo=Object.freeze({__proto__:null,containers:Qo,roles:Vo,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Ko{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Gs,MisoStubElement:Co});const Zo="miso-hybrid-search-combo";var Jo=Object.freeze({__proto__:null,CLASS_PREFIX:Zo,CONAINER_TAG:"miso-hybrid-search"});const Xo="Show more",ta="Show less";var ea=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:Xo,showLess:ta});const sa=D(new oo({...Jo,DEFAULT_PHRASES:ea})),ia=D(new class extends ro{constructor(){super({helpers:sa})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:sa}));var na=Object.freeze({__proto__:null,helpers:sa,sections:ia,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=sa;t=e(t);const{answerBox:n,answerGroup:r,searchResultsGroup:o}=ia,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[n(t)]:r(t))+s(t,{name:"search-results"},o(t))}});const ra="answer-box-open",oa="answer-box-shown",aa='[data-role="answer-box-toggle"]';class ca{constructor(t,e,{classPrefix:s=Zo,phrases:i={},hideWhenUnanswerable:n=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=n,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push(()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)});const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",()=>this._syncWofkflowStatus())]}_handleClick({target:t,button:e}){0===e&&t.closest(aa)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case fe.ERRONEOUS:case fe.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ta:this._phrases.showMore||Xo;for(const e of this._element.querySelectorAll(aa))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const la={isOpen:ra,shown:oa},ua={toggleOpen:["toggle",ra],open:["add",ra],close:["remove",ra],toggleHidden:["toggle",oa],show:["add",oa],hide:["remove",oa]};for(const[t,e]of Object.entries(la))Object.defineProperty(ca.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(ua))ca.prototype[t]=function(){this._updateBoxStatus(e,s),s===ra&&(this._syncButtonText(),this._syncScroll())};const ha=Object.freeze(Jo),_a=Object.freeze(ea),da=Object.freeze(na);var pa=Object.freeze({__proto__:null,constants:ha,phrases:_a,templates:da,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new ca(t,e,s)}});const ma=Object.freeze(mo),fa=Object.freeze(pa);var ga=Object.freeze({__proto__:null,ask:ma,hybridSearch:fa});function ya(t){const e=t._element;if(!e)return()=>{};const s=e=>t._handleClick(e);return e.addEventListener("click",s),()=>e.removeEventListener("click",s)}const ba="miso-collapsible",wa="expanded",va=[{action:"expand",classAction:"add",className:wa},{action:"collapse",classAction:"remove",className:wa}];class Ea{static get traitName(){return"collapsible"}constructor(t){this._element=t,t.collapsible=this,t.classList.add(ba),this._unsubscribes=[ya(this)]}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(ba),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(t,e){for(const s of e)Object.defineProperty(t,s,{get(){return this._element&&this._element.classList.contains(s)}})}(Ea.prototype,[wa]),function(t,e){for(const{action:s,classAction:i,className:n}of e)t[s]=function(){this._element&&this._element.classList[i](n),this["_"+s]&&this["_"+s]()}}(Ea.prototype,va),function(t,e){t._handleClick=function(t){const{target:s,button:i}=t;if(0===i)for(let{role:i,selector:n,action:r}of e)if(n=n||`[data-role="${i}"]`,n&&s.closest(n))return this[r](),void t.stopPropagation()}}(Ea.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var Sa=Object.freeze({__proto__:null,CollapsibleTrait:Ea});let ka,Oa;async function Ia(){return Oa||(Oa=N(ka||(ka=$("ui"))))}class Ta{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class xa{constructor(t,e){this._plugin=t,this._client=e,h(this,{sources:{api:ys(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Dr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Nr(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Ca{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Oo(this._plugin,this._MisoClient))}}At.plugins.use(class extends V{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Io(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new x}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:ga,traits:Sa};u(s,this,["layouts","combo","ready"]),h(this,{MisoClient:t}),h(t,{ui:s}),this.combo=new Ca(this,t);const i=Object.values(Tn).filter(t=>t.type);for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,combos:o,...a}=Yo,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)],l=[jo,Ko];for(const e of[...l,...c])e.MisoClient=t;await Ia();for(const t of c)b(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then(()=>{})}_injectClient(t){h(t,{ui:new xa(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Ta(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new Vr(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new eo(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new rr(this,t)),e}}),At.attach(),function(t){const e=[];function s(t){e.push(t)}A("misodev",{transform:t=>()=>t({addCmdTransform:s})});const i=t=>{for(const s of e)t=s(t);return t};setTimeout(()=>{A("misocmd",{transform:i}),t&&t()})}(function(){It._cmdRes.resolve()});!function(t){const e={_client:!1,_init(){if(this._client)return;const t=new At("q4YYvyy77WaLp0LJwHLqt1dhAFMrlfpFcNkEI0Lu");this._client=t},setUserInfo(t){const{userID:e,userType:s}=t;e&&(this._client.context.user_id=e),s&&(this._client.context.user_type=s)},answer(){(async t=>{await t.ui.ready;const e=t.ui.ask,s=At.ui.defaults.ask,i=s.templates,n=s.wireFollowUps,r=s.wireRelatedResources,o=document.querySelector("#miso-ask-combo");o.innerHTML=i.root().replaceAll('logo="true"','logo="false"'),n(t,o.querySelector(".miso-ask-combo__follow-ups")),r(t,o.querySelector(".miso-ask-combo__related-resources")),e.autoQuery()})(this._client)}};e._init(),t.MisoForRoularta||(t.MisoForRoularta=e)}(window)}();
