!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===s&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('@charset "UTF-8";@import url("https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300..700;1,300..700&display=swap");:root{--miso-font-title:brandongrotesque,sans-serif;--miso-font-body:"Open Sans",sans-serif;--miso-font-quote:"Cormorant Garamond",serif;--miso-primary-color:#f36f21;--miso-primary-color-light:#fdefe3;--miso-text-color:#333;--miso-secondary-color:#77c2ca}.miso-ask-combo{font-family:var(--miso-font-body);font-size:.9rem;margin-bottom:3rem!important;margin-top:1rem!important}.miso-search-box{--miso-search-box-padding:1.25rem;padding:0 var(--miso-ask-combo-content-padding)}.miso-search-box .miso-search-box__input-group{border-color:var(--miso-primary-color)!important;border-width:1.5px!important;box-shadow:none!important}.miso-search-box .miso-search-box__input-group:focus-within,.miso-search-box .miso-search-box__input-group:hover{border-color:var(--miso-primary-color)!important}.miso-search-box .miso-search-box__input{color:var(--miso-text-color);font-family:var(--miso-font-title)!important;height:3rem}.miso-search-box .miso-search-box__button{background-color:var(--miso-primary-color)!important;color:#fff!important;height:2rem;margin:.5rem!important;padding:.5rem!important;width:2rem}.miso-search-box .miso-search-box__button svg{height:1rem;width:1rem}.miso-ask-combo__question-phrase{font-family:var(--miso-font-quote);font-size:1rem!important;font-style:italic;font-weight:400;letter-spacing:.05em;margin-bottom:1rem!important}miso-question .miso-text{font-family:var(--miso-font-title);font-size:2.2rem!important;letter-spacing:-.01em;margin-bottom:1rem!important}miso-images .miso-gallery__list{margin:1rem 0 2rem!important}miso-images .miso-gallery__item-info-container{bottom:0!important;top:auto!important}miso-images .miso-gallery__item-title{background:linear-gradient(0deg,#333,transparent);border-bottom-left-radius:1rem;border-bottom-right-radius:1rem;font-size:.9rem!important;padding:.5rem 1rem!important}miso-images .miso-gallery__item-small .miso-gallery__item-title{padding:.3rem .5rem!important}miso-answer .miso-markdown-lower h2,miso-answer .miso-markdown-upper h2{margin-bottom:1rem!important}miso-answer .miso-markdown-lower ol+h2,miso-answer .miso-markdown-lower p+h2,miso-answer .miso-markdown-lower ul+h2,miso-answer .miso-markdown-upper ol+h2,miso-answer .miso-markdown-upper p+h2,miso-answer .miso-markdown-upper ul+h2{margin-top:2rem!important}miso-answer .miso-markdown-lower p,miso-answer .miso-markdown-upper p{margin-top:1rem!important}miso-answer .miso-markdown-lower h1,miso-answer .miso-markdown-upper h1{font-size:1.8rem!important}miso-answer .miso-markdown-lower h2,miso-answer .miso-markdown-upper h2{font-size:1.6rem!important}miso-answer .miso-markdown-lower h3,miso-answer .miso-markdown-upper h3{font-size:1.4rem!important}miso-answer .miso-markdown-lower h1,miso-answer .miso-markdown-lower h2,miso-answer .miso-markdown-lower h3,miso-answer .miso-markdown-upper h1,miso-answer .miso-markdown-upper h2,miso-answer .miso-markdown-upper h3{display:block;font-family:var(--miso-font-title);letter-spacing:-.04em}miso-answer .miso-markdown-lower p strong,miso-answer .miso-markdown-upper p strong{background-color:var(--miso-primary-color-light);font-weight:500!important;padding-left:.3rem!important;padding-right:.3rem!important}miso-answer .miso-markdown-lower h1,miso-answer .miso-markdown-upper h1{-webkit-text-decoration:underline .175rem var(--miso-primary-color)!important;text-decoration:underline .175rem var(--miso-primary-color)!important;text-underline-offset:.25rem!important}miso-answer .miso-markdown-lower table,miso-answer .miso-markdown-upper table{font-size:.9rem!important}miso-answer .miso-markdown-lower table thead tr,miso-answer .miso-markdown-upper table thead tr{background-color:var(--miso-primary-color-light)!important;border:none!important}miso-answer .miso-markdown-lower table thead tr th,miso-answer .miso-markdown-upper table thead tr th{background-color:var(--miso-primary-color-light)!important;border-bottom-width:0!important;font-family:var(--miso-font-title);font-weight:600!important;padding:.5rem 1rem!important;vertical-align:middle!important}miso-answer .miso-markdown-lower table thead tr th:first-child,miso-answer .miso-markdown-upper table thead tr th:first-child{border-top-left-radius:10px!important}miso-answer .miso-markdown-lower table thead tr th:last-child,miso-answer .miso-markdown-upper table thead tr th:last-child{border-top-right-radius:10px!important}miso-answer .miso-markdown-lower table tbody,miso-answer .miso-markdown-upper table tbody{border:none!important}miso-answer .miso-markdown-lower table tbody tr,miso-answer .miso-markdown-upper table tbody tr{background-color:#fff!important;border-color:oklch(87% 0 0deg)!important;border-left:none!important;border-right:none!important}miso-answer .miso-markdown-lower table tbody tr:first-child,miso-answer .miso-markdown-upper table tbody tr:first-child{border-top:none!important}miso-answer .miso-markdown-lower table tbody tr td,miso-answer .miso-markdown-upper table tbody tr td{border-color:oklch(87% 0 0deg)!important;padding:.5rem 1rem!important;vertical-align:middle!important}miso-answer .miso-markdown-lower table tbody tr a:not(.miso-citation-link),miso-answer .miso-markdown-upper table tbody tr a:not(.miso-citation-link){color:inherit!important;text-decoration:underline!important}miso-answer .miso-markdown-lower a,miso-answer .miso-markdown-lower table tbody tr .miso-citation-link,miso-answer .miso-markdown-upper a,miso-answer .miso-markdown-upper table tbody tr .miso-citation-link{color:var(--miso-primary-color)!important}miso-answer .miso-markdown-lower ol,miso-answer .miso-markdown-upper ol{counter-reset:item!important;margin-top:1rem!important;padding-left:3rem!important}miso-answer .miso-markdown-lower ol>li,miso-answer .miso-markdown-upper ol>li{counter-increment:item!important;line-height:1.8!important;list-style:none!important;margin-bottom:.5rem!important}miso-answer .miso-markdown-lower ol>li:before,miso-answer .miso-markdown-upper ol>li:before{color:var(--miso-primary-color)!important;content:counter(item) "."!important;font-family:var(--miso-font-title);font-size:1.1rem!important;font-weight:600!important;margin-left:-1.6rem!important;margin-right:1rem!important;min-width:.8rem!important;position:absolute!important;text-align:center!important}miso-answer .miso-markdown-lower ul,miso-answer .miso-markdown-upper ul{margin-top:1rem!important;padding-left:3rem!important}miso-answer .miso-markdown-lower ul>li,miso-answer .miso-markdown-upper ul>li{line-height:1.8!important;list-style:none!important;margin-bottom:.5rem!important;position:relative!important}miso-answer .miso-markdown-lower ul>li:before,miso-answer .miso-markdown-upper ul>li:before{background-color:var(--miso-primary-color)!important;border-radius:50%!important;content:""!important;height:.4rem!important;left:.2rem!important;margin-left:-1.6rem!important;margin-right:1rem!important;position:absolute!important;top:.75rem!important;width:.4rem!important}miso-answer .miso-markdown-lower li strong,miso-answer .miso-markdown-upper li strong{background-color:var(--miso-primary-color-light);font-weight:400!important;margin-left:-.3rem!important;margin-right:.3rem!important;padding-left:.3rem!important;padding-right:.3rem!important}miso-answer .miso-markdown-lower table,miso-answer .miso-markdown-upper table{margin-bottom:2rem!important;margin-top:.5rem!important}miso-answer .miso-markdown-lower blockquote,miso-answer .miso-markdown-upper blockquote{align-items:center!important;display:flex!important;justify-content:center!important}miso-answer .miso-markdown-lower blockquote p,miso-answer .miso-markdown-upper blockquote p{background-color:var(--miso-primary-color-light)!important;border-radius:10px!important;font-family:var(--miso-font-quote);font-size:1.2rem!important;font-style:italic;font-weight:700;line-height:1.4!important;margin-bottom:2rem!important;padding:1.5rem 2rem!important;position:relative!important;width:-moz-fit-content!important;width:fit-content!important}miso-answer .miso-markdown-lower blockquote a,miso-answer .miso-markdown-upper blockquote a{font-size:1.2rem!important;font-style:normal!important}miso-answer .miso-markdown-lower blockquote p:before,miso-answer .miso-markdown-upper blockquote p:before{bottom:calc(100% - 3.4rem)!important;color:var(--miso-primary-color)!important;content:"“︁"!important;font-family:var(--miso-font-body)!important;font-size:3.6rem!important;left:1rem!important;position:absolute!important}miso-answer .miso-markdown-lower blockquote p:after,miso-answer .miso-markdown-upper blockquote p:after{color:var(--miso-primary-color)!important;content:"”︁"!important;font-family:var(--miso-font-body)!important;font-size:3.6rem!important;position:absolute!important;right:1rem!important;top:calc(100% - 1.8rem)!important}miso-answer .miso-markdown-lower blockquote p em:last-child,miso-answer .miso-markdown-upper blockquote p em:last-child{color:oklch(50% .02 280deg)!important;display:block!important;font-family:var(--miso-font-body)!important;font-size:.9rem!important;font-style:normal!important;font-weight:400!important;margin-top:.5rem!important}.miso-ask-combo__query-suggestions-phrase,.miso-ask-combo__related-resources-phrase,.miso-ask-combo__sources-phrase,.miso-feedback{font-family:var(--miso-font-title)}.miso-ask-combo__related-resources-container .miso-list__item-info-container,.miso-ask-combo__sources-container .miso-list__item-info-container{padding-top:.5rem}.miso-ask-combo__related-resources-container .miso-list__item-title,.miso-ask-combo__sources-container .miso-list__item-title{font-family:var(--miso-font-title)}.miso-ask-combo__related-resources-container .miso-list__item-snippet mark,.miso-ask-combo__sources-container .miso-list__item-snippet mark{background-color:var(--miso-primary-color-light)}.miso-ask-combo__query-suggestions-container{--miso-option-list-background:var(--miso-primary-color-light)}.miso-ask-combo__query-suggestions-container .miso-option-list__option{box-shadow:none!important}.miso-ask-combo__query-suggestions-container .miso-option-list__option:hover{border-color:transparent!important}.miso-email-form{margin-bottom:8rem;margin-top:3rem;padding:0 4rem;position:relative}.miso-email-form .miso-email-form__message{background-color:#f2f2f2;border-radius:1.5rem;font-family:var(--miso-font-title);font-size:1.1rem;padding:3rem 11rem 2rem}.miso-email-form .miso-email-form__background-reflection{background:#f2f2f2;background:linear-gradient(180deg,#f2f2f2,#fff);border-top-left-radius:1.5rem;border-top-right-radius:1.5rem;height:5rem;margin-top:2rem;position:absolute;width:calc(100% - 8rem)}.miso-email-form .miso-email-form__form{padding:0 7rem}.miso-email-form .miso-email-form__input-group{background-color:#fff;border:1.5px solid var(--miso-primary-color);border-radius:var(--miso-search-box-border-radius);display:flex;font-size:var(--miso-search-box-font-size);position:relative}.miso-email-form .miso-email-form__input-group .miso-email-form__input{color:var(--miso-text-color);flex-grow:1;font-family:var(--miso-font-title)!important;height:3rem;padding:1.25rem .5em 1.25rem var(--miso-search-box-padding-left)}.miso-email-form .miso-email-form__input-group .miso-email-form__button{align-items:center;background-color:var(--miso-primary-color)!important;border-radius:var(--miso-search-box-border-radius);color:#fff!important;display:flex;flex-grow:0;height:2rem;justify-content:center;margin:.5rem!important;padding:.5rem!important;width:2rem}.miso-email-form .miso-email-form__input-group .miso-email-form__button:hover{background-color:var(--miso-primary-color)}.miso-email-form .miso-email-form__input-group .miso-email-form__button svg{height:1rem;width:1rem}.miso-message{margin-bottom:2rem}.miso-message--empty{display:none}.miso-message .miso-message__main{background:#f7b37b;background:linear-gradient(150deg,#f7b37b,#ee5149);border-radius:1rem;color:#fff;line-height:1.6;padding:1.5rem}.miso-message a{color:#fff;font-weight:600;text-decoration:underline}.miso-top-message{padding:0 4rem}.miso-follow-up-message{margin-top:1.5rem;padding:0 2rem}miso-related-questions .miso-list__list{margin:1.5rem 0!important;padding-left:0!important}miso-related-questions .miso-list__item{border:1.5px solid var(--miso-secondary-color);border-radius:5rem;font-size:1rem;margin-bottom:1rem;padding:.5rem 1rem;width:-moz-fit-content;width:fit-content}miso-related-questions .miso-list__item a{color:var(--miso-secondary-color)}miso-related-questions .miso-list__item a:hover{text-decoration:none}miso-related-questions .miso-list__item-body{align-items:center;display:flex;gap:1.5rem}miso-related-questions .miso-list__item-body svg{flex-shrink:0;width:1.2rem}.miso-dialogs{border-radius:2rem;box-shadow:0 7px 29px 0 hsla(240,5%,41%,.2);margin-bottom:3rem;margin-top:2.5rem}.miso-dialogs .miso-dialog__header{background:#f7b37b;background:linear-gradient(150deg,#f7b37b,#ee5149);border-top-left-radius:2rem;border-top-right-radius:2rem;color:#fff;display:flex;flex-direction:column;padding:1rem 1.5rem}.miso-dialogs .miso-dialog__header div:first-child{font-weight:600;margin-bottom:.5rem}.miso-dialogs .miso-dialog__body{color:var(--miso-text-color);margin-top:1.5rem}.miso-dialogs .miso-dialog__body-description{margin-bottom:1rem;padding:0 8rem}.miso-dialogs .miso-dialog__footer{padding:.5rem .5rem 2rem;text-align:center}.miso-dialogs .miso-dialog__footer a{color:#ee5149;font-weight:600;text-decoration:underline}.miso-dialogs .miso-email-form__form{padding:0 3rem}.miso-dialogs .miso-email-form__input-group{background-color:#fff;border:1.5px solid var(--miso-primary-color);border-radius:var(--miso-search-box-border-radius);display:flex;font-size:var(--miso-search-box-font-size);position:relative}.miso-dialogs .miso-email-form__input-group .miso-email-form__input{color:var(--miso-text-color);flex-grow:1;font-family:var(--miso-font-title)!important;height:3rem;padding:1.25rem .5em 1.25rem var(--miso-search-box-padding-left)}.miso-dialogs .miso-email-form__input-group .miso-email-form__button{align-items:center;background-color:var(--miso-primary-color)!important;border-radius:var(--miso-search-box-border-radius);color:#fff!important;display:flex;flex-grow:0;height:2rem;justify-content:center;margin:.5rem!important;padding:.5rem!important;width:2rem}.miso-dialogs .miso-email-form__input-group .miso-email-form__button:hover{background-color:var(--miso-primary-color)}.miso-dialogs .miso-email-form__input-group .miso-email-form__button svg{height:1rem;width:1rem}.miso-blurred-table{position:relative}.miso-blurred-table .miso-blurred-table__overlay{align-items:center;backdrop-filter:blur(2.5px);background:hsla(0,0%,85%,.25);border-top-left-radius:10px;border-top-right-radius:10px;bottom:0;display:flex;justify-content:center;left:0;padding:2rem;position:absolute;right:0;top:0}.miso-blurred-table .miso-blurred-table__overlay-content{align-items:center;background:#fff;border:1px solid #f4f4f4;border-radius:10px;box-shadow:0 162px 45px 0 transparent,0 104px 42px 0 rgba(0,0,0,.01),0 58px 35px 0 rgba(0,0,0,.05),0 26px 26px 0 rgba(0,0,0,.09),0 6px 14px 0 rgba(0,0,0,.1);display:flex;flex-direction:column;max-width:20rem;padding:2rem}.miso-blurred-table .miso-blurred-table__overlay-content-title{font-weight:700;line-height:1.7;margin-bottom:.2rem}.miso-blurred-table .miso-blurred-table__overlay-content-description{font-size:.8rem;margin-bottom:1.6rem;padding:0 1rem}.miso-blurred-table .miso-blurred-table__overlay-content-button{align-items:center;display:flex;gap:.4rem}.miso-blurred-table .miso-blurred-table__overlay-content-button svg{height:1.2rem;width:1.2rem}@media (max-width:767px){.miso-email-form{padding:0}.miso-email-form .miso-email-form__message{font-size:1rem;padding:2rem}.miso-email-form .miso-email-form__background-reflection{width:100%}.miso-email-form .miso-email-form__form{padding:0 1rem}miso-images .miso-gallery__item-title{padding:.3rem .5rem!important}.miso-follow-up-message,.miso-top-message{padding:0}.miso-dialog__body .miso-dialog__body-description{padding:0 2rem!important}.miso-dialog__body .miso-email-form__form,.miso-dialog__body .miso-search-box{padding:0 1.5rem!important}.miso-blurred-table{width:-moz-fit-content;width:fit-content}}');var t="1.12.1";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",()=>s.abort(e.reason))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var o=Object.freeze({__proto__:null,GROUP:s,NAME:i});function n(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function r(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){return null!=t?""+t:t}function c(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function l(t){return null==t}function u(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t),{}))}function d(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function m(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function h(t){return t.replace(/[-_][a-z]/g,t=>t[1].toUpperCase())}function _(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class p{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:o}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);g(s),g(i),g(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!o,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout(()=>f(this,t),e):f(this,t),this._value=t}disconnect(){this._active=!1}}function f(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function g(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function b(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function y(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function w(t){return new Promise((e,s)=>{window.requestAnimationFrame(async i=>{try{await t(i),e()}catch(t){s(t)}})})}async function v(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise((o,n)=>{const r=new p(t=>{t&&(r.disconnect(),a.disconnect(),o())},{onDuration:s}),a=new IntersectionObserver(t=>{r.value=t[0].isIntersecting},{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",()=>{r.disconnect(),a.disconnect(),n(new DOMException("Aborted","AbortError"))})})}function k(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function E(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function x(t,e){const s=S(()=>window.localStorage.getItem(t)),i=S(()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const o=i+s.length,n=e.indexOf(";",o);return decodeURIComponent(0>n?e.substring(o):e.substring(o,n))}(t)),o=s||i||""+e();return o&&!s&&S(()=>window.localStorage.setItem(t,o)),o&&!i&&S(()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,o)),o}function S(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function I(t){return new O(t)}class O{constructor(t){this._value=t;const e=t=>{this._value=t};d(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class C{constructor(){const t=this;t.promise=new Promise((e,s)=>{t.resolve=e,t.reject=s}),Object.freeze(this)}}class T{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new C),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function A(t,e){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,{onError:e=t=>console.error(t),transform:s=t=>t}={}){try{s(t)()}catch(t){e(t)}}(t,e);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let R;try{R=document.currentScript}catch(t){}async function N(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval(()=>{t.sheet&&(i&&clearInterval(i),e())},100)})}(t),await async function(t){if($(t))return;return new Promise(e=>{let s;s=setInterval(()=>{$(t)&&(s&&clearInterval(s),e())},100)})}(t)}(e)}catch(t){console.error(t)}}function L(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.1/dist/css/${t}.css`}function $(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function P(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout(()=>{e=void 0,s()},t)}}function q(t,{depth:e=5,...s}={}){return U(t,e)}function U(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,t=>U(t,e-1)):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const o=t[i];"function"!=typeof o&&(i.startsWith("_")&&"object"==typeof o&&"Object"!==o.constructor.name||(s[i]=U(o,e-1)))}return s}(t,e):t:"(...)"}function j(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,o]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,o)}function D(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const o=Object.getOwnPropertyDescriptors(i);for(const i in o){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:n}=o[i];n&&(e[i]="function"==typeof n?n.bind(t):n)}}return Object.freeze(e)}function z(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let o=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(o*=1+(s-i)*e/1e3),o}}(t);return(t,s,i,o)=>{const n=e(i,s);return t+Math.max(o-i,0)*n/1e3}}const M=Symbol.for("miso:resources");class F{constructor(){this._resources=new Map;const t=window[M]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){B(this._resources,t).resolve(e)}async get(t){return B(this._resources,t).promise}}function B(t,e){if(t.has(e))return t.get(e);const s=new C;return t.set(e,s),s}function Q(){return window[M]||(window[M]=new F)}class G{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new C;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class H{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise((s,i)=>{const o=e._on(t,t=>{setTimeout(()=>o());try{s(t)}catch(t){i(t)}})})}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)n(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&n(s,e)}}_injectSubscribeInterface(t){u(t,this,["on","once"])}}function W(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class V{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:W(t,e),uuid:E()})}(t,e);d(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new H({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(V,"miso:component");class K extends V{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new C);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Y{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new p(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class Z{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout(()=>this.abort(),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const J=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class X{constructor(t,e){this._client=t,this._root=e,this._bulk=new G(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:o,sendApiKeyByHeader:n}={}){const{apiKey:r,request:a={}}=this._client.options;o=o||a.timeout,(n=n||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":r});const l="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=o?AbortSignal.timeout(o):void 0,d=await(this._root._customFetch||window.fetch)(t,c({method:s,headers:i,body:l,cache:"no-cache",mode:"cors",signal:u})),m=await d.json();if(d.status>=400||m.errors){var h=Error(m.message);throw h.data=m,h.status=d.status,h}return m}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map(({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s}))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:o,status_code:n,body:r}=i[e];n>=400||o?s.reject({status_code:n,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,o=e.sendApiKeyByHeader||i.sendApiKeyByHeader,n=t.filter(t=>t).join("/"),r=`${this.getApiEndpoint(n)}/${n}`;return o?r:`${r}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=J.DATA_ENDPOINT,eventEndpoint:s=J.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const o=this._client;for(const n of this._root._urlPasses)try{i=n({client:o,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const o=this._client;for(const n of this._root._payloadPasses)try{i=n({client:o,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}}class tt extends V{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,o=i?{bulk:this.helpers.bulkInfo}:void 0,n=this._apiPath,r=this._url({apiGroup:n,apiName:t,payload:e,options:s}),a={apiGroup:n,apiName:t,payload:e=this._preprocess({apiGroup:n,apiName:t,payload:e,options:s}),url:r,options:s};this._events.emit("request",{...a,...o});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...o}),this._postprocess(l)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:o,...n}={}}){return o?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,n)}_postprocess({response:t}){return t.data}}const{GROUP:et,NAME:st}=o;class it extends tt{constructor(t){super(t,et.INTERACTIONS)}async upload(t,e){try{return await this._run(st.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===st.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class ot{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...o}=this._options;const n=new Z(i);let r;s=e(this._ac.signal,n.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:o,signal:n}={}){if(n&&n.aborted)return[];let r,a,c=0,u=!1;function d(){r&&clearInterval(r),u=!0}const m=new T;return r=setInterval(async()=>{let e,r,h;try{if([e,r,h]=await t(n?{signal:n}:{}),u||!l(a)&&a>=h)return;l(h)||(a=h),o&&o(e,r,h),c=0}catch(t){return i&&i(t),c++,void(c>s&&(d(),m.error(t)))}m.update(e,r),r&&d()},e),n&&n.addEventListener&&n.addEventListener("abort",()=>{d(),m.abort(n.reason)}),m}(async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]},{interval:t,signal:s,onResponse:(t,e)=>{e?n.clear():this._isUpdated(r,t)&&n.touch(),r=t},...o})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||rt(t.answer)!==rt(e.answer)||rt(t.reasoning)!==rt(e.reasoning)}_revisionOf(t){return t&&t.revision}}class nt extends ot{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}function rt(t=""){return t.length}const{GROUP:at,NAME:ct}=o;class lt extends tt{constructor(t){super(t,at.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new ut(this,t,e);const s=await this._run(ct.QUESTIONS,t,e);return new ut(this,s,e)}async _questions(t,e){return this._run(ct.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${ct.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(ct.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(ct.TRENDING_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(ct.SEARCH,t,e);return s.question_id?new dt(this,s,e):s}async _searchGet(t,e){return this._run(`${ct.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(ct.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(ct.SEARCH_AUTOCOMPLETE,t,e)}}class ut extends nt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class dt extends nt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),d(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:mt,NAME:ht}=o;class _t extends tt{constructor(t){super(t,mt.SEARCH)}async search(t,e){return this._run(ht.SEARCH,t,e)}async autocomplete(t,e){return this._run(ht.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(ht.MGET,t,e)}}const{GROUP:pt,NAME:ft}=o;class gt extends tt{constructor(t){super(t,pt.RECOMMENDATION)}async userToProducts(t,e){return this._run(ft.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(ft.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(ft.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(ft.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(ft.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(ft.PRODUCT_TO_PRODUCTS,t,e)}}class bt extends V{constructor(t,e){super("api",t),this._client=t,this.helpers=new X(t,e),this.interactions=new it(this),this.ask=new lt(this),this.search=new _t(this),this.recommendation=new gt(this)}}var yt=Object.freeze({__proto__:null,Api:bt,ApiBase:tt,ApiHelpers:X,Interactions:it,Ask:lt,Search:_t,Recommendation:gt});class wt extends V{constructor(t){super("context",t),this._client=t}}var vt={api:yt,context:{Context:wt}};class kt{constructor(t){d(this,{install:t})}}class Et extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new xt(this,vt),this.plugins=new St(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new C);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return d(i,{id:t}),this._tryConfig(i,e),i;case"function":return new kt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),o=0>e?t.length:e,n=t.lastIndexOf("/",o)+1,r=t.indexOf(".",n),a=0>r?"":t.slice(r,o);return`${t.slice(0,n)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new Q).get(s);!this.isRegistered(t)&&this.register(i)}}class xt{constructor(t,e){u(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),d(this,{classes:e})}}class St{constructor(t){u(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const It=new class extends V{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Et(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=t,this._cmdRes=new C}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Ot=Object.freeze({__proto__:null,viewable:v,debounce:P});const{currentScript:Ct}=document;class Tt extends V{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Tt),window.MisoClient?window.MisoClient!==Tt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Tt}static debug(){}constructor(t){super("client",It),this._config(t),this.context=new wt(this),this.api=new bt(this,It),function(t){It._clients.push(t),It._events.emit("create",t)}(this)}get version(){return Tt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,c(t)}_readConfigFromScriptUrl(){return c({apiKey:new URL(new Request(Ct.src||Ct.href).url).searchParams.get("api_key")||void 0})}}Tt.helpers=Ot,d(Tt,{uuid:E()});var At=function(t){const e=It._pluginRoot;return It.MisoClient=e.MisoClient=t,u(t,It,["version","instances","any","meta","on","once","cmdDone"]),u(t,e,["plugins"]),t}(Tt);const{GROUP:Rt,NAME:Nt}=o;let Lt;class $t{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||Lt||(Lt=x("miso_anonymous_id",E))}set anonymous_id(t){t=a(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=a(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Pt(){const t=new URLSearchParams(window.location.search);let e=c({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class qt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function Ut(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=E()),{...e,context:{...s,custom_context:i}}}const jt="std:native-fetch";let Dt,zt;const Mt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Dt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Dt="borrowed",t.contentWindow.fetch}catch(t){zt=t}})();const Ft="miso-logdump",Bt="miso-logdump",Qt=Bt+"__download-btn",Gt="Miso Log";class Ht{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Yt||(Yt=N(L("logdump")))}();let t=document.getElementById(Ft);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Gt,e.classList.add(Qt),e.addEventListener("click",()=>this.download()),t=document.createElement("div"),t.id=Ft,t.classList.add(Bt),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Ft),e=t&&t.querySelector("."+Qt);e&&(e.textContent=this._options.logDownloadButtonText||Gt)}hideDownloadButton(){const t=document.getElementById(Ft);t&&(t.style.display="none")}download(){const t=new Blob([Vt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Wt()})}return t&&"string"==typeof t?t:`miso-log.${Wt()}.jsonl`}clear(){this._logs=[]}}function Wt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Vt(t){return t.map(t=>JSON.stringify(q(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Kt(t[e-1])]}return t}(t),{depth:10}))).join("\n")}function Kt(t){return t?q(t,{depth:2}):t}let Yt;const Zt="std:debug";function Jt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function Xt(t,e){return Object.freeze({...t,...e,members:te(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function te(t=[],e=[]){return[...new Set([...t,...e])]}function ee(t,e){let s={};for(const i of t)i&&(s=e(s,i));return c(s)}function se(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function ie(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...oe("_meta",s,i)})});var s,i})}function oe(t,e,s){const i=e&&e[t],o=s&&s[t],n=i?o?{...i,...o}:i:o;return void 0!==n?{[t]:n}:{}}At.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Ht(t)}static get id(){return Zt}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Zt,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",t=>this._injectComponents(t,e)),t.on("subtree",s=>this._injectComponents(s,e.concat(t.meta.path))),t.on("*",(s,i)=>this._handleEvent(t,i,s,e))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const o=i.concat(t.meta.path);if(o.length||"create"!==e){switch(o[0]){case"client":if("api"===o[1])return void this._handleApiEvent(e,{...s,groupName:o[2]});break;case"plugins":return void(1===o.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(o[1],o.slice(2),e,s))}this._logw(o.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:o,...n}){const r=new URL(i).pathname,a=["api",t];if(o&&a.push(`(bulk ${o.bulkId})`),a.push("POST "+r),"interactions"===e){const t=n.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,o="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${o} (${i})`:""+o)}a.push([{...n,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Jt)):this._log(t,e,Jt(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter(t=>t).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return jt}install(t,e){Mt?(e.setCustomFetch(Mt),t.debug(`<plugin:${jt}>`,"[info]",`Using ${Dt} native fetch`)):t.debug(`<plugin:${jt}>`,"[error]","Failed to obtain native fetch: "+zt.message)}}),At.plugins.use(class extends V{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new $t(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===Rt.INTERACTIONS&&s===Nt.UPLOAD?this._modifyPayloadForInteractions(t,i):e===Rt.ASK&&s===Nt.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:o}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:o},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:o,anonymous_id:n}=t.context,r=s?{user_id:s,user_hash:i}:{anonymous_id:n};return s&&o&&(r.user_type=o),{...r,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,o=c({anonymous_id:s,user_id:i});return{data:e=e.map(t=>({...o,...t}))}}}),At.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map(t=>({...t,context:{...c({page:c({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Pt()}),...t.context}}))}}}),At.plugins.use(class extends V{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new qt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:o,payload:n}){if(e===s.SEARCH)if(o===i.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),At.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Ut)}}}),At.plugins.use(class extends V{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:return!0}return!1}});const ne="default",re="_organic",ae=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ce=new Set([ae.PRODUCTS,ae.CATEGORIES,ae.ATTRIBUTES,ae.RESULTS,ae.ITEMS,ae.QUESTION,ae.ANSWER,ae.REASONING,ae.IMAGES,ae.SOURCES,ae.RELATED_RESOURCES,ae.QUERY_SUGGESTIONS,ae.RELATED_QUESTIONS,ae.AFFILIATION,ae.FACETS,ae.TOTAL]);function le(t){return ce.has(t)}const ue=new Set([ae.PRODUCTS,ae.IMAGES,ae.SOURCES,ae.RELATED_RESOURCES]);const de=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),me=[de.IMPRESSION,de.VIEWABLE,de.CLICK,de.SUBMIT,de.FEEDBACK],he=[de.IMPRESSION,de.VIEWABLE,de.CLICK],_e=new Set(he);const pe=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),fe=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function ge(t){if(0>me.indexOf(t))throw Error("Unrecognized event type: "+t)}const be=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function ye(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,t=>"_"+t.toLowerCase()))}function we(t){if(void 0===t)return;let[e,s]=r(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function ve(t,e){return!1===(e=we(e))[0]?e:t&&e?[e[0]||t[0],ke(t[1],e[1])]:e||t}function ke(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Ee=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function xe(t={}){t=se(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Se(e);return t}function Se(t={}){return t=se(t)}function Ie(t={},e={}){const s={...t};for(const[i,o]of Object.entries(e))void 0!==o&&(s[i]=me.includes(i)?Oe(t[i],o):o);return s}function Oe(t={},e={}){return{...t,...e}}const Ce=[{key:be.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return c({group:s,name:t,payload:e})},merge:ie},{key:be.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${ae.PRODUCTS}: ... }) instead`),t={...s,[ae.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[ye(e)]=we(s);return i},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{for(const[s,i]of Object.entries(e))t[s]=ve(t[s],i);return t})}},{key:be.DATA_PROCESSOR,normalize:function(t){t=r(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:be.TRACKERS,normalize:function(t={}){t=se(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=xe(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:Ie(t[s],i));return t})}},{key:be.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=r(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i})}},{key:be.FILTERS,normalize:se,merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>Object.assign(t,e))}},{key:be.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&ee(t,(t,e)=>Object.assign(t,e))}}];class Te{constructor(){this._events=new H({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Ae{constructor(t={},e={}){this._events=new H({target:this}),this._defaults=e,this._context=t||{},this._locals={},d(this,{resolved:new Re(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",t=>this._notify(t))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Re{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class Ne{constructor(t,e,s,i,o){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=o}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Ce){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Te.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ne(this,this._globals,e,s,i))}}),Object.defineProperty(Ae.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Ne(this,this._locals,e,s,i))}}),Object.defineProperty(Re.prototype,e,{get:function(){return this._get(t)}})}const Le=[be.API,be.LAYOUTS,be.DATA_PROCESSOR,be.TRACKERS,be.INTERACTIONS];function $e(t,e=Le){for(const s of e)Pe(t,s)}function Pe(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function qe(t={}){const{setValue:e,focus:s,param:i,sourceParam:o}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:i="q",sourceParam:o="qs",...n}={}){return{setValue:t,focus:e,updateUrl:s,param:i,sourceParam:o,...n}}(t),n=new URLSearchParams(window.location.search),r=n.get(i),a=n.get(o)||void 0,{layout:l}=this._views.get(ae.QUERY);l&&(r&&e&&(l.value=r),!r&&s&&l.focus()),r&&this.query(c({q:r,qs:a}))}class Ue extends V{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Te}}function je(t){return t?"view:"+t:"view"}$e(Ue.prototype);class De{constructor(t={}){(this._events=new H)._injectSubscribeInterface(this),this._options=t,this._states={},d(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const i=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class ze{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:E(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function Me(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Fe{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",t=>this._handleSession(t)),t.on("request",t=>this._handleRequest(t))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t})}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},o={...t.options,signal:s},n=await this._source({session:e,...t,options:o});if(n&&n[Symbol.asyncIterator]){let t;for await(t of(n._response&&this._emitResponseWithSessionCheck({session:e,request:i,value:n._response}),n)){if(!Me(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:n})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){Me(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Be{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,t=>t.handler===e)}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{n(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Qe,VIEWABLE:Ge,CLICK:He}=de,{UNTRACKED:We,TRIGGERED:Ve}=pe,Ke=Object.freeze({[Qe]:We,[Ge]:We,[He]:We});class Ye{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ke}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||We}set(t,e,s){ge(e),function(t){if(t!==pe.UNTRACKED&&t!==pe.TRACKING&&t!==pe.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of r(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter(t=>this.get(t,e)!==Ve)}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),()=>({...Ke})))[e]=s}}const Ze=[Symbol("itemless")];class Je{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new Ye(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){ge(t);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:o=!0,itemless:n=!1}=i;if(o){if(n&&(e=Ze),0===(e=this._states.untriggered(r(e),t)).length)return;this._states.set(e,t,pe.TRIGGERED)}this._sendToHub({type:t,items:n?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:de.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(c({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Ye(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[je(this._role)]}}for(const t of he)Je.prototype[t]=function(e,s){this._trigger(t,e,s)};function Xe(t){return t&&t.meta&&t.meta.empty}class ts{constructor(t,e){this._events=new H({target:this}),this._views=t,this._mapping=ss((t._roles.mappings||{})[e]||e),d(this,{role:e,interface:new es(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Be(()=>this.element)),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===ae.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Je({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((o=e)===(n=i)||o&&n&&o.status===n.status&&o.error===n.error&&o.value===n.value&&o.ongoing===n.ongoing&&Xe(o)===Xe(n)&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(o.session,n.session)))return;var o,n;const{session:r,status:a,ongoing:c,request:l,meta:u,value:d}=e,m={session:r,status:a,ongoing:c,request:l,meta:u,data:d,...is(this.role,e)},h=(t={},e)=>{!1!==t&&this.updateState({...m,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?fe.ERRONEOUS:t.status;t=this._state=Object.freeze(c({...t,status:s}));const{role:i}=this;this.hub.update(je(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:o,...n}=t,r={value:this._mapping(t,this),status:i,data:e,meta:o,...n};return this.role===ae.CONTAINER&&(r.meta={...o,empty:this._isContainerEmpty(t)}),c(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!le(s))continue;if(!os(s,ss((this._views._roles.mappings||{})[s]||s)(t,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class es{constructor(t){u(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function ss(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function is(t,e){return function(t){return t.status===fe.READY&&!t.ongoing}(e)?{empty:!!os(t,e&&e.value)}:{}}function os(t,e){switch(t){case ae.ANSWER:case ae.REASONING:return!e||!e.value;default:return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}}function ns(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class rs{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new H({target:this,error:s}),d(this,{facets:new as(this,e)}),this._unsubscribes=[t._options.on("filters",()=>this._syncOptions())],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return c({facets:Object.freeze({}),sort:ns(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(c({...t,...e,facets:Object.freeze(c({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class as{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter(t=>t!==e);0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const cs=Symbol.for("miso:tracked");function ls(t){return!!t[cs]}function us(t){t[cs]=!0}const ds=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function ms(t,e){return!!e&&{...t,...e}}class hs{constructor(t,{workflow:e,extensions:s,layouts:i,roles:o,options:n}){this._hub=t,this._workflow=e,this._workflowName=e._name,this._extensions=s,this._layoutFactory=i,this._options=n,this._roles=o,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new rs(this);for(const t of o.members)t!==ae.CONTAINER&&(this._views[t]=new ts(this,t));d(this,{interface:new _s(this),trackers:new ps(this,o.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on("data",t=>this.refresh({data:t})),n.on("layouts",()=>this._syncLayouts())],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new ts(this,ae.CONTAINER);e.layout=this._createLayout(ae.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===ae.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);await Promise.all(s.map(s=>s.refresh({force:t,data:e})))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...o}=t;return c({...ds,...o,impression:ms(ds.impression,e),viewable:ms(ds.viewable,s),click:ms(ds.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=ae.CONTAINER;this._containerTracker=new Je({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class _s{constructor(t){this._actor=t,u(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map(t=>t.interface)}}class ps{constructor(t,e){this._views=t;for(const s of e)s!==ae.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,ae.CONTAINER,{get:()=>t._getContainerTracker()})}}class fs{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",t=>this._trigger(t))]}_trigger(t){this._hub.trigger("tracker",{type:de.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class gs{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",t=>this._handle(t))]}_handle(t){0!==(t=r(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function bs(t){return async({group:e,name:o,payload:n,options:r})=>{if(e===s.ASK)switch(o){case i.QUESTIONS:return t.api.ask.questions(n,r);case i.SEARCH:return t.api.ask.search(n,r)}return t.api[e]._run(o,n,r)}}class ys{constructor({role:t,workflow:e,...s}={}){d(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),o=I(!1);e=this._preprocess({state:e,rendered:i},{skip:o.t})||e,this._updatePending(e,s),o.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,w(t=>this._doRaf(t)))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const o=this._rendered.get(this._element),n=I([]),r=I({});this._render(this._element,{state:s,rendered:o,timestamp:t},{notifyUpdate:n.args,writeToState:r.merge,...e}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),i&&i(...n.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ws(...t){return t.reduce((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t),{})}function vs(t,e,s,i){const{templates:o}=t,[n,r]=js(t,s);return""+n+(o.indexBlock||qs)(t,s,i)+(o.infoBlock||o.articleInfoBlock||Ss)(t,s,i)+r}function ks(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Os)(t,e,s)+(o.descriptionBlock||Ts)(t,e,s)+(o.priceBlock||Ls)(t,e,s)+(o.ctaBlock||Us)(t,e,s)}</div>`}function Es(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Os)(t,e,s)+(o.descriptionBlock||Ts)(t,e,s)+(o.priceBlock||Ls)(t,e,s)}</div>`}function xs(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Os)(t,e,s)+(o.dateBlock||As)(t,e,s)+(o.descriptionBlock||Ts)(t,e,s)+(o.ctaBlock||Us)(t,e,s)}</div>`}function Ss(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Os)(t,e,s)+(o.authorsAndDateBlock||Ns)(t,e,s)}</div>`}function Is(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Os)(t,e,s)}</div>`}function Os({className:t},{title:e,_title_with_markups:s}){const i=Fs(s)||k(e);return i?`<div class="${t}__item-title">${i}</div>`:""}function Cs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ts({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${Fs(e)}</div>`:s?`<div class="${t}__item-desc">${k(s)}</div>`:""}function As({className:t,templates:e},{created_at:s,updated_at:i,published_at:o}){const n=o||s||i;return n?`<div class="${t}__item-date">${Ms(n,e.date)}</div>`:""}function Rs({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function Ns(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-authors-and-date-container">${""+(o.authorsBlock||Rs)(t,e,s)+(o.dateBlock||As)(t,e,s)}</div>`}function Ls(t,e){const{className:s,templates:i}=t,{sale_price:o,original_price:n,currency:r="USD"}=e,a=o||n;if(!a)return"";const c=void 0!==n&&void 0!==o&&n>o,l=e.discount_rate_percent||(c?Math.floor(100*(1-o/n)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${n}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||$s)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function $s(t,{discount_rate_percent:e}){return`(${e}% off)`}function Ps(t,e,s={}){const{className:i,templates:o}=t,{cover_image:n,image_src:r,image_alt:a}=e;if(!n&&!r)return"";const c=r?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${n}">`}${"cover-image"===c&&s.brand?(o.brandBlock||Cs)(t,e,s):""}</div>`}function qs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Us(t,e,s){const{className:i,templates:o}=t,n=Bs.asFunction(o.cta)(t,e,s);return n?`<div class="${i}__item-cta-container">${n}</div>`:""}function js({className:t,options:e={}},{product_id:s,url:i},{classSuffix:o="item-body",role:n="item",...r}={}){const a=!1!==r.link&&i?"a":"div";return[`<${a} class="${t}__${o}" ${n?`data-role="${n}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==r.link&&i?`href="${i}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:i=!0}=t;let o="";i&&(e&&(o+=` target="${e}"`),s&&(o+=` rel="${s}"`));return o}(e.link)}`:""}>`,`</${a}>`]}const Ds=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),zs="en-US";function Ms(t,e=Ds){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Ds.locale,e);default:throw Error("Invalid date format: "+e)}}function Fs(t){return t&&t.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Bs=Object.freeze({tagPair:js,formatDate:Ms,formatNumber:function(t,e=zs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||zs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},formatHtmlWithMarkup:Fs,escapeHtml:k,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Qs extends ys{constructor({className:t,templates:e,...s}={}){super(s),d(this,{className:t,templates:{...ws("root"),...e,helpers:Bs}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Gs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Gs.MisoClient.ui.layouts.create("banner").render(this)}}class Hs{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let o=!1;try{await v(t,{...e,signal:i}),o=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return o}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Ws extends ys{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Hs}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Gs.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some(({role:t})=>function(t){return t===ae.PRODUCTS||t===ae.ANSWER}(t)):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:o,empty:n=!1,unanswerable:r=!1}={}}=e,a=[s,n?fe.EMPTY:fe.NONEMPTY];s===fe.READY&&a.push(i?fe.ONGOING:fe.DONE),r&&a.push(fe.UNANSWERABLE),t.setAttribute("status",a.join(" ")),o?t.setAttribute("miso-id",o):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===fe.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Vs=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:o,value:n}=e;return"erroneous"!==o?"":`<div class="${s}"><div class="${s}__message">${i.message(t,n)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Ks extends Qs{static get type(){return"error"}static get defaultTemplates(){return Vs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Vs,...e},...s})}}const Ys=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Zs(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class Js{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,o=new Map,n=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],l=Object.freeze({index:r,key:a,value:e[r],element:c});i.set(a,l),o.set(c,l),n.push(l)}return{k2b:i,e2b:o,entries:n}}(t,e,s),o={k2b:this._k2b,e2b:this._e2b,entries:this._entries},n=Zs(o,i),r=Zs(i,o);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:n,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function Xs(t){j(t,ti.prototype)}class ti{_initTrackable(){this._bindings=new Js,this._viewables=new Hs}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map(t=>this._getItemKey(t)),o=this._getItemElements(t),{bounds:n,unbounds:r}=this._bindings.update(i,s,o);this._onBindingsUpdate(n,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map(({value:t})=>t))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!ls(e)&&0===e.button&&!e.defaultPrevented&&!!b(e.target,t=>"A"===t.tagName&&t.href||void 0))})(s,t)&&(us(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class ei{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===fe.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await v(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const si=Object.freeze({product:function(t,e,s,i){const{templates:o}=t,[n,r]=js(t,s);return""+n+(o.imageBlock||Ps)(t,s,i)+(o.infoBlock||o.productInfoBlock||Es)(t,s,i)+r},article:function(t,e,s,i){const{templates:o}=t,[n,r]=js(t,s);return""+n+(o.imageBlock||Ps)(t,s,i)+(o.infoBlock||o.articleInfoBlock||xs)(t,s,i)+(o.indexBlock||qs)(t,s,i)+r},compactArticle:vs,image:function(t,e,s,i){const{templates:o}=t,[n,r]=js(t,s);return""+n+(o.imageBlock||Ps)(t,s,i)+(o.infoBlock||o.imageInfoBlock||Is)(t,s,i)+r},question:function(t,e,s){const[i,o]=js(t,s);return`${i}${s.value||s.text||s}${o}`},root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e;return`<div class="${s} ${r}"${i?` data-role="${i}"`:""}${n.itemType?` data-item-type="${n.itemType}"`:""}>${r===fe.READY?o[r](t,e):""}${o.trigger(t,e)}${o.loading(t,e)}</div>`},[fe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e)||[];return i.length>0||e.ongoing?s.body(t,e,i):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:i,templates:o,options:n}=t,r=o.ordered?"ol":"ul";return`<${r} class="${i}__list" data-role="list"${n.itemType?` data-item-type="${n.itemType}"`:""}>${o.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:o}=t;let n=i;return s.map(s=>o.item(t,e,s,n++)).join("")},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item">${n[a](t,e,s,{index:i})}</li>`},productInfoBlock:Es,articleInfoBlock:xs,compactArticleInfoBlock:Ss,imageInfoBlock:Is,brandBlock:Cs,titleBlock:Os,descriptionBlock:Ts,dateBlock:As,authorsBlock:Rs,authorsAndDateBlock:Ns,priceBlock:Ls,discountRateText:$s,ctaBlock:Us,cta:function(t,e,s){const{templates:i}=t,{url:o}=e;if(!o)return"";const[n,r]=js(t,{url:o},{classSuffix:"item-cta",role:"cta"}),a=Bs.asFunction(i.ctaText)(t,e,s);return a?`${n}${a}${r}`:""},imageBlock:Ps,indexBlock:qs,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class ii extends Qs{static get defaultTemplates(){return si}constructor({templates:t,itemType:e="product",...s}){super({templates:{...si,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:o}=e;if(i)if(o){this._getListElement(t).insertAdjacentHTML("beforeend",o)}else s(!1);else t.innerHTML=o}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:o}=e;this._view._events.emit("click",{session:s,value:i,element:o,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Xs(ii.prototype),j(ii.prototype,ei.prototype);const oi="miso-list";class ni extends ii{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return oi}constructor({className:t=oi,...e}={}){super({className:t,...e})}}const ri="miso-horizontal";class ai extends ii{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ri}constructor({className:t=ri,...e}={}){super({className:t,...e})}}const ci="miso-cards";function li(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function ui(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function di(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),i=e[2]||"";return[s,i]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function mi(t){return void 0===t||t instanceof hi?t:new hi(t)}class hi{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=mi(t),mi([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class _i{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,w(()=>this._syncDisplayedSwipeableItemIndex()))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),i=e.itemCount,o=e.itemCount=s?s.length:void 0;o!==i&&(void 0===o?e.itemIndex=void 0:void 0===i&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(li(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let i=0;for(const e of s.children)ui(e,"active",i===t),i++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const pi="miso-ui-icon",fi=pi+"-svg-1_12_1",gi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},bi=`<symbol id="${pi}-${gi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,yi=`<symbol id="${pi}-${gi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,wi=`<symbol id="${pi}-${gi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,vi=`<svg id="${fi}" style="display:none;">${[bi,yi,wi,`<symbol id="${pi}-${gi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${pi}-${gi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${pi}-${gi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${pi}-${gi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let ki=!1;function Ei(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${pi}-${t}"></use></svg>`}ki||document.head.querySelector("#"+fi)||(ki=!0,document.head.insertAdjacentHTML("beforeend",vi));const xi=new Set(Object.values(gi));Ei(gi.SEND),Ei(gi.SEARCH);const Si=Ei(gi.TRIANGLE);Ei(gi.TRIANGLE_EQ);const Ii=Ei(gi.CHEVRON),Oi=Ei(gi.CHEVRON_NEGATIVE),Ci=Ei(gi.BULB),Ti="miso-carousel",Ai=Object.freeze({body:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${o.list(t,e,s)}</div></div>${o.controls(t,e,s)}`},controls:function(t,e,s){const{templates:i}=t;return`${i.controlContainer(t,e,"previous")}${i.controlContainer(t,e,"next")}${i.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-container-${s}">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?Oi:Ii},indexIndicator:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map(s=>`<li class="${i}__index-indicator-item">${o.indexIndicatorItem(t,e,s)}</li>`).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Ri=Object.freeze({...ii.defaultTemplates,...Ai});class Ni extends ii{static get type(){return"carousel"}static get defaultTemplates(){return Ri}static get defaultClassName(){return Ti}constructor({className:t=Ti,templates:e,...s}={}){super({className:t,templates:{...Ai,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){j(t,_i.prototype)}(Ni.prototype);const Li="16rem",$i=Object.freeze({...ii.defaultTemplates,item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r,c=n[a](t,e,s,{index:i});return`<li class="${o}__item${s._size?` ${o}__item-${s._size}`:""}">${c}</li>`}}),Pi="miso-gallery";class qi extends ii{static get type(){return"gallery"}static get defaultTemplates(){return $i}static get defaultClassName(){return Pi}constructor({className:t=Pi,templates:e,...s}={}){super({className:t,templates:{...$i,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=s?void 0:this._bodyHtml(t),o=this._itemsHtml(t,e);return{...t,...c({incremental:s,bodyHtml:i,itemsHtml:o})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const i=this._renderListElement(t,e,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:i}=e;return s||(t.innerHTML=i),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,i)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const i=t.children.length,o=this._writeItemSizes((this._getItems(e)||[]).slice(i),s,i);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,o,{offset:i}))}_writeItemSizes(t,[e=0,s=0]=[],i=0){let o=0;i>0&&(o=Math.min(i,e),i-=o,e-=o),i>0&&(o=Math.min(i,s),i-=o,s-=o);const n=[];for(const i of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),n.push({...i,_size:t})}return n}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=mi(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:i}=e,{height:o=Li}=this.options,n=di(o),r=t.clientWidth;if(0===r)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(r*i.width*2/(n*i.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),i=t;const o=Math.min(Math.floor(s/3),i);i-=o,s-=3*o;const n=Math.min(s,i);return i-=n,s-=n,[o,n,i]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,i=0]=e;const{className:o}=this;for(const e of t.children){let t=!1,n=!1;s>0?(t=!0,s--):i>0&&(n=!0,i--),ui(e,o+"__item-large",t),ui(e,o+"__item-medium",n),ui(e,o+"__item-small",!t&&!n)}}}const Ui="miso-search-box";const ji=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:o,autocomplete:n}=t,{placeholder:r}=o;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${n.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:o}=e;var n;return("function"==typeof i?i(t):""+i)+("function"==typeof o?o(t):(xi.has(n=o)?Ei(n):"")||""+o)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:o}=t;t={templates:s,workflow:i,...o};const n=[],r=[];for(const t of e)(t.product?n:r).push(t);return s.queries(t,r)+(r.length>0&&n.length>0?"<hr>":"")+s.products(t,n)},completionList:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map(s=>o.completionItem(t,e,s)).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:o}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${o[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||k(e)},product:function(t,{product:e}){const{templates:s}=t,[i,o]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+o},imageBlock:Ps,productInfoBlock:Es}),Di=Object.freeze({className:"miso-autocomplete",debounce:300});class zi extends Qs{static get type(){return"search-box"}static get defaultTemplates(){return ji}static get defaultClassName(){return Ui}constructor({className:t=Ui,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...ji,...e},...i}),d(this,{autocomplete:{...Di,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=P(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",t=>this._syncInput(t)),e.on("keydown",t=>this._handleKeyDown(t)),e.on("click",t=>this._handleClick(t)),e.on("focusin",t=>this._handleFocusIn(t)),e.on("focusout",t=>this._handleFocusOut(t)),s.on("completions",()=>t.refresh({force:!0}))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:o=fe.INITIAL,session:n,value:r}=e.completions,{index:a}=n;if(s&&s.completions.index===a&&s.completions.status===o)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);ui(t,"nonempty",u.length>0),l.setAttribute("data-status",o),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:o}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Mi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Mi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce(()=>s._view.hub.update("input",{value:e}))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&b(t,t=>t===this._element||void 0)||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),o=this._context().data.get(parseInt(e)),n=o&&o.text;return n&&(s&&(s.value=n),this._view._events.emit("select",Object.freeze({value:o,index:e,domEvent:t})),t.defaultPrevented||this._submit(n)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[de.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Mi{static empty(){return Mi._empty||(Mi._empty=new Mi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const o in t)for(const n of t[o])n.product&&!n.product.url||(n._index=e,n._field=o,s.set(e,n),i.push(n),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Fi="miso-option-list";const Bi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${o.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map((e,s)=>i.option(t,e,{index:s})).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${k(e.text||e)}</li>`}});class Qi extends Qs{static get type(){return"option-list"}static get defaultTemplates(){return Bi}static get defaultClassName(){return Fi}constructor({className:t=Fi,templates:e,...s}={}){super({className:t,templates:{...Bi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;ui(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}Xs(Qi.prototype);const Gi=Object.freeze({...ws("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Hi extends Qs{static get defaultTemplates(){return Gi}constructor({className:t,templates:e,field:s,defaultValue:i,...o}={}){super({className:t,templates:{...Gi,...e},...o}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,()=>this._refresh()),e.on("click",t=>this._handleClick(t))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=b(t,t=>t.hasAttribute("data-value")?t:void 0);if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const o=e.getAttribute("data-value");s||void 0===i||i!==o?this._select(o):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],w(()=>this._syncValueAttribute())}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Wi="miso-feedback",Vi=["helpful","unhelpful"];const Ki=Object.freeze({options:function(t){const{templates:e}=t;return Vi.map(s=>e.option(t,{value:s})).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:o={}}=t;return`\n${!1!==o.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==o.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Yi extends Hi{static get type(){return"feedback"}static get defaultTemplates(){return Ki}static get defaultClassName(){return Wi}constructor({className:t=Wi,templates:e,...s}={}){if(super({className:t,templates:{...Ki,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Zi="miso-text";const Ji=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:o=!1,tag:n}}=t,r=i?`data-role="${i}"`:"",a=void 0!==e?k(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[o,n]=e;switch(o){case"date":return t=>s(t,n);case"number":return t=>i(t,n);default:return t=>""+t}}(t)(e)):"";return o?a:`<${n} class="${s}" ${r}>${a}</${n}>`}});class Xi extends Qs{static get type(){return"text"}static get defaultTemplates(){return Ji}static get defaultClassName(){return Zi}constructor({className:t=Zi,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Ji,...e},tag:s,...i})}}class to extends ys{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=I(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class eo{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:o,done:n}){const r=i.length;o=Math.min(o,r);const a=!!n&&o===r,c=e.substring(0,s),l=!i.startsWith(c);return a||l?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,o)),a&&t.classList.add("done"),{cursor:o,done:a}}}function so(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:o,builtInStyles:n=!0}}=t;"auto"===i&&(i="markdown"===o?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,io(e)];n&&"markdown"===o&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${r} data-format="${o}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||fe.INITIAL),i}function io(t){return t+"__cursor"}function oo(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:o,operation:n,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${no(i[0])}, ${no(i[1])})`,e,""+n,o,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function no(t){return Math.floor(100*t)/100+"ms"}const ro="miso-typewriter";class ao extends to{static get type(){return"typewriter"}static get defaultClassName(){return ro}constructor({className:t=ro,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:o,acceleration:n,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:i,...a}),d(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:z({speed:o,acceleration:n}),this._readiness=new C,"markdown"===s&&ao.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=io(this.className),{onDebug:s,onCitationLink:i,variant:o}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:oo(s),variant:o}),this._unsubscribes.push(this._view.proxyElement.on("click",t=>this._onClick(t)))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new eo}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:{value:s="",stage:i,finished:o}={},session:n,status:r}=t,a=(u=t,(l=e)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const d=e?a&&i===e.stage?e.streak:e.streak+1:0,m=a&&e&&e.doneAt||(r===fe.READY&&o?performance.now():void 0);return this._prevState=Object.freeze(c({session:n,status:r,value:s,stage:i,streak:d,doneAt:m,done:void 0!==m}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:o,loop:n}){const r=so(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}o(a);const l=e.status===fe.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===fe.READY)&&!c}),l&&n()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const i=e.closest("a");if(i){if(!t.defaultPrevented){const{href:e,innerText:s,className:o}=i;e&&this._view._events.emit("link-click",c({event:t,url:e,text:s?s.trim():"",className:o||"",attributes:co(i)}))}}else;}}function co(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const lo="miso-affiliation";const uo=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e,a=i?` data-role="${i}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),d=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${n.itemType?` data-item-type="${n.itemType}"`:""}${void 0!==d?` data-item-count="${d}"`:""}>${r===fe.READY?o[r](t,e):""}</div>`},[fe.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}-container">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Si},body:function(t,e){const{className:s,templates:i}=t,o=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,o)}</div>`},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item"><div class="${o}__item-inner">${n.itemHeader(t,e,s,{index:i})}${n[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:o,templates:n}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=n;return r=Bs.asFunction(r)(t,e,s,i),a=Bs.asFunction(a)(t,e,s,i),`<div class="${o}__item-header">\n  <div class="${o}__item-header-left">${r}</div>\n  <div class="${o}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:o}=t,[n,r]=js(t,s,{link:!1});return""+n+(o.infoBlock||o.affiliationInfoBlock||ks)(t,s,i)+(o.imageBlock||Ps)(t,s,{brand:!0,...i})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:o,templates:n}=t,r=Bs.asFunction(n.logoText)(t,e,s,i)||"",a=Bs.asFunction(n.logoImg)(t,e,s,i);return a?`<span class="${o}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:o,templates:n}=t,r=Bs.asFunction(n.logoUrl)(t,e,s,i);if(!r)return"";const a=Bs.asFunction(n.logoAltText)(t,e,s,i);return`<img class="${o}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),mo=Object.freeze({...ii.defaultTemplates,...uo});class ho extends ii{static get type(){return"affiliation"}static get defaultTemplates(){return mo}static get defaultClassName(){return lo}constructor({className:t=lo,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...uo,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Y(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,w(()=>this._syncItemIndex()))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(li(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const _o="miso-facets",po="miso-facet",fo="custom_attributes.";const go=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${o.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map(o=>s.facet(t,{field:o,entries:i[o]},e))},facet:function(t,e,s){const{facetClassName:i=po,templates:o}=t,{field:n}=e;return`<div class="${i}" data-role="facet" data-field="${k(n)}">${o.header(t,e,s)}${o.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=po,templates:o}=t;return`<div class="${i}__header">${o.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(fo)&&(e=e.substring(18)),k(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:o=po,templates:n}=t;return`<ul class="${o}__options" data-role="options">${s.map(([s,o])=>n.option(t,{field:e,value:s,count:o},i)).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=po,templates:o}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${o.value(t,e,s)}</span>\n  <span class="${i}__count">${o.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return k(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function bo(t,e){return`${t}:::${e}`}function yo(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class wo extends Qs{static get type(){return"facets"}static get defaultTemplates(){return go}static get defaultClassName(){return _o}constructor({className:t=_o,templates:e,...s}={}){super({className:t,templates:{...go,...e},...s}),this._bindings=new Js}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t)),s.on("update",t=>this._updateSelections(t)),s.on("reset",()=>this._syncSelections())]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=yo(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=yo(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],o=[],n=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),r=s[t];if(!r)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=r[e];if(!c)break;i.push(bo(t,c)),o.push({field:t,value:c}),n.push(s)}}this._bindings.update(i,o,n)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[k(t)]=e[t].map(([t])=>t);return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:o,value:n}=i;this._view.filters.facets.toggle(o,n),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const vo="miso-select";const ko=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t,n=i?`data-role="${i}"`:"",r=t._getItems(e),a=r.find(t=>t.selected)||r[0];return`\n<div class="${s}" ${n}>\n  ${o.button(t,a)}\n  ${o.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map((e,s)=>i.option(t,e,{index:s})).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return k(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,(t,e)=>" "+e)||e||"")}});class Eo extends Qs{static get type(){return"select"}static get defaultTemplates(){return ko}static get defaultClassName(){return vo}constructor({className:t=vo,templates:e,...s}={}){super({className:t,templates:{...ko,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}Xs(Eo.prototype);const xo="miso-more-button";const So=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==fe.READY?" disabled":""}>\n  ${o.text(t)}\n</div>\n`},text:function(t){return"More"}});class Io extends Qs{static get type(){return"more-button"}static get defaultTemplates(){return So}static get defaultClassName(){return xo}constructor({className:t=xo,templates:e,...s}={}){super({className:t,templates:{...So,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",t=>this._handleClick(t))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var Oo=Object.freeze({__proto__:null,TemplateBasedLayout:Qs,ContainerLayout:Ws,ErrorLayout:Ks,BannerLayout:class extends Qs{static get type(){return"banner"}static get defaultTemplates(){return Ys}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Ys,...e},...s})}},CollectionLayout:ii,ListLayout:ni,HorizontalLayout:ai,CardsLayout:class extends ii{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ci}constructor({className:t=ci,...e}={}){super({className:t,...e})}},CarouselLayout:Ni,GalleryLayout:qi,SearchBoxLayout:zi,OptionListLayout:Qi,FeedbackLayout:Yi,TextLayout:Xi,TypewriterLayout:ao,AffiliationLayout:ho,FacetsLayout:wo,SelectLayout:Eo,MoreButtonLayout:Io});function Co(t){return t&&t.value&&t.value.revision}function To(t){const e=function(t){if(!t)return fe.INITIAL;const{request:e,error:s,value:i}=t;return s?fe.ERRONEOUS:i?fe.READY:e?fe.LOADING:fe.INITIAL}(t);return c({status:e,ongoing:e===fe.READY?t.ongoing:void 0,...t})}function Ao(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:i}=s;i&&(e.meta.miso_id=i)}function Ro(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:o}=i||{};return o?{...t,value:{...s,keywords:o}}:t}function No(t){const{role:e,type:s,items:i}=t,o={type:"viewable"===s?"viewable_impression":s,context:{custom_context:c({property:e})}};switch(function(t){return _e.has(t)}(s)&&(!function(t){return ue.has(t)}(e)?(o.product_ids=[],o.context.custom_context.items=(i||[]).map(t=>t.text||t.id||t)):o.product_ids=(i||[]).map(t=>"string"==typeof t?t:t.product_id).filter(t=>t)),s){case de.SUBMIT:o.context.custom_context.value=t.value;break;case de.FEEDBACK:o.context.custom_context.value=o.value=t.value,o.context.custom_context.result_type=o.result_type=t.result_type}return c(o)}function Lo(t={},e={}){return c({...t,...e,context:c({...t.context,...e.context,custom_context:c({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const $o=Object.freeze({}),Po=Object.freeze({[ae.CONTAINER]:Ws.type,[ae.ERROR]:Ks.type}),qo=Object.freeze({}),Uo=Object.freeze({api:$o,layouts:Po,trackers:qo}),jo=Object.freeze({mappings:{[ae.ERROR]:t=>t.error}});class Do extends V{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:o,options:n}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=o,this._options=n||new Ae(e&&e._options,o),this._hub=new De({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({roles:t}){const e=this._hub,s=this._client,i=this._options,o=this._extensions,n=this._plugin.layouts;this._sessions=new ze(e),this._data=new Fe(e,{source:bs(s),options:i}),this._views=new hs(e,{extensions:o,layouts:n,roles:t,options:i,workflow:this}),this._interactions=new gs(e,{client:s,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",t=>this.updateData(t)),this._hub.on("tracker",t=>this._onTracker(t))],t.main&&this._unsubscribes.push(this._hub.on(je(t.main),t=>this._onMainViewUpdate(t)))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:i}){i||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[je(t)]||{};e.session&&e.status===fe.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===fe.READY,i=e===fe.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),o=i.has(t);return i.add(t),!o}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=ie(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Co(t);if(!l(s)){const t=Co(this._hub.states.data);if(!l(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=To(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:fe.READY,session:this.session,...e},this._hub.update(je(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=No(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==ae.AFFILIATION)return t;const{items:s}=e;return Lo(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map(t=>t.position)}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return Lo(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[je(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?Lo(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function zo(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Mo(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map(t=>({...t}));let o=0;for(const t of i)s&&(t.channel=s),t.position=o++;return{...t,affiliation:{...e,products:i}}}(t)}function Mo({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Fo)}}function Fo({id:t,deeplink:e,headline:s,description:i,currency:o,retailPrice:n,salePrice:r,discountRate:a,image:l,thumbnail:u,merchant:d,...m}){return c({id:"sovrn-"+t,title:s,description:i,cover_image:l,url:e,currency:o,original_price:n,sale_price:r,discount_rate_percent:a,brand:d&&d.name,brand_logo:d&&d.logo,custom_attributes:Bo({sovrn_id:t,thumbnail:u,merchant:d,...m})})}function Bo(t,e=""){return Object.keys(t).reduce((s,i)=>{const o=t[i];if(void 0===o)return s;const n=e?`${e}_${i}`:i;return"object"==typeof o?{...s,...Bo(o,n)}:{...s,[n]:o}},{})}function Qo(t){j(t,Go.prototype)}$e(Do.prototype),Object.assign(Do,{DEFAULT_API_OPTIONS:$o,DEFAULT_LAYOUTS:Po,DEFAULT_TRACKERS:qo,DEFAULT_OPTIONS:Uo,ROLES_OPTIONS:jo});class Go{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const Ho=Object.freeze({...Do.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Do.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Wo=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),Vo=Object.freeze({...Do.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{placeholder:"Ask a question"}],[ae.QUESTION]:[Xi.type,{tag:"h2"}],[ae.ANSWER]:ao.type,[ae.FEEDBACK]:Yi.type,[ae.IMAGES]:[qi.type,{incremental:!0,itemType:"image"}],[ae.SOURCES]:[ni.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[ae.AFFILIATION]:[ho.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Ko=Object.freeze({...Do.DEFAULT_TRACKERS,[ae.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Ee.click},[ae.IMAGES]:Ee,[ae.SOURCES]:Ee,[ae.AFFILIATION]:Ee,[ae.PRODUCTS]:Ee}),Yo=Object.freeze({...Do.DEFAULT_OPTIONS,api:Ho,autocomplete:Wo,layouts:Vo,trackers:Ko}),Zo=Xt(Do.ROLES_OPTIONS,{main:ae.ANSWER,members:Object.keys(Vo),mappings:{[ae.ANSWER]:function(t){if(!t||!t.value)return;const{answer:e="",answer_stage:s,finished:i}=t.value;return Object.freeze({value:e,stage:s,finished:!!i})},[ae.REASONING]:function(t){if(!t||!t.value)return;const{reasoning:e="",reasoning_finished:s}=t.value;return Object.freeze({value:e,stage:"reasoning",finished:!!s})}}});class Jo extends Do{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new fs(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._views.get(ae.ANSWER).on("citation-click",t=>this._onCitationClick(t)),this._views.get(ae.ANSWER).on("link-click",t=>this._onAnswerLinkClick(t))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[je(this._roles.main)]||{};t.session&&t.status!==fe.INITIAL&&(t.status!==fe.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===fe.READY&&!t.ongoing,o=e===fe.ERRONEOUS,n=i?"done":o?"error":e,r=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(n,t),(i||o)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){qe.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||re}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:zo(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_updateUrlIfNecessary({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,o=t&&t.question||e&&e.payload&&e.payload.question,n=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source;if(!o)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(i)||re;o===a&&n===c||(r.searchParams.set(s,o),n===re?r.searchParams.delete(i):r.searchParams.set(i,n),window.history.replaceState({},"",r))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=function(t,{event_target:e}={}){return e?Lo(t,{context:{custom_context:{event_target:e}}}):t}(t=this._writeAnswerClickInteraction(t,e),e)}_writeAskPropertiesToInteraction(t={},e){return Lo(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==ae.ANSWER)return t;const{items:s=[]}=e;return Lo(t,{context:{custom_context:{urls:s.map(t=>t.url),texts:s.map(t=>t.text),class_names:s.map(t=>t.className),attributes:s.map(t=>t.attributes)}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[je(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t,event:e}){if(ls(e))return;const{value:s}=this.states.data||{},{sources:i}=s||{},o=i&&i[t-1];o&&o.product_id&&(us(e),this._views.trackers.sources.click([o.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){ls(t)||(us(t),this._views.trackers.answer.click([],{items:[e]}))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Qo(Jo.prototype),Object.assign(Jo,{DEFAULT_API_OPTIONS:Ho,DEFAULT_AUTOCOMPLETE_OPTIONS:Wo,DEFAULT_LAYOUTS:Vo,DEFAULT_TRACKERS:Ko,DEFAULT_OPTIONS:Yo,ROLES_OPTIONS:Zo});const Xo=Object.freeze({...Jo.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...Jo.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),tn=Object.freeze({...Jo.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{templates:{buttonIcon:"send"}}],[ae.REASONING]:ao.type,[ae.RELATED_RESOURCES]:[ni.type,{incremental:!0,itemType:"article"}],[ae.QUERY_SUGGESTIONS]:Qi.type}),en=Object.freeze({...Jo.DEFAULT_TRACKERS,[ae.RELATED_RESOURCES]:Ee,[ae.QUERY_SUGGESTIONS]:{...Ee,click:{...Ee.click,validate:t=>0===t.button}}}),sn=Object.freeze({...Jo.DEFAULT_OPTIONS,api:Xo,layouts:tn,trackers:en}),on=Xt(Jo.ROLES_OPTIONS,{members:Object.keys(tn),mappings:{[ae.QUERY_SUGGESTIONS]:function(t,{workflow:e}={}){const s=e.previous,i=s&&s.states.data.value,o=i&&(i.suggested_followup_questions||i.followup_questions||[]);return o&&o.map(t=>({text:t}))}}});class nn extends Jo{constructor(t,e){super({name:"ask",context:t,roles:on,defaults:sn,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;d(this,{parentQuestionId:e})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on(je(ae.REASONING),t=>this._onReasoningViewUpdate(t))]}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:i}=this;let o=c({...s,question:t,parent_question_id:i,_meta:{...s._meta,question_source:e||re}});return o=this._writeWikiLinkTemplateToPayload(o),o}_updateData(t){super._updateData(t),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:t}=this;if(!t)return;const e=t._views.get(ae.QUERY_SUGGESTIONS);e&&e.refresh()}_onReasoningViewUpdate({status:t,ongoing:e}){if(t!==fe.READY||e)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,o,n,{property:r}=t.context&&t.context.custom_context||{};return e.role===ae.QUERY_SUGGESTIONS?(r="suggested_followup_questions",o=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,n=this.previous&&this.previous.session.meta.question_source):(o=this.parentQuestionId,i=this.questionId,n=this._getQuestionSourceFromViewState(e)),Lo(t,{context:{custom_context:{property:r,root_question_id:s,parent_question_id:o,question_id:i,question_source:n}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const t=this._views.get(ae.REASONING),e=t&&t.element;return e&&e.closest('[data-role="reasoning-box"]')}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class rn extends Ue{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new nn(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new nn(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const an=Object.freeze({...Do.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Do.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),cn=Object.freeze({...Do.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type],[ae.PRODUCTS]:[ni.type,{incremental:!0,infiniteScroll:!0}],[ae.KEYWORDS]:[Xi.type,{raw:!0}],[ae.TOTAL]:[Xi.type,{raw:!0,format:"number"}],[ae.FACETS]:[wo.type],[ae.SORT]:[Eo.type],[ae.MORE]:[Io.type]}),ln=Object.freeze({...Do.DEFAULT_TRACKERS,[ae.PRODUCTS]:Ee}),un=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),dn=Object.freeze({...Do.DEFAULT_OPTIONS,api:an,layouts:cn,trackers:ln,pagination:un}),mn=Xt(Do.ROLES_OPTIONS,{main:ae.PRODUCTS,members:Object.keys(cn),mappings:{[ae.FACETS]:"facet_counts",[ae.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:o}=e.states.filters||{},n=o&&o.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return n?i.map(t=>({...t,selected:t.field===n})):i}}});class hn extends Do{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._hub.on("filters",()=>this._refine()),this._hub.on("more",()=>this._more()),this._views.get(ae.SORT).on("select",t=>this._handleSortSelect(t))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){qe.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this._views.filters.reset({silent:!0}),this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==fe.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return c({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return r(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map(t=>t.product_id).filter(t=>t),o=[...t.exclude||[],...i];return 0===o.length?t:{...t,exclude:o}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case fe.INITIAL:case fe.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=Ro(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=ae.PRODUCTS}={}){const{status:s,request:i,value:o}=t;if(s!==fe.READY||!i||!o)return t;const{[e]:n}=o;if(!n)return t;const{rows:r}=i.payload,{length:a}=n;return r>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=ae.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:o,total:n}=t.value,{[s]:r=[]}=e.value;return{...e,value:{...e.value,facet_counts:o,total:n,[s]:[...i,...r]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}$e(hn.prototype,[be.PAGINATION,be.FILTERS]),Object.assign(hn,{DEFAULT_API_OPTIONS:an,DEFAULT_LAYOUTS:cn,DEFAULT_TRACKERS:ln,DEFAULT_PAGINATION:un,DEFAULT_OPTIONS:dn,ROLES_OPTIONS:mn});const _n=Object.freeze({members:[]});function pn({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function fn(t){return t&&t.value&&t.value.trim()||void 0}class gn extends Do{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:pn(e),roles:_n,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",t=>this._query(t))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,fn(t)===fn(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!fn(t))return void this._updateCompletions({session:s,status:fe.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:fn(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function bn(t){j(t,yn.prototype)}class yn{_initAutocomplete(t){this._autocomplete=new gn(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const wn=Xt(Jo.ROLES_OPTIONS,{mappings:{[ae.QUESTION]:ae.KEYWORDS}});class vn extends Jo{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:wn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset({silent:!0}),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._writeWikiLinkTemplateToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||re}}}_defaultProcessData(t){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:i}={}}=e;return i?{...t,meta:{...t.meta,miso_id:i}}:t}(t=Ro(t=super._defaultProcessData(t))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_updateDataInHub(t){switch(t.status){case fe.INITIAL:case fe.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),Ao(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}bn(vn.prototype);const kn={...hn.ROLES_OPTIONS,members:[ae.PRODUCTS,ae.KEYWORDS,ae.TOTAL,ae.FACETS,ae.SORT,ae.MORE,ae.ERROR]};class En extends hn{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:kn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:c({...t._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(t){return Ao(t=super._defaultProcessData(t)),t}_defaultProcessInteraction(t,e){return this._superworkflow._defaultProcessInteraction(t,e)}_defaultProcessInteraction0(t,e){return super._defaultProcessInteraction(t,e)}}Object.assign(En,{ROLES_OPTIONS:kn});class xn{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return En.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap(t=>t._views)}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const Sn=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...Jo.DEFAULT_API_OPTIONS.payload,...hn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),In=Object.freeze({...Jo.DEFAULT_LAYOUTS,...hn.DEFAULT_LAYOUTS,[ae.QUERY]:[zi.type,{placeholder:""}],[ae.QUESTION]:[Xi.type,{raw:!0}],[ae.SOURCES]:[ai.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:vs,articleInfoBlock:Ss}}]}),On=Object.freeze({...Jo.DEFAULT_TRACKERS,...hn.DEFAULT_TRACKERS}),Cn=Object.freeze({...hn.DEFAULT_PAGINATION,active:!0}),Tn=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),An=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Rn=Object.freeze({...Jo.DEFAULT_OPTIONS,...hn.DEFAULT_OPTIONS,api:Sn,layouts:In,trackers:On,autocomplete:Tn,pagination:Cn,filters:An}),Nn=Object.freeze({main:ae.PRODUCTS,members:Object.keys(In),mappings:Object.freeze({...Jo.ROLES_OPTIONS.mappings,...hn.ROLES_OPTIONS.mappings})});class Ln extends Do{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Nn,defaults:Rn})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new vn(this),this._results=new En(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){this._views=new xn(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return t=this._answer._defaultProcessInteraction0(t,e),t=this._results._defaultProcessInteraction0(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}$e(Ln.prototype,[be.PAGINATION,be.FILTERS]);const $n=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),Pn=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),qn=Object.freeze({...hn.DEFAULT_LAYOUTS}),Un=Object.freeze({...hn.DEFAULT_TRACKERS}),jn=Object.freeze({...hn.DEFAULT_OPTIONS,api:$n,autocomplete:Pn,layouts:qn,trackers:Un}),Dn=hn.ROLES_OPTIONS;class zn extends hn{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Dn,defaults:jn})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=ae.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}bn(zn.prototype);class Mn extends Ue{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=ne){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=ne){return this._members.has(t)}get(t=ne){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class Fn extends Do{_initProperties(t){super._initProperties(t);const{id:e}=t;d(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return Lo(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(Fn,{DEFAULT_API_OPTIONS:Do.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Do.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Do.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Do.DEFAULT_OPTIONS,ROLES_OPTIONS:Do.ROLES_OPTIONS});const Bn=Object.freeze({...Fn.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...Fn.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Qn=Object.freeze({...Fn.DEFAULT_LAYOUTS,[ae.PRODUCTS]:ni.type}),Gn=Object.freeze({...Fn.DEFAULT_TRACKERS,[ae.PRODUCTS]:Ee}),Hn=Object.freeze({...Fn.DEFAULT_OPTIONS,api:Bn,layouts:Qn,trackers:Gn}),Wn=Xt(Fn.ROLES_OPTIONS,{main:ae.PRODUCTS,members:Object.keys(Qn)});class Vn extends Fn{constructor(t,e){super({name:"recommendation",context:t,roles:Wn,defaults:Hn,id:e})}start(){return this._request(),this}notifyViewUpdate(t=ae.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class Kn extends Mn{constructor(t,e){super("recommendations",t,e)}_create(t){return new Vn(this,t)}}const Yn=Object.freeze({...Fn.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),Zn=Object.freeze({...Fn.DEFAULT_LAYOUTS,[ae.RELATED_QUESTIONS]:[ni.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[ae.QUERY]:[zi.type,{placeholder:"Ask a question"}]}),Jn=Object.freeze({...Fn.DEFAULT_TRACKERS,[ae.RELATED_QUESTIONS]:Ee,[ae.CONTAINER]:{...Ee,itemless:!0},[ae.QUERY]:{[de.SUBMIT]:{active:!0}}}),Xn=Object.freeze({...Fn.DEFAULT_OPTIONS,api:Yn,layouts:Zn,trackers:Jn}),tr=Xt(Fn.ROLES_OPTIONS,{main:ae.RELATED_QUESTIONS,members:Object.keys(Zn)});class er extends Fn{constructor(t,e){super({name:"explore",context:t,roles:tr,defaults:Xn,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(ae.RELATED_QUESTIONS).on("click",t=>this._handleRelatedQuestionClick(t)),this._hub.on("query",t=>this._query(t))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Go.prototype.useLink.call(this,t,e),e&&this.useLayouts({[ae.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=ae.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Go.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Qo(er.prototype);class sr extends Mn{constructor(t,e){super("explores",t,e)}_create(t){return new er(this,t)}}class ir extends V{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new C)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var or=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var nr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class rr{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class ar{constructor(t){this._context=t,d(this,{lowerCamelToKebab:_,kebabToLowerCamel:m,kebabOrSnakeToLowerCamel:h})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=h(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:i=!1}){const{classPrefix:o}=t;return`<${s} class="${i?o+"__phrase-inline":o+"__phrase"} ${o}__${e}-phrase">${this.phraseText(t,m(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:o,trait:n,logo:r=!1},a){const c=[`${t}__${i}-container`];return e&&c.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:c,visibleWhen:o,trait:n,logo:r,parentQuestionId:s},a)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${_(t)}="${i}"`)}return s}}const cr=D(new ar({...or,DEFAULT_PHRASES:nr})),lr=D(new class extends rr{constructor(){super({helpers:cr})}answerGroup(t){const{container:e}=this._helpers;return[this.question(t),this.reasoning(t),this.answer(t),this.affiliation(t),this.sources(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"question",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",s(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(t={}){const{phrases:e,reasoning:s={}}=t,{container:i,element:o,phraseText:n}=this._helpers,r=[];return s.expand&&r.push("expanded"),i(t,{name:"reasoning",visibleWhen:"nonempty"},[o("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[o("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||Ci}</div>`,`<div class="miso-collapsible__title" data-role="title">${n(e,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ii}</div>`]),o("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:o={},logo:n=!0}=t;return i(t,{name:"related-resources"},!1===o.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:n},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:i={}}=t;return!1===i.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:cr}));function ur(t={}){const{normalizeOptions:e,section:s,container:i}=cr,{querySuggestions:o,answerGroup:n}=lr;return s(t=e(t),{name:"follow-up"},[o(t),i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...n(t)])}var dr=Object.freeze({__proto__:null,helpers:cr,sections:lr,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=cr,{followUps:o,relatedResourcesSection:n,answerGroup:r}=lr;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},r(t))+o(t)+n(t)},followUp:ur});const mr=Object.freeze(or),hr=Object.freeze(nr),_r=Object.freeze(dr);var pr=Object.freeze({__proto__:null,constants:mr,phrases:hr,templates:_r,wireFollowUps:function(t,e,{template:s=ur,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const o=t.ui.asks,n=t.ui.ask;o.on("done",t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))}),n.on("loading",()=>{e.innerHTML="",o.reset({root:!1})})},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow})}});const{currentScript:fr}=document,gr=Object.freeze({templates:_r,autostart:!0}),br=["templates","phrases","features"];class yr{constructor(){this._defaults=gr,this._scriptSrc=function(){if(!fr||!fr.src)return{};const t=document.createElement("a");t.href=fr.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=kr(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=kr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...o}={}){return c({apiKey:t,apiHost:e,templates:Er(s),phrases:i,...o})}(wr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function wr(...t){let e={};for(const s of t)s&&(e=vr(e,s));return e}function vr(t,e){if(!e)return t;Object.assign(t,e);for(const s of br)s in e&&(t[s]={...t[s],...e[s]});return t}function kr(t){return""===t||"false"!==t&&t}function Er(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Er):function(t,e){const s={};for(const[i,o]of Object.entries(t))s[i]=e(o);return s}(t,Er);default:throw Error("Unsupported template type: "+t)}}class xr{constructor(t,{classPrefix:e=mr.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");d(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Sr extends ir{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new yr,this._localOptions={}}config(t={}){t=wr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})})}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;d(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new xr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:o,wireRelatedResources:n}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=i,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&o(e,s.followUpsSection,{...i,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&n(e,s.relatedResourcesSection),l.autoQuery()}}class Ir extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}const Or="trait",Cr=Object.freeze([Or]);class Tr extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return Cr}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const t of this._traits)this._destroyTrait(t);this._traits=[]}attributeChangedCallback(t){if(t===Or)this._syncTraits()}_syncTraits(){const t=(this.getAttribute(Or)||"").split(/\s+/).filter(Boolean),e=[];for(const s of this._traits)t.includes(s.constructor.traitName)?e.push(s):this._destroyTrait(s);if(t.length>0){const s=function(t){const e=t.ui&&t.ui.traits||{};return Object.values(e).reduce((t,e)=>(t[e.traitName]=e,t),{})}(Tr.MisoClient);for(const i of t){if(this._traits.find(t=>t.constructor.traitName===i))continue;const t=s[i];if(!t){console.warn("Unknown trait: "+i);continue}const o=new t(this);e.push(o)}}this._traits=e}_destroyTrait(t){try{t._destroy&&t._destroy()}catch(t){console.error(t)}}}let Ar,Rr,Nr;async function Lr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Ar||(Ar=async function(){return new Promise(t=>{(window.misocmd||(window.misocmd=[])).push(()=>t(window.MisoClient))})}())}(t);var s;return Rr=Rr||e.any(),Nr=Nr||await Rr,Nr.ui||await(s=0,new Promise(t=>setTimeout(t,s))),Nr}const $r="logo",Pr="auto",qr=Object.freeze([...Tr.observedAttributes,$r]);function Ur(t){if(!t)return Pr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class jr extends Tr{static get observedAttributes(){return qr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Ur(this.getAttribute($r))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Pr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute($r,e):this.removeAttribute($r)}async connectedCallback(){super.connectedCallback();const t=this._client=await Lr(jr);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===$r)this._handleLogoUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleLogoUpdate(t,e){Ur(t)!==Ur(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Dr="parent-question-id",zr=Object.freeze([...jr.observedAttributes,Dr]);const Mr="unit-id",Fr=Object.freeze([...jr.observedAttributes,Mr]);class Br extends jr{static get observedAttributes(){return Fr}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(Mr)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Mr,t):this.removeAttribute(Mr)}attributeChangedCallback(t,e,s){if(t===Mr)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var Qr=Object.freeze({__proto__:null,MisoAskElement:class extends jr{static get tagName(){return"miso-ask"}static get observedAttributes(){return zr}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Dr)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Dr,t):this.removeAttribute(Dr))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Dr)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Br{static get tagName(){return"miso-explore"}static get observedAttributes(){return Br.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends jr{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return jr.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends jr{static get tagName(){return"miso-search"}static get observedAttributes(){return jr.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Br{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Br.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const Gr="role",Hr=Object.freeze([Gr]);class Wr extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Hr}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Gr);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Gr}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Gr}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Gr&&this._container&&this._container._updateComponentRole(this,e,s)}}var Vr=Object.freeze({__proto__:null,MisoComponentElement:Wr,MisoQueryElement:class extends Wr{constructor(){super({role:ae.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Wr{constructor(){super({role:ae.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Wr{constructor(){super({role:ae.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Wr{constructor(){super({role:ae.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Wr{constructor(){super({role:ae.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Wr{constructor(){super({role:ae.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Wr{constructor(){super({role:ae.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends Wr{constructor(){super({role:ae.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends Wr{constructor(){super({role:ae.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Wr{constructor(){super({role:ae.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Wr{constructor(){super({role:ae.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Wr{constructor(){super({role:ae.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends Wr{constructor(){super({role:ae.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Wr{constructor(){super({role:ae.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Wr{constructor(){super({role:ae.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Wr{constructor(){super({role:ae.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Wr{constructor(){super({role:ae.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Wr{constructor(){super({role:ae.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Wr{constructor(){super({role:ae.ERROR})}static get tagName(){return"miso-error"}}});class Kr extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Kr.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var Yr=Object.freeze({__proto__:null,containers:Qr,roles:Vr,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Kr{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Gs,MisoStubElement:Tr});const Zr="miso-hybrid-search-combo";var Jr=Object.freeze({__proto__:null,CLASS_PREFIX:Zr,CONAINER_TAG:"miso-hybrid-search"});const Xr="Show more",ta="Show less";var ea=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",total:"${value} Results",showMore:Xr,showLess:ta});const sa=D(new ar({...Jr,DEFAULT_PHRASES:ea})),ia=D(new class extends rr{constructor(){super({helpers:sa})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:sa}));var oa=Object.freeze({__proto__:null,helpers:sa,sections:ia,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=sa;t=e(t);const{answerBox:o,answerGroup:n,searchResultsGroup:r}=ia,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[o(t)]:n(t))+s(t,{name:"search-results"},r(t))}});const na="answer-box-open",ra="answer-box-shown",aa='[data-role="answer-box-toggle"]';class ca{constructor(t,e,{classPrefix:s=Zr,phrases:i={},hideWhenUnanswerable:o=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=o,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push(()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)});const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",()=>this._syncWofkflowStatus())]}_handleClick({target:t,button:e}){0===e&&t.closest(aa)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case fe.ERRONEOUS:case fe.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ta:this._phrases.showMore||Xr;for(const e of this._element.querySelectorAll(aa))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const la={isOpen:na,shown:ra},ua={toggleOpen:["toggle",na],open:["add",na],close:["remove",na],toggleHidden:["toggle",ra],show:["add",ra],hide:["remove",ra]};for(const[t,e]of Object.entries(la))Object.defineProperty(ca.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(ua))ca.prototype[t]=function(){this._updateBoxStatus(e,s),s===na&&(this._syncButtonText(),this._syncScroll())};const da=Object.freeze(Jr),ma=Object.freeze(ea),ha=Object.freeze(oa);var _a=Object.freeze({__proto__:null,constants:da,phrases:ma,templates:ha,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new ca(t,e,s)}});const pa=Object.freeze(pr),fa=Object.freeze(_a);var ga=Object.freeze({__proto__:null,ask:pa,hybridSearch:fa});function ba(t){const e=t._element;if(!e)return()=>{};const s=e=>t._handleClick(e);return e.addEventListener("click",s),()=>e.removeEventListener("click",s)}const ya="miso-collapsible",wa="expanded",va=[{action:"expand",classAction:"add",className:wa},{action:"collapse",classAction:"remove",className:wa}];class ka{static get traitName(){return"collapsible"}constructor(t){this._element=t,t.collapsible=this,t.classList.add(ya),this._unsubscribes=[ba(this)]}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(ya),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(t,e){for(const s of e)Object.defineProperty(t,s,{get(){return this._element&&this._element.classList.contains(s)}})}(ka.prototype,[wa]),function(t,e){for(const{action:s,classAction:i,className:o}of e)t[s]=function(){this._element&&this._element.classList[i](o),this["_"+s]&&this["_"+s]()}}(ka.prototype,va),function(t,e){t._handleClick=function(t){const{target:s,button:i}=t;if(0===i)for(let{role:i,selector:o,action:n}of e)if(o=o||`[data-role="${i}"]`,o&&s.closest(o))return this[n](),void t.stopPropagation()}}(ka.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var Ea=Object.freeze({__proto__:null,CollapsibleTrait:ka});let xa,Sa;async function Ia(){return Sa||(Sa=N(xa||(xa=L("ui"))))}class Oa{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Ca{constructor(t,e){this._plugin=t,this._client=e,d(this,{sources:{api:bs(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new zn(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Ln(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Ta{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Sr(this._plugin,this._MisoClient))}}At.plugins.use(class extends V{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Ir(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new C}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:ga,traits:Ea};u(s,this,["layouts","combo","ready"]),d(this,{MisoClient:t}),d(t,{ui:s}),this.combo=new Ta(this,t);const i=Object.values(Oo).filter(t=>t.type);for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:o,roles:n,combos:r,...a}=Yr,c=[...Object.values(r),...Object.values(o),...Object.values(n),...Object.values(a)],l=[jr,Kr];for(const e of[...l,...c])e.MisoClient=t;await Ia();for(const t of c)y(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then(()=>{})}_injectClient(t){d(t,{ui:new Ca(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Oa(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new Kn(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new sr(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new rn(this,t)),e}}),At.attach(),function(t){const e=[];function s(t){e.push(t)}A("misodev",{transform:t=>()=>t({addCmdTransform:s})});const i=t=>{for(const s of e)t=s(t);return t};setTimeout(()=>{A("misocmd",{transform:i}),t&&t()})}(function(){It._cmdRes.resolve()});const Aa=function(t){if(null==t)return Na;if("function"==typeof t)return Ra(t);if("object"==typeof t)return Array.isArray(t)?function(t){const e=[];let s=-1;for(;++s<t.length;)e[s]=Aa(t[s]);return Ra(i);function i(...t){let s=-1;for(;++s<e.length;)if(e[s].apply(this,t))return!0;return!1}}(t):function(t){const e=t;return Ra(s);function s(s){const i=s;let o;for(o in t)if(i[o]!==e[o])return!1;return!0}}(t);if("string"==typeof t)return function(t){return Ra(e);function e(e){return e&&e.type===t}}(t);throw Error("Expected function, string, or object as test")};function Ra(t){return function(e,s,i){return!(!function(t){return null!==t&&"object"==typeof t&&"type"in t}(e)||!t.call(this,e,"number"==typeof s?s:void 0,i||void 0))}}function Na(){return!0}const La=[],$a=!0,Pa=!1;function qa(t,e,s,i){let o;"function"==typeof e&&"function"!=typeof s?(i=s,s=e):o=e;const n=Aa(o),r=i?-1:1;!function t(o,a,c){const l=o&&"object"==typeof o?o:{};if("string"==typeof l.type){const t="string"==typeof l.tagName?l.tagName:"string"==typeof l.name?l.name:void 0;Object.defineProperty(u,"name",{value:"node ("+o.type+(t?"<"+t+">":"")+")"})}return u;function u(){let l,u,d,m=La;if((!e||n(o,a,c[c.length-1]||void 0))&&(m=function(t){if(Array.isArray(t))return t;if("number"==typeof t)return[$a,t];return null==t?La:[t]}(s(o,c)),m[0]===Pa))return m;if("children"in o&&o.children){const e=o;if(e.children&&"skip"!==m[0])for(u=(i?e.children.length:-1)+r,d=c.concat(e);u>-1&&e.children.length>u;){if(l=t(e.children[u],u,d)(),l[0]===Pa)return l;u="number"==typeof l[1]?l[1]:u+r}}return m}}(t,void 0,[])()}const Ua=()=>'\n<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n  <path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/>\n</svg>',ja=t=>`\n<miso-explore>\n  <miso-related-questions></miso-related-questions>\n  <div class="miso-dialogs">\n    <div class="miso-dialog__header">\n      <div>Welkom bij Libelle Lekker!</div>\n      <div>Stel je kookvraag aan Maia...</div>\n    </div>\n    <div class="miso-dialog__body">\n      ${t}\n    </div>\n    <div class="miso-dialog__footer">\n      <a href="/maia" target="_blank" rel="noopener noreferrer">Meer info</a>\n    </div>\n  </div>\n</miso-explore>`,Da=(t,e,s)=>{const{templates:{helpers:{tagPair:i}}}=t,[o,n]=i(t,s);return`${o}${s.value||s.text||s}\n<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n  <path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/>\n</svg>${n}`},za=()=>{const t=document.querySelector(".miso-email-form__input"),e=document.querySelector(".miso-email-form__button");t&&e&&e.addEventListener("click",()=>{window.open(`https://www.mijnmagazines.be/journey/93847e20-6f51-4dc2-a40a-43723a1833a2?authCode=HH&utm_source=brandsite&utm_medium=wp&utm_term=hh&utm_campaign=hh_multi_LIL_Chatbot&email=${encodeURIComponent(t.value)}&returnUrl=https://www.libelle-lekker.be/maia?rmg_dologin=start`,"_blank").focus()})},Ma="BLURRED_INGREDIENT_TABLE",Fa=()=>t=>{!function(t,e,s,i){let o,n,r;"function"==typeof e&&"function"!=typeof s?(n=void 0,r=e,o=s):(n=e,r=s,o=i),qa(t,n,function(t,e){const s=e[e.length-1],i=s?s.children.indexOf(t):void 0;return r(t,i,s)},o)}(t,{type:"text",value:Ma},(t,e,s)=>{s.children[e]={type:"element",tagName:"div",properties:{className:["miso-blurred-table","miso-blurred-table--init"]}}})},Ba=async t=>{await t.ui.ready;const e=t.ui.ask,s=t.ui.asks,i=At.ui.defaults.ask,o=i.wireFollowUps,n=i.wireRelatedResources,r="anonymous"===t.context.user_type,a=document.querySelector("#miso-ask-combo");a?(a.innerHTML=r?'\n<section class="miso-ask-combo__section miso-ask-combo__question">\n  <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" logo="false">\n    <miso-query></miso-query>\n  </miso-ask>\n</section>\n<div class="miso-email-form">\n  <div class="miso-email-form__message">\n    <h2>Meld je eerst even aan of registreer je om Maia, onze Libelle Lekker chatbot te gebruiken.</h2>\n  </div>\n  <div class="miso-email-form__background-reflection"></div>\n  <div class="miso-email-form__form">\n    <div class="miso-email-form__input-group">\n      <input class="miso-email-form__input" type="email" data-role="input" placeholder="Je e-mailadres">\n      <button class="miso-email-form__button" type="submit" data-role="submit">\n        \n<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n  <path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/>\n</svg>\n      </button>\n    </div>\n  </div>\n</div>':'\n<section class="miso-ask-combo__section miso-ask-combo__question">\n  <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" logo="false">\n    <miso-query></miso-query>\n  </miso-ask>\n</section>\n<section class="miso-ask-combo__section miso-ask-combo__answer">\n  <miso-ask class="miso-ask-combo__question-container miso-circled-citation-index" visible-when="ready" logo="false">\n    <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">Jij vroeg…</div>\n    <miso-question></miso-question>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__reasoning-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <miso-stub trait="collapsible" data-role="reasoning-box">\n      <div class="miso-collapsible__header" data-role="toggle-expand">\n        <div class="miso-collapsible__icon">\n          <svg class="miso-ui-icon miso-ui-icon-bulb">\n            <use href="#miso-ui-icon-bulb"></use>\n          </svg>\n        </div>\n        <div class="miso-collapsible__title" data-role="title">Thoughts</div>\n        <div class="miso-collapsible__toggle">\n          <svg class="miso-ui-icon miso-ui-icon-chevron">\n            <use href="#miso-ui-icon-chevron"></use>\n          </svg>\n        </div>\n      </div>\n      <div class="miso-collapsible__body">\n        <miso-reasoning></miso-reasoning>\n      </div>\n    </miso-stub>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false">\n    <miso-answer></miso-answer>\n    <miso-feedback></miso-feedback>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <miso-affiliation></miso-affiliation>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <hr />\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">Dit antwoord is gebaseerd op de volgende artikels</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__bottom-spacing-container miso-circled-citation-index" visible-when="ongoing" logo="false"></miso-ask>\n</section>\n<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>\n<section class="miso-ask-combo__section miso-ask-combo__related-resources">\n  <miso-ask class="miso-ask-combo__related-resources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <h2 class="miso-ask-combo__phrase miso-ask-combo__related-resources-phrase">Leer meer over dit onderwerp</h2>\n    <miso-related-resources></miso-related-resources>\n  </miso-ask>\n</section>',r&&(s.useApi(!1),za()),s.useLayouts({query:{placeholder:"Stel ons je kookvraag…",templates:{buttonIcon:Ua}},answer:{variant:["slot","<miso-images></miso-images>"]},feedback:{templates:{text:(t,e)=>"helpful"===e?"Nuttig":"Niet nuttig"}}}),s.useDataProcessor(t=>t?.value?(t.value.answer=(t=>t.replace(/<!-- TOP_NOTICE START -->[\s\S]*?<!-- TOP_NOTICE END -->\n*/,"").replaceAll(/<!-- BLURRED_INGREDIENT_TABLE -->/g,Ma))(t.value.answer),t):t),await At.plugins.install("std:ui-markdown"),t.ui.markdown.config({renderer:{parser:{rehype:[Fa]}}}),s.on("data",({status:t})=>{"ready"===t&&document.querySelectorAll(".miso-blurred-table.miso-blurred-table--init").forEach(t=>{t.innerHTML='\n\n<table>\n  <thead>\n    <tr>\n      <th>Ingrediënt </th>\n      <th>Hoeveelheid </th>\n      <th>Eenheid </th>\n      <th>Opmerkingen</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Eieren</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n    <tr>\n      <td>Suiker</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n    <tr>\n      <td>Bloem</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n    <tr>\n      <td>Melk</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n    <tr>\n      <td>Boter</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n    <tr>\n      <td>Vetstof</td>\n      <td>3</td>\n      <td>stuks</td>\n      <td>Bij voorkeur op kamertemperatuur</td>\n    </tr>\n  </tbody>\n</table>\n<div class="miso-blurred-table__overlay">\n  <div class="miso-blurred-table__overlay-content">\n    <div class="miso-blurred-table__overlay-content-title">\n      Ontgrendel deze ingrediënten\n    </div>\n    <div class="miso-blurred-table__overlay-content-description">\n      Word abonnee en krijg toegang tot de ingrediënten van dit én 20.000 andere recepten.\n    </div>\n    <button class="miso-blurred-table__overlay-content-button" onclick="window.open(\'https://www.mijnmagazines.be/promo/YK72B\',\'_blank\')">\n      Meer informatie\n      <svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none">\n        <g clip-path="url(#clip0_21039_4612)">\n          <path d="M8.82069 13.0237C8.74802 12.7421 8.60119 12.485 8.39548 12.2793C8.18976 12.0736 7.93269 11.9267 7.65099 11.8541L2.65719 10.5663C2.57199 10.5421 2.49701 10.4908 2.44361 10.4202C2.39022 10.3495 2.36133 10.2634 2.36133 10.1748C2.36133 10.0862 2.39022 10.0001 2.44361 9.92943C2.49701 9.85877 2.57199 9.80745 2.65719 9.78327L7.65099 8.49473C7.93259 8.42213 8.1896 8.27542 8.3953 8.06987C8.601 7.86431 8.74789 7.6074 8.82069 7.32585L10.1084 2.33205C10.1323 2.24652 10.1836 2.17116 10.2544 2.11748C10.3251 2.0638 10.4115 2.03474 10.5003 2.03474C10.5892 2.03474 10.6755 2.0638 10.7463 2.11748C10.8171 2.17116 10.8683 2.24652 10.8923 2.33205L12.1792 7.32585C12.2519 7.60755 12.3987 7.86463 12.6044 8.07034C12.8101 8.27605 13.0672 8.42288 13.3489 8.49555L18.3427 9.78246C18.4286 9.80614 18.5043 9.85735 18.5583 9.92822C18.6122 9.9991 18.6415 10.0857 18.6415 10.1748C18.6415 10.2639 18.6122 10.3505 18.5583 10.4214C18.5043 10.4922 18.4286 10.5435 18.3427 10.5671L13.3489 11.8541C13.0672 11.9267 12.8101 12.0736 12.6044 12.2793C12.3987 12.485 12.2519 12.7421 12.1792 13.0237L10.8915 18.0175C10.8675 18.1031 10.8163 18.1784 10.7455 18.2321C10.6747 18.2858 10.5884 18.3149 10.4995 18.3149C10.4107 18.3149 10.3243 18.2858 10.2536 18.2321C10.1828 18.1784 10.1315 18.1031 10.1076 18.0175L8.82069 13.0237Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <path d="M17.0118 2.84894V6.10488" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n          <path d="M18.6399 4.47691H15.3839" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n          <path d="M3.98816 14.2447V15.8727" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n          <path d="M4.80204 15.0587H3.17407" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n        </g>\n        <defs>\n          <clipPath id="clip0_21039_4612">\n            <rect width="19.5356" height="19.5356" fill="currentColor" transform="translate(0.732178 0.406982)"/>\n          </clipPath>\n        </defs>\n      </svg>\n    </button>\n  </div>\n</div>',t.classList.remove("miso-blurred-table--init"),t.classList.add("miso-blurred-table--done")})}),o(t,a.querySelector(".miso-ask-combo__follow-ups"),{template:({parentQuestionId:t})=>(({parentQuestionId:t})=>`\n<section class="miso-ask-combo__section miso-ask-combo__follow-up">\n  <miso-ask class="miso-ask-combo__query-suggestions-container miso-circled-citation-index" visible-when="initial+nonempty" logo="false" parent-question-id="${t}">\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__query-suggestions-phrase">Gerelateerde vragen die je kunt verkennen</h3>\n    <miso-query-suggestions></miso-query-suggestions>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" visible-when="initial loading" logo="false" parent-question-id="${t}">\n    <miso-query></miso-query>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__question-container miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${t}">\n    <hr />\n    <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">Jij vroeg…</div>\n    <miso-question></miso-question>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__reasoning-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n    <miso-stub trait="collapsible" data-role="reasoning-box">\n      <div class="miso-collapsible__header" data-role="toggle-expand">\n        <div class="miso-collapsible__icon">\n          <svg class="miso-ui-icon miso-ui-icon-bulb">\n            <use href="#miso-ui-icon-bulb"></use>\n          </svg>\n        </div>\n        <div class="miso-collapsible__title" data-role="title">Thoughts</div>\n        <div class="miso-collapsible__toggle">\n          <svg class="miso-ui-icon miso-ui-icon-chevron">\n            <use href="#miso-ui-icon-chevron"></use>\n          </svg>\n        </div>\n      </div>\n      <div class="miso-collapsible__body">\n        <miso-reasoning></miso-reasoning>\n      </div>\n    </miso-stub>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${t}">\n    <miso-answer></miso-answer>\n    <miso-feedback></miso-feedback>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n    <miso-affiliation></miso-affiliation>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n    <hr />\n    <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">Dit antwoord is gebaseerd op de volgende artikels</h3>\n    <miso-sources></miso-sources>\n  </miso-ask>\n  <miso-ask class="miso-ask-combo__bottom-spacing-container miso-circled-citation-index" visible-when="ongoing" logo="false" parent-question-id="${t}"></miso-ask>\n</section>`)({parentQuestionId:t})}),n(t,a.querySelector(".miso-ask-combo__related-resources")),e.on("request",({payload:t})=>{const{question:e}=t,s=document.querySelector(".miso-search-box__input");!s.value&&e&&(s.value=e)}),e.autoQuery()):console.error("[Miso] No root element found: #miso-ask-combo")},Qa=async(t,e)=>{const s=t.ui.explore,i="anonymous"===t.context.user_type,o=document.querySelector("#miso-explore-questions");o?(o.innerHTML=ja(i?'\n<div class="miso-dialog__body-description"><strong>Meld je eerst even aan</strong> of <strong>registreer je</strong> om Maia, onze Libelle Lekker chatbot te gebruiken.</div>\n<div class="miso-email-form__form">\n  <div class="miso-email-form__input-group">\n    <input class="miso-email-form__input" type="email" data-role="input" placeholder="Je e-mailadres">\n    <button class="miso-email-form__button" type="submit" data-role="submit">\n      \n<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">\n  <path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/>\n</svg>\n    </button>\n  </div>\n</div>\n':"<miso-query></miso-query>"),i&&za(),s.useLayouts({query:{placeholder:"Probeer de Libelle Lekker chatbot uit!",templates:{buttonIcon:Ua}},related_questions:["list",{templates:{question:Da}}]}),s.useApi({product_id:e}),s.useLink(t=>"/maia?q="+encodeURIComponent(t)),s.start()):console.error("[Miso] No root element found: #miso-explore-questions")};!function(t){const e={_client:!1,_init(){if(this._client)return;const t=new At("q4YYvyy77WaLp0LJwHLqt1dhAFMrlfpFcNkEI0Lu");t.context.anonymous_id=E(),this._client=t},setUserInfo(t){const{userId:e,userType:s}=t;e&&(this._client.context.user_id=e),s&&(this._client.context.user_type=s)},answer(){Ba(this._client)},explore(t){Qa(this._client,t)}};e._init(),t.MisoForRoularta||(t.MisoForRoularta=e)}(window)}();
