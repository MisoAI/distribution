!function(){"use strict";const t="home",e="answers",s="search",i="article",n="other",r=["cover_image","custom_attributes.site","created_at","product_id","published_at","snippet","title","updated_at","url"],o='type:article AND ((NOT custom_attributes.languages:*) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)';var a="0.9.33";var c=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,i]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===i||i);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const u={key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"},l=window.location.hostname!==u.hostname;var h={...u,dev:l};function _(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const d=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),p=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var m=Object.freeze({__proto__:null,GROUP:d,NAME:p});function f(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function g(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function y(t){return null!=t?""+t:t}function w(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function b(t){return null==t}function v(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function E(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function k(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function S(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function I(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class C{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);x(s),x(i),x(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>O(this,t)),e):O(this,t),this._value=t}disconnect(){this._active=!1}}function O(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function x(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function R(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function T(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function $(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async i=>{try{await t(i),e()}catch(t){s(t)}}))}))}async function A(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((n,r)=>{const o=new C((t=>{t&&(o.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function N(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function q(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function U(t,e){const s=P((()=>window.localStorage.getItem(t))),i=P((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t))),n=s||i||""+e();return n&&!s&&P((()=>window.localStorage.setItem(t,n))),n&&!i&&P((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n))),n}function P(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function L(t){return new j(t)}class j{constructor(t){this._value=t;const e=t=>{this._value=t};E(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class D{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class M{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new D),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var z="1.11.0-beta.9";let B;try{B=document.currentScript}catch(t){}async function F(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if(G(t))return;return new Promise((e=>{let s;s=setInterval((()=>{G(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function Q(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${z}/dist/css/${t}.css`}function G(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function W(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function H(t,{depth:e=5,...s}={}){return V(t,e)}function V(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>V(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const i={};if(0>=e)return i;for(const s in t){const n=t[s];"function"!=typeof n&&(s.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(i[s]=V(n,e-1)))}return i}(t,e):t:"(...)"}function Y(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=n[i];r&&(e[i]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}const K=100,Z=4;function X(t){const e=function({speed:t=K,acceleration:e=Z}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let n=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(n*=1+(s-i)*e/1e3),n}}(t);return(t,s,i,n)=>{const r=e(i,s);return t+Math.max(n-i,0)*r/1e3}}const J=Symbol.for("miso:resources");class tt{constructor(){this._resources=new Map;const t=window[J]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){et(this._resources,t).resolve(e)}async get(t){return et(this._resources,t).promise}}function et(t,e){if(t.has(e))return t.get(e);const s=new D;return t.set(e,s),s}function st(){return window[J]||(window[J]=new tt)}class it{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new D;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class nt{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)f(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&f(s,e)}}_injectSubscribeInterface(t){v(t,this,["on","once"])}}function rt(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class ot{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:rt(t,e),uuid:q()})}(t,e);E(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new nt({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(ot,"miso:component");class at extends ot{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new D);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class ct{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new C(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class ut{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:lt}=document,ht=lt.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function _t({}){await Promise.all([pt()])}let dt=!1;async function pt(){if(dt)return;if(dt=!0,!lt)throw Error("currentScript not found");const t=lt.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=s,i.href=t,document.head.appendChild(i)}))}(s)}function mt(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${ht}/${t}`}const ft=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"}].map((({logo_image:t,...e})=>({logo_image:mt(t),...e}))),gt=ft.reduce(((t,e)=>(t[e.key]=e,t)),{});function yt(t){return gt[t]}async function wt(t,{interval:e=300,timeout:s}={}){const i=t();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),i(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}var bt=Object.freeze(function(){const r=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(r){case"":return{type:t};case"/smart-answers":return{type:e};case"/search":return{type:s};default:if(h.regions.indexOf(r.substring(1))>=0)return{type:t}}const a=r.substring(1).split("/");if("article"===a[0]){const t=""+a[1];return{type:i,postId:t,product_id:`article_${h.key}_${t}`}}return{type:n}}());const vt="%cMiso",Et="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const kt=[];var St=function(){if(c.sponsor)return kt.find((t=>t.key===c.sponsor))||void 0}(),It=Object.freeze({__proto__:null,config:c,version:a,site:h,page:bt,sponsor:St,debug:function(...t){(c.debug||a.indexOf("beta")>=0||"dev"===a)&&function(...t){console.log(vt,Et,...t)}(...t)}}),Ct="1.11.0-beta.9";const Ot=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class xt{constructor(t,e){this._client=t,this._root=e,this._bulk=new it(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(t,w({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=Ot.DATA_ENDPOINT,eventEndpoint:s=Ot.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}}class Rt extends ot{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:Tt,NAME:$t}=m;class At extends Rt{constructor(t){super(t,Tt.INTERACTIONS)}async upload(t,e){try{return await this._run($t.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===$t.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class Nt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...i}=this._options;const n=new ut(s);let r;e=_(this._ac.signal,n.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new M;return o=setInterval((async()=>{let e,o,_;try{if([e,o,_]=await t(r?{signal:r}:{}),u||!b(a)&&a>=_)return;b(_)||(a=_),n&&n(e,o,_),c=0}catch(t){return i&&i(t),c++,void(c>s&&(l(),h.error(t)))}h.update(e,o),o&&l()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?n.clear():this._isUpdated(r,t)&&n.touch(),r=t},...i})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class qt extends Nt{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:Ut,NAME:Pt}=m;class Lt extends Rt{constructor(t){super(t,Ut.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new jt(this,t,e);const s=await this._run(Pt.QUESTIONS,t,e);return new jt(this,s,e)}async _questions(t,e){return this._run(Pt.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${Pt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(Pt.RELATED_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(Pt.SEARCH,t,e);return s.question_id?new Dt(this,s,e):s}async _searchGet(t,e){return this._run(`${Pt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}}class jt extends qt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class Dt extends qt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),E(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:Mt,NAME:zt}=m;class Bt extends Rt{constructor(t){super(t,Mt.SEARCH)}async search(t,e){return this._run(zt.SEARCH,t,e)}async autocomplete(t,e){return this._run(zt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(zt.MGET,t,e)}}const{GROUP:Ft,NAME:Qt}=m;class Gt extends Rt{constructor(t){super(t,Ft.RECOMMENDATION)}async userToProducts(t,e){return this._run(Qt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(Qt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(Qt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(Qt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(Qt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(Qt.PRODUCT_TO_PRODUCTS,t,e)}}class Wt extends ot{constructor(t,e){super("api",t),this._client=t,this.helpers=new xt(t,e),this.interactions=new At(this),this.ask=new Lt(this),this.search=new Bt(this),this.recommendation=new Gt(this)}}var Ht=Object.freeze({__proto__:null,Api:Wt,ApiBase:Rt,ApiHelpers:xt,Interactions:At,Ask:Lt,Search:Bt,Recommendation:Gt});class Vt extends ot{constructor(t){super("context",t),this._client=t}}var Yt={api:Ht,context:{Context:Vt}};class Kt{constructor(t){E(this,{install:t})}}class Zt extends at{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Xt(this,Yt),this.plugins=new Jt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new D);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return E(i,{id:t}),this._tryConfig(i,e),i;case"function":return new Kt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new st).get(s);!this.isRegistered(t)&&this.register(i)}}class Xt{constructor(t,e){v(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),E(this,{classes:e})}}class Jt{constructor(t){v(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const te=new class extends ot{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Zt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=Ct,this._cmdRes=new D}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var ee=Object.freeze({__proto__:null,viewable:A,debounce:W});const{currentScript:se}=document;class ie extends ot{static attach(){(window.MisoClients||(window.MisoClients=[])).push(ie),window.MisoClient?window.MisoClient!==ie&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=ie}static debug(){}constructor(t){super("client",te),this._config(t),this.context=new Vt(this),this.api=new Wt(this,te),function(t){te._clients.push(t),te._events.emit("create",t)}(this)}get version(){return ie.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,w(t)}_readConfigFromScriptUrl(){return w({apiKey:new URL(new Request(se.src||se.href).url).searchParams.get("api_key")||void 0})}}ie.helpers=ee,E(ie,{uuid:q()});var ne=function(t){const e=te._pluginRoot;return te.MisoClient=e.MisoClient=t,v(t,te,["version","instances","any","meta","on","once","cmdDone"]),v(t,e,["plugins"]),t}(ie);const{GROUP:re,NAME:oe}=m;let ae;class ce{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||ae||(ae=U("miso_anonymous_id",q))}set anonymous_id(t){t=y(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=y(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function ue(){const t=new URLSearchParams(window.location.search);let e=w({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class le{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function he(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:Ct};return s.uuid||(s.uuid=q()),{...t,context:{...e,custom_context:s}}}const _e="std:native-fetch";let de,pe;const me=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return de="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),de="borrowed",t.contentWindow.fetch}catch(t){pe=t}})();const fe="miso-logdump",ge="miso-logdump",ye=ge+"__download-btn",we="Miso Log";class be{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Se||(Se=F(Q("logdump")))}();let t=document.getElementById(fe);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||we,e.classList.add(ye),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=fe,t.classList.add(ge),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(fe),e=t&&t.querySelector("."+ye);e&&(e.textContent=this._options.logDownloadButtonText||we)}hideDownloadButton(){const t=document.getElementById(fe);t&&(t.style.display="none")}download(){const t=new Blob([Ee(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:ve()})}return t&&"string"==typeof t?t:`miso-log.${ve()}.jsonl`}clear(){this._logs=[]}}function ve(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Ee(t){return t.map((t=>JSON.stringify(H(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),ke(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function ke(t){return t?H(t,{depth:2}):t}let Se;const Ie="std:debug";function Ce(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}ne.plugins.register(class{constructor(t={}){this._options=t,this._logs=new be(t)}static get id(){return Ie}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Ie,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,n="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Ce)):this._log(t,e,Ce(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return _e}install(t,e){me?(e.setCustomFetch(me),t.debug(`<plugin:${_e}>`,"[info]",`Using ${de} native fetch`)):t.debug(`<plugin:${_e}>`,"[error]","Failed to obtain native fetch: "+pe.message)}}),ne.plugins.use(class extends ot{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new ce(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===re.INTERACTIONS&&s===oe.UPLOAD?this._modifyPayloadForInteractions(t,i):e===re.ASK&&s===oe.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=w({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...n,...t})))}}}),ne.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...w({page:w({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:ue()}),...t.context}})))}}}),ne.plugins.use(class extends ot{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new le(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:i}){if(e===d.SEARCH)if(s===p.SEARCH)this._captureSearchApiRequest(t,i)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),ne.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(he)}}});const Oe="data-miso-product-id",xe="default",Re="_organic",Te=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",HITS:"hits",ERROR:"error"}),$e=new Set([Te.PRODUCTS,Te.CATEGORIES,Te.ATTRIBUTES,Te.RESULTS,Te.ITEMS,Te.QUESTION,Te.ANSWER,Te.SOURCES,Te.RELATED_RESOURCES,Te.QUERY_SUGGESTIONS,Te.RELATED_QUESTIONS,Te.AFFILIATION,Te.FACETS,Te.HITS]);function Ae(t){return $e.has(t)}const Ne=Object.freeze({AUTOCOMPLETE:"autocomplete"}),qe=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",FILTERS:"filters",TEXT:"text",AFFILIATION:"affiliation",ERROR:"error"}),Ue=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit"}),Pe=[Ue.IMPRESSION,Ue.VIEWABLE,Ue.CLICK,Ue.SUBMIT],Le=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),je=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function De(t){if(0>Pe.indexOf(t))throw Error("Unrecognized event type: "+t)}function Me(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function ze(t){if(void 0===t)return;let[e,s]=g(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function Be(t){t=g(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t}function Fe(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...Qe("_meta",s,i)})});var s,i}))}function Qe(t,e,s){const i=e&&e[t],n=s&&s[t],r=i?n?{...i,...n}:i:n;return void 0!==r?{[t]:r}:{}}function Ge(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=We(t[s],i);return t}))}function We(t,e){return!1===(e=ze(e))[0]?e:t&&e?[e[0]||t[0],He(t[1],e[1])]:e||t}function He(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function Ve(...t){return t.flat().filter(Boolean)}function Ye(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function Ke(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}const Ze=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return w({group:s,name:t,payload:e})},merge:Fe},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[Te.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[Te.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Te.PRODUCTS]}: ... }) instead`),t={...s,[Te.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[Me(e)]=ze(s);return i},merge:Ge},{key:"dataProcessor",normalize:Be,merge:Ve},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>Object.assign(t,{...e,impression:Ye(t.impression,e.impression),viewable:Ye(t.viewable,e.viewable),click:Ye(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=g(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:Ke},{key:"autocomplete",normalize:function(t){if(void 0===t)throw Error("Expect autocomplete options to be an object or a boolean value: "+t);"boolean"==typeof t&&(t={actor:t});const e=Be(t.processData);return{...t,processData:e}},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>Object.assign(t,{...e,api:Fe(t.api,e.api),processData:Ve(t.processData,e.processData)})))}}];class Xe{constructor(){this._events=new nt({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class Je{constructor(t={},e={}){this._events=new nt({target:this}),this._defaults=e,this._context=t||{},this._locals={},E(this,{resolved:new es(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class ts{constructor(t,e,s,i,n){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=n}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}class es{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of Ze)Object.defineProperty(Xe.prototype,t,{get:function(){const i="_"+t;return this[i]||(this[i]=new ts(this,this._globals,t,e,s))}}),Object.defineProperty(Je.prototype,t,{get:function(){const i="_"+t;return this[i]||(this[i]=new ts(this,this._locals,t,e,s))}}),Object.defineProperty(es.prototype,t,{get:function(){const e=this._options,i=e._context[t];return s(e._defaults[t],i&&i.get(),e._locals[t])}});const ss=["api","layouts","dataProcessor","trackers","interactions"];function is(t,e=ss){for(const s of e)ns(t,s)}function ns(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function rs(t,e){let s={};for(const i of t)i&&(s=e(s,i));return w(s)}class os extends ot{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Xe}}function as(t){return t?"request:"+t:"request"}function cs(t){return t?"response:"+t:"response"}function us(t){return t?"data:"+t:"data"}function ls(t){return t?"view:"+t:"view"}is(os.prototype);class hs{constructor(){(this._events=new nt)._injectSubscribeInterface(this),this._states={},E(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class _s{constructor(t){this._hub=t,this._sessionIndex=0,v(t,this,["active"])}get active(){const t=this._hub.states.session;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this._hub.update("session",this._create(!0))}_create(t=!1){return Object.freeze({active:t,uuid:q(),index:this._sessionIndex++,meta:{}})}}const ds=new Set([Te.PRODUCTS,Te.SOURCES,Te.RELATED_RESOURCES]);function ps({property:t,misoId:e,request:s},{event:i,values:n,manual:r}){const o=s&&s._meta&&s._meta.question_source,a=function(t){return ds.has(t)}(t),c=i===Ue.SUBMIT,u=t===Te.AFFILIATION,l=a&&n?n.map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t)):c?void 0:[],h=a||c||!n?void 0:n.map((t=>t.text||t.id||t));return w({type:"viewable"===i?"viewable_impression":i,product_ids:l,miso_id:e,context:{custom_context:w({property:t,channel:u?n[0]&&n[0].channel:void 0,items:h,value:c?n:void 0,positions:u?n.map((t=>t.position)):void 0,trigger:r?"manual":"auto",question_source:o})}})}function ms(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class fs{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on(as(),(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},n={...t.options,signal:s},r=await this._source({session:e,...t,options:n});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:i,value:r._response}),r)){if(!ms(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){ms(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update(cs(),t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class gs{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{f(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:ys,VIEWABLE:ws,CLICK:bs}=Ue,{UNTRACKED:vs,TRIGGERED:Es}=Le,ks=Object.freeze({[ys]:vs,[ws]:vs,[bs]:vs});class Ss{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:ks}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||vs}set(t,e,s){De(e),function(t){if(t!==Le.UNTRACKED&&t!==Le.TRACKING&&t!==Le.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of g(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Es))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),(()=>({...ks}))))[e]=s}}const Is=[Symbol("valueless")];class Cs{constructor({hub:t,role:e,valueless:s=!1,options:i}){this._hub=t,this._role=e,this._valueless=!!s,this._options=i,this._states=new Ss(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s={}){if(this._valueless&&(s=e,e=Is),De(t),this._syncSession(),t!==Ue.SUBMIT){if(0===(e=this._states.untriggered(g(e),t)).length)return;this._states.set(e,t,Le.TRIGGERED)}const i="results"===this._role?"products":this._role,n=this._getMisoId(),r=this._getRequestPayload();this._hub.trigger("interaction",ps({property:i,misoId:n,request:r},{event:t,values:this._valueless?void 0:e,meta:s}))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Ss(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[ls(this._role)]}}for(const t of Pe)Cs.prototype[t]=function(e,s){this._trigger(t,e,s)};class Os{constructor(t,e){this._events=new nt({target:this}),this._views=t,this._config=t._rolesConfig[e]||{},E(this,{role:e,interface:new xs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new gs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===Te.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Cs({hub:e,role:t,options:()=>this._getTrackerOptions()})}return this._tracker}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:n,status:r,ongoing:o,request:a,meta:c}=e;if(!t&&!(n&&n.active))return;if(!t&&((u=e)===(l=i)||u&&l&&u.status===l.status&&u.error===l.error&&u.value===l.value&&u.ongoing===l.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(u.session,l.session)))return;var u,l;const h=(t={},e)=>{!1!==t&&this.updateState({session:n,status:r,ongoing:o,request:a,meta:c,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState({session:t,status:e,ongoing:s,request:i,meta:n,error:r},{silent:o=!1}={}){r&&(e=je.ERRONEOUS);const a=this._state=Object.freeze(w({session:t,status:e,ongoing:s,request:i,meta:n,error:r})),{role:c}=this;this.hub.update(ls(c),a,{silent:o})}_getTrackerOptions(){return this._views._getTrackerOptions(this.role)}_sliceData(t){const{value:e,error:s,status:i,meta:n,...r}=t,o={value:Rs(this._config.mapping||this.role)(t),status:i,data:e,meta:n,...r};return this.role===Te.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(e)}),w(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!Ae(s))return!1;let e=t&&t[s];if(s===Te.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class xs{constructor(t){v(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Rs(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function Ts(t={},e={}){return Object.freeze(w({...t,...e,facets:Object.freeze(w({...t.facets,...e.facets}))}))}class $s{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub,this._states=this._initialStates=Ts({});const s=this._error=this._error.bind(this);this._events=new nt({target:this,error:s}),E(this,{facets:new As(this,e)})}get states(){return this._states}update(t){const e=this._states,s=this._states=Ts({...this._states,...t});this._events.emit("update",{updates:t,states:s,oldStates:e})}reset(){const t=this._states,e=this._states=this._initialStates;this._events.emit("reset",{states:e,oldStates:t})}apply(){this._hub.update("filters",this._states),this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){}}class As{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){const s=this._filters._states.facets[t];return s&&s.includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_select(t,e){const s=this._options.multiple?[...this._filters._states.facets[t]||[],e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._filters._states.facets[t].filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const Ns=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function qs(t,e){return!!e&&{...t,...e}}class Us{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n=[],rolesConfig:r={},options:o}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=i,this._options=o,this._rolesConfig=r,this._containers=new Map,this._containerTracker=void 0,this._views={},this._trackers=new Ls(this,n),this._filters=new $s(this);for(const t of n)this._views[t]=new Os(this,t);E(this,{interface:new Ps(this)});const a=()=>this.syncSize();window.addEventListener("resize",a),this._unsubscribes=[()=>window.removeEventListener("resize",a),t.on(us(),(t=>this.refresh({data:t}))),o.on("trackers",(()=>this._syncTrackers())),o.on("layouts",(()=>this._syncLayouts()))],this._syncTrackers(),this._syncLayouts()}get trackers(){return this._trackers}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new Os(this,Te.CONTAINER);e.layout=this._createLayout(Te.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===Te.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new Os(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:i}=e._inst;t&&(s=s.filter((e=>e.role===Te.CONTAINER||t.includes(e.role)))),i&&(s=s.filter((t=>!i.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states[us()]}_syncTrackers(){this._trackerOptions=this._options.resolved.trackers}_getTrackerOptions(t){return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return w({...Ns,...n,impression:qs(Ns.impression,e),viewable:qs(Ns.viewable,s),click:qs(Ns.click,i)})}(this._trackerOptions&&this._trackerOptions[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=Te.CONTAINER;this._containerTracker=new Cs({hub:this._hub,role:t,valueless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class Ps{constructor(t){this._actor=t,v(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class Ls{constructor(t,e){this._views=t;for(const s of e)Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,Te.CONTAINER,{get:()=>t._getContainerTracker()})}}class js{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[us()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};if(!s)return;const{request:i}=e||{},{payload:n}=i||{};this._hub.trigger("interaction",this._buildInteraction(t,{question_source:n&&n._meta&&n._meta.question_source}))}_buildInteraction({value:t,unselected:e},{question_source:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_source:s,value:e?"unselected":t}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ds{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._index=-1,this._unsubscribes=[t.on("input",(()=>this._sync())),s.on("autocomplete",(()=>this._syncOptions()))],this._sync(!0)}get active(){return!1!==this._options.resolved.autocomplete.actor}get source(){return this._source}_syncOptions(){this._sync(!0)}async _sync(t=!1){if(!this.active)return;const{input:e}=this._hub.states,s=e&&e.value&&e.value.trim()||void 0;if(n=e,(!(i=this._input)&&!n||i&&n&&i.value===n.value)&&!t)return;var i,n;this._input=e;const r=++this._index;if(this._clearTimeout(),this._abortPendingRequest({type:"new-input",message:"A new input renders previous autocomplete request obsolete."}),this._emitCompletions({index:r,input:e,status:s?je.LOADING:je.INITIAL}),s)try{const t=await this._fetchCompletions(e);if(this._index!==r)return;this._emitCompletions({index:r,input:e,status:je.READY,value:t.completions})}catch(t){if(this._error(t),this._index!==r)return;this._emitCompletions({index:r,input:e,status:je.ERRONEOUS,error:t})}}async _getCompletions(t){return await this._fetchCompletions(t)}async _fetchCompletions({value:t}){const{api:e}=this._options.resolved.autocomplete,{group:s,name:i}=e,{signal:n}=this._ac||{},r={...e.options,signal:n},o={...e.payload,q:t};return await this._source({group:s,name:i,payload:o,options:r})}_clearTimeout(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}_abortPendingRequest(t){this._ac&&this._ac.abort(t),this._ac=new AbortController}_emitCompletions(t){t.source="actor",this._hub.update(us(Ne.AUTOCOMPLETE),t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"autocomplete-actor-destroy",message:"Autocomplete actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ms{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=g(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function zs(t){return async({group:e,name:s,payload:i,options:n})=>{if(e===d.ASK)switch(s){case p.QUESTIONS:return t.api.ask.questions(i,n);case p.SEARCH:return t.api.ask.search(i,n)}return t.api[e]._run(s,i,n)}}class Bs{constructor({role:t,workflow:e,...s}={}){E(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=L(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,$((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const n=this._rendered.get(this._element),r=L([]),o=L({});this._render(this._element,{state:s,rendered:n,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Fs(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function Qs(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Hs)(t,e,s)+(n.descriptionBlock||Ys)(t,e,s)+(n.priceBlock||Zs)(t,e,s)+(n.ctaBlock||ei)(t,e,s)}</div>`}function Gs(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Hs)(t,e,s)+(n.descriptionBlock||Ys)(t,e,s)+(n.priceBlock||Zs)(t,e,s)}</div>`}function Ws(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||Hs)(t,e,s)+(n.dateBlock||Ks)(t,e,s)+(n.descriptionBlock||Ys)(t,e,s)+(n.ctaBlock||ei)(t,e,s)}</div>`}function Hs({className:t},{title:e}){return e?`<div class="${t}__item-title">${N(e)}</div>`:""}function Vs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ys({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${N(s)}</div>`:""}function Ks({className:t,templates:e},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${t}__item-date">${ri(r,e.date)}</div>`:""}function Zs(t,e){const{className:s,templates:i}=t,{sale_price:n,original_price:r,currency:o="USD"}=e,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,u=e.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Xs)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Xs(t,{discount_rate_percent:e}){return`(${e}% off)`}function Js(t,e,s={}){const{className:i,templates:n}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${r}">`}${s.brand?(n.brandBlock||Vs)(t,e,s):""}</div>`}function ti({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function ei(t,e,s){const{className:i,templates:n}=t,r=oi.asFunction(n.cta)(t,e,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function si({className:t,options:e={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&i?"a":"div";return[`<${l} class="${t}__${n}" ${r?`data-role="${r}"`:""} ${s?`${Oe}="${s}"`:""} ${!1!==o.link&&i?`href="${i}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const ii=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),ni="en-US";function ri(t,e=ii){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||ii.locale,e);default:throw Error("Invalid date format: "+e)}}const oi=Object.freeze({tagPair:si,formatDate:ri,formatNumber:function(t,e=ni){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||ni.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:N,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class ai extends Bs{constructor({className:t,templates:e,...s}={}){super(s),E(this,{className:t,templates:{...Fs("root"),...e,helpers:oi}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class ci extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){ci.MisoClient.ui.layouts.create("banner").render(this)}}class ui{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let n=!1;try{await A(t,{...e,signal:i}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return n}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class li extends Bs{static get category(){return qe.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new ui}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=ci.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===Te.PRODUCTS||t===Te.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1}={}}=e,o=[s,r?je.EMPTY:je.NONEMPTY];s===je.READY&&o.push(i?je.ONGOING:je.DONE),t.setAttribute("status",o.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===je.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const hi=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class _i extends ai{static get category(){return qe.ERROR}static get type(){return"error"}static get defaultTemplates(){return hi}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...hi,...e},...s})}}const di=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function pi(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class mi{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,n=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});i.set(a,u),n.set(c,u),r.push(u)}return{k2b:i,e2b:n,entries:r}}(t,e,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=pi(n,i),o=pi(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function fi(t){!function(t,e){const s=Object.getOwnPropertyDescriptors(e);for(const e in s){if("constructor"===e)continue;const{value:i}=s[e];void 0===t[e]&&"function"==typeof i&&(t[e]=i)}}(t,gi.prototype)}class gi{_initTrackable(){this._bindings=new mi,this._viewables=new ui}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map((t=>this._getItemKey(t))),n=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!R(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}const yi=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=si(t,s);return""+r+(n.imageBlock||Js)(t,s,i)+(n.infoBlock||n.productInfoBlock||Gs)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=si(t,s);return""+r+(n.imageBlock||Js)(t,s,i)+(n.infoBlock||n.articleInfoBlock||Ws)(t,s,i)+(n.indexBlock||ti)(t,s,i)+o},question:function(t,e,s){const[i,n]=si(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===je.READY?n[r](t,e):""}</div>`},[je.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0||e.ongoing?s.list(t,e,i):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list" data-item-type="${r.itemType}">${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map((s=>n.item(t,e,s,r++))).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`},productInfoBlock:Gs,articleInfoBlock:Ws,brandBlock:Vs,titleBlock:Hs,descriptionBlock:Ys,dateBlock:Ks,priceBlock:Zs,discountRateText:Xs,ctaBlock:ei,cta:function(t,e,s){const{templates:i}=t,{url:n}=e;if(!n)return"";const[r,o]=si(t,{url:n},{classSuffix:"item-cta",role:"cta"}),a=oi.asFunction(i.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Js,indexBlock:ti});class wi extends ai{static get category(){return qe.LIST}static get defaultTemplates(){return yi}constructor({templates:t,itemType:e="product",...s}){super({templates:{...yi,...t},itemType:e,...s}),this._initTrackable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===je.READY&&e.status===je.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:n}=e;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}fi(wi.prototype);const bi="miso-list";class vi extends wi{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return bi}constructor({className:t=bi,...e}={}){super({className:t,...e})}}const Ei="miso-cards";const ki="miso-carousel",Si=Object.freeze({ready:function(t,e){const{templates:s}=t,i=t._getItems(e),n=i&&i.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return n?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-previous" data-role="previous">${n.previous(t,e)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(t,e)}</div>`},previous:Ci,next:Ci}),Ii=Object.freeze({...wi.defaultTemplates,...Si});function Ci(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Oi="miso-ui-icon",xi=Oi+"-svg-1_11_0-beta_9",Ri={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},Ti=`<symbol id="${Oi}-${Ri.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,$i=`<symbol id="${Oi}-${Ri.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,Ai=`<symbol id="${Oi}-${Ri.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,Ni=`<svg id="${xi}" style="display:none;">${[Ti,$i,Ai].join("")}</svg>`;let qi=!1;function Ui(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${Oi}-${t}"></use></svg>`}qi||document.head.querySelector("#"+xi)||(qi=!0,document.head.insertAdjacentHTML("beforeend",Ni));const Pi=new Set(Object.values(Ri));Ui(Ri.SEND),Ui(Ri.SEARCH);const Li=Ui(Ri.TRIANGLE),ji="miso-search-box";const Di=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:n,autocomplete:r}=t,{placeholder:o}=n;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=e;var r;return("function"==typeof i?i(t):""+i)+("function"==typeof n?n(t):(Pi.has(r=n)?Ui(r):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:n}=t;t={templates:s,workflow:i,...n};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:i,templates:n}=t;return`\n<ul class="${i}__${e}-list" data-role="${e}-list">\n  ${s.map((s=>n.completionItem(t,e,s))).join("")}\n</ul>`.trim()},completionItem:function(t,e,s){const{className:i,templates:n}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${n[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||N(e)},product:function(t,{product:e}){const{templates:s}=t,[i,n]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+n},imageBlock:Js,productInfoBlock:Gs}),Mi=Object.freeze({className:"miso-autocomplete",debounce:300});class zi extends ai{static get category(){return qe.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return Di}static get defaultClassName(){return ji}constructor({className:t=ji,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...Di,...e},...i}),E(this,{autocomplete:{...Mi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=W(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on(us(Ne.AUTOCOMPLETE),(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states[us(Ne.AUTOCOMPLETE)]}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:n=je.INITIAL,index:r,value:o}=e.completions;if(s&&s.completions.index===r&&s.completions.status===n)return;const a=this._context(t),{autocompleteElement:c}=a;if(!c)return;const u=a.trackItems(o);t.classList[u.length>0?"add":"remove"]("nonempty"),c.setAttribute("data-status",n),c.innerHTML=this.templates.completions(this,u),i({completions:{index:r,status:n}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Bi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Bi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&R(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),n=this._context().data.get(parseInt(e)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[Ue.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit(t)}}class Bi{static empty(){return Bi._empty||(Bi._empty=new Bi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const n in t)for(const r of t[n])r.product&&!r.product.url||(r._index=e,r._field=n,s.set(e,r),i.push(r),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Fi="miso-option-list";const Qi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${N(e.text||e)}</li>`}});class Gi extends ai{static get category(){return qe.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return Qi}static get defaultClassName(){return Fi}constructor({className:t=Fi,templates:e,...s}={}){super({className:t,templates:{...Qi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const i=this._getItems(e)||[];s.classList[0===i.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}fi(Gi.prototype);const Wi=Object.freeze({...Fs("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Hi extends ai{static get category(){return qe.RADIO}static get defaultTemplates(){return Wi}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...Wi,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=R(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],$((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Vi="miso-feedback",Yi=["helpful","unhelpful"];const Ki=Object.freeze({options:function(t){const{templates:e}=t;return Yi.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Zi extends Hi{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return Ki}static get defaultClassName(){return Vi}constructor({className:t=Vi,templates:e,...s}={}){if(super({className:t,templates:{...Ki,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Xi="miso-text";const Ji=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:n=!1,tag:r}}=t,o=i?`data-role="${i}"`:"",a=void 0!==e?N(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[n,r]=e;switch(n){case"date":return t=>s(t,r);case"number":return t=>i(t,r);default:return t=>""+t}}(t)(e)):"";return n?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class tn extends ai{static get category(){return qe.TEXT}static get type(){return"text"}static get defaultTemplates(){return Ji}static get defaultClassName(){return Xi}constructor({className:t=Xi,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Ji,...e},tag:s,...i})}}class en extends Bs{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=L(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class sn{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),u=!i.startsWith(c);return a||u?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function nn(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,rn(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||je.INITIAL),i}function rn(t){return t+"__cursor"}function on(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:n,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${an(i[0])}, ${an(i[1])})`,e,""+r,n,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function an(t){return Math.floor(100*t)/100+"ms"}const cn="miso-typewriter";class un extends en{static get category(){return qe.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return cn}constructor({className:t=cn,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:i,...a}),E(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:X({speed:n,acceleration:r}),this._readiness=new D,"markdown"===s&&un.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=rn(this.className),{onDebug:s,onCitationLink:i}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:on(s)}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new sn}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=t,a=i&&i.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==je.READY||o?void 0:Date.now());return this._prevState=Object.freeze(w({session:n,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=nn(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);n(a);const c=e.status===je.READY&&!a.done;i({ongoing:c},{silent:c&&(!s||s.status===je.READY)}),c&&r()}_onClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}const ln="miso-affiliation";const hn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e,o=i?` data-role="${i}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===je.READY?n[r](t,e):""}</div>`},[je.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}-container">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Li},body:function(t,e){const{className:s,templates:i}=t,n=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,n)}</div>`},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(t,e,s,{index:i})}${r[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:n,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=oi.asFunction(o)(t,e,s,i),a=oi.asFunction(a)(t,e,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:n}=t,[r,o]=si(t,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||Qs)(t,s,i)+(n.imageBlock||Js)(t,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:n,templates:r}=t,o=oi.asFunction(r.logoText)(t,e,s,i)||"",a=oi.asFunction(r.logoImg)(t,e,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:n,templates:r}=t,o=oi.asFunction(r.logoUrl)(t,e,s,i);if(!o)return"";const a=oi.asFunction(r.logoAltText)(t,e,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),_n=Object.freeze({...wi.defaultTemplates,...hn});class dn extends wi{static get category(){return qe.AFFILIATION}static get type(){return"affiliation"}static get defaultTemplates(){return _n}static get defaultClassName(){return ln}constructor({className:t=ln,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...hn,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new ct(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,$((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(this._displayedCount=s,void 0===s?i.removeAttribute("data-item-count"):i.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const pn="miso-facets",mn="miso-facet",fn="custom_attributes.";const gn=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map((n=>s.facet(t,{field:n,entries:i[n]},e)))},facet:function(t,e,s){const{facetClassName:i=mn,templates:n}=t,{field:r}=e;return`<div class="${i}" data-role="facet" data-field="${N(r)}">${n.header(t,e,s)}${n.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=mn,templates:n}=t;return`<div class="${i}__header">${n.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(fn)&&(e=e.substring(18)),N(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:n=mn,templates:r}=t;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>r.option(t,{field:e,value:s,count:n},i))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=mn,templates:n}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(t,e,s)}</span>\n  <span class="${i}__count">${n.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return N(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function yn(t,e){return`${t}:::${e}`}function wn(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class bn extends ai{static get category(){return qe.FILTERS}static get type(){return"facets"}static get defaultTemplates(){return gn}static get defaultClassName(){return pn}constructor({className:t=pn,templates:e,...s}={}){super({className:t,templates:{...gn,...e},...s}),this._bindings=new mi}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=wn(this._view.filters.states.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=wn(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],n=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;i.push(yn(t,c)),n.push({field:t,value:c}),r.push(s)}}this._bindings.update(i,n,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[N(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:n,value:r}=i;this._view.filters.facets.toggle(n,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}var vn=Object.freeze({__proto__:null,TemplateBasedLayout:ai,ContainerLayout:li,ErrorLayout:_i,BannerLayout:class extends ai{static get category(){return qe.BANNER}static get type(){return"banner"}static get defaultTemplates(){return di}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...di,...e},...s})}},CollectionLayout:wi,ListLayout:vi,CardsLayout:class extends wi{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Ei}constructor({className:t=Ei,...e}={}){super({className:t,...e})}},CarouselLayout:class extends wi{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return Ii}static get defaultClassName(){return ki}constructor({className:t=ki,templates:e,...s}={}){super({className:t,templates:{...Si,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:i}=e,n=this._getItems(i);this._itemCount=n?n.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:zi,OptionListLayout:Gi,FeedbackLayout:Zi,TextLayout:tn,TypewriterLayout:un,AffiliationLayout:dn,FacetsLayout:bn});function En(t){const e=function(t){if(!t)return je.INITIAL;const{request:e,error:s,value:i}=t;return s?je.ERRONEOUS:i?je.READY:e?je.LOADING:je.INITIAL}(t);return w({status:e,ongoing:e===je.READY?!!t.ongoing:void 0,...t})}function kn(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:n}=i||{};return n?{...t,value:{...s,keywords:n}}:t}function Sn(t){if(!t)return;const{facets:e}=t;return w({facet_filters:In(e)})}function In(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}const Cn=Object.freeze({[Te.CONTAINER]:li.type,[Te.ERROR]:_i.type}),On=Object.freeze({[Te.ERROR]:{mapping:t=>t.error}});function xn(t){return t&&t.value&&t.value.revision}class Rn extends ot{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,options:n}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._rolesConfig={...On,...t.rolesConfig},this._extensions=s._getExtensions(i),this._options=n||new Je(e&&e._options,function(t,{layouts:e,interactions:s,...i}={}){const n={preprocess:[e=>t._preprocessInteraction(e)]};return{...i,layouts:Ge(Cn,e),interactions:Ke(n,s)}}(this,t.defaults)),this._hub=function(t,e){const{update:s,trigger:i}=t;return t.update=(i,n,r)=>(r&&r.silent||e("update",i,n,r),s.call(t,i,n,r)),t.trigger=(...s)=>(e("trigger",...s),i.apply(t,s)),t}(new hs,((...t)=>this._log(...t))),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initReset(t)}_initProperties(){}_initActors(){const t=this._hub,e=this._client,s=this._roles,i=this._rolesConfig,n=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new _s(t),this._data=new fs(t,{source:zs(e),options:n}),this._views=new Us(t,{extensions:r,layouts:o,roles:s,rolesConfig:i,options:n,workflow:this._name}),this._interactions=new Ms(t,{client:e,options:n})}_initSubscriptions(){this._unsubscribes=[this._hub.on(cs(),(t=>this.updateData(t)))]}_initReset(){this.reset()}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get status(){const t=this._hub.states[us()];return t&&t.status}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this._sessions.restart(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=xn(t);if(!b(s)){const t=xn(this._hub.states[us()]);if(!b(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=En(t)),t}_updateDataInHub(t){this._hub.update(us(),t)}notifyViewUpdate(t,e){return this._assertActive(),e={status:je.READY,session:this.session,...e},this._hub.update(ls(t),e),this}get trackers(){return this._views.trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:i,name:n}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:i,api_name:n,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}function Tn(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:$n(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map((t=>({...t})));let n=0;for(const t of i)s&&(t.channel=s),t.position=n++;return{...t,affiliation:{...e,products:i}}}(t)}function $n({products:t,...e}){return{channel:"sovrn",...e,products:t.map(An)}}function An({id:t,deeplink:e,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return w({id:"sovrn-"+t,title:s,description:i,cover_image:c,url:e,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:Nn({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function Nn(t,e=""){return Object.keys(t).reduce(((s,i)=>{const n=t[i];if(void 0===n)return s;const r=e?`${e}_${i}`:i;return"object"==typeof n?{...s,...Nn(n,r)}:{...s,[r]:n}}),{})}is(Rn.prototype);const qn=Object.freeze({group:d.ASK,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Un=Object.freeze({actor:!1,api:{group:d.ASK,name:p.AUTOCOMPLETE}}),Pn=Object.freeze({[Te.QUERY]:[zi.type,{placeholder:"Ask a question"}],[Te.QUESTION]:[tn.type,{tag:"h2"}],[Te.ANSWER]:un.type,[Te.FEEDBACK]:Zi.type,[Te.SOURCES]:[vi.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Te.AFFILIATION]:[dn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Ln=Object.freeze({[Te.SOURCES]:{},[Te.AFFILIATION]:{},[Te.PRODUCTS]:{}}),jn=Object.freeze({api:qn,autocomplete:Un,layouts:Pn,trackers:Ln});class Dn extends Rn{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new js(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on(ls(Te.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Te.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))]}restart(){this._questionId&&(this._questionId=void 0);const{session:t,status:e,ongoing:s}=this._hub.states[ls(Te.ANSWER)]||{};if(t&&e!==je.INITIAL&&(e!==je.READY||s)){const i=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",i),this._emit("finally",i)}super.restart()}get questionId(){return this._questionId}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,i=new URLSearchParams(window.location.search),n=i.get("q"),r=i.get("qs"),{layout:o}=this._views.get(Te.QUERY);o&&(n&&e&&(o.value=n),!n&&s&&o.focus()),n&&this.query({q:n,qs:r})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){this.restart(),this._writeQuestionSourceToSession(t);const{session:e}=this,s=this._buildPayload(t),i=Fe(this._options.resolved.api,{payload:s,session:e});this._request(i)}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.questionSource||Re}_request(t){this._hub.update(as(),t)}_buildPayload(){throw Error("Not implemented")}_updateData(t){!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){this._writeQuestionIdFromData(t)}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Tn(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){if(!t)return;const{question_id:e}=t;this._writeQuestionId(e)}_updateUrlIfNecessary({value:t,request:e}){if(!t||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{question:s}=t,i=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source===Re,n=new URL(window.location);s===n.searchParams.get("q")||i&&!0!==this._autoQuery.updateUrl||(n.searchParams.set("q",s),window.history.replaceState({},"",n))}_preprocessInteraction(t){return t=super._preprocessInteraction(t),t=this._writeQuestionIdToInteractions(t)}_writeQuestionIdToInteractions(t={}){const{context:e={}}=t,{custom_context:s={}}=e;let{questionId:i}=this;return{...t,context:{...e,custom_context:w({question_id:i,...s})}}}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===je.INITIAL)return;const i=e===je.READY&&!s,n=e===je.ERRONEOUS,r=i?"done":n?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._emit(r,o),(i||n)&&this._emit("finally",o)}_onCitationClick({index:t}){const{value:e}=this.states[us()]||{},{sources:s}=e||{},i=s&&s[t-1];i&&i.product_id&&this._trackers.sources.click([i.product_id],{manual:!1})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Object.assign(Dn,{DEFAULT_API_OPTIONS:qn,DEFAULT_AUTOCOMPLETE_OPTIONS:Un,DEFAULT_LAYOUTS:Pn,DEFAULT_TRACKERS:Ln,DEFAULT_OPTIONS:jn});const Mn=Object.freeze({...Dn.DEFAULT_API_OPTIONS,name:p.QUESTIONS,payload:{...Dn.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),zn=Object.freeze({...Dn.DEFAULT_LAYOUTS,[Te.QUERY]:[zi.type,{templates:{buttonIcon:"send"}}],[Te.RELATED_RESOURCES]:[vi.type,{incremental:!0,itemType:"article"}],[Te.QUERY_SUGGESTIONS]:Gi.type}),Bn=Object.freeze({...Dn.DEFAULT_TRACKERS,[Te.RELATED_RESOURCES]:{},[Te.QUERY_SUGGESTIONS]:{click:{validate:t=>0===t.button}}}),Fn=Object.freeze({...Dn.DEFAULT_OPTIONS,api:Mn,layouts:zn,trackers:Bn});class Qn extends Dn{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(zn),defaults:Fn,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;E(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[us()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initReset(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initReset(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:i}=this;return w({...s,question:t,parent_question_id:i,_meta:{...s._meta,question_source:e||Re}})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{...s}=e.custom_context||{};let{rootQuestionId:i,parentQuestionId:n,questionId:r}=this;return s.property===Te.QUERY_SUGGESTIONS&&(r=n,n=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions",s.question_source=this.previous&&this.previous.session.meta.question_source),s.question_id=r,s.root_question_id=i,s.parent_question_id=n,{...t,context:{...e,custom_context:w(s)}}}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class Gn extends os{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Qn(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Qn(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const Wn=Object.freeze({[Te.QUESTION]:{mapping:Te.KEYWORDS}});class Hn extends Dn{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,roles:Object.keys(Dn.DEFAULT_LAYOUTS),rolesConfig:Wn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initReset(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset(),t.restart(),this._resultsSession=t.session}_buildPayload({q:t,qs:e,...s}={}){return{...s,q:t,_meta:{...s._meta,question_source:e||Re}}}_defaultProcessData(t){return t=kn(t=super._defaultProcessData(t))}_updateDataInHub(t){switch(t.status){case je.INITIAL:case je.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}}const Vn=Object.freeze({[Te.FACETS]:{mapping:"facet_counts"}});class Yn extends Rn{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,roles:[Te.PRODUCTS,Te.KEYWORDS,Te.HITS,Te.FACETS],rolesConfig:Vn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("filters",(t=>this._refine(t)))]}_initReset(){}_refine(t){const{facet_counts:e}=this._hub.states[us()].value||{};this._previousFacetCounts=e,this.restart();const s=this._buildPayload({...this._superworkflow._answer._hub.states.query,filters:t}),{session:i}=this,n=Fe(this._options.resolved.api,{payload:s,session:i});this._request(n)}_buildPayload({filters:t,...e}={}){return e=this._superworkflow._answer._buildPayload(e),e=this._writeFiltersToPayload({...e,filters:t}),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_writeFiltersToPayload({filters:t,...e}={}){return w({...e,...Sn(t)})}_writeQuestionIdToPayload(t){return{...t,_meta:w({...t._meta,question_id:this._superworkflow._answer.questionId})}}_request(t){this._hub.update(as(),t)}_defaultProcessData(t){return t=kn(t=super._defaultProcessData(t)),t=this._retainFacetCounts(t)}_retainFacetCounts(t){if(!this._previousFacetCounts)return t;const{status:e,value:s}=t;switch(e){case je.INITIAL:case je.LOADING:break;default:return t}return s&&s.facet_counts?t:{...t,value:{...s,facet_counts:this._previousFacetCounts}}}}const Kn=Object.freeze({...Dn.DEFAULT_API_OPTIONS,name:p.SEARCH,payload:{...Dn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"],fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Zn=Object.freeze({...Dn.DEFAULT_LAYOUTS,[Te.QUERY]:[zi.type,{placeholder:""}],[Te.QUESTION]:[tn.type,{raw:!0}],[Te.PRODUCTS]:[vi.type,{itemType:"article"}],[Te.KEYWORDS]:[tn.type,{raw:!0}],[Te.HITS]:[tn.type,{raw:!0,format:"number"}],[Te.FACETS]:[bn.type]}),Xn=Object.freeze({...Dn.DEFAULT_TRACKERS}),Jn=Object.freeze({...Dn.DEFAULT_OPTIONS,api:Kn,layouts:Zn,trackers:Xn}),tr=Object.freeze({[Te.QUESTION]:{mapping:Te.KEYWORDS},[Te.FACETS]:{mapping:"facet_counts"}}),er=Object.freeze({ANSWER:"answer",RESULTS:"results"});class sr extends Rn{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Object.keys(Zn),rolesConfig:tr,defaults:Jn})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Hn(this),this._results=new Yn(this)]}_getSubworkflow(t){switch(t){case er.ANSWER:return this._answer;case er.RESULTS:return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){const t=this._hub,e=this._client,s=this._options;this._views=new ir(this),this._interactions=new Ms(t,{client:e,options:s})}_initReset(){this._results.reset(),this._answer.reset()}restart({answer:t=!0}={}){const e=this.session;this._sessions.restart();const{session:s}=this;return t||(s._answer=e._answer||e),this}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_preprocessInteraction(t){return this._answer._preprocessInteraction(t)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}class ir{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){switch(t){case Te.PRODUCTS:case Te.HITS:case Te.FACETS:case Te.KEYWORDS:return er.RESULTS;default:return er.ANSWER}}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName}> cannot contain both <${i.tagName}> and <${e.tagName}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName}> with child component <${e.tagName}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const nr=Object.freeze({group:d.ASK,name:p.RELATED_QUESTIONS}),rr=Object.freeze({[Te.RELATED_QUESTIONS]:[vi.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Te.QUERY]:[zi.type,{placeholder:"Ask a question"}]}),or=Object.freeze({[Te.RELATED_QUESTIONS]:{},[Te.CONTAINER]:{},[Te.QUERY]:{[Ue.SUBMIT]:{}}}),ar=Object.freeze({api:nr,layouts:rr,trackers:or});class cr extends Rn{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(rr),defaults:ar})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(Te.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start({relatedQuestions:t=!0}={}){if(t&&void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:e}=this;return t?this._hub.update(as(),Fe(this._options.resolved.api,{session:e})):this.updateData({session:e,request:{},value:{related_questions:[]}}),this}notifyViewUpdate(t=Te.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._getAnswersUrl(t,!0)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._getAnswersUrl(t);window.open(e,"_blank")}_getAnswersUrl(t,e=!1){if(!this._linkFn)return;const s=this._linkFn(t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}const ur=Object.freeze({group:d.SEARCH,name:p.SEARCH,payload:{fl:["*"]}}),lr=Object.freeze({actor:!1,api:{group:d.SEARCH,name:p.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}},throttle:300}),hr=Object.freeze({[Te.QUERY]:zi.type,[Te.PRODUCTS]:vi.type}),_r=Object.freeze({[Te.PRODUCTS]:{}}),dr=Object.freeze({api:ur,autocomplete:lr,layouts:hr,trackers:_r});class pr extends Rn{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(hr),defaults:dr})}_initActors(t){super._initActors(t),this._autocomplete=new Ds(this._hub,{source:zs(this._client),options:this._options})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t)))]}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:i}=this._views.get(Te.QUERY);i&&(s&&t&&(i.value=s),!s&&e&&i.focus()),s&&this.query({q:s})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this.restart();const{session:e}=this,s=this._buildPayload(t),i=Fe(this._options.resolved.api,{payload:s,session:e});this._request(i)}_buildPayload(t){return t}_request(t){this._hub.update(as(),t)}updateCompletions(t){return this._hub.update(us(Ne.AUTOCOMPLETE),{...t,source:"manual"}),this}notifyViewUpdate(t=Te.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}is(pr.prototype,["autocomplete"]);const mr=Object.freeze({group:d.RECOMMENDATION,name:p.USER_TO_PRODUCTS,payload:{fl:["*"]}}),fr=Object.freeze({[Te.PRODUCTS]:vi.type}),gr=Object.freeze({[Te.PRODUCTS]:{}}),yr=Object.freeze({api:mr,layouts:fr,trackers:gr});class wr extends Rn{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(fr),defaults:yr,id:e})}_initProperties(t){super._initProperties(t);const{id:e}=t;E(this,{id:e})}_initReset(t){this._context._members.set(t.id,this),super._initReset(t)}start(){this._sessions.start();const{session:t}=this;return this._hub.update(as(),Fe(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(Te.CONTAINER),this.notifyViewUpdate(Te.PRODUCTS),this}notifyViewUpdate(t=Te.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:w({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class br extends os{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=xe){if(this._members.has(t))throw Error("Unit already exists: "+t);return new wr(this,t)}has(t=xe){return this._members.has(t)}get(t=xe){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new wr(this,t)}}class vr extends ot{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new D)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var Er=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var kr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Sr{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Ir{constructor(t){this._context=t,E(this,{lowerCamelToKebab:I,kebabToLowerCamel:k,kebabOrSnakeToLowerCamel:S})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=S(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:i=!1}){const{classPrefix:n}=t;return`<${s} class="${i?n+"__phrase-inline":n+"__phrase"} ${n}__${e}-phrase">${this.phraseText(t,k(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${t}__${i}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${I(t)}="${i}"`)}return s}}const Cr=Y(new Ir({...Er,DEFAULT_PHRASES:kr})),Or=Y(new class extends Sr{constructor(){super({helpers:Cr})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:n={},logo:r=!0}=t;return i(t,{name:"related-resources"},!1===n.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:i={}}=t;return!1===i.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:Cr}));function xr(t={}){const{normalizeOptions:e,section:s,container:i}=Cr,{querySuggestions:n,answerGroup:r}=Or;return s(t=e(t),{name:"follow-up"},[n(t),i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var Rr=Object.freeze({__proto__:null,helpers:Cr,sections:Or,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=Cr,{followUps:n,relatedResourcesSection:r,answerGroup:o}=Or;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+n(t)+r(t)},followUp:xr});const Tr=Object.freeze(Er),$r=Object.freeze(kr),Ar=Object.freeze(Rr);var Nr=Object.freeze({__proto__:null,constants:Tr,phrases:$r,templates:Ar,wireFollowUps:function(t,e,{template:s=xr,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const n=t.ui.asks,r=t.ui.ask;n.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",n.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:qr}=document,Ur=Object.freeze({templates:Ar,autostart:!0}),Pr=["templates","phrases","features"];class Lr{constructor(){this._defaults=Ur,this._scriptSrc=function(){if(!qr||!qr.src)return{};const t=document.createElement("a");t.href=qr.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Mr(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Mr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return w({apiKey:t,apiHost:e,templates:zr(s),phrases:i,...n})}(jr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function jr(...t){let e={};for(const s of t)s&&(e=Dr(e,s));return e}function Dr(t,e){if(!e)return t;Object.assign(t,e);for(const s of Pr)s in e&&(t[s]={...t[s],...e[s]});return t}function Mr(t){return""===t||"false"!==t&&t}function zr(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(zr):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,zr);default:throw Error("Unsupported template type: "+t)}}class Br{constructor(t,{classPrefix:e=Tr.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");E(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Fr extends vr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Lr,this._localOptions={}}config(t={}){t=jr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;E(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Br(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(e,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Qr extends at{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Gr,Wr,Hr;async function Vr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Gr||(Gr=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Wr=Wr||e.any(),Hr=Hr||await Wr,Hr.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Hr}const Yr="logo",Kr="auto",Zr=Object.freeze([Yr]);function Xr(t){if(!t)return Kr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Jr extends HTMLElement{static get observedAttributes(){return Zr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Xr(this.getAttribute(Yr))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Kr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Yr,e):this.removeAttribute(Yr)}async connectedCallback(){const t=this._client=await Vr(Jr);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Yr)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Xr(t)!==Xr(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const to="parent-question-id",eo=Object.freeze([...Jr.observedAttributes,to]);const so="unit-id",io=Object.freeze([...Jr.observedAttributes,so]);var no=Object.freeze({__proto__:null,MisoAskElement:class extends Jr{static get tagName(){return"miso-ask"}static get observedAttributes(){return eo}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(to)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(to,t):this.removeAttribute(to))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===to)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Jr{static get observedAttributes(){return Jr.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoHybridSearchElement:class extends Jr{static get observedAttributes(){return Jr.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Jr{static get observedAttributes(){return Jr.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Jr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return io}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(so)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(so,t):this.removeAttribute(so)}attributeChangedCallback(t,e,s){if(t===so)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const ro="role",oo=Object.freeze([ro]);class ao extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return oo}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(ro);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ro}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${ro}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===ro&&this._container&&this._container._updateComponentRole(this,e,s)}}var co=Object.freeze({__proto__:null,MisoComponentElement:ao,MisoQueryElement:class extends ao{constructor(){super({role:Te.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends ao{constructor(){super({role:Te.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends ao{constructor(){super({role:Te.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends ao{constructor(){super({role:Te.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends ao{constructor(){super({role:Te.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends ao{constructor(){super({role:Te.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends ao{constructor(){super({role:Te.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends ao{constructor(){super({role:Te.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends ao{constructor(){super({role:Te.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends ao{constructor(){super({role:Te.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends ao{constructor(){super({role:Te.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends ao{constructor(){super({role:Te.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoHitsElement:class extends ao{constructor(){super({role:Te.HITS})}static get tagName(){return"miso-hits"}},MisoFacetsElement:class extends ao{constructor(){super({role:Te.FACETS})}static get tagName(){return"miso-facets"}},MisoErrorElement:class extends ao{constructor(){super({role:Te.ERROR})}static get tagName(){return"miso-error"}}});class uo extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(uo.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var lo=Object.freeze({__proto__:null,containers:no,roles:co,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends uo{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:ci});const ho="miso-hybrid-search-combo";var _o=Object.freeze({__proto__:null,CLASS_PREFIX:ho,CONAINER_TAG:"miso-hybrid-search"});const po="Show more",mo="Show less";var fo=Object.freeze({__proto__:null,question:"You asked “${value}”",sources:"Sources",keywords:"You searched for “${value}”",hits:"${value} Results",showMore:po,showLess:mo});const go=Y(new Ir({..._o,DEFAULT_PHRASES:fo})),yo=Y(new class extends Sr{constructor(){super({helpers:go})}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>"])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.hits(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}hits(t){const{phrase:e}=this._helpers;return e(t,{name:"hits",tag:"div",inline:!0}).replaceAll("${value}","<miso-hits></miso-hits>")}}({helpers:go}));var wo=Object.freeze({__proto__:null,helpers:go,sections:yo,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=go;t=e(t);const{answerBox:n,answerGroup:r}=yo,{answerBox:o=!0}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o?[n(t)]:r(t))+s(t,{name:"search-results"},yo.searchResultsGroup(t))}});const bo="answer-box-open",vo="answer-box-shown",Eo='[data-role="answer-box-toggle"]';class ko{constructor(t,e,{classPrefix:s=ho,phrases:i={}}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on(us(),(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(Eo)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer;switch(t){case je.ERRONEOUS:case je.READY:this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||mo:this._phrases.showMore||po;for(const e of this._element.querySelectorAll(Eo))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const So={isOpen:bo,shown:vo},Io={toggleOpen:["toggle",bo],open:["open",bo],close:["remove",bo],toggleHidden:["toggle",vo],show:["add",vo],hide:["remove",vo]};for(const[t,e]of Object.entries(So))Object.defineProperty(ko.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(Io))ko.prototype[t]=function(){this._updateBoxStatus(e,s),s===bo&&(this._syncButtonText(),this._syncScroll())};const Co=Object.freeze(_o),Oo=Object.freeze(fo),xo=Object.freeze(wo);var Ro=Object.freeze({__proto__:null,constants:Co,phrases:Oo,templates:xo,wireAnswerBox:function(t,e){if(!t)throw Error("client is required");e&&new ko(t,e)}});const To=Object.freeze(Nr),$o=Object.freeze(Ro);var Ao=Object.freeze({__proto__:null,ask:To,hybridSearch:$o});const No="ui";let qo,Uo;async function Po(){return Uo||(Uo=F(qo||(qo=Q(No))))}class Lo{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class jo{constructor(t,e){this._plugin=t,this._client=e,E(this,{sources:{api:zs(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new pr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new sr(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new cr(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Do{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Fr(this._plugin,this._MisoClient))}}ne.plugins.use(class extends ot{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Qr(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new D}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Ao};v(s,this,["layouts","combo","ready"]),E(this,{MisoClient:t}),E(t,{ui:s}),this.combo=new Do(this,t);const i=Object.values(vn).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,combos:o,...a}=lo,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];Jr.MisoClient=t,uo.MisoClient=t;for(const e of c)e.MisoClient=t;await Po();for(const t of c)T(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){E(t,{ui:new jo(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Lo(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new br(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Gn(this,t)),e}});const Mo=5e3;let zo,Bo,Fo=!1;async function Qo(t){return new Promise((e=>setTimeout((()=>{const t=q();Yo("Fallback",t),e(t)}),t)))}async function Go(){const t=await wt((()=>window.gaGlobal&&window.gaGlobal.vid));return t&&Yo("GA4",t),t}async function Wo(){const t=(await(zo||(zo=async function(){return wt((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return t&&Yo("UA",t),t}const Ho="%cMiso",Vo="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Yo(t,e){!function(...t){(a.indexOf("beta")>=0||"dev"===a)&&function(...t){console.log(Ho,Vo,...t)}(...t)}(`[${t}] Client ID: ${e}${Fo?" (unused)":""}`),Fo=!0}async function Ko(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(ne,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||e.debug;i&&ne.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&ne.plugins.use("std:dry-run");return window.MisoClientSA=ne,ne}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const i=window.misoSA=new e(s);return i.context.anonymous_id=await async function(){return Bo||(Bo=Promise.any([Go(),Wo(),Qo(Mo)]))}(),i}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function Zo(t){return e=>({...e,context:{...e.context,custom_context:{...Xo(t),...e.context&&e.context.custom_context}}})}function Xo({site:t,page:e,config:s,version:i}){return w({source:"miso-client-script",script_version:i,attribution:"miso-smart-answers",site:t.key,user_geo:s.geo,page_type:e.type,post_id:e.postId,uuid:q()})}let Jo;async function ta(){return Jo||(Jo=async function(){const[[t,e]]=await Promise.all([Ko(It),_t(It)]);return{MisoClient:t,client:e}}())}const ea="miso-smart-answers";const sa=ne.ui.defaults.ask.templates,ia={sources:"This answer is based on the following articles",relatedQuestions:"Related questions"};function na(t){const{sponsor:e,site:s}=t;if("computerworld"!==s.key||!e)return;const i=document.querySelector(".article-hero__breadcrumbs");i&&i.insertAdjacentHTML("afterend",function({sponsor:t}){return t?`\n<div class="${ea}__sponsor">\n  <div class="${ea}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${ea}__sponsor-logo">\n    <img src="${mt(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}(t))}function ra(t,e){for(const s of e)t=s(t);return t}const oa=/<\/miso-sources>\s*<\/miso-ask>/;function aa(t){const e=`<miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="ready" logo="false"${t?` parent-question-id="${t}"`:""}><miso-whitepaper></miso-whitepaper></miso-ask>`;return t=>t.replace(oa,"</miso-sources></miso-ask>"+e)}const ca=/(answer-container.*?<\/miso-ask>)/;function ua(t){return t.replace(ca,"$1<miso-newsletter-form></miso-newsletter-form>")}function la(t){return t.replace(/<h3 /g,"<h4 ").replace(/<\/h3>/g,"</h4>")}const ha=Object.freeze({ordered:!0,infoBlock:function({className:t},{title:e,snippet:s,description:i,created_at:n,updated_at:r,published_at:o,custom_attributes:a={}}){const c=yt(a.site),u=o||n||r;let l="";e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:i&&(l+=`<div class="${t}__item-desc">${i}</div>`);const h=[];u&&h.push(`<div class="${t}__item-date">${pa(u)}</div>`);c&&h.push(`<div class="${t}__item-site">${c.name}</div>`);h.length>0&&(l+=`<div class="${t}__item-supplementals">${h.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`);return`<div class="${t}__item-info-container">${l}</div>`}});const _a="miso-list";function da(t,e){return`\n<h4 class="miso-ask-combo__phrase miso-ask-combo__whitepaper-phrase">Learn more: in-depth</h4>\n<div class="miso-whitepaper ${_a}">\n  <ul class="${_a}__list" data-item-type="article">${e.map((t=>function(t,{cover_image:e,description:s,product_id:i,published_at:n,publishers:r,title:o,url:a}){r=r||[];const c=[];n&&c.push(`<div class="${_a}__item-date">${pa(n)}</div>`);r.length>0&&c.push(`<div class="${_a}__item-sponsor">${r.join(", ")}</div>`);return`\n<li class="${_a}__item">\n  <a class="${_a}__item-body" data-whitepaper-product-id="${i}" href="${a}" target="_blank" rel="noopener">\n    <div class="${_a}__item-cover-image-container">\n      <img class="${_a}__item-cover-image" src="${e}">\n    </div>\n    <div class="${_a}__item-info-container">\n      <div class="${_a}__item-title">${o}</div>\n      <div class="${_a}__item-desc">${s}</div>\n      ${c.length>0?`<div class="${_a}__item-supplementals">${c.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`:""}\n    </div>\n  </a>\n</li>`.trim()}(0,t))).join("")}</ul>\n</div>\n`.trim()}function pa(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}const ma=new Set;class fa{constructor(t,{MisoClient:e,client:s,workflow:i,element:n}){this._workflow=i,this._client=s,this._MisoClient=e,this._context=Object.freeze({...t}),this._rootElement=n,this._element=void 0,this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1,i.on("data",(t=>this.updateData(t)))}clear(){this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1}async updateData({session:t,value:e}={}){t&&(this._product&&this._session&&this._session.uuid===t.uuid||(this._session=t,this._product=this._getProduct(e),this._syncView()))}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=(t?`miso-ask[parent-question-id="${CSS.escape(t.trim())}"]`:"miso-ask:not([parent-question-id])")+" miso-whitepaper";if(this._element=this._rootElement.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProduct(t){const{affiliation_products:e=[]}=t||{};for(const t of e)if(!ma.has(t.product_id))return ma.add(t.product_id),t;return e[0]}async _syncView(){this._html=this._product?da(0,[this._product]):"",this._requestRender()}async _requestRender(){this._render(),this._product&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;t.closest(".miso-whitepaper a[href]")&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){if(!this._product)return;const{questionId:s,parentQuestionId:i,rootQuestionId:n}=this._workflow,{question_source:r="_organic"}=this._workflow.session.meta||{};this._client.api.interactions.upload(w({type:t,...e,product_ids:[this._product.product_id],context:{custom_context:w({...Xo(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:n,parent_question_id:i,question_id:s,question_source:r})}}))}}class ga{constructor(t){this._site=t,this._enabled=!!t.newsletter_mauticform_id&&t.dev,this._newsletterSection=void 0,this._createScript()}_createScript(){if(!this._enabled)return;const t=document.createElement("script");t.type="text/javascript",t.src="https://mau.idgesg.net/form/generate.js?id="+this._site.newsletter_mauticform_id,t.addEventListener("load",(()=>{const t=document.querySelector("input#mauticform_input_usciofirstlooksubscriptionform_hidden_source_information");t&&(t.value="Generated by smart answers")})),this._formScript=t}_setupElement(){this._enabled&&!this._newsletterSection&&(this._newsletterSection=document.querySelector("miso-newsletter-form"),this._newsletterSection&&this._newsletterSection.appendChild(this._formScript))}show(){this._enabled&&(this._setupElement(),this._newsletterSection&&(this._newsletterSection.style.display=""))}hide(){this._enabled&&this._newsletterSection&&(this._newsletterSection.style.display="none")}}function ya(t,{MisoClient:e,client:s,rootElement:i}){const{site:n,config:a}=t,c=s.ui.asks,u=s.ui.ask;c.useApi({_meta:w({site:n.key,user_geo:a.geo}),fq:o,source_fl:r,related_resource_fl:r}),c.useDataProcessor(function(t){const e=function({site:t}){return({url:e,...s})=>((e=new URL(e)).host=""+t.whitepaper_hostname,{url:ba(e=""+e),...s})}(t);return({value:t,...s})=>{if(!t)return s;const{sources:i=[],related_resources:n=[],affiliation_products:r}=t;return{value:{...t,sources:i.map(wa),related_resources:n.map(wa),affiliation_products:(r||[]).map(e)},...s}}}(t)),c.useInteractions({preprocess:Zo(t)}),c.useLayouts({sources:{templates:ha}});const l=document.createElement("div");l.id="smart-answers",l.classList.add("miso-ask-combo"),i.insertAdjacentElement("afterend",l),i.remove(),(i=l).innerHTML=ra(sa.root({phrases:ia,features:{relatedResources:!1}}),[aa(),la,ua]);const h=i.querySelector(".miso-ask-combo__follow-ups"),_=i.querySelector(".miso-ask-combo__related-resources miso-ask"),d=new ga(n);function p(i){i._whitepaper||(i._whitepaper=new fa(t,{MisoClient:e,client:s,workflow:i,element:l}))}h&&(c.on("done",(t=>{h.insertAdjacentHTML("beforeend",function(t,{parentQuestionId:e}){return ra(sa.followUp({phrases:ia,parentQuestionId:e}),[aa(e),la])}(0,{parentQuestionId:t.workflow.questionId}))})),u.on("loading",(()=>{h.innerHTML="",c.reset({root:!1}),u._whitepaper&&u._whitepaper.clear(),d.hide()}))),_&&c.on("loading",(t=>{_.workflow=t.workflow})),c.on("create",p),p(u),c.on("ready",(()=>d.show())),u.autoQuery()}function wa({url:t,cover_image:e,...s}){return{cover_image:e||yt(s.custom_attributes.site).logo_image,url:ba(t),...s}}function ba(t){return`${t}${0>t.indexOf("?")?"?":"&"}utm=smart_answers`}const va='<svg width="32" height="32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Ea='<svg width="32" height="32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function ka(t,e,s={}){const{className:i,templates:n}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${r}">`}${n.indexBlock(t,e,s)}</div>`}function Sa({className:t},{title:e,created_at:s,updated_at:i,published_at:n,custom_attributes:r={}}){const o=yt(r.site),a=n||s||i;let c="";e&&(c+=`<div class="${t}__item-title">${e}</div>`);const u=[];return a&&u.push(`<div class="${t}__item-date">${Ia(a)}</div>`),o&&u.push(`<div class="${t}__item-site">${o.name}</div>`),u.length>0&&(c+=`<div class="${t}__item-supplementals">${u.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`),`<div class="${t}__item-info-container">${c}</div>`}function Ia(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}Object.freeze({ordered:!0,article:function(t,e,s,i){const{templates:n}=t,[r,o]=n.helpers.tagPair(t,s);return""+r+ka(t,s,i)+Sa(t,s)+o},infoBlock:Sa}),Object.freeze({infoBlock:function({className:t},{title:e,snippet:s,description:i,created_at:n,updated_at:r,published_at:o,custom_attributes:a={}}){const c=yt(a.site),u=o||n||r;let l="";e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:i&&(l+=`<div class="${t}__item-desc">${i}</div>`);const h=[];u&&h.push(`<div class="${t}__item-date">${Ia(u)}</div>`);c&&h.push(`<div class="${t}__item-site">${c.name}</div>`);h.length>0&&(l+=`<div class="${t}__item-supplementals">${h.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`);return`<div class="${t}__item-info-container">${l}</div>`}});const Ca="header #miso-search";function Oa(t){const e=""+new URL(window.location.href).searchParams;window.location.href=`/search/?${e}&q=${encodeURIComponent(t)}`}async function xa(t){const e=document.querySelector(Ca);if(!e)return;e.classList.add("miso-hybrid-search-input"),e.innerHTML=`\n<div class="miso-search-box" data-role="query">\n  <div class="miso-search-box__input-group">\n    <span class="miso-search-box__input-icon">${va}</span>\n    <input class="miso-search-box__input" type="text" data-role="input">\n    <button class="miso-search-box__button" type="submit" data-role="submit">${Ea}</button>\n  </div>\n  <div class="miso-autocomplete" data-role="autocomplete"></div>\n</div>`.trim();const s=e.querySelector('[data-role="input"]'),i=e.querySelector('[data-role="submit"]');s.addEventListener("keydown",(t=>"Enter"===t.key&&Oa(s.value))),i.addEventListener("click",(()=>Oa(s.value)))}const Ra="#smart-answers";async function Ta(t){const e=document.querySelector(Ra);if(!e)return void console.error("Container element not found: "+Ra);const{MisoClient:s,client:i}=await ta();na(t),ya(t,{MisoClient:s,client:i,rootElement:e})}(async t=>{t.page.type===e&&function(t){const{version:e,debug:s}=t;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=e,s("Miso Smart Answers script version: "+e),!0)}(t)&&await Promise.all([Ta(t),xa()])})(It)}();
