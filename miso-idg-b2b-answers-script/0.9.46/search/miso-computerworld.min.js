!function(){"use strict";const e="home",t="answers",s="search",i="article",n="other",o=["cover_image","custom_attributes.site","custom_attributes.content_type","custom_attributes.contenthub_url","custom_attributes.byline","authors","created_at","product_id","published_at","snippet","title","updated_at","url"],r='type:article AND ((NOT custom_attributes.languages:*) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)';var a="0.9.46";var c=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,i]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===i||"true"===i||"false"!==i&&i);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const l={key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en",date_locale:"en-US"},u=window.location.hostname!==l.hostname;var h={...l,dev:u};function d(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const _=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),p=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var m=Object.freeze({__proto__:null,GROUP:_,NAME:p});function f(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function g(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function b(e){return null!=e?""+e:e}function y(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function w(e){return null==e}function v(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function E(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function S(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function k(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function O(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class I{constructor(e,{duration:t=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);C(s),C(i),C(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==i?i:t})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>x(this,e)),t):x(this,e),this._value=e}disconnect(){this._active=!1}}function x(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function C(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function T(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function A(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function R(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async i=>{try{await e(i),t()}catch(e){s(e)}}))}))}async function N(e,{area:t=.5,duration:s=1e3,signal:i}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((n,o)=>{const r=new I((e=>{e&&(r.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((e=>{r.value=e[0].isIntersecting}),{threshold:t});a.observe(e),i&&i.addEventListener&&i.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),o(new DOMException("Aborted","AbortError"))}))}))}function $(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function L(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function U(e,t){const s=P((()=>window.localStorage.getItem(e))),i=P((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,i=t.indexOf(s);if(0>i)return;const n=i+s.length,o=t.indexOf(";",n);return decodeURIComponent(0>o?t.substring(n):t.substring(n,o))}(e))),n=s||i||""+t();return n&&!s&&P((()=>window.localStorage.setItem(e,n))),n&&!i&&P((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,n))),n}function P(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function q(e){return new j(e)}class j{constructor(e){this._value=e;const t=e=>{this._value=e};E(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class D{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class M{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new D),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var F="1.12.3-beta.5";let z;try{z=document.currentScript}catch(e){}async function B(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let i;e.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{e.sheet&&(i&&clearInterval(i),t())}),100)}))}(e),await async function(e){if(G(e))return;return new Promise((t=>{let s;s=setInterval((()=>{G(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function Q(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${F}/dist/css/${e}.css`}function G(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function W(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function H(e,{depth:t=5,...s}={}){return V(e,t)}function V(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>V(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const i={};if(0>=t)return i;for(const s in e){const n=e[s];"function"!=typeof n&&(s.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(i[s]=V(n,t-1)))}return i}(e,t):e:"(...)"}function K(e,t){const s=Object.getOwnPropertyDescriptors(t),i=Object.getOwnPropertyDescriptors(e);for(const[t,n]of Object.entries(s))"constructor"!==t&&void 0===i[t]&&Object.defineProperty(e,t,n)}function Y(e){const t={},s=new Set;for(let i=e;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:o}=n[i];o&&(t[i]="function"==typeof o?o.bind(e):o)}}return Object.freeze(t)}const Z=100,J=4;function X(e){const t=function({speed:e=Z,acceleration:t=J}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,i)=>{let n=e*(Math.random()+.5);return t>0&&void 0!==i&&s>i&&(n*=1+(s-i)*t/1e3),n}}(e);return(e,s,i,n)=>{const o=t(i,s);return e+Math.max(n-i,0)*o/1e3}}const ee=Symbol.for("miso:resources");class te{constructor(){this._resources=new Map;const e=window[ee]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){se(this._resources,e).resolve(t)}async get(e){return se(this._resources,e).promise}}function se(e,t){if(e.has(t))return e.get(t);const s=new D;return e.set(t,s),s}function ie(){return window[ee]||(window[ee]=new te)}class ne{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new D;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class oe{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},i=this._namedCallbacks[e];if(i)for(const e of i)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,i)=>{const n=t._on(e,(e=>{setTimeout((()=>n()));try{s(e)}catch(e){i(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:i})=>{try{e(s,i)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)f(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&f(s,t)}}_injectSubscribeInterface(e){v(e,this,["on","once"])}}function re(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class ae{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:re(e,t),uuid:L()})}(e,t);E(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new oe({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(ae,"miso:component");class ce extends ae{constructor(e,t,{libName:s,keyName:i}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=e=>e[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new D);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class le{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new I(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class ue{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:he}=document,de=he.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function _e({}){await Promise.all([me()])}let pe=!1;async function me(){if(pe)return;if(pe=!0,!he)throw Error("currentScript not found");const e=he.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=t,i.onerror=s,i.href=e,document.head.appendChild(i)}))}(s)}function fe(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${de}/${e}`}const ge=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en",date_locale:"en-US"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en",date_locale:"en-US"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en",date_locale:"en-US"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en",date_locale:"en-US"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en",date_locale:"en-US"},{key:"computerwoche",name:"Computerwoche",hostname:"www.computerwoche.de",whitepaper_hostname:"us.resources.computerworld.com",regions:[],lang:"de",date_locale:"de-DE"},{key:"cio_de",name:"CIO",hostname:"www.cio.de",whitepaper_hostname:"us.resources.cio.com",regions:[],logo_image:"image/cio.png",lang:"de",date_locale:"de-DE",product_id_key:"ciode"},{key:"cso_de",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:[],logo_image:"image/csoonline.jpeg",lang:"de",date_locale:"de-DE",product_id_key:"cso",base_url:"/de"}].map((({logo_image:e,...t})=>({logo_image:fe(e),...t}))),be=ge.reduce(((e,t)=>(e[t.key]=t,e)),{});function ye(e){return be[e]}async function we(e,{interval:t=300,timeout:s}={}){const i=e();return null!=i?i:new Promise(((i,n)=>{let o,r;function a(){o&&clearInterval(o),r&&clearTimeout(r)}o=setInterval((()=>{const t=e();null!=t&&(a(),i(t))}),t),s&&s>0&&(r=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}var ve=Object.freeze(function(){const o=function(e,t){return t?e.replace(t,""):e}((r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r,h.base_url);var r;switch(o){case"":return{type:e};case"/smart-answers":case"/de/smart-answers":return{type:t};case"/search":case"/de/search":return{type:s};default:if(h.regions.indexOf(o.substring(1))>=0)return{type:e}}const a=o.substring(1).split("/");if("article"===a[0]){const e=""+a[1];return{type:i,postId:e,product_id:`article_${h.product_id_key||h.key}_${e}`}}return{type:n}}());const Ee="%cMiso",Se="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const ke=[{key:"sap",name:"SAP",image:"image/sponsor/sap.svg"}];var Oe=function(){if(c.sponsor)return ke.find((e=>e.key===c.sponsor))||void 0}(),Ie=Object.freeze({__proto__:null,config:c,version:a,site:h,page:ve,sponsor:Oe,debug:function(...e){(c.debug||a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(Ee,Se,...e)}(...e)}}),xe="1.12.3-beta.5";const Ce=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Te{constructor(e,t){this._client=e,this._root=t,this._bulk=new ne(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:o}={}){const{apiKey:r,request:a={}}=this._client.options;n=n||a.timeout,(o=o||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":r});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,l=n?AbortSignal.timeout(n):void 0,u=await(this._root._customFetch||window.fetch)(e,y({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:l})),h=await u.json();if(u.status>=400||h.errors){var d=Error(h.message);throw d.data=h,d.status=u.status,d}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:i}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:n,status_code:o,body:r}=i[t];o>=400||n?s.reject({status_code:o,body:r}):s.resolve(r)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:i={}}=this._client.options,n=t.sendApiKeyByHeader||i.sendApiKeyByHeader,o=e.filter((e=>e)).join("/"),r=`${this.getApiEndpoint(o)}/${o}`;return n?r:`${r}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=Ce.DATA_ENDPOINT,eventEndpoint:s=Ce.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:i}){const n=this._client;for(const o of this._root._urlPasses)try{i=o({client:n,apiGroup:t,apiName:s,url:i})||i}catch(t){(e._error||console.error)(t)}return i}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:i}){const n=this._client;for(const o of this._root._payloadPasses)try{i=o({client:n,apiGroup:t,apiName:s,payload:i})||i}catch(t){(e._error||console.error)(t)}return i}}class Ae extends ae{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,o=this._apiPath,r=this._url({apiGroup:o,apiName:e,payload:t,options:s}),a={apiGroup:o,apiName:e,payload:t=this._preprocess({apiGroup:o,apiName:e,payload:t,options:s}),url:r,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...n}),this._postprocess(l)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:i,options:{bulk:n,...o}={}}){return n?this.helpers.fetchForBulk(e,t,i):this.helpers.fetch(s,i,o)}_postprocess({response:e}){return e.data}}const{GROUP:Re,NAME:Ne}=m;class $e extends Ae{constructor(e){super(e,Re.INTERACTIONS)}async upload(e,t){try{return await this._run(Ne.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Ne.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:i}=s;return this.helpers.sendBeacon(e,i,t),{}}return super._send({...s,options:t})}}class Le{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...i}=this._options;const n=new ue(s);let o;t=d(this._ac.signal,n.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:o}={}){if(o&&o.aborted)return[];let r,a,c=0,l=!1;function u(){r&&clearInterval(r),l=!0}const h=new M;return r=setInterval((async()=>{let t,r,d;try{if([t,r,d]=await e(o?{signal:o}:{}),l||!w(a)&&a>=d)return;w(d)||(a=d),n&&n(t,r,d),c=0}catch(e){return i&&i(e),c++,void(c>s&&(u(),h.error(e)))}h.update(t,r),r&&u()}),t),o&&o.addEventListener&&o.addEventListener("abort",(()=>{u(),h.abort(o.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?n.clear():this._isUpdated(o,e)&&n.touch(),o=e},...i})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||Pe(e.answer)!==Pe(t.answer)||Pe(e.reasoning)!==Pe(t.reasoning)}_revisionOf(e){return e&&e.revision}}class Ue extends Le{constructor(e,t,s,i){super(i),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}function Pe(e=""){return e.length}const{GROUP:qe,NAME:je}=m;class De extends Ae{constructor(e){super(e,qe.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e)&&(e={question_id:e}),e.question_id)return new Me(this,e,t);const s=await this._run(je.QUESTIONS,e,t);return new Me(this,s,t)}async _questions(e,t){return this._run(je.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${je.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(je.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(je.TRENDING_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(je.SEARCH,e,t);return s.question_id?new Fe(this,s,t):s}async _searchGet(e,t){return this._run(`${je.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(je.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(je.SEARCH_AUTOCOMPLETE,e,t)}}class Me extends Ue{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class Fe extends Ue{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),E(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:ze,NAME:Be}=m;class Qe extends Ae{constructor(e){super(e,ze.SEARCH)}async search(e,t){return this._run(Be.SEARCH,e,t)}async autocomplete(e,t){return this._run(Be.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(Be.MGET,e,t)}}const{GROUP:Ge,NAME:We}=m;class He extends Ae{constructor(e){super(e,Ge.RECOMMENDATION)}async userToProducts(e,t){return this._run(We.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(We.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(We.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(We.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(We.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(We.PRODUCT_TO_PRODUCTS,e,t)}}class Ve extends ae{constructor(e,t){super("api",e),this._client=e,this.helpers=new Te(e,t),this.interactions=new $e(this),this.ask=new De(this),this.search=new Qe(this),this.recommendation=new He(this)}}var Ke=Object.freeze({__proto__:null,Api:Ve,ApiBase:Ae,ApiHelpers:Te,Interactions:$e,Ask:De,Search:Qe,Recommendation:He});class Ye extends ae{constructor(e){super("context",e),this._client=e}}var Ze={api:Ke,context:{Context:Ye}};class Je{constructor(e){E(this,{install:e})}}class Xe extends ce{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new et(this,Ze),this.plugins=new tt(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new D);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const i=new s;return E(i,{id:e}),this._tryConfig(i,t),i;case"function":return new Je(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(e,t,s){const i=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),n=0>t?e.length:t,o=e.lastIndexOf("/",n)+1,r=e.indexOf(".",o),a=0>r?"":e.slice(r,n);return`${e.slice(0,o)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${i}.min.js`}(e,t,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new ie).get(s);!this.isRegistered(e)&&this.register(i)}}class et{constructor(e,t){v(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),E(this,{classes:t})}}class tt{constructor(e){v(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const st=new class extends ae{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Xe(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=xe,this._cmdRes=new D}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var it=Object.freeze({__proto__:null,viewable:N,debounce:W});const{currentScript:nt}=document;class ot extends ae{static attach(){(window.MisoClients||(window.MisoClients=[])).push(ot),window.MisoClient?window.MisoClient!==ot&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=ot}static debug(){}constructor(e){super("client",st),this._config(e),this.context=new Ye(this),this.api=new Ve(this,st),function(e){st._clients.push(e),st._events.emit("create",e)}(this)}get version(){return ot.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,y(e)}_readConfigFromScriptUrl(){return y({apiKey:new URL(new Request(nt.src||nt.href).url).searchParams.get("api_key")||void 0})}}ot.helpers=it,E(ot,{uuid:L()});var rt=function(e){const t=st._pluginRoot;return st.MisoClient=t.MisoClient=e,v(e,st,["version","instances","any","meta","on","once","cmdDone"]),v(e,t,["plugins"]),e}(ot);const{GROUP:at,NAME:ct}=m;let lt;class ut{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||lt||(lt=U("miso_anonymous_id",L))}set anonymous_id(e){e=b(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=b(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function ht(){const e=new URLSearchParams(window.location.search);let t=y({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class dt{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],i=e[t];i!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function _t(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:xe};return s.uuid||(s.uuid=L()),{...e,context:{...t,custom_context:s}}}const pt="std:native-fetch";let mt,ft;const gt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return mt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),mt="borrowed",e.contentWindow.fetch}catch(e){ft=e}})();const bt="miso-logdump",yt="miso-logdump",wt=yt+"__download-btn",vt="Miso Log";class Et{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return It||(It=B(Q("logdump")))}();let e=document.getElementById(bt);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||vt,t.classList.add(wt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=bt,e.classList.add(yt),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(bt),t=e&&e.querySelector("."+wt);t&&(t.textContent=this._options.logDownloadButtonText||vt)}hideDownloadButton(){const e=document.getElementById(bt);e&&(e.style.display="none")}download(){const e=new Blob([kt(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:St()})}return e&&"string"==typeof e?e:`miso-log.${St()}.jsonl`}clear(){this._logs=[]}}function St(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function kt(e){return e.map((e=>JSON.stringify(H(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Ot(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function Ot(e){return e?H(e,{depth:2}):e}let It;const xt="std:debug";function Ct(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}rt.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Et(e)}static get id(){return xt}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(xt,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,i)=>this._handleEvent(e,i,s,t)))}_handleEvent(e,{name:t},s,i=[]){if("child"===t||"subtree"===t)return;const n=i.concat(e.meta.path);if(n.length||"create"!==t){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(t,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(n[1],n.slice(2),t,s))}this._logw(n.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:i,bulk:n,...o}){const r=new URL(i).pathname,a=["api",e];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+r),"interactions"===t){const e=o.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=e,n="custom"===t&&s?`${t}:${s}`:t;a.push(i?`${n} (${i})`:""+n)}a.push([{...o,url:i}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,i){this._logw([e,t.join(".")],s,i)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Ct)):this._log(e,t,Ct(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return pt}install(e,t){gt?(t.setCustomFetch(gt),e.debug(`<plugin:${pt}>`,"[info]",`Using ${mt} native fetch`)):e.debug(`<plugin:${pt}>`,"[error]","Failed to obtain native fetch: "+ft.message)}}),rt.plugins.use(class extends ae{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new ut(this);var s,i;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:i}){return t===at.INTERACTIONS&&s===ct.UPLOAD?this._modifyPayloadForInteractions(e,i):t===at.ASK&&s===ct.QUESTIONS?this._modifyPayloadForAsk(e,i):this._modifyPayloadForOthers(e,i)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:i,anonymous_id:n}=e.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:i,user_type:n,anonymous_id:o}=e.context,r=s?{user_id:s,user_hash:i}:{anonymous_id:o};return s&&n&&(r.user_type=n),{...r,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:i}=e.context,n=y({anonymous_id:s,user_id:i});return{data:t=t.map((e=>({...n,...e})))}}}),rt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...y({page:y({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:ht()}),...e.context}})))}}}),rt.plugins.use(class extends ae{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new dt(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:i}){if(t===_.SEARCH)if(s===p.SEARCH)this._captureSearchApiRequest(e,i)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),rt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(_t)}}}),rt.plugins.use(class extends ae{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case _.SEARCH:case _.RECOMMENDATION:return!0}return!1}});const Tt="data-miso-product-id",At="default",Rt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),Nt=new Set([Rt.PRODUCTS,Rt.CATEGORIES,Rt.ATTRIBUTES,Rt.RESULTS,Rt.ITEMS,Rt.QUESTION,Rt.ANSWER,Rt.REASONING,Rt.IMAGES,Rt.SOURCES,Rt.RELATED_RESOURCES,Rt.FOLLOW_UP_QUESTIONS,Rt.QUERY_SUGGESTIONS,Rt.RELATED_QUESTIONS,Rt.AFFILIATION,Rt.FACETS,Rt.TOTAL]);function $t(e){return Nt.has(e)}const Lt=new Set([Rt.PRODUCTS,Rt.IMAGES,Rt.SOURCES,Rt.RELATED_RESOURCES]);const Ut=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),Pt=[Ut.IMPRESSION,Ut.VIEWABLE,Ut.CLICK,Ut.SUBMIT,Ut.FEEDBACK],qt=[Ut.IMPRESSION,Ut.VIEWABLE,Ut.CLICK],jt=new Set(qt);const Dt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Mt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),Ft=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function zt(e){if(0>Pt.indexOf(e))throw Error("Unrecognized event type: "+e)}const Bt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"});function Qt(e,t){return Object.freeze({...e,...t,members:Gt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Gt(e=[],t=[]){return[...new Set([...e,...t])]}function Wt(e,t){let s={};for(const i of e)i&&(s=t(s,i));return y(s)}function Ht(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Vt(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,i=t.payload,{...s,...i,...Kt("_meta",s,i)})});var s,i}))}function Kt(e,t,s){const i=t&&t[e],n=s&&s[e],o=i?n?{...i,...n}:i:n;return void 0!==o?{[e]:o}:{}}function Yt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function Zt(e){if(void 0===e)return;let[t,s]=g(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function Jt(e,t){return!1===(t=Zt(t))[0]?t:e&&t?[t[0]||e[0],Xt(e[1],t[1])]:t||e}function Xt(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const es=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function ts(e={}){e=Ht(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))ss(t);return e}function ss(e={}){return e=Ht(e)}function is(e={},t={}){const s={...e};for(const[i,n]of Object.entries(t))void 0!==n&&(s[i]=Pt.includes(i)?ns(e[i],n):n);return s}function ns(e={},t={}){return{...e,...t}}function os(e){return void 0===e?void 0:"function"!=typeof e?()=>e:e}const rs=[{key:Bt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return y({group:s,name:e,payload:t})},merge:Vt},{key:Bt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${Rt.PRODUCTS}: ... }) instead`),e={...s,[Rt.PRODUCTS]:t});const i={};for(const[t,s]of Object.entries(e))i[Yt(t)]=Zt(s);return i},merge:function(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>{for(const[s,i]of Object.entries(t))e[s]=Jt(e[s],i);return e}))}},{key:Bt.DATA_PROCESSOR,normalize:function(e){e=g(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:Bt.TRACKERS,normalize:function(e={}){e=Ht(e);const{active:t,...s}=e,i={};for(const[e,t]of Object.entries(s))i[e]=ts(t);return{active:t,...i}},merge:function(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>{for(const[s,i]of Object.entries(t))void 0!==i&&(e[s]="active"===s?i:is(e[s],i));return e}))}},{key:Bt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=g(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,i=t.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:Bt.FILTERS,normalize:Ht,merge:function(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>Object.assign(e,t)))}},{key:Bt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&Wt(e,((e,t)=>Object.assign(e,t)))}},{key:Bt.TEMPLATES,normalize:function(e={}){const t={};for(const[s,i]of Object.entries(e))t[s]=os(i);return t},merge:function(...e){return Wt(e,((e,t)=>{for(const[i,n]of Object.entries(t))e[i]=(s=e[i],os(n)||s);var s;return e}))}}];class as{constructor(){this._events=new oe({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class cs{constructor(e={},t={}){this._events=new oe({target:this}),this._defaults=t,this._context=e||{},this._locals={},E(this,{resolved:new ls(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class ls{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,i=s._context[e];this._cache[e]=t(s._defaults[e],i&&i.get(),s._locals[e])}return this._cache[e]}}class us{constructor(e,t,s,i,n){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?i(e):void 0,this._merge=n}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of rs){const{key:t,normalize:s,merge:i}=e;Object.defineProperty(as.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new us(this,this._globals,t,s,i))}}),Object.defineProperty(cs.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new us(this,this._locals,t,s,i))}}),Object.defineProperty(ls.prototype,t,{get:function(){return this._get(e)}})}const hs=[Bt.API,Bt.LAYOUTS,Bt.DATA_PROCESSOR,Bt.TRACKERS,Bt.INTERACTIONS];function ds(e,t=hs){for(const s of t)_s(e,s)}function _s(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+i](e){return this._options[t].merge(e),this},["clear"+i](){return this._options[t].set(),this}})}var s}const ps="q",ms="qs";function fs(e={}){const{setValue:t,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:i=ps,sourceParam:n=ms,...o}={}){return{setValue:e,focus:t,updateUrl:s,param:i,sourceParam:n,...o}}(e),o=new URLSearchParams(window.location.search),r=o.get(i),a=o.get(n)||void 0,{layout:c}=this._views.get(Rt.QUERY);c&&(r&&t&&(c.value=r),!r&&s&&c.focus()),r&&this.query(y({q:r,qs:a}))}class gs extends ae{constructor(e,t,s){super(e,t),this._name=e,this._plugin=t,this._client=s,this._options=new as}}function bs(e){return e?"view:"+e:"view"}ds(gs.prototype);class ys{constructor(e={}){(this._events=new oe)._injectSubscribeInterface(this),this._options=e,this._states={},E(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const i=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class ws{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:L(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function vs(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class Es{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e}async _handleRequest(e){if(!this.active)return;const{session:t,...s}=e;try{const{signal:i}=this._ac||{},n={...e.options,signal:i},o=await this._source({session:t,...s,options:n});if(o&&o[Symbol.asyncIterator]){let e;for await(e of(o._response&&this._emitResponseWithSessionCheck({session:t,request:s,value:o._response}),o)){if(!vs(this._hub,t))break;this._emitResponse({session:t,request:s,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:s,value:o})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:s,error:e})}}_emitResponseWithSessionCheck(e){vs(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ss{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{f(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:ks,VIEWABLE:Os,CLICK:Is}=Ut,{UNTRACKED:xs,TRIGGERED:Cs}=Dt,Ts=Object.freeze({[ks]:xs,[Os]:xs,[Is]:xs});class As{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Ts}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||xs}set(e,t,s){zt(t),function(e){if(e!==Dt.UNTRACKED&&e!==Dt.TRACKING&&e!==Dt.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const i of g(e))this._setOne(i,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Cs))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const i=s(t);return e.set(t,i),i}(this._states,this._getKey(e),(()=>({...Ts}))))[t]=s}}const Rs=[Symbol("itemless")];class Ns{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new As(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){zt(e);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:n=!0,itemless:o=!1}=i;if(n){if(o&&(t=Rs),0===(t=this._states.untriggered(g(t),e)).length)return;this._states.set(t,e,Dt.TRIGGERED)}this._sendToHub({type:e,items:o?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:Ut.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(y({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new As(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[bs(this._role)]}}for(const e of qt)Ns.prototype[e]=function(t,s){this._trigger(e,t,s)};function $s(e){return e&&e.meta&&e.meta.empty}class Ls{constructor(e,t){this._events=new oe({target:this}),this._views=e,this._mapping=Ps((e._roles.mappings||{})[t]||t),E(this,{role:t,interface:new Us(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ss((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===Rt.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Ns({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((n=t)===(o=i)||n&&o&&n.status===o.status&&n.error===o.error&&n.value===o.value&&n.ongoing===o.ongoing&&$s(n)===$s(o)&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(n.session,o.session)))return;var n,o;const{session:r,status:a,ongoing:c,request:l,meta:u,value:h}=t,d={session:r,status:a,ongoing:c,request:l,meta:u,data:h,...qs(this.role,t)},_=(e={},t)=>{!1!==e&&this.updateState({...d,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:_})}catch(e){this._error(e),_({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?Mt.ERRONEOUS:e.status;e=this._state=Object.freeze(y({...e,status:s}));const{role:i}=this;this.hub.update(bs(i),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:i,meta:n,...o}=e,r={value:this._mapping(e,this),status:i,data:t,meta:n,...o};return this.role===Rt.CONTAINER&&(r.meta={...n,empty:this._isContainerEmpty(e)}),y(r)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!$t(s))continue;if(!js(s,Ps((this._views._roles.mappings||{})[s]||s)(e,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Us{constructor(e){v(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Ps(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}function qs(e,t){return function(e){return e.status===Mt.READY&&!e.ongoing}(t)?{empty:!!js(e,t&&t.value)}:{}}function js(e,t){switch(e){case Rt.ANSWER:case Rt.REASONING:return!t||!t.value;default:return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}}function Ds(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class Ms{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new oe({target:this,error:s}),E(this,{facets:new Fs(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return y({facets:Object.freeze({}),sort:Ds(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(y({...e,...t,facets:Object.freeze(y({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Fs{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const zs=Symbol.for("miso:tracked");function Bs(e){return!!e[zs]}function Qs(e){e[zs]=!0}const Gs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function Ws(e,t){return!!t&&{...e,...t}}class Hs{constructor(e,{workflow:t,extensions:s,layouts:i,roles:n,options:o}){this._hub=e,this._workflow=t,this._workflowName=t._name,this._extensions=s,this._layoutFactory=i,this._options=o,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new Ms(this);for(const e of n.members)e!==Rt.CONTAINER&&(this._views[e]=new Ls(this,e));E(this,{interface:new Vs(this),trackers:new Ks(this,n.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),e.on("data",(e=>this.refresh({data:e}))),o.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Ls(this,Rt.CONTAINER);t.layout=this._createLayout(Rt.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,i]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName});if(t===Rt.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,i]=t;return this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:i={},...n}=e;return y({...Gs,...n,impression:Ws(Gs.impression,t),viewable:Ws(Gs.viewable,s),click:Ws(Gs.click,i)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=Rt.CONTAINER;this._containerTracker=new Ns({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class Vs{constructor(e){this._actor=e,v(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class Ks{constructor(e,t){this._views=e;for(const s of t)s!==Rt.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,Rt.CONTAINER,{get:()=>e._getContainerTracker()})}}class Ys{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:Ut.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Zs{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=g(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function Js(e){return async({group:t,name:s,payload:i,options:n})=>{if(t===_.ASK)switch(s){case p.QUESTIONS:return e.api.ask.questions(i,n);case p.SEARCH:return e.api.ask.search(i,n)}return e.api[t]._run(s,i,n)}}class Xs{constructor({role:e,workflow:t,...s}={}){E(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const i=this._rendered.get(e),n=q(!1);t=this._preprocess({state:t,rendered:i},{skip:n.t})||t,this._updatePending(t,s),n.value||this._handleInput({state:t,rendered:i},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,R((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const n=this._rendered.get(this._element),o=q([]),r=q({});this._render(this._element,{state:s,rendered:n,timestamp:e},{notifyUpdate:o.args,writeToState:r.merge,...t}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),i&&i(...o.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ei(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function ti(e,t,s,i){const{templates:n}=e,[o,r]=bi(e,s);return""+o+(n.indexBlock||fi)(e,s,i)+(n.infoBlock||n.articleInfoBlock||oi)(e,s,i)+r}function si(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ai)(e,t,s)+(n.descriptionBlock||li)(e,t,s)+(n.priceBlock||_i)(e,t,s)+(n.ctaBlock||gi)(e,t,s)}</div>`}function ii(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ai)(e,t,s)+(n.descriptionBlock||li)(e,t,s)+(n.priceBlock||_i)(e,t,s)}</div>`}function ni(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ai)(e,t,s)+(n.dateBlock||ui)(e,t,s)+(n.descriptionBlock||li)(e,t,s)+(n.ctaBlock||gi)(e,t,s)}</div>`}function oi(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ai)(e,t,s)+(n.authorsAndDateBlock||di)(e,t,s)}</div>`}function ri(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ai)(e,t,s)}</div>`}function ai({className:e},{title:t,_title_with_markups:s}){const i=Ei(s)||$(t);return i?`<div class="${e}__item-title">${i}</div>`:""}function ci({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function li({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${Ei(t)}</div>`:s?`<div class="${e}__item-desc">${$(s)}</div>`:""}function ui({className:e,templates:t},{created_at:s,updated_at:i,published_at:n}){const o=n||s||i;return o?`<div class="${e}__item-date">${vi(o,t.date)}</div>`:""}function hi({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function di(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-authors-and-date-container">${""+(n.authorsBlock||hi)(e,t,s)+(n.dateBlock||ui)(e,t,s)}</div>`}function _i(e,t){const{className:s,templates:i}=e,{sale_price:n,original_price:o,currency:r="USD"}=t,a=n||o;if(!a)return"";const c=void 0!==o&&void 0!==n&&o>n,l=t.discount_rate_percent||(c?Math.floor(100*(1-n/o)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${o}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||pi)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function pi(e,{discount_rate_percent:t}){return`(${t}% off)`}function mi(e,t,s={}){const{className:i,templates:n}=e,{cover_image:o,image_src:r,image_alt:a}=t;if(!o&&!r)return"";const c=r?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${o}">`}${"cover-image"===c&&s.brand?(n.brandBlock||ci)(e,t,s):""}</div>`}function fi({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function gi(e,t,s){const{className:i,templates:n}=e,o=Si.asFunction(n.cta)(e,t,s);return o?`<div class="${i}__item-cta-container">${o}</div>`:""}function bi({className:e,options:t={}},{product_id:s,url:i},{classSuffix:n="item-body",role:o="item",...r}={}){const a=!1!==r.link&&i?"a":"div",c=!1!==r.link&&i?`href="${i}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:i=!0}=e;let n="";i&&(t&&(n+=` target="${t}"`),s&&(n+=` rel="${s}"`));return n}(t.link)}`:"";return[`<${a} class="${e}__${n}" ${o?`data-role="${o}"`:""} ${s?`${Tt}="${s}"`:""} ${c}>`,`</${a}>`]}const yi=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),wi="en-US";function vi(e,t=yi){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||yi.locale,t);default:throw Error("Invalid date format: "+t)}}function Ei(e){return e&&e.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Si=Object.freeze({tagPair:bi,formatDate:vi,formatNumber:function(e,t=wi){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||wi.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},formatHtmlWithMarkup:Ei,escapeHtml:$,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class ki extends Xs{constructor({className:e,templates:t,...s}={}){super(s),E(this,{className:e,templates:{...ei("root"),...t,helpers:Si}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Oi extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Oi.MisoClient.ui.layouts.create("banner").render(this)}}class Ii{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(e,{ac:s});let n=!1;try{await N(e,{...t,signal:i}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return n}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class xi extends Xs{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new Ii}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Oi.tagName,s=this._shallRenderBanner(e),i=e.querySelector(t);s&&!i?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&i&&i.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,i=void 0!==s&&"auto"!==s?s:t;return"auto"===i?e.components.some((({role:e})=>function(e){return e===Rt.PRODUCTS||e===Rt.ANSWER}(e))):!!i}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:o=!1,unanswerable:r=!1}={}}=t,a=[s,o?Mt.EMPTY:Mt.NONEMPTY];s===Mt.READY&&a.push(i?Mt.ONGOING:Mt.DONE),r&&a.push(Mt.UNANSWERABLE),e.setAttribute("status",a.join(" ")),n?e.setAttribute("miso-id",n):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===Mt.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const Ci=Object.freeze({root:function(e,t){const{className:s,templates:i}=e,{status:n,value:o}=t;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(e,o)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class Ti extends ki{static get type(){return"error"}static get defaultTemplates(){return Ci}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...Ci,...t},...s})}}const Ai=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Ri(e,t){const s=[];for(const i of t.entries){const t=e.e2b.get(i.element);t&&t.key===i.key||s.push(i)}return s}class Ni{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const i=function(e,t,s){const i=new Map,n=new Map,o=[];for(let r=0;e.length>r;r++){const a=e[r],c=s[r],l=Object.freeze({index:r,key:a,value:t[r],element:c});i.set(a,l),n.set(c,l),o.push(l)}return{k2b:i,e2b:n,entries:o}}(e,t,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},o=Ri(n,i),r=Ri(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:o,unbounds:r}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function $i(e){K(e,Li.prototype)}class Li{_initTrackable(){this._bindings=new Ni,this._viewables=new Ii}_syncBindings(e,t){const s=this._getItems(t)||[],i=s.map((e=>this._getItemKey(e))),n=this._getItemElements(e),{bounds:o,unbounds:r}=this._bindings.update(i,s,n);this._onBindingsUpdate(o,r)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:i}of e)(async()=>{await this._viewables.track(i,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!Bs(t)&&0===t.button&&!t.defaultPrevented&&!!T(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(Qs(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Ui{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===Mt.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let i=!1;try{await N(t,{area:1,duration:0,signal:s.signal}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Pi=Object.freeze({product:function(e,t,s,i){const{templates:n}=e,[o,r]=bi(e,s);return""+o+(n.imageBlock||mi)(e,s,i)+(n.infoBlock||n.productInfoBlock||ii)(e,s,i)+r},article:function(e,t,s,i){const{templates:n}=e,[o,r]=bi(e,s);return""+o+(n.imageBlock||mi)(e,s,i)+(n.infoBlock||n.articleInfoBlock||ni)(e,s,i)+(n.indexBlock||fi)(e,s,i)+r},compactArticle:ti,image:function(e,t,s,i){const{templates:n}=e,[o,r]=bi(e,s);return""+o+(n.imageBlock||mi)(e,s,i)+(n.infoBlock||n.imageInfoBlock||ri)(e,s,i)+r},question:function(e,t,s){const[i,n]=bi(e,s);return`${i}${s.value||s.text||s}${n}`},root:function(e,t){const{className:s,role:i,templates:n,options:o}=e,{status:r}=t;return`<div class="${s} ${r}"${i?` data-role="${i}"`:""}${o.itemType?` data-item-type="${o.itemType}"`:""}>${r===Mt.READY?n[r](e,t):""}${n.trigger(e,t)}${n.loading(e,t)}</div>`},[Mt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t)||[];return i.length>0||t.ongoing?s.body(e,t,i):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:i,templates:n,options:o}=e,r=n.ordered?"ol":"ul";return`<${r} class="${i}__list" data-role="list"${o.itemType?` data-item-type="${o.itemType}"`:""}>${n.items(e,t,s)}</${r}>`},ordered:!1,items:function(e,t,s,{offset:i=0}={}){const{templates:n}=e;let o=i;return s.map((s=>n.item(e,t,s,o++))).join("")},item:function(e,t,s,i){const{className:n,templates:o,options:r}=e,{itemType:a}=r;return`<li class="${n}__item">${o[a](e,t,s,{index:i})}</li>`},productInfoBlock:ii,articleInfoBlock:ni,compactArticleInfoBlock:oi,imageInfoBlock:ri,brandBlock:ci,titleBlock:ai,descriptionBlock:li,dateBlock:ui,authorsBlock:hi,authorsAndDateBlock:di,priceBlock:_i,discountRateText:pi,ctaBlock:gi,cta:function(e,t,s){const{templates:i}=e,{url:n}=t;if(!n)return"";const[o,r]=bi(e,{url:n},{classSuffix:"item-cta",role:"cta"}),a=Si.asFunction(i.ctaText)(e,t,s);return a?`${o}${a}${r}`:""},imageBlock:mi,indexBlock:fi,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class qi extends ki{static get defaultTemplates(){return Pi}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Pi,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=this._html(e,t,s);return{...e,incremental:s,html:i}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:i,html:n}=t;if(i)if(n){this._getListElement(e).insertAdjacentHTML("beforeend",n)}else s(!1);else e.innerHTML=n}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value&&(e.value.products||e.value)}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:i,element:n}=t;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}$i(qi.prototype),K(qi.prototype,Ui.prototype);const ji="miso-list";class Di extends qi{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ji}constructor({className:e=ji,...t}={}){super({className:e,...t})}}const Mi="miso-horizontal";class Fi extends qi{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Mi}constructor({className:e=Mi,...t}={}){super({className:e,...t})}}const zi="miso-cards";function Bi(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function Qi(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function Gi(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),i=t[2]||"";return[s,i]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function Wi(e){return void 0===e||e instanceof Hi?e:new Hi(e)}class Hi{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=Wi(e),Wi([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class Vi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,R((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),i=t.itemCount,n=t.itemCount=s?s.length:void 0;n!==i&&(void 0===n?t.itemIndex=void 0:void 0===i&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(Bi(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let i=0;for(const t of s.children)Qi(t,"active",i===e),i++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const Ki="miso-ui-icon",Yi=Ki+"-svg-1_12_3-beta_5",Zi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},Ji=`<symbol id="${Ki}-${Zi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Xi=`<symbol id="${Ki}-${Zi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,en=`<symbol id="${Ki}-${Zi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,i=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-i} ${i}L${i} ${t-i}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,tn=`<svg id="${Yi}" style="display:none;">${[Ji,Xi,en,`<symbol id="${Ki}-${Zi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${Ki}-${Zi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${Ki}-${Zi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${Ki}-${Zi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let sn=!1;function nn(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${Ki}-${e}"></use></svg>`}sn||document.head.querySelector("#"+Yi)||(sn=!0,document.head.insertAdjacentHTML("beforeend",tn));const on=new Set(Object.values(Zi));nn(Zi.SEND),nn(Zi.SEARCH);const rn=nn(Zi.TRIANGLE);nn(Zi.TRIANGLE_EQ);const an=nn(Zi.CHEVRON),cn=nn(Zi.CHEVRON_NEGATIVE),ln=nn(Zi.BULB),un="miso-carousel",hn=Object.freeze({body:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${n.list(e,t,s)}</div></div>${n.controls(e,t,s)}`},controls:function(e,t,s){const{templates:i}=e;return`${i.controlContainer(e,t,"previous")}${i.controlContainer(e,t,"next")}${i.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-container-${s}">${n.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?cn:an},indexIndicator:function(e,t,s){const{className:i,templates:n}=e;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${i}__index-indicator-item">${n.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),dn=Object.freeze({...qi.defaultTemplates,...hn});class _n extends qi{static get type(){return"carousel"}static get defaultTemplates(){return dn}static get defaultClassName(){return un}constructor({className:e=un,templates:t,...s}={}){super({className:e,templates:{...hn,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){K(e,Vi.prototype)}(_n.prototype);const pn="16rem",mn=Object.freeze({...qi.defaultTemplates,item:function(e,t,s,i){const{className:n,templates:o,options:r}=e,{itemType:a}=r,c=o[a](e,t,s,{index:i});return`<li class="${n}__item${s._size?` ${n}__item-${s._size}`:""}">${c}</li>`}}),fn="miso-gallery";class gn extends qi{static get type(){return"gallery"}static get defaultTemplates(){return mn}static get defaultClassName(){return fn}constructor({className:e=fn,templates:t,...s}={}){super({className:e,templates:{...mn,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=s?void 0:this._bodyHtml(e),n=this._itemsHtml(e,t);return{...e,...y({incremental:s,bodyHtml:i,itemsHtml:n})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const i=this._renderListElement(e,t,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:i}=t;return s||(e.innerHTML=i),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,i)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const i=e.children.length,n=this._writeItemSizes((this._getItems(t)||[]).slice(i),s,i);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,n,{offset:i}))}_writeItemSizes(e,[t=0,s=0]=[],i=0){let n=0;i>0&&(n=Math.min(i,t),i-=n,t-=n),i>0&&(n=Math.min(i,s),i-=n,s-=n);const o=[];for(const i of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),o.push({...i,_size:e})}return o}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=Wi(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:i}=t,{height:n=pn}=this.options,o=Gi(n),r=e.clientWidth;if(0===r)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(r*i.width*2/(o*i.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),i=e;const n=Math.min(Math.floor(s/3),i);i-=n,s-=3*n;const o=Math.min(s,i);return i-=o,s-=o,[n,o,i]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,i=0]=t;const{className:n}=this;for(const t of e.children){let e=!1,o=!1;s>0?(e=!0,s--):i>0&&(o=!0,i--),Qi(t,n+"__item-large",e),Qi(t,n+"__item-medium",o),Qi(t,n+"__item-small",!e&&!o)}}}const bn="miso-search-box";const yn=Object.freeze({root:function(e){const{className:t,templates:s,role:i,options:n,autocomplete:o}=e,{placeholder:r}=n;return`\n<div class="${t}" ${i?`data-role="${i}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${o.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=t;var o;return("function"==typeof i?i(e):""+i)+("function"==typeof n?n(e):(on.has(o=n)?nn(o):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:i,autocomplete:n}=e;e={templates:s,workflow:i,...n};const o=[],r=[];for(const e of t)(e.product?o:r).push(e);return s.queries(e,r)+(r.length>0&&o.length>0?"<hr>":"")+s.products(e,o)},completionList:function(e,t,s){const{className:i,templates:n}=e;return`<ul class="${i}__${t}-list" data-role="${t}-list">${s.map((s=>n.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:i,templates:n}=e;return`\n<li class="${i}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${n[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||$(t)},product:function(e,{product:t}){const{templates:s}=e,[i,n]=s.helpers.tagPair(e,t,{role:!1});return""+i+s.imageBlock(e,t)+s.productInfoBlock(e,t)+n},imageBlock:mi,productInfoBlock:ii}),wn=Object.freeze({className:"miso-autocomplete",debounce:300});class vn extends ki{static get type(){return"search-box"}static get defaultTemplates(){return yn}static get defaultClassName(){return bn}constructor({className:e=bn,templates:t,autocomplete:s,...i}={}){super({className:e,templates:{...yn,...t},...i}),E(this,{autocomplete:{...wn,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=W(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:i}){if(!t.completions)return;const{status:n=Mt.INITIAL,session:o,value:r}=t.completions,{index:a}=o;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);Qi(e,"nonempty",u.length>0),l.setAttribute("data-status",n),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:n}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return En.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new En(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&T(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let i=t;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const t=i.getAttribute("data-index"),n=this._context().data.get(parseInt(t)),o=n&&n.text;return o&&(s&&(s.value=o),this._view._events.emit("select",Object.freeze({value:n,index:t,domEvent:e})),e.defaultPrevented||this._submit(o)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[Ut.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class En{static empty(){return En._empty||(En._empty=new En)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,i=[];for(const n in e)for(const o of e[n])o.product&&!o.product.url||(o._index=t,o._field=n,s.set(t,o),i.push(o),t++);return i}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const Sn="miso-option-list";const kn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:i}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>i.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${$(t.text||t)}</li>`}});class On extends ki{static get type(){return"option-list"}static get defaultTemplates(){return kn}static get defaultClassName(){return Sn}constructor({className:e=Sn,templates:t,...s}={}){super({className:e,templates:{...kn,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_render(e,t,s){super._render(e,t,s);const{state:i}=t;this._syncOptionValues(e,i)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;Qi(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;i&&(this._trackClick(e,s),this._select(i.text))}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}$i(On.prototype);const In=Object.freeze({...ei("options"),root:function(e){const{className:t,role:s,templates:i}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${i.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:i}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${i.content(e,t)}\n</div>\n`}});class xn extends ki{static get defaultTemplates(){return In}constructor({className:e,templates:t,field:s,defaultValue:i,...n}={}){super({className:e,templates:{...In,...t},...n}),this._field=s,this._defaultValue=i}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=T(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=t.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],R((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:i}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",i),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const Cn="miso-feedback",Tn=["helpful","unhelpful"];const An=Object.freeze({options:function(e){const{templates:t}=e;return Tn.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:i,options:n={}}=e;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(e,t)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Rn extends xn{static get type(){return"feedback"}static get defaultTemplates(){return An}static get defaultClassName(){return Cn}constructor({className:e=Cn,templates:t,...s}={}){if(super({className:e,templates:{...An,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Nn="miso-text";const $n=Object.freeze({root:function(e,{value:t}){const{className:s,role:i,options:{raw:n=!1,tag:o}}=e,r=i?`data-role="${i}"`:"",a=void 0!==t?$(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:i}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[n,o]=t;switch(n){case"date":return e=>s(e,o);case"number":return e=>i(e,o);default:return e=>""+e}}(e)(t)):"";return n?a:`<${o} class="${s}" ${r}>${a}</${o}>`}});class Ln extends ki{static get type(){return"text"}static get defaultTemplates(){return $n}static get defaultClassName(){return Nn}constructor({className:e=Nn,templates:t,tag:s="p",...i}={}){super({className:e,templates:{...$n,...t},tag:s,...i})}}class Un extends Xs{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=q(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Pn{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:i,cursor:n,done:o}){const r=i.length;n=Math.min(n,r);const a=!!o&&n===r,c=t.substring(0,s),l=!i.startsWith(c);return a||l?e.innerText=i:e.insertAdjacentText("beforeend",i.substring(s,n)),a&&e.classList.add("done"),{cursor:n,done:a}}}function qn(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:i,format:n,builtInStyles:o=!0}}=e;"auto"===i&&(i="markdown"===n?"div":"p");const r=s?`data-role="${s}"`:"",a=[t,jn(t)];o&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${r} data-format="${n}"></${i}>`}(e));const i=t.children[0];return i.setAttribute("data-status",s||Mt.INITIAL),i}function jn(e){return e+"__cursor"}function Dn(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:i,ref:n,operation:o,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Mn(i[0])}, ${Mn(i[1])})`,t,""+o,n,r)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Mn(e){return Math.floor(100*e)/100+"ms"}const Fn="miso-typewriter";class zn extends Un{static get type(){return"typewriter"}static get defaultClassName(){return Fn}constructor({className:e=Fn,tag:t="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:o,nextCursorFn:r,...a}={}){super({tag:t,format:s,tooltip:i,...a}),E(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:X({speed:n,acceleration:o}),this._readiness=new D,"markdown"===s&&zn.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=jn(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:i,onDebug:Dn(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Pn}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:{value:s="",stage:i,finished:n}={},session:o,status:r}=e,a=(l=e,(c=t)&&l&&c.session&&l.session&&c.session.uuid===l.session.uuid);var c,l;const u=t?a&&i===t.stage?t.streak:t.streak+1:0,h=a&&t&&t.doneAt||(r===Mt.READY&&n?performance.now():void 0);return this._prevState=Object.freeze(y({session:o,status:r,value:s,stage:i,streak:u,doneAt:h,done:void 0!==h}))}_render(e,{state:t,rendered:s},{notifyUpdate:i,writeToState:n,loop:o}){const r=qn(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(r,s,{...t,cursor:e})}n(a);const l=t.status===Mt.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===Mt.READY)&&!c}),l&&o()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const i=t.closest('[data-role="follow-up-link"]');if(i){let{q:t}=i.dataset;return t=t?t.trim():void 0,void(t&&this._view._events.emit("follow-up-click",{event:e,q:t}))}const n=t.closest("a");if(n){if(!e.defaultPrevented){const{href:t,innerText:s,className:i}=n;t&&this._view._events.emit("link-click",y({event:e,url:t,text:s?s.trim():"",className:i||"",attributes:Bn(n)}))}}else;}}function Bn(e){const{attributes:t}=e,s={};for(const{name:e,value:i}of t)e.startsWith("data-")&&(s[e]=i);try{return JSON.stringify(s)}catch(e){return"{}"}}const Qn="miso-affiliation";const Gn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n,options:o}=e,{status:r}=t,a=i?` data-role="${i}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${o.itemType?` data-item-type="${o.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${r===Mt.READY?n[r](e,t):""}</div>`},[Mt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t);return i&&i.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}-container">${n.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return rn},body:function(e,t){const{className:s,templates:i}=e,n=e._getItems(t);return`<div class="${s}__body">${i.list(e,t,n)}</div>`},item:function(e,t,s,i){const{className:n,templates:o,options:r}=e,{itemType:a}=r;return`<li class="${n}__item"><div class="${n}__item-inner">${o.itemHeader(e,t,s,{index:i})}${o[a](e,t,s,{index:i})}</div></li>`},itemHeader:function(e,t,s,i){const{className:n,templates:o}=e;let{itemHeaderLeftText:r,itemHeaderRightText:a}=o;return r=Si.asFunction(r)(e,t,s,i),a=Si.asFunction(a)(e,t,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${r}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,i){const{templates:n}=e,[o,r]=bi(e,s,{link:!1});return""+o+(n.infoBlock||n.affiliationInfoBlock||si)(e,s,i)+(n.imageBlock||mi)(e,s,{brand:!0,...i})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,i){const{className:n,templates:o}=e,r=Si.asFunction(o.logoText)(e,t,s,i)||"",a=Si.asFunction(o.logoImg)(e,t,s,i);return a?`<span class="${n}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(e,t,s,i){const{className:n,templates:o}=e,r=Si.asFunction(o.logoUrl)(e,t,s,i);if(!r)return"";const a=Si.asFunction(o.logoAltText)(e,t,s,i);return`<img class="${n}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Wn=Object.freeze({...qi.defaultTemplates,...Gn});class Hn extends qi{static get type(){return"affiliation"}static get defaultTemplates(){return Wn}static get defaultClassName(){return Qn}constructor({className:e=Qn,templates:t,autoplay:s,...i}={}){super({className:e,itemType:"affiliation",templates:{...Gn,...t},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new le(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,R((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(Bi(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const Vn="miso-facets",Kn="miso-facet",Yn="custom_attributes.";const Zn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:i={}}=t.value||{};return Object.keys(i).map((n=>s.facet(e,{field:n,entries:i[n]},t)))},facet:function(e,t,s){const{facetClassName:i=Kn,templates:n}=e,{field:o}=t;return`<div class="${i}" data-role="facet" data-field="${$(o)}">${n.header(e,t,s)}${n.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:i=Kn,templates:n}=e;return`<div class="${i}__header">${n.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(Yn)&&(t=t.substring(18)),$(t)},options:function(e,{field:t,entries:s},i){const{facetClassName:n=Kn,templates:o}=e;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>o.option(e,{field:t,value:s,count:n},i))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:i=Kn,templates:n}=e;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(e,t,s)}</span>\n  <span class="${i}__count">${n.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return $(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function Jn(e,t){return`${e}:::${t}`}function Xn(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class eo extends ki{static get type(){return"facets"}static get defaultTemplates(){return Zn}static get defaultClassName(){return Vn}constructor({className:e=Vn,templates:t,...s}={}){super({className:e,templates:{...Zn,...t},...s}),this._bindings=new Ni}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=Xn(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)this._setSelected(i,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=Xn(e.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)t[e]&&this._setSelected(i,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),i=[],n=[],o=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),r=s[e];if(!r)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=r[t];if(!c)break;i.push(Jn(e,c)),n.push({field:e,value:c}),o.push(s)}}this._bindings.update(i,n,o)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[$(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;if(!i)return;const{field:n,value:o}=i;this._view.filters.facets.toggle(n,o),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const to="miso-select";const so=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e,o=i?`data-role="${i}"`:"",r=e._getItems(t),a=r.find((e=>e.selected))||r[0];return`\n<div class="${s}" ${o}>\n  ${n.button(e,a)}\n  ${n.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:i}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:i}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>i.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:i}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${i.text(e,t)}</li>`},text:function(e,t){return $(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,((e,t)=>" "+t))||t||"")}});class io extends ki{static get type(){return"select"}static get defaultTemplates(){return so}static get defaultClassName(){return to}constructor({className:e=to,templates:t,...s}={}){super({className:e,templates:{...so,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}$i(io.prototype);const no="miso-more-button";const oo=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${t.status!==Mt.READY?" disabled":""}>\n  ${n.text(e)}\n</div>\n`},text:function(e){return"More"}});class ro extends ki{static get type(){return"more-button"}static get defaultTemplates(){return oo}static get defaultClassName(){return no}constructor({className:e=no,templates:t,...s}={}){super({className:e,templates:{...oo,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var ao=Object.freeze({__proto__:null,TemplateBasedLayout:ki,ContainerLayout:xi,ErrorLayout:Ti,BannerLayout:class extends ki{static get type(){return"banner"}static get defaultTemplates(){return Ai}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Ai,...t},...s})}},CollectionLayout:qi,ListLayout:Di,HorizontalLayout:Fi,CardsLayout:class extends qi{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return zi}constructor({className:e=zi,...t}={}){super({className:e,...t})}},CarouselLayout:_n,GalleryLayout:gn,SearchBoxLayout:vn,OptionListLayout:On,FeedbackLayout:Rn,TextLayout:Ln,TypewriterLayout:zn,AffiliationLayout:Hn,FacetsLayout:eo,SelectLayout:io,MoreButtonLayout:ro});function co(e){return e&&e.value&&e.value.revision}function lo(e){const t=function(e){if(!e)return Mt.INITIAL;const{request:t,error:s,value:i}=e;return s?Mt.ERRONEOUS:i?Mt.READY:t?Mt.LOADING:Mt.INITIAL}(e);return y({status:t,ongoing:t===Mt.READY?e.ongoing:void 0,...e})}function uo(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:i}=s;i&&(t.meta.miso_id=i)}function ho(e){const{request:t,value:s}=e;if(!t)return e;const{payload:i}=t||{},{q:n}=i||{};return n?{...e,value:{...s,keywords:n}}:e}function _o(e){const{role:t,type:s,items:i}=e,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:y({property:t})}};switch(function(e){return jt.has(e)}(s)&&(!function(e,t=[]){return function(e){return Lt.has(e)}(e)||t.length>0&&"object"==typeof t[0]&&t[0].product_id}(t,i)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map((e=>e.text||e.id||e))):n.product_ids=(i||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case Ut.SUBMIT:n.context.custom_context.value=e.value;break;case Ut.FEEDBACK:n.context.custom_context.value=n.value=e.value,n.context.custom_context.result_type=n.result_type=e.result_type}return y(n)}function po(e={},t={}){return y({...e,...t,context:y({...e.context,...t.context,custom_context:y({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const mo=Object.freeze({}),fo=Object.freeze({[Rt.CONTAINER]:xi.type,[Rt.ERROR]:Ti.type}),go=Object.freeze({}),bo=Object.freeze({api:mo,layouts:fo,trackers:go}),yo=Object.freeze({mappings:{[Rt.ERROR]:e=>e.error}});class wo extends ae{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:i,defaults:n,options:o}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=i=i||t._client,e=Object.freeze({...e,plugin:s,client:i}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=o||new cs(t&&t._options,n),this._hub=new ys({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({roles:e}){const t=this._hub,s=this._client,i=this._options,n=this._extensions,o=this._plugin.layouts;this._sessions=new ws(t),this._data=new Es(t,{source:Js(s),options:i}),this._views=new Hs(t,{extensions:n,layouts:o,roles:e,options:i,workflow:this}),this._interactions=new Zs(t,{client:s,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("session",(e=>this._onSession(e))),this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(bs(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:i}){i||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[bs(e)]||{};t.session&&t.status===Mt.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onSession(e){this.updateData({session:e})}_onMainViewUpdate(e){const{status:t}=e,s=t===Mt.READY,i=t===Mt.ERRONEOUS;this._emitLifecycleEvent(i?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||i)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(e);return i.add(e),!n}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Vt(this._options.resolved.api,e);this.updateData({session:t,request:s}),this._hub.update("request",{...s,session:t})}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=co(e);if(!w(s)){const e=co(this._hub.states.data);if(!w(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){const t=this._hub.states.data;e=this._defaultProcessData(e,t);for(const s of this._options.resolved.dataProcessor)e=s(e,t);this._updateDataInHub(e,t)}_defaultProcessData(e,t){return e=function(e,t){if(!e||!e.value||e.request||!t||!t.request)return e;const{request:s}=t;return{...e,request:s}}(e,t),e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=lo(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:Mt.READY,session:this.session,...t},this._hub.update(bs(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=_o(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)t=i(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==Rt.AFFILIATION)return e;const{items:s}=t;return po(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return po(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[bs(t.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?po(e,{miso_id:i}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function vo(e){if(e.affiliation_products){const{affiliation_products:t,...s}=e;e={...s,affiliation:Eo(t)}}else if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:So(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:i}=t;if(!i)return e;i=i.map((e=>({...e})));let n=0;for(const e of i)s&&(e.channel=s),e.position=n++;return{...e,affiliation:{...t,products:i}}}(e)}function Eo(e){return{channel:"miso",products:e}}function So({products:e,...t}){return{channel:"sovrn",...t,products:e.map(ko)}}function ko({id:e,deeplink:t,headline:s,description:i,currency:n,retailPrice:o,salePrice:r,discountRate:a,image:c,thumbnail:l,merchant:u,...h}){return y({id:"sovrn-"+e,title:s,description:i,cover_image:c,url:t,currency:n,original_price:o,sale_price:r,discount_rate_percent:a,brand:u&&u.name,brand_logo:u&&u.logo,custom_attributes:Oo({sovrn_id:e,thumbnail:l,merchant:u,...h})})}function Oo(e,t=""){return Object.keys(e).reduce(((s,i)=>{const n=e[i];if(void 0===n)return s;const o=t?`${t}_${i}`:i;return"object"==typeof n?{...s,...Oo(n,o)}:{...s,[o]:n}}),{})}function Io(e){K(e,xo.prototype)}ds(wo.prototype),Object.assign(wo,{DEFAULT_API_OPTIONS:mo,DEFAULT_LAYOUTS:fo,DEFAULT_TRACKERS:go,DEFAULT_OPTIONS:bo,ROLES_OPTIONS:yo});class xo{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=t;else{window.open(t,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const Co=Object.freeze({...wo.DEFAULT_API_OPTIONS,group:_.ASK,payload:{...wo.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),To=Object.freeze({actor:!1,api:{group:_.ASK,name:p.AUTOCOMPLETE}}),Ao=Object.freeze({...wo.DEFAULT_LAYOUTS,[Rt.QUERY]:[vn.type,{placeholder:"Ask a question"}],[Rt.QUESTION]:[Ln.type,{tag:"h2"}],[Rt.ANSWER]:zn.type,[Rt.FEEDBACK]:Rn.type,[Rt.IMAGES]:[gn.type,{incremental:!0,itemType:"image"}],[Rt.SOURCES]:[Di.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Rt.AFFILIATION]:[Hn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Ro=Object.freeze({...wo.DEFAULT_TRACKERS,[Rt.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:es.click},[Rt.IMAGES]:es,[Rt.SOURCES]:es,[Rt.AFFILIATION]:es,[Rt.PRODUCTS]:es}),No=Object.freeze({...wo.DEFAULT_OPTIONS,api:Co,autocomplete:To,layouts:Ao,trackers:Ro}),$o=Qt(wo.ROLES_OPTIONS,{main:Rt.ANSWER,members:Object.keys(Ao),mappings:{[Rt.ANSWER]:function(e){if(!e||!e.value)return;const{answer:t="",answer_stage:s,finished:i}=e.value;return Object.freeze({value:t,stage:s,finished:!!i})},[Rt.REASONING]:function(e){if(!e||!e.value)return;const{reasoning:t="",reasoning_finished:s}=e.value;return Object.freeze({value:t,stage:"reasoning",finished:!!s})}}});class Lo extends wo{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new Ys(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(Rt.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(Rt.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[bs(this._roles.main)]||{};e.session&&e.status!==Mt.INITIAL&&(e.status!==Mt.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,i=t===Mt.READY&&!e.ongoing,n=t===Mt.ERRONEOUS,o=i?"done":n?"error":t,r=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(o,e),(i||n)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){fs.call(this,e)}query(e){if(!e.q&&!e.questionId)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||Ft.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==ps?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e,t){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:vo(t)}}(e=super._defaultProcessData(e,t)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_updateUrlIfNecessary({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,n=e&&e.question||t&&t.payload&&t.payload.question,o=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source;if(!n)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(i)||Ft.ORGANIC;n===a&&o===c||(r.searchParams.set(s,n),o===Ft.ORGANIC?r.searchParams.delete(i):r.searchParams.set(i,o),window.history.replaceState({},"",r))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=function(e,{event_target:t}={}){return t?po(e,{context:{custom_context:{event_target:t}}}):e}(e=this._writeAnswerClickInteraction(e,t),t)}_writeAskPropertiesToInteraction(e={},t){return po(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==Rt.ANSWER)return e;const{items:s=[]}=t;return po(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[bs(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e,event:t}){if(0!==t.button)return;if(Bs(t))return;const{value:s}=this._hub.states.data||{},{sources:i}=s||{},n=i&&i[e-1];n&&n.product_id&&(Qs(t),this._views.trackers.sources.click([n.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){0===e.button&&(Bs(e)||(Qs(e),this._views.trackers.answer.click([],{items:[t]})))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Io(Lo.prototype),Object.assign(Lo,{DEFAULT_API_OPTIONS:Co,DEFAULT_AUTOCOMPLETE_OPTIONS:To,DEFAULT_LAYOUTS:Ao,DEFAULT_TRACKERS:Ro,DEFAULT_OPTIONS:No,ROLES_OPTIONS:$o});var Uo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var Po=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class qo{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class jo{constructor(e){this._context=e,E(this,{lowerCamelToKebab:O,kebabToLowerCamel:S,kebabOrSnakeToLowerCamel:k})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...i}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=k(e))||"querySuggestions"===e?"followUpQuestions":e}phrase(e,{name:t,extraNames:s=[],tag:i="div",inline:n=!1}){const{classPrefix:o}=e;return`<${i} class="${n?o+"__phrase-inline":o+"__phrase"} ${[t,...s].map((e=>`${o}__${e}-phrase`)).join(" ")}">${this.phraseText(e,S(t))}</${i}>`}phraseText(e,t){const{phrases:s={}}=e,i=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof i){case"function":return i(e);case"string":return i;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:i,extraNames:n=[],visibleWhen:o,trait:r,logo:a=!1},c){const l=[i,...n].map((t=>`${e}__${t}-container`));return t&&l.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:l,visibleWhen:o,trait:r,logo:a,parentQuestionId:s},c)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const i=t[e];void 0!==i&&(s+=` ${O(e)}="${i}"`)}return s}}const Do=Y(new jo({...Uo,DEFAULT_PHRASES:Po})),Mo=Y(new class extends qo{constructor(){super({helpers:Do})}answerGroup(e){const{container:t}=this._helpers;return[this.question(e),this.reasoning(e),this.answer(e),this.affiliation(e),this.sources(e),this.followUpQuestions(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"question",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",s(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(e={}){const{phrases:t,reasoning:s={}}=e,{container:i,element:n,phraseText:o}=this._helpers,r=[];return s.expand&&r.push("expanded"),i(e,{name:"reasoning",visibleWhen:"nonempty"},[n("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[n("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||ln}</div>`,`<div class="miso-collapsible__title" data-role="title">${o(t,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${an}</div>`]),n("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(e){const{container:t,phrase:s}=this._helpers,i="follow-up-questions",n=["query-suggestions"];return t(e,{name:i,extraNames:n,visibleWhen:"nonempty"},[s(e,{name:i,extraNames:n,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(e){const{features:t={}}=e;return!1===t.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(e){const{container:t,phrase:s,section:i}=this._helpers,{features:n={},logo:o=!0}=e;return i(e,{name:"related-resources"},!1===n.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:o},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:Do}));function Fo(e={}){const{normalizeOptions:t,section:s,container:i}=Do,{answerGroup:n}=Mo;return s(e=t(e),{name:"follow-up"},[i(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...n(e)])}var zo=Object.freeze({__proto__:null,helpers:Do,sections:Mo,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=Do,{followUps:n,relatedResourcesSection:o,answerGroup:r}=Mo;return""+s(e=t(e),{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},r(e))+n(e)+o(e)},followUp:Fo});const Bo=Object.freeze({...Lo.DEFAULT_API_OPTIONS,name:p.QUESTIONS,payload:{...Lo.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Qo=Object.freeze({...Lo.DEFAULT_LAYOUTS,[Rt.QUERY]:[vn.type,{templates:{buttonIcon:"send"}}],[Rt.REASONING]:zn.type,[Rt.RELATED_RESOURCES]:[Di.type,{incremental:!0,itemType:"article"}],[Rt.QUERY_SUGGESTIONS]:On.type,[Rt.FOLLOW_UP_QUESTIONS]:On.type}),Go=Object.freeze({...Lo.DEFAULT_TRACKERS,[Rt.RELATED_RESOURCES]:es,[Rt.QUERY_SUGGESTIONS]:{...es,click:{...es.click,validate:e=>0===e.button}}}),Wo=Object.freeze({followUp:Fo}),Ho=Object.freeze({...Lo.DEFAULT_OPTIONS,api:Bo,layouts:Qo,trackers:Go,templates:Wo}),Vo=Qt(Lo.ROLES_OPTIONS,{members:Object.keys(Qo),mappings:{[Rt.QUERY_SUGGESTIONS]:function(e,{workflow:t}={}){const s=t.previous,i=s&&s.states.data.value,n=i&&(i.suggested_followup_questions||i.followup_questions||[]);return n&&n.map((e=>({text:e})))},[Rt.FOLLOW_UP_QUESTIONS]:function(e){if(e&&e.value)return(e.value.followup_questions||[]).map((e=>({text:e})))}}});class Ko extends Lo{constructor(e,t){super({name:"ask",context:e,roles:Vo,defaults:Ho,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;E(this,{parentQuestionId:t})}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on(bs(Rt.REASONING),(e=>this._onReasoningViewUpdate(e))),this._views.get(Rt.ANSWER).on("follow-up-click",(e=>this._onFollowUpClick(e))),this._views.get(Rt.FOLLOW_UP_QUESTIONS).on("select",(e=>this._onFollowUpQuestionSelect(e))),this._views.get(Rt.QUERY_SUGGESTIONS).on("select",(e=>this._onQuerySuggestionSelect(e)))]}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){const{next:e}=this;e&&e.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,questionId:s,...i}={}){if(s)return y({...i,question_id:s});const{parentQuestionId:n}=this;let o=y({...i,question:e,parent_question_id:n,_meta:{...i._meta,question_source:t||Ft.ORGANIC}});return o=this._writeWikiLinkTemplateToPayload(o),o}_updateData(e){super._updateData(e),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:e}=this;if(!e)return;const t=e._views.get(Rt.QUERY_SUGGESTIONS);t&&t.refresh()}_onReasoningViewUpdate({status:e,ongoing:t}){if(e!==Mt.READY||t)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let i,n,o,{property:r}=e.context&&e.context.custom_context||{};return t.role!==Rt.FOLLOW_UP_QUESTIONS&&t.role!==Rt.QUERY_SUGGESTIONS||(r="suggested_followup_questions"),t.role===Rt.QUERY_SUGGESTIONS?(n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,o=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,o=this._getQuestionSourceFromViewState(t)),po(e,{context:{custom_context:{property:r,root_question_id:s,parent_question_id:n,question_id:i,question_source:o}}})}_onFollowUpClick({q:e,event:t}={}){0===t.button&&this._submitFollowUpQuestion({q:e,qs:Ft.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:e}){this._submitFollowUpQuestion({q:e,qs:Ft.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:e="",qs:t}={}){if(!(e=e.trim()))return;this.getOrCreateNext().query({q:e,qs:t})}_onQuerySuggestionSelect({value:e}){e&&this.query({q:e,qs:Ft.SUGGESTED_QUESTIONS})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const e=this._views.get(Rt.REASONING),t=e&&e.element;return t&&t.closest('[data-role="reasoning-box"]')}_destroy(e){const{next:t,parentQuestionId:s,questionId:i}=this;t&&t.destroy(e),s&&this._context._byPqid.delete(s),i&&this._context._byQid.delete(i),super._destroy(e)}}const Yo={event:"done"};class Zo extends gs{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Ko(this),this._events.on("*",(e=>this._createNextIfNecessary(e))),this._autoNextFn=void 0}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Ko(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}autoNext(e){this._autoNextFn=function(e=Yo){switch(!0===e&&(e=Yo),"string"==typeof e&&(e={event:e}),typeof e){case"object":return t=>e.event===t._event;case"function":return e;default:return()=>!1}}(e)}_createNextIfNecessary(e){if(!this._autoNextFn||!this._autoNextFn(e))return;const{workflow:t}=e;t&&t.getOrCreateNext()}}ds(Zo.prototype,[Bt.TEMPLATES]);const Jo=Object.freeze({...wo.DEFAULT_API_OPTIONS,group:_.SEARCH,payload:{...wo.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Xo=Object.freeze({...wo.DEFAULT_LAYOUTS,[Rt.QUERY]:[vn.type],[Rt.PRODUCTS]:[Di.type,{incremental:!0,infiniteScroll:!0}],[Rt.KEYWORDS]:[Ln.type,{raw:!0}],[Rt.TOTAL]:[Ln.type,{raw:!0,format:"number"}],[Rt.FACETS]:[eo.type],[Rt.SORT]:[io.type],[Rt.MORE]:[ro.type]}),er=Object.freeze({...wo.DEFAULT_TRACKERS,[Rt.PRODUCTS]:es}),tr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),sr=Object.freeze({...wo.DEFAULT_OPTIONS,api:Jo,layouts:Xo,trackers:er,pagination:tr}),ir=Qt(wo.ROLES_OPTIONS,{main:Rt.PRODUCTS,members:Object.keys(Xo),mappings:{[Rt.FACETS]:"facet_counts",[Rt.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=t.states.filters||{},o=n&&n.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(i).field;return o?i.map((e=>({...e,selected:e.field===o}))):i}}});class nr extends wo{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(Rt.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){fs.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this._views.filters.reset({silent:!0}),this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==Mt.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:i}=t||{};return y({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const i=e[s];i&&i.length&&(t[s]={terms:i})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return g(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},i=s.map((e=>e.product_id)).filter((e=>e)),n=[...e.exclude||[],...i];return 0===n.length?e:{...e,exclude:n}}_defaultProcessData(e,t){return e=function(e,t){if(!t)return e;const{status:s,value:i}=e;switch(s){case Mt.INITIAL:case Mt.LOADING:break;default:return e}return i&&i.facet_counts?e:{...e,value:{...i,facet_counts:t}}}(e=ho(e=super._defaultProcessData(e,t)),this._currentFacetCounts),e=function(e,{role:t=Rt.PRODUCTS}={}){const{status:s,request:i,value:n}=e;if(s!==Mt.READY||!i||!n)return e;const{[t]:o}=n;if(!o)return e;const{rows:r}=i.payload,{length:a}=o;return r>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,value:{...t,root_miso_id:s}}:e}(e);return function(e,t,{role:s=Rt.PRODUCTS}={}){if(!t.value)return e;const{[s]:i=[],facet_counts:n,total:o,root_miso_id:r}=e.value,{[s]:a=[]}=t.value;return{...t,value:{...t.value,facet_counts:n,total:o,root_miso_id:r,[s]:[...i,...a]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeRootMisoIdToInteraction(e)}_writeRootMisoIdToInteraction(e){const t=this._hub.states.data,{root_miso_id:s}=t&&t.value||{};return s?po(e,{context:{custom_context:{root_miso_id:s}}}):e}}ds(nr.prototype,[Bt.PAGINATION,Bt.FILTERS]),Object.assign(nr,{DEFAULT_API_OPTIONS:Jo,DEFAULT_LAYOUTS:Xo,DEFAULT_TRACKERS:er,DEFAULT_PAGINATION:tr,DEFAULT_OPTIONS:sr,ROLES_OPTIONS:ir});const or=Object.freeze({members:[]});function rr({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function ar(e){return e&&e.value&&e.value.trim()||void 0}class cr extends wo{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:rr(t),roles:or,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,ar(e)===ar(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!ar(e))return void this._updateCompletions({session:s,status:Mt.INITIAL});const i=this._buildPayload(e);this._request({payload:i})}_buildPayload(e){return{q:ar(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function lr(e){K(e,ur.prototype)}class ur{_initAutocomplete(e){this._autocomplete=new cr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const hr=Qt(Lo.ROLES_OPTIONS,{mappings:{[Rt.QUESTION]:Rt.KEYWORDS}});class dr extends Lo{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:hr,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset({silent:!0}),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._writeWikiLinkTemplateToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||Ft.ORGANIC}}}_defaultProcessData(e,t){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:i}={}}=t;return i?{...e,meta:{...e.meta,miso_id:i}}:e}(e=ho(e=super._defaultProcessData(e,t))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_updateDataInHub(e){switch(e.status){case Mt.INITIAL:case Mt.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),uo(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}lr(dr.prototype);const _r={...nr.ROLES_OPTIONS,members:[Rt.PRODUCTS,Rt.KEYWORDS,Rt.TOTAL,Rt.FACETS,Rt.SORT,Rt.MORE,Rt.ERROR]};class pr extends nr{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:_r,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:y({...e._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(e,t){return uo(e=super._defaultProcessData(e,t)),e}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}}Object.assign(pr,{ROLES_OPTIONS:_r});class mr{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return pr.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,i=this._getSubviews(s);if(!i._containers.has(e)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(e)){for(const i of e.components)if(s.containsElement(i))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}i.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const fr=Object.freeze({group:_.ASK,name:p.SEARCH,payload:{...Lo.DEFAULT_API_OPTIONS.payload,...nr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),gr=Object.freeze({...Lo.DEFAULT_LAYOUTS,...nr.DEFAULT_LAYOUTS,[Rt.QUERY]:[vn.type,{placeholder:""}],[Rt.QUESTION]:[Ln.type,{raw:!0}],[Rt.SOURCES]:[Fi.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:ti,articleInfoBlock:oi}}]}),br=Object.freeze({...Lo.DEFAULT_TRACKERS,...nr.DEFAULT_TRACKERS}),yr=Object.freeze({...nr.DEFAULT_PAGINATION,active:!0}),wr=Object.freeze({api:{group:_.ASK,name:p.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),vr=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Er=Object.freeze({...Lo.DEFAULT_OPTIONS,...nr.DEFAULT_OPTIONS,api:fr,layouts:gr,trackers:br,autocomplete:wr,pagination:yr,filters:vr}),Sr=Object.freeze({main:Rt.PRODUCTS,members:Object.keys(gr),mappings:Object.freeze({...Lo.ROLES_OPTIONS.mappings,...nr.ROLES_OPTIONS.mappings})});class kr extends wo{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Sr,defaults:Er})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new dr(this),this._results=new pr(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){this._views=new mr(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return e=this._answer._defaultProcessInteraction0(e,t),e=this._results._defaultProcessInteraction0(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}ds(kr.prototype,[Bt.PAGINATION,Bt.FILTERS]);const Or=Object.freeze({group:_.SEARCH,name:p.SEARCH,payload:{fl:["*"]}}),Ir=Object.freeze({api:{group:_.SEARCH,name:p.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),xr=Object.freeze({...nr.DEFAULT_LAYOUTS}),Cr=Object.freeze({...nr.DEFAULT_TRACKERS}),Tr=Object.freeze({...nr.DEFAULT_OPTIONS,api:Or,autocomplete:Ir,layouts:xr,trackers:Cr}),Ar=nr.ROLES_OPTIONS;class Rr extends nr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:Ar,defaults:Tr})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=Rt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}lr(Rr.prototype);class Nr extends gs{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=At){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=At){return this._members.has(e)}get(e=At){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class $r extends wo{_initProperties(e){super._initProperties(e);const{id:t}=e;E(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return po(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign($r,{DEFAULT_API_OPTIONS:wo.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:wo.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:wo.DEFAULT_TRACKERS,DEFAULT_OPTIONS:wo.DEFAULT_OPTIONS,ROLES_OPTIONS:wo.ROLES_OPTIONS});const Lr=Object.freeze({...$r.DEFAULT_API_OPTIONS,group:_.RECOMMENDATION,name:p.USER_TO_PRODUCTS,payload:{...$r.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Ur=Object.freeze({...$r.DEFAULT_LAYOUTS,[Rt.PRODUCTS]:Di.type}),Pr=Object.freeze({...$r.DEFAULT_TRACKERS,[Rt.PRODUCTS]:es}),qr=Object.freeze({...$r.DEFAULT_OPTIONS,api:Lr,layouts:Ur,trackers:Pr}),jr=Qt($r.ROLES_OPTIONS,{main:Rt.PRODUCTS,members:Object.keys(Ur)});class Dr extends $r{constructor(e,t){super({name:"recommendation",context:e,roles:jr,defaults:qr,id:t})}start(){return this._request(),this}notifyViewUpdate(e=Rt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class Mr extends Nr{constructor(e,t){super("recommendations",e,t)}_create(e){return new Dr(this,e)}}const Fr=Object.freeze({...$r.DEFAULT_API_OPTIONS,group:_.ASK,name:p.RELATED_QUESTIONS}),zr=Object.freeze({...$r.DEFAULT_LAYOUTS,[Rt.RELATED_QUESTIONS]:[Di.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Rt.QUERY]:[vn.type,{placeholder:"Ask a question"}]}),Br=Object.freeze({...$r.DEFAULT_TRACKERS,[Rt.RELATED_QUESTIONS]:es,[Rt.CONTAINER]:{...es,itemless:!0},[Rt.QUERY]:{[Ut.SUBMIT]:{active:!0}}}),Qr=Object.freeze({...$r.DEFAULT_OPTIONS,api:Fr,layouts:zr,trackers:Br}),Gr=Qt($r.ROLES_OPTIONS,{main:Rt.RELATED_QUESTIONS,members:Object.keys(zr)});class Wr extends $r{constructor(e,t){super({name:"explore",context:e,roles:Gr,defaults:Qr,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(Rt.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return xo.prototype.useLink.call(this,e,t),t&&this.useLayouts({[Rt.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=Rt.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e,t){return e=super._defaultProcessData(e,t),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=xo.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}Io(Wr.prototype);class Hr extends Nr{constructor(e,t){super("explores",e,t)}_create(e){return new Wr(this,e)}}class Vr extends ae{constructor({name:e,plugin:t,MisoClient:s,...i}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new D)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}const Kr=Object.freeze(Uo),Yr=Object.freeze(Po),Zr=Object.freeze(zo);var Jr=Object.freeze({__proto__:null,constants:Kr,phrases:Yr,templates:Zr,wireFollowUps:function(e,t,s){if(!e)throw Error("client is required");!function(e,{template:t=Fo,...s}={}){if("function"!=typeof t)throw Error("template must be a function or undefined");const i=Object.keys(s).length>0;if(t===Fo&&!i)return;e.ui.asks.useTemplates({followUp:i?e=>t({...s,...e}):t})}(e,s),function(e){if(!e||"miso-follow-ups"===e.tagName.toLowerCase())return;const t=document.createElement("miso-follow-ups");for(const{name:s,value:i}of e.attributes)t.setAttribute(s,i);e.parentNode.replaceChild(t,e)}(t)},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:Xr}=document,ea=Object.freeze({templates:Zr,autostart:!0}),ta=["templates","phrases","features"];class sa{constructor(){this._defaults=ea,this._scriptSrc=function(){if(!Xr||!Xr.src)return{};const e=document.createElement("a");e.href=Xr.src;const t={};for(const[s,i]of new URLSearchParams(e.search))"q"!==s&&(t[s]=oa(i));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=oa(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:i,...n}={}){return y({apiKey:e,apiHost:t,templates:ra(s),phrases:i,...n})}(ia(this._defaults,this._scriptSrc,e,this._pageUrl))}}function ia(...e){let t={};for(const s of e)s&&(t=na(t,s));return t}function na(e,t){if(!t)return e;Object.assign(e,t);for(const s of ta)s in t&&(e[s]={...e[s],...t[s]});return e}function oa(e){return""===e||"false"!==e&&e}function ra(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(ra):function(e,t){const s={};for(const[i,n]of Object.entries(e))s[i]=t(n);return s}(e,ra);default:throw Error("Unsupported template type: "+e)}}class aa{constructor(e,{classPrefix:t=Kr.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");E(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class ca extends Vr{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new sa,this._localOptions={}}config(e={}){e=ia(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;E(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new aa(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:o}=e.ui.defaults.ask,{templates:r={},features:a={},api:c}=i,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(t,s.followUpsSection,{...i,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&o(t,s.relatedResourcesSection),l.autoQuery()}}class la extends ce{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}const ua="trait",ha=Object.freeze([ua]);class da extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return ha}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const e of this._traits)this._destroyTrait(e);this._traits=[]}attributeChangedCallback(e){if(e===ua)this._syncTraits()}_syncTraits(){const e=(this.getAttribute(ua)||"").split(/\s+/).filter(Boolean),t=[];for(const s of this._traits)e.includes(s.constructor.traitName)?t.push(s):this._destroyTrait(s);if(e.length>0){const s=function(e){const t=e.ui&&e.ui.traits||{};return Object.values(t).reduce(((e,t)=>(e[t.traitName]=t,e)),{})}(da.MisoClient);for(const i of e){if(this._traits.find((e=>e.constructor.traitName===i)))continue;const e=s[i];if(!e){console.warn("Unknown trait: "+i);continue}const n=new e(this);t.push(n)}}this._traits=t}_destroyTrait(e){try{e._destroy&&e._destroy()}catch(e){console.error(e)}}}let _a,pa,ma;async function fa(e){const t=await async function(e){return e.MisoClient||window.MisoClient||_a||(_a=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return pa=pa||t.any(),ma=ma||await pa,ma.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),ma}const ga="logo",ba="auto",ya=Object.freeze([...da.observedAttributes,ga]);function wa(e){if(!e)return ba;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class va extends da{static get observedAttributes(){return ya}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return wa(this.getAttribute(ga))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case ba:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(ga,t):this.removeAttribute(ga)}async connectedCallback(){super.connectedCallback();const e=this._client=await fa(va);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===ga)this._handleLogoUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleLogoUpdate(e,t){wa(e)!==wa(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const Ea="parent-question-id",Sa=Object.freeze([...va.observedAttributes,Ea]);const ka="unit-id",Oa=Object.freeze([...va.observedAttributes,ka]);class Ia extends va{static get observedAttributes(){return Oa}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute(ka)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(ka,e):this.removeAttribute(ka)}attributeChangedCallback(e,t,s){if(e===ka)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var xa=Object.freeze({__proto__:null,MisoAskElement:class extends va{static get tagName(){return"miso-ask"}static get observedAttributes(){return Sa}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Ea)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(Ea,e):this.removeAttribute(Ea))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===Ea)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Ia{static get tagName(){return"miso-explore"}static get observedAttributes(){return Ia.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends va{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return va.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends va{static get tagName(){return"miso-search"}static get observedAttributes(){return va.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Ia{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Ia.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const Ca="role",Ta=Object.freeze([Ca]);class Aa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Ta}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(Ca);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ca}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${Ca}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===Ca&&this._container&&this._container._updateComponentRole(this,t,s)}}var Ra=Object.freeze({__proto__:null,MisoComponentElement:Aa,MisoQueryElement:class extends Aa{constructor(){super({role:Rt.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends Aa{constructor(){super({role:Rt.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends Aa{constructor(){super({role:Rt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Aa{constructor(){super({role:Rt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Aa{constructor(){super({role:Rt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Aa{constructor(){super({role:Rt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Aa{constructor(){super({role:Rt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Aa{constructor(){super({role:Rt.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends Aa{constructor(){super({role:Rt.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends Aa{constructor(){super({role:Rt.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Aa{constructor(){super({role:Rt.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Aa{constructor(){super({role:Rt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Aa{constructor(){super({role:Rt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends Aa{constructor(){super({role:Rt.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Aa{constructor(){super({role:Rt.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Aa{constructor(){super({role:Rt.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Aa{constructor(){super({role:Rt.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Aa{constructor(){super({role:Rt.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Aa{constructor(){super({role:Rt.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Aa{constructor(){super({role:Rt.ERROR})}static get tagName(){return"miso-error"}}});class Na extends da{static get observedAttributes(){return da.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(e){this._setContext(e)}async connectedCallback(){super.connectedCallback();const e=this._client=await fa(Na);document.body.contains(this)&&this._setContext(this._getContext(e))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(e){throw Error("Unimplemented")}_setContext(e){if(this._context===e)return;const t=this._context;this._context=e,this._onContext(e,t)}_onContext(){}}var $a=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends Na{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return Na.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(e){return e.ui.asks}_onContext(e,t){e!==t&&(this._unwire(),this._wire(e))}_unwire(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}_wire(e){e&&(e._autoNextFn||e.autoNext(),this._unsubscribes.push(e.on("create",(e=>{const{parentQuestionId:t}=e,s=e._options.resolved.templates.followUp;if(!t||!s)return;const i=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:t}));const n=this.children.length;for(const t of Array.prototype.slice.call(this.children,i,n))this._elementToWorkflow.set(t,e)}))),this._unsubscribes.push(e.on("loading",(({workflow:e})=>{for(const t of this.children)if(this._elementToWorkflow.get(t)===e){t.scrollIntoView({behavior:"smooth",block:"start"});break}}))),this._unsubscribes.push(e.on("destroy",(({workflow:e})=>{for(const t of this.children)this._elementToWorkflow.get(t)===e&&(this._elementToWorkflow.delete(t),t.remove())}))))}}});class La extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(La.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Ua=Object.freeze({__proto__:null,containers:xa,roles:Ra,contexts:$a,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends La{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Oi,MisoStubElement:da});const Pa="miso-hybrid-search-combo";var qa=Object.freeze({__proto__:null,CLASS_PREFIX:Pa,CONAINER_TAG:"miso-hybrid-search"});const ja="Show more",Da="Show less";var Ma=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:ja,showLess:Da});const Fa=Y(new jo({...qa,DEFAULT_PHRASES:Ma})),za=Y(new class extends qo{constructor(){super({helpers:Fa})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Fa}));var Ba=Object.freeze({__proto__:null,helpers:Fa,sections:za,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=Fa;e=t(e);const{answerBox:n,answerGroup:o,searchResultsGroup:r}=za,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[n(e)]:o(e))+s(e,{name:"search-results"},r(e))}});const Qa="answer-box-open",Ga="answer-box-shown",Wa='[data-role="answer-box-toggle"]';class Ha{constructor(e,t,{classPrefix:s=Pa,phrases:i={},hideWhenUnanswerable:n=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=n,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Wa)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case Mt.ERRONEOUS:case Mt.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||Da:this._phrases.showMore||ja;for(const t of this._element.querySelectorAll(Wa))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const Va={isOpen:Qa,shown:Ga},Ka={toggleOpen:["toggle",Qa],open:["add",Qa],close:["remove",Qa],toggleHidden:["toggle",Ga],show:["add",Ga],hide:["remove",Ga]};for(const[e,t]of Object.entries(Va))Object.defineProperty(Ha.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(Ka))Ha.prototype[e]=function(){this._updateBoxStatus(t,s),s===Qa&&(this._syncButtonText(),this._syncScroll())};const Ya=Object.freeze(qa),Za=Object.freeze(Ma),Ja=Object.freeze(Ba);var Xa=Object.freeze({__proto__:null,constants:Ya,phrases:Za,templates:Ja,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new Ha(e,t,s)}});const ec=Object.freeze(Jr),tc=Object.freeze(Xa);var sc=Object.freeze({__proto__:null,ask:ec,hybridSearch:tc});function ic(e){const t=e._element;if(!t)return()=>{};const s=t=>e._handleClick(t);return t.addEventListener("click",s),()=>t.removeEventListener("click",s)}const nc="miso-collapsible",oc="expanded",rc=[{action:"expand",classAction:"add",className:oc},{action:"collapse",classAction:"remove",className:oc}];class ac{static get traitName(){return"collapsible"}constructor(e){this._element=e,e.collapsible=this,e.classList.add(nc),this._unsubscribes=[ic(this)]}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(nc),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(e,t){for(const s of t)Object.defineProperty(e,s,{get(){return this._element&&this._element.classList.contains(s)}})}(ac.prototype,[oc]),function(e,t){for(const{action:s,classAction:i,className:n}of t)e[s]=function(){this._element&&this._element.classList[i](n),this["_"+s]&&this["_"+s]()}}(ac.prototype,rc),function(e,t){e._handleClick=function(e){const{target:s,button:i}=e;if(0===i)for(let{role:i,selector:n,action:o}of t)if(n=n||`[data-role="${i}"]`,n&&s.closest(n))return this[o](),void e.stopPropagation()}}(ac.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var cc=Object.freeze({__proto__:null,CollapsibleTrait:ac});const lc="ui";let uc,hc;async function dc(){return hc||(hc=B(uc||(uc=Q(lc))))}class _c{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class pc{constructor(e,t){this._plugin=e,this._client=t,E(this,{sources:{api:Js(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Rr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new kr(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class mc{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new ca(this._plugin,this._MisoClient))}}rt.plugins.use(class extends ae{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new la(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new D}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:sc,traits:cc};v(s,this,["layouts","combo","ready"]),E(this,{MisoClient:e}),E(e,{ui:s}),this.combo=new mc(this,e);const i=Object.values(ao).filter((e=>e.type));for(const t of i)t.MisoClient=e;for(const e of i)this.layouts.register(e);const{containers:n,roles:o,combos:r,contexts:a,...c}=Ua,l=[...Object.values(r),...Object.values(a),...Object.values(n),...Object.values(o),...Object.values(c)],u=[va,Na,La];for(const t of[...u,...l])t.MisoClient=e;await dc();for(const e of l)A(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){E(e,{ui:new pc(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new _c(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Mr(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new Hr(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new Zo(this,e)),t}});const fc=5e3;let gc,bc,yc=!1;async function wc(e){return new Promise((t=>setTimeout((()=>{const e=L();Oc("Fallback",e),t(e)}),e)))}async function vc(){const e=await we((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&Oc("GA4",e),e}async function Ec(){const e=(await(gc||(gc=async function(){return we((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&Oc("UA",e),e}const Sc="%cMiso",kc="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Oc(e,t){!function(...e){(a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(Sc,kc,...e)}(...e)}(`[${e}] Client ID: ${t}${yc?" (unused)":""}`),yc=!0}async function Ic(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(rt,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||t.debug;i&&rt.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&rt.plugins.use("std:dry-run");return window.MisoClientSA=rt,rt}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const i=window.misoSA=new t(s);return i.context.anonymous_id=await async function(){return bc||(bc=Promise.any([vc(),Ec(),wc(fc)]))}(),i}(e,{MisoClient:t});return await s.ui.ready,[t,s]}function xc(e){return t=>({...t,context:{...t.context,custom_context:{...Cc(e),...t.context&&t.context.custom_context}}})}function Cc({site:e,page:t,config:s,version:i}){return y({source:"miso-client-script",script_version:i,attribution:"miso-smart-answers",site:e.key,user_geo:s.geo,page_type:t.type,post_id:t.postId,uuid:L()})}let Tc;async function Ac(){return Tc||(Tc=async function(){const[[e,t]]=await Promise.all([Ic(Ie),_e(Ie)]);return{MisoClient:e,client:t}}())}const Rc='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',Nc='<svg viewBox="0 0 15 14" fill="currentColor">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.92319V5.46173C0.000125254 5.46173 0.000250509 5.46173 0.000375766 5.46173C2.12455 5.46173 3.84653 7.18371 3.84653 9.30789C3.84653 9.3079 3.84653 9.30791 3.84653 9.30792H5.38499C5.38499 9.30791 5.38499 9.3079 5.38499 9.30789C5.38499 7.18384 7.10677 5.46194 9.23077 5.46173V3.92327C7.10678 3.92307 5.38501 2.20118 5.38499 0.0771484H3.8466C3.84655 2.20127 2.12459 3.92319 0.000450868 3.92319C0.000300577 3.92319 0.000150287 3.92319 0 3.92319Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M8 9.83844V11.005C9.61039 11.0056 10.9157 12.3112 10.9157 13.9217C10.9157 13.9222 10.9157 13.9226 10.9157 13.923H12.0822C12.0822 13.9226 12.0822 13.9222 12.0822 13.9217C12.0822 12.3109 13.388 11.005 14.9989 11.005C14.9993 11.005 14.9997 11.005 15.0002 11.005V9.83854C14.9997 9.83854 14.9993 9.83854 14.9989 9.83854C13.3884 9.83854 12.0827 8.53324 12.0822 6.92285H10.9156C10.915 8.53281 9.60996 9.83783 8 9.83844Z"/>\n</svg>',$c='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Lc='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>',Uc={question:"Generated by ${site} Smart Answers AI"};function Pc(e){const{site:t}=e;return`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  ${qc()}\n</section>\n${function(e){const t='\n<div class="miso-hybrid-search-combo__skeleton-source-item" style="flex-shrink:0;padding-bottom:3.2rem;">\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:23px;width:23px;"></div>\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:72px;width:100%;border-radius:6px;"></div>\n  <div style="display:flex;gap:0.8rem;align-items:center;">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:10%;border-radius:6px;"></div>\n    <div style="color:#B6AEAA;font-size:1.28rem;margin-bottom:10px;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:30%;border-radius:6px;"></div>\n  </div>\n</div>\n';return`\n<section class="miso-hybrid-search-combo__skeleton miso-hidden">\n  <div class="miso-hybrid-search-combo__question-phrase">\n    <div class="miso-hybrid-search-combo__question-phrase-main">\n      <i>${Nc}</i>\n      <span>${jc(e)}</span>\n    </div>\n    <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">Learn more</a>\n  </div>\n  <div class="miso-hybrid-search-combo__skeleton-answer-block">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:92%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:70%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:95%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:65%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:90%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:100%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:60%;"></div>\n  </div>\n  <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">This answer is based on the following articles</h3>\n  <div class="miso-hybrid-search-combo__skeleton-source-block" style="overflow-y:hidden;">\n    ${t}\n    ${t}\n    ${t}\n  </div>\n</section>\n`}(e)}\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n  <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <div class="miso-hybrid-search-combo__question-phrase">\n      <div class="miso-hybrid-search-combo__question-phrase-main">\n        <i>${Nc}</i>\n        <span>${jc(e)}</span>\n      </div>\n      <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">Learn more</a>\n    </div>\n    <miso-answer></miso-answer>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__sources-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">This answer is based on the following articles</h3>\n    <miso-sources></miso-sources>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__buttons-container miso-hidden" visible-when="!unanswerable">\n    <a class="miso-hybrid-search-combo__smart-answers-link" href="${t.base_url||""}/smart-answers" target="_blank" rel="noopener nofollow">\n      <i>${Rc}</i>\n      <span>Learn more with smart answers</span>\n    </a>\n    <miso-feedback></miso-feedback>\n  </ miso-hybrid-search>\n  \x3c!-- whitepaper --\x3e\n  \x3c!--\n  <miso-hybrid-search class="miso-hybrid-search-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <miso-affiliation></miso-affiliation>\n  </miso-hybrid-search>\n  --\x3e\n</section>\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__search-results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__search-results-container miso-circled-citation-index" visible-when="loading ready" logo="false">\n    <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__keywords-phrase">You searched for <miso-keywords></miso-keywords></div>\n    <div class="miso-hybrid-search-combo__search-results-info">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase">About <miso-total></miso-total> results</div>\n      <div class="miso-hybrid-search-combo__sort-dropdown">\n        Sort By <miso-sort>\n      </div>\n    </div>\n    <miso-products></miso-products>\n    <miso-more></miso-more>\n  </miso-hybrid-search>\n</section>\n${function(e){const{site:t}=e;let s;switch(t.key){case"computerworld":s="CW";break;case"networkworld":s="NWW";break;case"infoworld":s="IFW";break;default:s=t.name}return"cio"===t.key?'\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About</div>\n      <div class="miso-disclaimer__content">\n        <p>You deserve a better search experience -- and Smart Answers delivers.</p>\n        <p>Quickly find answers, discover the most relevant and timely content, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with <a href="https://miso.ai/" target="_blank" rel="noopener">Miso.ai</a>, Smart Answers draws only on editorial content from CIO.com and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  ':`\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About ${s} Smart Answers AI</div>\n      <div class="miso-disclaimer__content">\n        <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with Miso.ai, Smart Answers draws only on editorial content from our network of trusted media brands<a href="https://www.cio.com/" target="_blank" rel="noopener">CIO</a>,<a href="https://www.computerworld.com/" target="_blank" rel="noopener">Computerworld</a>, <a href="https://www.csoonline.com/" target="_blank" rel="noopener">CSO</a>, <a href="https://www.infoworld.com/" target="_blank" rel="noopener">InfoWorld</a>, and<a href="https://www.networkworld.com/" target="_blank" rel="noopener">Network World</a>and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  `}(e)}`.trim()}function qc(e){return`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${$c}</span>\n        <textarea rows="1" class="miso-search-box__input" type="text" placeholder="What are you searching for?" autocomplete="off" data-role="input"></textarea>\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Lc}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}function jc(e){const{site:t}=e;return Uc.question.replaceAll("${site}",t.name)}const Dc=Object.freeze({ordered:!0,article:function(e,t,s,i){const{templates:n}=e,[o,r]=n.helpers.tagPair(e,s);return""+o+n.indexBlock(e,s,i)+Mc(e,s)+r},infoBlock:Mc});function Mc({className:e},{title:t,created_at:s,updated_at:i,published_at:n,custom_attributes:o={}}){const r=ye(o.site),a=n||s||i;let c="";t&&(c+=`<div class="${e}__item-title">${t}</div>`);const l=[];return r&&l.push(`<div class="${e}__item-site">${r.name}</div>`),a&&l.push(`<div class="${e}__item-date">${zc(a)}</div>`),l.length>0&&(c+=`<div class="${e}__item-supplementals">${l.join("&nbsp;&nbsp;&nbsp;&nbsp;")}</div>`),`<div class="${e}__item-info-container">${c}</div>`}const Fc=Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,description:i,authors:n,created_at:o,updated_at:r,published_at:a,custom_attributes:c={}}){ye(c.site);const l=a||o||r;let u=`<div class="${e}__item-main-block">`;c.content_type&&(u+=`<div class="${e}__item-content-type">${c.content_type}</div>`);t&&(u+=`<div class="${e}__item-title">${t}</div>`);s?u+=`<div class="${e}__item-snippet">${s}</div>`:i&&(u+=`<div class="${e}__item-desc">${i}</div>`);u+=`</div><div class="${e}__item-supplementals-block">`,n&&(u+=`<div class="${e}__item-authors">By ${n}</div>`);l&&(u+=`<div class="${e}__item-date">${zc(l)}</div>`);return u+="</div>",`<div class="${e}__item-info-container">${u}</div>`}});function zc(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}const Bc="textarea.miso-search-box__input";function Qc(){const e=!this.value;e&&(this.value="What are you searching for?"),this.style.height="auto",this.style.height=this.scrollHeight-24+"px",e&&(this.value="")}function Gc(){const e=document.querySelector(Bc);e&&(e.addEventListener("keyup",Qc),Qc.call(e))}function Wc(e){return`${r} AND custom_attributes.site:${e.site.key}`}function Hc(e,{MisoClient:t,client:s,rootElement:i}){const{site:n,config:r}=e,a=s.ui.hybridSearch;a.autocomplete.enable(),a.useApi({_meta:y({site:n.key,user_geo:r.geo}),facets:["categories"],fq:Wc(e),fl:o,source_fl:o}),a.useDataProcessor(function(e){const t=function({site:e}){return({url:t,...s})=>((t=new URL(t)).host=""+e.whitepaper_hostname,{url:Xc(t=""+t),...s})}(e);return({value:e,...s})=>{if(!e)return s;const{answer:i,sources:n=[],affiliation_products:o,products:r=[]}=e;return{value:{...e,answer:Yc(i,n),sources:n.map(Zc),affiliation_products:(o||[]).map(t),products:r.map(Jc)},...s}}}(e)),a.useInteractions({preprocess:xc(e)}),a.useFilters({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),a.useLayouts({sources:["list",{templates:Dc}],products:{templates:Fc,infiniteScroll:!1},more:{templates:{text:()=>"Show more"}}}),a.answer.on("request",(e=>{const t=new URL(window.location.href);t.searchParams.set("q",e.payload.q),window.history.replaceState({},"",t);const s=document.querySelector(".miso-hybrid-search-combo__smart-answers-link");s&&(s.href=`${n.base_url||""}/smart-answers?q=${encodeURIComponent(e.payload.q)}`);document.querySelectorAll(".miso-hidden").forEach((e=>{e.classList.remove("miso-hidden")}));const i=document.querySelector("#miso-search.miso-hybrid-search-combo");i&&i.classList.add("miso-hybrid-search-combo__container--fired"),function(){const e=el();e&&e.classList.add("miso-hybrid-search-combo__skeleton--show");tl().forEach((e=>{e&&e.setAttribute("visible-when","done !unanswerable")}))}()})),a.answer.on("answer-stage",(e=>{"Generating summary"!==e.answer_stage&&"I cannot answer the question due to my system settings."!==e.data||function(){const e=el();e&&e.classList.remove("miso-hybrid-search-combo__skeleton--show");tl().forEach((e=>{e&&e.setAttribute("visible-when","ready !unanswerable")}))}()}));const c=document.createElement("div");c.id="miso-search",c.classList.add("miso-hybrid-search-combo"),i.insertAdjacentElement("afterend",c),i.remove(),(i=c).innerHTML=Pc(e);const{wireAnswerBox:l}=t.ui.defaults.hybridSearch;l(s,i,{hideWhenUnanswerable:!1}),a.autoQuery(),setTimeout((()=>Gc()),200)}function Vc(e,t){if(!e)return e;if(!t)return Xc(e);const{origin:s}=new URL(e),{pathname:i}=new URL(t);return Xc(`${s}${i}`)}const Kc=/\[\[(\d+)\]\]\((https?:\/\/[^\s)]+)\)/g;function Yc(e,t){return e?e.replace(Kc,((e,s,i)=>{const n=t.find((e=>e.url===i))||{custom_attributes:{}};return`[[${s}]](${Vc(i,n.custom_attributes.contenthub_url)})`})):e}function Zc({url:e,cover_image:t,custom_attributes:s,...i}){const{site:n,contenthub_url:o}=s;return{cover_image:t||ye(n).logo_image,url:Vc(e,o),custom_attributes:s,...i}}function Jc({authors:e,url:t,custom_attributes:s,...i}){const{byline:n,contenthub_url:o}=s;return{authors:n?n.split(","):e,url:Vc(t,o),custom_attributes:s,...i}}function Xc(e){return`${e}${0>e.indexOf("?")?"?":"&"}utm=hybrid_search`}function el(){return document.querySelector(".miso-hybrid-search-combo__skeleton")}function tl(){return[document.querySelector(".miso-hybrid-search-combo__answer-container"),document.querySelector(".miso-hybrid-search-combo__sources-container")]}const sl="header #miso-search",il='.header__icon-button[data-menu-trigger="search"]',nl='.header__menu-link[data-menu-trigger="search"]';async function ol(e){const{site:t}=e,i=document.querySelector(sl);if(!i)return;const n=[document.querySelector(il),document.querySelector(nl)];if(e.page.type===s)return void n.forEach((e=>{e&&e.addEventListener("click",(()=>{const e=document.querySelector('.button[data-menu-close="search"]');e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()}))}));const{client:o}=await Ac(),r=o.ui.hybridSearch;r.useLink((e=>{const{searchParams:s}=new URL(window.location.href);return s.set("q",e),`${t.base_url||""}/search/?${s}`}),{open:!1}),r.autocomplete.enable(),i.classList.add("miso-hybrid-search-input"),i.innerHTML=qc(),Gc()}const rl="#miso-search";async function al(e){const t=function(){for(const e of document.querySelectorAll(rl))if(!e.closest("header"))return e}();if(!t)return;const{MisoClient:s,client:i}=await Ac();Hc(e,{MisoClient:s,client:i,rootElement:t})}(async e=>{e.page.type===s&&function(e){const{version:t,debug:s}=e;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=t,s("Miso Smart Answers script version: "+t),!0)}(e)&&await Promise.all([al(e),ol(e)])})(Ie)}();
