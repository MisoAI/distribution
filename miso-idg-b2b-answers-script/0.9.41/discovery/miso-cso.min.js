!function(){"use strict";const e="home",t="answers",s="search",n="article",i="other";var r="0.9.41";var o=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||"true"===n||"false"!==n&&n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const a={key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en",date_locale:"en-US"},c=window.location.hostname!==a.hostname;var l={...a,dev:c};function u(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const h=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),_=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var d=Object.freeze({__proto__:null,GROUP:h,NAME:_});function p(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function m(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function f(e){return null!=e?""+e:e}function g(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function y(e){return null==e}function b(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function w(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function v(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function E(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function S(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class k{constructor(e,{duration:t=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);I(s),I(n),I(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==n?n:t})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>O(this,e)),t):O(this,e),this._value=e}disconnect(){this._active=!1}}function O(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function I(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function x(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function A(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function T(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async n=>{try{await e(n),t()}catch(e){s(e)}}))}))}async function C(e,{area:t=.5,duration:s=1e3,signal:n}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((i,r)=>{const o=new k((e=>{e&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((e=>{o.value=e[0].isIntersecting}),{threshold:t});a.observe(e),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function R(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function N(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function $(e,t){const s=P((()=>window.localStorage.getItem(e))),n=P((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,n=t.indexOf(s);if(0>n)return;const i=n+s.length,r=t.indexOf(";",i);return decodeURIComponent(0>r?t.substring(i):t.substring(i,r))}(e))),i=s||n||""+t();return i&&!s&&P((()=>window.localStorage.setItem(e,i))),i&&!n&&P((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,i))),i}function P(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function L(e){return new U(e)}class U{constructor(e){this._value=e;const t=e=>{this._value=e};w(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class q{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class j{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new q),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var D="1.12.0";let M;try{M=document.currentScript}catch(e){}async function z(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let n;e.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{e.sheet&&(n&&clearInterval(n),t())}),100)}))}(e),await async function(e){if(B(e))return;return new Promise((t=>{let s;s=setInterval((()=>{B(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function F(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${D}/dist/css/${e}.css`}function B(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function Q(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function G(e,{depth:t=5,...s}={}){return H(e,t)}function H(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>H(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const n={};if(0>=t)return n;for(const s in e){const i=e[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=H(i,t-1)))}return n}(e,t):e:"(...)"}function W(e,t){const s=Object.getOwnPropertyDescriptors(t),n=Object.getOwnPropertyDescriptors(e);for(const[t,i]of Object.entries(s))"constructor"!==t&&void 0===n[t]&&Object.defineProperty(e,t,i)}function V(e){const t={},s=new Set;for(let n=e;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(t[n]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}const K=100,Y=4;function Z(e){const t=function({speed:e=K,acceleration:t=Y}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,n)=>{let i=e*(Math.random()+.5);return t>0&&void 0!==n&&s>n&&(i*=1+(s-n)*t/1e3),i}}(e);return(e,s,n,i)=>{const r=t(n,s);return e+Math.max(i-n,0)*r/1e3}}const J=Symbol.for("miso:resources");class X{constructor(){this._resources=new Map;const e=window[J]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){ee(this._resources,e).resolve(t)}async get(e){return ee(this._resources,e).promise}}function ee(e,t){if(e.has(t))return e.get(t);const s=new q;return e.set(t,s),s}function te(){return window[J]||(window[J]=new X)}class se{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new q;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class ne{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},n=this._namedCallbacks[e];if(n)for(const e of n)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,n)=>{const i=t._on(e,(e=>{setTimeout((()=>i()));try{s(e)}catch(e){n(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:n})=>{try{e(s,n)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)p(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&p(s,t)}}_injectSubscribeInterface(e){b(e,this,["on","once"])}}function ie(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class re{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:ie(e,t),uuid:N()})}(e,t);w(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new ne({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(re,"miso:component");class oe extends re{constructor(e,t,{libName:s,keyName:n}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=e=>e[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new q);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class ae{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new k(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class ce{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:le}=document,ue=le.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function he({}){await Promise.all([de()])}let _e=!1;async function de(){if(_e)return;if(_e=!0,!le)throw Error("currentScript not found");const e=le.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}function pe(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${ue}/${e}`}const me=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en",date_locale:"en-US"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en",date_locale:"en-US"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en",date_locale:"en-US"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en",date_locale:"en-US"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en",date_locale:"en-US"},{key:"computerwoche",name:"Computerwoche",hostname:"www.computerwoche.de",whitepaper_hostname:"us.resources.computerworld.com",regions:[],lang:"de",date_locale:"de-DE"},{key:"cio_de",name:"CIO",hostname:"www.cio.de",whitepaper_hostname:"us.resources.cio.com",regions:[],logo_image:"image/cio.png",lang:"de",date_locale:"de-DE"}].map((({logo_image:e,...t})=>({logo_image:pe(e),...t}))),fe=me.reduce(((e,t)=>(e[t.key]=t,e)),{});function ge(e){return fe[e]}async function ye(e,{interval:t=300,timeout:s}={}){const n=e();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const t=e();null!=t&&(a(),n(t))}),t),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}var be=Object.freeze(function(){const r=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(r){case"":return{type:e};case"/smart-answers":return{type:t};case"/search":return{type:s};default:if(l.regions.indexOf(r.substring(1))>=0)return{type:e}}const a=r.substring(1).split("/");if("article"===a[0]){const e=""+a[1];return{type:n,postId:e,product_id:`article_${l.key}_${e}`}}return{type:i}}());const we="%cMiso",ve="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Ee=[];var Se=function(){if(o.sponsor)return Ee.find((e=>e.key===o.sponsor))||void 0}(),ke=Object.freeze({__proto__:null,config:o,version:r,site:l,page:be,sponsor:Se,debug:function(...e){(o.debug||r.indexOf("beta")>=0||"dev"===r)&&function(...e){console.log(we,ve,...e)}(...e)}});const Oe='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',Ie='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',xe="miso-smart-answers";function Ae({sponsor:e}){return e?`\n<div class="${xe}__sponsor">\n  <div class="${xe}__sponsor-text">Sponsored by ${e.name}</div>\n  <div class="${xe}__sponsor-logo">\n    <img src="${pe(e.image)}" alt="${e.name}">\n  </div>\n</div>`.trim():""}const Te={en:{youAsked:"You asked...",thisAnswerIsBasedOnTheFollowingArticles:"This answer is based on the following articles",learnMoreInDepth:"Learn more: in-depth",relatedQuestions:"Related questions",helpful:"Helpful",notHelpful:"Not helpful",smartAnswersDescription:"Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.",learnMore:"Learn more",exploreRelatedQuestions:"Explore related questions",askAQuestion:"Ask a question",ask:"Ask"},de:{youAsked:"Sie fragten...",thisAnswerIsBasedOnTheFollowingArticles:"Diese Antwort basiert auf den folgenden Artikeln",learnMoreInDepth:"Erfahren Sie mehr",relatedQuestions:"Verwandte Fragen",helpful:"Hilfreich",notHelpful:"Nicht hilfreich",smartAnswersDescription:"Smart Answers ist ein Chatbot-Tool, das Ihnen dabei hilft, Inhalte auf unseren Webseiten zu entdecken, Fragen zu beantworten und sich eingehend mit den Themen zu befassen, die fÃ¼r Sie wichtig sind.",learnMore:"Mehr erfahren",exploreRelatedQuestions:"Verwandte Themen erkunden",askAQuestion:"Eine Frage stellen",ask:"FRAGEN"}},Ce=e=>Te[e.lang]||Te.en,Re="miso-smart-answers-discovery";function Ne(e,t={}){return Pe("article",function(e){const t=Ce(e.site);return`\n<miso-explore visibleWhen="ready nonempty" class="${Re}__container">\n  ${function({site:e}){const t=Ce(e);return`\n<div class="${Re}__hero">\n  <h2 class="${Re}__hero-title">${e.name} Smart Answers</h2>\n  <a class="${Re}__hero-info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">${t.learnMore}</a>\n</div>`.trim()}(e)}\n  ${Ae(e)}\n  <div class="${Re}__header">\n    <a class="${Re}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow" title="What is this?">\n      <i>${Ie}</i>\n    </a>\n    <h4 class="${Re}__title">${t.exploreRelatedQuestions}</h4>\n  </div>\n  <div class="${Re}__body">\n    <miso-related-questions></miso-related-questions>\n    <miso-query>${function(e){const t=Ce(e.site);return`\n<div class="miso-search-box" data-role="query">\n  <div class="miso-search-box__input-group">\n    <input class="miso-search-box__input" type="text" data-role="input" placeholder="${t.askAQuestion}">\n    <button class="miso-search-box__button" type="submit" data-role="button"><div class="miso-search-box__button-inner"><i>${Oe}</i><span class="miso-search-box__button-text">${t.ask}</span></div></button>\n  </div>\n</div>`.trim()}(e)}</miso-query>\n  </div>\n</miso-explore>`.trim()}(e))}function $e(e,t={}){const s=Pe("home",function(e){const{site:t}=e,s=Ce(t);return`\n<miso-explore visibleWhen="ready" class="${Re}__inner">\n  <h3 class="${Re}__title">${t.name} Smart Answers</h3>\n  ${Ae(e)}\n  <p>${s.smartAnswersDescription} <a class="${Re}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">${s.learnMore}</a></p>\n  <miso-query class="${Re}__search-form">\n    <input class="${Re}__search-form-input" type="text" data-role="input" placeholder="${s.askAQuestion}">\n    <button class="${Re}__search-form-submit" type="submit" data-role="button">\n      <i>${Oe}</i>\n      <span class="${Re}__search-form-submit-text">${s.ask}</span>\n    </button>\n  </miso-query>\n</miso-explore>`.trim()}(e),{classes:["container"]}),n=document.createElement("section");return n.classList.add(Re+"__section"),n.appendChild(s),n}function Pe(e,t,{classes:s=[]}={}){const n=document.createElement("div");n.classList.add(Re),n.classList.add(`${Re}__${e}`);for(const e of s)n.classList.add(e);return n.innerHTML=t,n}var Le="1.12.0";const Ue=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class qe{constructor(e,t){this._client=e,this._root=t,this._bulk=new se(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,l=i?AbortSignal.timeout(i):void 0,u=await(this._root._customFetch||window.fetch)(e,g({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:l})),h=await u.json();if(u.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=u.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:n}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:i,status_code:r,body:o}=n[t];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:n={}}=this._client.options,i=t.sendApiKeyByHeader||n.sendApiKeyByHeader,r=e.filter((e=>e)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=Ue.DATA_ENDPOINT,eventEndpoint:s=Ue.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:t,apiName:s,url:n})||n}catch(t){(e._error||console.error)(t)}return n}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:t,apiName:s,payload:n})||n}catch(t){(e._error||console.error)(t)}return n}}class je extends re{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),l={...a,response:c};return this._events.emit("response",{...l,...i}),this._postprocess(l)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(e,t,n):this.helpers.fetch(s,n,r)}_postprocess({response:e}){return e.data}}const{GROUP:De,NAME:Me}=d;class ze extends je{constructor(e){super(e,De.INTERACTIONS)}async upload(e,t){try{return await this._run(Me.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Me.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:n}=s;return this.helpers.sendBeacon(e,n,t),{}}return super._send({...s,options:t})}}class Fe{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...n}=this._options;const i=new ce(s);let r;t=u(this._ac.signal,i.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,l=!1;function u(){o&&clearInterval(o),l=!0}const h=new j;return o=setInterval((async()=>{let t,o,_;try{if([t,o,_]=await e(r?{signal:r}:{}),l||!y(a)&&a>=_)return;y(_)||(a=_),i&&i(t,o,_),c=0}catch(e){return n&&n(e),c++,void(c>s&&(u(),h.error(e)))}h.update(t,o),o&&u()}),t),r&&r.addEventListener&&r.addEventListener("abort",(()=>{u(),h.abort(r.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?i.clear():this._isUpdated(r,e)&&i.touch(),r=e},...n})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class Be extends Fe{constructor(e,t,s,n){super(n),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:Qe,NAME:Ge}=d;class He extends je{constructor(e){super(e,Qe.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new We(this,e,t);const s=await this._run(Ge.QUESTIONS,e,t);return new We(this,s,t)}async _questions(e,t){return this._run(Ge.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${Ge.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(Ge.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(Ge.TRENDING_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(Ge.SEARCH,e,t);return s.question_id?new Ve(this,s,t):s}async _searchGet(e,t){return this._run(`${Ge.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(Ge.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(Ge.SEARCH_AUTOCOMPLETE,e,t)}}class We extends Be{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class Ve extends Be{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),w(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:Ke,NAME:Ye}=d;class Ze extends je{constructor(e){super(e,Ke.SEARCH)}async search(e,t){return this._run(Ye.SEARCH,e,t)}async autocomplete(e,t){return this._run(Ye.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(Ye.MGET,e,t)}}const{GROUP:Je,NAME:Xe}=d;class et extends je{constructor(e){super(e,Je.RECOMMENDATION)}async userToProducts(e,t){return this._run(Xe.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(Xe.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(Xe.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(Xe.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(Xe.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(Xe.PRODUCT_TO_PRODUCTS,e,t)}}class tt extends re{constructor(e,t){super("api",e),this._client=e,this.helpers=new qe(e,t),this.interactions=new ze(this),this.ask=new He(this),this.search=new Ze(this),this.recommendation=new et(this)}}var st=Object.freeze({__proto__:null,Api:tt,ApiBase:je,ApiHelpers:qe,Interactions:ze,Ask:He,Search:Ze,Recommendation:et});class nt extends re{constructor(e){super("context",e),this._client=e}}var it={api:st,context:{Context:nt}};class rt{constructor(e){w(this,{install:e})}}class ot extends oe{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new at(this,it),this.plugins=new ct(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new q);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const n=new s;return w(n,{id:e}),this._tryConfig(n,t),n;case"function":return new rt(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(e,t,s){const n=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),i=0>t?e.length:t,r=e.lastIndexOf("/",i)+1,o=e.indexOf(".",r),a=0>o?"":e.slice(o,i);return`${e.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${n}.min.js`}(e,t,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new te).get(s);!this.isRegistered(e)&&this.register(n)}}class at{constructor(e,t){b(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),w(this,{classes:t})}}class ct{constructor(e){b(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const lt=new class extends re{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new ot(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=Le,this._cmdRes=new q}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var ut=Object.freeze({__proto__:null,viewable:C,debounce:Q});const{currentScript:ht}=document;class _t extends re{static attach(){(window.MisoClients||(window.MisoClients=[])).push(_t),window.MisoClient?window.MisoClient!==_t&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=_t}static debug(){}constructor(e){super("client",lt),this._config(e),this.context=new nt(this),this.api=new tt(this,lt),function(e){lt._clients.push(e),lt._events.emit("create",e)}(this)}get version(){return _t.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,g(e)}_readConfigFromScriptUrl(){return g({apiKey:new URL(new Request(ht.src||ht.href).url).searchParams.get("api_key")||void 0})}}_t.helpers=ut,w(_t,{uuid:N()});var dt=function(e){const t=lt._pluginRoot;return lt.MisoClient=t.MisoClient=e,b(e,lt,["version","instances","any","meta","on","once","cmdDone"]),b(e,t,["plugins"]),e}(_t);const{GROUP:pt,NAME:mt}=d;let ft;class gt{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||ft||(ft=$("miso_anonymous_id",N))}set anonymous_id(e){e=f(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=f(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function yt(){const e=new URLSearchParams(window.location.search);let t=g({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class bt{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],n=e[t];n!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function wt(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:Le};return s.uuid||(s.uuid=N()),{...e,context:{...t,custom_context:s}}}const vt="std:native-fetch";let Et,St;const kt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Et="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),Et="borrowed",e.contentWindow.fetch}catch(e){St=e}})();const Ot="miso-logdump",It="miso-logdump",xt=It+"__download-btn",At="Miso Log";class Tt{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return $t||($t=z(F("logdump")))}();let e=document.getElementById(Ot);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||At,t.classList.add(xt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=Ot,e.classList.add(It),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(Ot),t=e&&e.querySelector("."+xt);t&&(t.textContent=this._options.logDownloadButtonText||At)}hideDownloadButton(){const e=document.getElementById(Ot);e&&(e.style.display="none")}download(){const e=new Blob([Rt(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:Ct()})}return e&&"string"==typeof e?e:`miso-log.${Ct()}.jsonl`}clear(){this._logs=[]}}function Ct(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Rt(e){return e.map((e=>JSON.stringify(G(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Nt(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function Nt(e){return e?G(e,{depth:2}):e}let $t;const Pt="std:debug";function Lt(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function Ut(e,t){return Object.freeze({...e,...t,members:qt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function qt(e=[],t=[]){return[...new Set([...e,...t])]}function jt(e,t){let s={};for(const n of e)n&&(s=t(s,n));return g(s)}function Dt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Mt(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,n=t.payload,{...s,...n,...zt("_meta",s,n)})});var s,n}))}function zt(e,t,s){const n=t&&t[e],i=s&&s[e],r=n?i?{...n,...i}:n:i;return void 0!==r?{[e]:r}:{}}dt.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Tt(e)}static get id(){return Pt}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Pt,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,n)=>this._handleEvent(e,n,s,t)))}_handleEvent(e,{name:t},s,n=[]){if("child"===t||"subtree"===t)return;const i=n.concat(e.meta.path);if(i.length||"create"!==t){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(t,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(i[1],i.slice(2),t,s))}this._logw(i.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",e];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=e,i="custom"===t&&s?`${t}:${s}`:t;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,n){this._logw([e,t.join(".")],s,n)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Lt)):this._log(e,t,Lt(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return vt}install(e,t){kt?(t.setCustomFetch(kt),e.debug(`<plugin:${vt}>`,"[info]",`Using ${Et} native fetch`)):e.debug(`<plugin:${vt}>`,"[error]","Failed to obtain native fetch: "+St.message)}}),dt.plugins.use(class extends re{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new gt(this);var s,n;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:n}){return t===pt.INTERACTIONS&&s===mt.UPLOAD?this._modifyPayloadForInteractions(e,n):t===pt.ASK&&s===mt.QUESTIONS?this._modifyPayloadForAsk(e,n):this._modifyPayloadForOthers(e,n)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:n,anonymous_id:i}=e.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=e.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:n}=e.context,i=g({anonymous_id:s,user_id:n});return{data:t=t.map((e=>({...i,...e})))}}}),dt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...g({page:g({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:yt()}),...e.context}})))}}}),dt.plugins.use(class extends re{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new bt(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:n}){if(t===h.SEARCH)if(s===_.SEARCH)this._captureSearchApiRequest(e,n)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),dt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(wt)}}}),dt.plugins.use(class extends re{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case h.SEARCH:case h.RECOMMENDATION:return!0}return!1}});const Ft="data-miso-product-id",Bt="default",Qt="_organic",Gt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),Ht=new Set([Gt.PRODUCTS,Gt.CATEGORIES,Gt.ATTRIBUTES,Gt.RESULTS,Gt.ITEMS,Gt.QUESTION,Gt.ANSWER,Gt.IMAGES,Gt.SOURCES,Gt.RELATED_RESOURCES,Gt.QUERY_SUGGESTIONS,Gt.RELATED_QUESTIONS,Gt.AFFILIATION,Gt.FACETS,Gt.TOTAL]);function Wt(e){return Ht.has(e)}const Vt=new Set([Gt.PRODUCTS,Gt.IMAGES,Gt.SOURCES,Gt.RELATED_RESOURCES]);const Kt=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),Yt=[Kt.IMPRESSION,Kt.VIEWABLE,Kt.CLICK,Kt.SUBMIT,Kt.FEEDBACK],Zt=[Kt.IMPRESSION,Kt.VIEWABLE,Kt.CLICK],Jt=new Set(Zt);const Xt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),es=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function ts(e){if(0>Yt.indexOf(e))throw Error("Unrecognized event type: "+e)}const ss=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function ns(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function is(e){if(void 0===e)return;let[t,s]=m(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function rs(e,t){return!1===(t=is(t))[0]?t:e&&t?[t[0]||e[0],os(e[1],t[1])]:t||e}function os(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const as=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function cs(e={}){e=Dt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))ls(t);return e}function ls(e={}){return e=Dt(e)}function us(e={},t={}){const s={...e};for(const[n,i]of Object.entries(t))void 0!==i&&(s[n]=Yt.includes(n)?hs(e[n],i):i);return s}function hs(e={},t={}){return{...e,...t}}const _s=[{key:ss.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return g({group:s,name:e,payload:t})},merge:Mt},{key:ss.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${Gt.PRODUCTS}: ... }) instead`),e={...s,[Gt.PRODUCTS]:t});const n={};for(const[t,s]of Object.entries(e))n[ns(t)]=is(s);return n},merge:function(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>{for(const[s,n]of Object.entries(t))e[s]=rs(e[s],n);return e}))}},{key:ss.DATA_PROCESSOR,normalize:function(e){e=m(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:ss.TRACKERS,normalize:function(e={}){e=Dt(e);const{active:t,...s}=e,n={};for(const[e,t]of Object.entries(s))n[e]=cs(t);return{active:t,...n}},merge:function(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>{for(const[s,n]of Object.entries(t))void 0!==n&&(e[s]="active"===s?n:us(e[s],n));return e}))}},{key:ss.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=m(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,n=t.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:ss.FILTERS,normalize:Dt,merge:function(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>Object.assign(e,t)))}},{key:ss.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&jt(e,((e,t)=>Object.assign(e,t)))}}];class ds{constructor(){this._events=new ne({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class ps{constructor(e={},t={}){this._events=new ne({target:this}),this._defaults=t,this._context=e||{},this._locals={},w(this,{resolved:new ms(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class ms{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,n=s._context[e];this._cache[e]=t(s._defaults[e],n&&n.get(),s._locals[e])}return this._cache[e]}}class fs{constructor(e,t,s,n,i){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?n(e):void 0,this._merge=i}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of _s){const{key:t,normalize:s,merge:n}=e;Object.defineProperty(ds.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new fs(this,this._globals,t,s,n))}}),Object.defineProperty(ps.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new fs(this,this._locals,t,s,n))}}),Object.defineProperty(ms.prototype,t,{get:function(){return this._get(e)}})}const gs=[ss.API,ss.LAYOUTS,ss.DATA_PROCESSOR,ss.TRACKERS,ss.INTERACTIONS];function ys(e,t=gs){for(const s of t)bs(e,s)}function bs(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+n](e){return this._options[t].merge(e),this},["clear"+n](){return this._options[t].set(),this}})}var s}const ws="q",vs="qs";function Es(e={}){const{setValue:t,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:n=ws,sourceParam:i=vs,...r}={}){return{setValue:e,focus:t,updateUrl:s,param:n,sourceParam:i,...r}}(e),r=new URLSearchParams(window.location.search),o=r.get(n),a=r.get(i)||void 0,{layout:c}=this._views.get(Gt.QUERY);c&&(o&&t&&(c.value=o),!o&&s&&c.focus()),o&&this.query(g({q:o,qs:a}))}class Ss extends re{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new ds}}function ks(e){return e?"view:"+e:"view"}ys(Ss.prototype);class Os{constructor(e={}){(this._events=new ne)._injectSubscribeInterface(this),this._options=e,this._states={},w(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const n=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(n),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(n)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Is{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:N(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function xs(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class As{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e})}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...n}=e;this._emitResponse({session:t,request:n});try{const{signal:s}=this._ac||{},i={...e.options,signal:s},r=await this._source({session:t,...e,options:i});if(r&&r[Symbol.asyncIterator]){let e;for await(e of(r._response&&this._emitResponseWithSessionCheck({session:t,request:n,value:r._response}),r)){if(!xs(this._hub,t))break;this._emitResponse({session:t,request:n,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:n,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:n,error:e})}}_emitResponseWithSessionCheck(e){xs(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ts{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{p(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Cs,VIEWABLE:Rs,CLICK:Ns}=Kt,{UNTRACKED:$s,TRIGGERED:Ps}=Xt,Ls=Object.freeze({[Cs]:$s,[Rs]:$s,[Ns]:$s});class Us{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:Ls}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||$s}set(e,t,s){ts(t),function(e){if(e!==Xt.UNTRACKED&&e!==Xt.TRACKING&&e!==Xt.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const n of m(e))this._setOne(n,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Ps))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const n=s(t);return e.set(t,n),n}(this._states,this._getKey(e),(()=>({...Ls}))))[t]=s}}const qs=[Symbol("itemless")];class js{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Us(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){ts(e);const{options:n}=this;if(!n)return;this._syncSession();const{deduplicated:i=!0,itemless:r=!1}=n;if(i){if(r&&(t=qs),0===(t=this._states.untriggered(m(t),e)).length)return;this._states.set(t,e,Xt.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:Kt.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(g({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Us(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[ks(this._role)]}}for(const e of Zt)js.prototype[e]=function(t,s){this._trigger(e,t,s)};class Ds{constructor(e,t){this._events=new ne({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),w(this,{role:t,interface:new Ms(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ts((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===Gt.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new js({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((i=t)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:l,meta:u,value:h}=t,_={session:o,status:a,ongoing:c,request:l,meta:u,data:h,...zs(t)},d=(e={},t)=>{!1!==e&&this.updateState({..._,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:d})}catch(e){this._error(e),d({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?es.ERRONEOUS:e.status;e=this._state=Object.freeze(g({...e,status:s}));const{role:n}=this;this.hub.update(ks(n),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:n,meta:i,...r}=e,o={value:this._mapping(e,this),status:n,data:t,meta:i,...r};return this.role===Gt.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(t)}),g(o)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!Wt(s))continue;let t=e&&e[s];if(s===Gt.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ms{constructor(e){b(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function zs(e){return function(e){return e.status===es.READY&&!e.ongoing}(e)?{empty:!!Fs(e)}:{}}function Fs(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function Bs(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class Qs{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new ne({target:this,error:s}),w(this,{facets:new Gs(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return g({facets:Object.freeze({}),sort:Bs(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(g({...e,...t,facets:Object.freeze(g({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Gs{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const Hs=Symbol.for("miso:tracked");function Ws(e){return!!e[Hs]}function Vs(e){e[Hs]=!0}const Ks=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function Ys(e,t){return!!t&&{...e,...t}}class Zs{constructor(e,{workflow:t,extensions:s,layouts:n,roles:i,options:r}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new Qs(this);for(const e of i.members)e!==Gt.CONTAINER&&(this._views[e]=new Ds(this,e));w(this,{interface:new Js(this),trackers:new Xs(this,i.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),e.on("data",(e=>this.refresh({data:e}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Ds(this,Gt.CONTAINER);t.layout=this._createLayout(Gt.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,n]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName});if(t===Gt.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,n]=t;return this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:n}=t._inst;e&&(s=s.filter((t=>t.role===Gt.CONTAINER||e.includes(t.role)))),n&&(s=s.filter((e=>!n.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:n={},...i}=e;return g({...Ks,...i,impression:Ys(Ks.impression,t),viewable:Ys(Ks.viewable,s),click:Ys(Ks.click,n)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=Gt.CONTAINER;this._containerTracker=new js({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class Js{constructor(e){this._actor=e,b(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class Xs{constructor(e,t){this._views=e;for(const s of t)s!==Gt.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,Gt.CONTAINER,{get:()=>e._getContainerTracker()})}}class en{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:Kt.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class tn{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=m(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function sn(e){return async({group:t,name:s,payload:n,options:i})=>{if(t===h.ASK)switch(s){case _.QUESTIONS:return e.api.ask.questions(n,i);case _.SEARCH:return e.api.ask.search(n,i)}return e.api[t]._run(s,n,i)}}class nn{constructor({role:e,workflow:t,...s}={}){w(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const n=this._rendered.get(e),i=L(!1);t=this._preprocess({state:t,rendered:n},{skip:i.t})||t,this._updatePending(t,s),i.value||this._handleInput({state:t,rendered:n},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,T((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),r=L([]),o=L({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function rn(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function on(e,t,s,n){const{templates:i}=e,[r,o]=Sn(e,s);return""+r+(i.indexBlock||vn)(e,s,n)+(i.infoBlock||i.articleInfoBlock||un)(e,s,n)+o}function an(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||_n)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.priceBlock||yn)(e,t,s)+(i.ctaBlock||En)(e,t,s)}</div>`}function cn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||_n)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.priceBlock||yn)(e,t,s)}</div>`}function ln(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||_n)(e,t,s)+(i.dateBlock||mn)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.ctaBlock||En)(e,t,s)}</div>`}function un(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||_n)(e,t,s)+(i.authorsAndDateBlock||gn)(e,t,s)}</div>`}function hn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||_n)(e,t,s)}</div>`}function _n({className:e},{title:t,_title_with_markups:s}){const n=s||R(t);return n?`<div class="${e}__item-title">${n}</div>`:""}function dn({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function pn({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${R(s)}</div>`:""}function mn({className:e,templates:t},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${e}__item-date">${In(r,t.date)}</div>`:""}function fn({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function gn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-authors-and-date-container">${""+(i.authorsBlock||fn)(e,t,s)+(i.dateBlock||mn)(e,t,s)}</div>`}function yn(e,t){const{className:s,templates:n}=e,{sale_price:i,original_price:r,currency:o="USD"}=t,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,l=t.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(n.discountRateText||bn)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function bn(e,{discount_rate_percent:t}){return`(${t}% off)`}function wn(e,t,s={}){const{className:n,templates:i}=e,{cover_image:r,image_src:o,image_alt:a}=t;if(!r&&!o)return"";const c=o?"image":"cover-image";return`<div class="${n}__item-${c}-container">${"image"===c?`<img class="${n}__item-${c}" src="${o}"${a?` alt="${a}"`:""}>`:`<img class="${n}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(i.brandBlock||dn)(e,t,s):""}</div>`}function vn({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function En(e,t,s){const{className:n,templates:i}=e,r=xn.asFunction(i.cta)(e,t,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function Sn({className:e,options:t={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const a=!1!==o.link&&n?"a":"div",c=!1!==o.link&&n?`href="${n}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:n=!0}=e;let i="";n&&(t&&(i+=` target="${t}"`),s&&(i+=` rel="${s}"`));return i}(t.link)}`:"";return[`<${a} class="${e}__${i}" ${r?`data-role="${r}"`:""} ${s?`${Ft}="${s}"`:""} ${c}>`,`</${a}>`]}const kn=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),On="en-US";function In(e,t=kn){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||kn.locale,t);default:throw Error("Invalid date format: "+t)}}const xn=Object.freeze({tagPair:Sn,formatDate:In,formatNumber:function(e,t=On){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||On.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:R,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class An extends nn{constructor({className:e,templates:t,...s}={}){super(s),w(this,{className:e,templates:{...rn("root"),...t,helpers:xn}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Tn extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Tn.MisoClient.ui.layouts.create("banner").render(this)}}class Cn{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(e,{ac:s});let i=!1;try{await C(e,{...t,signal:n}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return i}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class Rn extends nn{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new Cn}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Tn.tagName,s=this._shallRenderBanner(e),n=e.querySelector(t);s&&!n?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&n&&n.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,n=void 0!==s&&"auto"!==s?s:t;return"auto"===n?e.components.some((({role:e})=>function(e){return e===Gt.PRODUCTS||e===Gt.ANSWER}(e))):!!n}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1,unanswerable:o=!1}={}}=t,a=[s,r?es.EMPTY:es.NONEMPTY];s===es.READY&&a.push(n?es.ONGOING:es.DONE),o&&a.push(es.UNANSWERABLE),e.setAttribute("status",a.join(" ")),i?e.setAttribute("miso-id",i):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===es.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const Nn=Object.freeze({root:function(e,t){const{className:s,templates:n}=e,{status:i,value:r}=t;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class $n extends An{static get type(){return"error"}static get defaultTemplates(){return Nn}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...Nn,...t},...s})}}const Pn=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Ln(e,t){const s=[];for(const n of t.entries){const t=e.e2b.get(n.element);t&&t.key===n.key||s.push(n)}return s}class Un{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const n=function(e,t,s){const n=new Map,i=new Map,r=[];for(let o=0;e.length>o;o++){const a=e[o],c=s[o],l=Object.freeze({index:o,key:a,value:t[o],element:c});n.set(a,l),i.set(c,l),r.push(l)}return{k2b:n,e2b:i,entries:r}}(e,t,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Ln(i,n),o=Ln(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function qn(e){W(e,jn.prototype)}class jn{_initTrackable(){this._bindings=new Un,this._viewables=new Cn}_syncBindings(e,t){const s=this._getItems(t)||[],n=s.map((e=>this._getItemKey(e))),i=this._getItemElements(e),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:n}of e)(async()=>{await this._viewables.track(n,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!Ws(t)&&0===t.button&&!t.defaultPrevented&&!!x(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(Vs(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Dn{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===es.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let n=!1;try{await C(t,{area:1,duration:0,signal:s.signal}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Mn=Object.freeze({product:function(e,t,s,n){const{templates:i}=e,[r,o]=Sn(e,s);return""+r+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.productInfoBlock||cn)(e,s,n)+o},article:function(e,t,s,n){const{templates:i}=e,[r,o]=Sn(e,s);return""+r+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.articleInfoBlock||ln)(e,s,n)+(i.indexBlock||vn)(e,s,n)+o},compactArticle:on,image:function(e,t,s,n){const{templates:i}=e,[r,o]=Sn(e,s);return""+r+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.imageInfoBlock||hn)(e,s,n)+o},question:function(e,t,s){const[n,i]=Sn(e,s);return`${n}${s.value||s.text||s}${i}`},root:function(e,t){const{className:s,role:n,templates:i,options:r}=e,{status:o}=t;return`<div class="${s} ${o}"${n?` data-role="${n}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${o===es.READY?i[o](e,t):""}${i.trigger(e,t)}${i.loading(e,t)}</div>`},[es.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t)||[];return n.length>0||t.ongoing?s.body(e,t,n):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:n,templates:i,options:r}=e,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${i.items(e,t,s)}</${o}>`},ordered:!1,items:function(e,t,s,{offset:n=0}={}){const{templates:i}=e;let r=n;return s.map((s=>i.item(e,t,s,r++))).join("")},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item">${r[a](e,t,s,{index:n})}</li>`},productInfoBlock:cn,articleInfoBlock:ln,compactArticleInfoBlock:un,imageInfoBlock:hn,brandBlock:dn,titleBlock:_n,descriptionBlock:pn,dateBlock:mn,authorsBlock:fn,authorsAndDateBlock:gn,priceBlock:yn,discountRateText:bn,ctaBlock:En,cta:function(e,t,s){const{templates:n}=e,{url:i}=t;if(!i)return"";const[r,o]=Sn(e,{url:i},{classSuffix:"item-cta",role:"cta"}),a=xn.asFunction(n.ctaText)(e,t,s);return a?`${r}${a}${o}`:""},imageBlock:wn,indexBlock:vn,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class zn extends An{static get defaultTemplates(){return Mn}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Mn,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=this._html(e,t,s);return{...e,incremental:s,html:n}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:n,html:i}=t;if(n)if(i){this._getListElement(e).insertAdjacentHTML("beforeend",i)}else s(!1);else e.innerHTML=i}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:n,element:i}=t;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}qn(zn.prototype),W(zn.prototype,Dn.prototype);const Fn="miso-list";class Bn extends zn{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Fn}constructor({className:e=Fn,...t}={}){super({className:e,...t})}}const Qn="miso-horizontal";class Gn extends zn{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Qn}constructor({className:e=Qn,...t}={}){super({className:e,...t})}}const Hn="miso-cards";function Wn(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function Vn(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function Kn(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),n=t[2]||"";return[s,n]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function Yn(e){return void 0===e||e instanceof Zn?e:new Zn(e)}class Zn{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=Yn(e),Yn([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class Jn{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,T((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),n=t.itemCount,i=t.itemCount=s?s.length:void 0;i!==n&&(void 0===i?t.itemIndex=void 0:void 0===n&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(Wn(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let n=0;for(const t of s.children)Vn(t,"active",n===e),n++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const Xn="miso-ui-icon",ei=Xn+"-svg-1_12_0",ti={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},si=`<symbol id="${Xn}-${ti.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ni=`<symbol id="${Xn}-${ti.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,ii=`<symbol id="${Xn}-${ti.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,n=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-n} ${n}L${n} ${t-n}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,ri=`<svg id="${ei}" style="display:none;">${[si,ni,ii,`<symbol id="${Xn}-${ti.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${Xn}-${ti.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${Xn}-${ti.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let oi=!1;function ai(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${Xn}-${e}"></use></svg>`}oi||document.head.querySelector("#"+ei)||(oi=!0,document.head.insertAdjacentHTML("beforeend",ri));const ci=new Set(Object.values(ti));ai(ti.SEND),ai(ti.SEARCH);const li=ai(ti.TRIANGLE);ai(ti.TRIANGLE_EQ);const ui=ai(ti.CHEVRON),hi=ai(ti.CHEVRON_NEGATIVE),_i="miso-carousel",di=Object.freeze({body:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__viewport"><div class="${n}__viewport-inner">${i.list(e,t,s)}</div></div>${i.controls(e,t,s)}`},controls:function(e,t,s){const{templates:n}=e;return`${n.controlContainer(e,t,"previous")}${n.controlContainer(e,t,"next")}${n.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-container-${s}">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?hi:ui},indexIndicator:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${n}__index-indicator-item">${i.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),pi=Object.freeze({...zn.defaultTemplates,...di});class mi extends zn{static get type(){return"carousel"}static get defaultTemplates(){return pi}static get defaultClassName(){return _i}constructor({className:e=_i,templates:t,...s}={}){super({className:e,templates:{...di,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){W(e,Jn.prototype)}(mi.prototype);const fi="16rem",gi=Object.freeze({...zn.defaultTemplates,item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o,c=r[a](e,t,s,{index:n});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),yi="miso-gallery";class bi extends zn{static get type(){return"gallery"}static get defaultTemplates(){return gi}static get defaultClassName(){return yi}constructor({className:e=yi,templates:t,...s}={}){super({className:e,templates:{...gi,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=s?void 0:this._bodyHtml(e),i=this._itemsHtml(e,t);return{...e,...g({incremental:s,bodyHtml:n,itemsHtml:i})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const n=this._renderListElement(e,t,s);n&&(this._syncListAspectRatio(n),this._renderItems(n,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:n}=t;return s||(e.innerHTML=n),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,n=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,n)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const n=e.children.length,i=this._writeItemSizes((this._getItems(t)||[]).slice(n),s,n);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,i,{offset:n}))}_writeItemSizes(e,[t=0,s=0]=[],n=0){let i=0;n>0&&(i=Math.min(n,t),n-=i,t-=i),n>0&&(i=Math.min(n,s),n-=i,s-=i);const r=[];for(const n of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),r.push({...n,_size:e})}return r}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=Yn(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:n}=t,{height:i=fi}=this.options,r=Kn(i),o=e.clientWidth;if(0===o)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(o*n.width*2/(r*n.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),n=e;const i=Math.min(Math.floor(s/3),n);n-=i,s-=3*i;const r=Math.min(s,n);return n-=r,s-=r,[i,r,n]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,n=0]=t;const{className:i}=this;for(const t of e.children){let e=!1,r=!1;s>0?(e=!0,s--):n>0&&(r=!0,n--),Vn(t,i+"__item-large",e),Vn(t,i+"__item-medium",r),Vn(t,i+"__item-small",!e&&!r)}}}const wi="miso-search-box";const vi=Object.freeze({root:function(e){const{className:t,templates:s,role:n,options:i,autocomplete:r}=e,{placeholder:o}=i;return`\n<div class="${t}" ${n?`data-role="${n}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=t;var r;return("function"==typeof n?n(e):""+n)+("function"==typeof i?i(e):(ci.has(r=i)?ai(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:n,autocomplete:i}=e;e={templates:s,workflow:n,...i};const r=[],o=[];for(const e of t)(e.product?r:o).push(e);return s.queries(e,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__${t}-list" data-role="${t}-list">${s.map((s=>i.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:n,templates:i}=e;return`\n<li class="${n}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${i[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||R(t)},product:function(e,{product:t}){const{templates:s}=e,[n,i]=s.helpers.tagPair(e,t,{role:!1});return""+n+s.imageBlock(e,t)+s.productInfoBlock(e,t)+i},imageBlock:wn,productInfoBlock:cn}),Ei=Object.freeze({className:"miso-autocomplete",debounce:300});class Si extends An{static get type(){return"search-box"}static get defaultTemplates(){return vi}static get defaultClassName(){return wi}constructor({className:e=wi,templates:t,autocomplete:s,...n}={}){super({className:e,templates:{...vi,...t},...n}),w(this,{autocomplete:{...Ei,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=Q(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:n}){if(!t.completions)return;const{status:i=es.INITIAL,session:r,value:o}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(o);Vn(e,"nonempty",u.length>0),l.setAttribute("data-status",i),l.innerHTML=this.templates.completions(this,u),n({completions:{index:a,status:i}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return ki.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new ki(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&x(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let n=t;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const t=n.getAttribute("data-index"),i=this._context().data.get(parseInt(t)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[Kt.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class ki{static empty(){return ki._empty||(ki._empty=new ki)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,n=[];for(const i in e)for(const r of e[i])r.product&&!r.product.url||(r._index=t,r._field=i,s.set(t,r),n.push(r),t++);return n}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const Oi="miso-option-list";const Ii=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:n}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>n.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${R(t.text||t)}</li>`}});class xi extends An{static get type(){return"option-list"}static get defaultTemplates(){return Ii}static get defaultClassName(){return Oi}constructor({className:e=Oi,templates:t,...s}={}){super({className:e,templates:{...Ii,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:n}=t;this._syncOptionValues(e,n)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;Vn(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;n&&(this._trackClick(e,s),this._submit(n.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}qn(xi.prototype);const Ai=Object.freeze({...rn("options"),root:function(e){const{className:t,role:s,templates:n}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${n.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:n}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${n.content(e,t)}\n</div>\n`}});class Ti extends An{static get defaultTemplates(){return Ai}constructor({className:e,templates:t,field:s,defaultValue:n,...i}={}){super({className:e,templates:{...Ai,...t},...i}),this._field=s,this._defaultValue=n}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=x(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=t.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],T((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:n}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",n),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const Ci="miso-feedback",Ri=["helpful","unhelpful"];const Ni=Object.freeze({options:function(e){const{templates:t}=e;return Ri.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:n,options:i={}}=e;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(e,t)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class $i extends Ti{static get type(){return"feedback"}static get defaultTemplates(){return Ni}static get defaultClassName(){return Ci}constructor({className:e=Ci,templates:t,...s}={}){if(super({className:e,templates:{...Ni,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Pi="miso-text";const Li=Object.freeze({root:function(e,{value:t}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=e,o=n?`data-role="${n}"`:"",a=void 0!==t?R(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:n}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[i,r]=t;switch(i){case"date":return e=>s(e,r);case"number":return e=>n(e,r);default:return e=>""+e}}(e)(t)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Ui extends An{static get type(){return"text"}static get defaultTemplates(){return Li}static get defaultClassName(){return Pi}constructor({className:e=Pi,templates:t,tag:s="p",...n}={}){super({className:e,templates:{...Li,...t},tag:s,...n})}}class qi extends nn{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=L(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class ji{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=t.substring(0,s),l=!n.startsWith(c);return a||l?e.innerText=n:e.insertAdjacentText("beforeend",n.substring(s,i)),a&&e.classList.add("done"),{cursor:i,done:a}}}function Di(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=e;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[t,Mi(t)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(e));const n=t.children[0];return n.setAttribute("data-status",s||es.INITIAL),n}function Mi(e){return e+"__cursor"}function zi(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Fi(n[0])}, ${Fi(n[1])})`,t,""+r,i,o)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Fi(e){return Math.floor(100*e)/100+"ms"}const Bi="miso-typewriter";class Qi extends qi{static get type(){return"typewriter"}static get defaultClassName(){return Bi}constructor({className:e=Bi,tag:t="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:t,format:s,tooltip:n,...a}),w(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:Z({speed:i,acceleration:r}),this._readiness=new q,"markdown"===s&&Qi.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=Mi(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:n,onDebug:zi(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new ji}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=e,a=n&&n.answer_stage||"result",c=(u=e,(l=t)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const h=t?c&&a===t.stage?t.streak:t.streak+1:0,_=c&&t&&t.doneAt||(r!==es.READY||o?void 0:Date.now());return this._prevState=Object.freeze(g({session:i,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(e,{state:t,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=Di(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(o,s,{...t,cursor:e})}i(a);const l=t.status===es.READY&&!a.done;n({ongoing:l},{silent:l&&(!s||s.status===es.READY)&&!c}),l&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const n=t.closest("a");if(n){if(!e.defaultPrevented){const{href:t,innerText:s,className:i}=n;t&&this._view._events.emit("link-click",g({event:e,url:t,text:s?s.trim():"",className:i||"",attributes:Gi(n)}))}}else;}}function Gi(e){const{attributes:t}=e,s={};for(const{name:e,value:n}of t)e.startsWith("data-")&&(s[e]=n);try{return JSON.stringify(s)}catch(e){return"{}"}}const Hi="miso-affiliation";const Wi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i,options:r}=e,{status:o}=t,a=n?` data-role="${n}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${o}"${a}${l}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${o===es.READY?i[o](e,t):""}</div>`},[es.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t);return n&&n.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}-container">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return li},body:function(e,t){const{className:s,templates:n}=e,i=e._getItems(t);return`<div class="${s}__body">${n.list(e,t,i)}</div>`},item:function(e,t,s,n){const{className:i,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(e,t,s,{index:n})}${r[a](e,t,s,{index:n})}</div></li>`},itemHeader:function(e,t,s,n){const{className:i,templates:r}=e;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=xn.asFunction(o)(e,t,s,n),a=xn.asFunction(a)(e,t,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,n){const{templates:i}=e,[r,o]=Sn(e,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||an)(e,s,n)+(i.imageBlock||wn)(e,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,n){const{className:i,templates:r}=e,o=xn.asFunction(r.logoText)(e,t,s,n)||"",a=xn.asFunction(r.logoImg)(e,t,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(e,t,s,n){const{className:i,templates:r}=e,o=xn.asFunction(r.logoUrl)(e,t,s,n);if(!o)return"";const a=xn.asFunction(r.logoAltText)(e,t,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Vi=Object.freeze({...zn.defaultTemplates,...Wi});class Ki extends zn{static get type(){return"affiliation"}static get defaultTemplates(){return Vi}static get defaultClassName(){return Hi}constructor({className:e=Hi,templates:t,autoplay:s,...n}={}){super({className:e,itemType:"affiliation",templates:{...Wi,...t},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new ae(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,T((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(Wn(n,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const Yi="miso-facets",Zi="miso-facet",Ji="custom_attributes.";const Xi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:n={}}=t.value||{};return Object.keys(n).map((i=>s.facet(e,{field:i,entries:n[i]},t)))},facet:function(e,t,s){const{facetClassName:n=Zi,templates:i}=e,{field:r}=t;return`<div class="${n}" data-role="facet" data-field="${R(r)}">${i.header(e,t,s)}${i.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:n=Zi,templates:i}=e;return`<div class="${n}__header">${i.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(Ji)&&(t=t.substring(18)),R(t)},options:function(e,{field:t,entries:s},n){const{facetClassName:i=Zi,templates:r}=e;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(e,{field:t,value:s,count:i},n))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:n=Zi,templates:i}=e;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(e,t,s)}</span>\n  <span class="${n}__count">${i.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return R(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function er(e,t){return`${e}:::${t}`}function tr(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class sr extends An{static get type(){return"facets"}static get defaultTemplates(){return Xi}static get defaultClassName(){return Yi}constructor({className:e=Yi,templates:t,...s}={}){super({className:e,templates:{...Xi,...t},...s}),this._bindings=new Un}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=tr(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)this._setSelected(n,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=tr(e.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)t[e]&&this._setSelected(n,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),n=[],i=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),o=s[e];if(!o)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=o[t];if(!c)break;n.push(er(e,c)),i.push({field:e,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[R(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const nr="miso-select";const ir=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e,r=n?`data-role="${n}"`:"",o=e._getItems(t),a=o.find((e=>e.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(e,a)}\n  ${i.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:n}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:n}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>n.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:n}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${n.text(e,t)}</li>`},text:function(e,t){return R(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,((e,t)=>" "+t))||t||"")}});class rr extends An{static get type(){return"select"}static get defaultTemplates(){return ir}static get defaultClassName(){return nr}constructor({className:e=nr,templates:t,...s}={}){super({className:e,templates:{...ir,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}qn(rr.prototype);const or="miso-more-button";const ar=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${t.status!==es.READY?" disabled":""}>\n  ${i.text(e)}\n</div>\n`},text:function(e){return"More"}});class cr extends An{static get type(){return"more-button"}static get defaultTemplates(){return ar}static get defaultClassName(){return or}constructor({className:e=or,templates:t,...s}={}){super({className:e,templates:{...ar,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var lr=Object.freeze({__proto__:null,TemplateBasedLayout:An,ContainerLayout:Rn,ErrorLayout:$n,BannerLayout:class extends An{static get type(){return"banner"}static get defaultTemplates(){return Pn}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Pn,...t},...s})}},CollectionLayout:zn,ListLayout:Bn,HorizontalLayout:Gn,CardsLayout:class extends zn{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Hn}constructor({className:e=Hn,...t}={}){super({className:e,...t})}},CarouselLayout:mi,GalleryLayout:bi,SearchBoxLayout:Si,OptionListLayout:xi,FeedbackLayout:$i,TextLayout:Ui,TypewriterLayout:Qi,AffiliationLayout:Ki,FacetsLayout:sr,SelectLayout:rr,MoreButtonLayout:cr});function ur(e){return e&&e.value&&e.value.revision}function hr(e){const t=function(e){if(!e)return es.INITIAL;const{request:t,error:s,value:n}=e;return s?es.ERRONEOUS:n?es.READY:t?es.LOADING:es.INITIAL}(e);return g({status:t,ongoing:t===es.READY?e.ongoing:void 0,...e})}function _r(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:n}=s;n&&(t.meta.miso_id=n)}function dr(e){const{request:t,value:s}=e;if(!t)return e;const{payload:n}=t||{},{q:i}=n||{};return i?{...e,value:{...s,keywords:i}}:e}function pr(e){const{role:t,type:s,items:n}=e,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:g({property:t})}};switch(function(e){return Jt.has(e)}(s)&&(!function(e){return Vt.has(e)}(t)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((e=>e.text||e.id||e))):i.product_ids=(n||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case Kt.SUBMIT:i.context.custom_context.value=e.value;break;case Kt.FEEDBACK:i.context.custom_context.value=i.value=e.value,i.context.custom_context.result_type=i.result_type=e.result_type}return g(i)}function mr(e={},t={}){return g({...e,...t,context:g({...e.context,...t.context,custom_context:g({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const fr=Object.freeze({}),gr=Object.freeze({[Gt.CONTAINER]:Rn.type,[Gt.ERROR]:$n.type}),yr=Object.freeze({}),br=Object.freeze({api:fr,layouts:gr,trackers:yr}),wr=Object.freeze({mappings:{[Gt.ERROR]:e=>e.error}});class vr extends re{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:n,defaults:i,options:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=n=n||t._client,e=Object.freeze({...e,plugin:s,client:n}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=r||new ps(t&&t._options,i),this._hub=new Os({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,n._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new Is(s),this._data=new As(s,{source:sn(n),options:i}),this._views=new Zs(s,{extensions:r,layouts:o,roles:t,options:i,workflow:e}),this._interactions=new tn(s,{client:n,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(ks(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:n}){n||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[ks(e)]||{};t.session&&t.status===es.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===es.READY,n=t===es.ERRONEOUS;this._emitLifecycleEvent(n?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||n)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(e);return n.add(e),!i}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Mt(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=ur(e);if(!y(s)){const e=ur(this._hub.states.data);if(!y(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=hr(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:es.READY,session:this.session,...t},this._hub.update(ks(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=pr(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)t=n(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==Gt.AFFILIATION)return e;const{items:s}=t;return mr(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return mr(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[ks(t.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?mr(e,{miso_id:n}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function Er(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Sr(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:n}=t;if(!n)return e;n=n.map((e=>({...e})));let i=0;for(const e of n)s&&(e.channel=s),e.position=i++;return{...e,affiliation:{...t,products:n}}}(e)}function Sr({products:e,...t}){return{channel:"sovrn",...t,products:e.map(kr)}}function kr({id:e,deeplink:t,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:l,merchant:u,...h}){return g({id:"sovrn-"+e,title:s,description:n,cover_image:c,url:t,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:u&&u.name,brand_logo:u&&u.logo,custom_attributes:Or({sovrn_id:e,thumbnail:l,merchant:u,...h})})}function Or(e,t=""){return Object.keys(e).reduce(((s,n)=>{const i=e[n];if(void 0===i)return s;const r=t?`${t}_${n}`:n;return"object"==typeof i?{...s,...Or(i,r)}:{...s,[r]:i}}),{})}function Ir(e){W(e,xr.prototype)}ys(vr.prototype),Object.assign(vr,{DEFAULT_API_OPTIONS:fr,DEFAULT_LAYOUTS:gr,DEFAULT_TRACKERS:yr,DEFAULT_OPTIONS:br,ROLES_OPTIONS:wr});class xr{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=t;else{window.open(t,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const Ar=Object.freeze({...vr.DEFAULT_API_OPTIONS,group:h.ASK,payload:{...vr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Tr=Object.freeze({actor:!1,api:{group:h.ASK,name:_.AUTOCOMPLETE}}),Cr=Object.freeze({...vr.DEFAULT_LAYOUTS,[Gt.QUERY]:[Si.type,{placeholder:"Ask a question"}],[Gt.QUESTION]:[Ui.type,{tag:"h2"}],[Gt.ANSWER]:Qi.type,[Gt.FEEDBACK]:$i.type,[Gt.IMAGES]:[bi.type,{incremental:!0,itemType:"image"}],[Gt.SOURCES]:[Bn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Gt.AFFILIATION]:[Ki.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Rr=Object.freeze({...vr.DEFAULT_TRACKERS,[Gt.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:as.click},[Gt.IMAGES]:as,[Gt.SOURCES]:as,[Gt.AFFILIATION]:as,[Gt.PRODUCTS]:as}),Nr=Object.freeze({...vr.DEFAULT_OPTIONS,api:Ar,autocomplete:Tr,layouts:Cr,trackers:Rr}),$r=Ut(vr.ROLES_OPTIONS,{main:Gt.ANSWER,members:Object.keys(Cr)});class Pr extends vr{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new en(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(Gt.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(Gt.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[ks(this._roles.main)]||{};e.session&&e.status!==es.INITIAL&&(e.status!==es.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,n=t===es.READY&&!e.ongoing,i=t===es.ERRONEOUS,r=n?"done":i?"error":t,o=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,e),(n||i)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){Es.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||Qt}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==ws?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:Er(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_updateUrlIfNecessary({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:n}=this._autoQuery,i=e&&e.question||t&&t.payload&&t.payload.question,r=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source;if(!i)return;const o=new URL(window.location),a=o.searchParams.get(s),c=o.searchParams.get(n)||Qt;i===a&&r===c||(o.searchParams.set(s,i),r===Qt?o.searchParams.delete(n):o.searchParams.set(n,r),window.history.replaceState({},"",o))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=function(e,{event_target:t}={}){return t?mr(e,{context:{custom_context:{event_target:t}}}):e}(e=this._writeAnswerClickInteraction(e,t),t)}_writeAskPropertiesToInteraction(e={},t){return mr(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==Gt.ANSWER)return e;const{items:s=[]}=t;return mr(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[ks(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e,event:t}){if(Ws(t))return;const{value:s}=this.states.data||{},{sources:n}=s||{},i=n&&n[e-1];i&&i.product_id&&(Vs(t),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){Ws(e)||(Vs(e),this._views.trackers.answer.click([],{items:[t]}))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Ir(Pr.prototype),Object.assign(Pr,{DEFAULT_API_OPTIONS:Ar,DEFAULT_AUTOCOMPLETE_OPTIONS:Tr,DEFAULT_LAYOUTS:Cr,DEFAULT_TRACKERS:Rr,DEFAULT_OPTIONS:Nr,ROLES_OPTIONS:$r});const Lr=Object.freeze({...Pr.DEFAULT_API_OPTIONS,name:_.QUESTIONS,payload:{...Pr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Ur=Object.freeze({...Pr.DEFAULT_LAYOUTS,[Gt.QUERY]:[Si.type,{templates:{buttonIcon:"send"}}],[Gt.RELATED_RESOURCES]:[Bn.type,{incremental:!0,itemType:"article"}],[Gt.QUERY_SUGGESTIONS]:xi.type}),qr=Object.freeze({...Pr.DEFAULT_TRACKERS,[Gt.RELATED_RESOURCES]:as,[Gt.QUERY_SUGGESTIONS]:{...as,click:{...as.click,validate:e=>0===e.button}}}),jr=Object.freeze({...Pr.DEFAULT_OPTIONS,api:Lr,layouts:Ur,trackers:qr}),Dr=Ut(Pr.ROLES_OPTIONS,{members:Object.keys(Ur)});class Mr extends Pr{constructor(e,t){super({name:"ask",context:e,roles:Dr,defaults:jr,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;w(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:n}=this;let i=g({...s,question:e,parent_question_id:n,_meta:{...s._meta,question_source:t||Qt}});return i=this._writeWikiLinkTemplateToPayload(i),i}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let n,i,r,{property:o}=e.context&&e.context.custom_context||{};return t.role===Gt.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(t)),mr(e,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class zr extends Ss{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Mr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Mr(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const Fr=Object.freeze({...vr.DEFAULT_API_OPTIONS,group:h.SEARCH,payload:{...vr.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Br=Object.freeze({...vr.DEFAULT_LAYOUTS,[Gt.QUERY]:[Si.type],[Gt.PRODUCTS]:[Bn.type,{incremental:!0,infiniteScroll:!0}],[Gt.KEYWORDS]:[Ui.type,{raw:!0}],[Gt.TOTAL]:[Ui.type,{raw:!0,format:"number"}],[Gt.FACETS]:[sr.type],[Gt.SORT]:[rr.type],[Gt.MORE]:[cr.type]}),Qr=Object.freeze({...vr.DEFAULT_TRACKERS,[Gt.PRODUCTS]:as}),Gr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Hr=Object.freeze({...vr.DEFAULT_OPTIONS,api:Fr,layouts:Br,trackers:Qr,pagination:Gr}),Wr=Ut(vr.ROLES_OPTIONS,{main:Gt.PRODUCTS,members:Object.keys(Br),mappings:{[Gt.FACETS]:"facet_counts",[Gt.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=t.states.filters||{},r=i&&i.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(n).field;return r?n.map((e=>({...e,selected:e.field===r}))):n}}});class Vr extends vr{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(Gt.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){Es.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this._views.filters.reset({silent:!0}),this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==es.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:n}=t||{};return g({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const n=e[s];n&&n.length&&(t[s]={terms:n})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return m(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},n=s.map((e=>e.product_id)).filter((e=>e)),i=[...e.exclude||[],...n];return 0===i.length?e:{...e,exclude:i}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:n}=e;switch(s){case es.INITIAL:case es.LOADING:break;default:return e}return n&&n.facet_counts?e:{...e,value:{...n,facet_counts:t}}}(e=dr(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=Gt.PRODUCTS}={}){const{status:s,request:n,value:i}=e;if(s!==es.READY||!n||!i)return e;const{[t]:r}=i;if(!r)return e;const{rows:o}=n.payload,{length:a}=r;return o>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=Gt.PRODUCTS}={}){if(!t.value)return e;const{[s]:n=[],facet_counts:i,total:r}=e.value,{[s]:o=[]}=t.value;return{...t,value:{...t.value,facet_counts:i,total:r,[s]:[...n,...o]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}ys(Vr.prototype,[ss.PAGINATION,ss.FILTERS]),Object.assign(Vr,{DEFAULT_API_OPTIONS:Fr,DEFAULT_LAYOUTS:Br,DEFAULT_TRACKERS:Qr,DEFAULT_PAGINATION:Gr,DEFAULT_OPTIONS:Hr,ROLES_OPTIONS:Wr});const Kr=Object.freeze({members:[]});function Yr({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function Zr(e){return e&&e.value&&e.value.trim()||void 0}class Jr extends vr{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:Yr(t),roles:Kr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,Zr(e)===Zr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!Zr(e))return void this._updateCompletions({session:s,status:es.INITIAL});const n=this._buildPayload(e);this._request({payload:n})}_buildPayload(e){return{q:Zr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function Xr(e){W(e,eo.prototype)}class eo{_initAutocomplete(e){this._autocomplete=new Jr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const to=Ut(Pr.ROLES_OPTIONS,{mappings:{[Gt.QUESTION]:Gt.KEYWORDS}});class so extends Pr{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:to,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset({silent:!0}),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._writeWikiLinkTemplateToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||Qt}}}_defaultProcessData(e){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:n}={}}=t;return n?{...e,meta:{...e.meta,miso_id:n}}:e}(e=dr(e=super._defaultProcessData(e))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_updateDataInHub(e){switch(e.status){case es.INITIAL:case es.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),_r(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}Xr(so.prototype);const no={...Vr.ROLES_OPTIONS,members:[Gt.PRODUCTS,Gt.KEYWORDS,Gt.TOTAL,Gt.FACETS,Gt.SORT,Gt.MORE,Gt.ERROR]};class io extends Vr{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:no,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:g({...e._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(e){return _r(e=super._defaultProcessData(e)),e}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}}Object.assign(io,{ROLES_OPTIONS:no});class ro{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return io.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,n=this._getSubviews(s);if(!n._containers.has(e)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(e)){for(const n of e.components)if(s.containsElement(n))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}n.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const oo=Object.freeze({group:h.ASK,name:_.SEARCH,payload:{...Pr.DEFAULT_API_OPTIONS.payload,...Vr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),ao=Object.freeze({...Pr.DEFAULT_LAYOUTS,...Vr.DEFAULT_LAYOUTS,[Gt.QUERY]:[Si.type,{placeholder:""}],[Gt.QUESTION]:[Ui.type,{raw:!0}],[Gt.SOURCES]:[Gn.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:on,articleInfoBlock:un}}]}),co=Object.freeze({...Pr.DEFAULT_TRACKERS,...Vr.DEFAULT_TRACKERS}),lo=Object.freeze({...Vr.DEFAULT_PAGINATION,active:!0}),uo=Object.freeze({api:{group:h.ASK,name:_.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),ho=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),_o=Object.freeze({...Pr.DEFAULT_OPTIONS,...Vr.DEFAULT_OPTIONS,api:oo,layouts:ao,trackers:co,autocomplete:uo,pagination:lo,filters:ho}),po=Object.freeze({main:Gt.PRODUCTS,members:Object.keys(ao),mappings:Object.freeze({...Pr.ROLES_OPTIONS.mappings,...Vr.ROLES_OPTIONS.mappings})});class mo extends vr{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:po,defaults:_o})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new so(this),this._results=new io(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){this._views=new ro(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return e=this._answer._defaultProcessInteraction0(e,t),e=this._results._defaultProcessInteraction0(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}ys(mo.prototype,[ss.PAGINATION,ss.FILTERS]);const fo=Object.freeze({group:h.SEARCH,name:_.SEARCH,payload:{fl:["*"]}}),go=Object.freeze({api:{group:h.SEARCH,name:_.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),yo=Object.freeze({...Vr.DEFAULT_LAYOUTS}),bo=Object.freeze({...Vr.DEFAULT_TRACKERS}),wo=Object.freeze({...Vr.DEFAULT_OPTIONS,api:fo,autocomplete:go,layouts:yo,trackers:bo}),vo=Vr.ROLES_OPTIONS;class Eo extends Vr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:vo,defaults:wo})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=Gt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}Xr(Eo.prototype);class So extends Ss{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=Bt){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=Bt){return this._members.has(e)}get(e=Bt){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class ko extends vr{_initProperties(e){super._initProperties(e);const{id:t}=e;w(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return mr(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign(ko,{DEFAULT_API_OPTIONS:vr.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:vr.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:vr.DEFAULT_TRACKERS,DEFAULT_OPTIONS:vr.DEFAULT_OPTIONS,ROLES_OPTIONS:vr.ROLES_OPTIONS});const Oo=Object.freeze({...ko.DEFAULT_API_OPTIONS,group:h.RECOMMENDATION,name:_.USER_TO_PRODUCTS,payload:{...ko.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Io=Object.freeze({...ko.DEFAULT_LAYOUTS,[Gt.PRODUCTS]:Bn.type}),xo=Object.freeze({...ko.DEFAULT_TRACKERS,[Gt.PRODUCTS]:as}),Ao=Object.freeze({...ko.DEFAULT_OPTIONS,api:Oo,layouts:Io,trackers:xo}),To=Ut(ko.ROLES_OPTIONS,{main:Gt.PRODUCTS,members:Object.keys(Io)});class Co extends ko{constructor(e,t){super({name:"recommendation",context:e,roles:To,defaults:Ao,id:t})}start(){return this._request(),this}notifyViewUpdate(e=Gt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class Ro extends So{constructor(e,t){super("recommendations",e,t)}_create(e){return new Co(this,e)}}const No=Object.freeze({...ko.DEFAULT_API_OPTIONS,group:h.ASK,name:_.RELATED_QUESTIONS}),$o=Object.freeze({...ko.DEFAULT_LAYOUTS,[Gt.RELATED_QUESTIONS]:[Bn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Gt.QUERY]:[Si.type,{placeholder:"Ask a question"}]}),Po=Object.freeze({...ko.DEFAULT_TRACKERS,[Gt.RELATED_QUESTIONS]:as,[Gt.CONTAINER]:{...as,itemless:!0},[Gt.QUERY]:{[Kt.SUBMIT]:{active:!0}}}),Lo=Object.freeze({...ko.DEFAULT_OPTIONS,api:No,layouts:$o,trackers:Po}),Uo=Ut(ko.ROLES_OPTIONS,{main:Gt.RELATED_QUESTIONS,members:Object.keys($o)});class qo extends ko{constructor(e,t){super({name:"explore",context:e,roles:Uo,defaults:Lo,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(Gt.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return xr.prototype.useLink.call(this,e,t),t&&this.useLayouts({[Gt.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=Gt.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=xr.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}Ir(qo.prototype);class jo extends So{constructor(e,t){super("explores",e,t)}_create(e){return new qo(this,e)}}class Do extends re{constructor({name:e,plugin:t,MisoClient:s,...n}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new q)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var Mo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var zo=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Fo{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Bo{constructor(e){this._context=e,w(this,{lowerCamelToKebab:S,kebabToLowerCamel:v,kebabOrSnakeToLowerCamel:E})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...n}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=E(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:n=!1}){const{classPrefix:i}=e;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${t}-phrase">${this.phraseText(e,v(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,n=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof n){case"function":return n(e);case"string":return n;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${e}__${n}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const n=t[e];void 0!==n&&(s+=` ${S(e)}="${n}"`)}return s}}const Qo=V(new Bo({...Mo,DEFAULT_PHRASES:zo})),Go=V(new class extends Fo{constructor(){super({helpers:Qo})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=e;return n(e,{name:"related-resources"},!1===i.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:n={}}=e;return!1===n.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:Qo}));function Ho(e={}){const{normalizeOptions:t,section:s,container:n}=Qo,{querySuggestions:i,answerGroup:r}=Go;return s(e=t(e),{name:"follow-up"},[i(e),n(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(e)])}var Wo=Object.freeze({__proto__:null,helpers:Qo,sections:Go,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=Qo,{followUps:i,relatedResourcesSection:r,answerGroup:o}=Go;return""+s(e=t(e),{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},o(e))+i(e)+r(e)},followUp:Ho});const Vo=Object.freeze(Mo),Ko=Object.freeze(zo),Yo=Object.freeze(Wo);var Zo=Object.freeze({__proto__:null,constants:Vo,phrases:Ko,templates:Yo,wireFollowUps:function(e,t,{template:s=Ho,...n}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const i=e.ui.asks,r=e.ui.ask;i.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:e.workflow.questionId}))})),r.on("loading",(()=>{t.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:Jo}=document,Xo=Object.freeze({templates:Yo,autostart:!0}),ea=["templates","phrases","features"];class ta{constructor(){this._defaults=Xo,this._scriptSrc=function(){if(!Jo||!Jo.src)return{};const e=document.createElement("a");e.href=Jo.src;const t={};for(const[s,n]of new URLSearchParams(e.search))"q"!==s&&(t[s]=ia(n));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=ia(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:n,...i}={}){return g({apiKey:e,apiHost:t,templates:ra(s),phrases:n,...i})}(sa(this._defaults,this._scriptSrc,e,this._pageUrl))}}function sa(...e){let t={};for(const s of e)s&&(t=na(t,s));return t}function na(e,t){if(!t)return e;Object.assign(e,t);for(const s of ea)s in t&&(e[s]={...e[s],...t[s]});return e}function ia(e){return""===e||"false"!==e&&e}function ra(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(ra):function(e,t){const s={};for(const[n,i]of Object.entries(e))s[n]=t(i);return s}(e,ra);default:throw Error("Unsupported template type: "+e)}}class oa{constructor(e,{classPrefix:t=Vo.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");w(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class aa extends Do{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new ta,this._localOptions={}}config(e={}){e=sa(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;w(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new oa(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=e.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(t,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),l.autoQuery()}}class ca extends oe{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let la,ua,ha;async function _a(e){const t=await async function(e){return e.MisoClient||window.MisoClient||la||(la=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return ua=ua||t.any(),ha=ha||await ua,ha.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),ha}const da="logo",pa="auto",ma=Object.freeze([da]);function fa(e){if(!e)return pa;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class ga extends HTMLElement{static get observedAttributes(){return ma}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return fa(this.getAttribute(da))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case pa:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(da,t):this.removeAttribute(da)}async connectedCallback(){const e=this._client=await _a(ga);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===da)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){fa(e)!==fa(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const ya="parent-question-id",ba=Object.freeze([...ga.observedAttributes,ya]);const wa="unit-id",va=Object.freeze([...ga.observedAttributes,wa]);class Ea extends ga{static get observedAttributes(){return va}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute(wa)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(wa,e):this.removeAttribute(wa)}attributeChangedCallback(e,t,s){if(e===wa)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var Sa=Object.freeze({__proto__:null,MisoAskElement:class extends ga{static get tagName(){return"miso-ask"}static get observedAttributes(){return ba}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(ya)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(ya,e):this.removeAttribute(ya))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===ya)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Ea{static get tagName(){return"miso-explore"}static get observedAttributes(){return Ea.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends ga{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return ga.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends ga{static get tagName(){return"miso-search"}static get observedAttributes(){return ga.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Ea{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Ea.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const ka="role",Oa=Object.freeze([ka]);class Ia extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return Oa}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(ka);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ka}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${ka}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===ka&&this._container&&this._container._updateComponentRole(this,t,s)}}var xa=Object.freeze({__proto__:null,MisoComponentElement:Ia,MisoQueryElement:class extends Ia{constructor(){super({role:Gt.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Ia{constructor(){super({role:Gt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Ia{constructor(){super({role:Gt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Ia{constructor(){super({role:Gt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Ia{constructor(){super({role:Gt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Ia{constructor(){super({role:Gt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Ia{constructor(){super({role:Gt.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Ia{constructor(){super({role:Gt.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Ia{constructor(){super({role:Gt.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Ia{constructor(){super({role:Gt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Ia{constructor(){super({role:Gt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends Ia{constructor(){super({role:Gt.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Ia{constructor(){super({role:Gt.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Ia{constructor(){super({role:Gt.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Ia{constructor(){super({role:Gt.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Ia{constructor(){super({role:Gt.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Ia{constructor(){super({role:Gt.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Ia{constructor(){super({role:Gt.ERROR})}static get tagName(){return"miso-error"}}});class Aa extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Aa.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Ta=Object.freeze({__proto__:null,containers:Sa,roles:xa,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Aa{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Tn});const Ca="miso-hybrid-search-combo";var Ra=Object.freeze({__proto__:null,CLASS_PREFIX:Ca,CONAINER_TAG:"miso-hybrid-search"});const Na="Show more",$a="Show less";var Pa=Object.freeze({__proto__:null,question:"You asked â${value}â",sources:"Sources",keywords:"You searched for â${value}â",total:"${value} Results",showMore:Na,showLess:$a});const La=V(new Bo({...Ra,DEFAULT_PHRASES:Pa})),Ua=V(new class extends Fo{constructor(){super({helpers:La})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:La}));var qa=Object.freeze({__proto__:null,helpers:La,sections:Ua,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=La;e=t(e);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=Ua,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[i(e)]:r(e))+s(e,{name:"search-results"},o(e))}});const ja="answer-box-open",Da="answer-box-shown",Ma='[data-role="answer-box-toggle"]';class za{constructor(e,t,{classPrefix:s=Ca,phrases:n={},hideWhenUnanswerable:i=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=n,this._hideWhenUnanswerable=i,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Ma)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case es.ERRONEOUS:case es.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||$a:this._phrases.showMore||Na;for(const t of this._element.querySelectorAll(Ma))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const Fa={isOpen:ja,shown:Da},Ba={toggleOpen:["toggle",ja],open:["open",ja],close:["remove",ja],toggleHidden:["toggle",Da],show:["add",Da],hide:["remove",Da]};for(const[e,t]of Object.entries(Fa))Object.defineProperty(za.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(Ba))za.prototype[e]=function(){this._updateBoxStatus(t,s),s===ja&&(this._syncButtonText(),this._syncScroll())};const Qa=Object.freeze(Ra),Ga=Object.freeze(Pa),Ha=Object.freeze(qa);var Wa=Object.freeze({__proto__:null,constants:Qa,phrases:Ga,templates:Ha,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new za(e,t,s)}});const Va=Object.freeze(Zo),Ka=Object.freeze(Wa);var Ya=Object.freeze({__proto__:null,ask:Va,hybridSearch:Ka});const Za="ui";let Ja,Xa;async function ec(){return Xa||(Xa=z(Ja||(Ja=F(Za))))}class tc{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class sc{constructor(e,t){this._plugin=e,this._client=t,w(this,{sources:{api:sn(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Eo(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new mo(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class nc{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new aa(this._plugin,this._MisoClient))}}dt.plugins.use(class extends re{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new ca(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new q}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:Ya};b(s,this,["layouts","combo","ready"]),w(this,{MisoClient:e}),w(e,{ui:s}),this.combo=new nc(this,e);const n=Object.values(lr).filter((e=>e.type));for(const t of n)t.MisoClient=e;for(const e of n)this.layouts.register(e);const{containers:i,roles:r,combos:o,...a}=Ta,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];ga.MisoClient=e,Aa.MisoClient=e;for(const t of c)t.MisoClient=e;await ec();for(const e of c)A(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){w(e,{ui:new sc(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new tc(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Ro(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new jo(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new zr(this,e)),t}});const ic=5e3;let rc,oc,ac=!1;async function cc(e){return new Promise((t=>setTimeout((()=>{const e=N();dc("Fallback",e),t(e)}),e)))}async function lc(){const e=await ye((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&dc("GA4",e),e}async function uc(){const e=(await(rc||(rc=async function(){return ye((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&dc("UA",e),e}const hc="%cMiso",_c="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function dc(e,t){!function(...e){(r.indexOf("beta")>=0||"dev"===r)&&function(...e){console.log(hc,_c,...e)}(...e)}(`[${e}] Client ID: ${t}${ac?" (unused)":""}`),ac=!0}async function pc(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(dt,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||t.debug;n&&dt.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&dt.plugins.use("std:dry-run");return window.MisoClientSA=dt,dt}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const n=window.misoSA=new t(s);return n.context.anonymous_id=await async function(){return oc||(oc=Promise.any([lc(),uc(),cc(ic)]))}(),n}(e,{MisoClient:t});return await s.ui.ready,[t,s]}function mc(e){return t=>({...t,context:{...t.context,custom_context:{...fc(e),...t.context&&t.context.custom_context}}})}function fc({site:e,page:t,config:s,version:n}){return g({source:"miso-client-script",script_version:n,attribution:"miso-smart-answers",site:e.key,user_geo:s.geo,page_type:t.type,post_id:t.postId,uuid:N()})}let gc;async function yc(){return gc||(gc=async function(){const[[e,t]]=await Promise.all([pc(ke),he(ke)]);return{MisoClient:e,client:t}}())}function bc(e,{client:t}){const{site:s,page:n,config:i}=e,{product_id:r}=n,o=t.ui.explore;o.useApi(g({_meta:g({site:s.key,user_geo:i.geo}),product_id:r})),o.useLink((e=>"/smart-answers?q="+encodeURIComponent(e))),o.useInteractions({preprocess:mc(e)}),r?o.start():o.start({relatedQuestions:!1})}async function wc(e,{paragraphs:t=10}={}){const{debug:s}=e,n=(i=t,document.querySelectorAll(".article__main .article-column__content > p:not(:empty)")[i-1]);var i;if(!n)return void s("[Discovery] No block shown: cannot find the reference position for discovery block.");const{MisoClient:r,client:o}=await yc(),a=Ne(e);n.insertAdjacentElement("afterend",a),bc(e,{MisoClient:r,client:o,rootElement:a})}const vc=e=>{switch(e.key){case"cio_de":return"#cio-themen";case"computerwoche":return"#themen";default:return"#explore-a-topic"}};async function Ec(e){const{debug:t}=e,s=function({site:e}){const t=document.querySelector(vc(e));return t&&t.parentElement.parentElement}(e);if(!s)return void t(`[Discovery] No block shown: cannot find the reference position (${vc(e.site)}) for discovery block.`);const{MisoClient:n,client:i}=await yc(),r=$e(e);s.insertAdjacentElement("afterend",r),bc(e,{MisoClient:n,client:i,rootElement:r})}const Sc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',kc='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function Oc({className:e},{title:t,created_at:s,updated_at:n,published_at:i,custom_attributes:r={}}){const o=ge(r.site),a=i||s||n;let c="";t&&(c+=`<div class="${e}__item-title">${t}</div>`);const l=[];return o&&l.push(`<div class="${e}__item-site">${o.name}</div>`),a&&l.push(`<div class="${e}__item-date">${Ic(a)}</div>`),l.length>0&&(c+=`<div class="${e}__item-supplementals">${l.join("&nbsp;&nbsp;â¢&nbsp;&nbsp;")}</div>`),`<div class="${e}__item-info-container">${c}</div>`}function Ic(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}Object.freeze({ordered:!0,article:function(e,t,s,n){const{templates:i}=e,[r,o]=i.helpers.tagPair(e,s);return""+r+i.indexBlock(e,s,n)+Oc(e,s)+o},infoBlock:Oc}),Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,description:n,authors:i,created_at:r,updated_at:o,published_at:a,custom_attributes:c={}}){ge(c.site);const l=a||r||o;let u=`<div class="${e}__item-main-block">`;c.content_type&&(u+=`<div class="${e}__item-content-type">${c.content_type}</div>`);t&&(u+=`<div class="${e}__item-title">${t}</div>`);s?u+=`<div class="${e}__item-snippet">${s}</div>`:n&&(u+=`<div class="${e}__item-desc">${n}</div>`);u+=`</div><div class="${e}__item-supplementals-block">`,i&&(u+=`<div class="${e}__item-authors">By ${i}</div>`);l&&(u+=`<div class="${e}__item-date">${Ic(l)}</div>`);return u+="</div>",`<div class="${e}__item-info-container">${u}</div>`}});const xc="textarea.miso-search-box__input";function Ac(){const e=!this.value;e&&(this.value="What are you searching for?"),this.style.height="auto",this.style.height=this.scrollHeight-24+"px",e&&(this.value="")}function Tc(){const e=document.querySelector(xc);e&&(e.addEventListener("keyup",Ac),Ac.call(e))}const Cc="header #miso-search",Rc='.header__icon-button[data-menu-trigger="search"]',Nc='.header__menu-link[data-menu-trigger="search"]';function $c(e){const{searchParams:t}=new URL(window.location.href);return t.set("q",e),"/search/?"+t}async function Pc(e){const t=document.querySelector(Cc);if(!t)return;const n=[document.querySelector(Rc),document.querySelector(Nc)];if(e.page.type===s)return void n.forEach((e=>{e&&e.addEventListener("click",(()=>{const e=document.querySelector('.button[data-menu-close="search"]');e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()}))}));const{client:i}=await yc(),r=i.ui.hybridSearch;r.useLink($c,{open:!1}),r.autocomplete.enable(),t.classList.add("miso-hybrid-search-input"),t.innerHTML=`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${Sc}</span>\n        <textarea rows="1" class="miso-search-box__input" type="text" placeholder="What are you searching for?" autocomplete="off" data-role="input"></textarea>\n        <button class="miso-search-box__button" type="submit" data-role="submit">${kc}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim(),Tc()}async function Lc(e){const{page:t,debug:s,config:i}=e;switch(t.type){case"home":await Ec(e);break;case n:const{show_explore:r=!0}=i;if(!r)return;await wc(e);break;default:s("[Discovery] No discovery block for page type: "+t.type)}}(async e=>{switch(e.page.type){case t:case s:return}(function(e){const{version:t,debug:s}=e;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=t,s("Miso Smart Answers script version: "+t),!0)})(e)&&await Promise.all([Lc(e),Pc(e)])})(ke)}();
