!function(){"use strict";const t="home",e="answers",s="search",n="article",i="other",r=["cover_image","custom_attributes.site","custom_attributes.content_type","custom_attributes.contenthub_url","custom_attributes.byline","authors","created_at","product_id","published_at","snippet","title","updated_at","url"],o='type:article AND ((NOT custom_attributes.languages:*) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)';var a="0.9.35";var c=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const u={key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"},l=window.location.hostname!==u.hostname;var _={...u,dev:l};function h(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function d(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function p(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}let m;Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});try{m=document.currentScript}catch(t){}class f{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)h(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&h(s,e)}}_injectSubscribeInterface(t){!function(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}(t,this,["on","once"])}}function g(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(class{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:g(t,e),uuid:p()})}(t,e);!function(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new f({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}},"miso:component");const{currentScript:y}=document,b=y.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function w({}){await Promise.all([E()])}let v=!1;async function E(){if(v)return;if(v=!0,!y)throw Error("currentScript not found");const t=y.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}function O(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${b}/${t}`}const S=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"}].map((({logo_image:t,...e})=>({logo_image:O(t),...e}))),k=S.reduce(((t,e)=>(t[e.key]=e,t)),{});function T(t){return k[t]}async function x(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}var I=Object.freeze(function(){const r=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(r){case"":return{type:t};case"/smart-answers":return{type:e};case"/search":return{type:s};default:if(_.regions.indexOf(r.substring(1))>=0)return{type:t}}const a=r.substring(1).split("/");if("article"===a[0]){const t=""+a[1];return{type:n,postId:t,product_id:`article_${_.key}_${t}`}}return{type:i}}());const C="%cMiso",R="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const A=[];var N=function(){if(c.sponsor)return A.find((t=>t.key===c.sponsor))||void 0}(),$=Object.freeze({__proto__:null,config:c,version:a,site:_,page:I,sponsor:N,debug:function(...t){(c.debug||a.indexOf("beta")>=0||"dev"===a)&&function(...t){console.log(C,R,...t)}(...t)}}),P="1.11.4-beta.3";function U(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const L=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),q=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var j=Object.freeze({__proto__:null,GROUP:L,NAME:q});function D(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function M(t){return null!=t?""+t:t}function z(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function F(t){return null==t}function B(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function Q(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}class G{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);W(s),W(n),W(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>H(this,t)),e):H(this,t),this._value=t}disconnect(){this._active=!1}}function H(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function W(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function K(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function Y(t,e){const s=V((()=>window.localStorage.getItem(t))),n=V((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,r=e.indexOf(";",i);return decodeURIComponent(0>r?e.substring(i):e.substring(i,r))}(t))),i=s||n||""+e();return i&&!s&&V((()=>window.localStorage.setItem(t,i))),i&&!n&&V((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i))),i}function V(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}class Z{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class X{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new Z),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}let J;try{J=document.currentScript}catch(t){}const tt=Symbol.for("miso:resources");class et{constructor(){this._resources=new Map;const t=window[tt]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){st(this._resources,t).resolve(e)}async get(t){return st(this._resources,t).promise}}function st(t,e){if(t.has(e))return t.get(e);const s=new Z;return t.set(e,s),s}function nt(){return window[tt]||(window[tt]=new et)}class it{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new Z;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class rt{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)D(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&D(s,e)}}_injectSubscribeInterface(t){B(t,this,["on","once"])}}function ot(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class at{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:ot(t,e),uuid:K()})}(t,e);Q(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new rt({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(at,"miso:component");class ct extends at{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new Z);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class ut{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const lt=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class _t{constructor(t,e){this._client=t,this._root=e,this._bulk=new it(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,z({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),_=await l.json();if(l.status>=400||_.errors){var h=Error(_.message);throw h.data=_,h.status=l.status,h}return _}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:r,body:o}=n[e];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=lt.DATA_ENDPOINT,eventEndpoint:s=lt.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){(t._error||console.error)(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){(t._error||console.error)(e)}return n}}class ht extends at{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,r)}_postprocess({response:t}){return t.data}}const{GROUP:dt,NAME:pt}=j;class mt extends ht{constructor(t){super(t,dt.INTERACTIONS)}async upload(t,e){try{return await this._run(pt.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===pt.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}class ft{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new ut(s);let r;e=U(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const _=new X;return o=setInterval((async()=>{let e,o,h;try{if([e,o,h]=await t(r?{signal:r}:{}),u||!F(a)&&a>=h)return;F(h)||(a=h),i&&i(e,o,h),c=0}catch(t){return n&&n(t),c++,void(c>s&&(l(),_.error(t)))}_.update(e,o),o&&l()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),_.abort(r.reason)})),_}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?i.clear():this._isUpdated(r,t)&&i.touch(),r=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class gt extends ft{constructor(t,e,s,n){super(n),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:yt,NAME:bt}=j;class wt extends ht{constructor(t){super(t,yt.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new vt(this,t,e);const s=await this._run(bt.QUESTIONS,t,e);return new vt(this,s,e)}async _questions(t,e){return this._run(bt.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${bt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(bt.RELATED_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(bt.SEARCH,t,e);return s.question_id?new Et(this,s,e):s}async _searchGet(t,e){return this._run(`${bt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(bt.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(bt.SEARCH_AUTOCOMPLETE,t,e)}}class vt extends gt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class Et extends gt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),Q(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:Ot,NAME:St}=j;class kt extends ht{constructor(t){super(t,Ot.SEARCH)}async search(t,e){return this._run(St.SEARCH,t,e)}async autocomplete(t,e){return this._run(St.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(St.MGET,t,e)}}const{GROUP:Tt,NAME:xt}=j;class It extends ht{constructor(t){super(t,Tt.RECOMMENDATION)}async userToProducts(t,e){return this._run(xt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(xt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(xt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(xt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(xt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(xt.PRODUCT_TO_PRODUCTS,t,e)}}class Ct extends at{constructor(t,e){super("api",t),this._client=t,this.helpers=new _t(t,e),this.interactions=new mt(this),this.ask=new wt(this),this.search=new kt(this),this.recommendation=new It(this)}}var Rt=Object.freeze({__proto__:null,Api:Ct,ApiBase:ht,ApiHelpers:_t,Interactions:mt,Ask:wt,Search:kt,Recommendation:It});class At extends at{constructor(t){super("context",t),this._client=t}}var Nt={api:Rt,context:{Context:At}};class $t{constructor(t){Q(this,{install:t})}}class Pt extends ct{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Ut(this,Nt),this.plugins=new Lt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new Z);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return Q(n,{id:t}),this._tryConfig(n,e),n;case"function":return new $t(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,r=t.lastIndexOf("/",i)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,i);return`${t.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new nt).get(s);!this.isRegistered(t)&&this.register(n)}}class Ut{constructor(t,e){B(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),Q(this,{classes:e})}}class Lt{constructor(t){B(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const qt=new class extends at{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Pt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=P,this._cmdRes=new Z}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var jt=Object.freeze({__proto__:null,viewable:async function(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,r)=>{const o=new G((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))},debounce:function(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}});const{currentScript:Dt}=document;class Mt extends at{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Mt),window.MisoClient?window.MisoClient!==Mt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Mt}static debug(){}constructor(t){super("client",qt),this._config(t),this.context=new At(this),this.api=new Ct(this,qt),function(t){qt._clients.push(t),qt._events.emit("create",t)}(this)}get version(){return Mt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,z(t)}_readConfigFromScriptUrl(){return z({apiKey:new URL(new Request(Dt.src||Dt.href).url).searchParams.get("api_key")||void 0})}}Mt.helpers=jt,Q(Mt,{uuid:K()});var zt=function(t){const e=qt._pluginRoot;return qt.MisoClient=e.MisoClient=t,B(t,qt,["version","instances","any","meta","on","once","cmdDone"]),B(t,e,["plugins"]),t}(Mt);const{GROUP:Ft,NAME:Bt}=j;let Qt;class Gt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||Qt||(Qt=Y("miso_anonymous_id",K))}set anonymous_id(t){t=M(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=M(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Ht(){const t=new URLSearchParams(window.location.search);let e=z({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Wt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Kt(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:P};return s.uuid||(s.uuid=K()),{...t,context:{...e,custom_context:s}}}const Yt="std:native-fetch";let Vt,Zt;const Xt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Vt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Vt="borrowed",t.contentWindow.fetch}catch(t){Zt=t}})();function Jt(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function te(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var ee="1.11.4-beta.3";let se;try{se=document.currentScript}catch(t){}async function ne(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(ie(t))return;return new Promise((e=>{let s;s=setInterval((()=>{ie(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function ie(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function re(t,{depth:e=5,...s}={}){return oe(t,e)}function oe(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>oe(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=oe(i,e-1)))}return n}(t,e):t:"(...)"}class ae{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)Jt(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&Jt(s,e)}}_injectSubscribeInterface(t){!function(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}(t,this,["on","once"])}}function ce(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(class{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:ce(t,e),uuid:te()})}(t,e);!function(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new ae({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}},"miso:component");const ue="miso-logdump",le="miso-logdump",_e=le+"__download-btn",he="Miso Log";class de{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return ge||(ge=ne((t="logdump",`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${ee}/dist/css/${t}.css`)));var t}();let t=document.getElementById(ue);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||he,e.classList.add(_e),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=ue,t.classList.add(le),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(ue),e=t&&t.querySelector("."+_e);e&&(e.textContent=this._options.logDownloadButtonText||he)}hideDownloadButton(){const t=document.getElementById(ue);t&&(t.style.display="none")}download(){const t=new Blob([me(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:pe()})}return t&&"string"==typeof t?t:`miso-log.${pe()}.jsonl`}clear(){this._logs=[]}}function pe(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function me(t){return t.map((t=>JSON.stringify(re(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),fe(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function fe(t){return t?re(t,{depth:2}):t}let ge;const ye="std:debug";function be(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}zt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new de(t)}static get id(){return ye}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(ye,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(be)):this._log(t,e,be(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return Yt}install(t,e){Xt?(e.setCustomFetch(Xt),t.debug(`<plugin:${Yt}>`,"[info]",`Using ${Vt} native fetch`)):t.debug(`<plugin:${Yt}>`,"[error]","Failed to obtain native fetch: "+Zt.message)}}),zt.plugins.use(class extends at{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Gt(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return e===Ft.INTERACTIONS&&s===Bt.UPLOAD?this._modifyPayloadForInteractions(t,n):e===Ft.ASK&&s===Bt.QUESTIONS?this._modifyPayloadForAsk(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=z({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),zt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...z({page:z({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:Ht()}),...t.context}})))}}}),zt.plugins.use(class extends at{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Wt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===L.SEARCH)if(s===q.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),zt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Kt)}}}),zt.plugins.use(class extends at{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case L.SEARCH:case L.RECOMMENDATION:return!0}return!1}});const we=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),ve=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});function Ee(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function Oe(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function Se(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function ke(t){return null==t}function Te(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function xe(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function Ie(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function Ce(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function Re(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class Ae{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);$e(s),$e(n),$e(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>Ne(this,t)),e):Ne(this,t),this._value=t}disconnect(){this._active=!1}}function Ne(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function $e(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function Pe(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function Ue(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function Le(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function qe(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,r)=>{const o=new Ae((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function je(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function De(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function Me(t){return new ze(t)}class ze{constructor(t){this._value=t;const e=t=>{this._value=t};xe(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class Fe{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}var Be="1.11.4-beta.3";let Qe;try{Qe=document.currentScript}catch(t){}async function Ge(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(He(t))return;return new Promise((e=>{let s;s=setInterval((()=>{He(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function He(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function We(t,e){const s=Object.getOwnPropertyDescriptors(e),n=Object.getOwnPropertyDescriptors(t);for(const[e,i]of Object.entries(s))"constructor"!==e&&void 0===n[e]&&Object.defineProperty(t,e,i)}function Ke(t){const e={},s=new Set;for(let n=t;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(e[n]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}const Ye=100,Ve=4;function Ze(t){const e=function({speed:t=Ye,acceleration:e=Ve}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const r=e(n,s);return t+Math.max(i-n,0)*r/1e3}}class Xe{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)Ee(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&Ee(s,e)}}_injectSubscribeInterface(t){Te(t,this,["on","once"])}}function Je(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class ts{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:Je(t,e),uuid:De()})}(t,e);xe(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new Xe({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(ts,"miso:component");class es extends ts{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new Fe);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class ss{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new Ae(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}function ns(t,e){return Object.freeze({...t,...e,members:is(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function is(t=[],e=[]){return[...new Set([...t,...e])]}function rs(t,e){let s={};for(const n of t)n&&(s=e(s,n));return Se(s)}function os(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...as("_meta",s,n)})});var s,n}))}function as(t,e,s){const n=e&&e[t],i=s&&s[t],r=n?i?{...n,...i}:n:i;return void 0!==r?{[t]:r}:{}}const cs="data-miso-product-id",us="default",ls="_organic",_s=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),hs=new Set([_s.PRODUCTS,_s.CATEGORIES,_s.ATTRIBUTES,_s.RESULTS,_s.ITEMS,_s.QUESTION,_s.ANSWER,_s.SOURCES,_s.RELATED_RESOURCES,_s.QUERY_SUGGESTIONS,_s.RELATED_QUESTIONS,_s.AFFILIATION,_s.FACETS,_s.TOTAL]);function ds(t){return hs.has(t)}const ps=new Set([_s.PRODUCTS,_s.SOURCES,_s.RELATED_RESOURCES]);const ms=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),fs=[ms.IMPRESSION,ms.VIEWABLE,ms.CLICK,ms.SUBMIT,ms.FEEDBACK],gs=[ms.IMPRESSION,ms.VIEWABLE,ms.CLICK],ys=new Set(gs);const bs=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),ws=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function vs(t){if(0>fs.indexOf(t))throw Error("Unrecognized event type: "+t)}const Es=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function Os(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function Ss(t){if(void 0===t)return;let[e,s]=Oe(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function ks(t,e){return!1===(e=Ss(e))[0]?e:t&&e?[e[0]||t[0],Ts(t[1],e[1])]:e||t}function Ts(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function xs(t={},e={}){return!1===e||!1===t?e:{...t,...e}}const Is=function(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t};const Cs=[{key:Es.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return Se({group:s,name:t,payload:e})},merge:os},{key:Es.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${_s.PRODUCTS}: ... }) instead`),t={...s,[_s.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[Os(e)]=Ss(s);return n},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=ks(t[s],n);return t}))}},{key:Es.DATA_PROCESSOR,normalize:function(t){t=Oe(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:Es.TRACKERS,normalize:function(t){if(void 0===t||!1===t)return t;const e={};for(const[s,n]of Object.entries(t))e[s]=n;return e},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>Object.assign(t,{...e,impression:xs(t.impression,e.impression),viewable:xs(t.viewable,e.viewable),click:xs(t.click,e.click)})))}},{key:Es.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=Oe(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:Es.FILTERS,normalize:Is,merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>Object.assign(t,e)))}},{key:Es.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&rs(t,((t,e)=>Object.assign(t,e)))}}];class Rs{constructor(){this._events=new Xe({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class As{constructor(t={},e={}){this._events=new Xe({target:this}),this._defaults=e,this._context=t||{},this._locals={},xe(this,{resolved:new Ns(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ns{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,n=s._context[t];this._cache[t]=e(s._defaults[t],n&&n.get(),s._locals[t])}return this._cache[t]}}class $s{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Cs){const{key:e,normalize:s,merge:n}=t;Object.defineProperty(Rs.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new $s(this,this._globals,e,s,n))}}),Object.defineProperty(As.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new $s(this,this._locals,e,s,n))}}),Object.defineProperty(Ns.prototype,e,{get:function(){return this._get(t)}})}const Ps=[Es.API,Es.LAYOUTS,Es.DATA_PROCESSOR,Es.TRACKERS,Es.INTERACTIONS];function Us(t,e=Ps){for(const s of e)Ls(t,s)}function Ls(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}class qs extends ts{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Rs}}function js(t){return t?"view:"+t:"view"}Us(qs.prototype);class Ds{constructor(){(this._events=new Xe)._injectSubscribeInterface(this),this._states={},xe(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class Ms{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:De(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function zs(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Fs{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},r=await this._source({session:e,...t,options:i});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:n,value:r._response}),r)){if(!zs(this._hub,e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){zs(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Bs{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{Ee(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Qs,VIEWABLE:Gs,CLICK:Hs}=ms,{UNTRACKED:Ws,TRIGGERED:Ks}=bs,Ys=Object.freeze({[Qs]:Ws,[Gs]:Ws,[Hs]:Ws});class Vs{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ys}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Ws}set(t,e,s){vs(e),function(t){if(t!==bs.UNTRACKED&&t!==bs.TRACKING&&t!==bs.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of Oe(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Ks))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...Ys}))))[e]=s}}const Zs=[Symbol("valueless")];class Xs{constructor({hub:t,role:e,valueless:s=!1}){this._hub=t,this._role=e,this._valueless=!!s,this._states=new Vs(this._getSessionId())}getState(t){return this._states.getFullState(t)}_trigger(t,e){vs(t),this._valueless&&(e=Zs),this._syncSession(),0!==(e=this._states.untriggered(Oe(e),t)).length&&(this._states.set(e,t,bs.TRIGGERED),this._sendToHub({type:t,items:this._valueless?void 0:e}))}submit({value:t}){this._syncSession(),this._sendToHub({type:ms.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(Se({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new Vs(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[js(this._role)]}}for(const t of gs)Xs.prototype[t]=function(e,s){this._trigger(t,e,s)};class Js{constructor(t,e){this._events=new Xe({target:this}),this._views=t,this._mapping=function(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}((t._roles.mappings||{})[e]||e),xe(this,{role:e,interface:new tn(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Bs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===_s.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Xs({hub:e,role:t})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((i=e)===(r=n)||i&&r&&i.status===r.status&&i.error===r.error&&i.value===r.value&&i.ongoing===r.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(i.session,r.session)))return;var i,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:_}=e,h={session:o,status:a,ongoing:c,request:u,meta:l,data:_,...en(e)},d=(t={},e)=>{!1!==t&&this.updateState({...h,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:d})}catch(t){this._error(t),d({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?ws.ERRONEOUS:t.status;t=this._state=Object.freeze(Se({...t,status:s}));const{role:n}=this;this.hub.update(js(n),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:n,meta:i,...r}=t,o={value:this._mapping(t,this),status:n,data:e,meta:i,...r};return this.role===_s.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(e)}),Se(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!ds(s))return!1;let e=t&&t[s];if(s===_s.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class tn{constructor(t){Te(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function en(t){return function(t){return t.status===ws.READY&&!t.ongoing}(t)?{empty:!!sn(t)}:{}}function sn(t){const{value:e}=t;return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}function nn(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class rn{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new Xe({target:this,error:s}),xe(this,{facets:new on(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return Se({facets:Object.freeze({}),sort:nn(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(Se({...t,...e,facets:Object.freeze(Se({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset(){const t=this.states;this._states=void 0;const e=this._getStates();this._events.emit("reset",{states:e,oldStates:t})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class on{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){const s=this._filters._states.facets[t];return s&&s.includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_select(t,e){const s=this._options.multivalued?[...this._filters._states.facets[t]||[],e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._filters._states.facets[t].filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const an=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function cn(t,e){return!!e&&{...t,...e}}class un{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i,options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=r,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._trackers=new _n(this,i.members),this._filters=new rn(this);for(const t of i.members)t!==_s.CONTAINER&&(this._views[t]=new Js(this,t));xe(this,{interface:new ln(this)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on("data",(t=>this.refresh({data:t}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get trackers(){return this._trackers}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new Js(this,_s.CONTAINER);e.layout=this._createLayout(_s.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===_s.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:n}=e._inst;t&&(s=s.filter((e=>e.role===_s.CONTAINER||t.includes(e.role)))),n&&(s=s.filter((t=>!n.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return Se({...an,...i,impression:cn(an.impression,e),viewable:cn(an.viewable,s),click:cn(an.click,n)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=_s.CONTAINER;this._containerTracker=new Xs({hub:this._hub,role:t,valueless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class ln{constructor(t){this._actor=t,Te(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class _n{constructor(t,e){this._views=t;for(const s of e)s!==_s.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,_s.CONTAINER,{get:()=>t._getContainerTracker()})}}class hn{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:ms.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class dn{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=Oe(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function pn(t){return async({group:e,name:s,payload:n,options:i})=>{if(e===we.ASK)switch(s){case ve.QUESTIONS:return t.api.ask.questions(n,i);case ve.SEARCH:return t.api.ask.search(n,i)}return t.api[e]._run(s,n,i)}}class mn{constructor({role:t,workflow:e,...s}={}){xe(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=Me(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,Le((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),r=Me([]),o=Me({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function fn(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function gn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||wn)(t,e,s)+(i.descriptionBlock||En)(t,e,s)+(i.priceBlock||Sn)(t,e,s)+(i.ctaBlock||In)(t,e,s)}</div>`}function yn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||wn)(t,e,s)+(i.descriptionBlock||En)(t,e,s)+(i.priceBlock||Sn)(t,e,s)}</div>`}function bn(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||wn)(t,e,s)+(i.dateBlock||On)(t,e,s)+(i.descriptionBlock||En)(t,e,s)+(i.ctaBlock||In)(t,e,s)}</div>`}function wn({className:t},{title:e}){return e?`<div class="${t}__item-title">${je(e)}</div>`:""}function vn({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function En({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${je(s)}</div>`:""}function On({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${t}__item-date">${Nn(r,e.date)}</div>`:""}function Sn(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:r,currency:o="USD"}=e,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,u=e.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||kn)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function kn(t,{discount_rate_percent:e}){return`(${e}% off)`}function Tn(t,e,s={}){const{className:n,templates:i}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${n}__item-cover-image-container">${`<img class="${n}__item-cover-image" src="${r}">`}${s.brand?(i.brandBlock||vn)(t,e,s):""}</div>`}function xn({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function In(t,e,s){const{className:n,templates:i}=t,r=$n.asFunction(i.cta)(t,e,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function Cn({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&n?"a":"div";return[`<${l} class="${t}__${i}" ${r?`data-role="${r}"`:""} ${s?`${cs}="${s}"`:""} ${!1!==o.link&&n?`href="${n}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const Rn=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),An="en-US";function Nn(t,e=Rn){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Rn.locale,e);default:throw Error("Invalid date format: "+e)}}const $n=Object.freeze({tagPair:Cn,formatDate:Nn,formatNumber:function(t,e=An){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||An.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:je,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Pn extends mn{constructor({className:t,templates:e,...s}={}){super(s),xe(this,{className:t,templates:{...fn("root"),...e,helpers:$n}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Un extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Un.MisoClient.ui.layouts.create("banner").render(this)}}class Ln{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await qe(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class qn extends mn{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ln}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Un.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===_s.PRODUCTS||t===_s.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1}={}}=e,o=[s,r?ws.EMPTY:ws.NONEMPTY];s===ws.READY&&o.push(n?ws.ONGOING:ws.DONE),t.setAttribute("status",o.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===ws.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.trackerOptions||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.trackerOptions||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const jn=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:r}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Dn extends Pn{static get type(){return"error"}static get defaultTemplates(){return jn}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...jn,...e},...s})}}const Mn=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function zn(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class Fn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});n.set(a,u),i.set(c,u),r.push(u)}return{k2b:n,e2b:i,entries:r}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=zn(i,n),o=zn(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function Bn(t){We(t,Qn.prototype)}class Qn{_initTrackable(){this._bindings=new Fn,this._viewables=new Ln}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.trackerOptions||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.trackerOptions||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.trackerOptions||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!Pe(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class Gn{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===ws.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let n=!1;try{await qe(e,{area:1,duration:0,signal:s.signal}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Hn=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[r,o]=Cn(t,s);return""+r+(i.imageBlock||Tn)(t,s,n)+(i.infoBlock||i.productInfoBlock||yn)(t,s,n)+o},article:function(t,e,s,n){const{templates:i}=t,[r,o]=Cn(t,s);return""+r+(i.imageBlock||Tn)(t,s,n)+(i.infoBlock||i.articleInfoBlock||bn)(t,s,n)+(i.indexBlock||xn)(t,s,n)+o},question:function(t,e,s){const[n,i]=Cn(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e;return`<div class="${s} ${r}" ${n?`data-role="${n}"`:""}>${r===ws.READY?i[r](t,e):""}${i.trigger(t,e)}${i.loading(t,e)}</div>`},[ws.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0||e.ongoing?s.list(t,e,n):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:n,templates:i,options:r}=t,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list" data-item-type="${r.itemType}">${i.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let r=n;return s.map((s=>i.item(t,e,s,r++))).join("")},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item">${r[a](t,e,s,{index:n})}</li>`},productInfoBlock:yn,articleInfoBlock:bn,brandBlock:vn,titleBlock:wn,descriptionBlock:En,dateBlock:On,priceBlock:Sn,discountRateText:kn,ctaBlock:In,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[r,o]=Cn(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=$n.asFunction(n.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Tn,indexBlock:xn,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Wn extends Pn{static get defaultTemplates(){return Hn}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Hn,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Bn(Wn.prototype),We(Wn.prototype,Gn.prototype);const Kn="miso-list";class Yn extends Wn{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Kn}constructor({className:t=Kn,...e}={}){super({className:t,...e})}}const Vn="miso-cards";const Zn="miso-carousel",Xn=Object.freeze({ready:function(t,e){const{templates:s}=t,n=t._getItems(e),i=n&&n.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-previous" data-role="previous">${i.previous(t,e)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(t,e)}</div>`},previous:ti,next:ti}),Jn=Object.freeze({...Wn.defaultTemplates,...Xn});function ti(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const ei="miso-ui-icon",si=ei+"-svg-1_11_4-beta_3",ni={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},ii=`<symbol id="${ei}-${ni.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ri=`<symbol id="${ei}-${ni.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,oi=`<symbol id="${ei}-${ni.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,ai=`<svg id="${si}" style="display:none;">${[ii,ri,oi].join("")}</svg>`;let ci=!1;function ui(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${ei}-${t}"></use></svg>`}ci||document.head.querySelector("#"+si)||(ci=!0,document.head.insertAdjacentHTML("beforeend",ai));const li=new Set(Object.values(ni));ui(ni.SEND),ui(ni.SEARCH);const _i=ui(ni.TRIANGLE),hi="miso-search-box";const di=Object.freeze({root:function(t){const{className:e,templates:s,role:n,options:i,autocomplete:r}=t,{placeholder:o}=i;return`\n<div class="${e}" ${n?`data-role="${n}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=e;var r;return("function"==typeof n?n(t):""+n)+("function"==typeof i?i(t):(li.has(r=i)?ui(r):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`<ul class="${n}__${e}-list" data-role="${e}-list">${s.map((s=>i.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||je(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=s.helpers.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:Tn,productInfoBlock:yn}),pi=Object.freeze({className:"miso-autocomplete",debounce:300});class mi extends Pn{static get type(){return"search-box"}static get defaultTemplates(){return di}static get defaultClassName(){return hi}constructor({className:t=hi,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...di,...e},...n}),xe(this,{autocomplete:{...pi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=function(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=ws.INITIAL,session:r,value:o}=e.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(t),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);t.classList[l.length>0?"add":"remove"]("nonempty"),u.setAttribute("data-status",i),u.innerHTML=this.templates.completions(this,l),n({completions:{index:a,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return fi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new fi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&Pe(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ms.SUBMIT]:e}=this._view.trackerOptions||{};e&&this._view.tracker.submit({value:t})}}class fi{static empty(){return fi._empty||(fi._empty=new fi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const r of t[i])r.product&&!r.product.url||(r._index=e,r._field=i,s.set(e,r),n.push(r),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const gi="miso-option-list";const yi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${je(e.text||e)}</li>`}});class bi extends Pn{static get type(){return"option-list"}static get defaultTemplates(){return yi}static get defaultClassName(){return gi}constructor({className:t=gi,templates:e,...s}={}){super({className:t,templates:{...yi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncOptionValues(t,n)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const n=this._getItems(e)||[];s.classList[0===n.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._submit(n.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}Bn(bi.prototype);const wi=Object.freeze({...fn("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class vi extends Pn{static get defaultTemplates(){return wi}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...wi,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=Pe(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],Le((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Ei="miso-feedback",Oi=["helpful","unhelpful"];const Si=Object.freeze({options:function(t){const{templates:e}=t;return Oi.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class ki extends vi{static get type(){return"feedback"}static get defaultTemplates(){return Si}static get defaultClassName(){return Ei}constructor({className:t=Ei,templates:e,...s}={}){if(super({className:t,templates:{...Si,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Ti="miso-text";const xi=Object.freeze({root:function(t,{value:e}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=t,o=n?`data-role="${n}"`:"",a=void 0!==e?je(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:n}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[i,r]=e;switch(i){case"date":return t=>s(t,r);case"number":return t=>n(t,r);default:return t=>""+t}}(t)(e)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Ii extends Pn{static get type(){return"text"}static get defaultTemplates(){return xi}static get defaultClassName(){return Ti}constructor({className:t=Ti,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...xi,...e},tag:s,...n})}}class Ci extends mn{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=Me(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class Ri{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function Ai(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,Ni(e)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||ws.INITIAL),n}function Ni(t){return t+"__cursor"}function $i(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${Pi(n[0])}, ${Pi(n[1])})`,e,""+r,i,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function Pi(t){return Math.floor(100*t)/100+"ms"}const Ui="miso-typewriter";class Li extends Ci{static get type(){return"typewriter"}static get defaultClassName(){return Ui}constructor({className:t=Ui,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:n,...a}),xe(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:Ze({speed:i,acceleration:r}),this._readiness=new Fe,"markdown"===s&&Li.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=Ni(this.className),{onDebug:s,onCitationLink:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:$i(s)}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new Ri}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const _=e?c&&a===e.stage?e.streak:e.streak+1:0,h=c&&e&&e.doneAt||(r!==ws.READY||o?void 0:Date.now());return this._prevState=Object.freeze(Se({session:i,status:r,value:s,stage:a,streak:_,doneAt:h,done:void 0!==h}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=Ai(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}i(a);const u=e.status===ws.READY&&!a.done;n({ongoing:u},{silent:u&&(!s||s.status===ws.READY)&&!c}),u&&r()}_onClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}const qi="miso-affiliation";const ji=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e,o=n?` data-role="${n}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===ws.READY?i[r](t,e):""}</div>`},[ws.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return _i},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(t,e,s,{index:n})}${r[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=$n.asFunction(o)(t,e,s,n),a=$n.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[r,o]=Cn(t,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||gn)(t,s,n)+(i.imageBlock||Tn)(t,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:r}=t,o=$n.asFunction(r.logoText)(t,e,s,n)||"",a=$n.asFunction(r.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:r}=t,o=$n.asFunction(r.logoUrl)(t,e,s,n);if(!o)return"";const a=$n.asFunction(r.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Di=Object.freeze({...Wn.defaultTemplates,...ji});class Mi extends Wn{static get type(){return"affiliation"}static get defaultTemplates(){return Di}static get defaultClassName(){return qi}constructor({className:t=qi,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...ji,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.trackerOptions||{};this._viewable=new ss(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,Le((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(this._displayedCount=s,void 0===s?n.removeAttribute("data-item-count"):n.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const zi="miso-facets",Fi="miso-facet",Bi="custom_attributes.";const Qi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:n={}}=e.value||{};return Object.keys(n).map((i=>s.facet(t,{field:i,entries:n[i]},e)))},facet:function(t,e,s){const{facetClassName:n=Fi,templates:i}=t,{field:r}=e;return`<div class="${n}" data-role="facet" data-field="${je(r)}">${i.header(t,e,s)}${i.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:n=Fi,templates:i}=t;return`<div class="${n}__header">${i.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(Bi)&&(e=e.substring(18)),je(e)},options:function(t,{field:e,entries:s},n){const{facetClassName:i=Fi,templates:r}=t;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(t,{field:e,value:s,count:i},n))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:n=Fi,templates:i}=t;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(t,e,s)}</span>\n  <span class="${n}__count">${i.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return je(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function Gi(t,e){return`${t}:::${e}`}function Hi(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class Wi extends Pn{static get type(){return"facets"}static get defaultTemplates(){return Qi}static get defaultClassName(){return zi}constructor({className:t=zi,templates:e,...s}={}){super({className:t,templates:{...Qi,...e},...s}),this._bindings=new Fn}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=Hi(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)this._setSelected(n,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=Hi(t.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)e[t]&&this._setSelected(n,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),n=[],i=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;n.push(Gi(t,c)),i.push({field:t,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[je(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Ki="miso-select";const Yi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,r=n?`data-role="${n}"`:"",o=t._getItems(e),a=o.find((t=>t.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${i.button(t,a)}\n  ${i.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:n}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:n}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>n.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:n}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${n.text(t,e)}</li>`},text:function(t,e){return je(e&&e.text&&e.text.replace(/[-_][a-zA-Z]/g," $1")||e||"")}});class Vi extends Pn{static get type(){return"select"}static get defaultTemplates(){return Yi}static get defaultClassName(){return Ki}constructor({className:t=Ki,templates:e,...s}={}){super({className:t,templates:{...Yi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}Bn(Vi.prototype);const Zi="miso-more-button";const Xi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${e.status!==ws.READY?" disabled":""}>\n  ${i.text(t)}\n</div>\n`},text:function(t){return"More"}});class Ji extends Pn{static get type(){return"more-button"}static get defaultTemplates(){return Xi}static get defaultClassName(){return Zi}constructor({className:t=Zi,templates:e,...s}={}){super({className:t,templates:{...Xi,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var tr=Object.freeze({__proto__:null,TemplateBasedLayout:Pn,ContainerLayout:qn,ErrorLayout:Dn,BannerLayout:class extends Pn{static get type(){return"banner"}static get defaultTemplates(){return Mn}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Mn,...e},...s})}},CollectionLayout:Wn,ListLayout:Yn,CardsLayout:class extends Wn{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Vn}constructor({className:t=Vn,...e}={}){super({className:t,...e})}},CarouselLayout:class extends Wn{static get type(){return"carousel"}static get defaultTemplates(){return Jn}static get defaultClassName(){return Zn}constructor({className:t=Zn,templates:e,...s}={}){super({className:t,templates:{...Xn,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:n}=e,i=this._getItems(n);this._itemCount=i?i.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:mi,OptionListLayout:bi,FeedbackLayout:ki,TextLayout:Ii,TypewriterLayout:Li,AffiliationLayout:Mi,FacetsLayout:Wi,SelectLayout:Vi,MoreButtonLayout:Ji});function er(t){return t&&t.value&&t.value.revision}function sr(t){const e=function(t){if(!t)return ws.INITIAL;const{request:e,error:s,value:n}=t;return s?ws.ERRONEOUS:n?ws.READY:e?ws.LOADING:ws.INITIAL}(t);return Se({status:e,ongoing:e===ws.READY?t.ongoing:void 0,...t})}function nr(t){const{request:e,value:s}=t;if(!e)return t;const{payload:n}=e||{},{q:i}=n||{};return i?{...t,value:{...s,keywords:i}}:t}function ir(t){const{role:e,type:s,items:n}=t,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:Se({property:e})}};switch(function(t){return ys.has(t)}(s)&&(!function(t){return ps.has(t)}(e)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((t=>t.text||t.id||t))):i.product_ids=(n||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case ms.SUBMIT:i.context.custom_context.value=t.value;break;case ms.FEEDBACK:i.context.custom_context.value=i.value=t.value,i.context.custom_context.result_type=i.result_type=t.result_type}return Se(i)}function rr(t={},e={}){return Se({...t,...e,context:Se({...t.context,...e.context,custom_context:Se({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const or=Object.freeze({}),ar=Object.freeze({[_s.CONTAINER]:qn.type,[_s.ERROR]:Dn.type}),cr=Object.freeze({}),ur=Object.freeze({api:or,layouts:ar,trackers:cr}),lr=Object.freeze({mappings:{[_s.ERROR]:t=>t.error}});class _r extends ts{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:n,options:i}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,t=Object.freeze({...t,plugin:s,client:n}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(n),this._defaults=t.defaults,this._options=i||new As(e&&e._options,t.defaults),this._hub=function(t,e){const{update:s,trigger:n}=t;return t.update=(n,i,r)=>(r&&r.silent||e("update",n,i,r),s.call(t,n,i,r)),t.trigger=(...s)=>(e("trigger",...s),n.apply(t,s)),t}(new Ds,((...t)=>this._log(...t))),this._sessionContext=new WeakMap,this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({name:t,roles:e}){const s=this._hub,n=this._client,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new Ms(s),this._data=new Fs(s,{source:pn(n),options:i}),this._views=new un(s,{extensions:r,layouts:o,roles:e,options:i,workflow:t}),this._interactions=new dn(s,{client:n,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(js(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[js(t)]||{};e.session&&e.status===ws.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===ws.READY,n=e===ws.ERRONEOUS;this._emitLifecycleEvent(n?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||n)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(t);return n.add(t),!i}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=os(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=er(t);if(!ke(s)){const t=er(this._hub.states.data);if(!ke(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=sr(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:ws.READY,session:this.session,...e},this._hub.update(js(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=ir(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)e=n(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==_s.AFFILIATION)return t;const{items:s}=e;return rr(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return rr(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[js(e.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?rr(t,{miso_id:n}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}}function hr(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:dr(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function dr({products:t,...e}){return{channel:"sovrn",...e,products:t.map(pr)}}function pr({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,..._}){return Se({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:mr({sovrn_id:t,thumbnail:u,merchant:l,..._})})}function mr(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const r=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...mr(i,r)}:{...s,[r]:i}}),{})}function fr(t){We(t,gr.prototype)}Us(_r.prototype),Object.assign(_r,{DEFAULT_API_OPTIONS:or,DEFAULT_LAYOUTS:ar,DEFAULT_TRACKERS:cr,DEFAULT_OPTIONS:ur,ROLES_OPTIONS:lr});class gr{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=e;else{window.open(e,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl(t){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t.q)}}const yr=Object.freeze({..._r.DEFAULT_API_OPTIONS,group:we.ASK,payload:{..._r.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),br=Object.freeze({actor:!1,api:{group:we.ASK,name:ve.AUTOCOMPLETE}}),wr=Object.freeze({..._r.DEFAULT_LAYOUTS,[_s.QUERY]:[mi.type,{placeholder:"Ask a question"}],[_s.QUESTION]:[Ii.type,{tag:"h2"}],[_s.ANSWER]:Li.type,[_s.FEEDBACK]:ki.type,[_s.SOURCES]:[Yn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[_s.AFFILIATION]:[Mi.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),vr=Object.freeze({..._r.DEFAULT_TRACKERS,[_s.SOURCES]:{},[_s.AFFILIATION]:{},[_s.PRODUCTS]:{}}),Er=Object.freeze({..._r.DEFAULT_OPTIONS,api:yr,autocomplete:br,layouts:wr,trackers:vr}),Or=ns(_r.ROLES_OPTIONS,{main:_s.ANSWER,members:Object.keys(wr)});class Sr extends _r{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new hn(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(_s.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[js(this._roles.main)]||{};t.session&&t.status!==ws.INITIAL&&(t.status!==ws.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,n=e===ws.READY&&!t.ongoing,i=e===ws.ERRONEOUS,r=n?"done":i?"error":e,o=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,t),(n||i)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,n=new URLSearchParams(window.location.search),i=n.get("q"),r=n.get("qs"),{layout:o}=this._views.get(_s.QUERY);o&&(i&&e&&(o.value=i),!i&&s&&o.focus()),i&&this.query({q:i,qs:r})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||ls}_buildPayload(){throw Error("Not implemented")}_updateData(t){!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){this._writeQuestionIdFromData(t)}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:hr(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){if(!t)return;const{question_id:e}=t;this._writeQuestionId(e)}_updateUrlIfNecessary({value:t,request:e}){if(!t||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{question:s}=t,n=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source===ls,i=new URL(window.location);s===i.searchParams.get("q")||n&&!0!==this._autoQuery.updateUrl||(i.searchParams.set("q",s),window.history.replaceState({},"",i))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e)}_writeAskPropertiesToInteraction(t={},e){return rr(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[js(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t}){const{value:e}=this.states.data||{},{sources:s}=e||{},n=s&&s[t-1];n&&n.product_id&&this._trackers.sources.click([n.product_id],{manual:!1})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}fr(Sr.prototype),Object.assign(Sr,{DEFAULT_API_OPTIONS:yr,DEFAULT_AUTOCOMPLETE_OPTIONS:br,DEFAULT_LAYOUTS:wr,DEFAULT_TRACKERS:vr,DEFAULT_OPTIONS:Er,ROLES_OPTIONS:Or});const kr=Object.freeze({...Sr.DEFAULT_API_OPTIONS,name:ve.QUESTIONS,payload:{...Sr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Tr=Object.freeze({...Sr.DEFAULT_LAYOUTS,[_s.QUERY]:[mi.type,{templates:{buttonIcon:"send"}}],[_s.RELATED_RESOURCES]:[Yn.type,{incremental:!0,itemType:"article"}],[_s.QUERY_SUGGESTIONS]:bi.type}),xr=Object.freeze({...Sr.DEFAULT_TRACKERS,[_s.RELATED_RESOURCES]:{},[_s.QUERY_SUGGESTIONS]:{click:{validate:t=>0===t.button}}}),Ir=Object.freeze({...Sr.DEFAULT_OPTIONS,api:kr,layouts:Tr,trackers:xr}),Cr=ns(Sr.ROLES_OPTIONS,{members:Object.keys(Tr)});class Rr extends Sr{constructor(t,e){super({name:"ask",context:t,roles:Cr,defaults:Ir,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;xe(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states.data.value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:n}=this;return Se({...s,question:t,parent_question_id:n,_meta:{...s._meta,question_source:e||ls}})}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let n,i,r,{property:o}=t.context&&t.context.custom_context||{};return e.role===_s.QUERY_SUGGESTIONS?(o="suggested_followup_questions",i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(i=this.parentQuestionId,n=this.questionId,r=this._getQuestionSourceFromViewState(e)),rr(t,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:i,question_id:n,question_source:r}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class Ar extends qs{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Rr(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Rr(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const Nr=Object.freeze({..._r.DEFAULT_API_OPTIONS,group:we.SEARCH,payload:{..._r.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),$r=Object.freeze({..._r.DEFAULT_LAYOUTS,[_s.QUERY]:[mi.type],[_s.PRODUCTS]:[Yn.type,{incremental:!0,infiniteScroll:!0}],[_s.KEYWORDS]:[Ii.type,{raw:!0}],[_s.TOTAL]:[Ii.type,{raw:!0,format:"number"}],[_s.FACETS]:[Wi.type],[_s.SORT]:[Vi.type],[_s.MORE]:[Ji.type]}),Pr=Object.freeze({..._r.DEFAULT_TRACKERS,[_s.PRODUCTS]:{}}),Ur=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Lr=Object.freeze({..._r.DEFAULT_OPTIONS,api:Nr,layouts:$r,trackers:Pr,pagination:Ur}),qr=ns(_r.ROLES_OPTIONS,{main:_s.PRODUCTS,members:Object.keys($r),mappings:{[_s.FACETS]:"facet_counts",[_s.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=e.states.filters||{},r=i&&i.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(n).field;return r?n.map((t=>({...t,selected:t.field===r}))):n}}});class jr extends _r{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(_s.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==ws.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:n}=e||{};return Se({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const n=t[s];n&&n.length&&(e[s]={terms:n})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return Oe(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},n=s.map((t=>t.product_id)).filter((t=>t)),i=[...t.exclude||[],...n];return 0===i.length?t:{...t,exclude:i}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:n}=t;switch(s){case ws.INITIAL:case ws.LOADING:break;default:return t}return n&&n.facet_counts?t:{...t,value:{...n,facet_counts:e}}}(t=nr(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=_s.PRODUCTS}={}){const{status:s,request:n,value:i}=t;if(s!==ws.READY||!n||!i)return t;const{[e]:r}=i;if(!r)return t;const{rows:o}=n.payload,{length:a}=r;return o>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=_s.PRODUCTS}={}){if(!e.value)return t;const{[s]:n=[],facet_counts:i,total:r}=t.value,{[s]:o=[]}=e.value;return{...e,facet_counts:i,total:r,value:{...e.value,[s]:[...n,...o]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}Us(jr.prototype,[Es.PAGINATION,Es.FILTERS]),Object.assign(jr,{DEFAULT_API_OPTIONS:Nr,DEFAULT_LAYOUTS:$r,DEFAULT_TRACKERS:Pr,DEFAULT_PAGINATION:Ur,DEFAULT_OPTIONS:Lr,ROLES_OPTIONS:qr});const Dr=Object.freeze({members:[]});function Mr({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function zr(t){return t&&t.value&&t.value.trim()||void 0}class Fr extends _r{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:Mr(e),roles:Dr,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,zr(t)===zr(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!zr(t))return void this._updateCompletions({session:s,status:ws.INITIAL});const n=this._buildPayload(t);this._request({payload:n})}_buildPayload(t){return{q:zr(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function Br(t){We(t,Qr.prototype)}class Qr{_initAutocomplete(t){this._autocomplete=new Fr(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Gr=ns(Sr.ROLES_OPTIONS,{mappings:{[_s.QUESTION]:_s.KEYWORDS}});class Hr extends Sr{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Gr,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset(),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||ls}}}_defaultProcessData(t){return t=nr(t=super._defaultProcessData(t))}_updateDataInHub(t){switch(t.status){case ws.INITIAL:case ws.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}Br(Hr.prototype);const Wr={...jr.ROLES_OPTIONS,members:[_s.PRODUCTS,_s.KEYWORDS,_s.TOTAL,_s.FACETS,_s.SORT,_s.MORE,_s.ERROR]};class Kr extends jr{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Wr,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:Se({...t._meta,question_id:this._superworkflow._answer.questionId})}}}Object.assign(Kr,{ROLES_OPTIONS:Wr});class Yr{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return Kr.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,n=this._getSubviews(s);if(!n._containers.has(t)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(t)){for(const n of t.components)if(s.containsElement(n))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}n.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const Vr=Object.freeze({group:we.ASK,name:ve.SEARCH,payload:{...Sr.DEFAULT_API_OPTIONS.payload,...jr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Zr=Object.freeze({...Sr.DEFAULT_LAYOUTS,...jr.DEFAULT_LAYOUTS,[_s.QUERY]:[mi.type,{placeholder:""}],[_s.QUESTION]:[Ii.type,{raw:!0}]}),Xr=Object.freeze({...Sr.DEFAULT_TRACKERS,...jr.DEFAULT_TRACKERS}),Jr=Object.freeze({...jr.DEFAULT_PAGINATION,active:!0}),to=Object.freeze({api:{group:we.ASK,name:ve.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),eo=Object.freeze({...Sr.DEFAULT_OPTIONS,...jr.DEFAULT_OPTIONS,api:Vr,layouts:Zr,trackers:Xr,autocomplete:to,pagination:Jr}),so=Object.freeze({main:_s.PRODUCTS,members:Object.keys(Zr),mappings:Object.freeze({...Sr.ROLES_OPTIONS.mappings,...jr.ROLES_OPTIONS.mappings})});class no extends _r{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:so,defaults:eo})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Hr(this),this._results=new Kr(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){const t=this._hub,e=this._client,s=this._options;this._views=new Yr(this),this._interactions=new dn(t,{client:e,options:s})}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return this._answer._defaultProcessInteraction(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Us(no.prototype,[Es.PAGINATION,Es.FILTERS]);const io=Object.freeze({..._r.DEFAULT_API_OPTIONS,group:we.ASK,name:ve.RELATED_QUESTIONS}),ro=Object.freeze({..._r.DEFAULT_LAYOUTS,[_s.RELATED_QUESTIONS]:[Yn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[_s.QUERY]:[mi.type,{placeholder:"Ask a question"}]}),oo=Object.freeze({..._r.DEFAULT_TRACKERS,[_s.RELATED_QUESTIONS]:{},[_s.CONTAINER]:{},[_s.QUERY]:{[ms.SUBMIT]:{}}}),ao=Object.freeze({..._r.DEFAULT_OPTIONS,api:io,layouts:ro,trackers:oo}),co=ns(_r.ROLES_OPTIONS,{main:_s.RELATED_QUESTIONS,members:Object.keys(ro)});class uo extends _r{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:co,defaults:ao})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(_s.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=_s.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t},{generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage(t)}_getSubmitUrl(t,{generated:e=!1}={}){let s=gr.prototype._getSubmitUrl.call(this,t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}fr(uo.prototype);const lo=Object.freeze({group:we.SEARCH,name:ve.SEARCH,payload:{fl:["*"]}}),_o=Object.freeze({api:{group:we.SEARCH,name:ve.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),ho=Object.freeze({...jr.DEFAULT_LAYOUTS}),po=Object.freeze({...jr.DEFAULT_TRACKERS}),mo=Object.freeze({...jr.DEFAULT_OPTIONS,api:lo,autocomplete:_o,layouts:ho,trackers:po}),fo=jr.ROLES_OPTIONS;class go extends jr{constructor(t,e){super({name:"search",plugin:t,client:e,roles:fo,defaults:mo})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:n}=this._views.get(_s.QUERY);n&&(s&&t&&(n.value=s),!s&&e&&n.focus()),s&&this.query({q:s})}notifyViewUpdate(t=_s.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._feedback._destroy(),this._destroyAutocomplete(),super._destroy(t)}}Br(go.prototype);const yo=Object.freeze({..._r.DEFAULT_API_OPTIONS,group:we.RECOMMENDATION,name:ve.USER_TO_PRODUCTS,payload:{..._r.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),bo=Object.freeze({..._r.DEFAULT_LAYOUTS,[_s.PRODUCTS]:Yn.type}),wo=Object.freeze({..._r.DEFAULT_TRACKERS,[_s.PRODUCTS]:{}}),vo=Object.freeze({..._r.DEFAULT_OPTIONS,api:yo,layouts:bo,trackers:wo}),Eo=ns(_r.ROLES_OPTIONS,{main:_s.PRODUCTS,members:Object.keys(bo)});class Oo extends _r{constructor(t,e){super({name:"recommendation",context:t,roles:Eo,defaults:vo,id:e})}_initProperties(t){super._initProperties(t);const{id:e}=t;xe(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}start(){return this._request(),this}notifyViewUpdate(t=_s.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return rr(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class So extends qs{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=us){if(this._members.has(t))throw Error("Unit already exists: "+t);return new Oo(this,t)}has(t=us){return this._members.has(t)}get(t=us){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new Oo(this,t)}}class ko extends ts{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new Fe)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var To=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var xo=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Io{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Co{constructor(t){this._context=t,xe(this,{lowerCamelToKebab:Re,kebabToLowerCamel:Ie,kebabOrSnakeToLowerCamel:Ce})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=Ce(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:n=!1}){const{classPrefix:i}=t;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${e}-phrase">${this.phraseText(t,Ie(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,n=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${Re(t)}="${n}"`)}return s}}const Ro=Ke(new Co({...To,DEFAULT_PHRASES:xo})),Ao=Ke(new class extends Io{constructor(){super({helpers:Ro})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=t;return n(t,{name:"related-resources"},!1===i.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:n={}}=t;return!1===n.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:Ro}));function No(t={}){const{normalizeOptions:e,section:s,container:n}=Ro,{querySuggestions:i,answerGroup:r}=Ao;return s(t=e(t),{name:"follow-up"},[i(t),n(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var $o=Object.freeze({__proto__:null,helpers:Ro,sections:Ao,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=Ro,{followUps:i,relatedResourcesSection:r,answerGroup:o}=Ao;return""+s(t=e(t),{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+i(t)+r(t)},followUp:No});const Po=Object.freeze(To),Uo=Object.freeze(xo),Lo=Object.freeze($o);var qo=Object.freeze({__proto__:null,constants:Po,phrases:Uo,templates:Lo,wireFollowUps:function(t,e,{template:s=No,...n}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const i=t.ui.asks,r=t.ui.ask;i.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:jo}=document,Do=Object.freeze({templates:Lo,autostart:!0}),Mo=["templates","phrases","features"];class zo{constructor(){this._defaults=Do,this._scriptSrc=function(){if(!jo||!jo.src)return{};const t=document.createElement("a");t.href=jo.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Qo(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Qo(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return Se({apiKey:t,apiHost:e,templates:Go(s),phrases:n,...i})}(Fo(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Fo(...t){let e={};for(const s of t)s&&(e=Bo(e,s));return e}function Bo(t,e){if(!e)return t;Object.assign(t,e);for(const s of Mo)s in e&&(t[s]={...t[s],...e[s]});return t}function Qo(t){return""===t||"false"!==t&&t}function Go(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Go):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,Go);default:throw Error("Unsupported template type: "+t)}}class Ho{constructor(t,{classPrefix:e=Po.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");xe(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Wo extends ko{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new zo,this._localOptions={}}config(t={}){t=Fo(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;xe(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Ho(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Ko extends es{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Yo,Vo,Zo;async function Xo(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Yo||(Yo=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Vo=Vo||e.any(),Zo=Zo||await Vo,Zo.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Zo}const Jo="logo",ta="auto",ea=Object.freeze([Jo]);function sa(t){if(!t)return ta;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class na extends HTMLElement{static get observedAttributes(){return ea}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return sa(this.getAttribute(Jo))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case ta:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Jo,e):this.removeAttribute(Jo)}async connectedCallback(){const t=this._client=await Xo(na);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Jo)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){sa(t)!==sa(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const ia="parent-question-id",ra=Object.freeze([...na.observedAttributes,ia]);const oa="unit-id",aa=Object.freeze([...na.observedAttributes,oa]);var ca=Object.freeze({__proto__:null,MisoAskElement:class extends na{static get tagName(){return"miso-ask"}static get observedAttributes(){return ra}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(ia)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(ia,t):this.removeAttribute(ia))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===ia)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends na{static get observedAttributes(){return na.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoHybridSearchElement:class extends na{static get observedAttributes(){return na.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends na{static get observedAttributes(){return na.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends na{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return aa}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(oa)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(oa,t):this.removeAttribute(oa)}attributeChangedCallback(t,e,s){if(t===oa)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const ua="role",la=Object.freeze([ua]);class _a extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return la}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(ua);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ua}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${ua}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===ua&&this._container&&this._container._updateComponentRole(this,e,s)}}var ha=Object.freeze({__proto__:null,MisoComponentElement:_a,MisoQueryElement:class extends _a{constructor(){super({role:_s.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends _a{constructor(){super({role:_s.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends _a{constructor(){super({role:_s.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends _a{constructor(){super({role:_s.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends _a{constructor(){super({role:_s.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends _a{constructor(){super({role:_s.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends _a{constructor(){super({role:_s.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends _a{constructor(){super({role:_s.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends _a{constructor(){super({role:_s.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends _a{constructor(){super({role:_s.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends _a{constructor(){super({role:_s.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends _a{constructor(){super({role:_s.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends _a{constructor(){super({role:_s.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends _a{constructor(){super({role:_s.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends _a{constructor(){super({role:_s.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends _a{constructor(){super({role:_s.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends _a{constructor(){super({role:_s.ERROR})}static get tagName(){return"miso-error"}}});class da extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(da.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var pa=Object.freeze({__proto__:null,containers:ca,roles:ha,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends da{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Un});const ma="miso-hybrid-search-combo";var fa=Object.freeze({__proto__:null,CLASS_PREFIX:ma,CONAINER_TAG:"miso-hybrid-search"});const ga="Show more",ya="Show less";var ba=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:ga,showLess:ya});const wa=Ke(new Co({...fa,DEFAULT_PHRASES:ba})),va=Ke(new class extends Io{constructor(){super({helpers:wa})}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:wa}));var Ea=Object.freeze({__proto__:null,helpers:wa,sections:va,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=wa;t=e(t);const{answerBox:i,answerGroup:r,searchResultsGroup:o}=va,{answerBox:a=!0}=t;return""+s(t,{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[i(t)]:r(t))+s(t,{name:"search-results"},o(t))}});const Oa="answer-box-open",Sa="answer-box-shown",ka='[data-role="answer-box-toggle"]';class Ta{constructor(t,e,{classPrefix:s=ma,phrases:n={}}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=n,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(ka)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer;switch(t){case ws.ERRONEOUS:case ws.READY:this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ya:this._phrases.showMore||ga;for(const e of this._element.querySelectorAll(ka))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const xa={isOpen:Oa,shown:Sa},Ia={toggleOpen:["toggle",Oa],open:["open",Oa],close:["remove",Oa],toggleHidden:["toggle",Sa],show:["add",Sa],hide:["remove",Sa]};for(const[t,e]of Object.entries(xa))Object.defineProperty(Ta.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(Ia))Ta.prototype[t]=function(){this._updateBoxStatus(e,s),s===Oa&&(this._syncButtonText(),this._syncScroll())};const Ca=Object.freeze(fa),Ra=Object.freeze(ba),Aa=Object.freeze(Ea);var Na=Object.freeze({__proto__:null,constants:Ca,phrases:Ra,templates:Aa,wireAnswerBox:function(t,e){if(!t)throw Error("client is required");e&&new Ta(t,e)}});const $a=Object.freeze(qo),Pa=Object.freeze(Na);var Ua=Object.freeze({__proto__:null,ask:$a,hybridSearch:Pa});const La="ui";let qa,ja;async function Da(){return ja||(ja=Ge(qa||(qa=`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${Be}/dist/css/${La}.css`)))}class Ma{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class za{constructor(t,e){this._plugin=t,this._client=e,xe(this,{sources:{api:pn(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new go(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new no(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new uo(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Fa{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Wo(this._plugin,this._MisoClient))}}zt.plugins.use(class extends ts{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Ko(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new Fe}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Ua};Te(s,this,["layouts","combo","ready"]),xe(this,{MisoClient:t}),xe(t,{ui:s}),this.combo=new Fa(this,t);const n=Object.values(tr).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:r,combos:o,...a}=pa,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];na.MisoClient=t,da.MisoClient=t;for(const e of c)e.MisoClient=t;await Da();for(const t of c)Ue(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){xe(t,{ui:new za(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Ma(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new So(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Ar(this,t)),e}});const Ba=5e3;let Qa,Ga,Ha=!1;async function Wa(t){return new Promise((e=>setTimeout((()=>{const t=p();Xa("Fallback",t),e(t)}),t)))}async function Ka(){const t=await x((()=>window.gaGlobal&&window.gaGlobal.vid));return t&&Xa("GA4",t),t}async function Ya(){const t=(await(Qa||(Qa=async function(){return x((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return t&&Xa("UA",t),t}const Va="%cMiso",Za="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Xa(t,e){!function(...t){(a.indexOf("beta")>=0||"dev"===a)&&function(...t){console.log(Va,Za,...t)}(...t)}(`[${t}] Client ID: ${e}${Ha?" (unused)":""}`),Ha=!0}async function Ja(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(zt,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||e.debug;n&&zt.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&zt.plugins.use("std:dry-run");return window.MisoClientSA=zt,zt}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const n=window.misoSA=new e(s);return n.context.anonymous_id=await async function(){return Ga||(Ga=Promise.any([Ka(),Ya(),Wa(Ba)]))}(),n}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function tc(t){return e=>({...e,context:{...e.context,custom_context:{...ec(t),...e.context&&e.context.custom_context}}})}function ec({site:t,page:e,config:s,version:n}){return d({source:"miso-client-script",script_version:n,attribution:"miso-smart-answers",site:t.key,user_geo:s.geo,page_type:e.type,post_id:e.postId,uuid:p()})}let sc;async function nc(){return sc||(sc=async function(){const[[t,e]]=await Promise.all([Ja($),w($)]);return{MisoClient:t,client:e}}())}const ic="miso-smart-answers";const rc=zt.ui.defaults.ask.templates,oc={sources:"This answer is based on the following articles",relatedQuestions:"Related questions"};function ac(t){const{sponsor:e,site:s}=t;if("computerworld"!==s.key||!e)return;const n=document.querySelector(".article-hero__breadcrumbs");n&&n.insertAdjacentHTML("afterend",function({sponsor:t}){return t?`\n<div class="${ic}__sponsor">\n  <div class="${ic}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${ic}__sponsor-logo">\n    <img src="${O(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}(t))}function cc(t,e){for(const s of e)t=s(t);return t}const uc=/<\/miso-sources>\s*<\/miso-ask>/;function lc(t){const e=`<miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="ready" logo="false"${t?` parent-question-id="${t}"`:""}><miso-whitepaper></miso-whitepaper></miso-ask>`;return t=>t.replace(uc,"</miso-sources></miso-ask>"+e)}const _c=/(answer-container.*?<\/miso-ask>)/;function hc(t){return t.replace(_c,"$1<miso-newsletter-form></miso-newsletter-form>")}function dc(t){return t.replace(/<h3 /g,"<h4 ").replace(/<\/h3>/g,"</h4>")}const pc=Object.freeze({ordered:!0,infoBlock:function({className:t},{title:e,snippet:s,description:n,created_at:i,updated_at:r,published_at:o,custom_attributes:a={}}){const c=T(a.site),u=o||i||r;let l="";e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:n&&(l+=`<div class="${t}__item-desc">${n}</div>`);const _=[];u&&_.push(`<div class="${t}__item-date">${gc(u)}</div>`);c&&_.push(`<div class="${t}__item-site">${c.name}</div>`);_.length>0&&(l+=`<div class="${t}__item-supplementals">${_.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`);return`<div class="${t}__item-info-container">${l}</div>`}});const mc="miso-list";function fc(t,e){return`\n<h4 class="miso-ask-combo__phrase miso-ask-combo__whitepaper-phrase">Learn more: in-depth</h4>\n<div class="miso-whitepaper ${mc}">\n  <ul class="${mc}__list" data-item-type="article">${e.map((t=>function(t,{cover_image:e,description:s,product_id:n,published_at:i,publishers:r,title:o,url:a}){r=r||[];const c=[];i&&c.push(`<div class="${mc}__item-date">${gc(i)}</div>`);r.length>0&&c.push(`<div class="${mc}__item-sponsor">${r.join(", ")}</div>`);return`\n<li class="${mc}__item">\n  <a class="${mc}__item-body" data-whitepaper-product-id="${n}" href="${a}" target="_blank" rel="noopener">\n    <div class="${mc}__item-cover-image-container">\n      <img class="${mc}__item-cover-image" src="${e}">\n    </div>\n    <div class="${mc}__item-info-container">\n      <div class="${mc}__item-title">${o}</div>\n      <div class="${mc}__item-desc">${s}</div>\n      ${c.length>0?`<div class="${mc}__item-supplementals">${c.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`:""}\n    </div>\n  </a>\n</li>`.trim()}(0,t))).join("")}</ul>\n</div>\n`.trim()}function gc(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}const yc=new Set;class bc{constructor(t,{MisoClient:e,client:s,workflow:n,element:i}){this._workflow=n,this._client=s,this._MisoClient=e,this._context=Object.freeze({...t}),this._rootElement=i,this._element=void 0,this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1,n.on("data",(t=>this.updateData(t)))}clear(){this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1}async updateData({session:t,value:e}={}){t&&(this._product&&this._session&&this._session.uuid===t.uuid||(this._session=t,this._product=this._getProduct(e),this._syncView()))}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=(t?`miso-ask[parent-question-id="${CSS.escape(t.trim())}"]`:"miso-ask:not([parent-question-id])")+" miso-whitepaper";if(this._element=this._rootElement.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProduct(t){const{affiliation_products:e=[]}=t||{};for(const t of e)if(!yc.has(t.product_id))return yc.add(t.product_id),t;return e[0]}async _syncView(){this._html=this._product?fc(0,[this._product]):"",this._requestRender()}async _requestRender(){this._render(),this._product&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;t.closest(".miso-whitepaper a[href]")&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){if(!this._product)return;const{questionId:s,parentQuestionId:n,rootQuestionId:i}=this._workflow,{question_source:r="_organic"}=this._workflow.session.meta||{};this._client.api.interactions.upload(d({type:t,...e,product_ids:[this._product.product_id],context:{custom_context:d({...ec(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:i,parent_question_id:n,question_id:s,question_source:r})}}))}}class wc{constructor(t){this._site=t,this._enabled=!!t.newsletter_mauticform_id&&t.dev,this._newsletterSection=void 0,this._createScript()}_createScript(){if(!this._enabled)return;const t=document.createElement("script");t.type="text/javascript",t.src="https://mau.idgesg.net/form/generate.js?id="+this._site.newsletter_mauticform_id,t.addEventListener("load",(()=>{const t=document.querySelector("input#mauticform_input_usciofirstlooksubscriptionform_hidden_source_information");t&&(t.value="Generated by smart answers")})),this._formScript=t}_setupElement(){this._enabled&&!this._newsletterSection&&(this._newsletterSection=document.querySelector("miso-newsletter-form"),this._newsletterSection&&this._newsletterSection.appendChild(this._formScript))}show(){this._enabled&&(this._setupElement(),this._newsletterSection&&(this._newsletterSection.style.display=""))}hide(){this._enabled&&this._newsletterSection&&(this._newsletterSection.style.display="none")}}function vc(t,{MisoClient:e,client:s,rootElement:n}){const{site:i,config:a}=t,c=s.ui.asks,u=s.ui.ask;c.useApi({_meta:d({site:i.key,user_geo:a.geo}),fq:o,source_fl:r,related_resource_fl:r}),c.useDataProcessor(function(t){const e=function({site:t}){return({url:e,...s})=>((e=new URL(e)).host=""+t.whitepaper_hostname,{url:Sc(e=""+e),...s})}(t);return({value:t,...s})=>{if(!t)return s;const{sources:n=[],related_resources:i=[],affiliation_products:r}=t;return{value:{...t,sources:n.map(Oc),related_resources:i.map(Oc),affiliation_products:(r||[]).map(e)},...s}}}(t)),c.useInteractions({preprocess:tc(t)}),c.useLayouts({sources:{templates:pc}});const l=document.createElement("div");l.id="smart-answers",l.classList.add("miso-ask-combo"),n.insertAdjacentElement("afterend",l),n.remove(),(n=l).innerHTML=cc(rc.root({phrases:oc,features:{relatedResources:!1}}),[lc(),dc,hc]);const _=n.querySelector(".miso-ask-combo__follow-ups"),h=n.querySelector(".miso-ask-combo__related-resources miso-ask"),p=new wc(i);function m(n){n._whitepaper||(n._whitepaper=new bc(t,{MisoClient:e,client:s,workflow:n,element:l}))}_&&(c.on("done",(t=>{_.insertAdjacentHTML("beforeend",function(t,{parentQuestionId:e}){return cc(rc.followUp({phrases:oc,parentQuestionId:e}),[lc(e),dc])}(0,{parentQuestionId:t.workflow.questionId}))})),u.on("loading",(()=>{_.innerHTML="",c.reset({root:!1}),u._whitepaper&&u._whitepaper.clear(),p.hide()}))),h&&c.on("loading",(t=>{h.workflow=t.workflow})),c.on("create",m),m(u),c.on("ready",(()=>p.show())),u.autoQuery()}function Ec(t,e){if(!t)return t;if(!e)return Sc(t);const{origin:s}=new URL(t),{pathname:n}=new URL(e);return Sc(`${s}${n}`)}function Oc({url:t,cover_image:e,custom_attributes:s,...n}){const{site:i,contenthub_url:r}=s;return{cover_image:e||T(i).logo_image,url:Ec(t,r),custom_attributes:s,...n}}function Sc(t){return`${t}${0>t.indexOf("?")?"?":"&"}utm=smart_answers`}const kc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Tc='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function xc({className:t},{title:e,created_at:s,updated_at:n,published_at:i,custom_attributes:r={}}){const o=T(r.site),a=i||s||n;let c="";e&&(c+=`<div class="${t}__item-title">${e}</div>`);const u=[];return o&&u.push(`<div class="${t}__item-site">${o.name}</div>`),a&&u.push(`<div class="${t}__item-date">${Ic(a)}</div>`),u.length>0&&(c+=`<div class="${t}__item-supplementals">${u.join("&nbsp;&nbsp;&nbsp;&nbsp;")}</div>`),`<div class="${t}__item-info-container">${c}</div>`}function Ic(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}Object.freeze({ordered:!0,article:function(t,e,s,n){const{templates:i}=t,[r,o]=i.helpers.tagPair(t,s);return""+r+i.indexBlock(t,s,n)+xc(t,s)+o},infoBlock:xc}),Object.freeze({infoBlock:function({className:t},{title:e,snippet:s,description:n,authors:i,created_at:r,updated_at:o,published_at:a,custom_attributes:c={}}){T(c.site);const u=a||r||o;let l=`<div class="${t}__item-main-block">`;c.content_type&&(l+=`<div class="${t}__item-content-type">${c.content_type}</div>`);e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:n&&(l+=`<div class="${t}__item-desc">${n}</div>`);l+=`</div><div class="${t}__item-supplementals-block">`,i&&(l+=`<div class="${t}__item-authors">By ${i}</div>`);u&&(l+=`<div class="${t}__item-date">${Ic(u)}</div>`);return l+="</div>",`<div class="${t}__item-info-container">${l}</div>`}});const Cc="textarea.miso-search-box__input";function Rc(){this.style.height="auto",this.style.height=this.scrollHeight-24+"px"}function Ac(){const t=document.querySelector(Cc);t&&(t.addEventListener("keyup",Rc),Rc.call(t))}const Nc="header #miso-search",$c='.header__icon-button[data-menu-trigger="search"]',Pc='.header__menu-link[data-menu-trigger="search"]';function Uc(t){const{searchParams:e}=new URL(window.location.href);return e.set("q",t),"/search/?"+e}async function Lc(t){const e=document.querySelector(Nc);if(!e)return;const n=[document.querySelector($c),document.querySelector(Pc)];if(t.page.type===s)return void n.forEach((t=>{t&&t.addEventListener("click",(()=>{const t=document.querySelector('.button[data-menu-close="search"]');t&&t.click();const e=document.querySelector(".miso-search-box__input");e&&e.focus()}))}));const{client:i}=await nc(),r=i.ui.hybridSearch;r.useLink(Uc,{open:!1}),r.autocomplete.enable(),e.classList.add("miso-hybrid-search-input"),e.innerHTML=`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${kc}</span>\n        <textarea rows="1" class="miso-search-box__input" type="text" placeholder="What are you searching for?" autocomplete="off" data-role="input"></textarea>\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Tc}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim(),Ac()}const qc="#smart-answers";async function jc(t){const e=document.querySelector(qc);if(!e)return void console.error("Container element not found: "+qc);const{MisoClient:s,client:n}=await nc();ac(t),vc(t,{MisoClient:s,client:n,rootElement:e})}(async t=>{t.page.type===e&&function(t){const{version:e,debug:s}=t;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=e,s("Miso Smart Answers script version: "+e),!0)}(t)&&await Promise.all([jc(t),Lc(t)])})($)}();
