!function(){"use strict";const t="home",e="answers",s="article",n="other";var i="0.9.24";var r=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const o={key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},a=window.location.hostname!==o.hostname;var c={...o,dev:a};function u(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const l=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),h=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var _=Object.freeze({__proto__:null,GROUP:l,NAME:h});function d(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}function p(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function m(t){return null!=t?""+t:t}function f(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function g(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function y(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}class b{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);v(s),v(n),v(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>w(this,t)),e):w(this,t),this._value=t}disconnect(){this._active=!1}}function w(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function v(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function E(t){return"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE}function k(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function C(t){return t&&t.ownerDocument&&t.ownerDocument.contains(t)}function R(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function x(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async()=>{try{await t(),e()}catch(t){s(t)}}))}))}async function O(t,{area:e=.5,duration:s=1e3,signal:n}={}){var i;return t="string"==typeof(i=t)?document.querySelector(i):i,new Promise((i=>{const r=new b((t=>{t&&(r.disconnect(),o.disconnect(),i())}),{onDuration:s}),o=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});o.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{r.disconnect(),o.disconnect()}))}))}function S(t){return t&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function I(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function A(t,e){const s=window.localStorage.getItem(t),n=function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,r=e.indexOf(";",i);return decodeURIComponent(0>r?e.substring(i):e.substring(i,r))}(t),i=s||n||""+e();return i&&!s&&window.localStorage.setItem(t,i),i&&!n&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i),i}function N(t){return new $(t)}class ${constructor(t){this._value=t;const e=t=>{this._value=t};y(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class T{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class q{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){for(let t=0;;t=this._index+1){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new T),await this._resolution.promise),this._aborted)break;if(yield this._value,this._done)break}}}const U=Symbol.for("miso:resources");class P{constructor(){this._resources=new Map;const t=window[U]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){j(this._resources,t).resolve(e)}async get(t){return j(this._resources,t).promise}}function j(t,e){if(t.has(e))return t.get(e);const s=new T;return t.set(e,s),s}function L(){return window[U]||(window[U]=new P)}class M{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new T;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class D{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)d(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&d(s,e)}}_injectSubscribeInterface(t){g(t,this,["on","once"])}}function z(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class Q{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:z(t,e),uuid:I()})}(t,e);y(this,{meta:s});const n=this._error=this._error.bind(this);(this._events=new D({error:n,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(Q,"miso:component");class B extends Q{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new T);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class G{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:W}=document,V=W.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/discovery$/,"");async function F({}){await Promise.all([K()])}let H=!1;async function K(){if(H)return;if(H=!0,!W)throw Error("currentScript not found");const t=W.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}function Y(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${V}/${t}`}const Z=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",script:!1,lang:"en"}].map((({logo_image:t,...e})=>({logo_image:Y(t),...e})));Z.reduce(((t,e)=>(t[e.key]=e,t)),{});var X=Object.freeze(function(){const i=(r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r;var r;switch(i){case"":return{type:t};case"/smart-answers":return{type:e};default:if(c.regions.indexOf(i.substring(1))>=0)return{type:t}}const o=i.substring(1).split("/");if("article"===o[0]){const t=""+o[1];return{type:s,postId:t,product_id:`article_${c.key}_${t}`}}return{type:n}}());const J="%cMiso",tt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const et=[];var st=function(){if(r.sponsor)return et.find((t=>t.key===r.sponsor))||void 0}(),nt=Object.freeze({__proto__:null,config:r,version:i,site:c,page:X,sponsor:st,debug:function(...t){r.debug&&function(...t){console.log(J,tt,...t)}(...t)}});const it='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',rt='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',ot="miso-smart-answers";function at({sponsor:t}){return t?`\n<div class="${ot}__sponsor">\n  <div class="${ot}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${ot}__sponsor-logo">\n    <img src="${Y(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}const ct="miso-smart-answers-discovery";function ut(t,e={}){return ht("article",function(t){return`\n<miso-explore visibleWhen="ready nonempty" class="${ct}__container">\n  ${function({site:t}){return`\n<div class="${ct}__hero">\n  <h2 class="${ct}__hero-title">${t.name} Smart Answers</h2>\n  <a class="${ct}__hero-info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a>\n</div>`.trim()}(t)}\n  ${at(t)}\n  <div class="${ct}__header">\n    <a class="${ct}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow" title="What is this?">\n      <i>${rt}</i>\n    </a>\n    <h4 class="${ct}__title">Explore related questions</h4>\n  </div>\n  <div class="${ct}__body">\n    <miso-related-questions></miso-related-questions>\n    <miso-query>${`\n<div class="miso-search-box" data-role="query">\n  <div class="miso-search-box__input-group">\n    <input class="miso-search-box__input" type="text" data-role="input" placeholder="Ask a question">\n    <button class="miso-search-box__button" type="submit" data-role="button"><div class="miso-search-box__button-inner"><i>${it}</i><span class="miso-search-box__button-text">Ask</span></div></button>\n  </div>  \n</div>`.trim()}</miso-query>\n  </div>\n</miso-explore>`.trim()}(t))}function lt(t,e={}){const s=ht("home",function(t){const{site:e}=t;return`\n<div class="${ct}__inner">\n  <h3 class="${ct}__title">${e.name} Smart Answers</h3>\n  ${at(t)}\n  <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you. <a class="${ct}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a></p>\n  <form class="${ct}__search-form">\n    <input class="${ct}__search-form-input" type="text" placeholder="Ask a question">\n    <button class="${ct}__search-form-submit" type="submit">\n      <i>${it}</i>\n      <span class="${ct}__search-form-submit-text">Ask</span>\n    </button>\n  </form>\n</div>`.trim()}(t),{classes:["container"]}),n=document.createElement("section");return n.classList.add(ct+"__section"),n.appendChild(s),n}function ht(t,e,{classes:s=[]}={}){const n=document.createElement("div");n.classList.add(ct),n.classList.add(`${ct}__${t}`);for(const t of s)n.classList.add(t);return n.innerHTML=e,n}var _t="1.9.8-beta.0";const dt=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class pt{constructor(t,e){this._client=t,this._root=e,this._bulk=new M(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,f({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:r,body:o}=n[e];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=dt.DATA_ENDPOINT,eventEndpoint:s=dt.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){t.error(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){t.error(e)}return n}}class mt extends Q{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,r)}_postprocess({response:t}){return t.data}}const{GROUP:ft,NAME:gt}=_;class yt extends mt{constructor(t){super(t,ft.INTERACTIONS)}async upload(t,e){try{return await this._run(gt.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===gt.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}const{GROUP:bt,NAME:wt}=_;class vt extends mt{constructor(t){super(t,bt.ASK)}async questions(t,e={}){if("string"==typeof t&&"{"!==t.charAt(0))return new Et(this,{question_id:t},e);const s=await this._run(wt.QUESTIONS,t,e);return new Et(this,s,e)}async _questions(t,e){return this._run(wt.QUESTIONS,t,e)}async _get(t,e){return this._run(`${wt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(wt.RELATED_QUESTIONS,t,e)}}class Et{constructor(t,{question_id:e},s={}){this._api=t,this._questionId=e,this._ac=new AbortController,this._options=s}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,{...this._options,...t})}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new G(s);let r;e=u(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o=0;const a=new q,c=setInterval((async()=>{let e,u;try{[e,u]=await t(r?{signal:r}:{}),i&&i(e,u),o=0}catch(t){return n&&n(t),o++,void(o>s&&(clearInterval(c),a.error(t)))}a.update(e,u),u&&clearInterval(c)}),e);return r&&r.addEventListener&&r.addEventListener("abort",(()=>{clearInterval(c),a.abort(r.reason)})),a}((async({}={})=>{const t=await this.get();return[t,t.finished]}),{interval:t,signal:e,onResponse:(t,e)=>{var s,n;e?i.clear():(n=t,(s=r)&&s.answer_stage===n.answer_stage&&s.answer.length===n.answer.length||i.touch()),r=t},...n})[Symbol.asyncIterator]()}}const{GROUP:kt,NAME:Ct}=_;class Rt extends mt{constructor(t){super(t,kt.SEARCH)}async search(t,e){return this._run(Ct.SEARCH,t,e)}async autocomplete(t,e){return this._run(Ct.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(Ct.MGET,t,e)}}const{GROUP:xt,NAME:Ot}=_;class St extends mt{constructor(t){super(t,xt.RECOMMENDATION)}async userToProducts(t,e){return this._run(Ot.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(Ot.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(Ot.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(Ot.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(Ot.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(Ot.PRODUCT_TO_PRODUCTS,t,e)}}class It extends Q{constructor(t,e){super("api",t),this._client=t,this.helpers=new pt(t,e),this.interactions=new yt(this),this.ask=new vt(this),this.search=new Rt(this),this.recommendation=new St(this)}}var At=Object.freeze({__proto__:null,Api:It,ApiBase:mt,ApiHelpers:pt,Interactions:yt,Ask:vt,Search:Rt,Recommendation:St});class Nt extends Q{constructor(t){super("context",t),this._client=t}}var $t={api:At,context:{Context:Nt}};class Tt{constructor(t){y(this,{install:t})}}class qt extends B{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Ut(this,$t),this.plugins=new Pt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new T);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return y(n,{id:t}),this._tryConfig(n,e),n;case"function":return new Tt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,r=t.lastIndexOf("/",i)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,i);return`${t.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new L).get(s);!this.isRegistered(t)&&this.register(n)}}class Ut{constructor(t,e){g(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),y(this,{classes:e})}}class Pt{constructor(t){g(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const jt=new class extends Q{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new qt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=_t,this._cmdRes=new T}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Lt=Object.freeze({__proto__:null,viewable:O});const{currentScript:Mt}=document;class Dt extends Q{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Dt),window.MisoClient?window.MisoClient!==Dt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Dt}constructor(t){super("client",jt),this._config(t),this.context=new Nt(this),this.api=new It(this,jt),function(t){jt._clients.push(t),jt._events.emit("create",t)}(this)}get version(){return Dt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,f(t)}_readConfigFromScriptUrl(){return f({apiKey:new URL(new Request(Mt.src||Mt.href).url).searchParams.get("api_key")||void 0})}}Dt.helpers=Lt,y(Dt,{uuid:I()});var zt=function(t){const e=jt._pluginRoot;return jt.MisoClient=e.MisoClient=t,g(t,jt,["version","instances","any","meta","on","once","cmdDone"]),g(t,e,["plugins"]),t}(Dt);class Qt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=A("miso_anonymous_id",I))}set anonymous_id(t){t=m(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=m(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}}function Bt(){const t=new URLSearchParams(window.location.search);let e=f({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Gt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function Wt(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:_t};return s.uuid||(s.uuid=I()),{...t,context:{...e,custom_context:s}}}function Vt({text:t="Miso"}={}){return"%c"+t}function Ft({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}function Ht(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}zt.plugins.register(class{constructor(t={}){this._options=t}static get id(){return"std:debug"}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t)}config(t={}){this._options={...this._options,...t}}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logr(...t){const e=this._options.console||{};console.log(Vt(e),Ft(e),...t)}_log(t,e,...s){const n=this._options.console||{};console.log(Vt(n),Ft(n),function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Ht)):this._log(t,e,Ht(s))}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}}),zt.plugins.use(class extends Q{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Qt(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return"interactions"===e&&"upload"===s?this._modifyPayloadForInteractions(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=f({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),zt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...f({page:f({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:Bt()}),...t.context}})))}}}),zt.plugins.use(class extends Q{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Gt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===l.SEARCH)if(s===h.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),zt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Wt)}}});const Kt="data-miso-product-id",Yt="default",Zt="_organic",Xt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",ERROR:"error"}),Jt=new Set([Xt.PRODUCTS,Xt.CATEGORIES,Xt.ATTRIBUTES,Xt.RESULTS,Xt.ITEMS,Xt.QUESTION,Xt.ANSWER,Xt.SOURCES,Xt.RELATED_RESOURCES,Xt.QUERY_SUGGESTIONS,Xt.RELATED_QUESTIONS]);function te(t){return Jt.has(t)}const ee=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",TEXT:"text",ERROR:"error"}),se=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click"}),ne=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),ie=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function re(t){if(t!==se.IMPRESSION&&t!==se.VIEWABLE&&t!==se.CLICK)throw Error("Unrecognized event type: "+t)}function oe(t){if(void 0===t)return;let[e,s]=p(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function ae(...t){return!1!==t[t.length-1]&&ye(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...ce("_meta",s,n)})});var s,n}))}function ce(t,e,s){const n=e&&e[t],i=s&&s[t],r=n?i?{...n,...i}:n:i;return void 0!==r?{[t]:r}:{}}function ue(...t){return!1!==t[t.length-1]&&ye(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=le(t[s],n);return t}))}function le(t,e){return!1===(e=oe(e))[0]?e:t&&e?[e[0]||t[0],he(t[1],e[1])]:e||t}function he(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function _e(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function de(...t){return!1!==t[t.length-1]&&ye(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}const pe=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return f({name:t,payload:e})},merge:ae},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[Xt.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[Xt.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Xt.PRODUCTS]}: ... }) instead`),t={...s,[Xt.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[e]=oe(s);return n},merge:ue},{key:"dataProcessor",normalize:function(t){t=p(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&ye(t,((t,e)=>Object.assign(t,{...e,impression:_e(t.impression,e.impression),viewable:_e(t.viewable,e.viewable),click:_e(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=p(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:de}];class me{constructor(){this._events=new D({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class fe{constructor(t={},e={}){this._events=new D({target:this}),this._defaults=e,this._globals=t||{},this._locals={},y(this,{resolved:new ge(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class ge{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of pe)Object.defineProperty(me.prototype,t,{set:function(s){this._globals[t]=e(s),this._notify(t)},get:function(){return this._globals[t]}}),Object.defineProperty(fe.prototype,t,{set:function(s){this._locals[t]=e(s),this._notify(t)},get:function(){return this._locals[t]}}),Object.defineProperty(ge.prototype,t,{get:function(){const e=this._options;return s(e._defaults[t],e._globals[t],e._locals[t])}});function ye(t,e){let s={};for(const n of t)n&&(s=e(s,n));return f(s)}class be extends Q{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new me}useApi(...t){return this._options.api=t,this}useLayouts(t){return this._options.layouts=t,this}useDataProcessor(t){return this._options.dataProcessor=t,this}useTrackers(t){return this._options.trackers=t,this}useInteractions(t){return this._options.interactions=t,this}}function we(){return"data"}function ve(t){return t?"view:"+t:"view"}class Ee{constructor(){(this._events=new D)._injectSubscribeInterface(this),this._states={},y(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class ke{constructor(t){this._hub=t,this._sessionIndex=0,g(t,this,["active"])}get active(){const{session:t}=this._hub.states;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this.new({force:!0}),this.start()}_create(){return Object.freeze({active:!1,uuid:I(),index:this._sessionIndex++,meta:{}})}}class Ce{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},r=await this._source({session:e,...t,options:i});if(r&&r[Symbol.asyncIterator]){let t;for await(t of r){if(!this._isCurrentSession(e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){this._isCurrentSession(t.session)&&this._emitResponse(t)}_isCurrentSession(t){if(!t)return!1;const{session:e}=this._hub.states;return e&&e.index===t.index}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Re{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{d(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}class xe{constructor(t,e){this._events=new D({target:this}),this._views=t,y(this,{role:e,interface:new Oe(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Re((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&"function"==typeof t.initialize&&t.initialize(this),this.refresh({force:!0})}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:i,status:r,ongoing:o,request:a,meta:c}=e;if(!t&&!(i&&i.active))return;if(!t&&((u=e)===(l=n)||u&&l&&u.status===l.status&&u.error===l.error&&u.value===l.value&&u.ongoing===l.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(u.session,l.session)))return;var u,l;const h=(t={},e)=>{!1!==t&&this.updateState({session:i,status:r,ongoing:o,request:a,meta:c,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState({session:t,status:e,ongoing:s,request:n,meta:i,error:r},{silent:o=!1}={}){r&&(e=ie.ERRONEOUS);const a=this._state=Object.freeze(f({session:t,status:e,ongoing:s,request:n,meta:i,error:r})),{role:c}=this;this.hub.update(ve(c),a,{silent:o})}_sliceData({value:t,error:e,status:s,meta:n,...i}){const r={value:this.role===Xt.ERROR?e:t&&t[this.role],status:s,meta:n,...i};return this.role===Xt.CONTAINER&&(r.meta={...n,empty:this._isContainerEmpty(t)}),f(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!te(s))return!1;let e=t&&t[s];if(s===Xt.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Oe{constructor(t){g(this,t,["role","layout","element","proxyElement","refresh","on"])}}class Se{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i=[],options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=r,this._containers=new Map,this._views={};for(const t of i)this._views[t]=new xe(this,t);y(this,{interface:new Ie(this)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on(we(),(()=>this.refresh())),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}addContainer(t){if(this._containers.has(t))return;const e=new xe(this,Xt.CONTAINER);e.layout=this._createLayout(Xt.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===Xt.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new xe(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t}={}){const e=this._getData();await Promise.all(this._getViews(!0).map((s=>s.refresh({force:t,data:e}))))}_getData(){const{[we()]:t}=this._hub.states;if(!this._data||this._data.data!==t){const e=t&&t.session&&t.session.active?t.error?ie.ERRONEOUS:t.value?ie.READY:ie.LOADING:ie.INITIAL,s=e===ie.READY?!!t.ongoing:void 0;this._data=Object.freeze({...t,status:e,ongoing:s})}return this._data}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ie{constructor(t){this._actor=t,g(this,t,["syncSize","refresh"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}function Ae(t){return e=>Array.from(e.querySelectorAll(`[${t}]`)).map((e=>({element:e,value:{product_id:e.getAttribute(t)}})))}class Ne{constructor({keyAttrName:t="data-key",list:e}={}){this._list=e||Ae(t),this._bindings=new Map,this._e2b=new WeakMap}list(){return[...this._bindings.values()]}get(t){if(!t)throw Error("Value or element is required.");if(this._root)return E(t)?k(t,(t=>this._e2b.get(t)||void 0),{root:this._root}):this._bindings.get(t)}refresh(t){if(!t)return this.unbindAll();this._root=t;const e=this._purge(),s=[];for(const n of this._list(t)){const[t,...i]=this._bind(n);t&&s.push(t);for(const t of i)e.push(t)}return{bounds:s,unbounds:e}}unbindAll(){const t=this.list();return this._bindings.clear(),this._root=void 0,{bounds:[],unbounds:t}}_bind({element:t,key:e,value:s}){if(!(e=e||s))throw Error("Key or value is required.");if(!t)throw Error("Element is required.");const n=this._bindings.get(e);if(n&&n.element===t)return[];const i=this._unbind(this.get(e)),r=this._unbind(this.get(t)),o=Object.freeze({key:e,value:s,element:t});this._bindings.set(e,o),this._e2b.set(t,o);const a=[o];return i&&a.push(i),r&&a.push(r),a}_purge(){const t=[];for(const e of this._bindings.values()){const{element:s}=e;C(s)||t.push(this._unbind(e))}return t}_unbind(t){return t&&(this._bindings.delete(t.key),this._e2b.delete(t.element)),t}_destroy(){this.unbindAll()}}const{IMPRESSION:$e,VIEWABLE:Te,CLICK:qe}=se,{UNTRACKED:Ue,TRIGGERED:Pe}=ne,je={NEW:Object.freeze({[$e]:Ue,[Te]:Ue}),UNTRACKED:Object.freeze({[$e]:Ue,[Te]:Ue,[qe]:Ue})};class Le{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(Me(t));return e?{...e}:je.UNTRACKED}get(t,e){const s=this._states.get(Me(t));return s&&s[e]||Ue}set(t,e,s){re(e),function(t){if(t!==ne.UNTRACKED&&t!==ne.TRACKING&&t!==ne.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of p(t))this._setOne(Me(n),e,s)}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,t,(()=>({...je.NEW}))))[e]=s}untriggered(t,e){return t.filter((t=>this.get(t,e)!==Pe))}}function Me(t){return t.product_id||t.text||t}const{IMPRESSION:De,VIEWABLE:ze,CLICK:Qe}=se,{UNTRACKED:Be,TRACKING:Ge,TRIGGERED:We}=ne,Ve=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function Fe(t,e){return!!e&&{...t,...e}}function He(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return f({...Ve,...i,impression:Fe(Ve.impression,e),viewable:Fe(Ve.viewable,s),click:Fe(Ve.click,n)})}class Ke{constructor({proxyElement:t,element:e,sessionId:s="default",active:n=!0,bindings:i,...r}={}){this._events=new D({target:this}),this._proxyElement=t||new Re(e),this._getSessionId="function"==typeof s?s:()=>s,this._isActive="function"==typeof n?n:()=>n,this._bindings=new Ne(i),this._viewables=new WeakMap,this._options=He(r),this._unsubscribes=[this._proxyElement.on("click",(t=>this._handleClick(t))),this._proxyElement.on("element",(()=>this.refresh()))],this.refresh()}get active(){return this._isActive()}config(t){this._options=He(t)}refresh(){this._syncElement(),this._syncStates(),this._refreshBindings()}_syncStates(){const t=this._getSessionId();t&&(this._states&&t!==this._states.sessionId&&this._retireStates(),!this._states&&t&&(this._states=new Le(t)))}impression(t,e){this._assertActive(),this._options&&this._options.impression&&this._trigger(De,t,{manual:!0,...e})}viewable(t,e){this._assertActive(),this._options&&this._options.viewable&&this._trigger(ze,t,{manual:!0,...e})}click(t,e){this._assertActive(),this._options&&this._options.click&&this._trigger(Qe,t,{manual:!0,...e})}_assertActive(){if(!this._isActive())throw Error("Tracker is not active.")}getState(t){return Object.freeze({[Qe]:this._proxyElement.current?Ge:Be,...this._states.getFullState(t)})}_syncElement(){this._proxyElement.sync({silent:!0});const t=this._proxyElement.current;this._element!==t&&(this._retireElement(),t&&this._options&&this._options.watch&&(this._mutationObserver=new MutationObserver((()=>this.refresh())),this._mutationObserver.observe(t,{childList:!0,subtree:!0})),this._element=t)}_retireElement(){this._element&&(this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=void 0),this._element=void 0)}_retireStates(){const{unbounds:t}=this._bindings.unbindAll();this._untrackViewables(t),this._states=void 0}_refreshBindings(){if(!this._states)return;const t=this._proxyElement.current,{bounds:e,unbounds:s}=this._bindings.refresh(t);this._untrackViewables(s),this._trackImpressions(e),this._trackViewables(e)}_trackImpressions(t){this._options&&this._options.impression&&this._trigger(De,t.map((t=>t.value)),{bindings:t})}_trackViewables(t){if(this._options&&this._options.viewable)for(const e of t)this._trackViewableOnElement(e)}async _trackViewableOnElement(t){const{value:e,element:s}=t;if(!e||!E(s)||this._viewables.has(s))return;if(this._states.get(e,ze)!==Be)return;this._states.set(e,ze,Ge);const{area:n,duration:i}=this._options&&this._options.viewable,r=new AbortController,{signal:o}=r;this._viewables.set(s,{ac:r}),await O(s,{area:n,duration:i,signal:o}),this._viewables.delete(s),this._trigger(ze,[e],{bindings:[t]})}_untrackViewableOnElement({value:t,element:e}){const s=this._viewables.get(e);if(!s)return;s.ac.abort(),this._viewables.delete(e);const n=ze;this._states.get(t,n)===Ge&&this._states.set(t,n,Be)}_untrackViewables(t){for(const e of t)this._untrackViewableOnElement(e)}_handleClick(t){const e=this._options&&this._options.click;if(!e||!this._isActive())return;const s=this._bindings.get(t.target);if(s){if("function"==typeof e.validate){if(!e.validate(t,s))return}else if(!e.lenient){if(0!==t.button)return;if(t.defaultPrevented)return;if(!k(t.target,(t=>"A"===t.tagName&&t.href||void 0)))return}this._trigger(Qe,[s.value],{bindings:[s]})}}_trigger(t,e,{manual:s=!1,bindings:n}={}){re(t),this._isActive()&&0!==(e=this._states.untriggered(p(e),t)).length&&(this._states.set(e,t,We),this._events.emit(t,{event:t,values:e,manual:s,bindings:n}))}destroy(){this._retireElement(),this._retireStates(),this._bindings._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}const Ye=new Set([Xt.PRODUCTS,Xt.SOURCES,Xt.RELATED_RESOURCES]);function Ze({property:t,misoId:e,request:s},{event:n,values:i,manual:r}){let o;if(e)try{o=function(t){const e=t.split("-"),s=""+e[2].substring(1)+e[1]+e[0];return Math.floor(parseInt(s,16)/1e7)-12219292800}(e)}catch(t){}const a=s&&s._meta&&s._meta.question_source,c=function(t){return Ye.has(t)}(t);return f({type:"viewable"===n?"viewable_impression":n,product_ids:c?i.map((t=>t.product_id)).filter((t=>t)):[],miso_id:e,context:{custom_context:f({api_ts:o,property:t,items:c?void 0:i.map((t=>t.text||t)),trigger:r?"manual":"auto",question_source:a})}})}function Xe(t){return t&&t.status===ie.READY}class Je{constructor(t,e,{active:s,bindings:n,...i}={}){this._hub=t,this._view=e,this._bindings=n;const r=this._role=e.role;this._tracker=new Ke({bindings:{list:t=>this._listBindingsFn()(t)},proxyElement:e.proxyElement,sessionId:()=>this._getSessionId(),active:s||(()=>this._isViewReady()),...i}),this._unsubscribes=[this._tracker.on("*",(t=>this._handleEvent(t))),t.on(ve(r),(()=>this.refresh()))],this.refresh()}config(t){this._tracker.config(t)}start(){throw Error("workflow.tracker.start() is deprecated. Use workflow.startTracker() instead.")}refresh(){this._tracker.refresh()}impression(t,e){this._assertViewReady(),this._tracker.impression(t.map((t=>({product_id:t}))),e)}viewable(t,e){this._assertViewReady(),this._tracker.viewable(t.map((t=>({product_id:t}))),e)}click(t,e){this._assertViewReady(),this._tracker.click(t.map((t=>({product_id:t}))),e)}_listBindingsFn(){if(this._bindings&&"function"==typeof this._bindings.list)return this._bindings.list;const{layout:t}=this._view;return t&&t.bindings&&"function"==typeof t.bindings.list?t.bindings.list:Ae(Kt)}_assertViewReady(){if(!this._hub.active)throw Error("Workflow is not active. Call workflow.start() to activate it.");if(!Xe(this._getViewState()))throw Error("Workflow is not rendered yet. If you handle rendering by yourself, call workflow.notifyViewUpdate() when DOM is ready.")}_getViewState(){return this._hub.states[ve(this._role)]}_isViewReady(){return this._hub.active&&Xe(this._getViewState())}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||this._element&&this._element.getAttribute("miso-id")||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}getState(t){return this._tracker.getState(t)}_handleEvent(t){const e="results"===this._role?"products":this._role,s=this._getMisoId(),n=this._getRequestPayload();this._hub.trigger("interaction",Ze({property:e,misoId:s,request:n},t))}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._tracker.destroy()}}class ts{constructor(t,{views:e,options:s}){this._hub=t,this._views=e,this._options=s,this._trackers={},s.on("trackers",(()=>this._syncConfig())),this._syncConfig()}_syncConfig(){for(const[t,e]of Object.entries(this._options.resolved.trackers))this._createOrConfigTracker(t,e)}_createOrConfigTracker(t,e){if(void 0===e)return;let s=this._trackers[t];s?s.config(e):(s=this._trackers[t]=new Je(this._hub,this._views.get(t),e),Object.defineProperty(this,t,{get:()=>this._trackers[t]}))}_destroy(){for(const t of Object.values(this._trackers))try{t._destroy()}catch(t){console.error(t)}}}class es{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[we()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};if(!s)return;const{request:n}=e||{},{payload:i}=n||{};this._hub.trigger("interaction",this._buildInteraction(t,{question_source:i&&i._meta&&i._meta.question_source}))}_buildInteraction({value:t,unselected:e},{question_source:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_source:s,value:e?"unselected":t}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ss{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=p(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function ns(t){return async({group:e,name:s,payload:n,options:i})=>e===l.ASK&&s===h.QUESTIONS?t.api.ask.questions(n,i):t.api[e]._run(s,n,i)}class is{constructor({role:t,workflow:e,...s}={}){y(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=N(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,x((()=>this._doRaf())))}_doRaf(){this._requested&&(this._requested=!1,this._applyRender())}_applyRender(t={}){if(!this._pending)return;const e=Date.now();let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),r=N([]),o=N({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),this._rendered.set(this._element,Object.freeze({...s,...o.value})),n&&n(...r.value)}_render(){throw Error("Unimplemented")}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function rs(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function os({className:t},{title:e,description:s,sale_price:n,original_price:i}){let r="";e&&(r+=`<div class="${t}__item-title">${S(e)}</div>`),s&&(r+=`<div class="${t}__item-desc">${S(s)}</div>`);const o=n||i;return o&&(r+=`<hr><div class="${t}__item-price">${o}</div>`),`<div class="${t}__item-info-container">${r}</div>`}function as({className:t,templates:e},{title:s,snippet:n,description:i,created_at:r,updated_at:o,published_at:a}){const c=a||r||o;let u="";return s&&(u+=`<div class="${t}__item-title">${S(s)}</div>`),c&&(u+=`<div class="${t}__item-date">${function(t,e=hs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||hs.locale,e);default:throw Error("Invalid date format: "+e)}}(c,e.date)}</div>`),n?u+=`<div class="${t}__item-snippet">${n}</div>`:i&&(u+=`<div class="${t}__item-desc">${S(i)}</div>`),`<div class="${t}__item-info-container">${u}</div>`}function cs({className:t,options:e={}},{product_id:s,url:n}){const{link:i={}}=e,{target:r="_blank",rel:o="noopener"}=i,a=n?"a":"div";return[`<${a} class="${t}__item-body" data-role="item" ${s?`${Kt}="${s}"`:""} ${n?`href="${n}" target="${r}" rel="${o}"`:""}>`,`</${a}>`]}function us({className:t},{cover_image:e}){if(!e)return"";return`<div class="${t}__item-cover-image-container">${`<img class="${t}__item-cover-image" src="${e}">`}</div>`}function ls({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}const hs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"});class _s extends is{constructor({className:t,templates:e,...s}={}){super(s),y(this,{className:t,templates:{...rs("root"),...e}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class ds extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){ds.MisoClient.ui.layouts.create("banner").render(this)}}class ps extends is{static get category(){return ee.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e})}_render(t,{state:e}){this._syncBanner(t),this._syncStatus(t,{state:e})}_syncBanner(t){const e=ds.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===Xt.PRODUCTS||t===Xt.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1}={}}=e,o=[s,r?ie.EMPTY:ie.NONEMPTY];s===ie.READY&&o.push(n?ie.ONGOING:ie.DONE),t.setAttribute("status",o.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}}const ms=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:r}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class fs extends _s{static get category(){return ee.ERROR}static get type(){return"error"}static get defaultTemplates(){return ms}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...ms,...e},...s})}}const gs='<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';const ys=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});const bs=Symbol.for("miso.value");const ws=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[r,o]=cs(t,s);return""+r+(i.imageBlock||us)(t,s,n)+(i.infoBlock||os)(t,s,n)+(i.indexBlock||ls)(t,s,n)+o},article:function(t,e,s,n){const{templates:i}=t,[r,o]=cs(t,s);return""+r+(i.imageBlock||us)(t,s,n)+(i.infoBlock||as)(t,s,n)+(i.indexBlock||ls)(t,s,n)+o},question:function(t,e,s){const[n,i]=cs(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e;return`<div class="${s} ${r}" ${n?`data-role="${n}"`:""}>${r===ie.READY?i[r](t,e):""}</div>`},[ie.READY]:function(t,e){const{templates:s}=t,n=e.value;return n&&n.length>0||e.ongoing?s.list(t,e,n):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:n,templates:i,options:r}=t,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-item-type="${r.itemType}">${i.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let r=n;return s.map((s=>i.item(t,e,s,r++))).join("")},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item">${r[a](t,e,s,{index:n})}</li>`}});class vs extends _s{static get category(){return ee.LIST}static get defaultTemplates(){return ws}constructor({templates:t,itemType:e="product",...s}){super({templates:{...ws,...t},itemType:e,...s}),y(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})}),this._view=void 0}initialize(t){this._view=t;const{proxyElement:e}=this._view=t;this._unsubscribes.push(e.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===ie.READY&&e.status===ie.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=t.value.slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i;this._syncValues(t,e)}_syncValues(t,e){if(!t)return;const s=e.value||[];let n=0;for(const e of this._listItemElements(t))e[bs]=s[n++]}_getListElement(t){return t.querySelector(`.${this.className}__list`)}_listItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_listBindings(t){if(!t)return[];const e=[];for(const s of this._listItemElements(t)){const t=s[bs];if(!t)continue;e.push({element:s,key:"product"===this.options.itemType?t.product_id:t,value:t})}return e}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=e[bs],{session:n}=this._view._state;this._view._events.emit("click",{session:n,value:s,element:e,domEvent:t})}destroy(){this._view=void 0,super.destroy()}}const Es="miso-list";class ks extends vs{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Es}constructor({className:t=Es,...e}={}){super({className:t,...e})}}const Cs="miso-cards";const Rs="miso-carousel",xs=Object.freeze({ready:function(t,e){const{templates:s}=t,n=e.value&&e.value.length>0,i=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return n?s.carousel(t,e,i):i},carousel:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-previous" data-role="previous">${i.previous(t,e)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(t,e)}</div>`},previous:Ss,next:Ss}),Os=Object.freeze({...vs.defaultTemplates,...xs});function Ss(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}var Is="1.9.8-beta.0";const As="miso-ui-icon",Ns=`${As}-svg-${Is.replaceAll(".","_")}`,$s=`<svg id="${Ns}" style="display:none;">${[`<symbol id="${As}-send" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,`<symbol id="${As}-search" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`].join("")}</svg>`;let Ts=!1;function qs(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use xlink:href="#${As}-${t}"></use></svg>`}Ts||document.head.querySelector("#"+Ns)||(Ts=!0,document.head.insertAdjacentHTML("beforeend",$s));const Us=qs("send"),Ps=qs("search"),js="miso-search-box";const Ls=Object.freeze({root:function(t){const{className:e,role:s,templates:n,options:i,workflow:r}=t,{autocomplete:o,placeholder:a,buttonText:c}=i;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${a?`placeholder="${a}"`:""}>\n    <button class="${e}__button" type="submit" data-role="button">${c||"search"===r?Ps:Us}</button>\n  </div>\n  ${o?n.autocomplete(t):""}\n</div>\n`},autocomplete:function(t){const{className:e,templates:s}=t;return`\n<div class="${e}__autocomplete" data-role="autocomplete">\n  ${s.suggestionList(t)}\n</div>\n`},suggestionList:function(t){const{className:e}=t;return`<ol class="${e}__suggestion-list" data-role="suggestion-list"></ol>`},suggestionItem:function(t,e){const{className:s}=t;return`<li class="${s}__suggestion-item" data-role="suggestion-item" tabindex="0">${S(e.text||e)}</li>`}});class Ms extends _s{static get category(){return ee.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return Ls}static get defaultClassName(){return js}constructor({className:t=js,templates:e,...s}={}){super({className:t,templates:{...Ls,...e},...s}),this._contexts=new WeakMap,this._suggestionItems=new WeakMap}initialize(t){const{autocomplete:e}=this.options;this._view=t;const{proxyElement:s,hub:n}=t;this._unsubscribes=[...this._unsubscribes,s.on("keydown",(t=>this._handleKeyDown(t))),s.on("click",(t=>this._handleClick(t)))],e&&this._unsubscribes.push(n.on("suggestions",(()=>this._handleInput())))}focus(){this._element?this._context().focus():this._focusRequested=!0}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){t=super._preprocess({state:t});const{autocomplete:e}=this.options;if(!e)return t;const s=this._view.hub.states.suggestions;return{...t,suggestions:s}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._setupAutocomplete(t),this._renderSuggestions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_setupAutocomplete(t){const{autocomplete:e}=this.options;e&&this._context(t).setupAutocomplete()}_renderSuggestions(t,{state:e},{writeToState:s}={}){const{autocomplete:n}=this.options;if(!n)return;const{suggestionListElement:i,autocompleteElement:r}=this._context(t);if(!i)return void(s&&s({suggestions:{value:[]}}));const{suggestions:o={}}=e,a=o.value||[];r.classList[0===a.length?"add":"remove"]("empty"),i.innerHTML=a.map((t=>this.templates.suggestionItem(this,t))).join("");let c=0;for(const t of i.children)this._suggestionItems.set(t,a[c++])}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Ds.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Ds(t)),e}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick({target:t}){const{inputElement:e}=this._context();for(let s=t;s&&s!==this._view.element;s=s.parentElement)if(s.matches('[type="submit"]')||s.matches('[data-role="button"]'))return void(e&&(e.blur(),this._submit(e.value)));const{autocomplete:s}=this.options;if(s)for(let s=t;s&&s!==this._view.element;s=s.parentElement){const t=this._suggestionItems.get(s);if(!t)continue;const n=t.text||t;return e&&(e.value=n),void this._submit(n)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}class Ds{static empty(){return Ds._empty||(Ds._empty=new Ds)}constructor(t){this._element=t,this._cache={}}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get suggestionListElement(){return this._get("suggestion-list")}setupAutocomplete(){if(!this._element||this._autocompleteSetup)return;this._autocompleteSetup=!0;const{inputElement:t,autocompleteElement:e}=this;t&&e&&(t.addEventListener("focus",(()=>{e.classList.add("open")})),t.addEventListener("blur",(()=>{e.classList.remove("open")})))}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const zs=Symbol.for("miso.option-value"),Qs="miso-option-list";const Bs=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${S(e.text||e)}</li>`}});class Gs extends _s{static get category(){return ee.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return Bs}static get defaultClassName(){return Qs}constructor({className:t=Qs,templates:e,...s}={}){super({className:t,templates:{...Bs,...e},...s}),y(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})})}initialize(t){this._view=t;const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s),this._syncOptionValues(t,e)}_syncOptionValues(t,{state:e}){if(!t)return;const s=this._getOptionsElement(t);if(!s)return;const n=e.value||[];s.classList[0===n.length?"add":"remove"]("empty");let i=0;for(const t of this._listOptionElements(s))t[zs]=n[i++]}_listBindings(t){if(!t)return[];const e=this._getOptionsElement(t),s=[];for(const t of this._listOptionElements(e)){const e=t[zs];if(!e)continue;s.push({key:e.text||e,value:e,element:t})}return s}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_listOptionElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){for(let e=t.target;e&&e!==this._view.element;e=e.parentElement){const t=e[zs];if(t)return void this._submit(t.text)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}const Ws=Object.freeze({...rs("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class Vs extends _s{static get category(){return ee.RADIO}static get defaultTemplates(){return Ws}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...Ws,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=this._view=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=k(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],x((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Fs="miso-feedback",Hs=[{text:"Helpful",value:"helpful",icon:gs},{text:"Not helpful",value:"unhelpful",icon:gs}];const Ks=Object.freeze({options:function(t){const{templates:e}=t;return Hs.map((s=>e.option(t,s))).join("")},content:function(t,{text:e,icon:s}){const{className:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${n}__icon">${s}</i>`:""}\n${!1!==i.text?`<span class="${n}__text">${e}</span>`:""}\n`}});class Ys extends Vs{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return Ks}static get defaultClassName(){return Fs}constructor({className:t=Fs,templates:e,...s}={}){if(super({className:t,templates:{...Ks,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Zs="miso-text";const Xs=Object.freeze({root:function(t,e){const{className:s,role:n,options:{tag:i}}=t;return`<${i} class="${s}" ${n?`data-role="${n}"`:""}>${S(e.value||"")}</${i}>`}});class Js extends _s{static get category(){return ee.TEXT}static get type(){return"text"}static get defaultTemplates(){return Xs}static get defaultClassName(){return Zs}constructor({className:t=Zs,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...Xs,...e},tag:s,...n})}}class tn extends is{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t={}){const e=N(!1);super._applyRender({...t,loop:e.t}),e.value&&this._requestRaf()}}class en{constructor(t={}){this._cps=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return({doneAt:s,timestamp:n})=>{let i=t*(Math.random()+.5);return e>0&&void 0!==s&&(i*=1+(n-s)*e/1e3),i}}(t)}get(t,e){const s=this._cps(e);return t.cursor+Math.floor((e.timestamp-t.timestamp)*s/1e3)}}class sn{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function nn(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,rn(e)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||ie.INITIAL),n}function rn(t){return t+"__cursor"}const on="miso-typewriter";class an extends tn{static get category(){return ee.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return on}constructor({className:t=on,tag:e="auto",format:s="markdown",...n}={}){super({tag:e,format:s,...n}),y(this,{className:t}),this._prevState=void 0,this._progress=new en(n),this._readiness=new T,"markdown"===s&&an.MisoClient.plugins.install("std:ui-markdown")}initialize(t){this._view=t,this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown"),e=rn(this.className);this._renderer=t.createRenderer({onRefChange:(t,s)=>{t&&t.classList.remove(e),s&&s.classList.add(e)},onDone:t=>{t.classList.add("done")},onDebug:this.options.onDebug||void 0}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._handleClick(t))))}async _setupForPlaintext(){this._renderer=new sn}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==ie.READY||o?void 0:Date.now());return this._prevState=Object.freeze(f({session:i,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=nn(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._progress.get(s,e);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);i(a);const c=e.status===ie.READY&&!a.done;n({ongoing:c},{silent:c&&(!s||s.status===ie.READY)}),c&&r()}_handleClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}var cn=Object.freeze({__proto__:null,TemplateBasedLayout:_s,ContainerLayout:ps,ErrorLayout:fs,BannerLayout:class extends _s{static get category(){return ee.BANNER}static get type(){return"banner"}static get defaultTemplates(){return ys}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...ys,...e},...s})}},CollectionLayout:vs,ListLayout:ks,CardsLayout:class extends vs{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Cs}constructor({className:t=Cs,...e}={}){super({className:t,...e})}},CarouselLayout:class extends vs{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return Os}static get defaultClassName(){return Rs}constructor({className:t=Rs,templates:e,...s}={}){super({className:t,templates:{...xs,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._itemCount=n.value?n.value.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:Ms,OptionListLayout:Gs,FeedbackLayout:Ys,TextLayout:Js,TypewriterLayout:an});const un=Object.freeze({[Xt.CONTAINER]:ps.type,[Xt.ERROR]:fs.type});class ln extends Q{constructor({name:t,context:e,plugin:s,client:n,roles:i,defaults:r}){super(t||"workflow",s),this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,this._name=t,this._roles=i;const o=this._extensions=s._getExtensions(n),a=this._options=new fe(e&&e._options,function(t,{layouts:e,interactions:s,...n}={}){const i={preprocess:[e=>t._preprocessInteraction(e)]};return{...n,layouts:ue(un,e),interactions:de(i,s)}}(this,r)),c=this._hub=function(t,e){const{update:s,trigger:n}=t;return t.update=(n,i,r)=>(r&&r.silent||e("update",n,i,r),s.call(t,n,i,r)),t.trigger=(...s)=>(e("trigger",...s),n.apply(t,s)),t}(new Ee,((...t)=>this._log(...t))),u=this._source=ns(n),l=s.layouts;this._sessions=new ke(c),this._data=new Ce(c,{source:u,options:a});const h=this._views=new Se(c,{extensions:o,layouts:l,roles:i,options:a,workflow:t});this._interactions=new ss(c,{client:n,options:a}),this._trackers=new ts(c,{views:h,options:a}),this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t)))]}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this.reset(),this.start(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid===this.session.uuid){this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);return this._hub.update(we(),t),this}}_defaultProcessData(t){const{value:e}=t;return e&&e.miso_id?{...t,meta:{...t.meta,miso_id:e.miso_id}}:t}notifyViewUpdate(t,e){return this._assertActive(),e={status:ie.READY,session:this.session,...e},this._hub.update(ve(t),e),this}useApi(...t){return this._options.api=t,this}useLayouts(t={}){return this._options.layouts=t,this}useDataProcessor(t){return this._options.dataProcessor=t,this}useTrackers(t){return this._options.trackers=t,this}useInteractions(t){return this._options.interactions=t,this}get trackers(){return this._trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:n,name:i}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:n,api_name:i,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._trackers._destroy(),this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}const hn=Object.freeze({group:l.ASK,name:h.QUESTIONS,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),_n=Object.freeze({[Xt.QUERY]:[Ms.type,{placeholder:"Ask a question"}],[Xt.QUESTION]:[Js.type,{tag:"h2"}],[Xt.ANSWER]:an.type,[Xt.FEEDBACK]:Ys.type,[Xt.SOURCES]:[ks.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Xt.RELATED_RESOURCES]:[ks.type,{incremental:!0,itemType:"article"}],[Xt.QUERY_SUGGESTIONS]:Gs.type}),dn=Object.freeze({[Xt.SOURCES]:{},[Xt.RELATED_RESOURCES]:{},[Xt.QUERY_SUGGESTIONS]:{active:!0,click:{validate:t=>0===t.button}}}),pn=Object.freeze({api:hn,layouts:_n,trackers:dn});class mn extends ln{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(_n),defaults:pn}),this._context=t,this._autoQuery=!1,y(this,{parentQuestionId:e}),this._feedback=new es(this._hub),this._setSuggestedQuestions(),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this.query(t))),this._hub.on(ve(Xt.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Xt.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))],e&&t._byPqid.set(e,this),t._events.emit("create",this),this.reset()}get questionId(){return this._questionId}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,n=new URLSearchParams(window.location.search),i=n.get("q"),r=n.get("qs"),{layout:o}=this._views.get(Xt.QUERY);o&&(i&&e&&(o.value=i),!i&&s&&o.focus()),i&&this.query({q:i,qs:r})}query({q:t,qs:e,...s}={}){s={...s,question:t},e=e||Zt,this.parentQuestionId&&(s.parent_question_id=this.parentQuestionId),(s._meta||(s._meta={})).question_source=e,this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0),this.restart();const{session:n}=this;return n.meta.question_source=e,this._hub.update("request",ae(this._options.resolved.api,{payload:s,session:n})),this}restart(){const{session:t,status:e,ongoing:s}=this._hub.states[ve(Xt.ANSWER)]||{};if(t&&e!==ie.INITIAL&&(e!==ie.READY||s)){const n=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",n),this._emit("finally",n)}super.restart()}_defaultProcessData(t){t=super._defaultProcessData(t);const{value:e,request:s}=t;if(!e)return t;const{question_id:n,question:i}=e,r=s&&s.payload&&s.payload._meta&&s.payload._meta.question_source===Zt;if(!this._questionId&&n&&(this._questionId=n,this._context._byQid.set(n,this)),this._autoQuery&&!1!==this._autoQuery.updateUrl){const t=new URL(window.location);i===t.searchParams.get("q")||r&&!0!==this._autoQuery.updateUrl||(t.searchParams.set("q",i),window.history.replaceState({},"",t))}return{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:e.answer_stage}}}_onDataUpdate(t){if(this._questionId)return;const e=t&&t.value&&t.value.question_id;e&&(this._questionId=e,this._context._byQid.set(e,this))}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===ie.INITIAL)return;const n=e===ie.READY&&!s,i=e===ie.ERRONEOUS,r=n?"done":i?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._emit(r,o),(n||i)&&this._emit("finally",o)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[we()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_onCitationClick({index:t}){const{value:e}=this.states[we()]||{},{sources:s}=e||{},n=s&&s[t-1];n&&n.product_id&&this._trackers.sources.click([n.product_id],{manual:!1})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;let{rootQuestionId:n,parentQuestionId:i,questionId:r}=this;return s.property===Xt.QUERY_SUGGESTIONS&&(r=i,i=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions",s.question_source=this.previous&&this.previous.session.meta.question_source),t.context={...e,custom_context:f({root_question_id:n,parent_question_id:i,question_id:r,...s})},t}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),this._feedback._destroy(),super._destroy(t)}}class fn extends be{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new mn(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new mn(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const gn=Object.freeze({group:l.ASK,name:h.RELATED_QUESTIONS}),yn=Object.freeze({[Xt.RELATED_QUESTIONS]:[ks.type,{itemType:"question"}],[Xt.QUERY]:[Ms.type,{placeholder:"Ask a question"}]}),bn=Object.freeze({[Xt.RELATED_QUESTIONS]:{}}),wn=Object.freeze({api:gn,layouts:yn,trackers:bn});class vn extends ln{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(yn),defaults:wn}),this._productId=void 0,this._linkFn=void 0,this._unsubscribes=[...this._unsubscribes,this._views.get(Xt.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start(){if(void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:t}=this;return this._hub.update("request",ae(this._options.resolved.api,{session:t})),this}notifyViewUpdate(t=Xt.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._getAnswersUrl(t,!0)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._getAnswersUrl(t);window.open(e,"_blank")}_getAnswersUrl(t,e=!1){if(!this._linkFn)return;const s=this._linkFn(t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}const En=Object.freeze({group:l.SEARCH,name:h.SEARCH,payload:{fl:["*"]}}),kn=Object.freeze({[Xt.QUERY]:Ms.type,[Xt.PRODUCTS]:ks.type}),Cn=Object.freeze({[Xt.PRODUCTS]:{}}),Rn=Object.freeze({api:En,layouts:kn,trackers:Cn});class xn extends ln{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(kn),defaults:Rn}),this._unsubscribes.push(this._hub.on("query",(t=>this.query(t))))}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:n}=this._views.get(Xt.QUERY);n&&(s&&t&&(n.value=s),!s&&e&&n.focus()),s&&this.query({q:s})}query(t){this.restart();const{session:e}=this;return this._hub.update("request",ae(this.options.resolved.api,{payload:t,session:e})),this}notifyViewUpdate(t=Xt.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}const On=Object.freeze({group:l.RECOMMENDATION,name:h.USER_TO_PRODUCTS,payload:{fl:["*"]}}),Sn=Object.freeze({[Xt.PRODUCTS]:ks.type}),In=Object.freeze({[Xt.PRODUCTS]:{}}),An=Object.freeze({api:On,layouts:Sn,trackers:In});class Nn extends ln{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(Sn),defaults:An}),y(this,{id:e}),this._context=t,t._members.set(e,this)}start(){this._sessions.start();const{session:t}=this;return this._hub.update("request",ae(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(Xt.CONTAINER),this.notifyViewUpdate(Xt.PRODUCTS),this}notifyViewUpdate(t=Xt.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:f({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class $n extends be{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=Yt){if(this._members.has(t))throw Error("Unit already exists: "+t);return new Nn(this,t)}has(t=Yt){return this._members.has(t)}get(t=Yt){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new Nn(this,t)}}class Tn extends Q{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new T)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const qn="miso-ask-combo";var Un=Object.freeze({__proto__:null,CLASS_PREFIX:qn});var Pn=Object.freeze({__proto__:null,question:"You asked...",sources:"My reply is based on the following",relatedQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});function jn({classPrefix:t=qn,circledCitationIndex:e=!0,...s}={}){return{classPrefix:t,circledCitationIndex:e,...s}}function Ln(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}function Mn(t){const{features:e={},logo:s=!0}=t;return Wn(t,{name:"related-resources"},!1===e.relatedResources?"":Vn(t,{name:"related-resources",visibleWhen:"nonempty",logo:s},[Gn(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}function Dn(t){const{features:e={}}=t;return!1===e.querySuggestions?"":Vn(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[Gn(t,{name:"related-questions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}function zn(t){return[Qn(t),Bn(t),Vn(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}function Qn(t){return Vn(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",Gn(t,{name:"question",tag:"div"}),"<miso-question></miso-question>","<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}function Bn(t){return Vn(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",Gn(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}function Gn(t,{name:e,tag:s="div"}){const{classPrefix:n}=t;return`<${s} class="${n}__phrase ${n}__${e}-phrase">${function(t,e){const{phrases:s={}}=t,n=s[e]||Pn[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}(t,(i=e,i.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))))}</${s}>`;var i}function Wn({classPrefix:t},{name:e},s){return Fn("section",{classes:[t+"__section",`${t}__${e}`]},s)}function Vn({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),Fn("miso-ask",{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}function Fn(t,e={},s=""){return("string"==typeof e||Array.isArray(e))&&(s=e,e={}),`<${t}${function({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${Hn(t)}="${n}"`)}return s}(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}function Hn(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}var Kn=Object.freeze({__proto__:null,root:function(t={}){return""+Wn(t=jn(t),{name:"question"},[Vn(t,{name:"query"},"<miso-query></miso-query>")])+Wn(t,{name:"answer"},zn(t))+Ln(t)+Mn(t)},followUp:function(t={}){return Wn(t=jn(t),{name:"follow-up"},[Dn(t),Vn(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...zn(t)])}});const Yn=Object.freeze(Un),Zn=Object.freeze(Pn),Xn=Object.freeze(Kn);var Jn=Object.freeze({__proto__:null,constants:Yn,phrases:Zn,templates:Xn});const{currentScript:ti}=document,ei=Object.freeze({templates:Xn,autostart:!0}),si=["templates","phrases","features"];class ni{constructor(){this._defaults=ei,this._scriptSrc=function(){if(!ti||!ti.src)return{};const t=document.createElement("a");t.href=ti.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=oi(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=oi(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return f({apiKey:t,apiHost:e,templates:ai(s),phrases:n,...i})}(ii(this._defaults,this._scriptSrc,t,this._pageUrl))}}function ii(...t){let e={};for(const s of t)s&&(e=ri(e,s));return e}function ri(t,e){if(!e)return t;Object.assign(t,e);for(const s of si)s in e&&(t[s]={...t[s],...e[s]});return t}function oi(t){return""===t||"false"!==t&&t}function ai(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(ai):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,ai);default:throw Error("Unsupported template type: "+t)}}class ci{constructor(t,{classPrefix:e=Yn.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");y(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class ui extends Tn{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new ni,this._localOptions={}}config(t={}){t=ii(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;y(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new ci(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{client:t,elements:e,resolvedOptions:s}=this,{templates:n={},features:i={},api:r}=s,o=t.ui.asks,a=t.ui.ask;r&&o.useApi(r),e.followUpsSection&&!1!==i.followUpQuestions&&(o.on("done",(({workflow:t})=>{e.followUpsSection.insertAdjacentHTML("beforeend",n.followUp({...s,parentQuestionId:t.questionId}))})),a.on("loading",(()=>{e.followUpsSection.innerHTML="",o.reset({root:!1})}))),e.relatedResourcesContainer&&!1!==i.relatedResources&&!1!==i.followUpQuestions&&o.on("loading",(({workflow:t})=>{e.relatedResourcesContainer.workflow=t})),a.autoQuery()}}class li extends B{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let hi,_i,di;async function pi(t){const e=await async function(t){return t.MisoClient||window.MisoClient||hi||(hi=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return _i=_i||e.any(),di=di||await _i,di.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),di}const mi="logo",fi="auto",gi=Object.freeze([mi]);function yi(t){if(!t)return fi;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class bi extends HTMLElement{static get observedAttributes(){return gi}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return yi(this.getAttribute(mi))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case fi:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(mi,e):this.removeAttribute(mi)}async connectedCallback(){const t=this._client=await pi(bi);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===mi)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){yi(t)!==yi(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const wi="parent-question-id",vi=Object.freeze([...bi.observedAttributes,wi]);const Ei="unit-id",ki=Object.freeze([...bi.observedAttributes,Ei]);var Ci=Object.freeze({__proto__:null,MisoAskElement:class extends bi{static get tagName(){return"miso-ask"}static get observedAttributes(){return vi}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(wi)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(wi,t):this.removeAttribute(wi))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===wi)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends bi{static get observedAttributes(){return bi.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoSearchElement:class extends bi{static get observedAttributes(){return bi.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends bi{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return ki}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(Ei)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Ei,t):this.removeAttribute(Ei)}attributeChangedCallback(t,e,s){if(t===Ei)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const Ri="role",xi=Object.freeze([Ri]);class Oi extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return xi}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(Ri);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ri}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${Ri}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===Ri&&this._container&&this._container._updateComponentRole(this,e,s)}}var Si=Object.freeze({__proto__:null,MisoComponentElement:Oi,MisoQueryElement:class extends Oi{constructor(){super({role:Xt.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends Oi{constructor(){super({role:Xt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Oi{constructor(){super({role:Xt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Oi{constructor(){super({role:Xt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Oi{constructor(){super({role:Xt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Oi{constructor(){super({role:Xt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Oi{constructor(){super({role:Xt.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends Oi{constructor(){super({role:Xt.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends Oi{constructor(){super({role:Xt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Oi{constructor(){super({role:Xt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoErrorElement:class extends Oi{constructor(){super({role:Xt.ERROR})}static get tagName(){return"miso-error"}}});class Ii extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Ii.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var Ai=Object.freeze({__proto__:null,containers:Ci,roles:Si,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Ii{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:ds});const Ni=Object.freeze(Jn);var $i=Object.freeze({__proto__:null,ask:Ni});let Ti,qi;async function Ui(){return qi||(qi=async function(){try{let t=document.head.querySelector(`link[href="${Pi()}"]`);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=Pi(),document.head.appendChild(t)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(ji(t))return;return new Promise((e=>{let s;s=setInterval((()=>{ji(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(t)}catch(t){console.error(t)}}())}function Pi(){return Ti||(Ti=`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${Is}/dist/css/ui.css`)}function ji(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}class Li{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Mi{constructor(t,e){this._plugin=t,this._client=e,y(this,{sources:{api:ns(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new xn(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get explore(){return this._explore||(this._explore=new vn(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Di{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new ui(this._plugin,this._MisoClient))}}let zi,Qi;async function Bi(){return zi||(zi=async function(){return async function(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function Gi(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(zt,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||e.debug;n&&zt.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&zt.plugins.use("std:dry-run");return window.MisoClientSA=zt,zt}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const n=window.misoSA=new e(s);return n.context.anonymous_id=await async function(){if(Qi)return Qi;const t=await Bi();return Qi=t.get("clientId")}(),n}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function Wi(t){return e=>({...e,context:{...e.context,custom_context:{...Vi(t),...e.context&&e.context.custom_context}}})}function Vi({site:t,version:e}){return{source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",site:t.key,uuid:I()}}async function Fi(t,{paragraphs:e=10}={}){const{debug:s}=t,n=(i=e,document.querySelectorAll(".article__main .article-column__content > p:not(:empty)")[i-1]);var i;if(!n)return void s("[Discovery] No block shown: cannot find the reference position for discovery block.");const[[r,o]]=await Promise.all([Gi(t),F(t)]),a=ut(t);n.insertAdjacentElement("afterend",a),function(t,{client:e}){const{site:s,page:n}=t,{product_id:i}=n,r=e.ui.explore;r.useApi({_meta:{site:s.key},product_id:i}),r.useLink((t=>"/smart-answers?q="+encodeURIComponent(t))),r.useLayouts({related_questions:{link:{rel:"noopener nofollow"}}}),r.useInteractions({preprocess:Wi(t)}),r.start()}(t,{MisoClient:r,client:o,rootElement:a})}zt.plugins.use(class extends Q{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new li(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new T}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:$i};g(s,this,["layouts","combo","ready"]),y(this,{MisoClient:t}),y(t,{ui:s}),this.combo=new Di(this,t);const n=Object.values(cn).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:r,combos:o,...a}=Ai,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];bi.MisoClient=t,Ii.MisoClient=t;for(const e of c)e.MisoClient=t;await Ui();for(const t of c)R(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){y(t,{ui:new Mi(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Li(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new $n(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new fn(this,t)),e}});const Hi="#explore-a-topic";async function Ki(t){const{debug:e}=t,s=function({}){const t=document.querySelector(Hi);return t&&t.parentElement.parentElement}(t);if(!s)return void e(`[Discovery] No block shown: cannot find the reference position (${Hi}) for discovery block.`);await Promise.all([Gi(t),F(t)]);const n=lt(t);s.insertAdjacentElement("afterend",n);const i=n.querySelector("form");i.addEventListener("submit",(t=>function(t,e){t.preventDefault();const s=e.querySelector("input").value.trim();if(!s)return;const n="/smart-answers?q="+encodeURIComponent(s);window.open(n,"_blank","noopener")}(t,i)))}(async t=>{const{version:n,page:i,debug:r}=t;if(i.type!==e)if(window.miso_smart_answers_script_version)console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);else switch(window.miso_smart_answers_script_version=n,r("Miso Smart Answers script version: "+n),i.type){case"home":await Ki(t);break;case s:await Fi(t);break;default:r("[Discovery] No discovery block for page type: "+i.type)}})(nt)}();
