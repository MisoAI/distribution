!function(){"use strict";const t="home",e="answers",s="article",i="other",n=["cover_image","custom_attributes.site","created_at","product_id","published_at","snippet","title","updated_at","url"];var r="0.9.29-beta.0";var o=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,i]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===i||i);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const a={key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"},c=window.location.hostname!==a.hostname;var u={...a,dev:c};function l(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const h=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),d=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var _=Object.freeze({__proto__:null,GROUP:h,NAME:d});function p(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function m(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function f(t){return null!=t?""+t:t}function g(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function y(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function b(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function v(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class w{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);E(s),E(i),E(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>k(this,t)),e):k(this,t),this._value=t}disconnect(){this._active=!1}}function k(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function E(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function C(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function x(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function I(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async i=>{try{await t(i),e()}catch(t){s(t)}}))}))}async function O(t,{area:e=.5,duration:s=1e3,signal:i}={}){var n;return t="string"==typeof(n=t)?document.querySelector(n):n,new Promise(((n,r)=>{const o=new w((t=>{t&&(o.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function R(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function S(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function $(t,e){const s=window.localStorage.getItem(t),i=function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t),n=s||i||""+e();return n&&!s&&window.localStorage.setItem(t,n),n&&!i&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n),n}function A(t){return new T(t)}class T{constructor(t){this._value=t;const e=t=>{this._value=t};b(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class N{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class q{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){for(let t=0;;t=this._index+1){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new N),await this._resolution.promise),this._aborted)break;if(yield this._value,this._done)break}}}var U="1.10.1";let P;try{P=document.currentScript}catch(t){}async function j(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if(L(t))return;return new Promise((e=>{let s;s=setInterval((()=>{L(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function L(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function M(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}const z=100,D=4;function B(t){const e=function({speed:t=z,acceleration:e=D}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let n=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(n*=1+(s-i)*e/1e3),n}}(t);return(t,s,i,n)=>{const r=e(i,s);return t+Math.max(n-i,0)*r/1e3}}const Q=Symbol.for("miso:resources");class F{constructor(){this._resources=new Map;const t=window[Q]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){G(this._resources,t).resolve(e)}async get(t){return G(this._resources,t).promise}}function G(t,e){if(t.has(e))return t.get(e);const s=new N;return t.set(e,s),s}function W(){return window[Q]||(window[Q]=new F)}class V{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new N;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class H{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)p(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&p(s,e)}}_injectSubscribeInterface(t){y(t,this,["on","once"])}}function K(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class Y{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:K(t,e),uuid:S()})}(t,e);b(this,{meta:s});const i=this._error=this._error.bind(this);(this._events=new H({error:i,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(Y,"miso:component");class Z extends Y{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new N);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class X{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new w(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class J{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:tt}=document,et=tt.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/discovery$/,"");async function st({}){await Promise.all([nt()])}let it=!1;async function nt(){if(it)return;if(it=!0,!tt)throw Error("currentScript not found");const t=tt.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=s,i.href=t,document.head.appendChild(i)}))}(s)}function rt(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${et}/${t}`}const ot=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"}].map((({logo_image:t,...e})=>({logo_image:rt(t),...e}))),at=ot.reduce(((t,e)=>(t[e.key]=e,t)),{});function ct(t){return at[t]}var ut=Object.freeze(function(){const n=(r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r;var r;switch(n){case"":return{type:t};case"/smart-answers":return{type:e};default:if(u.regions.indexOf(n.substring(1))>=0)return{type:t}}const o=n.substring(1).split("/");if("article"===o[0]){const t=""+o[1];return{type:s,postId:t,product_id:`article_${u.key}_${t}`}}return{type:i}}());const lt="%cMiso",ht="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const dt=[];var _t=function(){if(o.sponsor)return dt.find((t=>t.key===o.sponsor))||void 0}(),pt=Object.freeze({__proto__:null,config:o,version:r,site:u,page:ut,sponsor:_t,debug:function(...t){!function(...t){console.log(lt,ht,...t)}(...t)}}),mt="1.10.1";const ft=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class gt{constructor(t,e){this._client=t,this._root=e,this._bulk=new V(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(t,g({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var d=Error(h.message);throw d.data=h,d.status=l.status,d}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=ft.DATA_ENDPOINT,eventEndpoint:s=ft.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){t.error(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){t.error(e)}return i}}class yt extends Y{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:bt,NAME:vt}=_;class wt extends yt{constructor(t){super(t,bt.INTERACTIONS)}async upload(t,e){try{return await this._run(vt.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===vt.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}const{GROUP:kt,NAME:Et}=_;class Ct extends yt{constructor(t){super(t,kt.ASK)}async questions(t,e={}){if("string"==typeof t&&"{"!==t.charAt(0))return new xt(this,{question_id:t},e);const s=await this._run(Et.QUESTIONS,t,e);return new xt(this,s,e)}async _questions(t,e){return this._run(Et.QUESTIONS,t,e)}async _get(t,e){return this._run(`${Et.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(Et.RELATED_QUESTIONS,t,e)}}class xt{constructor(t,{question_id:e},s={}){this._api=t,this._questionId=e,this._ac=new AbortController,this._options=s}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,{...this._options,...t})}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...i}=this._options;const n=new J(s);let r;e=l(this._ac.signal,n.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a=0,c=-1,u=-1,l=!1;function h(){o&&clearInterval(o),l=!0}const d=new q;return o=setInterval((async()=>{const e=++c;let o,_;try{if([o,_]=await t(r?{signal:r}:{}),l||u>e)return;u=e,n&&n(o,_),a=0}catch(t){return i&&i(t),a++,void(a>s&&(h(),d.error(t)))}d.update(o,_),_&&h()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{h(),d.abort(r.reason)})),d}((async({}={})=>{const t=await this.get();return[t,t.finished]}),{interval:t,signal:e,onResponse:(t,e)=>{var s,i;e?n.clear():(i=t,(s=r)&&s.answer_stage===i.answer_stage&&s.answer.length===i.answer.length||n.touch()),r=t},...i})[Symbol.asyncIterator]()}}const{GROUP:It,NAME:Ot}=_;class Rt extends yt{constructor(t){super(t,It.SEARCH)}async search(t,e){return this._run(Ot.SEARCH,t,e)}async autocomplete(t,e){return this._run(Ot.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(Ot.MGET,t,e)}}const{GROUP:St,NAME:$t}=_;class At extends yt{constructor(t){super(t,St.RECOMMENDATION)}async userToProducts(t,e){return this._run($t.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run($t.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run($t.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run($t.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run($t.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run($t.PRODUCT_TO_PRODUCTS,t,e)}}class Tt extends Y{constructor(t,e){super("api",t),this._client=t,this.helpers=new gt(t,e),this.interactions=new wt(this),this.ask=new Ct(this),this.search=new Rt(this),this.recommendation=new At(this)}}var Nt=Object.freeze({__proto__:null,Api:Tt,ApiBase:yt,ApiHelpers:gt,Interactions:wt,Ask:Ct,Search:Rt,Recommendation:At});class qt extends Y{constructor(t){super("context",t),this._client=t}}var Ut={api:Nt,context:{Context:qt}};class Pt{constructor(t){b(this,{install:t})}}class jt extends Z{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Lt(this,Ut),this.plugins=new Mt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new N);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return b(i,{id:t}),this._tryConfig(i,e),i;case"function":return new Pt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new W).get(s);!this.isRegistered(t)&&this.register(i)}}class Lt{constructor(t,e){y(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),b(this,{classes:e})}}class Mt{constructor(t){y(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const zt=new class extends Y{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new jt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=mt,this._cmdRes=new N}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Dt=Object.freeze({__proto__:null,viewable:O,debounce:M});const{currentScript:Bt}=document;class Qt extends Y{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Qt),window.MisoClient?window.MisoClient!==Qt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Qt}constructor(t){super("client",zt),this._config(t),this.context=new qt(this),this.api=new Tt(this,zt),function(t){zt._clients.push(t),zt._events.emit("create",t)}(this)}get version(){return Qt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,g(t)}_readConfigFromScriptUrl(){return g({apiKey:new URL(new Request(Bt.src||Bt.href).url).searchParams.get("api_key")||void 0})}}Qt.helpers=Dt,b(Qt,{uuid:S()});var Ft=function(t){const e=zt._pluginRoot;return zt.MisoClient=e.MisoClient=t,y(t,zt,["version","instances","any","meta","on","once","cmdDone"]),y(t,e,["plugins"]),t}(Qt);const{GROUP:Gt,NAME:Wt}=_;class Vt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=$("miso_anonymous_id",S))}set anonymous_id(t){t=f(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=f(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function Ht(){const t=new URLSearchParams(window.location.search);let e=g({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Kt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function Yt(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:mt};return s.uuid||(s.uuid=S()),{...t,context:{...e,custom_context:s}}}function Zt({text:t="Miso"}={}){return"%c"+t}function Xt({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}function Jt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}Ft.plugins.register(class{constructor(t={}){this._options=t}static get id(){return"std:debug"}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t)}config(t={}){this._options={...this._options,...t}}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,n="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logr(...t){const e=this._options.console||{};console.log(Zt(e),Xt(e),...t)}_log(t,e,...s){const i=this._options.console||{};console.log(Zt(i),Xt(i),function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Jt)):this._log(t,e,Jt(s))}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}}),Ft.plugins.use(class extends Y{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Vt(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===Gt.INTERACTIONS&&s===Wt.UPLOAD?this._modifyPayloadForInteractions(t,i):e===Gt.ASK&&s===Wt.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=g({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...n,...t})))}}}),Ft.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...g({page:g({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:Ht()}),...t.context}})))}}}),Ft.plugins.use(class extends Y{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Kt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:i}){if(e===h.SEARCH)if(s===d.SEARCH)this._captureSearchApiRequest(t,i)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Ft.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Yt)}}});const te="data-miso-product-id",ee="default",se="_organic",ie=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",ERROR:"error"}),ne=new Set([ie.PRODUCTS,ie.CATEGORIES,ie.ATTRIBUTES,ie.RESULTS,ie.ITEMS,ie.QUESTION,ie.ANSWER,ie.SOURCES,ie.RELATED_RESOURCES,ie.QUERY_SUGGESTIONS,ie.RELATED_QUESTIONS,ie.AFFILIATION]);function re(t){return ne.has(t)}const oe=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",TEXT:"text",AFFILIATION:"affiliation",ERROR:"error"}),ae=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click"}),ce=[ae.IMPRESSION,ae.VIEWABLE,ae.CLICK],ue=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),le=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function he(t){if(0>ce.indexOf(t))throw Error("Unrecognized event type: "+t)}function de(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function _e(t){if(void 0===t)return;let[e,s]=m(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function pe(t){t=m(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t}function me(...t){return!1!==t[t.length-1]&&Ae(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...fe("_meta",s,i)})});var s,i}))}function fe(t,e,s){const i=e&&e[t],n=s&&s[t],r=i?n?{...i,...n}:i:n;return void 0!==r?{[t]:r}:{}}function ge(...t){return!1!==t[t.length-1]&&Ae(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=ye(t[s],i);return t}))}function ye(t,e){return!1===(e=_e(e))[0]?e:t&&e?[e[0]||t[0],be(t[1],e[1])]:e||t}function be(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function ve(...t){return t.flat().filter(Boolean)}function we(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function ke(...t){return!1!==t[t.length-1]&&Ae(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}const Ee=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return g({group:s,name:t,payload:e})},merge:me},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[ie.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[ie.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[ie.PRODUCTS]}: ... }) instead`),t={...s,[ie.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[de(e)]=_e(s);return i},merge:ge},{key:"dataProcessor",normalize:pe,merge:ve},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&Ae(t,((t,e)=>Object.assign(t,{...e,impression:we(t.impression,e.impression),viewable:we(t.viewable,e.viewable),click:we(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=m(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:ke},{key:"autocomplete",normalize:function(t){if(void 0===t)throw Error("Expect autocomplete options to be an object or a boolean value: "+t);"boolean"==typeof t&&(t={actor:t});const e=pe(t.processData);return{...t,processData:e}},merge:function(...t){return!1!==t[t.length-1]&&Ae(t,((t,e)=>Object.assign(t,{...e,api:me(t.api,e.api),processData:ve(t.processData,e.processData)})))}}];class Ce{constructor(){this._events=new H({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class xe{constructor(t={},e={}){this._events=new H({target:this}),this._defaults=e,this._context=t||{},this._locals={},b(this,{resolved:new Oe(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ie{constructor(t,e,s,i,n){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=n}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}class Oe{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of Ee)Object.defineProperty(Ce.prototype,t,{get:function(){const i="_"+t;return this[i]||(this[i]=new Ie(this,this._globals,t,e,s))}}),Object.defineProperty(xe.prototype,t,{get:function(){const i="_"+t;return this[i]||(this[i]=new Ie(this,this._locals,t,e,s))}}),Object.defineProperty(Oe.prototype,t,{get:function(){const e=this._options,i=e._context[t];return s(e._defaults[t],i&&i.get(),e._locals[t])}});const Re=["api","layouts","dataProcessor","trackers","interactions"];function Se(t,e=Re){for(const s of e)$e(t,s)}function $e(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function Ae(t,e){let s={};for(const i of t)i&&(s=e(s,i));return g(s)}class Te extends Y{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Ce}}function Ne(){return"data"}function qe(t){return t?"view:"+t:"view"}Se(Te.prototype);class Ue{constructor(){(this._events=new H)._injectSubscribeInterface(this),this._states={},b(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class Pe{constructor(t){this._hub=t,this._sessionIndex=0,y(t,this,["active"])}get active(){const{session:t}=this._hub.states;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this.new({force:!0}),this.start()}_create(){return Object.freeze({active:!1,uuid:S(),index:this._sessionIndex++,meta:{}})}}const je=new Set([ie.PRODUCTS,ie.SOURCES,ie.RELATED_RESOURCES]);function Le({property:t,misoId:e,request:s},{event:i,values:n,manual:r}){let o;if(e)try{o=function(t){const e=t.split("-"),s=""+e[2].substring(1)+e[1]+e[0];return Math.floor(parseInt(s,16)/1e7)-12219292800}(e)}catch(t){}const a=s&&s._meta&&s._meta.question_source,c=function(t){return je.has(t)}(t),u=c?n.map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t)):[],l=c?void 0:n.map((t=>t.text||t.id||t));return g({type:"viewable"===i?"viewable_impression":i,product_ids:u,miso_id:e,context:{custom_context:g({api_ts:o,property:t,channel:t===ie.AFFILIATION?n[0]&&n[0].channel:void 0,items:l,positions:t===ie.AFFILIATION?n.map((t=>t.position)):void 0,trigger:r?"manual":"auto",question_source:a})}})}function Me(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class ze{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},n={...t.options,signal:s},r=await this._source({session:e,...t,options:n});if(r&&r[Symbol.asyncIterator]){let t;for await(t of r){if(!Me(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){Me(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class De{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{p(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Be,VIEWABLE:Qe,CLICK:Fe}=ae,{UNTRACKED:Ge,TRIGGERED:We}=ue,Ve=Object.freeze({[Be]:Ge,[Qe]:Ge,[Fe]:Ge});class He{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ve}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Ge}set(t,e,s){he(e),function(t){if(t!==ue.UNTRACKED&&t!==ue.TRACKING&&t!==ue.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of m(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==We))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),(()=>({...Ve}))))[e]=s}}class Ke{constructor(t){this._view=t,this._role=t.role,this._states=new He(this._getSessionId())}get options(){return this._view._getTrackerOptions()}getState(t){return this._states.getFullState(t)}_trigger(t,e,s={}){if(he(t),this._syncSession(),0===(e=this._states.untriggered(m(e),t)).length)return;this._states.set(e,t,ue.TRIGGERED);const i="results"===this._role?"products":this._role,n=this._getMisoId(),r=this._getRequestPayload();this._view.hub.trigger("interaction",Le({property:i,misoId:n,request:r},{event:t,values:e,meta:s}))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new He(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._view.hub.states[qe(this._role)]}}for(const t of ce)Ke.prototype[t]=function(e,s){this._trigger(t,e,s)};class Ye{constructor(t,e){this._events=new H({target:this}),this._views=t,b(this,{role:e,interface:new Ze(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new De((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&"function"==typeof t.initialize&&t.initialize(this),this.refresh({force:!0})}get tracker(){return this._tracker||(this._tracker=new Ke(this)),this._tracker}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:n,status:r,ongoing:o,request:a,meta:c}=e;if(!t&&!(n&&n.active))return;if(!t&&((u=e)===(l=i)||u&&l&&u.status===l.status&&u.error===l.error&&u.value===l.value&&u.ongoing===l.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(u.session,l.session)))return;var u,l;const h=(t={},e)=>{!1!==t&&this.updateState({session:n,status:r,ongoing:o,request:a,meta:c,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState({session:t,status:e,ongoing:s,request:i,meta:n,error:r},{silent:o=!1}={}){r&&(e=le.ERRONEOUS);const a=this._state=Object.freeze(g({session:t,status:e,ongoing:s,request:i,meta:n,error:r})),{role:c}=this;this.hub.update(qe(c),a,{silent:o})}_getTrackerOptions(){return this._views._getTrackerOptions(this.role)}_sliceData({value:t,error:e,status:s,meta:i,...n}){const r={value:this.role===ie.ERROR?e:t&&t[this.role],status:s,data:t,meta:i,...n};return this.role===ie.CONTAINER&&(r.meta={...i,empty:this._isContainerEmpty(t)}),g(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!re(s))return!1;let e=t&&t[s];if(s===ie.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ze{constructor(t){y(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}const Xe=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function Je(t,e){return!!e&&{...t,...e}}class ts{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n=[],options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=i,this._options=r,this._containers=new Map,this._views={},this._trackers=new ss(this,n);for(const t of n)this._views[t]=new Ye(this,t);b(this,{interface:new es(this)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on(Ne(),(()=>this.refresh())),r.on("trackers",(()=>this._syncTrackers())),r.on("layouts",(()=>this._syncLayouts()))],this._syncTrackers(),this._syncLayouts()}get trackers(){return this._trackers}addContainer(t){if(this._containers.has(t))return;const e=new Ye(this,ie.CONTAINER);e.layout=this._createLayout(ie.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===ie.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new Ye(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t}={}){const e=this._getData();await Promise.all(this._getViews(!0).map((s=>s.refresh({force:t,data:e}))))}_getData(){const{[Ne()]:t}=this._hub.states;if(!this._data||this._data.data!==t){const e=t&&t.session&&t.session.active?t.error?le.ERRONEOUS:t.value?le.READY:le.LOADING:le.INITIAL,s=e===le.READY?!!t.ongoing:void 0;this._data=Object.freeze({...t,status:e,ongoing:s})}return this._data}_syncTrackers(){this._trackerOptions=this._options.resolved.trackers}_getTrackerOptions(t){return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return g({...Xe,...n,impression:Je(Xe.impression,e),viewable:Je(Xe.viewable,s),click:Je(Xe.click,i)})}(this._trackerOptions&&this._trackerOptions[t]||!1)}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class es{constructor(t){this._actor=t,y(this,t,["syncSize","refresh","trackers"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class ss{constructor(t,e){this._views=t;for(const s of e)Object.defineProperty(this,s,{get:()=>t.get(s).tracker})}}class is{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[Ne()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};if(!s)return;const{request:i}=e||{},{payload:n}=i||{};this._hub.trigger("interaction",this._buildInteraction(t,{question_source:n&&n._meta&&n._meta.question_source}))}_buildInteraction({value:t,unselected:e},{question_source:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_source:s,value:e?"unselected":t}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ns{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._index=-1,this._unsubscribes=[t.on("input",(()=>this._sync())),s.on("autocomplete",(()=>this._syncOptions()))],this._sync(!0)}get active(){return!1!==this._options.resolved.autocomplete.actor}get source(){return this._source}_syncOptions(){this._sync(!0)}async _sync(t=!1){if(!this.active)return;const{input:e}=this._hub.states,s=e&&e.value&&e.value.trim()||void 0;if(n=e,(!(i=this._input)&&!n||i&&n&&i.value===n.value)&&!t)return;var i,n;this._input=e;const r=++this._index;if(this._clearTimeout(),this._abortPendingRequest({type:"new-input",message:"A new input renders previous autocomplete request obsolete."}),this._emitCompletions({index:r,input:e,status:s?le.LOADING:le.INITIAL}),s)try{const t=await this._fetchCompletions(e);if(this._index!==r)return;this._emitCompletions({index:r,input:e,status:le.READY,value:t.completions})}catch(t){if(this._error(t),this._index!==r)return;this._emitCompletions({index:r,input:e,status:le.ERRONEOUS,error:t})}}async _getCompletions(t){return await this._fetchCompletions(t)}async _fetchCompletions({value:t}){const{api:e}=this._options.resolved.autocomplete,{group:s,name:i}=e,{signal:n}=this._ac||{},r={...e.options,signal:n},o={...e.payload,q:t};return await this._source({group:s,name:i,payload:o,options:r})}_clearTimeout(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}_abortPendingRequest(t){this._ac&&this._ac.abort(t),this._ac=new AbortController}_emitCompletions(t){t.source="actor",this._hub.update("completions",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"autocomplete-actor-destroy",message:"Autocomplete actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class rs{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=m(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function os(t){return async({group:e,name:s,payload:i,options:n})=>e===h.ASK&&s===d.QUESTIONS?t.api.ask.questions(i,n):t.api[e]._run(s,i,n)}class as{constructor({role:t,workflow:e,...s}={}){b(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=A(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,I((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const n=this._rendered.get(this._element),r=A([]),o=A({});this._render(this._element,{state:s,rendered:n,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),this._rendered.set(this._element,Object.freeze({...s,...o.value})),i&&i(...r.value)}_render(){throw Error("Unimplemented")}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function cs(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function us(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ds)(t,e,s)+(n.descriptionBlock||ps)(t,e,s)+(n.priceBlock||fs)(t,e,s)+(n.ctaBlock||vs)(t,e,s)}</div>`}function ls(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ds)(t,e,s)+(n.descriptionBlock||ps)(t,e,s)+(n.priceBlock||fs)(t,e,s)}</div>`}function hs(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ds)(t,e,s)+(n.dateBlock||ms)(t,e,s)+(n.descriptionBlock||ps)(t,e,s)+(n.ctaBlock||vs)(t,e,s)}</div>`}function ds({className:t},{title:e}){return e?`<div class="${t}__item-title">${R(e)}</div>`:""}function _s({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function ps({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${R(s)}</div>`:""}function ms({className:t,templates:e},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${t}__item-date">${Es(r,e.date)}</div>`:""}function fs(t,e){const{className:s,templates:i}=t,{sale_price:n,original_price:r,currency:o="USD"}=e,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,u=e.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(i.discountRateText||gs)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function gs(t,{discount_rate_percent:e}){return`(${e}% off)`}function ys(t,e,s){const{className:i,templates:n}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${r}">`}${s.brand?(n.brandBlock||_s)(t,e,s):""}</div>`}function bs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function vs(t,e,s){const{className:i,templates:n}=t,r=Cs.asFunction(n.cta)(t,e,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function ws({className:t,options:e={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&i?"a":"div";return[`<${l} class="${t}__${n}" ${r?`data-role="${r}"`:""} ${s?`${te}="${s}"`:""} ${!1!==o.link&&i?`href="${i}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const ks=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"});function Es(t,e=ks){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||ks.locale,e);default:throw Error("Invalid date format: "+e)}}const Cs=Object.freeze({tagPair:ws,formatDate:Es,escapeHtml:R,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class xs extends as{constructor({className:t,templates:e,...s}={}){super(s),b(this,{className:t,templates:{...cs("root"),...e}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Is extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Is.MisoClient.ui.layouts.create("banner").render(this)}}class Os extends as{static get category(){return oe.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e})}_render(t,{state:e}){this._syncBanner(t),this._syncStatus(t,{state:e})}_syncBanner(t){const e=Is.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===ie.PRODUCTS||t===ie.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1}={}}=e,o=[s,r?le.EMPTY:le.NONEMPTY];s===le.READY&&o.push(i?le.ONGOING:le.DONE),t.setAttribute("status",o.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}}const Rs=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Ss extends xs{static get category(){return oe.ERROR}static get type(){return"error"}static get defaultTemplates(){return Rs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Rs,...e},...s})}}const $s=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function As(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class Ts{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,n=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});i.set(a,u),n.set(c,u),r.push(u)}return{k2b:i,e2b:n,entries:r}}(t,e,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=As(n,i),o=As(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}class Ns{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let n=!1;try{await O(t,{...e,signal:i}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return n}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}function qs(t){!function(t,e){const s=Object.getOwnPropertyDescriptors(e);for(const e in s){if("constructor"===e)continue;const{value:i}=s[e];void 0===t[e]&&"function"==typeof i&&(t[e]=i)}}(t,Us.prototype)}class Us{_initTrackable(){this._bindings=new Ts,this._viewables=new Ns}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map((t=>this._getItemKey(t))),n=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!C(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}const Ps=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=ws(t,s);return""+r+(n.imageBlock||ys)(t,s,i)+(n.infoBlock||n.productInfoBlock||ls)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=ws(t,s);return""+r+(n.imageBlock||ys)(t,s,i)+(n.infoBlock||n.articleInfoBlock||hs)(t,s,i)+(n.indexBlock||bs)(t,s,i)+o},question:function(t,e,s){const[i,n]=ws(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===le.READY?n[r](t,e):""}</div>`},[le.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0||e.ongoing?s.list(t,e,i):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list" data-item-type="${r.itemType}">${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map((s=>n.item(t,e,s,r++))).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`},productInfoBlock:ls,articleInfoBlock:hs,brandBlock:_s,titleBlock:ds,descriptionBlock:ps,dateBlock:ms,priceBlock:fs,discountRateText:gs,ctaBlock:vs,cta:function(t,e,s){const{templates:i}=t,{url:n}=e;if(!n)return"";const[r,o]=ws(t,{url:n},{classSuffix:"item-cta",role:"cta"}),a=Cs.asFunction(i.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:ys,indexBlock:bs,helpers:Cs});class js extends xs{static get category(){return oe.LIST}static get defaultTemplates(){return Ps}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Ps,...t},itemType:e,...s}),this._view=void 0,this._initTrackable()}initialize(t){this._view=t,this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===le.READY&&e.status===le.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n;this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:n}=e;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}qs(js.prototype);const Ls="miso-list";class Ms extends js{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Ls}constructor({className:t=Ls,...e}={}){super({className:t,...e})}}const zs="miso-cards";const Ds="miso-carousel",Bs=Object.freeze({ready:function(t,e){const{templates:s}=t,i=t._getItems(e),n=i&&i.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return n?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-previous" data-role="previous">${n.previous(t,e)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(t,e)}</div>`},previous:Fs,next:Fs}),Qs=Object.freeze({...js.defaultTemplates,...Bs});function Fs(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Gs="miso-ui-icon",Ws=Gs+"-svg-1_10_1",Vs=`<symbol id="${Gs}-send" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Hs=`<symbol id="${Gs}-search" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,Ks=`<symbol id="${Gs}-triangle" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,Ys=`<svg id="${Ws}" style="display:none;">${[Vs,Hs,Ks].join("")}</svg>`;let Zs=!1;function Xs(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${Gs}-${t}"></use></svg>`}Zs||document.head.querySelector("#"+Ws)||(Zs=!0,document.head.insertAdjacentHTML("beforeend",Ys));const Js=Xs("send"),ti=Xs("search"),ei=Xs("triangle"),si="miso-search-box";const ii=Object.freeze({root:function(t){const{className:e,role:s,options:i,workflow:n,autocomplete:r}=t,{placeholder:o,buttonText:a}=i;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${a||"search"===n?ti:Js}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},completions:function(t,e){const{templates:s,workflow:i,autocomplete:n}=t;t={templates:s,workflow:i,...n};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:i,templates:n}=t;return`\n<ul class="${i}__${e}-list" data-role="${e}-list">\n  ${s.map((s=>n.completionItem(t,e,s))).join("")}\n</ul>`.trim()},completionItem:function(t,e,s){const{className:i,templates:n}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${n[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||R(e)},product:function(t,{product:e}){const{templates:s}=t,[i,n]=Cs.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+n},imageBlock:ys,productInfoBlock:ls,helpers:Cs}),ni=Object.freeze({className:"miso-autocomplete",debounce:300});class ri extends xs{static get category(){return oe.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return ii}static get defaultClassName(){return si}constructor({className:t=si,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...ii,...e},...i}),b(this,{autocomplete:{...ni,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=M(this.autocomplete.debounce)}initialize(t){this._view=t;const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t)))],this._unsubscribes.push(s.on("completions",(()=>t.refresh({force:!0}))))}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:n=le.INITIAL,index:r,value:o}=e.completions;if(s&&s.completions.index===r&&s.completions.status===n)return;const a=this._context(t),{autocompleteElement:c}=a;if(!c)return;const u=a.trackItems(o);t.classList[u.length>0?"add":"remove"]("nonempty"),c.setAttribute("data-status",n),c.innerHTML=this.templates.completions(this,u),i({completions:{index:r,status:n}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return oi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new oi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&C(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),n=this._context().data.get(parseInt(e)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.trigger("query",{q:t}))}}class oi{static empty(){return oi._empty||(oi._empty=new oi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const n in t)for(const r of t[n])r.product&&!r.product.url||(r._index=e,r._field=n,s.set(e,r),i.push(r),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const ai="miso-option-list";const ci=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${R(e.text||e)}</li>`}});class ui extends xs{static get category(){return oe.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return ci}static get defaultClassName(){return ai}constructor({className:t=ai,templates:e,...s}={}){super({className:t,templates:{...ci,...e},...s}),this._initTrackable()}initialize(t){this._view=t;const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncBindings(t,i),this._syncOptionValues(t,i)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const i=this._getItems(e)||[];s.classList[0===i.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}qs(ui.prototype);const li=Object.freeze({...cs("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class hi extends xs{static get category(){return oe.RADIO}static get defaultTemplates(){return li}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...li,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=this._view=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=C(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],I((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const di="miso-feedback",_i=["helpful","unhelpful"];const pi=Object.freeze({options:function(t){const{templates:e}=t;return _i.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class mi extends hi{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return pi}static get defaultClassName(){return di}constructor({className:t=di,templates:e,...s}={}){if(super({className:t,templates:{...pi,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const fi="miso-text";const gi=Object.freeze({root:function(t,e){const{className:s,role:i,options:{tag:n}}=t;return`<${n} class="${s}" ${i?`data-role="${i}"`:""}>${R(e.value||"")}</${n}>`}});class yi extends xs{static get category(){return oe.TEXT}static get type(){return"text"}static get defaultTemplates(){return gi}static get defaultClassName(){return fi}constructor({className:t=fi,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...gi,...e},tag:s,...i})}}class bi extends as{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=A(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class vi{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),u=!i.startsWith(c);return a||u?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function wi(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,ki(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||le.INITIAL),i}function ki(t){return t+"__cursor"}const Ei="miso-typewriter";class Ci extends bi{static get category(){return oe.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return Ei}constructor({className:t=Ei,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:i,...a}),b(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:B({speed:n,acceleration:r}),this._readiness=new N,"markdown"===s&&Ci.MisoClient.plugins.install("std:ui-markdown")}initialize(t){this._view=t,this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown"),e=ki(this.className),{onDebug:s,onCitationLink:i}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:s}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new vi}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=t,a=i&&i.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,d=c&&e&&e.doneAt||(r!==le.READY||o?void 0:Date.now());return this._prevState=Object.freeze(g({session:n,status:r,value:s,stage:a,streak:h,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=wi(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);n(a);const c=e.status===le.READY&&!a.done;i({ongoing:c},{silent:c&&(!s||s.status===le.READY)}),c&&r()}_onClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}const xi="miso-affiliation";const Ii=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e,o=i?` data-role="${i}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===le.READY?n[r](t,e):""}</div>`},[le.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}-container">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return ei},body:function(t,e){const{className:s,templates:i}=t,n=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,n)}</div>`},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(t,e,s,{index:i})}${r[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:n,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=Cs.asFunction(o)(t,e,s,i),a=Cs.asFunction(a)(t,e,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:n}=t,[r,o]=ws(t,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||us)(t,s,i)+(n.imageBlock||ys)(t,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:n,templates:r}=t,o=Cs.asFunction(r.logoText)(t,e,s,i)||"",a=Cs.asFunction(r.logoImg)(t,e,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:n,templates:r}=t,o=Cs.asFunction(r.logoUrl)(t,e,s,i);if(!o)return"";const a=Cs.asFunction(r.logoAltText)(t,e,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Oi=Object.freeze({...js.defaultTemplates,...Ii});class Ri extends js{static get category(){return oe.AFFILIATION}static get type(){return"affiliation"}static get defaultTemplates(){return Oi}static get defaultClassName(){return xi}constructor({className:t=xi,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...Ii,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new X(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,I((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(this._displayedCount=s,void 0===s?i.removeAttribute("data-item-count"):i.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}var Si=Object.freeze({__proto__:null,TemplateBasedLayout:xs,ContainerLayout:Os,ErrorLayout:Ss,BannerLayout:class extends xs{static get category(){return oe.BANNER}static get type(){return"banner"}static get defaultTemplates(){return $s}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...$s,...e},...s})}},CollectionLayout:js,ListLayout:Ms,CardsLayout:class extends js{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return zs}constructor({className:t=zs,...e}={}){super({className:t,...e})}},CarouselLayout:class extends js{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return Qs}static get defaultClassName(){return Ds}constructor({className:t=Ds,templates:e,...s}={}){super({className:t,templates:{...Bs,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:i}=e,n=this._getItems(i);this._itemCount=n?n.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:ri,OptionListLayout:ui,FeedbackLayout:mi,TextLayout:yi,TypewriterLayout:Ci,AffiliationLayout:Ri});const $i=Object.freeze({[ie.CONTAINER]:Os.type,[ie.ERROR]:Ss.type});class Ai extends Y{constructor({name:t,context:e,plugin:s,client:i,roles:n,defaults:r}){super(t||"workflow",s),this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,this._name=t,this._roles=n;const o=this._extensions=s._getExtensions(i),a=this._options=new xe(e&&e._options,function(t,{layouts:e,interactions:s,...i}={}){const n={preprocess:[e=>t._preprocessInteraction(e)]};return{...i,layouts:ge($i,e),interactions:ke(n,s)}}(this,r)),c=this._hub=function(t,e){const{update:s,trigger:i}=t;return t.update=(i,n,r)=>(r&&r.silent||e("update",i,n,r),s.call(t,i,n,r)),t.trigger=(...s)=>(e("trigger",...s),i.apply(t,s)),t}(new Ue,((...t)=>this._log(...t))),u=s.layouts;this._sessions=new Pe(c),this._data=new ze(c,{source:os(i),options:a}),this._views=new ts(c,{extensions:o,layouts:u,roles:n,options:a,workflow:t}),this._interactions=new rs(c,{client:i,options:a}),this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t)))]}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this.reset(),this.start(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid===this.session.uuid){this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);return this._hub.update(Ne(),t),this}}_defaultProcessData(t){const{value:e}=t;return e&&e.miso_id?{...t,meta:{...t.meta,miso_id:e.miso_id}}:t}notifyViewUpdate(t,e){return this._assertActive(),e={status:le.READY,session:this.session,...e},this._hub.update(qe(t),e),this}get trackers(){return this._views.trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:i,name:n}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:i,api_name:n,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}function Ti(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Ni(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map((t=>({...t})));let n=0;for(const t of i)s&&(t.channel=s),t.position=n++;return{...t,affiliation:{...e,products:i}}}(t)}function Ni({products:t,...e}){return{channel:"sovrn",...e,products:t.map(qi)}}function qi({id:t,deeplink:e,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return g({id:"sovrn-"+t,title:s,description:i,cover_image:c,url:e,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:Ui({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function Ui(t,e=""){return Object.keys(t).reduce(((s,i)=>{const n=t[i];if(void 0===n)return s;const r=e?`${e}_${i}`:i;return"object"==typeof n?{...s,...Ui(n,r)}:{...s,[r]:n}}),{})}Se(Ai.prototype);const Pi=Object.freeze({group:h.ASK,name:d.QUESTIONS,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),ji=Object.freeze({actor:!1,api:{group:h.ASK,name:d.AUTOCOMPLETE}}),Li=Object.freeze({[ie.QUERY]:[ri.type,{placeholder:"Ask a question"}],[ie.QUESTION]:[yi.type,{tag:"h2"}],[ie.ANSWER]:Ci.type,[ie.FEEDBACK]:mi.type,[ie.SOURCES]:[Ms.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[ie.RELATED_RESOURCES]:[Ms.type,{incremental:!0,itemType:"article"}],[ie.QUERY_SUGGESTIONS]:ui.type,[ie.AFFILIATION]:[Ri.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Mi=Object.freeze({[ie.SOURCES]:{},[ie.RELATED_RESOURCES]:{},[ie.AFFILIATION]:{},[ie.QUERY_SUGGESTIONS]:{click:{validate:t=>0===t.button}}}),zi=Object.freeze({api:Pi,autocomplete:ji,layouts:Li,trackers:Mi});class Di extends Ai{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(Li),defaults:zi}),this._context=t,this._autoQuery=!1,b(this,{parentQuestionId:e}),this._feedback=new is(this._hub),this._setSuggestedQuestions(),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this.query(t))),this._hub.on(qe(ie.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(ie.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))],e&&t._byPqid.set(e,this),t._events.emit("create",this),this.reset()}get questionId(){return this._questionId}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,i=new URLSearchParams(window.location.search),n=i.get("q"),r=i.get("qs"),{layout:o}=this._views.get(ie.QUERY);o&&(n&&e&&(o.value=n),!n&&s&&o.focus()),n&&this.query({q:n,qs:r})}query({q:t,qs:e,...s}={}){s={...s,question:t},e=e||se,this.parentQuestionId&&(s.parent_question_id=this.parentQuestionId),(s._meta||(s._meta={})).question_source=e,this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0),this.restart();const{session:i}=this;return i.meta.question_source=e,this._hub.update("request",me(this._options.resolved.api,{payload:s,session:i})),this}restart(){const{session:t,status:e,ongoing:s}=this._hub.states[qe(ie.ANSWER)]||{};if(t&&e!==le.INITIAL&&(e!==le.READY||s)){const i=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",i),this._emit("finally",i)}super.restart()}_defaultProcessData(t){t=super._defaultProcessData(t);const{value:e,request:s}=t;if(!e)return t;const{question_id:i,question:n}=e,r=s&&s.payload&&s.payload._meta&&s.payload._meta.question_source===se;if(!this._questionId&&i&&(this._questionId=i,this._context._byQid.set(i,this)),this._autoQuery&&!1!==this._autoQuery.updateUrl){const t=new URL(window.location);n===t.searchParams.get("q")||r&&!0!==this._autoQuery.updateUrl||(t.searchParams.set("q",n),window.history.replaceState({},"",t))}return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Ti(e)}}(t),{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:e.answer_stage}}}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===le.INITIAL)return;const i=e===le.READY&&!s,n=e===le.ERRONEOUS,r=i?"done":n?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._emit(r,o),(i||n)&&this._emit("finally",o)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[Ne()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_onCitationClick({index:t}){const{value:e}=this.states[Ne()]||{},{sources:s}=e||{},i=s&&s[t-1];i&&i.product_id&&this._trackers.sources.click([i.product_id],{manual:!1})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;let{rootQuestionId:i,parentQuestionId:n,questionId:r}=this;return s.property===ie.QUERY_SUGGESTIONS&&(r=n,n=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions",s.question_source=this.previous&&this.previous.session.meta.question_source),t.context={...e,custom_context:g({root_question_id:i,parent_question_id:n,question_id:r,...s})},t}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),this._feedback._destroy(),super._destroy(t)}}class Bi extends Te{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Di(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Di(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const Qi=Object.freeze({group:h.ASK,name:d.RELATED_QUESTIONS}),Fi=Object.freeze({[ie.RELATED_QUESTIONS]:[Ms.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[ie.QUERY]:[ri.type,{placeholder:"Ask a question"}]}),Gi=Object.freeze({[ie.RELATED_QUESTIONS]:{}}),Wi=Object.freeze({api:Qi,layouts:Fi,trackers:Gi});class Vi extends Ai{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(Fi),defaults:Wi}),this._productId=void 0,this._linkFn=void 0,this._unsubscribes=[...this._unsubscribes,this._views.get(ie.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start(){if(void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:t}=this;return this._hub.update("request",me(this._options.resolved.api,{session:t})),this}notifyViewUpdate(t=ie.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._getAnswersUrl(t,!0)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._getAnswersUrl(t);window.open(e,"_blank")}_getAnswersUrl(t,e=!1){if(!this._linkFn)return;const s=this._linkFn(t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}const Hi=Object.freeze({group:h.SEARCH,name:d.SEARCH,payload:{fl:["*"]}}),Ki=Object.freeze({actor:!1,api:{group:h.SEARCH,name:d.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}},throttle:300}),Yi=Object.freeze({[ie.QUERY]:ri.type,[ie.PRODUCTS]:Ms.type}),Zi=Object.freeze({[ie.PRODUCTS]:{}}),Xi=Object.freeze({api:Hi,autocomplete:Ki,layouts:Yi,trackers:Zi});class Ji extends Ai{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(Yi),defaults:Xi}),this._autocomplete=new ns(this._hub,{source:os(this._client),options:this._options}),this._unsubscribes.push(this._hub.on("query",(t=>this.query(t))))}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:i}=this._views.get(ie.QUERY);i&&(s&&t&&(i.value=s),!s&&e&&i.focus()),s&&this.query({q:s})}query(t){this.restart();const{session:e}=this;return this._hub.update("request",me(this._options.resolved.api,{payload:t,session:e})),this}updateCompletions(t){return this._hub.update("completions",{...t,source:"manual"}),this}notifyViewUpdate(t=ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}Se(Ji.prototype,["autocomplete"]);const tn=Object.freeze({group:h.RECOMMENDATION,name:d.USER_TO_PRODUCTS,payload:{fl:["*"]}}),en=Object.freeze({[ie.PRODUCTS]:Ms.type}),sn=Object.freeze({[ie.PRODUCTS]:{}}),nn=Object.freeze({api:tn,layouts:en,trackers:sn});class rn extends Ai{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(en),defaults:nn}),b(this,{id:e}),this._context=t,t._members.set(e,this)}start(){this._sessions.start();const{session:t}=this;return this._hub.update("request",me(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(ie.CONTAINER),this.notifyViewUpdate(ie.PRODUCTS),this}notifyViewUpdate(t=ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:g({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class on extends Te{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=ee){if(this._members.has(t))throw Error("Unit already exists: "+t);return new rn(this,t)}has(t=ee){return this._members.has(t)}get(t=ee){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new rn(this,t)}}class an extends Y{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new N)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const cn="miso-ask-combo";var un=Object.freeze({__proto__:null,CLASS_PREFIX:cn});var ln=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});function hn(t={}){return In(t=pn(t),{name:"follow-up"},[bn(t),On(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...vn(t)])}const dn=Object.freeze({followUps:gn,relatedResources:yn,querySuggestions:bn,answerGroup:vn,answer:wn,sources:kn}),_n=Object.freeze({normalizeOptions:pn,normalizePhraseOptions:mn,normalizePhraseOptionKey:fn,phrase:Cn,phraseText:xn,section:In,container:On,element:Rn,attrs:Sn});function pn({classPrefix:t=cn,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t,circledCitationIndex:e,phrases:s=mn(s),...i}}function mn(t={}){if(!t)return{};const e={};for(const s in t)e[fn(s)]=t[s];return e}function fn(t){return"relatedQuestions"===(t=t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase())))?"querySuggestions":t}function gn(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}function yn(t){const{features:e={},logo:s=!0}=t;return In(t,{name:"related-resources"},!1===e.relatedResources?"":On(t,{name:"related-resources",visibleWhen:"nonempty",logo:s},[Cn(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}function bn(t){const{features:e={}}=t;return!1===e.querySuggestions?"":On(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[Cn(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}function vn(t){return[wn(t),En(t),kn(t),On(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}function wn(t){return On(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",Cn(t,{name:"question",tag:"div"}),"<miso-question></miso-question>","<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}function kn(t){return On(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",Cn(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}function En(t){const{affiliation:e=!0}=t||{};return e?On(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}function Cn(t,{name:e,tag:s="div"}){const{classPrefix:i}=t;return`<${s} class="${i}__phrase ${i}__${e}-phrase">${xn(t,(n=e,n.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))))}</${s}>`;var n}function xn(t,e){const{phrases:s={}}=t,i=s[e]||ln[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}function In({classPrefix:t},{name:e},s){return Rn("section",{classes:[t+"__section",`${t}__${e}`]},s)}function On({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${t}__${i}-container`];return e&&a.push("miso-circled-citation-index"),Rn("miso-ask",{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}function Rn(t,e={},s=""){return("string"==typeof e||Array.isArray(e))&&(s=e,e={}),`<${t}${Sn(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}function Sn({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${v(t)}="${i}"`)}return s}var $n=Object.freeze({__proto__:null,root:function(t={}){return""+In(t=pn(t),{name:"question"},[On(t,{name:"query"},"<miso-query></miso-query>")])+In(t,{name:"answer"},vn(t))+gn(t)+yn(t)},followUp:hn,sections:dn,helpers:_n});const An=Object.freeze(un),Tn=Object.freeze(ln),Nn=Object.freeze($n);var qn=Object.freeze({__proto__:null,constants:An,phrases:Tn,templates:Nn,wireFollowUps:function(t,e,{template:s=hn,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const n=t.ui.asks,r=t.ui.ask;n.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",n.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:Un}=document,Pn=Object.freeze({templates:Nn,autostart:!0}),jn=["templates","phrases","features"];class Ln{constructor(){this._defaults=Pn,this._scriptSrc=function(){if(!Un||!Un.src)return{};const t=document.createElement("a");t.href=Un.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Dn(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Dn(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return g({apiKey:t,apiHost:e,templates:Bn(s),phrases:i,...n})}(Mn(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Mn(...t){let e={};for(const s of t)s&&(e=zn(e,s));return e}function zn(t,e){if(!e)return t;Object.assign(t,e);for(const s of jn)s in e&&(t[s]={...t[s],...e[s]});return t}function Dn(t){return""===t||"false"!==t&&t}function Bn(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Bn):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,Bn);default:throw Error("Unsupported template type: "+t)}}class Qn{constructor(t,{classPrefix:e=An.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");b(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Fn extends an{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Ln,this._localOptions={}}config(t={}){t=Mn(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;b(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Qn(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(e,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Gn extends Z{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Wn,Vn,Hn;async function Kn(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Wn||(Wn=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Vn=Vn||e.any(),Hn=Hn||await Vn,Hn.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Hn}const Yn="logo",Zn="auto",Xn=Object.freeze([Yn]);function Jn(t){if(!t)return Zn;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class tr extends HTMLElement{static get observedAttributes(){return Xn}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Jn(this.getAttribute(Yn))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Zn:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Yn,e):this.removeAttribute(Yn)}async connectedCallback(){const t=this._client=await Kn(tr);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Yn)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Jn(t)!==Jn(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const er="parent-question-id",sr=Object.freeze([...tr.observedAttributes,er]);const ir="unit-id",nr=Object.freeze([...tr.observedAttributes,ir]);var rr=Object.freeze({__proto__:null,MisoAskElement:class extends tr{static get tagName(){return"miso-ask"}static get observedAttributes(){return sr}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(er)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(er,t):this.removeAttribute(er))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===er)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends tr{static get observedAttributes(){return tr.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoSearchElement:class extends tr{static get observedAttributes(){return tr.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends tr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return nr}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(ir)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(ir,t):this.removeAttribute(ir)}attributeChangedCallback(t,e,s){if(t===ir)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const or="role",ar=Object.freeze([or]);class cr extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return ar}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(or);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${or}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${or}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===or&&this._container&&this._container._updateComponentRole(this,e,s)}}var ur=Object.freeze({__proto__:null,MisoComponentElement:cr,MisoQueryElement:class extends cr{constructor(){super({role:ie.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends cr{constructor(){super({role:ie.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends cr{constructor(){super({role:ie.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends cr{constructor(){super({role:ie.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends cr{constructor(){super({role:ie.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends cr{constructor(){super({role:ie.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends cr{constructor(){super({role:ie.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends cr{constructor(){super({role:ie.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends cr{constructor(){super({role:ie.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends cr{constructor(){super({role:ie.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends cr{constructor(){super({role:ie.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoErrorElement:class extends cr{constructor(){super({role:ie.ERROR})}static get tagName(){return"miso-error"}}});class lr extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(lr.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var hr=Object.freeze({__proto__:null,containers:rr,roles:ur,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends lr{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Is});const dr=Object.freeze(qn);var _r=Object.freeze({__proto__:null,ask:dr});const pr="ui";let mr,fr;async function gr(){return fr||(fr=j(mr||(mr=`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${U}/dist/css/${pr}.css`)))}class yr{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class br{constructor(t,e){this._plugin=t,this._client=e,b(this,{sources:{api:os(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Ji(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get explore(){return this._explore||(this._explore=new Vi(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class vr{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Fn(this._plugin,this._MisoClient))}}let wr,kr;async function Er(){return wr||(wr=async function(){return async function(t,{interval:e=300,timeout:s}={}){const i=t();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),i(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function Cr(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(Ft,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||e.debug;i&&Ft.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&Ft.plugins.use("std:dry-run");return window.MisoClientSA=Ft,Ft}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const i=window.misoSA=new e(s);return i.context.anonymous_id=await async function(){if(kr)return kr;const t=await Er();return kr=t.get("clientId")}(),i}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function xr(t){return e=>({...e,context:{...e.context,custom_context:{...Ir(t),...e.context&&e.context.custom_context}}})}function Ir({site:t,version:e}){return{source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",site:t.key,uuid:S()}}Ft.plugins.use(class extends Y{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Gn(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new N}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:_r};y(s,this,["layouts","combo","ready"]),b(this,{MisoClient:t}),b(t,{ui:s}),this.combo=new vr(this,t);const i=Object.values(Si).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,combos:o,...a}=hr,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];tr.MisoClient=t,lr.MisoClient=t;for(const e of c)e.MisoClient=t;await gr();for(const t of c)x(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){b(t,{ui:new br(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new yr(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new on(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Bi(this,t)),e}});const Or="miso-smart-answers";const Rr=Ft.ui.defaults.ask.templates,Sr={sources:"This answer is based on the following articles",relatedQuestions:"Related questions"};function $r(t){const{sponsor:e,site:s}=t;if("computerworld"!==s.key||!e)return;const i=document.querySelector(".article-hero__breadcrumbs");i&&i.insertAdjacentHTML("afterend",function({sponsor:t}){return t?`\n<div class="${Or}__sponsor">\n  <div class="${Or}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${Or}__sponsor-logo">\n    <img src="${rt(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}(t))}function Ar(t,e){for(const s of e)t=s(t);return t}const Tr=/<\/miso-sources>\s*<\/miso-ask>/;function Nr(t){const e=`<miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="ready" logo="false"${t?` parent-question-id="${t}"`:""}><miso-whitepaper></miso-whitepaper></miso-ask>`;return t=>t.replace(Tr,"</miso-sources></miso-ask>"+e)}function qr(t){return t.replace(/<h3 /g,"<h4 ").replace(/<\/h3>/g,"</h4>")}const Ur=Object.freeze({ordered:!0,infoBlock:function({className:t},{title:e,snippet:s,description:i,created_at:n,updated_at:r,published_at:o,custom_attributes:a={}}){const c=ct(a.site),u=o||n||r;let l="";e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:i&&(l+=`<div class="${t}__item-desc">${i}</div>`);const h=[];u&&h.push(`<div class="${t}__item-date">${Lr(u)}</div>`);c&&h.push(`<div class="${t}__item-site">${c.name}</div>`);h.length>0&&(l+=`<div class="${t}__item-supplementals">${h.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`);return`<div class="${t}__item-info-container">${l}</div>`}});const Pr="miso-list";function jr(t,e){return`\n<h4 class="miso-ask-combo__phrase miso-ask-combo__whitepaper-phrase">Learn more: in-depth</h4>\n<div class="miso-whitepaper ${Pr}">\n  <ul class="${Pr}__list" data-item-type="article">${e.map((t=>function(t,{cover_image:e,description:s,product_id:i,published_at:n,publishers:r,title:o,url:a}){r=r||[];const c=[];n&&c.push(`<div class="${Pr}__item-date">${Lr(n)}</div>`);r.length>0&&c.push(`<div class="${Pr}__item-sponsor">${r.join(", ")}</div>`);return`\n<li class="${Pr}__item">\n  <a class="${Pr}__item-body" data-whitepaper-product-id="${i}" href="${a}" target="_blank" rel="noopener">\n    <div class="${Pr}__item-cover-image-container">\n      <img class="${Pr}__item-cover-image" src="${e}">\n    </div>\n    <div class="${Pr}__item-info-container">\n      <div class="${Pr}__item-title">${o}</div>\n      <div class="${Pr}__item-desc">${s}</div>\n      ${c.length>0?`<div class="${Pr}__item-supplementals">${c.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`:""}\n    </div>\n  </a>\n</li>`.trim()}(0,t))).join("")}</ul>\n</div>\n`.trim()}function Lr(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}const Mr=new Set;class zr{constructor(t,{MisoClient:e,client:s,workflow:i,element:n}){this._workflow=i,this._client=s,this._MisoClient=e,this._context=Object.freeze({...t}),this._rootElement=n,this._element=void 0,this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1,i.on("data",(t=>this.updateData(t)))}clear(){this._session=void 0,this._product=void 0,this._html=void 0,this._clicked=!1}async updateData({session:t,value:e}={}){t&&(this._product&&this._session&&this._session.uuid===t.uuid||(this._session=t,this._product=this._getProduct(e),this._syncView()))}get element(){if(!this._element){const{parentQuestionId:t}=this._workflow,e=(t?`miso-ask[parent-question-id="${CSS.escape(t.trim())}"]`:"miso-ask:not([parent-question-id])")+" miso-whitepaper";if(this._element=this._rootElement.querySelector(e),!this._element)throw Error("Element not found: "+e);this._element.addEventListener("click",(t=>this._handleClick(t)))}return this._element}_getProduct(t){const{affiliation_products:e=[]}=t||{};for(const t of e)if(!Mr.has(t.product_id))return Mr.add(t.product_id),t;return e[0]}async _syncView(){this._html=this._product?jr(0,[this._product]):"",this._requestRender()}async _requestRender(){this._render(),this._product&&(this._sendInteraction("impression"),this._measureViewable())}_render(){this.element.innerHTML=this._html}async _measureViewable(){await this._MisoClient.helpers.viewable(this.element),this._sendInteraction("viewable_impression")}_handleClick({target:t}){if(this._clicked)return;t.closest(".miso-whitepaper a[href]")&&(this._sendInteraction("click"),this._clicked=!0)}_sendInteraction(t,e={}){if(!this._product)return;const{questionId:s,parentQuestionId:i,rootQuestionId:n}=this._workflow,{question_source:r="_organic"}=this._workflow.session.meta||{};this._client.api.interactions.upload(g({type:t,...e,product_ids:[this._product.product_id],context:{custom_context:g({...Ir(this._context),api_group:"ask",api_name:"questions",property:"affiliation_products",root_question_id:n,parent_question_id:i,question_id:s,question_source:r})}}))}}function Dr(t,{MisoClient:e,client:s,rootElement:i}){const{site:r}=t,o=s.ui.asks,a=s.ui.ask;o.useApi({_meta:{site:r.key},fq:'type:article AND ((NOT _exists_:custom_attributes.languages) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)',source_fl:n,related_resource_fl:n}),o.useDataProcessor(function(t){const e=function({site:t}){return({url:e,...s})=>((e=new URL(e)).host=""+t.whitepaper_hostname,{url:Qr(e=""+e),...s})}(t);return({value:t,...s})=>{if(!t)return s;const{sources:i=[],related_resources:n=[],affiliation_products:r}=t;return{value:{...t,sources:i.map(Br),related_resources:n.map(Br),affiliation_products:(r||[]).map(e)},...s}}}(t)),o.useInteractions({preprocess:xr(t)}),o.useLayouts({sources:{templates:Ur}});const c=document.createElement("div");c.id="smart-answers",c.classList.add("miso-ask-combo"),i.insertAdjacentElement("afterend",c),i.remove(),(i=c).innerHTML=Ar(Rr.root({phrases:Sr,features:{relatedResources:!1}}),[Nr(),qr]);const u=i.querySelector(".miso-ask-combo__follow-ups"),l=i.querySelector(".miso-ask-combo__related-resources miso-ask");function h(i){i._whitepaper||(i._whitepaper=new zr(t,{MisoClient:e,client:s,workflow:i,element:c}))}u&&(o.on("done",(t=>{u.insertAdjacentHTML("beforeend",function(t,{parentQuestionId:e}){return Ar(Rr.followUp({phrases:Sr,parentQuestionId:e}),[Nr(e),qr])}(0,{parentQuestionId:t.workflow.questionId}))})),a.on("loading",(()=>{u.innerHTML="",o.reset({root:!1}),a._whitepaper&&a._whitepaper.clear()}))),l&&o.on("loading",(t=>{l.workflow=t.workflow})),o.on("create",h),h(a),a.autoQuery()}function Br({url:t,cover_image:e,...s}){return{cover_image:e||ct(s.custom_attributes.site).logo_image,url:Qr(t),...s}}function Qr(t){return`${t}${0>t.indexOf("?")?"?":"&"}utm=smart_answers`}const Fr="#smart-answers";(async t=>{const{version:s,page:i,debug:n}=t;if(i.type!==e)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=s,n("Miso Smart Answers script version: "+s);const r=document.querySelector(Fr);if(!r)return void console.error("Container element not found: "+Fr);const[[o,a]]=await Promise.all([Cr(t),st(t)]);$r(t),Dr(t,{MisoClient:o,client:a,rootElement:r})})(pt)}();
