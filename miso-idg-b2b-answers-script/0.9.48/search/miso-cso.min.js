!function(){"use strict";const e="home",t="answers",s="search",n="article",i="other",o=["cover_image","custom_attributes.site","custom_attributes.content_type","custom_attributes.contenthub_url","custom_attributes.byline","authors","created_at","product_id","published_at","snippet","title","updated_at","url"],r=e=>{switch(e.key){case"cio_de":case"cso_de":case"computerwoche":return'type:article AND custom_attributes.languages:"German" AND (NOT custom_attributes.is_sponsored:true)';default:return'type:article AND ((NOT custom_attributes.languages:*) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)'}};var a="0.9.48";var c=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,n]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===n||"true"===n||"false"!==n&&n);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const l={key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en",date_locale:"en-US"},u=window.location.hostname!==l.hostname;var h={...l,dev:u};function d(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const _=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),p=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var m=Object.freeze({__proto__:null,GROUP:_,NAME:p});function f(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function g(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function b(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function y(e){return null==e}function w(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function v(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function E(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function k(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function S(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class O{constructor(e,{duration:t=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);x(s),x(n),x(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==n?n:t})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>I(this,e)),t):I(this,e),this._value=e}disconnect(){this._active=!1}}function I(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function x(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function A(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function C(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function T(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async n=>{try{await e(n),t()}catch(e){s(e)}}))}))}async function R(e,{area:t=.5,duration:s=1e3,signal:n}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((i,o)=>{const r=new O((e=>{e&&(r.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((e=>{r.value=e[0].isIntersecting}),{threshold:t});a.observe(e),n&&n.addEventListener&&n.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),o(new DOMException("Aborted","AbortError"))}))}))}function N(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function $(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function U(e,t){const s=L((()=>window.localStorage.getItem(e))),n=L((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,n=t.indexOf(s);if(0>n)return;const i=n+s.length,o=t.indexOf(";",i);return decodeURIComponent(0>o?t.substring(i):t.substring(i,o))}(e))),i=s||n||""+t();return i&&!s&&L((()=>window.localStorage.setItem(e,i))),i&&!n&&L((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,i))),i}function L(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function P(e){return new q(e)}class q{constructor(e){this._value=e;const t=e=>{this._value=e};v(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class j{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class D{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new j),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var M="1.12.7";let F;try{F=document.currentScript}catch(e){}async function z(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let n;e.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{e.sheet&&(n&&clearInterval(n),t())}),100)}))}(e),await async function(e){if(Q(e))return;return new Promise((t=>{let s;s=setInterval((()=>{Q(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function B(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${M}/dist/css/${e}.css`}function Q(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function G(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function W(e,{depth:t=5,...s}={}){return H(e,t)}function H(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>H(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const n={};if(0>=t)return n;for(const s in e){const i=e[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=H(i,t-1)))}return n}(e,t):e:"(...)"}function V(e,t){const s=Object.getOwnPropertyDescriptors(t),n=Object.getOwnPropertyDescriptors(e);for(const[t,i]of Object.entries(s))"constructor"!==t&&void 0===n[t]&&Object.defineProperty(e,t,i)}function Y(e){const t={},s=new Set;for(let n=e;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:o}=i[n];o&&(t[n]="function"==typeof o?o.bind(e):o)}}return Object.freeze(t)}function K(e={},t={}){const s=e.metadata||t.metadata?b({...e.metadata,...t.metadata}):void 0,n=e._meta||t._meta?b({...e._meta,...t._meta}):void 0;return b({...e,...t,metadata:s,_meta:n})}function Z(e={},t={}){const s=e.context&&e.context.custom_context||t.context&&t.context.custom_context?b({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context}):void 0,n=e.context||t.context?b({...e.context,...t.context,custom_context:s}):void 0;return b({...e,...t,context:n})}const J=100,X=4;function ee(e){const t=function({speed:e=J,acceleration:t=X}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,n)=>{let i=e*(Math.random()+.5);return t>0&&void 0!==n&&s>n&&(i*=1+(s-n)*t/1e3),i}}(e);return(e,s,n,i)=>{const o=t(n,s);return e+Math.max(i-n,0)*o/1e3}}const te=Symbol.for("miso:resources");class se{constructor(){this._resources=new Map;const e=window[te]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){ne(this._resources,e).resolve(t)}async get(e){return ne(this._resources,e).promise}}function ne(e,t){if(e.has(t))return e.get(t);const s=new j;return e.set(t,s),s}function ie(){return window[te]||(window[te]=new se)}class oe{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new j;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class re{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},n=this._namedCallbacks[e];if(n)for(const e of n)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,n)=>{const i=t._on(e,(e=>{setTimeout((()=>i()));try{s(e)}catch(e){n(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:n})=>{try{e(s,n)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)f(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&f(s,t)}}_injectSubscribeInterface(e){w(e,this,["on","once"])}}function ae(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class ce{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:ae(e,t),uuid:$()})}(e,t);v(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new re({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(ce,"miso:component");class le extends ce{constructor(e,t,{libName:s,keyName:n}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=e=>e[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new j);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class ue{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new O(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class he{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:de}=document,_e=de.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function pe({}){await Promise.all([fe()])}let me=!1;async function fe(){if(me)return;if(me=!0,!de)throw Error("currentScript not found");const e=de.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=t,n.onerror=s,n.href=e,document.head.appendChild(n)}))}(s)}function ge(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${_e}/${e}`}const be=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en",date_locale:"en-US"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en",date_locale:"en-US"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en",date_locale:"en-US"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en",date_locale:"en-US"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en",date_locale:"en-US"},{key:"computerwoche",name:"Computerwoche",hostname:"www.computerwoche.de",whitepaper_hostname:"us.resources.computerworld.com",regions:[],lang:"de",date_locale:"de-DE"},{key:"cio_de",name:"CIO",hostname:"www.cio.de",whitepaper_hostname:"us.resources.cio.com",regions:[],logo_image:"image/cio.png",lang:"de",date_locale:"de-DE",product_id_key:"ciode"},{key:"cso_de",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:[],logo_image:"image/csoonline.jpeg",lang:"de",date_locale:"de-DE",product_id_key:"cso",base_url:"/de"}].map((({logo_image:e,...t})=>({logo_image:ge(e),...t}))),ye=be.reduce(((e,t)=>(e[t.key]=t,e)),{});function we(e){return ye[e]}async function ve(e,{interval:t=300,timeout:s}={}){const n=e();return null!=n?n:new Promise(((n,i)=>{let o,r;function a(){o&&clearInterval(o),r&&clearTimeout(r)}o=setInterval((()=>{const t=e();null!=t&&(a(),n(t))}),t),s&&s>0&&(r=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}var Ee=Object.freeze(function(){const o=function(e,t){return t?e.replace(t,""):e}((r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r,h.base_url);var r;switch(o){case"":return{type:e};case"/smart-answers":case"/de/smart-answers":return{type:t};case"/search":case"/de/search":return{type:s};default:if(h.regions.indexOf(o.substring(1))>=0)return{type:e}}const a=o.substring(1).split("/");if("article"===a[0]){const e=""+a[1];return{type:n,postId:e,product_id:`article_${h.product_id_key||h.key}_${e}`}}return{type:i}}());const ke="%cMiso",Se="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Oe=[];var Ie=function(){if(c.sponsor)return Oe.find((e=>e.key===c.sponsor))||void 0}(),xe=Object.freeze({__proto__:null,config:c,version:a,site:h,page:Ee,sponsor:Ie,debug:function(...e){(c.debug||a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(ke,Se,...e)}(...e)}}),Ae="1.12.7";const Ce=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Te{constructor(e,t){this._client=e,this._root=t,this._bulk=new oe(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:n,timeout:i}={}){const{request:o={}}=this._client.options;i=i||o.timeout;const r="GET"!==s&&null!=t?JSON.stringify(t):void 0,a=i?AbortSignal.timeout(i):void 0,c=await(this._root._customFetch||window.fetch)(e,b({method:s,headers:n,body:r,cache:"no-cache",mode:"cors",signal:a})),l=await c.json();if(c.status>=400||l.errors){var u=Error(l.message);throw u.data=l,u.status=c.status,u}return l}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:n}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:i,status_code:o,body:r}=n[t];o>=400||i?s.reject({status_code:o,body:r}):s.resolve(r)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e){const{apiKey:t}=this._client.options,s=e.filter((e=>e)).join("/");return`${`${this.getApiEndpoint(s)}/${s}`}?api_key=${window.encodeURIComponent(t)}`}getApiEndpoint(e){const{dataEndpoint:t=Ce.DATA_ENDPOINT,eventEndpoint:s=Ce.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:n}){const i=this._client;for(const o of this._root._urlPasses)try{n=o({client:i,apiGroup:t,apiName:s,url:n})||n}catch(t){(e._error||console.error)(t)}return n}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:n}){const i=this._client;for(const o of this._root._payloadPasses)try{n=o({client:i,apiGroup:t,apiName:s,payload:n})||n}catch(t){(e._error||console.error)(t)}return n}applyHeaderPasses(e,{apiGroup:t,apiName:s,payload:n,headers:i,options:o}){const r=this._client;for(const a of this._root._headersPasses)try{i=a({client:r,apiGroup:t,apiName:s,payload:n,headers:i,options:o})||i}catch(t){(e._error||console.error)(t)}return i}}class Re extends ce{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,o=this._apiPath,r=this._url({apiGroup:o,apiName:e,payload:t,options:s}),a=this._headers({apiGroup:o,apiName:e,payload:t,options:s}),c={apiGroup:o,apiName:e,payload:t=this._preprocess({apiGroup:o,apiName:e,payload:t,options:s}),url:r,headers:a,options:s};this._events.emit("request",{...c,...i});const l=await this._send(c),u={...c,response:l};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_headers({apiGroup:e,apiName:t,payload:s,options:n}){return this.helpers.applyHeaderPasses(this,{apiGroup:e,apiName:t,payload:s,headers:{},options:n})}_preprocess({apiGroup:e,apiName:t,payload:s,options:n}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s,options:n})}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}async _send({apiGroup:e,apiName:t,url:s,headers:n,payload:i,options:{bulk:o,...r}={}}){return o?this.helpers.fetchForBulk(e,t,i):this.helpers.fetch(s,i,{...r,headers:n})}_postprocess({response:e}){return e.data}}const{GROUP:Ne,NAME:$e}=m;class Ue extends Re{constructor(e){super(e,Ne.INTERACTIONS)}async upload(e,t){try{return await this._run($e.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:n,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===$e.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:n}=s;return this.helpers.sendBeacon(e,n,t),{}}return super._send({...s,options:t})}}class Le{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...n}=this._options;const i=new he(s);let o;t=d(this._ac.signal,i.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:o}={}){if(o&&o.aborted)return[];let r,a,c=0,l=!1;function u(){r&&clearInterval(r),l=!0}const h=new D;return r=setInterval((async()=>{let t,r,d;try{if([t,r,d]=await e(o?{signal:o}:{}),l||!y(a)&&a>=d)return;y(d)||(a=d),i&&i(t,r,d),c=0}catch(e){return n&&n(e),c++,void(c>s&&(u(),h.error(e)))}h.update(t,r),r&&u()}),t),o&&o.addEventListener&&o.addEventListener("abort",(()=>{u(),h.abort(o.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?i.clear():this._isUpdated(o,e)&&i.touch(),o=e},...n})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||qe(e.answer)!==qe(t.answer)||qe(e.reasoning)!==qe(t.reasoning)}_revisionOf(e){return e&&e.revision}}class Pe extends Le{constructor(e,t,s,n){super(n),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}function qe(e=""){return e.length}const{GROUP:je,NAME:De}=m;class Me extends Re{constructor(e){super(e,je.ASK)}async questions(e,t={}){if(Be(e)&&(e={question_id:e}),e.question_id)return new Fe(this,e,t);const s=await this._run(De.QUESTIONS,e,t);return new Fe(this,s,t)}async _questions(e,t){return this._run(De.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${De.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(De.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(De.TRENDING_QUESTIONS,e,t)}async search(e,t={}){if(Be(e)&&(e={question_id:e}),e.question_id)return new ze(this,e,t);const s=await this._run(De.SEARCH,e,t);return s.question_id?new ze(this,s,t):s}async _searchGet(e,t){return this._run(`${De.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(De.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(De.SEARCH_AUTOCOMPLETE,e,t)}}class Fe extends Pe{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class ze extends Pe{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),v(this,t),this._response=t}get questionId(){return this._id}}function Be(e){return"string"==typeof e&&"{"!==e.charAt(0)}const{GROUP:Qe,NAME:Ge}=m;class We extends Re{constructor(e){super(e,Qe.SEARCH)}async search(e,t){return this._run(Ge.SEARCH,e,t)}async autocomplete(e,t){return this._run(Ge.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(Ge.MGET,e,t)}}const{GROUP:He,NAME:Ve}=m;class Ye extends Re{constructor(e){super(e,He.RECOMMENDATION)}async userToProducts(e,t){return this._run(Ve.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(Ve.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(Ve.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(Ve.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(Ve.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(Ve.PRODUCT_TO_PRODUCTS,e,t)}}class Ke extends ce{constructor(e,t){super("api",e),this._client=e,this.helpers=new Te(e,t),this.interactions=new Ue(this),this.ask=new Me(this),this.search=new We(this),this.recommendation=new Ye(this)}}var Ze=Object.freeze({__proto__:null,Api:Ke,ApiBase:Re,ApiHelpers:Te,Interactions:Ue,Ask:Me,Search:We,Recommendation:Ye});class Je extends ce{constructor(e){super("context",e),this._client=e}}var Xe={api:Ze,context:{Context:Je}};class et{constructor(e){v(this,{install:e})}}class tt extends le{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new st(this,Xe),this.plugins=new nt(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new j);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addHeadersPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._headersPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const n=new s;return v(n,{id:e}),this._tryConfig(n,t),n;case"function":return new et(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(e,t,s){const n=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),i=0>t?e.length:t,o=e.lastIndexOf("/",i)+1,r=e.indexOf(".",o),a=0>r?"":e.slice(r,i);return`${e.slice(0,o)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${n}.min.js`}(e,t,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new ie).get(s);!this.isRegistered(e)&&this.register(n)}}class st{constructor(e,t){w(this,e,["getPluginClass","addSubtree","addPayloadPass","addHeadersPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),v(this,{classes:t})}}class nt{constructor(e){w(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const it=new class extends ce{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new tt(this),this._clients=[],this._payloadPasses=[],this._headersPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=Ae,this._cmdRes=new j}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var ot=Object.freeze({__proto__:null,viewable:R,debounce:G});const{currentScript:rt}=document;class at extends ce{static attach(){(window.MisoClients||(window.MisoClients=[])).push(at),window.MisoClient?window.MisoClient!==at&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=at}static debug(){}constructor(e){super("client",it),this._config(e),this.context=new Je(this),this.api=new Ke(this,it),function(e){it._clients.push(e),it._events.emit("create",e)}(this)}get version(){return at.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.request&&e.request.sendApiKeyByHeader&&console.warn('`sendApiKeyByHeader` option is deprecated. Please call `MisoClient.plugins.use("std:header-api-key");` instead.'),e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,b(e)}_readConfigFromScriptUrl(){return b({apiKey:new URL(new Request(rt.src||rt.href).url).searchParams.get("api_key")||void 0})}}at.helpers=ot,v(at,{uuid:$()});var ct=function(e){const t=it._pluginRoot;return it.MisoClient=t.MisoClient=e,w(e,it,["version","instances","any","meta","on","once","cmdDone"]),w(e,t,["plugins"]),e}(at);const{GROUP:lt,NAME:ut}=m;let ht;class dt{constructor(e){this._plugin=e,this._props={}}get anonymous_id(){return this._props.anonymous_id||ht||(ht=U("miso_anonymous_id",$))}set anonymous_id(e){this._requireString("anonymous_id",e),this._set("anonymous_id",e)}get user_id(){return this._props.user_id}set user_id(e){this._requireString("user_id",e),this._set("user_id",e)}get user_hash(){return this._props.user_hash}set user_hash(e){this._requireString("user_hash",e),this._set("user_hash",e)}get user_type(){return this._props.user_type}set user_type(e){this._requireString("user_type",e),this._set("user_type",e)}get site(){return this._props.site}set site(e){this._requireString("site",e),this._set("site",e)}get auth(){return this._props.auth}set auth(e){this._requireString("auth",e),this._set("auth",e)}_set(e,t){this._props[e]=t,this._plugin._events.emit("set",`${e} = '${t}'`)}_requireString(e,t){if("string"!=typeof t&&void 0!==t)throw Error(e+" must be a string");return t}}function _t(){const e=new URLSearchParams(window.location.search);let t=b({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class pt{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],n=e[t];n!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function mt(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:Ae};return s.uuid||(s.uuid=$()),{...e,context:{...t,custom_context:s}}}const ft="std:native-fetch";let gt,bt;const yt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return gt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),gt="borrowed",e.contentWindow.fetch}catch(e){bt=e}})();const wt="std:header-api-key";const vt="miso-logdump",Et="miso-logdump",kt=Et+"__download-btn",St="Miso Log";class Ot{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return Ct||(Ct=z(B("logdump")))}();let e=document.getElementById(vt);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||St,t.classList.add(kt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=vt,e.classList.add(Et),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(vt),t=e&&e.querySelector("."+kt);t&&(t.textContent=this._options.logDownloadButtonText||St)}hideDownloadButton(){const e=document.getElementById(vt);e&&(e.style.display="none")}download(){const e=new Blob([xt(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:It()})}return e&&"string"==typeof e?e:`miso-log.${It()}.jsonl`}clear(){this._logs=[]}}function It(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function xt(e){return e.map((e=>JSON.stringify(W(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),At(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function At(e){return e?W(e,{depth:2}):e}let Ct;const Tt="std:debug";function Rt(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}ct.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Ot(e)}static get id(){return Tt}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Tt,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,n)=>this._handleEvent(e,n,s,t)))}_handleEvent(e,{name:t},s,n=[]){if("child"===t||"subtree"===t)return;const i=n.concat(e.meta.path);if(i.length||"create"!==t){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(t,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(i[1],i.slice(2),t,s))}this._logw(i.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:n,bulk:i,...o}){const r=new URL(n).pathname,a=["api",e];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+r),"interactions"===t){const e=o.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=e,i="custom"===t&&s?`${t}:${s}`:t;a.push(n?`${i} (${n})`:""+i)}a.push([{...o,url:n}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,n){this._logw([e,t.join(".")],s,n)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(Rt)):this._log(e,t,Rt(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return ft}install(e,t){yt?(t.setCustomFetch(yt),e.debug(`<plugin:${ft}>`,"[info]",`Using ${gt} native fetch`)):e.debug(`<plugin:${ft}>`,"[error]","Failed to obtain native fetch: "+bt.message)}},class{static get id(){return wt}install(e,t){t.addUrlPass(this._modifyUrl.bind(this)),t.addHeadersPass(this._modifyHeaders.bind(this)),e.debug(`<plugin:${wt}>`,"[info]","Send API key in header")}_modifyUrl({url:e}){return e.replace(/[?&]api_key=[^&]*/g,"")}_modifyHeaders({client:e,headers:t}){const{apiKey:s}=e.options;return s?{...t,"X-API-KEY":s}:t}}),ct.plugins.use(class extends ce{static get id(){return"std:context"}constructor(){super("context")}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addHeadersPass(this._modifyHeaders.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new dt(this);var s,n;s=t,Object.defineProperties(e.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type","site","auth"])?[n]:n).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyHeaders({client:e,headers:t}){const{auth:s}=e.context;return s&&(t={...t,Authorization:s}),t}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:n}){return n?t===lt.INTERACTIONS?s===ut.UPLOAD?this._modifyPayloadForInteractions(e,n):n:this._modifyPayloadForQueries(e,n):n}_modifyPayloadForQueries(e,t){const{user_id:s,user_hash:n,user_type:i,anonymous_id:o,site:r}=e.context;return K(t,{...s?{user_id:s,user_type:i,user_hash:n}:{anonymous_id:o},metadata:r?{site:r}:void 0})}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:n,site:i}=e.context,o={anonymous_id:s,user_id:n},r=i?{site:i}:void 0,a=r?{custom_context:r}:void 0;return{data:t=t.map((e=>Z(e,{...o,context:a})))}}}),ct.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...b({page:b({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:_t()}),...e.context}})))}}}),ct.plugins.use(class extends ce{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new pt(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:n}){if(t===_.SEARCH)if(s===p.SEARCH)this._captureSearchApiRequest(e,n)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),ct.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(mt)}}}),ct.plugins.use(class extends ce{static get id(){return"std:api-patch"}constructor(){super("api-patch")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._patchApiPayload.bind(this))}_patchApiPayload(e){let{payload:t,...s}=e;return t?(t=this._copyMetadataToMeta(t,s),t=this._suppressMetadata(t,s),t=this._suppressUserType(t,s),t):t}_copyMetadataToMeta(e,{apiGroup:t}){return t===_.ASK&&e.metadata?{...e,_meta:e.metadata}:e}_suppressMetadata(e,{apiGroup:t}){switch(t){case _.SEARCH:case _.RECOMMENDATION:const{_meta:t,metadata:s,...n}=e;return n;default:return e}}_suppressUserType(e,{apiGroup:t}){switch(t){case _.SEARCH:case _.RECOMMENDATION:const{user_type:t,...s}=e;return s;default:return e}}});const Nt="data-miso-product-id",$t="default",Ut=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),Lt=new Set([Ut.PRODUCTS,Ut.CATEGORIES,Ut.ATTRIBUTES,Ut.RESULTS,Ut.ITEMS,Ut.QUESTION,Ut.ANSWER,Ut.REASONING,Ut.IMAGES,Ut.SOURCES,Ut.RELATED_RESOURCES,Ut.FOLLOW_UP_QUESTIONS,Ut.QUERY_SUGGESTIONS,Ut.RELATED_QUESTIONS,Ut.AFFILIATION,Ut.FACETS,Ut.TOTAL]);function Pt(e){return Lt.has(e)}const qt=new Set([Ut.PRODUCTS,Ut.IMAGES,Ut.SOURCES,Ut.RELATED_RESOURCES]);const jt=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),Dt=[jt.IMPRESSION,jt.VIEWABLE,jt.CLICK,jt.SUBMIT,jt.FEEDBACK],Mt=[jt.IMPRESSION,jt.VIEWABLE,jt.CLICK],Ft=new Set(Mt);const zt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Bt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),Qt=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function Gt(e){if(0>Dt.indexOf(e))throw Error("Unrecognized event type: "+e)}const Wt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"}),Ht=Object.freeze({QUERY:"query",REFINE:"refine",MORE:"more"});function Vt(e,t){return Object.freeze({...e,...t,members:Yt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Yt(e=[],t=[]){return[...new Set([...e,...t])]}function Kt(e,t){let s={};for(const n of e)n&&(s=t(s,n));return b(s)}function Zt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Jt(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>Object.assign(e,{...t,payload:K(e.payload,t.payload)})))}function Xt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function es(e){if(void 0===e)return;let[t,s]=g(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function ts(e,t){return!1===(t=es(t))[0]?t:e&&t?[t[0]||e[0],ss(e[1],t[1])]:t||e}function ss(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const ns=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function is(e={}){e=Zt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))os(t);return e}function os(e={}){return e=Zt(e)}function rs(e={},t={}){const s={...e};for(const[n,i]of Object.entries(t))void 0!==i&&(s[n]=Dt.includes(n)?as(e[n],i):i);return s}function as(e={},t={}){return{...e,...t}}function cs(e){return void 0===e?void 0:"function"!=typeof e?()=>e:e}const ls=[{key:Wt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return b({group:s,name:e,payload:t})},merge:Jt},{key:Wt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${Ut.PRODUCTS}: ... }) instead`),e={...s,[Ut.PRODUCTS]:t});const n={};for(const[t,s]of Object.entries(e))n[Xt(t)]=es(s);return n},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{for(const[s,n]of Object.entries(t))e[s]=ts(e[s],n);return e}))}},{key:Wt.DATA_PROCESSOR,normalize:function(e){e=g(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:Wt.TRACKERS,normalize:function(e={}){e=Zt(e);const{active:t,...s}=e,n={};for(const[e,t]of Object.entries(s))n[e]=is(t);return{active:t,...n}},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{for(const[s,n]of Object.entries(t))void 0!==n&&(e[s]="active"===s?n:rs(e[s],n));return e}))}},{key:Wt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=g(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,n=t.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}},{key:Wt.FILTERS,normalize:Zt,merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>Object.assign(e,t)))}},{key:Wt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&Kt(e,((e,t)=>Object.assign(e,t)))}},{key:Wt.TEMPLATES,normalize:function(e={}){const t={};for(const[s,n]of Object.entries(e))t[s]=cs(n);return t},merge:function(...e){return Kt(e,((e,t)=>{for(const[n,i]of Object.entries(t))e[n]=(s=e[n],cs(i)||s);var s;return e}))}}];class us{constructor(){this._events=new re({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class hs{constructor(e={},t={}){this._events=new re({target:this}),this._defaults=t,this._context=e||{},this._locals={},v(this,{resolved:new ds(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class ds{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,n=s._context[e];this._cache[e]=t(s._defaults[e],n&&n.get(),s._locals[e])}return this._cache[e]}}class _s{constructor(e,t,s,n,i){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?n(e):void 0,this._merge=i}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of ls){const{key:t,normalize:s,merge:n}=e;Object.defineProperty(us.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new _s(this,this._globals,t,s,n))}}),Object.defineProperty(hs.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new _s(this,this._locals,t,s,n))}}),Object.defineProperty(ds.prototype,t,{get:function(){return this._get(e)}})}const ps=[Wt.API,Wt.LAYOUTS,Wt.DATA_PROCESSOR,Wt.TRACKERS,Wt.INTERACTIONS];function ms(e,t=ps){for(const s of t)fs(e,s)}function fs(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+n](e){return this._options[t].merge(e),this},["clear"+n](){return this._options[t].set(),this}})}var s}const gs="q",bs="qs";function ys(e={}){const{setValue:t,focus:s,param:n,sourceParam:i}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:n=gs,sourceParam:i=bs,...o}={}){return{setValue:e,focus:t,updateUrl:s,param:n,sourceParam:i,...o}}(e),o=new URLSearchParams(window.location.search),r=o.get(n),a=o.get(i)||void 0,{layout:c}=this._views.get(Ut.QUERY);c&&(r&&t&&(c.value=r),!r&&s&&c.focus()),r&&this.query(b({q:r,qs:a}))}function ws({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:n}=this._autoQuery,i=e&&(e.question||e.keyword)||t&&t.payload&&(t.payload.question||t.payload.q),o=t&&t.payload&&t.payload.metadata&&t.payload.metadata.question_source;if(!i)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(n)||Qt.ORGANIC;i===a&&o===c||(r.searchParams.set(s,i),o===Qt.ORGANIC?r.searchParams.delete(n):r.searchParams.set(n,o),window.history.replaceState({},"",r))}class vs extends ce{constructor(e,t,s){super(e,t),this._name=e,this._plugin=t,this._client=s,this._options=new us}}function Es(e){return e?"view:"+e:"view"}ms(vs.prototype);class ks{constructor(e={}){(this._events=new re)._injectSubscribeInterface(this),this._options=e,this._states={},v(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const n=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(n),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(n)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Ss{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:$(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function Os(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class Is{constructor(e,{source:t,options:s,polling:n=!0}){this._hub=e,this._source=t,this._options=s,this._polling=n,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e}async _handleRequest(e){if(!this.active)return;const{session:t,...s}=e;try{const{signal:n}=this._ac||{},i={...e.options,signal:n},o=await this._source({session:t,...s,options:i});if(o&&o[Symbol.asyncIterator]){if(o._response&&this._emitResponseWithSessionCheck({session:t,request:s,value:o._response}),this._polling){let e;for await(e of o){if(!Os(this._hub,t))break;this._emitResponse({session:t,request:s,value:e})}}}else this._emitResponseWithSessionCheck({session:t,request:s,value:o})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:s,error:e})}}_emitResponseWithSessionCheck(e){Os(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class xs{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{f(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:As,VIEWABLE:Cs,CLICK:Ts}=jt,{UNTRACKED:Rs,TRIGGERED:Ns}=zt,$s=Object.freeze({[As]:Rs,[Cs]:Rs,[Ts]:Rs});class Us{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:$s}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||Rs}set(e,t,s){Gt(t),function(e){if(e!==zt.UNTRACKED&&e!==zt.TRACKING&&e!==zt.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const n of g(e))this._setOne(n,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Ns))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const n=s(t);return e.set(t,n),n}(this._states,this._getKey(e),(()=>({...$s}))))[t]=s}}const Ls=[Symbol("itemless")];class Ps{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Us(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){Gt(e);const{options:n}=this;if(!n||!1===n.active)return;this._syncSession();const{deduplicated:i=!0,itemless:o=!1}=n;if(i){if(o&&(t=Ls),0===(t=this._states.untriggered(g(t),e)).length)return;this._states.set(t,e,zt.TRIGGERED)}this._sendToHub({type:e,items:o?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:jt.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(b({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Us(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[Es(this._role)]}}for(const e of Mt)Ps.prototype[e]=function(t,s){this._trigger(e,t,s)};function qs(e){return e&&e.meta&&e.meta.empty}class js{constructor(e,t){this._events=new re({target:this}),this._views=e,this._mapping=Ms((e._roles.mappings||{})[t]||t),v(this,{role:t,interface:new Ds(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new xs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===Ut.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new Ps({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((i=t)===(o=n)||i&&o&&i.status===o.status&&i.error===o.error&&i.value===o.value&&i.ongoing===o.ongoing&&qs(i)===qs(o)&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(i.session,o.session)))return;var i,o;const{session:r,status:a,ongoing:c,request:l,meta:u,value:h}=t,d={session:r,status:a,ongoing:c,request:l,meta:u,data:h,...Fs(this.role,t)},_=(e={},t)=>{!1!==e&&this.updateState({...d,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:_})}catch(e){this._error(e),_({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?Bt.ERRONEOUS:e.status;e=this._state=Object.freeze(b({...e,status:s}));const{role:n}=this;this.hub.update(Es(n),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:n,meta:i,...o}=e,r={value:this._mapping(e,this),status:n,data:t,meta:i,...o};return this.role===Ut.CONTAINER&&(r.meta={...i,empty:this._isContainerEmpty(e)}),b(r)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!Pt(s))continue;if(!zs(s,Ms((this._views._roles.mappings||{})[s]||s)(e,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ds{constructor(e){w(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Ms(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}function Fs(e,t){return function(e){return e.status===Bt.READY&&!e.ongoing}(t)?{empty:!!zs(e,t&&t.value)}:{}}function zs(e,t){switch(e){case Ut.ANSWER:case Ut.REASONING:return!t||!t.value;default:return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}}function Bs(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class Qs{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new re({target:this,error:s}),v(this,{facets:new Gs(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return b({facets:Object.freeze({}),sort:Bs(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(b({...e,...t,facets:Object.freeze(b({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Gs{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const Ws=Symbol.for("miso:tracked");function Hs(e){return!!e[Ws]}function Vs(e){e[Ws]=!0}const Ys=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function Ks(e,t){return!!t&&{...e,...t}}class Zs{constructor(e,{workflow:t,extensions:s,layouts:n,roles:i,options:o}){this._hub=e,this._workflow=t,this._workflowName=t._name,this._extensions=s,this._layoutFactory=n,this._options=o,this._roles=i,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new Qs(this);for(const e of i.members)e!==Ut.CONTAINER&&(this._views[e]=new js(this,e));v(this,{interface:new Js(this),trackers:new Xs(this,i.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),e.on("data",(e=>this.refresh({data:e}))),o.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new js(this,Ut.CONTAINER);t.layout=this._createLayout(Ut.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,n]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName});if(t===Ut.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,n]=t;return this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:n={},...i}=e;return b({...Ys,...i,impression:Ks(Ys.impression,t),viewable:Ks(Ys.viewable,s),click:Ks(Ys.click,n)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=Ut.CONTAINER;this._containerTracker=new Ps({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class Js{constructor(e){this._actor=e,w(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class Xs{constructor(e,t){this._views=e;for(const s of t)s!==Ut.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,Ut.CONTAINER,{get:()=>e._getContainerTracker()})}}class en{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:jt.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class tn{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=g(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function sn(e){return async({group:t,name:s,payload:n,options:i})=>{if(t===_.ASK)switch(s){case p.QUESTIONS:return e.api.ask.questions(n,i);case p.SEARCH:return e.api.ask.search(n,i)}return e.api[t]._run(s,n,i)}}class nn{constructor({role:e,workflow:t,...s}={}){v(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const n=this._rendered.get(e),i=P(!1);t=this._preprocess({state:t,rendered:n},{skip:i.t})||t,this._updatePending(t,s),i.value||this._handleInput({state:t,rendered:n},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,T((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:e});const i=this._rendered.get(this._element),o=P([]),r=P({});this._render(this._element,{state:s,rendered:i,timestamp:e},{notifyUpdate:o.args,writeToState:r.merge,...t}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),n&&n(...o.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function on(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function rn(e,t,s,n){const{templates:i}=e,[o,r]=kn(e,s);return""+o+(i.indexBlock||vn)(e,s,n)+(i.infoBlock||i.articleInfoBlock||un)(e,s,n)+r}function an(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||dn)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.priceBlock||bn)(e,t,s)+(i.ctaBlock||En)(e,t,s)}</div>`}function cn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||dn)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.priceBlock||bn)(e,t,s)}</div>`}function ln(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||dn)(e,t,s)+(i.dateBlock||mn)(e,t,s)+(i.descriptionBlock||pn)(e,t,s)+(i.ctaBlock||En)(e,t,s)}</div>`}function un(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||dn)(e,t,s)+(i.authorsAndDateBlock||gn)(e,t,s)}</div>`}function hn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-info-container">${""+(i.titleBlock||dn)(e,t,s)}</div>`}function dn({className:e},{title:t,_title_with_markups:s}){const n=xn(s)||N(t);return n?`<div class="${e}__item-title">${n}</div>`:""}function _n({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function pn({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${xn(t)}</div>`:s?`<div class="${e}__item-desc">${N(s)}</div>`:""}function mn({className:e,templates:t},{created_at:s,updated_at:n,published_at:i}){const o=i||s||n;return o?`<div class="${e}__item-date">${In(o,t.date)}</div>`:""}function fn({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function gn(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__item-authors-and-date-container">${""+(i.authorsBlock||fn)(e,t,s)+(i.dateBlock||mn)(e,t,s)}</div>`}function bn(e,t){const{className:s,templates:n}=e,{sale_price:i,original_price:o,currency:r="USD"}=t,a=i||o;if(!a)return"";const c=void 0!==o&&void 0!==i&&o>i,l=t.discount_rate_percent||(c?Math.floor(100*(1-i/o)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${o}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(n.discountRateText||yn)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function yn(e,{discount_rate_percent:t}){return`(${t}% off)`}function wn(e,t,s={}){const{className:n,templates:i}=e,{cover_image:o,image_src:r,image_alt:a}=t;if(!o&&!r)return"";const c=r?"image":"cover-image";return`<div class="${n}__item-${c}-container">${"image"===c?`<img class="${n}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${n}__item-${c}" src="${o}">`}${"cover-image"===c&&s.brand?(i.brandBlock||_n)(e,t,s):""}</div>`}function vn({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function En(e,t,s){const{className:n,templates:i}=e,o=An.asFunction(i.cta)(e,t,s);return o?`<div class="${n}__item-cta-container">${o}</div>`:""}function kn({className:e,options:t={}},{product_id:s,url:n},{classSuffix:i="item-body",role:o="item",...r}={}){const a=!1!==r.link&&n?"a":"div",c=!1!==r.link&&n?`href="${n}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:n=!0}=e;let i="";n&&(t&&(i+=` target="${t}"`),s&&(i+=` rel="${s}"`));return i}(t.link)}`:"";return[`<${a} class="${e}__${i}" ${o?`data-role="${o}"`:""} ${s?`${Nt}="${s}"`:""} ${c}>`,`</${a}>`]}const Sn=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),On="en-US";function In(e,t=Sn){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||Sn.locale,t);default:throw Error("Invalid date format: "+t)}}function xn(e){return e&&e.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const An=Object.freeze({tagPair:kn,formatDate:In,formatNumber:function(e,t=On){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||On.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},formatHtmlWithMarkup:xn,escapeHtml:N,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class Cn extends nn{constructor({className:e,templates:t,...s}={}){super(s),v(this,{className:e,templates:{...on("root"),...t,helpers:An}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Tn extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Tn.MisoClient.ui.layouts.create("banner").render(this)}}class Rn{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(e,{ac:s});let i=!1;try{await R(e,{...t,signal:n}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return i}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class Nn extends nn{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new Rn}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Tn.tagName,s=this._shallRenderBanner(e),n=e.querySelector(t);s&&!n?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&n&&n.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,n=void 0!==s&&"auto"!==s?s:t;return"auto"===n?e.components.some((({role:e})=>function(e){return e===Ut.PRODUCTS||e===Ut.ANSWER}(e))):!!n}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:o=!1,unanswerable:r=!1}={}}=t,a=[s,o?Bt.EMPTY:Bt.NONEMPTY];s===Bt.READY&&a.push(n?Bt.ONGOING:Bt.DONE),r&&a.push(Bt.UNANSWERABLE),e.setAttribute("status",a.join(" ")),i?e.setAttribute("miso-id",i):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===Bt.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const $n=Object.freeze({root:function(e,t){const{className:s,templates:n}=e,{status:i,value:o}=t;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(e,o)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class Un extends Cn{static get type(){return"error"}static get defaultTemplates(){return $n}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...$n,...t},...s})}}const Ln=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Pn(e,t){const s=[];for(const n of t.entries){const t=e.e2b.get(n.element);t&&t.key===n.key||s.push(n)}return s}class qn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const n=function(e,t,s){const n=new Map,i=new Map,o=[];for(let r=0;e.length>r;r++){const a=e[r],c=s[r],l=Object.freeze({index:r,key:a,value:t[r],element:c});n.set(a,l),i.set(c,l),o.push(l)}return{k2b:n,e2b:i,entries:o}}(e,t,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},o=Pn(i,n),r=Pn(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:o,unbounds:r}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function jn(e){V(e,Dn.prototype)}class Dn{_initTrackable(){this._bindings=new qn,this._viewables=new Rn}_syncBindings(e,t){const s=this._getItems(t)||[],n=s.map((e=>this._getItemKey(e))),i=this._getItemElements(e),{bounds:o,unbounds:r}=this._bindings.update(n,s,i);this._onBindingsUpdate(o,r)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:n}of e)(async()=>{await this._viewables.track(n,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!Hs(t)&&0===t.button&&!t.defaultPrevented&&!!A(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(Vs(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Mn{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===Bt.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let n=!1;try{await R(t,{area:1,duration:0,signal:s.signal}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}n&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Fn=Object.freeze({product:function(e,t,s,n){const{templates:i}=e,[o,r]=kn(e,s);return""+o+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.productInfoBlock||cn)(e,s,n)+r},article:function(e,t,s,n){const{templates:i}=e,[o,r]=kn(e,s);return""+o+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.articleInfoBlock||ln)(e,s,n)+(i.indexBlock||vn)(e,s,n)+r},compactArticle:rn,image:function(e,t,s,n){const{templates:i}=e,[o,r]=kn(e,s);return""+o+(i.imageBlock||wn)(e,s,n)+(i.infoBlock||i.imageInfoBlock||hn)(e,s,n)+r},question:function(e,t,s){const[n,i]=kn(e,s);return`${n}${s.value||s.text||s}${i}`},root:function(e,t){const{className:s,role:n,templates:i,options:o}=e,{status:r}=t;return`<div class="${s} ${r}"${n?` data-role="${n}"`:""}${o.itemType?` data-item-type="${o.itemType}"`:""}>${r===Bt.READY?i[r](e,t):""}${i.trigger(e,t)}${i.loading(e,t)}</div>`},[Bt.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t)||[];return n.length>0||t.ongoing?s.body(e,t,n):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:n,templates:i,options:o}=e,r=i.ordered?"ol":"ul";return`<${r} class="${n}__list" data-role="list"${o.itemType?` data-item-type="${o.itemType}"`:""}>${i.items(e,t,s)}</${r}>`},ordered:!1,items:function(e,t,s,{offset:n=0}={}){const{templates:i}=e;let o=n;return s.map((s=>i.item(e,t,s,o++))).join("")},item:function(e,t,s,n){const{className:i,templates:o,options:r}=e,{itemType:a}=r;return`<li class="${i}__item">${o[a](e,t,s,{index:n})}</li>`},productInfoBlock:cn,articleInfoBlock:ln,compactArticleInfoBlock:un,imageInfoBlock:hn,brandBlock:_n,titleBlock:dn,descriptionBlock:pn,dateBlock:mn,authorsBlock:fn,authorsAndDateBlock:gn,priceBlock:bn,discountRateText:yn,ctaBlock:En,cta:function(e,t,s){const{templates:n}=e,{url:i}=t;if(!i)return"";const[o,r]=kn(e,{url:i},{classSuffix:"item-cta",role:"cta"}),a=An.asFunction(n.ctaText)(e,t,s);return a?`${o}${a}${r}`:""},imageBlock:wn,indexBlock:vn,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class zn extends Cn{static get defaultTemplates(){return Fn}constructor({templates:e,itemType:t="product",...s}){super({templates:{...Fn,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=this._html(e,t,s);return{...e,incremental:s,html:n}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:n,html:i}=t;if(n)if(i){this._getListElement(e).insertAdjacentHTML("beforeend",i)}else s(!1);else e.innerHTML=i}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value&&(e.value.products||e.value)}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:n,element:i}=t;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}jn(zn.prototype),V(zn.prototype,Mn.prototype);const Bn="miso-list";class Qn extends zn{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Bn}constructor({className:e=Bn,...t}={}){super({className:e,...t})}}const Gn="miso-horizontal";class Wn extends zn{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Gn}constructor({className:e=Gn,...t}={}){super({className:e,...t})}}const Hn="miso-cards";function Vn(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function Yn(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function Kn(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),n=t[2]||"";return[s,n]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function Zn(e){return void 0===e||e instanceof Jn?e:new Jn(e)}class Jn{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=Zn(e),Zn([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class Xn{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,T((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),n=t.itemCount,i=t.itemCount=s?s.length:void 0;i!==n&&(void 0===i?t.itemIndex=void 0:void 0===n&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(Vn(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let n=0;for(const t of s.children)Yn(t,"active",n===e),n++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const ei="miso-ui-icon",ti=ei+"-svg-1_12_7",si={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},ni=`<symbol id="${ei}-${si.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,ii=`<symbol id="${ei}-${si.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,oi=`<symbol id="${ei}-${si.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,n=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-n} ${n}L${n} ${t-n}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,ri=`<svg id="${ti}" style="display:none;">${[ni,ii,oi,`<symbol id="${ei}-${si.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${ei}-${si.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${ei}-${si.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${ei}-${si.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let ai=!1;function ci(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${ei}-${e}"></use></svg>`}ai||document.head.querySelector("#"+ti)||(ai=!0,document.head.insertAdjacentHTML("beforeend",ri));const li=new Set(Object.values(si));ci(si.SEND),ci(si.SEARCH);const ui=ci(si.TRIANGLE);ci(si.TRIANGLE_EQ);const hi=ci(si.CHEVRON),di=ci(si.CHEVRON_NEGATIVE),_i=ci(si.BULB),pi="miso-carousel",mi=Object.freeze({body:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__viewport"><div class="${n}__viewport-inner">${i.list(e,t,s)}</div></div>${i.controls(e,t,s)}`},controls:function(e,t,s){const{templates:n}=e;return`${n.controlContainer(e,t,"previous")}${n.controlContainer(e,t,"next")}${n.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-container-${s}">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?di:hi},indexIndicator:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${n}__index-indicator-item">${i.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),fi=Object.freeze({...zn.defaultTemplates,...mi});class gi extends zn{static get type(){return"carousel"}static get defaultTemplates(){return fi}static get defaultClassName(){return pi}constructor({className:e=pi,templates:t,...s}={}){super({className:e,templates:{...mi,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){V(e,Xn.prototype)}(gi.prototype);const bi="16rem",yi=Object.freeze({...zn.defaultTemplates,item:function(e,t,s,n){const{className:i,templates:o,options:r}=e,{itemType:a}=r,c=o[a](e,t,s,{index:n});return`<li class="${i}__item${s._size?` ${i}__item-${s._size}`:""}">${c}</li>`}}),wi="miso-gallery";class vi extends zn{static get type(){return"gallery"}static get defaultTemplates(){return yi}static get defaultClassName(){return wi}constructor({className:e=wi,templates:t,...s}={}){super({className:e,templates:{...yi,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),n=s?void 0:this._bodyHtml(e),i=this._itemsHtml(e,t);return{...e,...b({incremental:s,bodyHtml:n,itemsHtml:i})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,n=(this._getItems(e)||[]).slice(s);return n.length>0?this.templates.items(this,e,n,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const n=this._renderListElement(e,t,s);n&&(this._syncListAspectRatio(n),this._renderItems(n,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:n}=t;return s||(e.innerHTML=n),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,n=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,n)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const n=e.children.length,i=this._writeItemSizes((this._getItems(t)||[]).slice(n),s,n);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,i,{offset:n}))}_writeItemSizes(e,[t=0,s=0]=[],n=0){let i=0;n>0&&(i=Math.min(n,t),n-=i,t-=i),n>0&&(i=Math.min(n,s),n-=i,s-=i);const o=[];for(const n of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),o.push({...n,_size:e})}return o}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=Zn(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:n}=t,{height:i=bi}=this.options,o=Kn(i),r=e.clientWidth;if(0===r)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(r*n.width*2/(o*n.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),n=e;const i=Math.min(Math.floor(s/3),n);n-=i,s-=3*i;const o=Math.min(s,n);return n-=o,s-=o,[i,o,n]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,n=0]=t;const{className:i}=this;for(const t of e.children){let e=!1,o=!1;s>0?(e=!0,s--):n>0&&(o=!0,n--),Yn(t,i+"__item-large",e),Yn(t,i+"__item-medium",o),Yn(t,i+"__item-small",!e&&!o)}}}const Ei="miso-search-box";const ki=Object.freeze({root:function(e){const{className:t,templates:s,role:n,options:i,autocomplete:o}=e,{placeholder:r}=i;return`\n<div class="${t}" ${n?`data-role="${n}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${o.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:n,buttonIcon:i}=t;var o;return("function"==typeof n?n(e):""+n)+("function"==typeof i?i(e):(li.has(o=i)?ci(o):"")||""+i)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:n,autocomplete:i}=e;e={templates:s,workflow:n,...i};const o=[],r=[];for(const e of t)(e.product?o:r).push(e);return s.queries(e,r)+(r.length>0&&o.length>0?"<hr>":"")+s.products(e,o)},completionList:function(e,t,s){const{className:n,templates:i}=e;return`<ul class="${n}__${t}-list" data-role="${t}-list">${s.map((s=>i.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:n,templates:i}=e;return`\n<li class="${n}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${i[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||N(t)},product:function(e,{product:t}){const{templates:s}=e,[n,i]=s.helpers.tagPair(e,t,{role:!1});return""+n+s.imageBlock(e,t)+s.productInfoBlock(e,t)+i},imageBlock:wn,productInfoBlock:cn}),Si=Object.freeze({className:"miso-autocomplete",debounce:300});class Oi extends Cn{static get type(){return"search-box"}static get defaultTemplates(){return ki}static get defaultClassName(){return Ei}constructor({className:e=Ei,templates:t,autocomplete:s,...n}={}){super({className:e,templates:{...ki,...t},...n}),v(this,{autocomplete:{...Si,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=G(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:n}){if(!t.completions)return;const{status:i=Bt.INITIAL,session:o,value:r}=t.completions,{index:a}=o;if(s&&s.completions.index===a&&s.completions.status===i)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);Yn(e,"nonempty",u.length>0),l.setAttribute("data-status",i),l.innerHTML=this.templates.completions(this,u),n({completions:{index:a,status:i}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return Ii.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new Ii(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&A(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let n=t;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const t=n.getAttribute("data-index"),i=this._context().data.get(parseInt(t)),o=i&&i.text;return o&&(s&&(s.value=o),this._view._events.emit("select",Object.freeze({value:i,index:t,domEvent:e})),e.defaultPrevented||this._submit(o)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[jt.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class Ii{static empty(){return Ii._empty||(Ii._empty=new Ii)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,n=[];for(const i in e)for(const o of e[i])o.product&&!o.product.url||(o._index=t,o._field=i,s.set(t,o),n.push(o),t++);return n}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const xi="miso-option-list";const Ai=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:n}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>n.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${N(t.text||t)}</li>`}});class Ci extends Cn{static get type(){return"option-list"}static get defaultTemplates(){return Ai}static get defaultClassName(){return xi}constructor({className:e=xi,templates:t,...s}={}){super({className:e,templates:{...Ai,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_render(e,t,s){super._render(e,t,s);const{state:n}=t;this._syncOptionValues(e,n)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;Yn(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;n&&(this._trackClick(e,s),this._select(n.text))}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}jn(Ci.prototype);const Ti=Object.freeze({...on("options"),root:function(e){const{className:t,role:s,templates:n}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${n.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:n}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${n.content(e,t)}\n</div>\n`}});class Ri extends Cn{static get defaultTemplates(){return Ti}constructor({className:e,templates:t,field:s,defaultValue:n,...i}={}){super({className:e,templates:{...Ti,...t},...i}),this._field=s,this._defaultValue=n}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=A(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=t.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],T((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:n}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",n),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const Ni="miso-feedback",$i=["helpful","unhelpful"];const Ui=Object.freeze({options:function(e){const{templates:t}=e;return $i.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:n,options:i={}}=e;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(e,t)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Li extends Ri{static get type(){return"feedback"}static get defaultTemplates(){return Ui}static get defaultClassName(){return Ni}constructor({className:e=Ni,templates:t,...s}={}){if(super({className:e,templates:{...Ui,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Pi="miso-text";const qi=Object.freeze({root:function(e,{value:t}){const{className:s,role:n,options:{raw:i=!1,tag:o}}=e,r=n?`data-role="${n}"`:"",a=void 0!==t?N(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:n}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[i,o]=t;switch(i){case"date":return e=>s(e,o);case"number":return e=>n(e,o);default:return e=>""+e}}(e)(t)):"";return i?a:`<${o} class="${s}" ${r}>${a}</${o}>`}});class ji extends Cn{static get type(){return"text"}static get defaultTemplates(){return qi}static get defaultClassName(){return Pi}constructor({className:e=Pi,templates:t,tag:s="p",...n}={}){super({className:e,templates:{...qi,...t},tag:s,...n})}}class Di extends nn{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=P(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Mi{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:n,cursor:i,done:o}){const r=n.length;i=Math.min(i,r);const a=!!o&&i===r,c=t.substring(0,s),l=!n.startsWith(c);return a||l?e.innerText=n:e.insertAdjacentText("beforeend",n.substring(s,i)),a&&e.classList.add("done"),{cursor:i,done:a}}}function Fi(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:n,format:i,builtInStyles:o=!0}}=e;"auto"===n&&(n="markdown"===i?"div":"p");const r=s?`data-role="${s}"`:"",a=[t,zi(t)];o&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${r} data-format="${i}"></${n}>`}(e));const n=t.children[0];return n.setAttribute("data-status",s||Bt.INITIAL),n}function zi(e){return e+"__cursor"}function Bi(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:n,ref:i,operation:o,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Qi(n[0])}, ${Qi(n[1])})`,t,""+o,i,r)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Qi(e){return Math.floor(100*e)/100+"ms"}const Gi="miso-typewriter";class Wi extends Di{static get type(){return"typewriter"}static get defaultClassName(){return Gi}constructor({className:e=Gi,tag:t="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:o,nextCursorFn:r,...a}={}){super({tag:t,format:s,tooltip:n,...a}),v(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:ee({speed:i,acceleration:o}),this._readiness=new j,"markdown"===s&&Wi.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=zi(this.className),{onDebug:s,onCitationLink:n,variant:i}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:n,onDebug:Bi(s),variant:i}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Mi}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:{value:s="",stage:n,finished:i}={},session:o,status:r}=e,a=(l=e,(c=t)&&l&&c.session&&l.session&&c.session.uuid===l.session.uuid);var c,l;const u=t?a&&n===t.stage?t.streak:t.streak+1:0,h=a&&t&&t.doneAt||(r===Bt.READY&&i?performance.now():void 0);return this._prevState=Object.freeze(b({session:o,status:r,value:s,stage:n,streak:u,doneAt:h,done:void 0!==h}))}_render(e,{state:t,rendered:s},{notifyUpdate:n,writeToState:i,loop:o}){const r=Fi(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(r,s,{...t,cursor:e})}i(a);const l=t.status===Bt.READY&&!a.done;n({ongoing:l},{silent:l&&(!s||s.status===Bt.READY)&&!c}),l&&o()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const n=t.closest('[data-role="follow-up-link"]');if(n){let{q:t}=n.dataset;return t=t?t.trim():void 0,void(t&&this._view._events.emit("follow-up-click",{event:e,q:t}))}const i=t.closest("a");if(i){if(!e.defaultPrevented){const{href:t,innerText:s,className:n}=i;t&&this._view._events.emit("link-click",b({event:e,url:t,text:s?s.trim():"",className:n||"",attributes:Hi(i)}))}}else;}}function Hi(e){const{attributes:t}=e,s={};for(const{name:e,value:n}of t)e.startsWith("data-")&&(s[e]=n);try{return JSON.stringify(s)}catch(e){return"{}"}}const Vi="miso-affiliation";const Yi=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i,options:o}=e,{status:r}=t,a=n?` data-role="${n}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${o.itemType?` data-item-type="${o.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${r===Bt.READY?i[r](e,t):""}</div>`},[Bt.READY]:function(e,t){const{templates:s}=e,n=e._getItems(t);return n&&n.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}-container">${i.control(e,t,s)}</div>`},control:function(e,t,s){const{className:n,templates:i}=e;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return ui},body:function(e,t){const{className:s,templates:n}=e,i=e._getItems(t);return`<div class="${s}__body">${n.list(e,t,i)}</div>`},item:function(e,t,s,n){const{className:i,templates:o,options:r}=e,{itemType:a}=r;return`<li class="${i}__item"><div class="${i}__item-inner">${o.itemHeader(e,t,s,{index:n})}${o[a](e,t,s,{index:n})}</div></li>`},itemHeader:function(e,t,s,n){const{className:i,templates:o}=e;let{itemHeaderLeftText:r,itemHeaderRightText:a}=o;return r=An.asFunction(r)(e,t,s,n),a=An.asFunction(a)(e,t,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${r}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,n){const{templates:i}=e,[o,r]=kn(e,s,{link:!1});return""+o+(i.infoBlock||i.affiliationInfoBlock||an)(e,s,n)+(i.imageBlock||wn)(e,s,{brand:!0,...n})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,n){const{className:i,templates:o}=e,r=An.asFunction(o.logoText)(e,t,s,n)||"",a=An.asFunction(o.logoImg)(e,t,s,n);return a?`<span class="${i}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(e,t,s,n){const{className:i,templates:o}=e,r=An.asFunction(o.logoUrl)(e,t,s,n);if(!r)return"";const a=An.asFunction(o.logoAltText)(e,t,s,n);return`<img class="${i}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Ki=Object.freeze({...zn.defaultTemplates,...Yi});class Zi extends zn{static get type(){return"affiliation"}static get defaultTemplates(){return Ki}static get defaultClassName(){return Vi}constructor({className:e=Vi,templates:t,autoplay:s,...n}={}){super({className:e,itemType:"affiliation",templates:{...Yi,...t},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new ue(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,T((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(Vn(n,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const Ji="miso-facets",Xi="miso-facet",eo="custom_attributes.";const to=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:n={}}=t.value||{};return Object.keys(n).map((i=>s.facet(e,{field:i,entries:n[i]},t)))},facet:function(e,t,s){const{facetClassName:n=Xi,templates:i}=e,{field:o}=t;return`<div class="${n}" data-role="facet" data-field="${N(o)}">${i.header(e,t,s)}${i.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:n=Xi,templates:i}=e;return`<div class="${n}__header">${i.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(eo)&&(t=t.substring(18)),N(t)},options:function(e,{field:t,entries:s},n){const{facetClassName:i=Xi,templates:o}=e;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>o.option(e,{field:t,value:s,count:i},n))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:n=Xi,templates:i}=e;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(e,t,s)}</span>\n  <span class="${n}__count">${i.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return N(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function so(e,t){return`${e}:::${t}`}function no(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class io extends Cn{static get type(){return"facets"}static get defaultTemplates(){return to}static get defaultClassName(){return Ji}constructor({className:e=Ji,templates:t,...s}={}){super({className:e,templates:{...to,...t},...s}),this._bindings=new qn}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=no(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)this._setSelected(n,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=no(e.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)t[e]&&this._setSelected(n,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),n=[],i=[],o=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),r=s[e];if(!r)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=r[t];if(!c)break;n.push(so(e,c)),i.push({field:e,value:c}),o.push(s)}}this._bindings.update(n,i,o)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[N(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),n=s&&s.value;if(!n)return;const{field:i,value:o}=n;this._view.filters.facets.toggle(i,o),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const oo="miso-select";const ro=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e,o=n?`data-role="${n}"`:"",r=e._getItems(t),a=r.find((e=>e.selected))||r[0];return`\n<div class="${s}" ${o}>\n  ${i.button(e,a)}\n  ${i.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:n}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${n.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:n}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>n.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:n}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${n.text(e,t)}</li>`},text:function(e,t){return N(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,((e,t)=>" "+t))||t||"")}});class ao extends Cn{static get type(){return"select"}static get defaultTemplates(){return ro}static get defaultClassName(){return oo}constructor({className:e=oo,templates:t,...s}={}){super({className:e,templates:{...ro,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}jn(ao.prototype);const co="miso-more-button";const lo=Object.freeze({root:function(e,t){const{className:s,role:n,templates:i}=e;return`\n<div class="${s}"${n?` data-role="${n}"`:""}${t.status!==Bt.READY?" disabled":""}>\n  ${i.text(e)}\n</div>\n`},text:function(e){return"More"}});class uo extends Cn{static get type(){return"more-button"}static get defaultTemplates(){return lo}static get defaultClassName(){return co}constructor({className:e=co,templates:t,...s}={}){super({className:e,templates:{...lo,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var ho=Object.freeze({__proto__:null,TemplateBasedLayout:Cn,ContainerLayout:Nn,ErrorLayout:Un,BannerLayout:class extends Cn{static get type(){return"banner"}static get defaultTemplates(){return Ln}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...Ln,...t},...s})}},CollectionLayout:zn,ListLayout:Qn,HorizontalLayout:Wn,CardsLayout:class extends zn{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Hn}constructor({className:e=Hn,...t}={}){super({className:e,...t})}},CarouselLayout:gi,GalleryLayout:vi,SearchBoxLayout:Oi,OptionListLayout:Ci,FeedbackLayout:Li,TextLayout:ji,TypewriterLayout:Wi,AffiliationLayout:Zi,FacetsLayout:io,SelectLayout:ao,MoreButtonLayout:uo});function _o({qs:e,...t}={}){return K(t,{metadata:{question_source:e||Qt.ORGANIC}})}function po(e){return e&&e.value&&e.value.revision}function mo(e){const t=function(e){if(!e)return Bt.INITIAL;const{request:t,error:s,value:n}=e;return s?Bt.ERRONEOUS:n?Bt.READY:t?Bt.LOADING:Bt.INITIAL}(e);return b({status:t,ongoing:t===Bt.READY?e.ongoing:void 0,...e})}function fo(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:n}=s;n&&(t.meta.miso_id=n)}function go(e){const{request:t,value:s}=e;if(!t)return e;const{payload:n}=t||{},{q:i}=n||{};return i?{...e,value:{...s,keywords:i}}:e}function bo(e){const{role:t,type:s,items:n}=e,i={type:"viewable"===s?"viewable_impression":s,context:{custom_context:b({property:t})}};switch(function(e){return Ft.has(e)}(s)&&(!function(e,t=[]){return function(e){return qt.has(e)}(e)||t.length>0&&"object"==typeof t[0]&&t[0].product_id}(t,n)?(i.product_ids=[],i.context.custom_context.items=(n||[]).map((e=>e.text||e.id||e))):i.product_ids=(n||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case jt.SUBMIT:i.context.custom_context.value=e.value;break;case jt.FEEDBACK:i.context.custom_context.value=i.value=e.value,i.context.custom_context.result_type=i.result_type=e.result_type}return b(i)}function yo(e,t){return e=function(e={},{data:t}={}){if(!t)return e;const{request:s={},value:n={}}=t,{question_source:i}=s.payload&&s.payload.metadata||{},{question_id:o}=n;return Z(e,{context:{custom_context:{question_source:i,question_id:o}}})}(e,t),e=function(e,t){if(t.role!==Ut.ANSWER)return e;const{items:s=[]}=t;return Z(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}(e,t),e=function(e,{event_target:t}={}){if(!t)return e;return Z(e,{context:{custom_context:{event_target:t}}})}(e,t)}const wo=Object.freeze({}),vo=Object.freeze({[Ut.CONTAINER]:Nn.type,[Ut.ERROR]:Un.type}),Eo=Object.freeze({}),ko=Object.freeze({api:wo,layouts:vo,trackers:Eo}),So=Object.freeze({mappings:{[Ut.ERROR]:e=>e.error}});class Oo extends ce{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:n,defaults:i,options:o,extraOptions:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=n=n||t._client,e=Object.freeze({...e,plugin:s,client:n}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(n),this._defaults=i,this._options=o||new hs(t&&t._options,i),this._extraOptions=r||{},this._hub=new ks({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,n._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({roles:e}){const t=this._hub,s=this._client,n=this._options,i=this._extensions,o=this._plugin.layouts;this._sessions=new Ss(t),this._data=new Is(t,{source:sn(s),options:n,...this._extraOptions.api}),this._views=new Zs(t,{extensions:i,layouts:o,roles:e,options:n,workflow:this}),this._interactions=new tn(t,{client:s,options:n})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("session",(e=>this._onSession(e))),this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(Es(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:n}){n||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[Es(e)]||{};t.session&&t.status===Bt.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onSession(e){this.updateData({session:e})}_onMainViewUpdate(e){const{status:t}=e,s=t===Bt.READY,n=t===Bt.ERRONEOUS;this._emitLifecycleEvent(n?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||n)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),n=s.lifecycleEvents||(s.lifecycleEvents=new Set),i=n.has(e);return n.add(e),!i}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Jt(this._options.resolved.api,e);this.updateData({session:t,request:s}),this._hub.update("request",{...s,session:t})}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=po(e);if(!y(s)){const e=po(this._hub.states.data);if(!y(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){const t=this._hub.states.data;e=this._defaultProcessData(e,t);for(const s of this._options.resolved.dataProcessor)e=s(e,t);this._updateDataInHub(e,t)}_defaultProcessData(e,t){return e=function(e,t){if(!e||!e.value||e.request||!t||!t.request)return e;const{request:s}=t;return{...e,request:s}}(e,t),e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=mo(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:Bt.READY,session:this.session,...t},this._hub.update(Es(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction({...e,data:this._hub.states.data,workflow:this});this._sendInteraction(t)}_buildInteraction(e){let t=bo(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const n of s)t=n(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){const{data:s}=t;if(!s)return e;const n=s.request&&s.request.payload;if(!n)return e;const{question:i,q:o,fq:r}=n;return Z(e,{context:{custom_context:{question:i,q:o,fq:r}}})}(e=this._writeMisoIdToInteraction(e,t),t),e=function(e,t){const{data:s}=t;if(!s)return e;const n=s.request&&s.request.payload&&s.request.payload.metadata;return n?Z(e,{context:{custom_context:n}}):e}(e,t),e=function(e,t){if(t.role!==Ut.AFFILIATION)return e;const{items:s}=t;return Z(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e,t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return Z(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[Es(t.role)]||{},n=s.meta&&s.meta.miso_id||void 0;return n?Z(e,{miso_id:n}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._emit("destroy"),this._destroy(e)}get destroyed(){return!!this._destroyed}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy(),this._destroyed=!0}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function Io(e){if(e.affiliation_products){const{affiliation_products:t,...s}=e;e={...s,affiliation:xo(t)}}else if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Ao(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:n}=t;if(!n)return e;n=n.map((e=>({...e})));let i=0;for(const e of n)s&&(e.channel=s),e.position=i++;return{...e,affiliation:{...t,products:n}}}(e)}function xo(e){return{channel:"miso",products:e}}function Ao({products:e,...t}){return{channel:"sovrn",...t,products:e.map(Co)}}function Co({id:e,deeplink:t,headline:s,description:n,currency:i,retailPrice:o,salePrice:r,discountRate:a,image:c,thumbnail:l,merchant:u,...h}){return b({id:"sovrn-"+e,title:s,description:n,cover_image:c,url:t,currency:i,original_price:o,sale_price:r,discount_rate_percent:a,brand:u&&u.name,brand_logo:u&&u.logo,custom_attributes:To({sovrn_id:e,thumbnail:l,merchant:u,...h})})}function To(e,t=""){return Object.keys(e).reduce(((s,n)=>{const i=e[n];if(void 0===i)return s;const o=t?`${t}_${n}`:n;return"object"==typeof i?{...s,...To(i,o)}:{...s,[o]:i}}),{})}function Ro(e){V(e,No.prototype)}ms(Oo.prototype),Object.assign(Oo,{DEFAULT_API_OPTIONS:wo,DEFAULT_LAYOUTS:vo,DEFAULT_TRACKERS:Eo,DEFAULT_OPTIONS:ko,ROLES_OPTIONS:So});class No{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,n={}]=this._linkFn;if(!1===n.open)window.location.href=t;else{window.open(t,n.target||"_blank",n.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const $o=Object.freeze({...Oo.DEFAULT_API_OPTIONS,group:_.ASK,payload:{...Oo.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Uo=Object.freeze({actor:!1,api:{group:_.ASK,name:p.AUTOCOMPLETE}}),Lo=Object.freeze({...Oo.DEFAULT_LAYOUTS,[Ut.QUERY]:[Oi.type,{placeholder:"Ask a question"}],[Ut.QUESTION]:[ji.type,{tag:"h2"}],[Ut.ANSWER]:Wi.type,[Ut.FEEDBACK]:Li.type,[Ut.IMAGES]:[vi.type,{incremental:!0,itemType:"image"}],[Ut.SOURCES]:[Qn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Ut.AFFILIATION]:[Zi.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),Po=Object.freeze({...Oo.DEFAULT_TRACKERS,[Ut.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:ns.click},[Ut.IMAGES]:ns,[Ut.SOURCES]:ns,[Ut.AFFILIATION]:ns,[Ut.PRODUCTS]:ns}),qo=Object.freeze({...Oo.DEFAULT_OPTIONS,api:$o,autocomplete:Uo,layouts:Lo,trackers:Po}),jo=Vt(Oo.ROLES_OPTIONS,{main:Ut.ANSWER,members:Object.keys(Lo),mappings:{[Ut.ANSWER]:function(e){if(!e||!e.value)return;const{answer:t="",answer_stage:s,finished:n}=e.value;return Object.freeze({value:t,stage:s,finished:!!n})},[Ut.REASONING]:function(e){if(!e||!e.value)return;const{reasoning:t="",reasoning_finished:s}=e.value;return Object.freeze({value:t,stage:"reasoning",finished:!!s})}}});class Do extends Oo{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new en(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(Ut.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(Ut.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[Es(this._roles.main)]||{};e.session&&e.status!==Bt.INITIAL&&(e.status!==Bt.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,n=t===Bt.READY&&!e.ongoing,i=t===Bt.ERRONEOUS,o=n?"done":i?"error":t,r=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(o,e),(n||i)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){ys.call(this,e)}query(e){if(!e.q&&!e.questionId)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||Qt.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==gs?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),ws.call(this,e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e,t){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:Io(t)}}(e=super._defaultProcessData(e,t)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_defaultProcessInteraction(e,t){return e=yo(e=super._defaultProcessInteraction(e,t),t)}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[Es(e.role)]||{},{payload:s}=t||{};return s&&s.metadata&&s.metadata.question_source||void 0}_onCitationClick({index:e,event:t}){if(0!==t.button)return;if(Hs(t))return;const{value:s}=this._hub.states.data||{},{sources:n}=s||{},i=n&&n[e-1];i&&i.product_id&&(Vs(t),this._views.trackers.sources.click([i.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){0===e.button&&(Hs(e)||(Vs(e),this._views.trackers.answer.click([],{items:[t]})))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Ro(Do.prototype),Object.assign(Do,{DEFAULT_API_OPTIONS:$o,DEFAULT_AUTOCOMPLETE_OPTIONS:Uo,DEFAULT_LAYOUTS:Lo,DEFAULT_TRACKERS:Po,DEFAULT_OPTIONS:qo,ROLES_OPTIONS:jo});var Mo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var Fo=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class zo{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Bo{constructor(e){this._context=e,v(this,{lowerCamelToKebab:S,kebabToLowerCamel:E,kebabOrSnakeToLowerCamel:k})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...n}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=k(e))||"querySuggestions"===e?"followUpQuestions":e}phrase(e,{name:t,extraNames:s=[],tag:n="div",inline:i=!1}){const{classPrefix:o}=e;return`<${n} class="${i?o+"__phrase-inline":o+"__phrase"} ${[t,...s].map((e=>`${o}__${e}-phrase`)).join(" ")}">${this.phraseText(e,E(t))}</${n}>`}phraseText(e,t){const{phrases:s={}}=e,n=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof n){case"function":return n(e);case"string":return n;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s,workflow:n},{name:i,extraNames:o=[],visibleWhen:r,trait:a,logo:c=!1},l){const u=[i,...o].map((t=>`${e}__${t}-container`));return t&&u.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:u,visibleWhen:r,trait:a,logo:c,parentQuestionId:s,workflow:n},l)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const n=t[e];void 0!==n&&(s+=` ${S(e)}="${n}"`)}return s}}const Qo=Y(new Bo({...Mo,DEFAULT_PHRASES:Fo})),Go=Y(new class extends zo{constructor(){super({helpers:Qo})}answerGroup(e){const{container:t}=this._helpers;return[this.question(e),this.reasoning(e),this.answer(e),this.affiliation(e),this.sources(e),this.followUpQuestions(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"question",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",s(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(e={}){const{phrases:t,reasoning:s={}}=e,{container:n,element:i,phraseText:o}=this._helpers,r=[];return s.expand&&r.push("expanded"),n(e,{name:"reasoning",visibleWhen:"nonempty"},[i("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[i("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||_i}</div>`,`<div class="miso-collapsible__title" data-role="title">${o(t,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${hi}</div>`]),i("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(e){const{container:t,phrase:s}=this._helpers,n="follow-up-questions",i=["query-suggestions"];return t(e,{name:n,extraNames:i,visibleWhen:"nonempty"},[s(e,{name:n,extraNames:i,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(e){const{features:t={}}=e;return!1===t.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(e){const{container:t,phrase:s,section:n}=this._helpers,{features:i={},logo:o=!0}=e;return n(e,{name:"related-resources"},!1===i.relatedResources?"":t({...e,workflow:"active"},{name:"related-resources",visibleWhen:"nonempty",logo:o},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:Qo}));function Wo(e={}){const{normalizeOptions:t,section:s,container:n}=Qo,{answerGroup:i}=Go;return s(e=t(e),{name:"follow-up"},[n(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...i(e)])}var Ho=Object.freeze({__proto__:null,helpers:Qo,sections:Go,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=Qo,{followUps:i,relatedResourcesSection:o,answerGroup:r}=Go;return""+s(e=t(e),{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},r(e))+i(e)+o(e)},followUp:Wo});const Vo=Object.freeze({...Do.DEFAULT_API_OPTIONS,name:p.QUESTIONS,payload:{...Do.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Yo=Object.freeze({...Do.DEFAULT_LAYOUTS,[Ut.QUERY]:[Oi.type,{templates:{buttonIcon:"send"}}],[Ut.REASONING]:Wi.type,[Ut.RELATED_RESOURCES]:[Qn.type,{incremental:!0,itemType:"article"}],[Ut.QUERY_SUGGESTIONS]:Ci.type,[Ut.FOLLOW_UP_QUESTIONS]:Ci.type}),Ko=Object.freeze({...Do.DEFAULT_TRACKERS,[Ut.RELATED_RESOURCES]:ns,[Ut.QUERY_SUGGESTIONS]:{...ns,click:{...ns.click,validate:e=>0===e.button}}}),Zo=Object.freeze({followUp:Wo}),Jo=Object.freeze({...Do.DEFAULT_OPTIONS,api:Vo,layouts:Yo,trackers:Ko,templates:Zo}),Xo=Vt(Do.ROLES_OPTIONS,{members:Object.keys(Yo),mappings:{[Ut.QUERY_SUGGESTIONS]:function(e,{workflow:t}={}){const s=t.previous,n=s&&s.states.data.value,i=n&&(n.suggested_followup_questions||n.followup_questions||[]);return i&&i.map((e=>({text:e})))},[Ut.FOLLOW_UP_QUESTIONS]:function(e){if(e&&e.value)return(e.value.followup_questions||[]).map((e=>({text:e})))}}});class er extends Do{constructor(e,t){super({name:"ask",context:e,roles:Xo,defaults:Jo,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;v(this,{parentQuestionId:t})}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on(Es(Ut.REASONING),(e=>this._onReasoningViewUpdate(e))),this._views.get(Ut.ANSWER).on("follow-up-click",(e=>this._onFollowUpClick(e))),this._views.get(Ut.FOLLOW_UP_QUESTIONS).on("select",(e=>this._onFollowUpQuestionSelect(e))),this._views.get(Ut.QUERY_SUGGESTIONS).on("select",(e=>this._onQuerySuggestionSelect(e)))]}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){const{next:e}=this;e&&e.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,questionId:s,...n}={}){if(s)return b({...n,question_id:s});const{parentQuestionId:i}=this;let o=b({...n,question:e,parent_question_id:i});return o=_o({...o,qs:t}),o=this._writeWikiLinkTemplateToPayload(o),o}_updateData(e){super._updateData(e),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:e}=this;if(!e)return;const t=e._views.get(Ut.QUERY_SUGGESTIONS);t&&t.refresh()}_onReasoningViewUpdate({status:e,ongoing:t}){if(e!==Bt.READY||t)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAdditionalAskPropertiesToInteraction(e,t)}_writeAdditionalAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let n,i,o,{property:r}=e.context&&e.context.custom_context||{};return t.role!==Ut.FOLLOW_UP_QUESTIONS&&t.role!==Ut.QUERY_SUGGESTIONS||(r="suggested_followup_questions"),t.role===Ut.QUERY_SUGGESTIONS?(i=this.previous&&this.previous.parentQuestionId,n=this.parentQuestionId,o=this.previous&&this.previous.session.meta.question_source):i=this.parentQuestionId,Z(e,{context:{custom_context:b({property:r,root_question_id:s,parent_question_id:i,question_id:n,question_source:o})}})}_onFollowUpClick({q:e,event:t}={}){0===t.button&&this._submitFollowUpQuestion({q:e,qs:Qt.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:e}){this._submitFollowUpQuestion({q:e,qs:Qt.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:e="",qs:t}={}){if(!(e=e.trim()))return;this.getOrCreateNext().query({q:e,qs:t})}_onQuerySuggestionSelect({value:e}){e&&this.query({q:e,qs:Qt.SUGGESTED_QUESTIONS})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const e=this._views.get(Ut.REASONING),t=e&&e.element;return t&&t.closest('[data-role="reasoning-box"]')}_destroy(e){const{next:t,parentQuestionId:s,questionId:n}=this;t&&t.destroy(e),s&&this._context._byPqid.delete(s),n&&this._context._byQid.delete(n),super._destroy(e)}}const tr={event:"done"};class sr extends vs{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new er(this),this._events.on("*",(e=>this._createNextIfNecessary(e))),this._events.on("loading",(e=>this._setActive(e.workflow))),this._events.on("destroy",(()=>this._requestEmitAfterDestroy())),this._events.on("after-destroy",(()=>this._syncActiveOnAfterDestroy())),this._autoNextFn=void 0,this._active=this._root}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}get active(){return this._active}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new er(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}autoNext(e){this._autoNextFn=function(e=tr){switch(!0===e&&(e=tr),"string"==typeof e&&(e={event:e}),typeof e){case"object":return t=>t&&e.event===t._event;case"function":return e;default:return()=>!1}}(e)}_createNextIfNecessary(e){if(!this._autoNextFn||!this._autoNextFn(e))return;const{workflow:t}=e;t&&t.getOrCreateNext()}_requestEmitAfterDestroy(){this._emitAfterDestroyRequested||(this._emitAfterDestroyRequested=!0,setTimeout((()=>{this._emitAfterDestroyRequested=!1,this._events.emit("after-destroy",{})}),0))}_syncActiveOnAfterDestroy(){if(!this._active.destroyed)return;let e=this._root;for(;e.next&&e.next.status!==Bt.INITIAL;e=e.next);this._setActive(e)}_setActive(e){e!==this._active&&(this._active=e,this._events.emit("active",{workflow:e}))}}ms(sr.prototype,[Wt.TEMPLATES]);const nr=Object.freeze({...Oo.DEFAULT_API_OPTIONS,group:_.SEARCH,payload:{...Oo.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),ir=Object.freeze({...Oo.DEFAULT_LAYOUTS,[Ut.QUERY]:[Oi.type],[Ut.PRODUCTS]:[Qn.type,{incremental:!0,infiniteScroll:!0}],[Ut.KEYWORDS]:[ji.type,{raw:!0}],[Ut.TOTAL]:[ji.type,{raw:!0,format:"number"}],[Ut.FACETS]:[io.type],[Ut.SORT]:[ao.type],[Ut.MORE]:[uo.type]}),or=Object.freeze({...Oo.DEFAULT_TRACKERS,[Ut.PRODUCTS]:ns}),rr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),ar=Object.freeze({...Oo.DEFAULT_OPTIONS,api:nr,layouts:ir,trackers:or,pagination:rr}),cr=Vt(Oo.ROLES_OPTIONS,{main:Ut.PRODUCTS,members:Object.keys(ir),mappings:{[Ut.FACETS]:"facet_counts",[Ut.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:n=[]}={}}=s.filters||{};if(!n.length)return[];const{sort:i}=t.states.filters||{},o=i&&i.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(n).field;return o?n.map((e=>({...e,selected:e.field===o}))):n}}});class lr extends Oo{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(Ut.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){ys.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){if(this._linkFn)return void this._submitToPage(e);const t=Ht.QUERY;this._views.filters.reset({silent:!0}),this.restart({type:t});const s=this._buildPayload(e,t);this._request({payload:s,type:t})}_refine(){const e=Ht.REFINE,{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart({type:e});const s=this._getQuery(),n=this._buildPayload(s,e);this._request({payload:n,type:e})}_more(){if(this.status!==Bt.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=Ht.MORE,t=this._getQuery(),s=this._buildPayload(t,e);this._request({payload:s,type:e})}_getQuery(){return this._hub.states.query}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e,t){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),t===Ht.MORE&&(e=this._processPayloadForMoreRequest(e)),e}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:n}=t||{};return b({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(n)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const n=e[s];n&&n.length&&(t[s]={terms:n})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return g(e)}_writePageInfoToPayload(e){return{...e,metadata:{...e.metadata,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},n=s.map((e=>e.product_id)).filter((e=>e)),i=[...e.exclude||[],...n];return 0===i.length?e:{...e,exclude:i}}_defaultProcessData(e,t){return e=function(e,t){if(!t)return e;const{status:s,value:n}=e;switch(s){case Bt.INITIAL:case Bt.LOADING:break;default:return e}return n&&n.facet_counts?e:{...e,value:{...n,facet_counts:t}}}(e=go(e=super._defaultProcessData(e,t)),this._currentFacetCounts),e=function(e,{role:t=Ut.PRODUCTS}={}){const{status:s,request:n,value:i}=e;if(s!==Bt.READY||!n||!i)return e;const{[t]:o}=i;if(!o)return e;const{rows:r}=n.payload,{length:a}=o;return r>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateData(e){super._updateData(e),ws.call(this,e)}_updateDataInHub(e,t){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e,t)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{metadata:s}=t.payload;if(!s||!s.page)return function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,value:{...t,root_miso_id:s}}:e}(e);return function(e,t,{role:s=Ut.PRODUCTS}={}){if(!t.value)return e;const{[s]:n=[],facet_counts:i,total:o,root_miso_id:r}=e.value,{[s]:a=[]}=t.value;return{...t,value:{...t.value,facet_counts:i,total:o,root_miso_id:r,[s]:[...n,...a]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeRootMisoIdToInteraction(e)}_writeRootMisoIdToInteraction(e){const t=this._hub.states.data,{root_miso_id:s}=t&&t.value||{};return s?Z(e,{context:{custom_context:{root_miso_id:s}}}):e}}ms(lr.prototype,[Wt.PAGINATION,Wt.FILTERS]),Ro(lr.prototype),Object.assign(lr,{DEFAULT_API_OPTIONS:nr,DEFAULT_LAYOUTS:ir,DEFAULT_TRACKERS:or,DEFAULT_PAGINATION:rr,DEFAULT_OPTIONS:ar,ROLES_OPTIONS:cr});const ur=Do.ROLES_OPTIONS;class hr extends Do{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:ur,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_doLoading(e){const{session:t}=this;this.updateData({...e,session:t})}_queryWithQuestionId(e){const{session:t}=this,{request:s,value:n}=e;this.updateData({...e,session:t});const{question_id:i}=n;if(!i)return;const o={...s.payload,question_id:i};void 0!==o.metadata.page&&delete o.metadata.page,this._hub.update("request",{...s,payload:o,session:t})}_defaultProcessData(e,t){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:n}={}}=t;return n?{...e,meta:{...e.meta,miso_id:n}}:e}(e=go(e=super._defaultProcessData(e,t))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_handleHeadResponse(e){super._handleHeadResponse(e),fo(e)}_onTracker(e){this._superworkflow._onTracker(e)}}const dr=lr.ROLES_OPTIONS.members;class _r{constructor(e){this._subviews=e,this._containers=new Set}get filters(){return this._subviews.results.filters}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._getAllSubviews())t.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getAllSubviews(){return Object.values(this._subviews)}_getSubviews(e){return this._subviews[function(e){return dr.includes(e)?"results":"answer"}(e)]}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,n=this._getSubviews(s);if(!n._containers.has(e)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(e)){for(const n of e.components)if(s.containsElement(n))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${n.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}n.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const pr=Object.freeze({members:[]});function mr({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function fr(e){return e&&e.value&&e.value.trim()||void 0}class gr extends Oo{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:mr(t),roles:pr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,fr(e)===fr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!fr(e))return void this._updateCompletions({session:s,status:Bt.INITIAL});const n=this._buildPayload(e);this._request({payload:n})}_buildPayload(e){return{q:fr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function br(e){V(e,yr.prototype)}class yr{_initAutocomplete(e){this._autocomplete=new gr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const wr=Object.freeze({group:_.ASK,name:p.SEARCH,payload:{...Do.DEFAULT_API_OPTIONS.payload,...lr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),vr=Object.freeze({...Do.DEFAULT_LAYOUTS,...lr.DEFAULT_LAYOUTS,[Ut.QUERY]:[Oi.type,{placeholder:""}],[Ut.QUESTION]:[ji.type,{raw:!0}],[Ut.SOURCES]:[Wn.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:rn,articleInfoBlock:un}}]}),Er=Object.freeze({...Do.DEFAULT_TRACKERS,...lr.DEFAULT_TRACKERS}),kr=Object.freeze({...lr.DEFAULT_PAGINATION,active:!0}),Sr=Object.freeze({api:{group:_.ASK,name:p.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Or=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Ir=Object.freeze({...Do.DEFAULT_OPTIONS,...lr.DEFAULT_OPTIONS,api:wr,layouts:vr,trackers:Er,autocomplete:Sr,pagination:kr,filters:Or}),xr=Object.freeze({main:Ut.PRODUCTS,members:Object.keys(vr),mappings:Object.freeze({...Do.ROLES_OPTIONS.mappings,...lr.ROLES_OPTIONS.mappings})}),Ar=Object.freeze({api:Object.freeze({polling:!1})});class Cr extends lr{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:xr,defaults:Ir,extraOptions:Ar})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._answer=new hr(this)}_initActors(e){super._initActors(e),this._views=new _r({results:this._views,answer:this._answer._views})}restart({type:e}={}){super.restart(),e&&e!==Ht.QUERY||this._answer.restart()}get answer(){return this._answer}get questionId(){return this._answer.questionId}_buildPayload(e,t){return e=function(e,t){return t===Ht.QUERY?e:{...e,answer:!1}}(e=super._buildPayload(e,t),t),e=_o(e),!1!==(e=this._writeQuestionIdToPayload(e,t)).answer&&(e=Do.prototype._writeWikiLinkTemplateToPayload.call(this,e)),e}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e,t){if(t===Ht.QUERY)return e;const s=this._answer.questionId;return s?K(e,{metadata:{question_id:s}}):e}_defaultProcessData(e,t){return fo(e=super._defaultProcessData(e,t)),e}_updateDataInHub(e,t){this._dispatchDataToAnswerWorkflow(e),e=function(e,t){const{question_id:s}=t&&t.value||{};return s?{...e,value:{...e.value,question_id:s}}:e}(e,t),super._updateDataInHub(e,t)}_dispatchDataToAnswerWorkflow(e){const{request:t}=e;if(!t)return;const{type:s,payload:n}=t;if(s===Ht.QUERY&&n&&!1!==n.answer)switch(e.status){case Bt.LOADING:this._answer._doLoading(e);break;case Bt.READY:this._answer._queryWithQuestionId(e)}}_defaultProcessInteraction(e,t){return e=yo(e=super._defaultProcessInteraction(e,t),t)}_destroy(){this._answer.destroy(),super._destroy()}}ms(Cr.prototype,[Wt.PAGINATION,Wt.FILTERS]),br(Cr.prototype);const Tr=Object.freeze({group:_.SEARCH,name:p.SEARCH,payload:{fl:["*"]}}),Rr=Object.freeze({api:{group:_.SEARCH,name:p.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Nr=Object.freeze({...lr.DEFAULT_LAYOUTS}),$r=Object.freeze({...lr.DEFAULT_TRACKERS}),Ur=Object.freeze({...lr.DEFAULT_OPTIONS,api:Tr,autocomplete:Rr,layouts:Nr,trackers:$r}),Lr=lr.ROLES_OPTIONS;class Pr extends lr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:Lr,defaults:Ur})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=Ut.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}br(Pr.prototype);class qr extends vs{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=$t){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=$t){return this._members.has(e)}get(e=$t){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class jr extends Oo{_initProperties(e){super._initProperties(e);const{id:t}=e;v(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return Z(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign(jr,{DEFAULT_API_OPTIONS:Oo.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Oo.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Oo.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Oo.DEFAULT_OPTIONS,ROLES_OPTIONS:Oo.ROLES_OPTIONS});const Dr=Object.freeze({...jr.DEFAULT_API_OPTIONS,group:_.RECOMMENDATION,name:p.USER_TO_PRODUCTS,payload:{...jr.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),Mr=Object.freeze({...jr.DEFAULT_LAYOUTS,[Ut.PRODUCTS]:Qn.type}),Fr=Object.freeze({...jr.DEFAULT_TRACKERS,[Ut.PRODUCTS]:ns}),zr=Object.freeze({...jr.DEFAULT_OPTIONS,api:Dr,layouts:Mr,trackers:Fr}),Br=Vt(jr.ROLES_OPTIONS,{main:Ut.PRODUCTS,members:Object.keys(Mr)});class Qr extends jr{constructor(e,t){super({name:"recommendation",context:e,roles:Br,defaults:zr,id:t})}start(){return this._request(),this}notifyViewUpdate(e=Ut.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class Gr extends qr{constructor(e,t){super("recommendations",e,t)}_create(e){return new Qr(this,e)}}const Wr=Object.freeze({...jr.DEFAULT_API_OPTIONS,group:_.ASK,name:p.RELATED_QUESTIONS}),Hr=Object.freeze({...jr.DEFAULT_LAYOUTS,[Ut.RELATED_QUESTIONS]:[Qn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Ut.QUERY]:[Oi.type,{placeholder:"Ask a question"}]}),Vr=Object.freeze({...jr.DEFAULT_TRACKERS,[Ut.RELATED_QUESTIONS]:ns,[Ut.CONTAINER]:{...ns,itemless:!0},[Ut.QUERY]:{[jt.SUBMIT]:{active:!0}}}),Yr=Object.freeze({...jr.DEFAULT_OPTIONS,api:Wr,layouts:Hr,trackers:Vr}),Kr=Vt(jr.ROLES_OPTIONS,{main:Ut.RELATED_QUESTIONS,members:Object.keys(Hr)});class Zr extends jr{constructor(e,t){super({name:"explore",context:e,roles:Kr,defaults:Yr,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(Ut.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return No.prototype.useLink.call(this,e,t),t&&this.useLayouts({[Ut.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=Ut.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e,t){return e=super._defaultProcessData(e,t),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=No.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}Ro(Zr.prototype);class Jr extends qr{constructor(e,t){super("explores",e,t)}_create(e){return new Zr(this,e)}}class Xr extends ce{constructor({name:e,plugin:t,MisoClient:s,...n}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new j)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}const ea=Object.freeze(Mo),ta=Object.freeze(Fo),sa=Object.freeze(Ho);var na=Object.freeze({__proto__:null,constants:ea,phrases:ta,templates:sa,wireFollowUps:function(e,t,s){if(!e)throw Error("client is required");!function(e,{template:t=Wo,...s}={}){if("function"!=typeof t)throw Error("template must be a function or undefined");const n=Object.keys(s).length>0;if(t===Wo&&!n)return;e.ui.asks.useTemplates({followUp:n?e=>t({...s,...e}):t})}(e,s),function(e){if(!e||"miso-follow-ups"===e.tagName.toLowerCase())return;const t=document.createElement("miso-follow-ups");for(const{name:s,value:n}of e.attributes)t.setAttribute(s,n);e.parentNode.replaceChild(t,e)}(t)},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");if(t)for(const e of t.querySelectorAll("miso-ask"))e.setAttribute("workflow","active")}});const{currentScript:ia}=document,oa=Object.freeze({templates:sa,autostart:!0}),ra=["templates","phrases","features"];class aa{constructor(){this._defaults=oa,this._scriptSrc=function(){if(!ia||!ia.src)return{};const e=document.createElement("a");e.href=ia.src;const t={};for(const[s,n]of new URLSearchParams(e.search))"q"!==s&&(t[s]=ua(n));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=ua(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:n,...i}={}){return b({apiKey:e,apiHost:t,templates:ha(s),phrases:n,...i})}(ca(this._defaults,this._scriptSrc,e,this._pageUrl))}}function ca(...e){let t={};for(const s of e)s&&(t=la(t,s));return t}function la(e,t){if(!t)return e;Object.assign(e,t);for(const s of ra)s in t&&(e[s]={...e[s],...t[s]});return e}function ua(e){return""===e||"false"!==e&&e}function ha(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(ha):function(e,t){const s={};for(const[n,i]of Object.entries(e))s[n]=t(i);return s}(e,ha);default:throw Error("Unsupported template type: "+e)}}class da{constructor(e,{classPrefix:t=ea.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");v(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class _a extends Xr{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new aa,this._localOptions={}}config(e={}){e=ca(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;v(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new da(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:o}=e.ui.defaults.ask,{templates:r={},features:a={},api:c}=n,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(t,s.followUpsSection,{...n,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&o(t,s.relatedResourcesSection),l.autoQuery()}}class pa extends le{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}const ma="trait",fa=Object.freeze([ma]);class ga extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return fa}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const e of this._traits)this._destroyTrait(e);this._traits=[]}attributeChangedCallback(e){if(e===ma)this._syncTraits()}_syncTraits(){const e=(this.getAttribute(ma)||"").split(/\s+/).filter(Boolean),t=[];for(const s of this._traits)e.includes(s.constructor.traitName)?t.push(s):this._destroyTrait(s);if(e.length>0){const s=function(e){const t=e.ui&&e.ui.traits||{};return Object.values(t).reduce(((e,t)=>(e[t.traitName]=t,e)),{})}(ga.MisoClient);for(const n of e){if(this._traits.find((e=>e.constructor.traitName===n)))continue;const e=s[n];if(!e){console.warn("Unknown trait: "+n);continue}const i=new e(this);t.push(i)}}this._traits=t}_destroyTrait(e){try{e._destroy&&e._destroy()}catch(e){console.error(e)}}}let ba,ya,wa;async function va(e){const t=await async function(e){return e.MisoClient||window.MisoClient||ba||(ba=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return ya=ya||t.any(),wa=wa||await ya,wa.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),wa}const Ea="logo",ka="auto",Sa=Object.freeze([...ga.observedAttributes,Ea]);function Oa(e){if(!e)return ka;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class Ia extends ga{static get observedAttributes(){return Sa}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Oa(this.getAttribute(Ea))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case ka:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(Ea,t):this.removeAttribute(Ea)}async connectedCallback(){super.connectedCallback();const e=this._client=await va(Ia);document.body.contains(this)&&(this._setWorkflow(this._getWorkflow(e)),this._onConnected(e))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_onConnected(e){}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===Ea)this._handleLogoUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleLogoUpdate(e,t){Oa(e)!==Oa(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const xa="workflow",Aa="parent-question-id",Ca=Object.freeze([...Ia.observedAttributes,xa,Aa]);const Ta="unit-id",Ra=Object.freeze([...Ia.observedAttributes,Ta]);class Na extends Ia{static get observedAttributes(){return Ra}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute(Ta)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(Ta,e):this.removeAttribute(Ta)}attributeChangedCallback(e,t,s){if(e===Ta)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var $a=Object.freeze({__proto__:null,MisoAskElement:class extends Ia{static get tagName(){return"miso-ask"}static get observedAttributes(){return Ca}_getWorkflow(e){return this.boundToActiveWorkflow?e.ui.asks.active:this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Aa)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(Aa,e):this.removeAttribute(Aa))}get boundToActiveWorkflow(){return"active"===this.getAttribute(xa)}_setWorkflow(e){this._workflow!==e&&(super._setWorkflow(e),e&&(this.parentQuestionId=e.parentQuestionId))}async connectedCallback(){if(await super.connectedCallback(),document.body.contains(this)){this._unsubscribes=[...this._unsubscribes||[],this._client.ui.asks.on("active",(e=>{this.boundToActiveWorkflow&&(this.workflow=e.workflow)}))]}}disconnectedCallback(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],super.disconnectedCallback()}attributeChangedCallback(e,t,s){switch(e){case Aa:this._handleParentQuestionIdUpdate(t,s);break;case xa:this._handleQuestionUpdate(t,s);break;default:super.attributeChangedCallback(e,t,s)}}_handleQuestionUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&t===ATTR_VALUE_ACTIVE&&this._setWorkflow(this._getWorkflow(this._client))}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Na{static get tagName(){return"miso-explore"}static get observedAttributes(){return Na.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends Ia{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Ia.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends Ia{static get tagName(){return"miso-search"}static get observedAttributes(){return Ia.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Na{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Na.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const Ua="role",La=Object.freeze([Ua]);class Pa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return La}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(Ua);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${Ua}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${Ua}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===Ua&&this._container&&this._container._updateComponentRole(this,t,s)}}var qa=Object.freeze({__proto__:null,MisoComponentElement:Pa,MisoQueryElement:class extends Pa{constructor(){super({role:Ut.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends Pa{constructor(){super({role:Ut.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends Pa{constructor(){super({role:Ut.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends Pa{constructor(){super({role:Ut.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends Pa{constructor(){super({role:Ut.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends Pa{constructor(){super({role:Ut.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends Pa{constructor(){super({role:Ut.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends Pa{constructor(){super({role:Ut.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends Pa{constructor(){super({role:Ut.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends Pa{constructor(){super({role:Ut.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends Pa{constructor(){super({role:Ut.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends Pa{constructor(){super({role:Ut.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends Pa{constructor(){super({role:Ut.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends Pa{constructor(){super({role:Ut.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends Pa{constructor(){super({role:Ut.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends Pa{constructor(){super({role:Ut.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends Pa{constructor(){super({role:Ut.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends Pa{constructor(){super({role:Ut.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends Pa{constructor(){super({role:Ut.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends Pa{constructor(){super({role:Ut.ERROR})}static get tagName(){return"miso-error"}}});class ja extends ga{static get observedAttributes(){return ga.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(e){this._setContext(e)}async connectedCallback(){super.connectedCallback();const e=this._client=await va(ja);document.body.contains(this)&&this._setContext(this._getContext(e))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(e){throw Error("Unimplemented")}_setContext(e){if(this._context===e)return;const t=this._context;this._context=e,this._onContext(e,t)}_onContext(){}}var Da=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends ja{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return ja.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(e){return e.ui.asks}_onContext(e,t){e!==t&&(this._unwire(),this._wire(e))}_unwire(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}_wire(e){e&&(e._autoNextFn||e.autoNext(),this._unsubscribes.push(e.on("create",(e=>{const{parentQuestionId:t}=e,s=e._options.resolved.templates.followUp;if(!t||!s)return;const n=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:t}));const i=this.children.length;for(const t of Array.prototype.slice.call(this.children,n,i))this._elementToWorkflow.set(t,e)}))),this._unsubscribes.push(e.on("loading",(({workflow:e})=>{for(const t of this.children)if(this._elementToWorkflow.get(t)===e){t.scrollIntoView({behavior:"smooth",block:"start"});break}}))),this._unsubscribes.push(e.on("destroy",(({workflow:e})=>{for(const t of this.children)this._elementToWorkflow.get(t)===e&&(this._elementToWorkflow.delete(t),t.remove())}))))}}});class Ma extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Ma.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var Fa=Object.freeze({__proto__:null,containers:$a,roles:qa,contexts:Da,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Ma{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Tn,MisoStubElement:ga});const za="miso-hybrid-search-combo";var Ba=Object.freeze({__proto__:null,CLASS_PREFIX:za,CONAINER_TAG:"miso-hybrid-search"});const Qa="Show more",Ga="Show less";var Wa=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:Qa,showLess:Ga});const Ha=Y(new Bo({...Ba,DEFAULT_PHRASES:Wa})),Va=Y(new class extends zo{constructor(){super({helpers:Ha})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:Ha}));var Ya=Object.freeze({__proto__:null,helpers:Ha,sections:Va,root:function(e={}){const{normalizeOptions:t,section:s,container:n}=Ha;e=t(e);const{answerBox:i,answerGroup:o,searchResultsGroup:r}=Va,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[n(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[i(e)]:o(e))+s(e,{name:"search-results"},r(e))}});const Ka="answer-box-open",Za="answer-box-shown",Ja='[data-role="answer-box-toggle"]';class Xa{constructor(e,t,{classPrefix:s=za,phrases:n={},hideWhenUnanswerable:i=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=n,this._hideWhenUnanswerable=i,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(Ja)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case Bt.ERRONEOUS:case Bt.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||Ga:this._phrases.showMore||Qa;for(const t of this._element.querySelectorAll(Ja))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const ec={isOpen:Ka,shown:Za},tc={toggleOpen:["toggle",Ka],open:["add",Ka],close:["remove",Ka],toggleHidden:["toggle",Za],show:["add",Za],hide:["remove",Za]};for(const[e,t]of Object.entries(ec))Object.defineProperty(Xa.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(tc))Xa.prototype[e]=function(){this._updateBoxStatus(t,s),s===Ka&&(this._syncButtonText(),this._syncScroll())};const sc=Object.freeze(Ba),nc=Object.freeze(Wa),ic=Object.freeze(Ya);var oc=Object.freeze({__proto__:null,constants:sc,phrases:nc,templates:ic,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new Xa(e,t,s)}});const rc=Object.freeze(na),ac=Object.freeze(oc);var cc=Object.freeze({__proto__:null,ask:rc,hybridSearch:ac});function lc(e){const t=e._element;if(!t)return()=>{};const s=t=>e._handleClick(t);return t.addEventListener("click",s),()=>t.removeEventListener("click",s)}const uc="miso-collapsible",hc="expanded",dc=[{action:"expand",classAction:"add",className:hc},{action:"collapse",classAction:"remove",className:hc}];class _c{static get traitName(){return"collapsible"}constructor(e){this._element=e,e.collapsible=this,e.classList.add(uc),this._unsubscribes=[lc(this)]}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(uc),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(e,t){for(const s of t)Object.defineProperty(e,s,{get(){return this._element&&this._element.classList.contains(s)}})}(_c.prototype,[hc]),function(e,t){for(const{action:s,classAction:n,className:i}of t)e[s]=function(){this._element&&this._element.classList[n](i),this["_"+s]&&this["_"+s]()}}(_c.prototype,dc),function(e,t){e._handleClick=function(e){const{target:s,button:n}=e;if(0===n)for(let{role:n,selector:i,action:o}of t)if(i=i||`[data-role="${n}"]`,i&&s.closest(i))return this[o](),void e.stopPropagation()}}(_c.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var pc=Object.freeze({__proto__:null,CollapsibleTrait:_c});const mc="ui";let fc,gc;async function bc(){return gc||(gc=z(fc||(fc=B(mc))))}class yc{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class wc{constructor(e,t){this._plugin=e,this._client=t,v(this,{sources:{api:sn(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new Pr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Cr(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class vc{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new _a(this._plugin,this._MisoClient))}}ct.plugins.use(class extends ce{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new pa(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new j}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:cc,traits:pc};w(s,this,["layouts","combo","ready"]),v(this,{MisoClient:e}),v(e,{ui:s}),this.combo=new vc(this,e);const n=Object.values(ho).filter((e=>e.type));for(const t of n)t.MisoClient=e;for(const e of n)this.layouts.register(e);const{containers:i,roles:o,combos:r,contexts:a,...c}=Fa,l=[...Object.values(r),...Object.values(a),...Object.values(i),...Object.values(o),...Object.values(c)],u=[Ia,ja,Ma];for(const t of[...u,...l])t.MisoClient=e;await bc();for(const e of l)C(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){v(e,{ui:new wc(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new yc(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new Gr(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new Jr(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new sr(this,e)),t}});const Ec=5e3;let kc,Sc,Oc=!1;async function Ic(e){return new Promise((t=>setTimeout((()=>{const e=$();Rc("Fallback",e),t(e)}),e)))}async function xc(){const e=await ve((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&Rc("GA4",e),e}async function Ac(){const e=(await(kc||(kc=async function(){return ve((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&Rc("UA",e),e}const Cc="%cMiso",Tc="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Rc(e,t){!function(...e){(a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(Cc,Tc,...e)}(...e)}(`[${e}] Client ID: ${t}${Oc?" (unused)":""}`),Oc=!0}async function Nc(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(ct,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||t.debug;n&&ct.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&ct.plugins.use("std:dry-run");return window.MisoClientSA=ct,ct}(e),s=await async function({site:e,config:t},{MisoClient:s}){const n={apiKey:t.api_key};t.api_host&&(n.apiHost=`https://${t.api_host}/v1`);const i=window.misoSA=new s(n);return i.context.site=e.key,i.context.anonymous_id=await async function(){return Sc||(Sc=Promise.any([xc(),Ac(),Ic(Ec)]))}(),i}(e,{MisoClient:t});return await s.ui.ready,[t,s]}function $c(e){return t=>({...t,context:{...t.context,custom_context:{...Uc(e),...t.context&&t.context.custom_context}}})}function Uc({site:e,page:t,config:s,version:n}){return b({source:"miso-client-script",script_version:n,attribution:"miso-smart-answers",site:e.key,user_geo:s.geo,page_type:t.type,post_id:t.postId,uuid:$()})}let Lc;async function Pc(){return Lc||(Lc=async function(){const[[e,t]]=await Promise.all([Nc(xe),pe(xe)]);return{MisoClient:e,client:t}}())}const qc='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',jc='<svg viewBox="0 0 15 14" fill="currentColor">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.92319V5.46173C0.000125254 5.46173 0.000250509 5.46173 0.000375766 5.46173C2.12455 5.46173 3.84653 7.18371 3.84653 9.30789C3.84653 9.3079 3.84653 9.30791 3.84653 9.30792H5.38499C5.38499 9.30791 5.38499 9.3079 5.38499 9.30789C5.38499 7.18384 7.10677 5.46194 9.23077 5.46173V3.92327C7.10678 3.92307 5.38501 2.20118 5.38499 0.0771484H3.8466C3.84655 2.20127 2.12459 3.92319 0.000450868 3.92319C0.000300577 3.92319 0.000150287 3.92319 0 3.92319Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M8 9.83844V11.005C9.61039 11.0056 10.9157 12.3112 10.9157 13.9217C10.9157 13.9222 10.9157 13.9226 10.9157 13.923H12.0822C12.0822 13.9226 12.0822 13.9222 12.0822 13.9217C12.0822 12.3109 13.388 11.005 14.9989 11.005C14.9993 11.005 14.9997 11.005 15.0002 11.005V9.83854C14.9997 9.83854 14.9993 9.83854 14.9989 9.83854C13.3884 9.83854 12.0827 8.53324 12.0822 6.92285H10.9156C10.915 8.53281 9.60996 9.83783 8 9.83844Z"/>\n</svg>',Dc={en:{youAsked:"You asked...",thisAnswerIsBasedOnTheFollowingArticles:"This answer is based on the following articles",learnMoreInDepth:"Learn more: in-depth",relatedQuestions:"Related questions",helpful:"Helpful",notHelpful:"Not helpful",smartAnswersDescription:"Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.",learnMore:"Learn more",exploreRelatedQuestions:"Explore related questions",askAQuestion:"Ask a question",ask:"Ask",generatedBySmartAnswersAI:"Generated by ${site} Smart Answers AI",learnMoreWithSmartAnswers:"Learn more with smart answers",youSearchedFor:"You searched for",lineEndOfYouSearchedFor:"",aboutResults:"About",lineEndOfAboutResults:"results",sortBy:"Sort By",relevance:"Relevance",date:"Date",showMore:"Show more",by:"By",whatAreYouSearchingFor:"What are you searching for?"},de:{youAsked:"Sie fragten...",thisAnswerIsBasedOnTheFollowingArticles:"Diese Antwort basiert auf den folgenden Artikeln",learnMoreInDepth:"Erfahren Sie mehr",relatedQuestions:"Verwandte Fragen",helpful:"Hilfreich",notHelpful:"Nicht hilfreich",smartAnswersDescription:"Smart Answers ist ein Chatbot-Tool, das Ihnen dabei hilft, Inhalte auf unseren Webseiten zu entdecken, Fragen zu beantworten und sich eingehend mit den Themen zu befassen, die fr Sie wichtig sind.",learnMore:"Mehr erfahren",exploreRelatedQuestions:"Verwandte Themen erkunden",askAQuestion:"Eine Frage stellen",ask:"FRAGEN",generatedBySmartAnswersAI:"Generiert von ${site} Smart Answers AI",learnMoreWithSmartAnswers:"Mehr erfahren mit Smart Answers",youSearchedFor:"Du hast nach",lineEndOfYouSearchedFor:"gesucht",aboutResults:"Etwa",lineEndOfAboutResults:"Ergebnisse",sortBy:"Sortieren nach",relevance:"Relevanz",date:"Datum",showMore:"Mehr anzeigen",by:"Von",whatAreYouSearchingFor:"Wonach suchen Sie?"}},Mc=e=>Dc[e.lang]||Dc.en;let Fc="en-US";const zc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',Bc='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>';function Qc(e){const{site:t}=e,s=Mc(t);return Fc=t.date_locale||"en-US",`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  ${Gc(e)}\n</section>\n${function(e){const t=Mc(e.site),s='\n<div class="miso-hybrid-search-combo__skeleton-source-item" style="flex-shrink:0;padding-bottom:3.2rem;">\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:23px;width:23px;"></div>\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:72px;width:100%;border-radius:6px;"></div>\n  <div style="display:flex;gap:0.8rem;align-items:center;">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:10%;border-radius:6px;"></div>\n    <div style="color:#B6AEAA;font-size:1.28rem;margin-bottom:10px;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:30%;border-radius:6px;"></div>\n  </div>\n</div>\n';return`\n<section class="miso-hybrid-search-combo__skeleton miso-hidden">\n  <div class="miso-hybrid-search-combo__question-phrase">\n    <div class="miso-hybrid-search-combo__question-phrase-main">\n      <i>${jc}</i>\n      <span>${Wc(e)}</span>\n    </div>\n    <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">${t.learnMore}</a>\n  </div>\n  <div class="miso-hybrid-search-combo__skeleton-answer-block">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:92%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:70%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:95%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:65%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:90%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:100%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:60%;"></div>\n  </div>\n  <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">${t.thisAnswerIsBasedOnTheFollowingArticles}</h3>\n  <div class="miso-hybrid-search-combo__skeleton-source-block" style="overflow-y:hidden;">\n    ${s}\n    ${s}\n    ${s}\n  </div>\n</section>\n`}(e)}\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n  <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <div class="miso-hybrid-search-combo__question-phrase">\n      <div class="miso-hybrid-search-combo__question-phrase-main">\n        <i>${jc}</i>\n        <span>${Wc(e)}</span>\n      </div>\n      <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">${s.learnMore}</a>\n    </div>\n    <miso-answer></miso-answer>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__sources-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">${s.thisAnswerIsBasedOnTheFollowingArticles}</h3>\n    <miso-sources></miso-sources>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__buttons-container miso-hidden" visible-when="!unanswerable">\n    <a class="miso-hybrid-search-combo__smart-answers-link" href="${t.base_url||""}/smart-answers" target="_blank" rel="noopener nofollow">\n      <i>${qc}</i>\n      <span>${s.learnMoreWithSmartAnswers}</span>\n    </a>\n    <miso-feedback></miso-feedback>\n  </ miso-hybrid-search>\n  \x3c!-- whitepaper --\x3e\n  \x3c!--\n  <miso-hybrid-search class="miso-hybrid-search-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <miso-affiliation></miso-affiliation>\n  </miso-hybrid-search>\n  --\x3e\n</section>\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__search-results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__search-results-container miso-circled-citation-index" visible-when="loading ready" logo="false">\n    <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__keywords-phrase">${s.youSearchedFor} <miso-keywords></miso-keywords>${s.lineEndOfYouSearchedFor?" "+s.lineEndOfYouSearchedFor:""}</div>\n    <div class="miso-hybrid-search-combo__search-results-info">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase">${s.aboutResults} <miso-total></miso-total> ${s.lineEndOfAboutResults}</div>\n      <div class="miso-hybrid-search-combo__sort-dropdown">\n        ${s.sortBy} <miso-sort>\n      </div>\n    </div>\n    <miso-products></miso-products>\n    <miso-more></miso-more>\n  </miso-hybrid-search>\n</section>\n${function(e){const{site:t}=e;let s;switch(t.key){case"computerworld":s="CW";break;case"networkworld":s="NWW";break;case"infoworld":s="IFW";break;default:s=t.name}if("de"===t.lang)return`\n      <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n        <div class="miso-disclaimer__tilte">ber ${s} Smart Answers AI</div>\n        <div class="miso-disclaimer__content">\n          <p>Smart Answers ist ein Chatbot-Tool, das Ihnen hilft, redaktionelle Inhalte zu entdecken, Fragen zu beantworten und tief in die Themen einzutauchen, die Ihnen wichtig sind.</p>\n          <p>Smart Answers wurde in Zusammenarbeit mit Miso.ai entwickelt und bezieht seine Informationen ausschlielich aus redaktionellen Inhalten unseres Medien-Netzwerkes mit den Publikationen  <a href="https://www.cio.de/" target="_blank" rel="noopener">CIO</a>, <a href="https://www.csoonline.com/de/" target="_blank" rel="noopener">CSO</a>, <a href="https://www.computerwoche.de/" target="_blank" rel="noopener">Computerwoche</a>, <a href="https://www.infoworld.com/" target="_blank" rel="noopener">InfoWorld</a> und <a href="https://www.networkworld.com/" target="_blank" rel="noopener">Network World</a>.</p>\n          <p>Das Tool wurde speziell auf Fragen trainiert, die ein fachkundiges Enterprise-IT-Publikum stellen wrde. Das Ergebnis ist ein schneller und effizienter Weg fr Sie, mehr Nutzen aus unseren Inhalten zu ziehen.</p>\n          <p>Beginnen Sie, indem Sie Ihre Anfrage in das Textfeld oben eingeben. Um tiefer einzusteigen, stellen Sie Folgefragen oder lesen Sie unsere Artikelempfehlungen.</p>\n          <p>Feedback? - Wir freuen uns ber Ihre E-Mail and an Amy Bennett, Chefredakteurin der B2B-Marken von Foundry: <a href="mailto:amy_bennett@foundryco.com">amy_bennett@foundryco.com</a></p>\n        </div>\n      </section>\n    `;return"cio"===t.key?'\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About</div>\n      <div class="miso-disclaimer__content">\n        <p>You deserve a better search experience -- and Smart Answers delivers.</p>\n        <p>Quickly find answers, discover the most relevant and timely content, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with <a href="https://miso.ai/" target="_blank" rel="noopener">Miso.ai</a>, Smart Answers draws only on editorial content from CIO.com and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  ':`\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About ${s} Smart Answers AI</div>\n      <div class="miso-disclaimer__content">\n        <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with Miso.ai, Smart Answers draws only on editorial content from our network of trusted media brands<a href="https://www.cio.com/" target="_blank" rel="noopener">CIO</a>,<a href="https://www.computerworld.com/" target="_blank" rel="noopener">Computerworld</a>, <a href="https://www.csoonline.com/" target="_blank" rel="noopener">CSO</a>, <a href="https://www.infoworld.com/" target="_blank" rel="noopener">InfoWorld</a>, and<a href="https://www.networkworld.com/" target="_blank" rel="noopener">Network World</a>and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  `}(e)}`.trim()}function Gc(e){const{site:t}=e,s=Mc(t);return`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${zc}</span>\n        <textarea rows="1" class="miso-search-box__input" type="text" placeholder="${s.whatAreYouSearchingFor}" autocomplete="off" data-role="input"></textarea>\n        <button class="miso-search-box__button" type="submit" data-role="submit">${Bc}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}function Wc(e){const{site:t}=e;return Mc(t).generatedBySmartAnswersAI.replaceAll("${site}",t.name)}const Hc=Object.freeze({ordered:!0,article:function(e,t,s,n){const{templates:i}=e,[o,r]=i.helpers.tagPair(e,s);return""+o+i.indexBlock(e,s,n)+Vc(e,s)+r},infoBlock:Vc});function Vc({className:e},{title:t,created_at:s,updated_at:n,published_at:i,custom_attributes:o={}}){const r=we(o.site),a=i||s||n;let c="";t&&(c+=`<div class="${e}__item-title">${t}</div>`);const l=[];return r&&l.push(`<div class="${e}__item-site">${r.name}</div>`),a&&l.push(`<div class="${e}__item-date">${Kc(a)}</div>`),l.length>0&&(c+=`<div class="${e}__item-supplementals">${l.join("&nbsp;&nbsp;&nbsp;&nbsp;")}</div>`),`<div class="${e}__item-info-container">${c}</div>`}const Yc=e=>Object.freeze({infoBlock:(t,s)=>function({className:e},{title:t,snippet:s,description:n,authors:i,created_at:o,updated_at:r,published_at:a,custom_attributes:c={}},{site:l}){const u=Mc(l),h=a||o||r;let d=`<div class="${e}__item-main-block">`;c.content_type&&(d+=`<div class="${e}__item-content-type">${c.content_type}</div>`);t&&(d+=`<div class="${e}__item-title">${t}</div>`);s?d+=`<div class="${e}__item-snippet">${s}</div>`:n&&(d+=`<div class="${e}__item-desc">${n}</div>`);d+=`</div><div class="${e}__item-supplementals-block">`,i&&(d+=`<div class="${e}__item-authors">${u.by} ${i}</div>`);h&&(d+=`<div class="${e}__item-date">${Kc(h)}</div>`);return d+="</div>",`<div class="${e}__item-info-container">${d}</div>`}(t,s,e)});function Kc(e){return e?new Date(e).toLocaleDateString(Fc,{year:"numeric",month:"short",day:"numeric"}):""}const Zc="textarea.miso-search-box__input";let Jc="What are you searching for?";function Xc(){const e=!this.value;e&&(this.value=Jc),this.style.height="auto",this.style.height=this.scrollHeight-24+"px",e&&(this.value="")}function el(e={}){const t=Mc(e.site);Jc=t.whatAreYouSearchingFor;const s=document.querySelector(Zc);s&&(s.addEventListener("keyup",Xc),Xc.call(s))}function tl(e){const{site:t}=e;return`${r(t)} AND custom_attributes.site:${t.product_id_key||t.key}`}function sl(e,{MisoClient:t,client:s,rootElement:n}){const{site:i,config:r}=e,a=Mc(i),c=s.ui.hybridSearch;c.autocomplete.enable(),c.useApi({_meta:b({site:i.key,user_geo:r.geo}),facets:["categories"],fq:tl(e),fl:o,source_fl:o}),c.useDataProcessor(function(e){const t=function({site:e}){return({url:t,...s})=>((t=new URL(t)).host=""+e.whitepaper_hostname,{url:cl(t=""+t),...s})}(e);return({value:e,...s})=>{if(!e)return s;const{answer:n,sources:i=[],affiliation_products:o,products:r=[]}=e;return{value:{...e,answer:ol(n,i),sources:i.map(rl),affiliation_products:(o||[]).map(t),products:r.map(al)},...s}}}(e)),c.useInteractions({preprocess:$c(e)}),c.useFilters({sort:{options:[{field:"relevance",text:a.relevance,default:!0},{field:"published_at",text:a.date}]}}),c.useLayouts({feedback:{templates:{text:(e,t)=>"helpful"===t?a.helpful:a.notHelpful}},sources:["list",{templates:Hc}],products:{templates:Yc(e),infiniteScroll:!1},more:{templates:{text:()=>a.showMore}}}),c.answer.on("request",(e=>{const t=new URL(window.location.href);t.searchParams.set("q",e.payload.q),window.history.replaceState({},"",t);const s=document.querySelector(".miso-hybrid-search-combo__smart-answers-link");s&&(s.href=`${i.base_url||""}/smart-answers?q=${encodeURIComponent(e.payload.q)}`);document.querySelectorAll(".miso-hidden").forEach((e=>{e.classList.remove("miso-hidden")}));const n=document.querySelector("#miso-search.miso-hybrid-search-combo");n&&n.classList.add("miso-hybrid-search-combo__container--fired"),function(){const e=ll();e&&e.classList.add("miso-hybrid-search-combo__skeleton--show");ul().forEach((e=>{e&&e.setAttribute("visible-when","done !unanswerable")}))}()})),c.answer.on("answer-stage",(e=>{"Generating summary"===e.answer_stage&&hl()})),c.answer.on("done",(()=>{hl()})),c.on("request",(()=>{const e=document.querySelector("miso-more");e&&(e.style.display="none")})),c.on("response",(({request:e={},value:t={}})=>{const{payload:s={}}=e,n=(s.rows||10)*(s.metadata?.page+1||1),{total:i=0}=t;if(n>=i)return;const o=document.querySelector("miso-more");o&&(o.style.display="flex")}));const l=document.createElement("div");l.id="miso-search",l.classList.add("miso-hybrid-search-combo"),n.insertAdjacentElement("afterend",l),n.remove(),(n=l).innerHTML=Qc(e);const{wireAnswerBox:u}=t.ui.defaults.hybridSearch;u(s,n,{hideWhenUnanswerable:!1}),c.autoQuery(),setTimeout((()=>el(e)),200)}function nl(e,t){if(!e)return e;if(!t)return cl(e);const{origin:s}=new URL(e),{pathname:n}=new URL(t);return cl(`${s}${n}`)}const il=/\[\[(\d+)\]\]\((https?:\/\/[^\s)]+)\)/g;function ol(e,t){return e?e.replace(il,((e,s,n)=>{const i=t.find((e=>e.url===n))||{custom_attributes:{}};return`[[${s}]](${nl(n,i.custom_attributes.contenthub_url)})`})):e}function rl({url:e,cover_image:t,custom_attributes:s,...n}){const{site:i,contenthub_url:o}=s;return{cover_image:t||we(i).logo_image,url:nl(e,o),custom_attributes:s,...n}}function al({authors:e,url:t,custom_attributes:s,...n}){const{byline:i,contenthub_url:o}=s;return{authors:i?i.split(","):e,url:nl(t,o),custom_attributes:s,...n}}function cl(e){return`${e}${0>e.indexOf("?")?"?":"&"}utm=hybrid_search`}function ll(){return document.querySelector(".miso-hybrid-search-combo__skeleton")}function ul(){return[document.querySelector(".miso-hybrid-search-combo__answer-container"),document.querySelector(".miso-hybrid-search-combo__sources-container")]}function hl(){const e=ll();e&&e.classList.remove("miso-hybrid-search-combo__skeleton--show");ul().forEach((e=>{e&&e.setAttribute("visible-when","ready !unanswerable")}))}const dl="header #miso-search",_l='.header__icon-button[data-menu-trigger="search"]',pl='.header__menu-link[data-menu-trigger="search"]';async function ml(e){const{site:t}=e,n=document.querySelector(dl);if(!n)return;const i=[document.querySelector(_l),document.querySelector(pl)];if(e.page.type===s)return void i.forEach((e=>{e&&e.addEventListener("click",(()=>{const e=document.querySelector('.button[data-menu-close="search"]');e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()}))}));const{client:o}=await Pc(),r=o.ui.hybridSearch;r.useLink((e=>{const{searchParams:s}=new URL(window.location.href);return s.set("q",e),`${t.base_url||""}/search/?${s}`}),{open:!1}),r.autocomplete.enable(),n.classList.add("miso-hybrid-search-input"),n.innerHTML=Gc(e),el(e)}const fl="#miso-search";async function gl(e){const t=function(){for(const e of document.querySelectorAll(fl))if(!e.closest("header"))return e}();if(!t)return;const{MisoClient:s,client:n}=await Pc();sl(e,{MisoClient:s,client:n,rootElement:t})}(async e=>{e.page.type===s&&function(e){const{version:t,debug:s}=e;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=t,s("Miso Smart Answers script version: "+t),!0)}(e)&&await Promise.all([gl(e),ml(e)])})(xe)}();
