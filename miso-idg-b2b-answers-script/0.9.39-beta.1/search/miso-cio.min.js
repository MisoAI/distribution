!function(){"use strict";const e="home",t="answers",s="search",i="article",n="other",r=["cover_image","custom_attributes.site","custom_attributes.content_type","custom_attributes.contenthub_url","custom_attributes.byline","authors","created_at","product_id","published_at","snippet","title","updated_at","url"],o='type:article AND ((NOT custom_attributes.languages:*) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)';var a="0.9.39-beta.1";var c=Object.freeze({...function(){const e=document.currentScript;if(!e||!e.src)return{};const t=document.createElement("a");t.href=e.src;const s={};for(const[e,i]of new URLSearchParams(t.search))"q"!==e&&(s[e]=""===i||i);return s}(),...function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_answers_")&&t.length>13&&"miso_answers_api_key"!==t?e[t.substring(13)]=""===s||s:t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=""===s||s:"q"!==t&&"qs"!==t||(e[t]=s);return e}()});const u={key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},l=window.location.hostname!==u.hostname;var h={...u,dev:l};function d(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>s.abort(t.reason)))}return s.signal}const _=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),p=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var m=Object.freeze({__proto__:null,GROUP:_,NAME:p});function f(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function g(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function y(e){return null!=e?""+e:e}function b(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function w(e){return null==e}function v(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce(((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e)),{}))}function E(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function k(e){return e.replace(/-([a-z])/g,(e=>e[1].toUpperCase()))}function S(e){return e.replace(/[-_][a-z]/g,(e=>e[1].toUpperCase()))}function I(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class O{constructor(e,{duration:t=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);C(s),C(i),C(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==i?i:t})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout((()=>x(this,e)),t):x(this,e),this._value=e}disconnect(){this._active=!1}}function x(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function C(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function T(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function A(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function R(e){return new Promise(((t,s)=>{window.requestAnimationFrame((async i=>{try{await e(i),t()}catch(e){s(e)}}))}))}async function N(e,{area:t=.5,duration:s=1e3,signal:i}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise(((n,r)=>{const o=new O((e=>{e&&(o.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((e=>{o.value=e[0].isIntersecting}),{threshold:t});a.observe(e),i&&i.addEventListener&&i.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function $(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function P(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function L(e,t){const s=U((()=>window.localStorage.getItem(e))),i=U((()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,i=t.indexOf(s);if(0>i)return;const n=i+s.length,r=t.indexOf(";",n);return decodeURIComponent(0>r?t.substring(n):t.substring(n,r))}(e))),n=s||i||""+t();return n&&!s&&U((()=>window.localStorage.setItem(e,n))),n&&!i&&U((()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,n))),n}function U(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function q(e){return new j(e)}class j{constructor(e){this._value=e;const t=e=>{this._value=e};E(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class D{constructor(){const e=this;e.promise=new Promise(((t,s)=>{e.resolve=t,e.reject=s})),Object.freeze(this)}}class M{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new D),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}var z="1.11.5-beta.10";let F;try{F=document.currentScript}catch(e){}async function B(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise(((t,s)=>{let i;e.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{e.sheet&&(i&&clearInterval(i),t())}),100)}))}(e),await async function(e){if(G(e))return;return new Promise((t=>{let s;s=setInterval((()=>{G(e)&&(s&&clearInterval(s),t())}),100)}))}(e)}(t)}catch(e){console.error(e)}}function Q(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${z}/dist/css/${e}.css`}function G(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function H(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout((()=>{t=void 0,s()}),e)}}function W(e,{depth:t=5,...s}={}){return V(e,t)}function V(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,(e=>V(e,t-1))):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t,s){const i={};if(0>=t)return i;for(const s in e){const n=e[s];"function"!=typeof n&&(s.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(i[s]=V(n,t-1)))}return i}(e,t):e:"(...)"}function K(e,t){const s=Object.getOwnPropertyDescriptors(t),i=Object.getOwnPropertyDescriptors(e);for(const[t,n]of Object.entries(s))"constructor"!==t&&void 0===i[t]&&Object.defineProperty(e,t,n)}function Y(e){const t={},s=new Set;for(let i=e;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=n[i];r&&(t[i]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}const Z=100,J=4;function X(e){const t=function({speed:e=Z,acceleration:t=J}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,i)=>{let n=e*(Math.random()+.5);return t>0&&void 0!==i&&s>i&&(n*=1+(s-i)*t/1e3),n}}(e);return(e,s,i,n)=>{const r=t(i,s);return e+Math.max(n-i,0)*r/1e3}}const ee=Symbol.for("miso:resources");class te{constructor(){this._resources=new Map;const e=window[ee]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){se(this._resources,e).resolve(t)}async get(e){return se(this._resources,e).promise}}function se(e,t){if(e.has(t))return e.get(t);const s=new D;return e.set(t,s),s}function ie(){return window[ee]||(window[ee]=new te)}class ne{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new D;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class re{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},i=this._namedCallbacks[e];if(i)for(const e of i)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise(((s,i)=>{const n=t._on(e,(e=>{setTimeout((()=>n()));try{s(e)}catch(e){i(e)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:i})=>{try{e(s,i)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)f(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&f(s,t)}}_injectSubscribeInterface(e){v(e,this,["on","once"])}}function oe(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class ae{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:oe(e,t),uuid:P()})}(e,t);E(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new re({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(ae,"miso:component");class ce extends ae{constructor(e,t,{libName:s,keyName:i}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=e=>e[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new D);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class ue{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new O(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class le{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:he}=document,de=he.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function _e({}){await Promise.all([me()])}let pe=!1;async function me(){if(pe)return;if(pe=!0,!he)throw Error("currentScript not found");const e=he.src,t=e.indexOf("?"),s=(0>t?e:e.substring(0,t)).replace(/(\.min)?\.js$/,".css");await async function(e){if(document.querySelector(`link[href="${e}"]`))return;return new Promise(((t,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=t,i.onerror=s,i.href=e,document.head.appendChild(i)}))}(s)}function fe(e){if(e)return e.indexOf("//")>=0||e.startsWith("/")?e:`${de}/${e}`}const ge=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"},{key:"computerwoche",name:"Computerwoche",hostname:"www.computerwoche.de",whitepaper_hostname:"us.resources.computerworld.com",regions:[],lang:"de"}].map((({logo_image:e,...t})=>({logo_image:fe(e),...t}))),ye=ge.reduce(((e,t)=>(e[t.key]=t,e)),{});function be(e){return ye[e]}async function we(e,{interval:t=300,timeout:s}={}){const i=e();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const t=e();null!=t&&(a(),i(t))}),t),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}var ve=Object.freeze(function(){const r=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(r){case"":return{type:e};case"/smart-answers":return{type:t};case"/search":return{type:s};default:if(h.regions.indexOf(r.substring(1))>=0)return{type:e}}const a=r.substring(1).split("/");if("article"===a[0]){const e=""+a[1];return{type:i,postId:e,product_id:`article_${h.key}_${e}`}}return{type:n}}());const Ee="%cMiso",ke="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const Se=[];var Ie=function(){if(c.sponsor)return Se.find((e=>e.key===c.sponsor))||void 0}(),Oe=Object.freeze({__proto__:null,config:c,version:a,site:h,page:ve,sponsor:Ie,debug:function(...e){(c.debug||a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(Ee,ke,...e)}(...e)}}),xe="1.11.5-beta.10";const Ce=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Te{constructor(e,t){this._client=e,this._root=t,this._bulk=new ne(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const c="GET"!==s&&null!=t?JSON.stringify(t):void 0,u=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(e,b({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var d=Error(h.message);throw d.data=h,d.status=l.status,d}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map((({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s})))},{data:i}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:n,status_code:r,body:o}=i[t];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e,t={}){const{apiKey:s,request:i={}}=this._client.options,n=t.sendApiKeyByHeader||i.sendApiKeyByHeader,r=e.filter((e=>e)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(e){const{dataEndpoint:t=Ce.DATA_ENDPOINT,eventEndpoint:s=Ce.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:t,apiName:s,url:i})||i}catch(t){(e._error||console.error)(t)}return i}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:t,apiName:s,payload:i})||i}catch(t){(e._error||console.error)(t)}return i}}class Ae extends ae{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:e,apiName:t,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s})}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}async _send({apiGroup:e,apiName:t,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(e,t,i):this.helpers.fetch(s,i,r)}_postprocess({response:e}){return e.data}}const{GROUP:Re,NAME:Ne}=m;class $e extends Ae{constructor(e){super(e,Re.INTERACTIONS)}async upload(e,t){try{return await this._run(Ne.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===Ne.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:i}=s;return this.helpers.sendBeacon(e,i,t),{}}return super._send({...s,options:t})}}class Pe{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:t,stallTimeout:s=12e4,...i}=this._options;const n=new le(s);let r;t=d(this._ac.signal,n.signal,t);return function(e,{interval:t=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new M;return o=setInterval((async()=>{let t,o,d;try{if([t,o,d]=await e(r?{signal:r}:{}),u||!w(a)&&a>=d)return;w(d)||(a=d),n&&n(t,o,d),c=0}catch(e){return i&&i(e),c++,void(c>s&&(l(),h.error(e)))}h.update(t,o),o&&l()}),t),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]}),{interval:e,signal:t,onResponse:(e,t)=>{t?n.clear():this._isUpdated(r,e)&&n.touch(),r=e},...i})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||e.answer.length!==t.answer.length}_revisionOf(e){return e&&e.revision}}class Le extends Pe{constructor(e,t,s,i){super(i),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}const{GROUP:Ue,NAME:qe}=m;class je extends Ae{constructor(e){super(e,Ue.ASK)}async questions(e,t={}){if(function(e){return"string"==typeof e&&"{"!==e.charAt(0)}(e))return new De(this,e,t);const s=await this._run(qe.QUESTIONS,e,t);return new De(this,s,t)}async _questions(e,t){return this._run(qe.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${qe.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(qe.RELATED_QUESTIONS,e,t)}async search(e,t={}){const s=await this._run(qe.SEARCH,e,t);return s.question_id?new Me(this,s,t):s}async _searchGet(e,t){return this._run(`${qe.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(qe.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(qe.SEARCH_AUTOCOMPLETE,e,t)}}class De extends Le{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class Me extends Le{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),E(this,t),this._response=t}get questionId(){return this._id}}const{GROUP:ze,NAME:Fe}=m;class Be extends Ae{constructor(e){super(e,ze.SEARCH)}async search(e,t){return this._run(Fe.SEARCH,e,t)}async autocomplete(e,t){return this._run(Fe.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(Fe.MGET,e,t)}}const{GROUP:Qe,NAME:Ge}=m;class He extends Ae{constructor(e){super(e,Qe.RECOMMENDATION)}async userToProducts(e,t){return this._run(Ge.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(Ge.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(Ge.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(Ge.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(Ge.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(Ge.PRODUCT_TO_PRODUCTS,e,t)}}class We extends ae{constructor(e,t){super("api",e),this._client=e,this.helpers=new Te(e,t),this.interactions=new $e(this),this.ask=new je(this),this.search=new Be(this),this.recommendation=new He(this)}}var Ve=Object.freeze({__proto__:null,Api:We,ApiBase:Ae,ApiHelpers:Te,Interactions:$e,Ask:je,Search:Be,Recommendation:He});class Ke extends ae{constructor(e){super("context",e),this._client=e}}var Ye={api:Ve,context:{Context:Ke}};class Ze{constructor(e){E(this,{install:e})}}class Je extends ce{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Xe(this,Ye),this.plugins=new et(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new D);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const i=new s;return E(i,{id:e}),this._tryConfig(i,t),i;case"function":return new Ze(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(e,t,s){const i=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),n=0>t?e.length:t,r=e.lastIndexOf("/",n)+1,o=e.indexOf(".",r),a=0>o?"":e.slice(o,n);return`${e.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${i}.min.js`}(e,t,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new ie).get(s);!this.isRegistered(e)&&this.register(i)}}class Xe{constructor(e,t){v(this,e,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),E(this,{classes:t})}}class et{constructor(e){v(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const tt=new class extends ae{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Je(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=xe,this._cmdRes=new D}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var st=Object.freeze({__proto__:null,viewable:N,debounce:H});const{currentScript:it}=document;class nt extends ae{static attach(){(window.MisoClients||(window.MisoClients=[])).push(nt),window.MisoClient?window.MisoClient!==nt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=nt}static debug(){}constructor(e){super("client",tt),this._config(e),this.context=new Ke(this),this.api=new We(this,tt),function(e){tt._clients.push(e),tt._events.emit("create",e)}(this)}get version(){return nt.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,b(e)}_readConfigFromScriptUrl(){return b({apiKey:new URL(new Request(it.src||it.href).url).searchParams.get("api_key")||void 0})}}nt.helpers=st,E(nt,{uuid:P()});var rt=function(e){const t=tt._pluginRoot;return tt.MisoClient=t.MisoClient=e,v(e,tt,["version","instances","any","meta","on","once","cmdDone"]),v(e,t,["plugins"]),e}(nt);const{GROUP:ot,NAME:at}=m;let ct;class ut{constructor(e){this._plugin=e}get anonymous_id(){return this._anonymousId||ct||(ct=L("miso_anonymous_id",P))}set anonymous_id(e){e=y(e),this._anonymousId=e,this._plugin._events.emit("set",`anonymous_id = '${e}'`)}get user_id(){return this._userId}set user_id(e){e=y(e),this._userId=e,this._plugin._events.emit("set",`user_id = '${e}'`)}get user_hash(){return this._userHash}set user_hash(e){if("string"!=typeof e&&void 0!==e)throw Error("User hash must be a string");this._userHash=e,this._plugin._events.emit("set",`user_hash = '${e}'`)}get user_type(){return this._userType}set user_type(e){this._userType=e,this._plugin._events.emit("set",`user_type = '${e}'`)}}function lt(){const e=new URLSearchParams(window.location.search);let t=b({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class ht{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],i=e[t];i!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function dt(e){const{context:t={}}=e,s={...t.custom_context,sdk_version:xe};return s.uuid||(s.uuid=P()),{...e,context:{...t,custom_context:s}}}const _t="std:native-fetch";let pt,mt;const ft=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return pt="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),pt="borrowed",e.contentWindow.fetch}catch(e){mt=e}})();const gt="miso-logdump",yt="miso-logdump",bt=yt+"__download-btn",wt="Miso Log";class vt{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return It||(It=B(Q("logdump")))}();let e=document.getElementById(gt);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||wt,t.classList.add(bt),t.addEventListener("click",(()=>this.download())),e=document.createElement("div"),e.id=gt,e.classList.add(yt),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(gt),t=e&&e.querySelector("."+bt);t&&(t.textContent=this._options.logDownloadButtonText||wt)}hideDownloadButton(){const e=document.getElementById(gt);e&&(e.style.display="none")}download(){const e=new Blob([kt(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:Et()})}return e&&"string"==typeof e?e:`miso-log.${Et()}.jsonl`}clear(){this._logs=[]}}function Et(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function kt(e){return e.map((e=>JSON.stringify(W(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),St(e[t-1])]}return e}(e),{depth:10})))).join("\n")}function St(e){return e?W(e,{depth:2}):e}let It;const Ot="std:debug";function xt(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}function Ct(e,t){return Object.freeze({...e,...t,members:Tt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function Tt(e=[],t=[]){return[...new Set([...e,...t])]}function At(e,t){let s={};for(const i of e)i&&(s=t(s,i));return b(s)}function Rt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function Nt(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>{return Object.assign(e,{...t,payload:(s=e.payload,i=t.payload,{...s,...i,...$t("_meta",s,i)})});var s,i}))}function $t(e,t,s){const i=t&&t[e],n=s&&s[e],r=i?n?{...i,...n}:i:n;return void 0!==r?{[e]:r}:{}}rt.plugins.register(class{constructor(e={}){this._options=e,this._logs=new vt(e)}static get id(){return Ot}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(Ot,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",(e=>this._injectComponents(e,t))),e.on("subtree",(s=>this._injectComponents(s,t.concat(e.meta.path)))),e.on("*",((s,i)=>this._handleEvent(e,i,s,t)))}_handleEvent(e,{name:t},s,i=[]){if("child"===t||"subtree"===t)return;const n=i.concat(e.meta.path);if(n.length||"create"!==t){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(t,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(n[1],n.slice(2),t,s))}this._logw(n.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",e];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=e,n="custom"===t&&s?`${t}:${s}`:t;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,i){this._logw([e,t.join(".")],s,i)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(xt)):this._log(e,t,xt(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter((e=>e)).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return _t}install(e,t){ft?(t.setCustomFetch(ft),e.debug(`<plugin:${_t}>`,"[info]",`Using ${pt} native fetch`)):e.debug(`<plugin:${_t}>`,"[error]","Failed to obtain native fetch: "+mt.message)}}),rt.plugins.use(class extends ae{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new ut(this);var s,i;this._contexts.set(e,t),s=t,Object.defineProperties(e.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e)),{}))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:i}){return t===ot.INTERACTIONS&&s===at.UPLOAD?this._modifyPayloadForInteractions(e,i):t===ot.ASK&&s===at.QUESTIONS?this._modifyPayloadForAsk(e,i):this._modifyPayloadForOthers(e,i)}_modifyPayloadForOthers(e,t){const{user_id:s,user_hash:i,anonymous_id:n}=e.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...t}}_modifyPayloadForAsk(e,t){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=e.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...t}}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:i}=e.context,n=b({anonymous_id:s,user_id:i});return{data:t=t.map((e=>({...n,...e})))}}}),rt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map((e=>({...e,context:{...b({page:b({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:lt()}),...e.context}})))}}}),rt.plugins.use(class extends ae{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new ht(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:s,payload:i}){if(t===_.SEARCH)if(s===p.SEARCH)this._captureSearchApiRequest(e,i)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),rt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(dt)}}}),rt.plugins.use(class extends ae{static get id(){return"std:api"}constructor(){super("api")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(e){if(!this._shallSuppressMetaObject(e))return e.payload;const{payload:{_meta:t,...s}={}}=e;return s}_shallSuppressMetaObject({apiGroup:e}){switch(e){case _.SEARCH:case _.RECOMMENDATION:return!0}return!1}});const Pt="data-miso-product-id",Lt="default",Ut="_organic",qt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),jt=new Set([qt.PRODUCTS,qt.CATEGORIES,qt.ATTRIBUTES,qt.RESULTS,qt.ITEMS,qt.QUESTION,qt.ANSWER,qt.IMAGES,qt.SOURCES,qt.RELATED_RESOURCES,qt.QUERY_SUGGESTIONS,qt.RELATED_QUESTIONS,qt.AFFILIATION,qt.FACETS,qt.TOTAL]);function Dt(e){return jt.has(e)}const Mt=new Set([qt.PRODUCTS,qt.IMAGES,qt.SOURCES,qt.RELATED_RESOURCES]);const zt=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),Ft=[zt.IMPRESSION,zt.VIEWABLE,zt.CLICK,zt.SUBMIT,zt.FEEDBACK],Bt=[zt.IMPRESSION,zt.VIEWABLE,zt.CLICK],Qt=new Set(Bt);const Gt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Ht=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"});function Wt(e){if(0>Ft.indexOf(e))throw Error("Unrecognized event type: "+e)}const Vt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function Kt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,(e=>"_"+e.toLowerCase())))}function Yt(e){if(void 0===e)return;let[t,s]=g(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function Zt(e,t){return!1===(t=Yt(t))[0]?t:e&&t?[t[0]||e[0],Jt(e[1],t[1])]:t||e}function Jt(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const Xt=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function es(e={}){e=Rt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))ts(t);return e}function ts(e={}){return e=Rt(e)}function ss(e={},t={}){const s={...e};for(const[i,n]of Object.entries(t))void 0!==n&&(s[i]=Ft.includes(i)?is(e[i],n):n);return s}function is(e={},t={}){return{...e,...t}}const ns=[{key:Vt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return b({group:s,name:e,payload:t})},merge:Nt},{key:Vt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${qt.PRODUCTS}: ... }) instead`),e={...s,[qt.PRODUCTS]:t});const i={};for(const[t,s]of Object.entries(e))i[Kt(t)]=Yt(s);return i},merge:function(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>{for(const[s,i]of Object.entries(t))e[s]=Zt(e[s],i);return e}))}},{key:Vt.DATA_PROCESSOR,normalize:function(e){e=g(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:Vt.TRACKERS,normalize:function(e={}){e=Rt(e);const{active:t,...s}=e,i={};for(const[e,t]of Object.entries(s))i[e]=es(t);return{active:t,...i}},merge:function(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>{for(const[s,i]of Object.entries(t))void 0!==i&&(e[s]="active"===s?i:ss(e[s],i));return e}))}},{key:Vt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=g(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,i=t.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:Vt.FILTERS,normalize:Rt,merge:function(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>Object.assign(e,t)))}},{key:Vt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&At(e,((e,t)=>Object.assign(e,t)))}}];class rs{constructor(){this._events=new re({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class os{constructor(e={},t={}){this._events=new re({target:this}),this._defaults=t,this._context=e||{},this._locals={},E(this,{resolved:new as(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",(e=>this._notify(e)))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class as{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,i=s._context[e];this._cache[e]=t(s._defaults[e],i&&i.get(),s._locals[e])}return this._cache[e]}}class cs{constructor(e,t,s,i,n){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?i(e):void 0,this._merge=n}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of ns){const{key:t,normalize:s,merge:i}=e;Object.defineProperty(rs.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new cs(this,this._globals,t,s,i))}}),Object.defineProperty(os.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new cs(this,this._locals,t,s,i))}}),Object.defineProperty(as.prototype,t,{get:function(){return this._get(e)}})}const us=[Vt.API,Vt.LAYOUTS,Vt.DATA_PROCESSOR,Vt.TRACKERS,Vt.INTERACTIONS];function ls(e,t=us){for(const s of t)hs(e,s)}function hs(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+i](e){return this._options[t].merge(e),this},["clear"+i](){return this._options[t].set(),this}})}var s}const ds="q",_s="qs";function ps(e={}){const{setValue:t,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:i=ds,sourceParam:n=_s,...r}={}){return{setValue:e,focus:t,updateUrl:s,param:i,sourceParam:n,...r}}(e),r=new URLSearchParams(window.location.search),o=r.get(i),a=r.get(n)||void 0,{layout:c}=this._views.get(qt.QUERY);c&&(o&&t&&(c.value=o),!o&&s&&c.focus()),o&&this.query(b({q:o,qs:a}))}class ms extends ae{constructor(e,t,s){super(e,t),this._plugin=t,this._client=s,this._options=new rs}}function fs(e){return e?"view:"+e:"view"}ls(ms.prototype);class gs{constructor(){(this._events=new re)._injectSubscribeInterface(this),this._states={},E(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,{silent:s=!1}={}){this._states[e]=Object.freeze(t),s||this._events.emit(e,t)}trigger(e,t){this._events.emit(e,t)}}class ys{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:P(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function bs(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class ws{constructor(e,{source:t,options:s}){this._hub=e,this._source=t,this._options=s,this._unsubscribes=[e.on("session",(e=>this._handleSession(e))),e.on("request",(e=>this._handleRequest(e)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e,this._emitResponse({session:e})}async _handleRequest(e){if(!this.active)return;const{session:t}=this._hub.states,{session:s,...i}=e;this._emitResponse({session:t,request:i});try{const{signal:s}=this._ac||{},n={...e.options,signal:s},r=await this._source({session:t,...e,options:n});if(r&&r[Symbol.asyncIterator]){let e;for await(e of(r._response&&this._emitResponseWithSessionCheck({session:t,request:i,value:r._response}),r)){if(!bs(this._hub,t))break;this._emitResponse({session:t,request:i,value:e})}}else this._emitResponseWithSessionCheck({session:t,request:i,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:i,error:e})}}_emitResponseWithSessionCheck(e){bs(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class vs{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,(e=>e.handler===t))}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{f(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Es,VIEWABLE:ks,CLICK:Ss}=zt,{UNTRACKED:Is,TRIGGERED:Os}=Gt,xs=Object.freeze({[Es]:Is,[ks]:Is,[Ss]:Is});class Cs{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:xs}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||Is}set(e,t,s){Wt(t),function(e){if(e!==Gt.UNTRACKED&&e!==Gt.TRACKING&&e!==Gt.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const i of g(e))this._setOne(i,t,s)}untriggered(e,t){return e.filter((e=>this.get(e,t)!==Os))}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const i=s(t);return e.set(t,i),i}(this._states,this._getKey(e),(()=>({...xs}))))[t]=s}}const Ts=[Symbol("itemless")];class As{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new Cs(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){Wt(e);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:n=!0,itemless:r=!1}=i;if(n){if(r&&(t=Ts),0===(t=this._states.untriggered(g(t),e)).length)return;this._states.set(t,e,Gt.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:zt.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(b({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new Cs(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[fs(this._role)]}}for(const e of Bt)As.prototype[e]=function(t,s){this._trigger(e,t,s)};class Rs{constructor(e,t){this._events=new re({target:this}),this._views=e,this._mapping=function(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}((e._roles.mappings||{})[t]||t),E(this,{role:t,interface:new Ns(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new vs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:e}=this;if(e===qt.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:t}=this;this._tracker=new As({hub:t,role:e,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((n=t)===(r=i)||n&&r&&n.status===r.status&&n.error===r.error&&n.value===r.value&&n.ongoing===r.ongoing&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(n.session,r.session)))return;var n,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=t,d={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...$s(t)},_=(e={},t)=>{!1!==e&&this.updateState({...d,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:_})}catch(e){this._error(e),_({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?Ht.ERRONEOUS:e.status;e=this._state=Object.freeze(b({...e,status:s}));const{role:i}=this;this.hub.update(fs(i),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:i,meta:n,...r}=e,o={value:this._mapping(e,this),status:i,data:t,meta:n,...r};return this.role===qt.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(t)}),b(o)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!Dt(s))continue;let t=e&&e[s];if(s===qt.QUERY_SUGGESTIONS){const e=this.hub.states.suggestions;t=e&&e.value}if(t&&0!==t.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Ns{constructor(e){v(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function $s(e){return function(e){return e.status===Ht.READY&&!e.ongoing}(e)?{empty:!!Ps(e)}:{}}function Ps(e){const{value:t}=e;return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}function Ls(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class Us{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new re({target:this,error:s}),E(this,{facets:new qs(this,t)}),this._unsubscribes=[e._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return b({facets:Object.freeze({}),sort:Ls(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(b({...e,...t,facets:Object.freeze(b({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset(){const e=this.states;this._states=void 0;const t=this._getStates();this._events.emit("reset",{states:t,oldStates:e})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class qs{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter((e=>e!==t));0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}const js=Symbol.for("miso:tracked");function Ds(e){return!!e[js]}function Ms(e){e[js]=!0}const zs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function Fs(e,t){return!!t&&{...e,...t}}class Bs{constructor(e,{workflow:t,extensions:s,layouts:i,roles:n,options:r}){this._hub=e,this._workflowName=t,this._extensions=s,this._layoutFactory=i,this._options=r,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new Us(this);for(const e of n.members)e!==qt.CONTAINER&&(this._views[e]=new Rs(this,e));E(this,{interface:new Qs(this),trackers:new Gs(this,n.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),e.on("data",(e=>this.refresh({data:e}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(e){if(this._containers.has(e))return;const t=new Rs(this,qt.CONTAINER);t.layout=this._createLayout(qt.CONTAINER),t.element=e,this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e}removeComponent(e){this._getViewByElement(e).element=void 0}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._views[e.role]}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e){for(const e of this._containers.values())e.layout=void 0;for(const e of Object.values(this._views))e.layout=void 0}else for(let[t,[s,i]]of Object.entries(e)){const e=()=>this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName});if(t===qt.CONTAINER)for(const t of this._containers.values())t.layout=e();else{const s=this.get(t);s&&(s.layout=e())}}}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,i]=t;return this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName})}get(e){return this._views[e]}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const e of Object.values(this._views))e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);if(!e&&t._inst){const{includes:e,excludes:i}=t._inst;e&&(s=s.filter((t=>t.role===qt.CONTAINER||e.includes(t.role)))),i&&(s=s.filter((e=>!i.includes(e.role))))}await Promise.all(s.map((s=>s.refresh({force:e,data:t}))))}_getData(e){return e||this._hub.states.data}_getTrackerOptions(e){const t=this._options.resolved.trackers;return function(e){if(!1===e)return!1;if(!0===e&&(e={}),"object"!=typeof e)throw Error("Invalid options: "+e);const{impression:t={},viewable:s={},click:i={},...n}=e;return b({...zs,...n,impression:Fs(zs.impression,t),viewable:Fs(zs.viewable,s),click:Fs(zs.click,i)})}(t&&t[e]||!1)}_getContainerTracker(){if(!this._containerTracker){const e=qt.CONTAINER;this._containerTracker=new As({hub:this._hub,role:e,itemless:!0,options:()=>this._getTrackerOptions(e)})}return this._containerTracker}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class Qs{constructor(e){this._actor=e,v(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map((e=>e.interface))}}class Gs{constructor(e,t){this._views=e;for(const s of t)s!==qt.CONTAINER&&Object.defineProperty(this,s,{get:()=>e.get(s).tracker});Object.defineProperty(this,qt.CONTAINER,{get:()=>e._getContainerTracker()})}}class Hs{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",(e=>this._trigger(e)))]}_trigger(e){this._hub.trigger("tracker",{type:zt.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Ws{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",(e=>this._handle(e)))]}_handle(e){0!==(e=g(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}function Vs(e){return async({group:t,name:s,payload:i,options:n})=>{if(t===_.ASK)switch(s){case p.QUESTIONS:return e.api.ask.questions(i,n);case p.SEARCH:return e.api.ask.search(i,n)}return e.api[t]._run(s,i,n)}}class Ks{constructor({role:e,workflow:t,...s}={}){E(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const i=this._rendered.get(e),n=q(!1);t=this._preprocess({state:t,rendered:i},{skip:n.t})||t,this._updatePending(t,s),n.value||this._handleInput({state:t,rendered:i},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,R((e=>this._doRaf(e))))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const n=this._rendered.get(this._element),r=q([]),o=q({});this._render(this._element,{state:s,rendered:n,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Ys(...e){return e.reduce(((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e)),{})}function Zs(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ti)(e,t,s)+(n.descriptionBlock||ii)(e,t,s)+(n.priceBlock||ri)(e,t,s)+(n.ctaBlock||ui)(e,t,s)}</div>`}function Js(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ti)(e,t,s)+(n.descriptionBlock||ii)(e,t,s)+(n.priceBlock||ri)(e,t,s)}</div>`}function Xs(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ti)(e,t,s)+(n.dateBlock||ni)(e,t,s)+(n.descriptionBlock||ii)(e,t,s)+(n.ctaBlock||ui)(e,t,s)}</div>`}function ei(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__item-info-container">${""+(n.titleBlock||ti)(e,t,s)}</div>`}function ti({className:e},{title:t}){return t?`<div class="${e}__item-title">${$(t)}</div>`:""}function si({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function ii({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${t}</div>`:s?`<div class="${e}__item-desc">${$(s)}</div>`:""}function ni({className:e,templates:t},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${e}__item-date">${_i(r,t.date)}</div>`:""}function ri(e,t){const{className:s,templates:i}=e,{sale_price:n,original_price:r,currency:o="USD"}=t,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,u=t.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(i.discountRateText||oi)(e,{...t,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function oi(e,{discount_rate_percent:t}){return`(${t}% off)`}function ai(e,t,s={}){const{className:i,templates:n}=e,{cover_image:r,image_src:o,image_alt:a}=t;if(!r&&!o)return"";const c=o?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${o}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(n.brandBlock||si)(e,t,s):""}</div>`}function ci({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function ui(e,t,s){const{className:i,templates:n}=e,r=pi.asFunction(n.cta)(e,t,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function li({className:e,options:t={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const a=!1!==o.link&&i?"a":"div",c=!1!==o.link&&i?`href="${i}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:i=!0}=e;let n="";i&&(t&&(n+=` target="${t}"`),s&&(n+=` rel="${s}"`));return n}(t.link)}`:"";return[`<${a} class="${e}__${n}" ${r?`data-role="${r}"`:""} ${s?`${Pt}="${s}"`:""} ${c}>`,`</${a}>`]}const hi=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),di="en-US";function _i(e,t=hi){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||hi.locale,t);default:throw Error("Invalid date format: "+t)}}const pi=Object.freeze({tagPair:li,formatDate:_i,formatNumber:function(e,t=di){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||di.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},escapeHtml:$,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class mi extends Ks{constructor({className:e,templates:t,...s}={}){super(s),E(this,{className:e,templates:{...Ys("root"),...t,helpers:pi}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class fi extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){fi.MisoClient.ui.layouts.create("banner").render(this)}}class gi{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(e,{ac:s});let n=!1;try{await N(e,{...t,signal:i}),n=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return n}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}class yi extends Ks{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new gi}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=fi.tagName,s=this._shallRenderBanner(e),i=e.querySelector(t);s&&!i?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&i&&i.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,i=void 0!==s&&"auto"!==s?s:t;return"auto"===i?e.components.some((({role:e})=>function(e){return e===qt.PRODUCTS||e===qt.ANSWER}(e))):!!i}_syncStatus(e,{state:t}){if(!e)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1,unanswerable:o=!1}={}}=t,a=[s,r?Ht.EMPTY:Ht.NONEMPTY];s===Ht.READY&&a.push(i?Ht.ONGOING:Ht.DONE),o&&a.push(Ht.UNANSWERABLE),e.setAttribute("status",a.join(" ")),n?e.setAttribute("miso-id",n):e.removeAttribute("miso-id")}_trackInteractions(e,t){const{status:s}=t;s===Ht.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const bi=Object.freeze({root:function(e,t){const{className:s,templates:i}=e,{status:n,value:r}=t;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class wi extends mi{static get type(){return"error"}static get defaultTemplates(){return bi}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...bi,...t},...s})}}const vi=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function Ei(e,t){const s=[];for(const i of t.entries){const t=e.e2b.get(i.element);t&&t.key===i.key||s.push(i)}return s}class ki{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const i=function(e,t,s){const i=new Map,n=new Map,r=[];for(let o=0;e.length>o;o++){const a=e[o],c=s[o],u=Object.freeze({index:o,key:a,value:t[o],element:c});i.set(a,u),n.set(c,u),r.push(u)}return{k2b:i,e2b:n,entries:r}}(e,t,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=Ei(n,i),o=Ei(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}function Si(e){K(e,Ii.prototype)}class Ii{_initTrackable(){this._bindings=new ki,this._viewables=new gi}_syncBindings(e,t){const s=this._getItems(t)||[],i=s.map((e=>this._getItemKey(e))),n=this._getItemElements(e),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map((({value:e})=>e)))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:i}of e)(async()=>{await this._viewables.track(i,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!Ds(t)&&0===t.button&&!t.defaultPrevented&&!!T(t.target,(e=>"A"===e.tagName&&e.href||void 0)))})(s,e)&&(Ms(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class Oi{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===Ht.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let i=!1;try{await N(t,{area:1,duration:0,signal:s.signal}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const xi=Object.freeze({product:function(e,t,s,i){const{templates:n}=e,[r,o]=li(e,s);return""+r+(n.imageBlock||ai)(e,s,i)+(n.infoBlock||n.productInfoBlock||Js)(e,s,i)+o},article:function(e,t,s,i){const{templates:n}=e,[r,o]=li(e,s);return""+r+(n.imageBlock||ai)(e,s,i)+(n.infoBlock||n.articleInfoBlock||Xs)(e,s,i)+(n.indexBlock||ci)(e,s,i)+o},image:function(e,t,s,i){const{templates:n}=e,[r,o]=li(e,s);return""+r+(n.imageBlock||ai)(e,s,i)+(n.infoBlock||n.imageInfoBlock||ei)(e,s,i)+o},question:function(e,t,s){const[i,n]=li(e,s);return`${i}${s.value||s.text||s}${n}`},root:function(e,t){const{className:s,role:i,templates:n,options:r}=e,{status:o}=t;return`<div class="${s} ${o}"${i?` data-role="${i}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${o===Ht.READY?n[o](e,t):""}${n.trigger(e,t)}${n.loading(e,t)}</div>`},[Ht.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t)||[];return i.length>0||t.ongoing?s.body(e,t,i):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:i,templates:n,options:r}=e,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${n.items(e,t,s)}</${o}>`},ordered:!1,items:function(e,t,s,{offset:i=0}={}){const{templates:n}=e;let r=i;return s.map((s=>n.item(e,t,s,r++))).join("")},item:function(e,t,s,i){const{className:n,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${n}__item">${r[a](e,t,s,{index:i})}</li>`},productInfoBlock:Js,articleInfoBlock:Xs,imageInfoBlock:ei,brandBlock:si,titleBlock:ti,descriptionBlock:ii,dateBlock:ni,priceBlock:ri,discountRateText:oi,ctaBlock:ui,cta:function(e,t,s){const{templates:i}=e,{url:n}=t;if(!n)return"";const[r,o]=li(e,{url:n},{classSuffix:"item-cta",role:"cta"}),a=pi.asFunction(i.ctaText)(e,t,s);return a?`${r}${a}${o}`:""},imageBlock:ai,indexBlock:ci,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Ci extends mi{static get defaultTemplates(){return xi}constructor({templates:e,itemType:t="product",...s}){super({templates:{...xi,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=this._html(e,t,s);return{...e,incremental:s,html:i}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:i,html:n}=t;if(i)if(n){this._getListElement(e).insertAdjacentHTML("beforeend",n)}else s(!1);else e.innerHTML=n}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:i,element:n}=t;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}Si(Ci.prototype),K(Ci.prototype,Oi.prototype);const Ti="miso-list";class Ai extends Ci{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Ti}constructor({className:e=Ti,...t}={}){super({className:e,...t})}}const Ri="miso-cards";function Ni(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function $i(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function Pi(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),i=t[2]||"";return[s,i]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function Li(e){return void 0===e||e instanceof Ui?e:new Ui(e)}class Ui{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=Li(e),Li([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class qi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,R((()=>this._syncDisplayedSwipeableItemIndex())))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),i=t.itemCount,n=t.itemCount=s?s.length:void 0;n!==i&&(void 0===n?t.itemIndex=void 0:void 0===i&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(Ni(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let i=0;for(const t of s.children)$i(t,"active",i===e),i++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._events.emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const ji="miso-ui-icon",Di=ji+"-svg-1_11_5-beta_10",Mi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative"},zi=`<symbol id="${ji}-${Mi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Fi=`<symbol id="${ji}-${Mi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,Bi=`<symbol id="${ji}-${Mi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,i=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-i} ${i}L${i} ${t-i}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,Qi=`<svg id="${Di}" style="display:none;">${[zi,Fi,Bi,`<symbol id="${ji}-${Mi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${ji}-${Mi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${ji}-${Mi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`].join("")}</svg>`;let Gi=!1;function Hi(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${ji}-${e}"></use></svg>`}Gi||document.head.querySelector("#"+Di)||(Gi=!0,document.head.insertAdjacentHTML("beforeend",Qi));const Wi=new Set(Object.values(Mi));Hi(Mi.SEND),Hi(Mi.SEARCH);const Vi=Hi(Mi.TRIANGLE);Hi(Mi.TRIANGLE_EQ);const Ki=Hi(Mi.CHEVRON),Yi=Hi(Mi.CHEVRON_NEGATIVE),Zi="miso-carousel",Ji=Object.freeze({body:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${n.list(e,t,s)}</div></div>${n.controls(e,t,s)}`},controls:function(e,t,s){const{templates:i}=e;return`${i.controlContainer(e,t,"previous")}${i.controlContainer(e,t,"next")}${i.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-container-${s}">${n.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?Yi:Ki},indexIndicator:function(e,t,s){const{className:i,templates:n}=e;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map((s=>`<li class="${i}__index-indicator-item">${n.indexIndicatorItem(e,t,s)}</li>`)).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Xi=Object.freeze({...Ci.defaultTemplates,...Ji});class en extends Ci{static get type(){return"carousel"}static get defaultTemplates(){return Xi}static get defaultClassName(){return Zi}constructor({className:e=Zi,templates:t,...s}={}){super({className:e,templates:{...Ji,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){K(e,qi.prototype)}(en.prototype);const tn="16rem",sn=Object.freeze({...Ci.defaultTemplates,item:function(e,t,s,i){const{className:n,templates:r,options:o}=e,{itemType:a}=o,c=r[a](e,t,s,{index:i});return`<li class="${n}__item${s._size?` ${n}__item-${s._size}`:""}">${c}</li>`}}),nn="miso-gallery";class rn extends Ci{static get type(){return"gallery"}static get defaultTemplates(){return sn}static get defaultClassName(){return nn}constructor({className:e=nn,templates:t,...s}={}){super({className:e,templates:{...sn,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=s?void 0:this._bodyHtml(e),n=this._itemsHtml(e,t);return{...e,...b({incremental:s,bodyHtml:i,itemsHtml:n})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const i=this._renderListElement(e,t,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:i}=t;return s||(e.innerHTML=i),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,i)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const i=e.children.length,n=this._writeItemSizes((this._getItems(t)||[]).slice(i),s,i);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,n,{offset:i}))}_writeItemSizes(e,[t=0,s=0]=[],i=0){let n=0;i>0&&(n=Math.min(i,t),i-=n,t-=n),i>0&&(n=Math.min(i,s),i-=n,s-=n);const r=[];for(const i of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),r.push({...i,_size:e})}return r}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=Li(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:i}=t,{height:n=tn}=this.options,r=Pi(n),o=e.clientWidth;if(0===o)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(o*i.width*2/(r*i.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),i=e;const n=Math.min(Math.floor(s/3),i);i-=n,s-=3*n;const r=Math.min(s,i);return i-=r,s-=r,[n,r,i]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,i=0]=t;const{className:n}=this;for(const t of e.children){let e=!1,r=!1;s>0?(e=!0,s--):i>0&&(r=!0,i--),$i(t,n+"__item-large",e),$i(t,n+"__item-medium",r),$i(t,n+"__item-small",!e&&!r)}}}const on="miso-search-box";const an=Object.freeze({root:function(e){const{className:t,templates:s,role:i,options:n,autocomplete:r}=e,{placeholder:o}=n;return`\n<div class="${t}" ${i?`data-role="${i}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=t;var r;return("function"==typeof i?i(e):""+i)+("function"==typeof n?n(e):(Wi.has(r=n)?Hi(r):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:i,autocomplete:n}=e;e={templates:s,workflow:i,...n};const r=[],o=[];for(const e of t)(e.product?r:o).push(e);return s.queries(e,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:i,templates:n}=e;return`<ul class="${i}__${t}-list" data-role="${t}-list">${s.map((s=>n.completionItem(e,t,s))).join("")}</ul>`},completionItem:function(e,t,s){const{className:i,templates:n}=e;return`\n<li class="${i}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${n[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||$(t)},product:function(e,{product:t}){const{templates:s}=e,[i,n]=s.helpers.tagPair(e,t,{role:!1});return""+i+s.imageBlock(e,t)+s.productInfoBlock(e,t)+n},imageBlock:ai,productInfoBlock:Js}),cn=Object.freeze({className:"miso-autocomplete",debounce:300});class un extends mi{static get type(){return"search-box"}static get defaultTemplates(){return an}static get defaultClassName(){return on}constructor({className:e=on,templates:t,autocomplete:s,...i}={}){super({className:e,templates:{...an,...t},...i}),E(this,{autocomplete:{...cn,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=H(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",(e=>this._syncInput(e))),t.on("keydown",(e=>this._handleKeyDown(e))),t.on("click",(e=>this._handleClick(e))),t.on("focusin",(e=>this._handleFocusIn(e))),t.on("focusout",(e=>this._handleFocusOut(e))),s.on("completions",(()=>e.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:i}){if(!t.completions)return;const{status:n=Ht.INITIAL,session:r,value:o}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(e),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);$i(e,"nonempty",l.length>0),u.setAttribute("data-status",n),u.innerHTML=this.templates.completions(this,l),i({completions:{index:a,status:n}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return ln.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new ln(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce((()=>s._view.hub.update("input",{value:t})))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&T(e,(e=>e===this._element||void 0))||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let i=t;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const t=i.getAttribute("data-index"),n=this._context().data.get(parseInt(t)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[zt.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class ln{static empty(){return ln._empty||(ln._empty=new ln)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,i=[];for(const n in e)for(const r of e[n])r.product&&!r.product.url||(r._index=t,r._field=n,s.set(t,r),i.push(r),t++);return i}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const hn="miso-option-list";const dn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:i}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map(((t,s)=>i.option(e,t,{index:s}))).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${$(t.text||t)}</li>`}});class _n extends mi{static get type(){return"option-list"}static get defaultTemplates(){return dn}static get defaultClassName(){return hn}constructor({className:e=hn,templates:t,...s}={}){super({className:e,templates:{...dn,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(e,t,s){super._render(e,t,s);const{state:i}=t;this._syncOptionValues(e,i)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;$i(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;i&&(this._trackClick(e,s),this._submit(i.text))}async _submit(e){e&&this._view.hub.update("query",{q:e})}destroy(){this._destroyTrackable(),super.destroy()}}Si(_n.prototype);const pn=Object.freeze({...Ys("options"),root:function(e){const{className:t,role:s,templates:i}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${i.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:i}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${i.content(e,t)}\n</div>\n`}});class mn extends mi{static get defaultTemplates(){return pn}constructor({className:e,templates:t,field:s,defaultValue:i,...n}={}){super({className:e,templates:{...pn,...t},...n}),this._field=s,this._defaultValue=i}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,(()=>this._refresh())),t.on("click",(e=>this._handleClick(e)))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=T(e,(e=>e.hasAttribute("data-value")?e:void 0));if(!t)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=t.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],R((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:i}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",i),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const fn="miso-feedback",gn=["helpful","unhelpful"];const yn=Object.freeze({options:function(e){const{templates:t}=e;return gn.map((s=>t.option(e,{value:s}))).join("")},content:function(e,{value:t}){const{className:s,templates:i,options:n={}}=e;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(e,t)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class bn extends mn{static get type(){return"feedback"}static get defaultTemplates(){return yn}static get defaultClassName(){return fn}constructor({className:e=fn,templates:t,...s}={}){if(super({className:e,templates:{...yn,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const wn="miso-text";const vn=Object.freeze({root:function(e,{value:t}){const{className:s,role:i,options:{raw:n=!1,tag:r}}=e,o=i?`data-role="${i}"`:"",a=void 0!==t?$(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:i}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[n,r]=t;switch(n){case"date":return e=>s(e,r);case"number":return e=>i(e,r);default:return e=>""+e}}(e)(t)):"";return n?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class En extends mi{static get type(){return"text"}static get defaultTemplates(){return vn}static get defaultClassName(){return wn}constructor({className:e=wn,templates:t,tag:s="p",...i}={}){super({className:e,templates:{...vn,...t},tag:s,...i})}}class kn extends Ks{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=q(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class Sn{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=t.substring(0,s),u=!i.startsWith(c);return a||u?e.innerText=i:e.insertAdjacentText("beforeend",i.substring(s,n)),a&&e.classList.add("done"),{cursor:n,done:a}}}function In(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=e;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[t,On(t)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(e));const i=t.children[0];return i.setAttribute("data-status",s||Ht.INITIAL),i}function On(e){return e+"__cursor"}function xn(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:i,ref:n,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${Cn(i[0])}, ${Cn(i[1])})`,t,""+r,n,o)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function Cn(e){return Math.floor(100*e)/100+"ms"}const Tn="miso-typewriter";class An extends kn{static get type(){return"typewriter"}static get defaultClassName(){return Tn}constructor({className:e=Tn,tag:t="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:t,format:s,tooltip:i,...a}),E(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:X({speed:n,acceleration:r}),this._readiness=new D,"markdown"===s&&An.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=On(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:i,onDebug:xn(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",(e=>this._onClick(e))))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new Sn}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=e,a=i&&i.answer_stage||"result",c=(l=e,(u=t)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=t?c&&a===t.stage?t.streak:t.streak+1:0,d=c&&t&&t.doneAt||(r!==Ht.READY||o?void 0:Date.now());return this._prevState=Object.freeze(b({session:n,status:r,value:s,stage:a,streak:h,doneAt:d,done:void 0!==d}))}_render(e,{state:t,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=In(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(o,s,{...t,cursor:e})}n(a);const u=t.status===Ht.READY&&!a.done;i({ongoing:u},{silent:u&&(!s||s.status===Ht.READY)&&!c}),u&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{event:e,index:t}))}const i=t.closest("a");if(i){if(!e.defaultPrevented){const{href:t,innerText:s,className:n}=i;t&&this._view._events.emit("link-click",b({event:e,url:t,text:s?s.trim():"",className:n||"",attributes:Rn(i)}))}}else;}}function Rn(e){const{attributes:t}=e,s={};for(const{name:e,value:i}of t)e.startsWith("data-")&&(s[e]=i);try{return JSON.stringify(s)}catch(e){return"{}"}}const Nn="miso-affiliation";const $n=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n,options:r}=e,{status:o}=t,a=i?` data-role="${i}"`:"",c=t.value||{},u=c.channel?` data-channel="${c.channel}"`:"",l=e._getItems(t),h=l?l.length:void 0;return`<div class="${s} ${o}"${a}${u}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${o===Ht.READY?n[o](e,t):""}</div>`},[Ht.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t);return i&&i.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}-container">${n.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:n}=e;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return Vi},body:function(e,t){const{className:s,templates:i}=e,n=e._getItems(t);return`<div class="${s}__body">${i.list(e,t,n)}</div>`},item:function(e,t,s,i){const{className:n,templates:r,options:o}=e,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(e,t,s,{index:i})}${r[a](e,t,s,{index:i})}</div></li>`},itemHeader:function(e,t,s,i){const{className:n,templates:r}=e;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=pi.asFunction(o)(e,t,s,i),a=pi.asFunction(a)(e,t,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,i){const{templates:n}=e,[r,o]=li(e,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||Zs)(e,s,i)+(n.imageBlock||ai)(e,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,i){const{className:n,templates:r}=e,o=pi.asFunction(r.logoText)(e,t,s,i)||"",a=pi.asFunction(r.logoImg)(e,t,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(e,t,s,i){const{className:n,templates:r}=e,o=pi.asFunction(r.logoUrl)(e,t,s,i);if(!o)return"";const a=pi.asFunction(r.logoAltText)(e,t,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Pn=Object.freeze({...Ci.defaultTemplates,...$n});class Ln extends Ci{static get type(){return"affiliation"}static get defaultTemplates(){return Pn}static get defaultClassName(){return Nn}constructor({className:e=Nn,templates:t,autoplay:s,...i}={}){super({className:e,itemType:"affiliation",templates:{...$n,...t},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new ue(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,R((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(e){const{products:t}=e.value||{};return t}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(Ni(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._events.emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const Un="miso-facets",qn="miso-facet",jn="custom_attributes.";const Dn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:i={}}=t.value||{};return Object.keys(i).map((n=>s.facet(e,{field:n,entries:i[n]},t)))},facet:function(e,t,s){const{facetClassName:i=qn,templates:n}=e,{field:r}=t;return`<div class="${i}" data-role="facet" data-field="${$(r)}">${n.header(e,t,s)}${n.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:i=qn,templates:n}=e;return`<div class="${i}__header">${n.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(jn)&&(t=t.substring(18)),$(t)},options:function(e,{field:t,entries:s},i){const{facetClassName:n=qn,templates:r}=e;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>r.option(e,{field:t,value:s,count:n},i))).join("")}</ul>`},option:function(e,t,s){const{facetClassName:i=qn,templates:n}=e;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(e,t,s)}</span>\n  <span class="${i}__count">${n.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return $(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function Mn(e,t){return`${e}:::${t}`}function zn(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class Fn extends mi{static get type(){return"facets"}static get defaultTemplates(){return Dn}static get defaultClassName(){return Un}constructor({className:e=Un,templates:t,...s}={}){super({className:e,templates:{...Dn,...t},...s}),this._bindings=new ki}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e))),s.on("update",(e=>this._updateSelections(e))),s.on("reset",(()=>this._syncSelections()))]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=zn(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)this._setSelected(i,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=zn(e.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)t[e]&&this._setSelected(i,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),i=[],n=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),o=s[e];if(!o)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=o[t];if(!c)break;i.push(Mn(e,c)),n.push({field:e,value:c}),r.push(s)}}this._bindings.update(i,n,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[$(e)]=t[e].map((([e])=>e));return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;if(!i)return;const{field:n,value:r}=i;this._view.filters.facets.toggle(n,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Bn="miso-select";const Qn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e,r=i?`data-role="${i}"`:"",o=e._getItems(t),a=o.find((e=>e.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${n.button(e,a)}\n  ${n.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:i}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:i}=e;return`<ul class="${s}__options">${e._getItems(t).map(((t,s)=>i.option(e,t,{index:s}))).join("")}</ul>`},option:function(e,t){const{className:s,templates:i}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${i.text(e,t)}</li>`},text:function(e,t){return $(t&&t.text&&t.text.replace(/[-_][a-zA-Z]/g," $1")||t||"")}});class Gn extends mi{static get type(){return"select"}static get defaultTemplates(){return Qn}static get defaultClassName(){return Bn}constructor({className:e=Bn,templates:t,...s}={}){super({className:e,templates:{...Qn,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",(e=>this._handleClick(e)))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._events.emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}Si(Gn.prototype);const Hn="miso-more-button";const Wn=Object.freeze({root:function(e,t){const{className:s,role:i,templates:n}=e;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${t.status!==Ht.READY?" disabled":""}>\n  ${n.text(e)}\n</div>\n`},text:function(e){return"More"}});class Vn extends mi{static get type(){return"more-button"}static get defaultTemplates(){return Wn}static get defaultClassName(){return Hn}constructor({className:e=Hn,templates:t,...s}={}){super({className:e,templates:{...Wn,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",(e=>this._handleClick(e)))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var Kn=Object.freeze({__proto__:null,TemplateBasedLayout:mi,ContainerLayout:yi,ErrorLayout:wi,BannerLayout:class extends mi{static get type(){return"banner"}static get defaultTemplates(){return vi}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...vi,...t},...s})}},CollectionLayout:Ci,ListLayout:Ai,CardsLayout:class extends Ci{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Ri}constructor({className:e=Ri,...t}={}){super({className:e,...t})}},CarouselLayout:en,GalleryLayout:rn,SearchBoxLayout:un,OptionListLayout:_n,FeedbackLayout:bn,TextLayout:En,TypewriterLayout:An,AffiliationLayout:Ln,FacetsLayout:Fn,SelectLayout:Gn,MoreButtonLayout:Vn});function Yn(e){return e&&e.value&&e.value.revision}function Zn(e){const t=function(e){if(!e)return Ht.INITIAL;const{request:t,error:s,value:i}=e;return s?Ht.ERRONEOUS:i?Ht.READY:t?Ht.LOADING:Ht.INITIAL}(e);return b({status:t,ongoing:t===Ht.READY?e.ongoing:void 0,...e})}function Jn(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:i}=s;i&&(t.meta.miso_id=i)}function Xn(e){const{request:t,value:s}=e;if(!t)return e;const{payload:i}=t||{},{q:n}=i||{};return n?{...e,value:{...s,keywords:n}}:e}function er(e){const{role:t,type:s,items:i}=e,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:b({property:t})}};switch(function(e){return Qt.has(e)}(s)&&(!function(e){return Mt.has(e)}(t)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map((e=>e.text||e.id||e))):n.product_ids=(i||[]).map((e=>"string"==typeof e?e:e.product_id)).filter((e=>e))),s){case zt.SUBMIT:n.context.custom_context.value=e.value;break;case zt.FEEDBACK:n.context.custom_context.value=n.value=e.value,n.context.custom_context.result_type=n.result_type=e.result_type}return b(n)}function tr(e={},t={}){return b({...e,...t,context:b({...e.context,...t.context,custom_context:b({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context})})})}const sr=Object.freeze({}),ir=Object.freeze({[qt.CONTAINER]:yi.type,[qt.ERROR]:wi.type}),nr=Object.freeze({}),rr=Object.freeze({api:sr,layouts:ir,trackers:nr}),or=Object.freeze({mappings:{[qt.ERROR]:e=>e.error}});class ar extends ae{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:i,defaults:n,options:r}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=i=i||t._client,e=Object.freeze({...e,plugin:s,client:i}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=r||new os(t&&t._options,n),this._hub=function(e,t){const{update:s,trigger:i}=e;return e.update=(i,n,r)=>{const o=s.call(e,i,n,r);return r&&r.silent||t("update",i,n,r),o},e.trigger=(...s)=>{const n=i.apply(e,s);return t("trigger",...s),n},e}(new gs,((...e)=>this._log(...e))),this._sessionContext=new WeakMap,this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({name:e,roles:t}){const s=this._hub,i=this._client,n=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new ys(s),this._data=new ws(s,{source:Vs(i),options:n}),this._views=new Bs(s,{extensions:r,layouts:o,roles:t,options:n,workflow:e}),this._interactions=new Ws(s,{client:i,options:n})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("response",(e=>this.updateData(e))),this._hub.on("tracker",(e=>this._onTracker(e)))],e.main&&this._unsubscribes.push(this._hub.on(fs(e.main),(e=>this._onMainViewUpdate(e))))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[fs(e)]||{};t.session&&t.status===Ht.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(e){const{status:t}=e,s=t===Ht.READY,i=t===Ht.ERRONEOUS;this._emitLifecycleEvent(i?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||i)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(e);return i.add(e),!n}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=Nt(this._options.resolved.api,{...e,session:t});this._hub.update("request",s)}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=Yn(e);if(!w(s)){const e=Yn(this._hub.states.data);if(!w(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){e=this._defaultProcessData(e);for(const t of this._options.resolved.dataProcessor)e=t(e);this._updateDataInHub(e)}_defaultProcessData(e){return e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=Zn(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:Ht.READY,session:this.session,...t},this._hub.update(fs(e),t),this}get trackers(){return this._views.trackers}_onTracker(e){const t=this._buildInteraction(e);this._sendInteraction(t)}_buildInteraction(e){let t=er(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)t=i(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){if(t.role!==qt.AFFILIATION)return e;const{items:s}=t;return tr(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((e=>e.position))}}})}(e=this._writeMisoIdToInteraction(e,t),t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return tr(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[fs(t.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?tr(e,{miso_id:i}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._events.emit("destroy"),this._destroy(e)}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy()}_log(e,t,s){this._emit(t,{_action:e,...s})}_emit(e,t){this._events.emit(e,t),this._context&&this._context._events.emit(e,{workflow:this,...t})}}function cr(e){if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:ur(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:i}=t;if(!i)return e;i=i.map((e=>({...e})));let n=0;for(const e of i)s&&(e.channel=s),e.position=n++;return{...e,affiliation:{...t,products:i}}}(e)}function ur({products:e,...t}){return{channel:"sovrn",...t,products:e.map(lr)}}function lr({id:e,deeplink:t,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return b({id:"sovrn-"+e,title:s,description:i,cover_image:c,url:t,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:hr({sovrn_id:e,thumbnail:u,merchant:l,...h})})}function hr(e,t=""){return Object.keys(e).reduce(((s,i)=>{const n=e[i];if(void 0===n)return s;const r=t?`${t}_${i}`:i;return"object"==typeof n?{...s,...hr(n,r)}:{...s,[r]:n}}),{})}function dr(e){K(e,_r.prototype)}ls(ar.prototype),Object.assign(ar,{DEFAULT_API_OPTIONS:sr,DEFAULT_LAYOUTS:ir,DEFAULT_TRACKERS:nr,DEFAULT_OPTIONS:rr,ROLES_OPTIONS:or});class _r{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=t;else{window.open(t,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const pr=Object.freeze({...ar.DEFAULT_API_OPTIONS,group:_.ASK,payload:{...ar.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),mr=Object.freeze({actor:!1,api:{group:_.ASK,name:p.AUTOCOMPLETE}}),fr=Object.freeze({...ar.DEFAULT_LAYOUTS,[qt.QUERY]:[un.type,{placeholder:"Ask a question"}],[qt.QUESTION]:[En.type,{tag:"h2"}],[qt.ANSWER]:An.type,[qt.FEEDBACK]:bn.type,[qt.IMAGES]:[rn.type,{incremental:!0,itemType:"image"}],[qt.SOURCES]:[Ai.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[qt.AFFILIATION]:[Ln.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),gr=Object.freeze({...ar.DEFAULT_TRACKERS,[qt.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Xt.click},[qt.IMAGES]:Xt,[qt.SOURCES]:Xt,[qt.AFFILIATION]:Xt,[qt.PRODUCTS]:Xt}),yr=Object.freeze({...ar.DEFAULT_OPTIONS,api:pr,autocomplete:mr,layouts:fr,trackers:gr}),br=Ct(ar.ROLES_OPTIONS,{main:qt.ANSWER,members:Object.keys(fr)});class wr extends ar{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new Hs(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._views.get(qt.ANSWER).on("citation-click",(e=>this._onCitationClick(e))),this._views.get(qt.ANSWER).on("link-click",(e=>this._onAnswerLinkClick(e)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[fs(this._roles.main)]||{};e.session&&e.status!==Ht.INITIAL&&(e.status!==Ht.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,i=t===Ht.READY&&!e.ongoing,n=t===Ht.ERRONEOUS,r=i?"done":n?"error":t,o=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,e),(i||n)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){ps.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||Ut}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&this._autoQuery.param!==ds?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),this._updateUrlIfNecessary(e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:cr(t)}}(e=super._defaultProcessData(e)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_updateUrlIfNecessary({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,n=e&&e.question||t&&t.payload&&t.payload.question,r=t&&t.payload&&t.payload._meta&&t.payload._meta.question_source;if(!n)return;const o=new URL(window.location),a=o.searchParams.get(s),c=o.searchParams.get(i)||Ut;n===a&&r===c||(o.searchParams.set(s,n),r===Ut?o.searchParams.delete(i):o.searchParams.set(i,r),window.history.replaceState({},"",o))}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAskPropertiesToInteraction(e,t),e=function(e,{event_target:t}={}){return t?tr(e,{context:{custom_context:{event_target:t}}}):e}(e=this._writeAnswerClickInteraction(e,t),t)}_writeAskPropertiesToInteraction(e={},t){return tr(e,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(t),question_id:this.questionId}}})}_writeAnswerClickInteraction(e,t){if(t.role!==qt.ANSWER)return e;const{items:s=[]}=t;return tr(e,{context:{custom_context:{urls:s.map((e=>e.url)),texts:s.map((e=>e.text)),class_names:s.map((e=>e.className)),attributes:s.map((e=>e.attributes))}}})}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[fs(e.role)]||{},{payload:s}=t||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:e,event:t}){if(Ds(t))return;const{value:s}=this.states.data||{},{sources:i}=s||{},n=i&&i[e-1];n&&n.product_id&&(Ms(t),this._views.trackers.sources.click([n.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){Ds(e)||(Ms(e),this._views.trackers.answer.click([],{items:[t]}))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}dr(wr.prototype),Object.assign(wr,{DEFAULT_API_OPTIONS:pr,DEFAULT_AUTOCOMPLETE_OPTIONS:mr,DEFAULT_LAYOUTS:fr,DEFAULT_TRACKERS:gr,DEFAULT_OPTIONS:yr,ROLES_OPTIONS:br});const vr=Object.freeze({...wr.DEFAULT_API_OPTIONS,name:p.QUESTIONS,payload:{...wr.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),Er=Object.freeze({...wr.DEFAULT_LAYOUTS,[qt.QUERY]:[un.type,{templates:{buttonIcon:"send"}}],[qt.RELATED_RESOURCES]:[Ai.type,{incremental:!0,itemType:"article"}],[qt.QUERY_SUGGESTIONS]:_n.type}),kr=Object.freeze({...wr.DEFAULT_TRACKERS,[qt.RELATED_RESOURCES]:Xt,[qt.QUERY_SUGGESTIONS]:{...Xt,click:{...Xt.click,validate:e=>0===e.button}}}),Sr=Object.freeze({...wr.DEFAULT_OPTIONS,api:vr,layouts:Er,trackers:kr}),Ir=Ct(wr.ROLES_OPTIONS,{members:Object.keys(Er)});class Or extends wr{constructor(e,t){super({name:"ask",context:e,roles:Ir,defaults:Sr,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;E(this,{parentQuestionId:t})}_initSubscriptions(e){this._setSuggestedQuestions(),super._initSubscriptions(e)}_setSuggestedQuestions(){const{previous:e}=this;if(!e)return;const t=e.states.data.value;this._hub.update("suggestions",{value:(t.suggested_followup_questions||t.followup_questions||[]).map((e=>({text:e})))})}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,...s}={}){const{parentQuestionId:i}=this;let n=b({...s,question:e,parent_question_id:i,_meta:{...s._meta,question_source:t||Ut}});return n=this._writeWikiLinkTemplateToPayload(n),n}_writeAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let i,n,r,{property:o}=e.context&&e.context.custom_context||{};return t.role===qt.QUERY_SUGGESTIONS?(o="suggested_followup_questions",n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,r=this._getQuestionSourceFromViewState(t)),tr(e,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:n,question_id:i,question_source:r}}})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{parentQuestionId:t,questionId:s}=this;t&&this._context._byPqid.delete(t),s&&this._context._byQid.delete(s),super._destroy(e)}}class xr extends ms{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new Or(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new Or(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}}const Cr=Object.freeze({...ar.DEFAULT_API_OPTIONS,group:_.SEARCH,payload:{...ar.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Tr=Object.freeze({...ar.DEFAULT_LAYOUTS,[qt.QUERY]:[un.type],[qt.PRODUCTS]:[Ai.type,{incremental:!0,infiniteScroll:!0}],[qt.KEYWORDS]:[En.type,{raw:!0}],[qt.TOTAL]:[En.type,{raw:!0,format:"number"}],[qt.FACETS]:[Fn.type],[qt.SORT]:[Gn.type],[qt.MORE]:[Vn.type]}),Ar=Object.freeze({...ar.DEFAULT_TRACKERS,[qt.PRODUCTS]:Xt}),Rr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Nr=Object.freeze({...ar.DEFAULT_OPTIONS,api:Cr,layouts:Tr,trackers:Ar,pagination:Rr}),$r=Ct(ar.ROLES_OPTIONS,{main:qt.PRODUCTS,members:Object.keys(Tr),mappings:{[qt.FACETS]:"facet_counts",[qt.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=t.states.filters||{},r=n&&n.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(i).field;return r?i.map((e=>({...e,selected:e.field===r}))):i}}});class Pr extends ar{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(e=>this._query(e))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(qt.SORT).on("select",(e=>this._handleSortSelect(e)))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){ps.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._queryArgs=e,this.restart();const t=this._buildPayload(e);this._request({payload:t})}_refine(){const{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart();const t=this._getQuery(),s=this._buildPayload(t);this._request({payload:s})}_more(){if(this.status!==Ht.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=this._getQuery();let t=this._buildPayload(e);t=this._processPayloadForMoreRequest(t),this._request({payload:t})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e)}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:i}=t||{};return b({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const i=e[s];i&&i.length&&(t[s]={terms:i})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return g(e)}_writePageInfoToPayload(e){return{...e,_meta:{...e._meta,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},i=s.map((e=>e.product_id)).filter((e=>e)),n=[...e.exclude||[],...i];return 0===n.length?e:{...e,exclude:n}}_defaultProcessData(e){return e=function(e,t){if(!t)return e;const{status:s,value:i}=e;switch(s){case Ht.INITIAL:case Ht.LOADING:break;default:return e}return i&&i.facet_counts?e:{...e,value:{...i,facet_counts:t}}}(e=Xn(e=super._defaultProcessData(e)),this._currentFacetCounts),e=function(e,{role:t=qt.PRODUCTS}={}){const{status:s,request:i,value:n}=e;if(s!==Ht.READY||!i||!n)return e;const{[t]:r}=n;if(!r)return e;const{rows:o}=i.payload,{length:a}=r;return o>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateDataInHub(e){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{_meta:s}=t.payload;if(!s||!s.page)return e;return function(e,t,{role:s=qt.PRODUCTS}={}){if(!t.value)return e;const{[s]:i=[],facet_counts:n,total:r}=e.value,{[s]:o=[]}=t.value;return{...t,facet_counts:n,total:r,value:{...t.value,[s]:[...i,...o]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}}ls(Pr.prototype,[Vt.PAGINATION,Vt.FILTERS]),Object.assign(Pr,{DEFAULT_API_OPTIONS:Cr,DEFAULT_LAYOUTS:Tr,DEFAULT_TRACKERS:Ar,DEFAULT_PAGINATION:Rr,DEFAULT_OPTIONS:Nr,ROLES_OPTIONS:$r});const Lr=Object.freeze({members:[]});function Ur({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function qr(e){return e&&e.value&&e.value.trim()||void 0}class jr extends ar{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:Ur(t),roles:Lr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",(e=>this._query(e)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,qr(e)===qr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!qr(e))return void this._updateCompletions({session:s,status:Ht.INITIAL});const i=this._buildPayload(e);this._request({payload:i})}_buildPayload(e){return{q:qr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function Dr(e){K(e,Mr.prototype)}class Mr{_initAutocomplete(e){this._autocomplete=new jr(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const zr=Ct(wr.ROLES_OPTIONS,{mappings:{[qt.QUESTION]:qt.KEYWORDS}});class Fr extends wr{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:zr,superworkflow:e})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._superworkflow=e.superworkflow}_initSession(){}restart(){super.restart();const e=this._superworkflow._results;e._views.filters.reset(),e.restart(),this._resultsSession=e.session}_buildPayload(e){return e=this._writeQuestionSourceToPayload(e),e=this._writeWikiLinkTemplateToPayload(e),e=this._superworkflow._results._writeFiltersToPayload(e)}_writeQuestionSourceToPayload({qs:e,...t}={}){return{...t,_meta:{...t._meta,question_source:e||Ut}}}_defaultProcessData(e){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:i}={}}=t;return i?{...e,meta:{...e.meta,miso_id:i}}:e}(e=Xn(e=super._defaultProcessData(e))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_updateDataInHub(e){switch(e.status){case Ht.INITIAL:case Ht.LOADING:this._dispatchDataToSibling(e)}super._updateDataInHub(e)}_handleHeadResponse(e){super._handleHeadResponse(e),Jn(e),this._dispatchDataToSibling(e)}_dispatchDataToSibling(e){this._resultsSession&&this._superworkflow._results.updateData({...e,session:this._resultsSession})}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}Dr(Fr.prototype);const Br={...Pr.ROLES_OPTIONS,members:[qt.PRODUCTS,qt.KEYWORDS,qt.TOTAL,qt.FACETS,qt.SORT,qt.MORE,qt.ERROR]};class Qr extends Pr{constructor(e){super({name:"hybrid-search/results",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:Br,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_emitLifecycleEvent(e,t){super._emitLifecycleEvent(e,t),this._superworkflow._emitLifecycleEvent(e,t)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(e){return e=this._superworkflow._answer._writeQuestionSourceToPayload(e),e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e){return{...e,_meta:b({...e._meta,question_id:this._superworkflow._answer.questionId})}}_defaultProcessData(e){return Jn(e=super._defaultProcessData(e)),e}_defaultProcessInteraction(e,t){return this._superworkflow._defaultProcessInteraction(e,t)}_defaultProcessInteraction0(e,t){return super._defaultProcessInteraction(e,t)}}Object.assign(Qr,{ROLES_OPTIONS:Br});class Gr{constructor(e){this._workflow=e,this._containers=new Set}get(e){return this._getSubviews(e).get(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._workflow._subworkflows)t._views.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getViewByElement(e).element=e,this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getViewByElement(e).element=void 0,this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._getViewByElement(e);t&&t.refresh({force:!0})}_getSubworkflow(e){return this._workflow._getSubworkflow(function(e){return Qr.ROLES_OPTIONS.members.includes(e)?"results":"answer"}(e))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((e=>e._views))}_getSubviews(e){return this._getSubworkflow(e)._views}_getViewByElement(e){let{role:t}=e;if(!t)throw Error("Component must have a role");return this.get(t)}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,i=this._getSubviews(s);if(!i._containers.has(e)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(e)){for(const i of e.components)if(s.containsElement(i))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}i.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const Hr=Object.freeze({group:_.ASK,name:p.SEARCH,payload:{...wr.DEFAULT_API_OPTIONS.payload,...Pr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Wr=Object.freeze({...wr.DEFAULT_LAYOUTS,...Pr.DEFAULT_LAYOUTS,[qt.QUERY]:[un.type,{placeholder:""}],[qt.QUESTION]:[En.type,{raw:!0}]}),Vr=Object.freeze({...wr.DEFAULT_TRACKERS,...Pr.DEFAULT_TRACKERS}),Kr=Object.freeze({...Pr.DEFAULT_PAGINATION,active:!0}),Yr=Object.freeze({api:{group:_.ASK,name:p.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Zr=Object.freeze({...wr.DEFAULT_OPTIONS,...Pr.DEFAULT_OPTIONS,api:Hr,layouts:Wr,trackers:Vr,autocomplete:Yr,pagination:Kr}),Jr=Object.freeze({main:qt.PRODUCTS,members:Object.keys(Wr),mappings:Object.freeze({...wr.ROLES_OPTIONS.mappings,...Pr.ROLES_OPTIONS.mappings})});class Xr extends ar{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Jr,defaults:Zr})}_initProperties(e){super._initProperties(e),this._subworkflows=[this._answer=new Fr(this),this._results=new Qr(this)]}_getSubworkflow(e){switch(e){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+e)}}_initActors(){this._views=new Gr(this)}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(e,t){return this._answer.useLink(e,t),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(e){this._answer.autoQuery(e)}query(e){this._answer.query(e)}_defaultProcessInteraction(e,t){return e=this._answer._defaultProcessInteraction0(e,t),e=this._results._defaultProcessInteraction0(e,t)}_destroy(){for(const e of this._subworkflows)e.destroy();super._destroy()}}ls(Xr.prototype,[Vt.PAGINATION,Vt.FILTERS]);const eo=Object.freeze({...ar.DEFAULT_API_OPTIONS,group:_.ASK,name:p.RELATED_QUESTIONS}),to=Object.freeze({...ar.DEFAULT_LAYOUTS,[qt.RELATED_QUESTIONS]:[Ai.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[qt.QUERY]:[un.type,{placeholder:"Ask a question"}]}),so=Object.freeze({...ar.DEFAULT_TRACKERS,[qt.RELATED_QUESTIONS]:Xt,[qt.CONTAINER]:{...Xt,itemless:!0},[qt.QUERY]:{[zt.SUBMIT]:{active:!0}}}),io=Object.freeze({...ar.DEFAULT_OPTIONS,api:eo,layouts:to,trackers:so}),no=Ct(ar.ROLES_OPTIONS,{main:qt.RELATED_QUESTIONS,members:Object.keys(to)});class ro extends ar{constructor(e,t){super({name:"explore",plugin:e,client:t,roles:no,defaults:io})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.get(qt.RELATED_QUESTIONS).on("click",(e=>this._handleRelatedQuestionClick(e))),this._hub.on("query",(e=>this._query(e)))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(e){const{product_id:t}=e;return t&&(this._productId=t),super.useApi(e)}useLink(e,t){return _r.prototype.useLink.call(this,e,t),t&&this.useLayouts({[qt.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=qt.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e){return e=super._defaultProcessData(e),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=_r.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}dr(ro.prototype);const oo=Object.freeze({group:_.SEARCH,name:p.SEARCH,payload:{fl:["*"]}}),ao=Object.freeze({api:{group:_.SEARCH,name:p.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),co=Object.freeze({...Pr.DEFAULT_LAYOUTS}),uo=Object.freeze({...Pr.DEFAULT_TRACKERS}),lo=Object.freeze({...Pr.DEFAULT_OPTIONS,api:oo,autocomplete:ao,layouts:co,trackers:uo}),ho=Pr.ROLES_OPTIONS;class _o extends Pr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:ho,defaults:lo})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=qt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}Dr(_o.prototype);const po=Object.freeze({...ar.DEFAULT_API_OPTIONS,group:_.RECOMMENDATION,name:p.USER_TO_PRODUCTS,payload:{...ar.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),mo=Object.freeze({...ar.DEFAULT_LAYOUTS,[qt.PRODUCTS]:Ai.type}),fo=Object.freeze({...ar.DEFAULT_TRACKERS,[qt.PRODUCTS]:Xt}),go=Object.freeze({...ar.DEFAULT_OPTIONS,api:po,layouts:mo,trackers:fo}),yo=Ct(ar.ROLES_OPTIONS,{main:qt.PRODUCTS,members:Object.keys(mo)});class bo extends ar{constructor(e,t){super({name:"recommendation",context:e,roles:yo,defaults:go,id:t})}_initProperties(e){super._initProperties(e);const{id:t}=e;E(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}start(){return this._request(),this}notifyViewUpdate(e=qt.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return tr(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}class wo extends ms{constructor(e,t){super("recommendations",e,t),this._members=new Map}workflows(){return[...this._members.values()]}create(e=Lt){if(this._members.has(e))throw Error("Unit already exists: "+e);return new bo(this,e)}has(e=Lt){return this._members.has(e)}get(e=Lt){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||new bo(this,e)}}class vo extends ae{constructor({name:e,plugin:t,MisoClient:s,...i}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new D)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}var Eo=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var ko=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class So{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Io{constructor(e){this._context=e,E(this,{lowerCamelToKebab:I,kebabToLowerCamel:k,kebabOrSnakeToLowerCamel:S})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...i}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=S(e))?"querySuggestions":e}phrase(e,{name:t,tag:s="div",inline:i=!1}){const{classPrefix:n}=e;return`<${s} class="${i?n+"__phrase-inline":n+"__phrase"} ${n}__${t}-phrase">${this.phraseText(e,k(t))}</${s}>`}phraseText(e,t){const{phrases:s={}}=e,i=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof i){case"function":return i(e);case"string":return i;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${e}__${i}-container`];return t&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const i=t[e];void 0!==i&&(s+=` ${I(e)}="${i}"`)}return s}}const Oo=Y(new Io({...Eo,DEFAULT_PHRASES:ko})),xo=Y(new class extends So{constructor(){super({helpers:Oo})}answerGroup(e){const{container:t}=this._helpers;return[...super.answerGroup(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(e){const{classPrefix:t,features:s={}}=e;return!1===s.followUpQuestions?"":`<div id="${t}__follow-ups" class="${t}__follow-ups"></div>`}relatedResourcesSection(e){const{container:t,phrase:s,section:i}=this._helpers,{features:n={},logo:r=!0}=e;return i(e,{name:"related-resources"},!1===n.relatedResources?"":t(e,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(e){const{container:t,phrase:s}=this._helpers,{features:i={}}=e;return!1===i.querySuggestions?"":t(e,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(e,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:Oo}));function Co(e={}){const{normalizeOptions:t,section:s,container:i}=Oo,{querySuggestions:n,answerGroup:r}=xo;return s(e=t(e),{name:"follow-up"},[n(e),i(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(e)])}var To=Object.freeze({__proto__:null,helpers:Oo,sections:xo,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=Oo,{followUps:n,relatedResourcesSection:r,answerGroup:o}=xo;return""+s(e=t(e),{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},o(e))+n(e)+r(e)},followUp:Co});const Ao=Object.freeze(Eo),Ro=Object.freeze(ko),No=Object.freeze(To);var $o=Object.freeze({__proto__:null,constants:Ao,phrases:Ro,templates:No,wireFollowUps:function(e,t,{template:s=Co,...i}={}){if(!e)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!t)return;const n=e.ui.asks,r=e.ui.ask;n.on("done",(e=>{t.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:e.workflow.questionId}))})),r.on("loading",(()=>{t.innerHTML="",n.reset({root:!1})}))},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");t&&e.ui.asks.on("loading",(e=>{for(const s of t.querySelectorAll("miso-ask"))s.workflow=e.workflow}))}});const{currentScript:Po}=document,Lo=Object.freeze({templates:No,autostart:!0}),Uo=["templates","phrases","features"];class qo{constructor(){this._defaults=Lo,this._scriptSrc=function(){if(!Po||!Po.src)return{};const e=document.createElement("a");e.href=Po.src;const t={};for(const[s,i]of new URLSearchParams(e.search))"q"!==s&&(t[s]=Mo(i));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=Mo(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:i,...n}={}){return b({apiKey:e,apiHost:t,templates:zo(s),phrases:i,...n})}(jo(this._defaults,this._scriptSrc,e,this._pageUrl))}}function jo(...e){let t={};for(const s of e)s&&(t=Do(t,s));return t}function Do(e,t){if(!t)return e;Object.assign(e,t);for(const s of Uo)s in t&&(e[s]={...e[s],...t[s]});return e}function Mo(e){return""===e||"false"!==e&&e}function zo(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(zo):function(e,t){const s={};for(const[i,n]of Object.entries(e))s[i]=t(n);return s}(e,zo);default:throw Error("Unsupported template type: "+e)}}class Fo{constructor(e,{classPrefix:t=Ao.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");E(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class Bo extends vo{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new qo,this._localOptions={}}config(e={}){e=jo(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;E(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new Fo(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=e.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,u=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(t,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),u.autoQuery()}}class Qo extends ce{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}let Go,Ho,Wo;async function Vo(e){const t=await async function(e){return e.MisoClient||window.MisoClient||Go||(Go=async function(){return new Promise((e=>{(window.misocmd||(window.misocmd=[])).push((()=>e(window.MisoClient)))}))}())}(e);var s;return Ho=Ho||t.any(),Wo=Wo||await Ho,Wo.ui||await(s=0,new Promise((e=>setTimeout(e,s)))),Wo}const Ko="logo",Yo="auto",Zo=Object.freeze([Ko]);function Jo(e){if(!e)return Yo;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class Xo extends HTMLElement{static get observedAttributes(){return Zo}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Jo(this.getAttribute(Ko))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Yo:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(Ko,t):this.removeAttribute(Ko)}async connectedCallback(){const e=this._client=await Vo(Xo);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(e))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===Ko)this._handleLogoUpdate(t,s)}_handleLogoUpdate(e,t){Jo(e)!==Jo(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const ea="parent-question-id",ta=Object.freeze([...Xo.observedAttributes,ea]);const sa="unit-id",ia=Object.freeze([...Xo.observedAttributes,sa]);var na=Object.freeze({__proto__:null,MisoAskElement:class extends Xo{static get tagName(){return"miso-ask"}static get observedAttributes(){return ta}_getWorkflow(e){return this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(ea)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(ea,e):this.removeAttribute(ea))}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e),this.parentQuestionId=e&&e.parentQuestionId}attributeChangedCallback(e,t,s){if(e===ea)this._handleParentQuestionIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Xo{static get observedAttributes(){return Xo.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(e){return e.ui.explore}},MisoHybridSearchElement:class extends Xo{static get observedAttributes(){return Xo.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends Xo{static get observedAttributes(){return Xo.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Xo{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return ia}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}get unitId(){return this.getAttribute(sa)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(sa,e):this.removeAttribute(sa)}attributeChangedCallback(e,t,s){if(e===sa)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}});const ra="role",oa=Object.freeze([ra]);class aa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return oa}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(ra);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ra}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${ra}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===ra&&this._container&&this._container._updateComponentRole(this,t,s)}}var ca=Object.freeze({__proto__:null,MisoComponentElement:aa,MisoQueryElement:class extends aa{constructor(){super({role:qt.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends aa{constructor(){super({role:qt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends aa{constructor(){super({role:qt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends aa{constructor(){super({role:qt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends aa{constructor(){super({role:qt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends aa{constructor(){super({role:qt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends aa{constructor(){super({role:qt.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends aa{constructor(){super({role:qt.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends aa{constructor(){super({role:qt.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends aa{constructor(){super({role:qt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends aa{constructor(){super({role:qt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends aa{constructor(){super({role:qt.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends aa{constructor(){super({role:qt.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends aa{constructor(){super({role:qt.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends aa{constructor(){super({role:qt.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends aa{constructor(){super({role:qt.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends aa{constructor(){super({role:qt.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends aa{constructor(){super({role:qt.ERROR})}static get tagName(){return"miso-error"}}});class ua extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(ua.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var la=Object.freeze({__proto__:null,containers:na,roles:ca,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends ua{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:fi});const ha="miso-hybrid-search-combo";var da=Object.freeze({__proto__:null,CLASS_PREFIX:ha,CONAINER_TAG:"miso-hybrid-search"});const _a="Show more",pa="Show less";var ma=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:_a,showLess:pa});const fa=Y(new Io({...da,DEFAULT_PHRASES:ma})),ga=Y(new class extends So{constructor(){super({helpers:fa})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:fa}));var ya=Object.freeze({__proto__:null,helpers:fa,sections:ga,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=fa;e=t(e);const{answerBox:n,answerGroup:r,searchResultsGroup:o}=ga,{answerBox:a=!0}=e;return""+s(e,{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[n(e)]:r(e))+s(e,{name:"search-results"},o(e))}});const ba="answer-box-open",wa="answer-box-shown",va='[data-role="answer-box-toggle"]';class Ea{constructor(e,t,{classPrefix:s=ha,phrases:i={},hideWhenUnanswerable:n=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=n,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push((()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)}));const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:e,button:t}){0===t&&e.closest(va)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case Ht.ERRONEOUS:case Ht.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||pa:this._phrases.showMore||_a;for(const t of this._element.querySelectorAll(va))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const ka={isOpen:ba,shown:wa},Sa={toggleOpen:["toggle",ba],open:["open",ba],close:["remove",ba],toggleHidden:["toggle",wa],show:["add",wa],hide:["remove",wa]};for(const[e,t]of Object.entries(ka))Object.defineProperty(Ea.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(Sa))Ea.prototype[e]=function(){this._updateBoxStatus(t,s),s===ba&&(this._syncButtonText(),this._syncScroll())};const Ia=Object.freeze(da),Oa=Object.freeze(ma),xa=Object.freeze(ya);var Ca=Object.freeze({__proto__:null,constants:Ia,phrases:Oa,templates:xa,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new Ea(e,t,s)}});const Ta=Object.freeze($o),Aa=Object.freeze(Ca);var Ra=Object.freeze({__proto__:null,ask:Ta,hybridSearch:Aa});const Na="ui";let $a,Pa;async function La(){return Pa||(Pa=B($a||($a=Q(Na))))}class Ua{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class qa{constructor(e,t){this._plugin=e,this._client=t,E(this,{sources:{api:Vs(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new _o(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Xr(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new ro(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class ja{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new Bo(this._plugin,this._MisoClient))}}rt.plugins.use(class extends ae{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Qo(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new D}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:Ra};v(s,this,["layouts","combo","ready"]),E(this,{MisoClient:e}),E(e,{ui:s}),this.combo=new ja(this,e);const i=Object.values(Kn).filter((e=>e.type));for(const t of i)t.MisoClient=e;for(const e of i)this.layouts.register(e);const{containers:n,roles:r,combos:o,...a}=la,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];Xo.MisoClient=e,ua.MisoClient=e;for(const t of c)t.MisoClient=e;await La();for(const e of c)A(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(e){E(e,{ui:new qa(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new Ua(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new wo(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new xr(this,e)),t}});const Da=5e3;let Ma,za,Fa=!1;async function Ba(e){return new Promise((t=>setTimeout((()=>{const e=P();Va("Fallback",e),t(e)}),e)))}async function Qa(){const e=await we((()=>window.gaGlobal&&window.gaGlobal.vid));return e&&Va("GA4",e),e}async function Ga(){const e=(await(Ma||(Ma=async function(){return we((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}()))).get("clientId");return e&&Va("UA",e),e}const Ha="%cMiso",Wa="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";function Va(e,t){!function(...e){(a.indexOf("beta")>=0||"dev"===a)&&function(...e){console.log(Ha,Wa,...e)}(...e)}(`[${e}] Client ID: ${t}${Fa?" (unused)":""}`),Fa=!0}async function Ka(e){const t=function({site:e,config:t,version:s}){Object.defineProperty(rt,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||t.debug;i&&rt.plugins.use("std:debug",{console:{background:"#9033bb"}});(t.dry_run||e.dev)&&rt.plugins.use("std:dry-run");return window.MisoClientSA=rt,rt}(e),s=await async function({config:e},{MisoClient:t}){const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const i=window.misoSA=new t(s);return i.context.anonymous_id=await async function(){return za||(za=Promise.any([Qa(),Ga(),Ba(Da)]))}(),i}(e,{MisoClient:t});return await s.ui.ready,[t,s]}function Ya(e){return t=>({...t,context:{...t.context,custom_context:{...Za(e),...t.context&&t.context.custom_context}}})}function Za({site:e,page:t,config:s,version:i}){return b({source:"miso-client-script",script_version:i,attribution:"miso-smart-answers",site:e.key,user_geo:s.geo,page_type:t.type,post_id:t.postId,uuid:P()})}let Ja;async function Xa(){return Ja||(Ja=async function(){const[[e,t]]=await Promise.all([Ka(Oe),_e(Oe)]);return{MisoClient:e,client:t}}())}const ec='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',tc='<svg viewBox="0 0 15 14" fill="currentColor">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 3.92319V5.46173C0.000125254 5.46173 0.000250509 5.46173 0.000375766 5.46173C2.12455 5.46173 3.84653 7.18371 3.84653 9.30789C3.84653 9.3079 3.84653 9.30791 3.84653 9.30792H5.38499C5.38499 9.30791 5.38499 9.3079 5.38499 9.30789C5.38499 7.18384 7.10677 5.46194 9.23077 5.46173V3.92327C7.10678 3.92307 5.38501 2.20118 5.38499 0.0771484H3.8466C3.84655 2.20127 2.12459 3.92319 0.000450868 3.92319C0.000300577 3.92319 0.000150287 3.92319 0 3.92319Z"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M8 9.83844V11.005C9.61039 11.0056 10.9157 12.3112 10.9157 13.9217C10.9157 13.9222 10.9157 13.9226 10.9157 13.923H12.0822C12.0822 13.9226 12.0822 13.9222 12.0822 13.9217C12.0822 12.3109 13.388 11.005 14.9989 11.005C14.9993 11.005 14.9997 11.005 15.0002 11.005V9.83854C14.9997 9.83854 14.9993 9.83854 14.9989 9.83854C13.3884 9.83854 12.0827 8.53324 12.0822 6.92285H10.9156C10.915 8.53281 9.60996 9.83783 8 9.83844Z"/>\n</svg>',sc='<svg width="24" height="24" viewbox="0 0 32 32"><path fill="currentColor" fill-rule="evenodd" d="M12.67 5.33c2.44 0 4.25.77 5.44 1.96A7.02 7.02 0 0 1 20 12.4c0 2.15-.7 3.89-1.9 5.1-1.2 1.2-3 1.97-5.43 1.97-2.44 0-4.24-.78-5.44-1.98a7.03 7.03 0 0 1-1.9-5.09c0-2.2.69-3.93 1.87-5.12 1.17-1.18 2.98-1.95 5.47-1.95zm0-1.33c5.46 0 8.66 3.45 8.66 8.4 0 4.88-3.2 8.4-8.66 8.4S4 17.29 4 12.4C4 7.45 7.12 4 12.67 4zm8.3 16.03a.67.67 0 1 0-.94.94l7.33 7.34.95-.95-7.34-7.33z" /></svg>',ic='<svg width="26" height="26" viewbox="0 0 32 32" fill="none"><path stroke="currentColor" stroke-width="1.33" d="M16 3.34c4.06 0 7.2 1.31 9.34 3.51 2.14 2.2 3.33 5.36 3.33 9.15 0 3.73-1.18 6.89-3.33 9.1-2.14 2.23-5.29 3.57-9.34 3.57-4.04 0-7.2-1.34-9.33-3.56-2.15-2.22-3.33-5.38-3.33-9.1 0-3.8 1.16-6.96 3.28-9.16S11.88 3.34 16 3.34z"/><path stroke="currentColor" stroke-width="1.33" d="m13.66 10.67 4.72 4.72c.52.52.52 1.36 0 1.88L13.66 22"/></svg>',nc={question:"Generated by ${site} Smart Answers AI"};function rc(e){return`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  ${oc()}\n</section>\n${function(e){const t='\n<div class="miso-hybrid-search-combo__skeleton-source-item" style="flex-shrink:0;padding-bottom:3.2rem;">\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:23px;width:23px;"></div>\n  <div class="miso-hybrid-search-combo__skeleton-item" style="height:72px;width:100%;border-radius:6px;"></div>\n  <div style="display:flex;gap:0.8rem;align-items:center;">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:10%;border-radius:6px;"></div>\n    <div style="color:#B6AEAA;font-size:1.28rem;margin-bottom:10px;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:30%;border-radius:6px;"></div>\n  </div>\n</div>\n';return`\n<section class="miso-hybrid-search-combo__skeleton miso-hidden">\n  <div class="miso-hybrid-search-combo__question-phrase">\n    <div class="miso-hybrid-search-combo__question-phrase-main">\n      <i>${tc}</i>\n      <span>${ac(e)}</span>\n    </div>\n    <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">Learn more</a>\n  </div>\n  <div class="miso-hybrid-search-combo__skeleton-answer-block">\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:92%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:70%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:95%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:65%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:90%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:100%;"></div>\n    <div class="miso-hybrid-search-combo__skeleton-item" style="height:15px;width:60%;"></div>\n  </div>\n  <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">This answer is based on the following articles</h3>\n  <div class="miso-hybrid-search-combo__skeleton-source-block" style="overflow-y:hidden;">\n    ${t}\n    ${t}\n    ${t}\n  </div>\n</section>\n`}(e)}\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n  <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <div class="miso-hybrid-search-combo__question-phrase">\n      <div class="miso-hybrid-search-combo__question-phrase-main">\n        <i>${tc}</i>\n        <span>${ac(e)}</span>\n      </div>\n      <a href="#miso-disclaimer" class="miso-hybrid-search-combo__learn-more">Learn more</a>\n    </div>\n    <miso-answer></miso-answer>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__sources-container miso-circled-citation-index" visible-when="ready !unanswerable" logo="false">\n    <h3 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">This answer is based on the following articles</h3>\n    <miso-sources></miso-sources>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__buttons-container miso-hidden" visible-when="!unanswerable">\n    <a class="miso-hybrid-search-combo__smart-answers-link" href="/smart-answers" target="_blank" rel="noopener nofollow">\n      <i>${ec}</i>\n      <span>Learn more with smart answers</span>\n    </a>\n    <miso-feedback></miso-feedback>\n  </ miso-hybrid-search>\n  \x3c!-- whitepaper --\x3e\n  \x3c!--\n  <miso-hybrid-search class="miso-hybrid-search-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n    <miso-affiliation></miso-affiliation>\n  </miso-hybrid-search>\n  --\x3e\n</section>\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__search-results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__search-results-container miso-circled-citation-index" visible-when="loading ready" logo="false">\n    <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__keywords-phrase">You searched for <miso-keywords></miso-keywords></div>\n    <div class="miso-hybrid-search-combo__search-results-info">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase">About <miso-total></miso-total> results</div>\n      <div class="miso-hybrid-search-combo__sort-dropdown">\n        Sort By <miso-sort>\n      </div>\n    </div>\n    <div class="miso-hybrid-search-combo__search-results-filters"></div>\n    <miso-products></miso-products>\n    <miso-more></miso-more>\n  </miso-hybrid-search>\n</section>\n${function(e){const{site:t}=e;let s;switch(t.key){case"computerworld":s="CW";break;case"networkworld":s="NWW";break;case"infoworld":s="IFW";break;default:s=t.name}return"cio"===t.key?'\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About</div>\n      <div class="miso-disclaimer__content">\n        <p>You deserve a better search experience -- and Smart Answers delivers.</p>\n        <p>Quickly find answers, discover the most relevant and timely content, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with <a href="https://miso.ai/" target="_blank" rel="noopener">Miso.ai</a>, Smart Answers draws only on editorial content from CIO.com and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  ':`\n    <section id="miso-disclaimer" class="miso-disclaimer miso-hidden">\n      <div class="miso-disclaimer__tilte">About ${s} Smart Answers AI</div>\n      <div class="miso-disclaimer__content">\n        <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you.</p>\n        <p>Developed in partnership with Miso.ai, Smart Answers draws only on editorial content from our network of trusted media brands<a href="https://www.cio.com/" target="_blank" rel="noopener">CIO</a>,<a href="https://www.computerworld.com/" target="_blank" rel="noopener">Computerworld</a>, <a href="https://www.csoonline.com/" target="_blank" rel="noopener">CSO</a>, <a href="https://www.infoworld.com/" target="_blank" rel="noopener">InfoWorld</a>, and<a href="https://www.networkworld.com/" target="_blank" rel="noopener">Network World</a>and was trained on questions that a savvy enterprise IT audience would ask. The result is a fast, efficient way for you to get more value from our content.</p>\n        <p>Get started by typing your query in the text box above. To go deeper, ask follow-on questions or read our story recommendations. Send your feedback to<a href="mailto:amy_bennett@foundryco.com">Amy Bennett</a>, editor-in-chief for Foundrys B2B brands.</p>\n      </div>\n    </section>\n  `}(e)}`.trim()}function oc(e){return`\n<miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n  <miso-query>\n    <div class="miso-search-box" data-role="query">\n      <div class="miso-search-box__input-group">\n        <span class="miso-search-box__input-icon">${sc}</span>\n        <textarea rows="1" class="miso-search-box__input" type="text" placeholder="What are you searching for?" autocomplete="off" data-role="input"></textarea>\n        <button class="miso-search-box__button" type="submit" data-role="submit">${ic}</button>\n      </div>\n      <div class="miso-autocomplete" data-role="autocomplete"></div>\n    </div>\n  </miso-query>\n</miso-hybrid-search>`.trim()}function ac(e){const{site:t}=e;return nc.question.replaceAll("${site}",t.name)}const cc=Object.freeze({ordered:!0,article:function(e,t,s,i){const{templates:n}=e,[r,o]=n.helpers.tagPair(e,s);return""+r+n.indexBlock(e,s,i)+uc(e,s)+o},infoBlock:uc});function uc({className:e},{title:t,created_at:s,updated_at:i,published_at:n,custom_attributes:r={}}){const o=be(r.site),a=n||s||i;let c="";t&&(c+=`<div class="${e}__item-title">${t}</div>`);const u=[];return o&&u.push(`<div class="${e}__item-site">${o.name}</div>`),a&&u.push(`<div class="${e}__item-date">${hc(a)}</div>`),u.length>0&&(c+=`<div class="${e}__item-supplementals">${u.join("&nbsp;&nbsp;&nbsp;&nbsp;")}</div>`),`<div class="${e}__item-info-container">${c}</div>`}const lc=Object.freeze({infoBlock:function({className:e},{title:t,snippet:s,description:i,authors:n,created_at:r,updated_at:o,published_at:a,custom_attributes:c={}}){be(c.site);const u=a||r||o;let l=`<div class="${e}__item-main-block">`;c.content_type&&(l+=`<div class="${e}__item-content-type">${c.content_type}</div>`);t&&(l+=`<div class="${e}__item-title">${t}</div>`);s?l+=`<div class="${e}__item-snippet">${s}</div>`:i&&(l+=`<div class="${e}__item-desc">${i}</div>`);l+=`</div><div class="${e}__item-supplementals-block">`,n&&(l+=`<div class="${e}__item-authors">By ${n}</div>`);u&&(l+=`<div class="${e}__item-date">${hc(u)}</div>`);return l+="</div>",`<div class="${e}__item-info-container">${l}</div>`}});function hc(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}const dc="textarea.miso-search-box__input";function _c(){const e=!this.value;e&&(this.value="What are you searching for?"),this.style.height="auto",this.style.height=this.scrollHeight-24+"px",e&&(this.value="")}function pc(){const e=document.querySelector(dc);e&&(e.addEventListener("keyup",_c),_c.call(e))}function mc(e){return`${o} AND custom_attributes.site:${e.site.key}`}function fc(e,{MisoClient:t,client:s,rootElement:i}){const{site:n,config:o}=e,a=s.ui.hybridSearch;a.autocomplete.enable(),a.useApi({_meta:b({site:n.key,user_geo:o.geo}),facets:["categories"],fq:mc(e),fl:r,source_fl:r}),a.useDataProcessor(function(e){const t=function({site:e}){return({url:t,...s})=>((t=new URL(t)).host=""+e.whitepaper_hostname,{url:Ec(t=""+t),...s})}(e);return({value:e,...s})=>{if(!e)return s;const{answer:i,sources:n=[],affiliation_products:r,products:o=[]}=e;return{value:{...e,answer:bc(i,n),sources:n.map(wc),affiliation_products:(r||[]).map(t),products:o.map(vc)},...s}}}(e)),a.useInteractions({preprocess:Ya(e)}),a.useFilters({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),a.useLayouts({sources:{templates:cc},products:{templates:lc,infiniteScroll:!1},more:{templates:{text:()=>"Show more"}}}),a.answer.on("request",(e=>{const t=new URL(window.location.href);t.searchParams.set("q",e.payload.q),window.history.replaceState({},"",t);const s=document.querySelector(".miso-hybrid-search-combo__smart-answers-link");s&&(s.href="/smart-answers?q="+encodeURIComponent(e.payload.q));document.querySelectorAll(".miso-hidden").forEach((e=>{e.classList.remove("miso-hidden")}));const i=document.querySelector("#miso-search.miso-hybrid-search-combo");i&&i.classList.add("miso-hybrid-search-combo__container--fired"),function(){const e=kc();e&&e.classList.add("miso-hybrid-search-combo__skeleton--show");Sc().forEach((e=>{e&&e.setAttribute("visible-when","done !unanswerable")}))}()})),a.answer.on("answer-stage",(e=>{"Generating summary"!==e.answer_stage&&"I cannot answer the question due to my system settings."!==e.data||function(){const e=kc();e&&e.classList.remove("miso-hybrid-search-combo__skeleton--show");Sc().forEach((e=>{e&&e.setAttribute("visible-when","ready !unanswerable")}))}()}));const c=document.createElement("div");c.id="miso-search",c.classList.add("miso-hybrid-search-combo"),i.insertAdjacentElement("afterend",c),i.remove(),(i=c).innerHTML=rc(e);const{wireAnswerBox:u}=t.ui.defaults.hybridSearch;u(s,i,{hideWhenUnanswerable:!1}),a.autoQuery(),setTimeout((()=>pc()),200)}function gc(e,t){if(!e)return e;if(!t)return Ec(e);const{origin:s}=new URL(e),{pathname:i}=new URL(t);return Ec(`${s}${i}`)}const yc=/\[\[(\d+)\]\]\((https?:\/\/[^\s)]+)\)/g;function bc(e,t){return e?e.replace(yc,((e,s,i)=>{const n=t.find((e=>e.url===i))||{custom_attributes:{}};return`[[${s}]](${gc(i,n.custom_attributes.contenthub_url)})`})):e}function wc({url:e,cover_image:t,custom_attributes:s,...i}){const{site:n,contenthub_url:r}=s;return{cover_image:t||be(n).logo_image,url:gc(e,r),custom_attributes:s,...i}}function vc({authors:e,url:t,custom_attributes:s,...i}){const{byline:n,contenthub_url:r}=s;return{authors:n?n.split(","):e,url:gc(t,r),custom_attributes:s,...i}}function Ec(e){return`${e}${0>e.indexOf("?")?"?":"&"}utm=hybrid_search`}function kc(){return document.querySelector(".miso-hybrid-search-combo__skeleton")}function Sc(){return[document.querySelector(".miso-hybrid-search-combo__answer-container"),document.querySelector(".miso-hybrid-search-combo__sources-container")]}const Ic="header #miso-search",Oc='.header__icon-button[data-menu-trigger="search"]',xc='.header__menu-link[data-menu-trigger="search"]';function Cc(e){const{searchParams:t}=new URL(window.location.href);return t.set("q",e),"/search/?"+t}async function Tc(e){const t=document.querySelector(Ic);if(!t)return;const i=[document.querySelector(Oc),document.querySelector(xc)];if(e.page.type===s)return void i.forEach((e=>{e&&e.addEventListener("click",(()=>{const e=document.querySelector('.button[data-menu-close="search"]');e&&e.click();const t=document.querySelector(".miso-search-box__input");t&&t.focus()}))}));const{client:n}=await Xa(),r=n.ui.hybridSearch;r.useLink(Cc,{open:!1}),r.autocomplete.enable(),t.classList.add("miso-hybrid-search-input"),t.innerHTML=oc(),pc()}const Ac="#miso-search";async function Rc(e){const t=function(){for(const e of document.querySelectorAll(Ac))if(!e.closest("header"))return e}();if(!t)return;const{MisoClient:s,client:i}=await Xa();fc(e,{MisoClient:s,client:i,rootElement:t})}(async e=>{e.page.type===s&&function(e){const{version:t,debug:s}=e;return window.miso_smart_answers_script_version?(console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version),!1):(window.miso_smart_answers_script_version=t,s("Miso Smart Answers script version: "+t),!0)}(e)&&await Promise.all([Rc(e),Tc(e)])})(Oe)}();
