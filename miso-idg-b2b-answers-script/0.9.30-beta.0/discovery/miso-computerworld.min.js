!function(){"use strict";const t="home",e="answers",s="article",n="other";var i="0.9.30-beta.0";var o=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const r={key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},a=window.location.hostname!==r.hostname;var c={...r,dev:a};function u(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const l=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),h=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var d=Object.freeze({__proto__:null,GROUP:l,NAME:h});function _(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function p(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function m(t){return null!=t?""+t:t}function f(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function g(t){return null==t}function y(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function b(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function v(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class w{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);E(s),E(n),E(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>k(this,t)),e):k(this,t),this._value=t}disconnect(){this._active=!1}}function k(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function E(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function C(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function x(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function I(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function O(t,{area:e=.5,duration:s=1e3,signal:n}={}){var i;return t="string"==typeof(i=t)?document.querySelector(i):i,new Promise(((i,o)=>{const r=new w((t=>{t&&(r.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{r.disconnect(),a.disconnect(),o(new DOMException("Aborted","AbortError"))}))}))}function R(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function S(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function A(t,e){const s=window.localStorage.getItem(t),n=function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,o=e.indexOf(";",i);return decodeURIComponent(0>o?e.substring(i):e.substring(i,o))}(t),i=s||n||""+e();return i&&!s&&window.localStorage.setItem(t,i),i&&!n&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i),i}function $(t){return new T(t)}class T{constructor(t){this._value=t;const e=t=>{this._value=t};b(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class N{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class q{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new N),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var U="1.10.2-beta.5";let P;try{P=document.currentScript}catch(t){}async function j(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(M(t))return;return new Promise((e=>{let s;s=setInterval((()=>{M(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function L(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${U}/dist/css/${t}.css`}function M(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function z(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function D(t,{depth:e=5,...s}={}){return B(t,e)}function B(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>B(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=B(i,e-1)))}return n}(t,e):t:"(...)"}const Q=100,F=4;function G(t){const e=function({speed:t=Q,acceleration:e=F}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const o=e(n,s);return t+Math.max(i-n,0)*o/1e3}}const W=Symbol.for("miso:resources");class V{constructor(){this._resources=new Map;const t=window[W]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){H(this._resources,t).resolve(e)}async get(t){return H(this._resources,t).promise}}function H(t,e){if(t.has(e))return t.get(e);const s=new N;return t.set(e,s),s}function K(){return window[W]||(window[W]=new V)}class Y{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new N;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class Z{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)_(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&_(s,e)}}_injectSubscribeInterface(t){y(t,this,["on","once"])}}function X(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class J{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:X(t,e),uuid:S()})}(t,e);b(this,{meta:s});const n=this._error=this._error.bind(this);(this._events=new Z({error:n,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(J,"miso:component");class tt extends J{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new N);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class et{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new w(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class st{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:nt}=document,it=nt.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/discovery$/,"");async function ot({}){await Promise.all([at()])}let rt=!1;async function at(){if(rt)return;if(rt=!0,!nt)throw Error("currentScript not found");const t=nt.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}function ct(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${it}/${t}`}const ut=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"}].map((({logo_image:t,...e})=>({logo_image:ct(t),...e})));ut.reduce(((t,e)=>(t[e.key]=e,t)),{});var lt=Object.freeze(function(){const i=(o=window.location.pathname).endsWith("/")?o.substring(0,o.length-1):o;var o;switch(i){case"":return{type:t};case"/smart-answers":return{type:e};default:if(c.regions.indexOf(i.substring(1))>=0)return{type:t}}const r=i.substring(1).split("/");if("article"===r[0]){const t=""+r[1];return{type:s,postId:t,product_id:`article_${c.key}_${t}`}}return{type:n}}());const ht="%cMiso",dt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const _t=[{key:"sap",name:"SAP",image:"image/sponsor/sap.svg"}];var pt=function(){if(o.sponsor)return _t.find((t=>t.key===o.sponsor))||void 0}(),mt=Object.freeze({__proto__:null,config:o,version:i,site:c,page:lt,sponsor:pt,debug:function(...t){!function(...t){console.log(ht,dt,...t)}(...t)}});const ft='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',gt='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',yt="miso-smart-answers";function bt({sponsor:t}){return t?`\n<div class="${yt}__sponsor">\n  <div class="${yt}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${yt}__sponsor-logo">\n    <img src="${ct(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}const vt="miso-smart-answers-discovery";function wt(t,e={}){return Et("article",function(t){return`\n<miso-explore visibleWhen="ready nonempty" class="${vt}__container">\n  ${function({site:t}){return`\n<div class="${vt}__hero">\n  <h2 class="${vt}__hero-title">${t.name} Smart Answers</h2>\n  <a class="${vt}__hero-info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a>\n</div>`.trim()}(t)}\n  ${bt(t)}\n  <div class="${vt}__header">\n    <a class="${vt}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow" title="What is this?">\n      <i>${gt}</i>\n    </a>\n    <h4 class="${vt}__title">Explore related questions</h4>\n  </div>\n  <div class="${vt}__body">\n    <miso-related-questions></miso-related-questions>\n    <miso-query>${`\n<div class="miso-search-box" data-role="query">\n  <div class="miso-search-box__input-group">\n    <input class="miso-search-box__input" type="text" data-role="input" placeholder="Ask a question">\n    <button class="miso-search-box__button" type="submit" data-role="button"><div class="miso-search-box__button-inner"><i>${ft}</i><span class="miso-search-box__button-text">Ask</span></div></button>\n  </div>  \n</div>`.trim()}</miso-query>\n  </div>\n</miso-explore>`.trim()}(t))}function kt(t,e={}){const s=Et("home",function(t){const{site:e}=t;return`\n<miso-explore visibleWhen="ready" class="${vt}__inner">\n  <h3 class="${vt}__title">${e.name} Smart Answers</h3>\n  ${bt(t)}\n  <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you. <a class="${vt}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a></p>\n  <miso-query class="${vt}__search-form">\n    <input class="${vt}__search-form-input" type="text" data-role="input" placeholder="Ask a question">\n    <button class="${vt}__search-form-submit" type="submit" data-role="button">\n      <i>${ft}</i>\n      <span class="${vt}__search-form-submit-text">Ask</span>\n    </button>\n  </miso-query>\n</miso-explore>`.trim()}(t),{classes:["container"]}),n=document.createElement("section");return n.classList.add(vt+"__section"),n.appendChild(s),n}function Et(t,e,{classes:s=[]}={}){const n=document.createElement("div");n.classList.add(vt),n.classList.add(`${vt}__${t}`);for(const t of s)n.classList.add(t);return n.innerHTML=e,n}var Ct="1.10.2-beta.5";const xt=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class It{constructor(t,e){this._client=t,this._root=e,this._bulk=new Y(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:o}={}){const{apiKey:r,request:a={}}=this._client.options;i=i||a.timeout,(o=o||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":r});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,f({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var d=Error(h.message);throw d.data=h,d.status=l.status,d}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:o,body:r}=n[e];o>=400||i?s.reject({status_code:o,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,o=t.filter((t=>t)).join("/"),r=`${this.getApiEndpoint(o)}/${o}`;return i?r:`${r}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=xt.DATA_ENDPOINT,eventEndpoint:s=xt.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const o of this._root._urlPasses)try{n=o({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){t.error(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const o of this._root._payloadPasses)try{n=o({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){t.error(e)}return n}}class Ot extends J{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,o=this._apiPath,r=this._url({apiGroup:o,apiName:t,payload:e,options:s}),a={apiGroup:o,apiName:t,payload:e=this._preprocess({apiGroup:o,apiName:t,payload:e,options:s}),url:r,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...o}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,o)}_postprocess({response:t}){return t.data}}const{GROUP:Rt,NAME:St}=d;class At extends Ot{constructor(t){super(t,Rt.INTERACTIONS)}async upload(t,e){try{return await this._run(St.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===St.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}const{GROUP:$t,NAME:Tt}=d;class Nt extends Ot{constructor(t){super(t,$t.ASK)}async questions(t,e={}){if("string"==typeof t&&"{"!==t.charAt(0))return new qt(this,{question_id:t},e);const s=await this._run(Tt.QUESTIONS,t,e);return new qt(this,s,e)}async _questions(t,e){return this._run(Tt.QUESTIONS,t,e)}async _get(t,e){return this._run(`${Tt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(Tt.RELATED_QUESTIONS,t,e)}}class qt{constructor(t,{question_id:e},s={}){this._api=t,this._questionId=e,this._ac=new AbortController,this._options=s}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,{...this._options,...t})}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new st(s);let o;e=u(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:o}={}){if(o&&o.aborted)return[];let r,a,c=0,u=!1;function l(){r&&clearInterval(r),u=!0}const h=new q;return r=setInterval((async()=>{let e,r,d;try{if([e,r,d]=await t(o?{signal:o}:{}),u||!g(a)&&a>=d)return;g(d)||(a=d),i&&i(e,r,d),c=0}catch(t){return n&&n(t),c++,void(c>s&&(l(),h.error(t)))}h.update(e,r),r&&l()}),e),o&&o.addEventListener&&o.addEventListener("abort",(()=>{l(),h.abort(o.reason)})),h}((async({}={})=>{const t=await this.get();return[t,t.finished,t.revision]}),{interval:t,signal:e,onResponse:(t,e)=>{var s,n;e?i.clear():(n=t,(s=o)&&s.answer_stage===n.answer_stage&&s.answer.length===n.answer.length||i.touch()),o=t},...n})[Symbol.asyncIterator]()}}const{GROUP:Ut,NAME:Pt}=d;class jt extends Ot{constructor(t){super(t,Ut.SEARCH)}async search(t,e){return this._run(Pt.SEARCH,t,e)}async autocomplete(t,e){return this._run(Pt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(Pt.MGET,t,e)}}const{GROUP:Lt,NAME:Mt}=d;class zt extends Ot{constructor(t){super(t,Lt.RECOMMENDATION)}async userToProducts(t,e){return this._run(Mt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(Mt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(Mt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(Mt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(Mt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(Mt.PRODUCT_TO_PRODUCTS,t,e)}}class Dt extends J{constructor(t,e){super("api",t),this._client=t,this.helpers=new It(t,e),this.interactions=new At(this),this.ask=new Nt(this),this.search=new jt(this),this.recommendation=new zt(this)}}var Bt=Object.freeze({__proto__:null,Api:Dt,ApiBase:Ot,ApiHelpers:It,Interactions:At,Ask:Nt,Search:jt,Recommendation:zt});class Qt extends J{constructor(t){super("context",t),this._client=t}}var Ft={api:Bt,context:{Context:Qt}};class Gt{constructor(t){b(this,{install:t})}}class Wt extends tt{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Vt(this,Ft),this.plugins=new Ht(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new N);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return b(n,{id:t}),this._tryConfig(n,e),n;case"function":return new Gt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,o=t.lastIndexOf("/",i)+1,r=t.indexOf(".",o),a=0>r?"":t.slice(r,i);return`${t.slice(0,o)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new K).get(s);!this.isRegistered(t)&&this.register(n)}}class Vt{constructor(t,e){y(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),b(this,{classes:e})}}class Ht{constructor(t){y(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Kt=new class extends J{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Wt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=Ct,this._cmdRes=new N}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Yt=Object.freeze({__proto__:null,viewable:O,debounce:z});const{currentScript:Zt}=document;class Xt extends J{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Xt),window.MisoClient?window.MisoClient!==Xt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Xt}static debug(){}constructor(t){super("client",Kt),this._config(t),this.context=new Qt(this),this.api=new Dt(this,Kt),function(t){Kt._clients.push(t),Kt._events.emit("create",t)}(this)}get version(){return Xt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,f(t)}_readConfigFromScriptUrl(){return f({apiKey:new URL(new Request(Zt.src||Zt.href).url).searchParams.get("api_key")||void 0})}}Xt.helpers=Yt,b(Xt,{uuid:S()});var Jt=function(t){const e=Kt._pluginRoot;return Kt.MisoClient=e.MisoClient=t,y(t,Kt,["version","instances","any","meta","on","once","cmdDone"]),y(t,e,["plugins"]),t}(Xt);const{GROUP:te,NAME:ee}=d;class se{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=A("miso_anonymous_id",S))}set anonymous_id(t){t=m(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=m(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function ne(){const t=new URLSearchParams(window.location.search);let e=f({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class ie{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function oe(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:Ct};return s.uuid||(s.uuid=S()),{...t,context:{...e,custom_context:s}}}const re="std:native-fetch";let ae,ce;const ue=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return ae="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),ae="borrowed",t.contentWindow.fetch}catch(t){ce=t}})();const le="miso-logdump",he="miso-logdump",de=he+"__download-btn",_e="Miso Log";class pe{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return ye||(ye=j(L("logdump")))}();let t=document.getElementById(le);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||_e,e.classList.add(de),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=le,t.classList.add(he),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(le),e=t&&t.querySelector("."+de);e&&(e.textContent=this._options.logDownloadButtonText||_e)}hideDownloadButton(){const t=document.getElementById(le);t&&(t.style.display="none")}download(){const t=new Blob([fe(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:me()})}return t&&"string"==typeof t?t:`miso-log.${me()}.jsonl`}clear(){this._logs=[]}}function me(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function fe(t){return t.map((t=>JSON.stringify(D(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),ge(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function ge(t){return t?D(t,{depth:2}):t}let ye;const be="std:debug";function ve(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}Jt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new pe(t)}static get id(){return be}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(be,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...o}){const r=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+r),"interactions"===e){const t=o.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...o,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(ve)):this._log(t,e,ve(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return re}install(t,e){ue?(e.setCustomFetch(ue),t.debug(`<plugin:${re}>`,"[info]",`Using ${ae} native fetch`)):t.debug(`<plugin:${re}>`,"[error]","Failed to obtain native fetch: "+ce.message)}}),Jt.plugins.use(class extends J{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new se(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return e===te.INTERACTIONS&&s===ee.UPLOAD?this._modifyPayloadForInteractions(t,n):e===te.ASK&&s===ee.QUESTIONS?this._modifyPayloadForAsk(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:o}=t.context,r=s?{user_id:s,user_hash:n}:{anonymous_id:o};return s&&i&&(r.user_type=i),{...r,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=f({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),Jt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...f({page:f({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:ne()}),...t.context}})))}}}),Jt.plugins.use(class extends J{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new ie(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===l.SEARCH)if(s===h.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Jt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(oe)}}});const we="data-miso-product-id",ke="default",Ee="_organic",Ce=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",ERROR:"error"}),xe=new Set([Ce.PRODUCTS,Ce.CATEGORIES,Ce.ATTRIBUTES,Ce.RESULTS,Ce.ITEMS,Ce.QUESTION,Ce.ANSWER,Ce.SOURCES,Ce.RELATED_RESOURCES,Ce.QUERY_SUGGESTIONS,Ce.RELATED_QUESTIONS,Ce.AFFILIATION]);function Ie(t){return xe.has(t)}const Oe=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",TEXT:"text",AFFILIATION:"affiliation",ERROR:"error"}),Re=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit"}),Se=[Re.IMPRESSION,Re.VIEWABLE,Re.CLICK,Re.SUBMIT],Ae=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),$e=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function Te(t){if(0>Se.indexOf(t))throw Error("Unrecognized event type: "+t)}function Ne(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function qe(t){if(void 0===t)return;let[e,s]=p(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function Ue(t){t=p(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t}function Pe(...t){return!1!==t[t.length-1]&&Xe(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...je("_meta",s,n)})});var s,n}))}function je(t,e,s){const n=e&&e[t],i=s&&s[t],o=n?i?{...n,...i}:n:i;return void 0!==o?{[t]:o}:{}}function Le(...t){return!1!==t[t.length-1]&&Xe(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=Me(t[s],n);return t}))}function Me(t,e){return!1===(e=qe(e))[0]?e:t&&e?[e[0]||t[0],ze(t[1],e[1])]:e||t}function ze(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function De(...t){return t.flat().filter(Boolean)}function Be(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function Qe(...t){return!1!==t[t.length-1]&&Xe(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}const Fe=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return f({group:s,name:t,payload:e})},merge:Pe},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[Ce.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[Ce.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Ce.PRODUCTS]}: ... }) instead`),t={...s,[Ce.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[Ne(e)]=qe(s);return n},merge:Le},{key:"dataProcessor",normalize:Ue,merge:De},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&Xe(t,((t,e)=>Object.assign(t,{...e,impression:Be(t.impression,e.impression),viewable:Be(t.viewable,e.viewable),click:Be(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=p(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:Qe},{key:"autocomplete",normalize:function(t){if(void 0===t)throw Error("Expect autocomplete options to be an object or a boolean value: "+t);"boolean"==typeof t&&(t={actor:t});const e=Ue(t.processData);return{...t,processData:e}},merge:function(...t){return!1!==t[t.length-1]&&Xe(t,((t,e)=>Object.assign(t,{...e,api:Pe(t.api,e.api),processData:De(t.processData,e.processData)})))}}];class Ge{constructor(){this._events=new Z({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class We{constructor(t={},e={}){this._events=new Z({target:this}),this._defaults=e,this._context=t||{},this._locals={},b(this,{resolved:new He(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ve{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}class He{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of Fe)Object.defineProperty(Ge.prototype,t,{get:function(){const n="_"+t;return this[n]||(this[n]=new Ve(this,this._globals,t,e,s))}}),Object.defineProperty(We.prototype,t,{get:function(){const n="_"+t;return this[n]||(this[n]=new Ve(this,this._locals,t,e,s))}}),Object.defineProperty(He.prototype,t,{get:function(){const e=this._options,n=e._context[t];return s(e._defaults[t],n&&n.get(),e._locals[t])}});const Ke=["api","layouts","dataProcessor","trackers","interactions"];function Ye(t,e=Ke){for(const s of e)Ze(t,s)}function Ze(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}function Xe(t,e){let s={};for(const n of t)n&&(s=e(s,n));return f(s)}class Je extends J{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Ge}}function ts(){return"data"}function es(t){return t?"view:"+t:"view"}Ye(Je.prototype);class ss{constructor(){(this._events=new Z)._injectSubscribeInterface(this),this._states={},b(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class ns{constructor(t){this._hub=t,this._sessionIndex=0,y(t,this,["active"])}get active(){const{session:t}=this._hub.states;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this.new({force:!0}),this.start()}_create(){return Object.freeze({active:!1,uuid:S(),index:this._sessionIndex++,meta:{}})}}const is=new Set([Ce.PRODUCTS,Ce.SOURCES,Ce.RELATED_RESOURCES]);function os({property:t,misoId:e,request:s},{event:n,values:i,manual:o}){const r=s&&s._meta&&s._meta.question_source,a=function(t){return is.has(t)}(t),c=n===Re.SUBMIT,u=t===Ce.AFFILIATION,l=a&&i?i.map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t)):c?void 0:[],h=a||c||!i?void 0:i.map((t=>t.text||t.id||t));return f({type:"viewable"===n?"viewable_impression":n,product_ids:l,miso_id:e,context:{custom_context:f({property:t,channel:u?i[0]&&i[0].channel:void 0,items:h,value:c?i:void 0,positions:u?i.map((t=>t.position)):void 0,trigger:o?"manual":"auto",question_source:r})}})}function rs(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class as{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},o=await this._source({session:e,...t,options:i});if(o&&o[Symbol.asyncIterator]){let t;for await(t of o){if(!rs(this._hub,e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:o})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){rs(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class cs{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{_(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:us,VIEWABLE:ls,CLICK:hs}=Re,{UNTRACKED:ds,TRIGGERED:_s}=Ae,ps=Object.freeze({[us]:ds,[ls]:ds,[hs]:ds});class ms{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:ps}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||ds}set(t,e,s){Te(e),function(t){if(t!==Ae.UNTRACKED&&t!==Ae.TRACKING&&t!==Ae.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of p(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==_s))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...ps}))))[e]=s}}const fs=[Symbol("valueless")];class gs{constructor({hub:t,role:e,valueless:s=!1,options:n}){this._hub=t,this._role=e,this._valueless=!!s,this._options=n,this._states=new ms(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s={}){if(this._valueless&&(s=e,e=fs),Te(t),this._syncSession(),t!==Re.SUBMIT){if(0===(e=this._states.untriggered(p(e),t)).length)return;this._states.set(e,t,Ae.TRIGGERED)}const n="results"===this._role?"products":this._role,i=this._getMisoId(),o=this._getRequestPayload();this._hub.trigger("interaction",os({property:n,misoId:i,request:o},{event:t,values:this._valueless?void 0:e,meta:s}))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new ms(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[es(this._role)]}}for(const t of Se)gs.prototype[t]=function(e,s){this._trigger(t,e,s)};class ys{constructor(t,e){this._events=new Z({target:this}),this._views=t,b(this,{role:e,interface:new bs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new cs((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===Ce.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new gs({hub:e,role:t,options:()=>this._getTrackerOptions()})}return this._tracker}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:i,status:o,ongoing:r,request:a,meta:c}=e;if(!t&&!(i&&i.active))return;if(!t&&((u=e)===(l=n)||u&&l&&u.status===l.status&&u.error===l.error&&u.value===l.value&&u.ongoing===l.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(u.session,l.session)))return;var u,l;const h=(t={},e)=>{!1!==t&&this.updateState({session:i,status:o,ongoing:r,request:a,meta:c,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState({session:t,status:e,ongoing:s,request:n,meta:i,error:o},{silent:r=!1}={}){o&&(e=$e.ERRONEOUS);const a=this._state=Object.freeze(f({session:t,status:e,ongoing:s,request:n,meta:i,error:o})),{role:c}=this;this.hub.update(es(c),a,{silent:r})}_getTrackerOptions(){return this._views._getTrackerOptions(this.role)}_sliceData({value:t,error:e,status:s,meta:n,...i}){const o={value:this.role===Ce.ERROR?e:t&&t[this.role],status:s,data:t,meta:n,...i};return this.role===Ce.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(t)}),f(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!Ie(s))return!1;let e=t&&t[s];if(s===Ce.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class bs{constructor(t){y(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}const vs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function ws(t,e){return!!e&&{...t,...e}}class ks{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i=[],options:o}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=o,this._containers=new Map,this._containerTracker=void 0,this._views={},this._trackers=new Cs(this,i);for(const t of i)this._views[t]=new ys(this,t);b(this,{interface:new Es(this)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on(ts(),(()=>this.refresh())),o.on("trackers",(()=>this._syncTrackers())),o.on("layouts",(()=>this._syncLayouts()))],this._syncTrackers(),this._syncLayouts()}get trackers(){return this._trackers}addContainer(t){if(this._containers.has(t))return;const e=new ys(this,Ce.CONTAINER);e.layout=this._createLayout(Ce.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===Ce.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new ys(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t}={}){const e=this._getData();await Promise.all(this._getViews(!0).map((s=>s.refresh({force:t,data:e}))))}_getData(){const{[ts()]:t}=this._hub.states;if(!this._data||this._data.data!==t){const e=t&&t.session&&t.session.active?t.error?$e.ERRONEOUS:t.value?$e.READY:$e.LOADING:$e.INITIAL,s=e===$e.READY?!!t.ongoing:void 0;this._data=Object.freeze({...t,status:e,ongoing:s})}return this._data}_syncTrackers(){this._trackerOptions=this._options.resolved.trackers}_getTrackerOptions(t){return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return f({...vs,...i,impression:ws(vs.impression,e),viewable:ws(vs.viewable,s),click:ws(vs.click,n)})}(this._trackerOptions&&this._trackerOptions[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=Ce.CONTAINER;this._containerTracker=new gs({hub:this._hub,role:t,valueless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Es{constructor(t){this._actor=t,y(this,t,["syncSize","refresh","trackers"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class Cs{constructor(t,e){this._views=t;for(const s of e)Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,Ce.CONTAINER,{get:()=>t._getContainerTracker()})}}class xs{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[ts()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};if(!s)return;const{request:n}=e||{},{payload:i}=n||{};this._hub.trigger("interaction",this._buildInteraction(t,{question_source:i&&i._meta&&i._meta.question_source}))}_buildInteraction({value:t,unselected:e},{question_source:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_source:s,value:e?"unselected":t}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Is{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._index=-1,this._unsubscribes=[t.on("input",(()=>this._sync())),s.on("autocomplete",(()=>this._syncOptions()))],this._sync(!0)}get active(){return!1!==this._options.resolved.autocomplete.actor}get source(){return this._source}_syncOptions(){this._sync(!0)}async _sync(t=!1){if(!this.active)return;const{input:e}=this._hub.states,s=e&&e.value&&e.value.trim()||void 0;if(i=e,(!(n=this._input)&&!i||n&&i&&n.value===i.value)&&!t)return;var n,i;this._input=e;const o=++this._index;if(this._clearTimeout(),this._abortPendingRequest({type:"new-input",message:"A new input renders previous autocomplete request obsolete."}),this._emitCompletions({index:o,input:e,status:s?$e.LOADING:$e.INITIAL}),s)try{const t=await this._fetchCompletions(e);if(this._index!==o)return;this._emitCompletions({index:o,input:e,status:$e.READY,value:t.completions})}catch(t){if(this._error(t),this._index!==o)return;this._emitCompletions({index:o,input:e,status:$e.ERRONEOUS,error:t})}}async _getCompletions(t){return await this._fetchCompletions(t)}async _fetchCompletions({value:t}){const{api:e}=this._options.resolved.autocomplete,{group:s,name:n}=e,{signal:i}=this._ac||{},o={...e.options,signal:i},r={...e.payload,q:t};return await this._source({group:s,name:n,payload:r,options:o})}_clearTimeout(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}_abortPendingRequest(t){this._ac&&this._ac.abort(t),this._ac=new AbortController}_emitCompletions(t){t.source="actor",this._hub.update("completions",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"autocomplete-actor-destroy",message:"Autocomplete actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Os{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=p(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function Rs(t){return async({group:e,name:s,payload:n,options:i})=>e===l.ASK&&s===h.QUESTIONS?t.api.ask.questions(n,i):t.api[e]._run(s,n,i)}class Ss{constructor({role:t,workflow:e,...s}={}){b(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=$(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,I((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),o=$([]),r=$({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:o.args,writeToState:r.merge,...e}),this._rendered.set(this._element,Object.freeze({...s,...r.value})),n&&n(...o.value)}_render(){throw Error("Unimplemented")}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function As(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function $s(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||qs)(t,e,s)+(i.descriptionBlock||Ps)(t,e,s)+(i.priceBlock||Ls)(t,e,s)+(i.ctaBlock||Bs)(t,e,s)}</div>`}function Ts(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||qs)(t,e,s)+(i.descriptionBlock||Ps)(t,e,s)+(i.priceBlock||Ls)(t,e,s)}</div>`}function Ns(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||qs)(t,e,s)+(i.dateBlock||js)(t,e,s)+(i.descriptionBlock||Ps)(t,e,s)+(i.ctaBlock||Bs)(t,e,s)}</div>`}function qs({className:t},{title:e}){return e?`<div class="${t}__item-title">${R(e)}</div>`:""}function Us({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ps({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${R(s)}</div>`:""}function js({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const o=i||s||n;return o?`<div class="${t}__item-date">${Gs(o,e.date)}</div>`:""}function Ls(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:o,currency:r="USD"}=e,a=i||o;if(!a)return"";const c=void 0!==o&&void 0!==i&&o>i,u=e.discount_rate_percent||(c?Math.floor(100*(1-i/o)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${o}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||Ms)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Ms(t,{discount_rate_percent:e}){return`(${e}% off)`}function zs(t,e,s){const{className:n,templates:i}=t,{cover_image:o}=e;if(!o)return"";return`<div class="${n}__item-cover-image-container">${`<img class="${n}__item-cover-image" src="${o}">`}${s.brand?(i.brandBlock||Us)(t,e,s):""}</div>`}function Ds({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Bs(t,e,s){const{className:n,templates:i}=t,o=Ws.asFunction(i.cta)(t,e,s);return o?`<div class="${n}__item-cta-container">${o}</div>`:""}function Qs({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:o="item",...r}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==r.link&&n?"a":"div";return[`<${l} class="${t}__${i}" ${o?`data-role="${o}"`:""} ${s?`${we}="${s}"`:""} ${!1!==r.link&&n?`href="${n}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const Fs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"});function Gs(t,e=Fs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Fs.locale,e);default:throw Error("Invalid date format: "+e)}}const Ws=Object.freeze({tagPair:Qs,formatDate:Gs,escapeHtml:R,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Vs extends Ss{constructor({className:t,templates:e,...s}={}){super(s),b(this,{className:t,templates:{...As("root"),...e}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Hs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Hs.MisoClient.ui.layouts.create("banner").render(this)}}class Ks{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await O(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Ys extends Ss{static get category(){return Oe.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ks}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_syncBanner(t){const e=Hs.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===Ce.PRODUCTS||t===Ce.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:o=!1}={}}=e,r=[s,o?$e.EMPTY:$e.NONEMPTY];s===$e.READY&&r.push(n?$e.ONGOING:$e.DONE),t.setAttribute("status",r.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,{state:e}){const{status:s}=e;s===$e.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Zs=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:o}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,o)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Xs extends Vs{static get category(){return Oe.ERROR}static get type(){return"error"}static get defaultTemplates(){return Zs}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Zs,...e},...s})}}const Js=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function tn(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class en{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,o=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],u=Object.freeze({index:r,key:a,value:e[r],element:c});n.set(a,u),i.set(c,u),o.push(u)}return{k2b:n,e2b:i,entries:o}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},o=tn(i,n),r=tn(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:o,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function sn(t){!function(t,e){const s=Object.getOwnPropertyDescriptors(e);for(const e in s){if("constructor"===e)continue;const{value:n}=s[e];void 0===t[e]&&"function"==typeof n&&(t[e]=n)}}(t,nn.prototype)}class nn{_initTrackable(){this._bindings=new en,this._viewables=new Ks}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:o,unbounds:r}=this._bindings.update(n,s,i);this._onBindingsUpdate(o,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!C(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}const on=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[o,r]=Qs(t,s);return""+o+(i.imageBlock||zs)(t,s,n)+(i.infoBlock||i.productInfoBlock||Ts)(t,s,n)+r},article:function(t,e,s,n){const{templates:i}=t,[o,r]=Qs(t,s);return""+o+(i.imageBlock||zs)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Ns)(t,s,n)+(i.indexBlock||Ds)(t,s,n)+r},question:function(t,e,s){const[n,i]=Qs(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i}=t,{status:o}=e;return`<div class="${s} ${o}" ${n?`data-role="${n}"`:""}>${o===$e.READY?i[o](t,e):""}</div>`},[$e.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0||e.ongoing?s.list(t,e,n):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:n,templates:i,options:o}=t,r=i.ordered?"ol":"ul";return`<${r} class="${n}__list" data-role="list" data-item-type="${o.itemType}">${i.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let o=n;return s.map((s=>i.item(t,e,s,o++))).join("")},item:function(t,e,s,n){const{className:i,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${i}__item">${o[a](t,e,s,{index:n})}</li>`},productInfoBlock:Ts,articleInfoBlock:Ns,brandBlock:Us,titleBlock:qs,descriptionBlock:Ps,dateBlock:js,priceBlock:Ls,discountRateText:Ms,ctaBlock:Bs,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[o,r]=Qs(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=Ws.asFunction(n.ctaText)(t,e,s);return a?`${o}${a}${r}`:""},imageBlock:zs,indexBlock:Ds,helpers:Ws});class rn extends Vs{static get category(){return Oe.LIST}static get defaultTemplates(){return on}constructor({templates:t,itemType:e="product",...s}){super({templates:{...on,...t},itemType:e,...s}),this._initTrackable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===$e.READY&&e.status===$e.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i;this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}sn(rn.prototype);const an="miso-list";class cn extends rn{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return an}constructor({className:t=an,...e}={}){super({className:t,...e})}}const un="miso-cards";const ln="miso-carousel",hn=Object.freeze({ready:function(t,e){const{templates:s}=t,n=t._getItems(e),i=n&&n.length>0,o=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,o):o},carousel:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-previous" data-role="previous">${i.previous(t,e)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(t,e)}</div>`},previous:_n,next:_n}),dn=Object.freeze({...rn.defaultTemplates,...hn});function _n(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const pn="miso-ui-icon",mn=pn+"-svg-1_10_2-beta_5",fn=`<symbol id="${pn}-send" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,gn=`<symbol id="${pn}-search" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,yn=`<symbol id="${pn}-triangle" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,bn=`<svg id="${mn}" style="display:none;">${[fn,gn,yn].join("")}</svg>`;let vn=!1;function wn(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${pn}-${t}"></use></svg>`}vn||document.head.querySelector("#"+mn)||(vn=!0,document.head.insertAdjacentHTML("beforeend",bn));const kn=wn("send"),En=wn("search"),Cn=wn("triangle"),xn="miso-search-box";const In=Object.freeze({root:function(t){const{className:e,role:s,options:n,workflow:i,autocomplete:o}=t,{placeholder:r,buttonText:a}=n;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${a||"search"===i?En:kn}</button>\n  </div>\n  <div class="${o.className}" data-role="autocomplete"></div>\n</div>`.trim()},completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const o=[],r=[];for(const t of e)(t.product?o:r).push(t);return s.queries(t,r)+(r.length>0&&o.length>0?"<hr>":"")+s.products(t,o)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`\n<ul class="${n}__${e}-list" data-role="${e}-list">\n  ${s.map((s=>i.completionItem(t,e,s))).join("")}\n</ul>`.trim()},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||R(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=Ws.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:zs,productInfoBlock:Ts,helpers:Ws}),On=Object.freeze({className:"miso-autocomplete",debounce:300});class Rn extends Vs{static get category(){return Oe.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return In}static get defaultClassName(){return xn}constructor({className:t=xn,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...In,...e},...n}),b(this,{autocomplete:{...On,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=z(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t)))],this._unsubscribes.push(s.on("completions",(()=>t.refresh({force:!0}))))}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=$e.INITIAL,index:o,value:r}=e.completions;if(s&&s.completions.index===o&&s.completions.status===i)return;const a=this._context(t),{autocompleteElement:c}=a;if(!c)return;const u=a.trackItems(r);t.classList[u.length>0?"add":"remove"]("nonempty"),c.setAttribute("data-status",i),c.innerHTML=this.templates.completions(this,u),n({completions:{index:o,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Sn.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Sn(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&C(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),o=i&&i.text;return o&&(s&&(s.value=o),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(o)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.trigger("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[Re.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit(t)}}class Sn{static empty(){return Sn._empty||(Sn._empty=new Sn)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const o of t[i])o.product&&!o.product.url||(o._index=e,o._field=i,s.set(e,o),n.push(o),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const An="miso-option-list";const $n=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${R(e.text||e)}</li>`}});class Tn extends Vs{static get category(){return Oe.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return $n}static get defaultClassName(){return An}constructor({className:t=An,templates:e,...s}={}){super({className:t,templates:{...$n,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncBindings(t,n),this._syncOptionValues(t,n)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const n=this._getItems(e)||[];s.classList[0===n.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._submit(n.text))}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}sn(Tn.prototype);const Nn=Object.freeze({...As("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class qn extends Vs{static get category(){return Oe.RADIO}static get defaultTemplates(){return Nn}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...Nn,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=C(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],I((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Un="miso-feedback",Pn=["helpful","unhelpful"];const jn=Object.freeze({options:function(t){const{templates:e}=t;return Pn.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Ln extends qn{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return jn}static get defaultClassName(){return Un}constructor({className:t=Un,templates:e,...s}={}){if(super({className:t,templates:{...jn,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Mn="miso-text";const zn=Object.freeze({root:function(t,e){const{className:s,role:n,options:{tag:i}}=t;return`<${i} class="${s}" ${n?`data-role="${n}"`:""}>${R(e.value||"")}</${i}>`}});class Dn extends Vs{static get category(){return Oe.TEXT}static get type(){return"text"}static get defaultTemplates(){return zn}static get defaultClassName(){return Mn}constructor({className:t=Mn,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...zn,...e},tag:s,...n})}}class Bn extends Ss{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=$(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class Qn{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:o}){const r=n.length;i=Math.min(i,r);const a=!!o&&i===r,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function Fn(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:o=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,Gn(e)];o&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${r} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||$e.INITIAL),n}function Gn(t){return t+"__cursor"}function Wn(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:o,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${Vn(n[0])}, ${Vn(n[1])})`,e,""+o,i,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function Vn(t){return Math.floor(100*t)/100+"ms"}const Hn="miso-typewriter";class Kn extends Bn{static get category(){return Oe.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return Hn}constructor({className:t=Hn,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:o,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:n,...a}),b(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:G({speed:i,acceleration:o}),this._readiness=new N,"markdown"===s&&Kn.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown"),e=Gn(this.className),{onDebug:s,onCitationLink:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:Wn(s)}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new Qn}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:o,ongoing:r}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,d=c&&e&&e.doneAt||(o!==$e.READY||r?void 0:Date.now());return this._prevState=Object.freeze(f({session:i,status:o,value:s,stage:a,streak:h,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:o}){const r=Fn(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}else a=this._renderer.clear(r,s);i(a);const c=e.status===$e.READY&&!a.done;n({ongoing:c},{silent:c&&(!s||s.status===$e.READY)}),c&&o()}_onClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}const Yn="miso-affiliation";const Zn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,{status:o}=e,r=n?` data-role="${n}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${o}"${r}${c}${void 0!==l?` data-item-count="${l}"`:""}>${o===$e.READY?i[o](t,e):""}</div>`},[$e.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Cn},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:o,options:r}=t,{itemType:a}=r;return`<li class="${i}__item"><div class="${i}__item-inner">${o.itemHeader(t,e,s,{index:n})}${o[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:o}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=o;return r=Ws.asFunction(r)(t,e,s,n),a=Ws.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${r}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[o,r]=Qs(t,s,{link:!1});return""+o+(i.infoBlock||i.affiliationInfoBlock||$s)(t,s,n)+(i.imageBlock||zs)(t,s,{brand:!0,...n})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:o}=t,r=Ws.asFunction(o.logoText)(t,e,s,n)||"",a=Ws.asFunction(o.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:o}=t,r=Ws.asFunction(o.logoUrl)(t,e,s,n);if(!r)return"";const a=Ws.asFunction(o.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),Xn=Object.freeze({...rn.defaultTemplates,...Zn});class Jn extends rn{static get category(){return Oe.AFFILIATION}static get type(){return"affiliation"}static get defaultTemplates(){return Xn}static get defaultClassName(){return Yn}constructor({className:t=Yn,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...Zn,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new et(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,I((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(this._displayedCount=s,void 0===s?n.removeAttribute("data-item-count"):n.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}var ti=Object.freeze({__proto__:null,TemplateBasedLayout:Vs,ContainerLayout:Ys,ErrorLayout:Xs,BannerLayout:class extends Vs{static get category(){return Oe.BANNER}static get type(){return"banner"}static get defaultTemplates(){return Js}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Js,...e},...s})}},CollectionLayout:rn,ListLayout:cn,CardsLayout:class extends rn{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return un}constructor({className:t=un,...e}={}){super({className:t,...e})}},CarouselLayout:class extends rn{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return dn}static get defaultClassName(){return ln}constructor({className:t=ln,templates:e,...s}={}){super({className:t,templates:{...hn,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:n}=e,i=this._getItems(n);this._itemCount=i?i.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:Rn,OptionListLayout:Tn,FeedbackLayout:Ln,TextLayout:Dn,TypewriterLayout:Kn,AffiliationLayout:Jn});const ei=Object.freeze({[Ce.CONTAINER]:Ys.type,[Ce.ERROR]:Xs.type});function si(t){return t&&t.value&&t.value.revision}class ni extends J{constructor({name:t,context:e,plugin:s,client:n,roles:i,defaults:o}){super(t||"workflow",s),this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,this._name=t,this._roles=i;const r=this._extensions=s._getExtensions(n),a=this._options=new We(e&&e._options,function(t,{layouts:e,interactions:s,...n}={}){const i={preprocess:[e=>t._preprocessInteraction(e)]};return{...n,layouts:Le(ei,e),interactions:Qe(i,s)}}(this,o)),c=this._hub=function(t,e){const{update:s,trigger:n}=t;return t.update=(n,i,o)=>(o&&o.silent||e("update",n,i,o),s.call(t,n,i,o)),t.trigger=(...s)=>(e("trigger",...s),n.apply(t,s)),t}(new ss,((...t)=>this._log(...t))),u=s.layouts;this._sessions=new ns(c),this._data=new as(c,{source:Rs(n),options:a}),this._views=new ks(c,{extensions:r,layouts:u,roles:i,options:a,workflow:t}),this._interactions=new Os(c,{client:n,options:a}),this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t)))]}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this.reset(),this.start(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=si(t);if(!g(s)){const t=si(this._hub.states[ts()]);if(!g(t)&&t>=s)return}this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);return this._hub.update(ts(),t),this}_defaultProcessData(t){const{value:e}=t;return e&&e.miso_id?{...t,meta:{...t.meta,miso_id:e.miso_id}}:t}notifyViewUpdate(t,e){return this._assertActive(),e={status:$e.READY,session:this.session,...e},this._hub.update(es(t),e),this}get trackers(){return this._views.trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:n,name:i}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:n,api_name:i,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}function ii(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:oi(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function oi({products:t,...e}){return{channel:"sovrn",...e,products:t.map(ri)}}function ri({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:o,salePrice:r,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return f({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:o,sale_price:r,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:ai({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function ai(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const o=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...ai(i,o)}:{...s,[o]:i}}),{})}Ye(ni.prototype);const ci=Object.freeze({group:l.ASK,name:h.QUESTIONS,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),ui=Object.freeze({actor:!1,api:{group:l.ASK,name:h.AUTOCOMPLETE}}),li=Object.freeze({[Ce.QUERY]:[Rn.type,{placeholder:"Ask a question"}],[Ce.QUESTION]:[Dn.type,{tag:"h2"}],[Ce.ANSWER]:Kn.type,[Ce.FEEDBACK]:Ln.type,[Ce.SOURCES]:[cn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Ce.RELATED_RESOURCES]:[cn.type,{incremental:!0,itemType:"article"}],[Ce.QUERY_SUGGESTIONS]:Tn.type,[Ce.AFFILIATION]:[Jn.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),hi=Object.freeze({[Ce.SOURCES]:{},[Ce.RELATED_RESOURCES]:{},[Ce.AFFILIATION]:{},[Ce.QUERY_SUGGESTIONS]:{click:{validate:t=>0===t.button}}}),di=Object.freeze({api:ci,autocomplete:ui,layouts:li,trackers:hi});class _i extends ni{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(li),defaults:di}),this._context=t,this._autoQuery=!1,b(this,{parentQuestionId:e}),this._feedback=new xs(this._hub),this._setSuggestedQuestions(),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this.query(t))),this._hub.on(es(Ce.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Ce.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))],e&&t._byPqid.set(e,this),t._events.emit("create",this),this.reset()}get questionId(){return this._questionId}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,n=new URLSearchParams(window.location.search),i=n.get("q"),o=n.get("qs"),{layout:r}=this._views.get(Ce.QUERY);r&&(i&&e&&(r.value=i),!i&&s&&r.focus()),i&&this.query({q:i,qs:o})}query({q:t,qs:e,...s}={}){s={...s,question:t},e=e||Ee,this.parentQuestionId&&(s.parent_question_id=this.parentQuestionId),(s._meta||(s._meta={})).question_source=e,this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0),this.restart();const{session:n}=this;return n.meta.question_source=e,this._hub.update("request",Pe(this._options.resolved.api,{payload:s,session:n})),this}restart(){const{session:t,status:e,ongoing:s}=this._hub.states[es(Ce.ANSWER)]||{};if(t&&e!==$e.INITIAL&&(e!==$e.READY||s)){const n=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",n),this._emit("finally",n)}super.restart()}_defaultProcessData(t){t=super._defaultProcessData(t);const{value:e,request:s}=t;if(!e)return t;const{question_id:n,question:i}=e,o=s&&s.payload&&s.payload._meta&&s.payload._meta.question_source===Ee;if(!this._questionId&&n&&(this._questionId=n,this._context._byQid.set(n,this)),this._autoQuery&&!1!==this._autoQuery.updateUrl){const t=new URL(window.location);i===t.searchParams.get("q")||o&&!0!==this._autoQuery.updateUrl||(t.searchParams.set("q",i),window.history.replaceState({},"",t))}return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:ii(e)}}(t),{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:e.answer_stage}}}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===$e.INITIAL)return;const n=e===$e.READY&&!s,i=e===$e.ERRONEOUS,o=n?"done":i?"error":e,r=Object.freeze({session:t,status:e,ongoing:s});this._emit(o,r),(n||i)&&this._emit("finally",r)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[ts()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_onCitationClick({index:t}){const{value:e}=this.states[ts()]||{},{sources:s}=e||{},n=s&&s[t-1];n&&n.product_id&&this._trackers.sources.click([n.product_id],{manual:!1})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;let{rootQuestionId:n,parentQuestionId:i,questionId:o}=this;return s.property===Ce.QUERY_SUGGESTIONS&&(o=i,i=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions",s.question_source=this.previous&&this.previous.session.meta.question_source),t.context={...e,custom_context:f({root_question_id:n,parent_question_id:i,question_id:o,...s})},t}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),this._feedback._destroy(),super._destroy(t)}}class pi extends Je{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new _i(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new _i(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const mi=Object.freeze({group:l.ASK,name:h.RELATED_QUESTIONS}),fi=Object.freeze({[Ce.RELATED_QUESTIONS]:[cn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Ce.QUERY]:[Rn.type,{placeholder:"Ask a question"}]}),gi=Object.freeze({[Ce.RELATED_QUESTIONS]:{},[Ce.CONTAINER]:{},[Ce.QUERY]:{[Re.SUBMIT]:{}}}),yi=Object.freeze({api:mi,layouts:fi,trackers:gi});class bi extends ni{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(fi),defaults:yi}),this._productId=void 0,this._linkFn=void 0,this._unsubscribes=[...this._unsubscribes,this._views.get(Ce.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start({relatedQuestions:t=!0}={}){if(t&&void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:e}=this;return t?this._hub.update("request",Pe(this._options.resolved.api,{session:e})):this.updateData({session:e,value:{related_questions:[]}}),this}notifyViewUpdate(t=Ce.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._getAnswersUrl(t,!0)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._getAnswersUrl(t);window.open(e,"_blank")}_getAnswersUrl(t,e=!1){if(!this._linkFn)return;const s=this._linkFn(t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}const vi=Object.freeze({group:l.SEARCH,name:h.SEARCH,payload:{fl:["*"]}}),wi=Object.freeze({actor:!1,api:{group:l.SEARCH,name:h.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}},throttle:300}),ki=Object.freeze({[Ce.QUERY]:Rn.type,[Ce.PRODUCTS]:cn.type}),Ei=Object.freeze({[Ce.PRODUCTS]:{}}),Ci=Object.freeze({api:vi,autocomplete:wi,layouts:ki,trackers:Ei});class xi extends ni{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(ki),defaults:Ci}),this._autocomplete=new Is(this._hub,{source:Rs(this._client),options:this._options}),this._unsubscribes.push(this._hub.on("query",(t=>this.query(t))))}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:n}=this._views.get(Ce.QUERY);n&&(s&&t&&(n.value=s),!s&&e&&n.focus()),s&&this.query({q:s})}query(t){this.restart();const{session:e}=this;return this._hub.update("request",Pe(this._options.resolved.api,{payload:t,session:e})),this}updateCompletions(t){return this._hub.update("completions",{...t,source:"manual"}),this}notifyViewUpdate(t=Ce.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}Ye(xi.prototype,["autocomplete"]);const Ii=Object.freeze({group:l.RECOMMENDATION,name:h.USER_TO_PRODUCTS,payload:{fl:["*"]}}),Oi=Object.freeze({[Ce.PRODUCTS]:cn.type}),Ri=Object.freeze({[Ce.PRODUCTS]:{}}),Si=Object.freeze({api:Ii,layouts:Oi,trackers:Ri});class Ai extends ni{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(Oi),defaults:Si}),b(this,{id:e}),this._context=t,t._members.set(e,this)}start(){this._sessions.start();const{session:t}=this;return this._hub.update("request",Pe(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(Ce.CONTAINER),this.notifyViewUpdate(Ce.PRODUCTS),this}notifyViewUpdate(t=Ce.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:f({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class $i extends Je{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=ke){if(this._members.has(t))throw Error("Unit already exists: "+t);return new Ai(this,t)}has(t=ke){return this._members.has(t)}get(t=ke){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new Ai(this,t)}}class Ti extends J{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new N)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const Ni="miso-ask-combo";var qi=Object.freeze({__proto__:null,CLASS_PREFIX:Ni});var Ui=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});function Pi(t={}){return Zi(t=Mi(t),{name:"follow-up"},[Fi(t),Xi(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...Gi(t)])}const ji=Object.freeze({followUps:Bi,relatedResources:Qi,querySuggestions:Fi,answerGroup:Gi,answer:Wi,sources:Vi}),Li=Object.freeze({normalizeOptions:Mi,normalizePhraseOptions:zi,normalizePhraseOptionKey:Di,phrase:Ki,phraseText:Yi,section:Zi,container:Xi,element:Ji,attrs:to});function Mi({classPrefix:t=Ni,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t,circledCitationIndex:e,phrases:s=zi(s),...n}}function zi(t={}){if(!t)return{};const e={};for(const s in t)e[Di(s)]=t[s];return e}function Di(t){return"relatedQuestions"===(t=t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase())))?"querySuggestions":t}function Bi(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}function Qi(t){const{features:e={},logo:s=!0}=t;return Zi(t,{name:"related-resources"},!1===e.relatedResources?"":Xi(t,{name:"related-resources",visibleWhen:"nonempty",logo:s},[Ki(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}function Fi(t){const{features:e={}}=t;return!1===e.querySuggestions?"":Xi(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[Ki(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}function Gi(t){return[Wi(t),Hi(t),Vi(t),Xi(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}function Wi(t){return Xi(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",Ki(t,{name:"question",tag:"div"}),"<miso-question></miso-question>","<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}function Vi(t){return Xi(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",Ki(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}function Hi(t){const{affiliation:e=!0}=t||{};return e?Xi(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}function Ki(t,{name:e,tag:s="div"}){const{classPrefix:n}=t;return`<${s} class="${n}__phrase ${n}__${e}-phrase">${Yi(t,(i=e,i.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))))}</${s}>`;var i}function Yi(t,e){const{phrases:s={}}=t,n=s[e]||Ui[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}function Zi({classPrefix:t},{name:e},s){return Ji("section",{classes:[t+"__section",`${t}__${e}`]},s)}function Xi({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:o=!1},r){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),Ji("miso-ask",{classes:a,visibleWhen:i,logo:o,parentQuestionId:s},r)}function Ji(t,e={},s=""){return("string"==typeof e||Array.isArray(e))&&(s=e,e={}),`<${t}${to(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}function to({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${v(t)}="${n}"`)}return s}var eo=Object.freeze({__proto__:null,root:function(t={}){return""+Zi(t=Mi(t),{name:"question"},[Xi(t,{name:"query"},"<miso-query></miso-query>")])+Zi(t,{name:"answer"},Gi(t))+Bi(t)+Qi(t)},followUp:Pi,sections:ji,helpers:Li});const so=Object.freeze(qi),no=Object.freeze(Ui),io=Object.freeze(eo);var oo=Object.freeze({__proto__:null,constants:so,phrases:no,templates:io,wireFollowUps:function(t,e,{template:s=Pi,...n}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const i=t.ui.asks,o=t.ui.ask;i.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:t.workflow.questionId}))})),o.on("loading",(()=>{e.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:ro}=document,ao=Object.freeze({templates:io,autostart:!0}),co=["templates","phrases","features"];class uo{constructor(){this._defaults=ao,this._scriptSrc=function(){if(!ro||!ro.src)return{};const t=document.createElement("a");t.href=ro.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=_o(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=_o(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return f({apiKey:t,apiHost:e,templates:po(s),phrases:n,...i})}(lo(this._defaults,this._scriptSrc,t,this._pageUrl))}}function lo(...t){let e={};for(const s of t)s&&(e=ho(e,s));return e}function ho(t,e){if(!e)return t;Object.assign(t,e);for(const s of co)s in e&&(t[s]={...t[s],...e[s]});return t}function _o(t){return""===t||"false"!==t&&t}function po(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(po):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,po);default:throw Error("Unsupported template type: "+t)}}class mo{constructor(t,{classPrefix:e=so.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");b(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class fo extends Ti{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new uo,this._localOptions={}}config(t={}){t=lo(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;b(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new mo(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:o}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=n,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&o(e,s.relatedResourcesSection),u.autoQuery()}}class go extends tt{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let yo,bo,vo;async function wo(t){const e=await async function(t){return t.MisoClient||window.MisoClient||yo||(yo=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return bo=bo||e.any(),vo=vo||await bo,vo.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),vo}const ko="logo",Eo="auto",Co=Object.freeze([ko]);function xo(t){if(!t)return Eo;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Io extends HTMLElement{static get observedAttributes(){return Co}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return xo(this.getAttribute(ko))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Eo:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(ko,e):this.removeAttribute(ko)}async connectedCallback(){const t=this._client=await wo(Io);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===ko)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){xo(t)!==xo(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Oo="parent-question-id",Ro=Object.freeze([...Io.observedAttributes,Oo]);const So="unit-id",Ao=Object.freeze([...Io.observedAttributes,So]);var $o=Object.freeze({__proto__:null,MisoAskElement:class extends Io{static get tagName(){return"miso-ask"}static get observedAttributes(){return Ro}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Oo)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Oo,t):this.removeAttribute(Oo))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Oo)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Io{static get observedAttributes(){return Io.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoSearchElement:class extends Io{static get observedAttributes(){return Io.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Io{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Ao}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(So)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(So,t):this.removeAttribute(So)}attributeChangedCallback(t,e,s){if(t===So)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const To="role",No=Object.freeze([To]);class qo extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return No}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(To);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${To}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${To}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===To&&this._container&&this._container._updateComponentRole(this,e,s)}}var Uo=Object.freeze({__proto__:null,MisoComponentElement:qo,MisoQueryElement:class extends qo{constructor(){super({role:Ce.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends qo{constructor(){super({role:Ce.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends qo{constructor(){super({role:Ce.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends qo{constructor(){super({role:Ce.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends qo{constructor(){super({role:Ce.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends qo{constructor(){super({role:Ce.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends qo{constructor(){super({role:Ce.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends qo{constructor(){super({role:Ce.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends qo{constructor(){super({role:Ce.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends qo{constructor(){super({role:Ce.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends qo{constructor(){super({role:Ce.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoErrorElement:class extends qo{constructor(){super({role:Ce.ERROR})}static get tagName(){return"miso-error"}}});class Po extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(Po.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var jo=Object.freeze({__proto__:null,containers:$o,roles:Uo,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends Po{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Hs});const Lo=Object.freeze(oo);var Mo=Object.freeze({__proto__:null,ask:Lo});const zo="ui";let Do,Bo;async function Qo(){return Bo||(Bo=j(Do||(Do=L(zo))))}class Fo{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Go{constructor(t,e){this._plugin=t,this._client=e,b(this,{sources:{api:Rs(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new xi(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get explore(){return this._explore||(this._explore=new bi(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Wo{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new fo(this._plugin,this._MisoClient))}}let Vo,Ho;async function Ko(){return Vo||(Vo=async function(){return async function(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let o,r;function a(){o&&clearInterval(o),r&&clearTimeout(r)}o=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(r=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function Yo(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(Jt,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||e.debug;n&&Jt.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&Jt.plugins.use("std:dry-run");return window.MisoClientSA=Jt,Jt}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const n=window.misoSA=new e(s);return n.context.anonymous_id=await async function(){if(Ho)return Ho;const t=await Ko();return Ho=t.get("clientId")}(),n}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function Zo(t){return e=>({...e,context:{...e.context,custom_context:{...Xo(t),...e.context&&e.context.custom_context}}})}function Xo({site:t,page:e,config:s,version:n}){return f({source:"miso-client-script",script_version:n,attribution:"miso-smart-answers",site:t.key,user_geo:s.geo,page_type:e.type,post_id:e.postId,uuid:S()})}function Jo(t,{client:e}){const{site:s,page:n,config:i}=t,{product_id:o}=n,r=e.ui.explore;r.useApi(f({_meta:f({site:s.key,user_geo:i.geo}),product_id:o})),r.useLink((t=>"/smart-answers?q="+encodeURIComponent(t))),r.useInteractions({preprocess:Zo(t)}),o?r.start():r.start({relatedQuestions:!1})}async function tr(t,{paragraphs:e=10}={}){const{debug:s}=t,n=(i=e,document.querySelectorAll(".article__main .article-column__content > p:not(:empty)")[i-1]);var i;if(!n)return void s("[Discovery] No block shown: cannot find the reference position for discovery block.");const[[o,r]]=await Promise.all([Yo(t),ot(t)]),a=wt(t);n.insertAdjacentElement("afterend",a),Jo(t,{MisoClient:o,client:r,rootElement:a})}Jt.plugins.use(class extends J{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new go(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new N}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Mo};y(s,this,["layouts","combo","ready"]),b(this,{MisoClient:t}),b(t,{ui:s}),this.combo=new Wo(this,t);const n=Object.values(ti).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:o,combos:r,...a}=jo,c=[...Object.values(r),...Object.values(i),...Object.values(o),...Object.values(a)];Io.MisoClient=t,Po.MisoClient=t;for(const e of c)e.MisoClient=t;await Qo();for(const t of c)x(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){b(t,{ui:new Go(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new Fo(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new $i(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new pi(this,t)),e}});const er="#explore-a-topic";async function sr(t){const{debug:e}=t,s=function({}){const t=document.querySelector(er);return t&&t.parentElement.parentElement}(t);if(!s)return void e(`[Discovery] No block shown: cannot find the reference position (${er}) for discovery block.`);const[[n,i]]=await Promise.all([Yo(t),ot(t)]),o=kt(t);s.insertAdjacentElement("afterend",o),Jo(t,{MisoClient:n,client:i,rootElement:o})}(async t=>{const{version:n,page:i,debug:o}=t;if(i.type!==e)if(window.miso_smart_answers_script_version)console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);else switch(window.miso_smart_answers_script_version=n,o("Miso Smart Answers script version: "+n),i.type){case"home":await sr(t);break;case s:await tr(t);break;default:o("[Discovery] No discovery block for page type: "+i.type)}})(mt)}();
