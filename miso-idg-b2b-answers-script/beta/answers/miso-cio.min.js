!function(){"use strict";const t="home",e="answers",s="article",i="other",n=["cover_image","custom_attributes.site","created_at","product_id","published_at","snippet","title","updated_at","url"];var r="0.9.1-beta.0";var o=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,i]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===i||i);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"===e&&(t.q=s);return t}()});const a={key:"cio",hostname:"www.cio.com",name:"CIO",lang:"en"},c=window.location.hostname===a.hostname;var u={...a,dev:c};function l(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const h=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),_=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var d=Object.freeze({__proto__:null,GROUP:h,NAME:_});function p(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}function m(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function f(t){return null!=t?""+t:t}function g(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function y(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function b(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}class w{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);E(s),E(i),E(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>v(this,t)),e):v(this,t),this._value=t}disconnect(){this._active=!1}}function v(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function E(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function k(t){return"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE}function C(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function R(t){return t&&t.ownerDocument&&t.ownerDocument.contains(t)}function O(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function S(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async()=>{try{await t(),e()}catch(t){s(t)}}))}))}async function x(t,{area:e=.5,duration:s=1e3,signal:i}={}){var n;return t="string"==typeof(n=t)?document.querySelector(n):n,new Promise((n=>{const r=new w((t=>{t&&(r.disconnect(),o.disconnect(),n())}),{onDuration:s}),o=new IntersectionObserver((t=>{r.value=t[0].isIntersecting}),{threshold:e});o.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{r.disconnect(),o.disconnect()}))}))}function I(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function A(t,e){const s=window.localStorage.getItem(t),i=function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t),n=s||i||""+e();return n&&!s&&window.localStorage.setItem(t,n),n&&!i&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n),n}function N(t){return new T(t)}class T{constructor(t){this._value=t;const e=t=>{this._value=t};b(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class U{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class ${constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){for(let t=0;;t=this._index+1){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new U),await this._resolution.promise),this._aborted)break;if(yield this._value,this._done)break}}}const P=Symbol.for("miso:resources");class q{constructor(){this._resources=new Map;const t=window[P]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){j(this._resources,t).resolve(e)}async get(t){return j(this._resources,t).promise}}function j(t,e){if(t.has(e))return t.get(e);const s=new U;return t.set(e,s),s}function L(){return window[P]||(window[P]=new q)}class M{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new U;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class D{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)p(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&p(s,e)}}_injectSubscribeInterface(t){y(t,this,["on","once"])}}function z(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class Q{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:z(t,e),uuid:I()})}(t,e);b(this,{meta:s});const i=this._error=this._error.bind(this);(this._events=new D({error:i,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(Q,"miso:component");class B extends Q{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new U);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class G{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}[{key:"cio",hostname:"www.cio.com",name:"CIO",lang:"en"},{key:"cso",hostname:"www.csoonline.com",name:"CSO",lang:"en"},{key:"networkworld",hostname:"www.networkworld.com",name:"Network World",lang:"en"}].reduce(((t,e)=>(t[e.key]=e,t)),{});var W=Object.freeze(function(){const n=(r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r;var r;switch(n){case"/":return{type:t};case"/smart-answers":return{type:e}}const o=n.substring(1).split("/");if("article"===o[0]){const t=""+o[1];return{type:s,postId:t,product_id:`article_${u.key}_${t}`}}return{type:i}}());const V="%cMiso",F="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";var H=Object.freeze({__proto__:null,config:o,version:r,site:u,page:W,debug:function(...t){!function(...t){console.log(V,F,...t)}(...t)}});const K=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Y{constructor(t,e){this._client=t,this._root=e,this._bulk=new M(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=n?AbortSignal.timeout(n):void 0,l=await(this._root._customFetch||window.fetch)(t,g({method:s,headers:i,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=K.DATA_ENDPOINT,eventEndpoint:s=K.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){t.error(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){t.error(e)}return i}}class Z extends Q{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:X,NAME:J}=d;class tt extends Z{constructor(t){super(t,X.INTERACTIONS)}async upload(t,e){try{return await this._run(J.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===J.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}const{GROUP:et,NAME:st}=d;class it extends Z{constructor(t){super(t,et.ASK)}async questions(t,e={}){if("string"==typeof t&&"{"!==t.charAt(0))return new nt(this,{question_id:t},e);const s=await this._run(st.QUESTIONS,t,e);return new nt(this,s,e)}async _questions(t,e){return this._run(st.QUESTIONS,t,e)}async _get(t,e){return this._run(`${st.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(st.RELATED_QUESTIONS,t,e)}}class nt{constructor(t,{question_id:e},s={}){this._api=t,this._questionId=e,this._ac=new AbortController,this._options=s}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,{...this._options,...t})}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...i}=this._options;const n=new G(s);let r;e=l(this._ac.signal,n.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o=0;const a=new $,c=setInterval((async()=>{let e,u;try{[e,u]=await t(r?{signal:r}:{}),n&&n(e,u),o=0}catch(t){return i&&i(t),o++,void(o>s&&(clearInterval(c),a.error(t)))}a.update(e,u),u&&clearInterval(c)}),e);return r&&r.addEventListener&&r.addEventListener("abort",(()=>{clearInterval(c),a.abort(r.reason)})),a}((async({}={})=>{const t=await this.get();return[t,t.finished]}),{interval:t,signal:e,onResponse:(t,e)=>{var s,i;e?n.clear():(i=t,(s=r)&&s.answer_stage===i.answer_stage&&s.answer.length===i.answer.length||n.touch()),r=t},...i})[Symbol.asyncIterator]()}}const{GROUP:rt,NAME:ot}=d;class at extends Z{constructor(t){super(t,rt.SEARCH)}async search(t,e){return this._run(ot.SEARCH,t,e)}async autocomplete(t,e){return this._run(ot.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(ot.MGET,t,e)}}const{GROUP:ct,NAME:ut}=d;class lt extends Z{constructor(t){super(t,ct.RECOMMENDATION)}async userToProducts(t,e){return this._run(ut.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(ut.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(ut.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(ut.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(ut.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(ut.PRODUCT_TO_PRODUCTS,t,e)}}class ht extends Q{constructor(t,e){super("api",t),this._client=t,this.helpers=new Y(t,e),this.interactions=new tt(this),this.ask=new it(this),this.search=new at(this),this.recommendation=new lt(this)}}var _t=Object.freeze({__proto__:null,Api:ht,ApiBase:Z,ApiHelpers:Y,Interactions:tt,Ask:it,Search:at,Recommendation:lt});class dt extends Q{constructor(t){super("context",t),this._client=t}}var pt={api:_t,context:{Context:dt}};class mt{constructor(t){b(this,{install:t})}}class ft extends B{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new gt(this,pt),this.plugins=new yt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new U);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return b(i,{id:t}),this._tryConfig(i,e),i;case"function":return new mt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new L).get(s);!this.isRegistered(t)&&this.register(i)}}class gt{constructor(t,e){y(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),b(this,{classes:e})}}class yt{constructor(t){y(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const bt=new class extends Q{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new ft(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version="1.9.1-beta.2",this._cmdRes=new U}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var wt=Object.freeze({__proto__:null,viewable:x});const{currentScript:vt}=document;class Et extends Q{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Et),window.MisoClient?window.MisoClient!==Et&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Et}constructor(t){super("client",bt),this._config(t),this.context=new dt(this),this.api=new ht(this,bt),function(t){bt._clients.push(t),bt._events.emit("create",t)}(this)}get version(){return Et.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,g(t)}_readConfigFromScriptUrl(){return g({apiKey:new URL(new Request(vt.src||vt.href).url).searchParams.get("api_key")||void 0})}}Et.helpers=wt,b(Et,{uuid:I()});var kt=function(t){const e=bt._pluginRoot;return bt.MisoClient=e.MisoClient=t,y(t,bt,["version","instances","any","meta","on","once","cmdDone"]),y(t,e,["plugins"]),t}(Et);class Ct{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=A("miso_anonymous_id",I))}set anonymous_id(t){t=f(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=f(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}}function Rt(){const t=new URLSearchParams(window.location.search);let e=g({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Ot{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function St({text:t="Miso"}={}){return"%c"+t}function xt({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}function It(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}kt.plugins.register(class{constructor(t={}){this._options=t}static get id(){return"std:debug"}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t)}config(t={}){this._options={...this._options,...t}}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const{type:t}=r.payload.data[0];a.push(t)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logr(...t){const e=this._options.console||{};console.log(St(e),xt(e),...t)}_log(t,e,...s){const i=this._options.console||{};console.log(St(i),xt(i),function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(It)):this._log(t,e,It(s))}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}}),kt.plugins.use(class extends Q{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Ct(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return"interactions"===e&&"upload"===s?this._modifyPayloadForInteractions(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=g({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...n,...t})))}}}),kt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...g({page:g({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:Rt()}),...t.context}})))}}}),kt.plugins.use(class extends Q{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Ot(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:i}){if(e===h.SEARCH)if(s===_.SEARCH)this._captureSearchApiRequest(t,i)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}});const At="data-miso-product-id",Nt="default",Tt=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",ERROR:"error"}),Ut=new Set([Tt.PRODUCTS,Tt.CATEGORIES,Tt.ATTRIBUTES,Tt.RESULTS,Tt.ITEMS,Tt.QUESTION,Tt.ANSWER,Tt.SOURCES,Tt.RELATED_RESOURCES,Tt.QUERY_SUGGESTIONS,Tt.RELATED_QUESTIONS]);function $t(t){return Ut.has(t)}const Pt=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",TEXT:"text",ERROR:"error"}),qt=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click"}),jt=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Lt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function Mt(t){if(t!==qt.IMPRESSION&&t!==qt.VIEWABLE&&t!==qt.CLICK)throw Error("Unrecognized event type: "+t)}function Dt(t){if(void 0===t)return;let[e,s]=m(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function zt(...t){return!1!==t[t.length-1]&&Yt(t,((t,e)=>Object.assign(t,{...e,payload:{...t.payload,...e.payload}})))}function Qt(...t){return!1!==t[t.length-1]&&Yt(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=Bt(t[s],i);return t}))}function Bt(t,e){return!1===(e=Dt(e))[0]?e:t&&e?[e[0]||t[0],{...t[1],...e[1]}]:e||t}function Gt(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function Wt(...t){return!1!==t[t.length-1]&&Yt(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}const Vt=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return g({name:t,payload:e})},merge:zt},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[Tt.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[Tt.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Tt.PRODUCTS]}: ... }) instead`),t={...s,[Tt.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[e]=Dt(s);return i},merge:Qt},{key:"dataProcessor",normalize:function(t){t=m(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&Yt(t,((t,e)=>Object.assign(t,{...e,impression:Gt(t.impression,e.impression),viewable:Gt(t.viewable,e.viewable),click:Gt(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=m(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:Wt}];class Ft{constructor(){this._events=new D({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class Ht{constructor(t={},e={}){this._events=new D({target:this}),this._defaults=e,this._globals=t||{},this._locals={},b(this,{resolved:new Kt(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Kt{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of Vt)Object.defineProperty(Ft.prototype,t,{set:function(s){this._globals[t]=e(s),this._notify(t)},get:function(){return this._globals[t]}}),Object.defineProperty(Ht.prototype,t,{set:function(s){this._locals[t]=e(s),this._notify(t)},get:function(){return this._locals[t]}}),Object.defineProperty(Kt.prototype,t,{get:function(){const e=this._options;return s(e._defaults[t],e._globals[t],e._locals[t])}});function Yt(t,e){let s={};for(const i of t)i&&(s=e(s,i));return g(s)}class Zt extends Q{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Ft}useApi(...t){return this._options.api=t,this}useLayouts(t){return this._options.layouts=t,this}useDataProcessor(t){return this._options.dataProcessor=t,this}useTrackers(t){return this._options.trackers=t,this}useInteractions(t){return this._options.interactions=t,this}}function Xt(){return"data"}function Jt(t){return t?"view:"+t:"view"}class te{constructor(){(this._events=new D)._injectSubscribeInterface(this),this._states={},b(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class ee{constructor(t){this._hub=t,this._sessionIndex=0,y(t,this,["active"])}get active(){const{session:t}=this._hub.states;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this.new({force:!0}),this.start()}_create(){return Object.freeze({active:!1,uuid:I(),index:this._sessionIndex++})}}class se{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states;try{const{signal:s}=this._ac||{},i={...t.options,signal:s},n=await this._source({session:e,...t,options:i});if(n&&n[Symbol.asyncIterator]){let t;for await(t of n){if(!this._isCurrentSession(e))break;this._emitResponse({session:e,value:t})}}else this._emitResponseWithSessionCheck({session:e,value:n})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,error:t})}}_emitResponseWithSessionCheck(t){this._isCurrentSession(t.session)&&this._emitResponse(t)}_isCurrentSession(t){if(!t)return!1;const{session:e}=this._hub.states;return e&&e.index===t.index}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ie{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{p(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}class ne{constructor(t,e){this._events=new D({target:this}),this._views=t,b(this,{role:e,interface:new re(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new ie((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&"function"==typeof t.initialize&&t.initialize(this),this.refresh({force:!0})}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:n,status:r,ongoing:o,meta:a}=e;if(!t&&!(n&&n.active))return;if(!t&&((c=e)===(u=i)||c&&u&&c.status===u.status&&c.error===u.error&&c.value===u.value&&c.ongoing===u.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(c.session,u.session)))return;var c,u;const l=(t={},e)=>{!1!==t&&this.updateState({session:n,status:r,ongoing:o,meta:a,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:l})}catch(t){this._error(t),l({error:t})}}updateState({session:t,status:e,ongoing:s,meta:i,error:n},{silent:r=!1}={}){n&&(e=Lt.ERRONEOUS);const o=this._state=Object.freeze(g({session:t,status:e,ongoing:s,meta:i,error:n})),{role:a}=this;this.hub.update(Jt(a),o,{silent:r})}_sliceData(t){const{value:e,error:s,status:i,meta:n,...r}=t,o={value:this.role===Tt.ERROR?s:e&&e[this.role],status:i,meta:n,...r};return this.role===Tt.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(e)}),g(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!$t(s))return!1;let e=t&&t[s];if(s===Tt.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class re{constructor(t){y(this,t,["role","layout","element","proxyElement","refresh","on"])}}class oe{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n=[],options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=i,this._options=r,this._containers=new Map,this._views={};for(const t of n)this._views[t]=new ne(this,t);b(this,{interface:new ae(this)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on(Xt(),(()=>this.refresh())),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}addContainer(t){if(this._containers.has(t))return;const e=new ne(this,Tt.CONTAINER);e.layout=this._createLayout(Tt.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===Tt.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new ne(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t}={}){const e=this._getData();await Promise.all(this._getViews(!0).map((s=>s.refresh({force:t,data:e}))))}_getData(){const{[Xt()]:t}=this._hub.states;if(!this._data||this._data.data!==t){const e=t&&t.session&&t.session.active?t.error?Lt.ERRONEOUS:t.value?Lt.READY:Lt.LOADING:Lt.INITIAL,s=e===Lt.READY?!!t.ongoing:void 0;this._data=Object.freeze({...t,status:e,ongoing:s})}return this._data}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ae{constructor(t){this._actor=t,y(this,t,["syncSize","refresh"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}function ce(t){return e=>Array.from(e.querySelectorAll(`[${t}]`)).map((e=>({element:e,value:{product_id:e.getAttribute(t)}})))}class ue{constructor({keyAttrName:t="data-key",list:e}={}){this._list=e||ce(t),this._bindings=new Map,this._e2b=new WeakMap}list(){return[...this._bindings.values()]}get(t){if(!t)throw Error("Value or element is required.");if(this._root)return k(t)?C(t,(t=>this._e2b.get(t)||void 0),{root:this._root}):this._bindings.get(t)}refresh(t){if(!t)return this.unbindAll();this._root=t;const e=this._purge(),s=[];for(const i of this._list(t)){const[t,...n]=this._bind(i);t&&s.push(t);for(const t of n)e.push(t)}return{bounds:s,unbounds:e}}unbindAll(){const t=this.list();return this._bindings.clear(),this._root=void 0,{bounds:[],unbounds:t}}_bind({element:t,key:e,value:s}){if(!(e=e||s))throw Error("Key or value is required.");if(!t)throw Error("Element is required.");const i=this._bindings.get(e);if(i&&i.element===t)return[];const n=this._unbind(this.get(e)),r=this._unbind(this.get(t)),o=Object.freeze({key:e,value:s,element:t});this._bindings.set(e,o),this._e2b.set(t,o);const a=[o];return n&&a.push(n),r&&a.push(r),a}_purge(){const t=[];for(const e of this._bindings.values()){const{element:s}=e;R(s)||t.push(this._unbind(e))}return t}_unbind(t){return t&&(this._bindings.delete(t.key),this._e2b.delete(t.element)),t}_destroy(){this.unbindAll()}}const{IMPRESSION:le,VIEWABLE:he,CLICK:_e}=qt,{UNTRACKED:de,TRIGGERED:pe}=jt,me={NEW:Object.freeze({[le]:de,[he]:de}),UNTRACKED:Object.freeze({[le]:de,[he]:de,[_e]:de})};class fe{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(t);return e?{...e}:me.UNTRACKED}get(t,e){const s=this._states.get(t);return s&&s[e]||de}set(t,e,s){Mt(e),function(t){if(t!==jt.UNTRACKED&&t!==jt.TRACKING&&t!==jt.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of m(t))this._setOne(i,e,s)}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,t,(()=>({...me.NEW}))))[e]=s}untriggered(t,e){return t.filter((t=>this.get(t,e)!==pe))}}const{IMPRESSION:ge,VIEWABLE:ye,CLICK:be}=qt,{UNTRACKED:we,TRACKING:ve,TRIGGERED:Ee}=jt,ke=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function Ce(t,e){return!!e&&{...t,...e}}function Re(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return g({...ke,...n,impression:Ce(ke.impression,e),viewable:Ce(ke.viewable,s),click:Ce(ke.click,i)})}class Oe{constructor({proxyElement:t,element:e,sessionId:s="default",active:i=!0,bindings:n,...r}={}){this._events=new D({target:this}),this._proxyElement=t||new ie(e),this._getSessionId="function"==typeof s?s:()=>s,this._isActive="function"==typeof i?i:()=>i,this._bindings=new ue(n),this._viewables=new WeakMap,this._options=Re(r),this._unsubscribes=[this._proxyElement.on("click",(t=>this._handleClick(t))),this._proxyElement.on("element",(()=>this.refresh()))],this.refresh()}get active(){return this._isActive()}config(t){this._options=Re(t)}refresh(){this._syncElement(),this._syncStates(),this._refreshBindings()}_syncStates(){const t=this._getSessionId();t&&(this._states&&t!==this._states.sessionId&&this._retireStates(),!this._states&&t&&(this._states=new fe(t)))}impression(t,e){this._assertActive(),this._options&&this._options.impression&&this._trigger(ge,t,{manual:!0,...e})}viewable(t,e){this._assertActive(),this._options&&this._options.viewable&&this._trigger(ye,t,{manual:!0,...e})}click(t,e){this._assertActive(),this._options&&this._options.click&&this._trigger(be,t,{manual:!0,...e})}_assertActive(){if(!this._isActive())throw Error("Tracker is not active.")}getState(t){return Object.freeze({[be]:this._proxyElement.current?ve:we,...this._states.getFullState(t)})}_syncElement(){this._proxyElement.sync({silent:!0});const t=this._proxyElement.current;this._element!==t&&(this._retireElement(),t&&this._options&&this._options.watch&&(this._mutationObserver=new MutationObserver((()=>this.refresh())),this._mutationObserver.observe(t,{childList:!0,subtree:!0})),this._element=t)}_retireElement(){this._element&&(this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=void 0),this._element=void 0)}_retireStates(){const{unbounds:t}=this._bindings.unbindAll();this._untrackViewables(t),this._states=void 0}_refreshBindings(){if(!this._states)return;const t=this._proxyElement.current,{bounds:e,unbounds:s}=this._bindings.refresh(t);this._untrackViewables(s),this._trackImpressions(e),this._trackViewables(e)}_trackImpressions(t){this._options&&this._options.impression&&this._trigger(ge,t.map((t=>t.value)),{bindings:t})}_trackViewables(t){if(this._options&&this._options.viewable)for(const e of t)this._trackViewableOnElement(e)}async _trackViewableOnElement(t){const{value:e,element:s}=t;if(!e||!k(s)||this._viewables.has(s))return;if(this._states.get(e,ye)!==we)return;this._states.set(e,ye,ve);const{area:i,duration:n}=this._options&&this._options.viewable,r=new AbortController,{signal:o}=r;this._viewables.set(s,{ac:r}),await x(s,{area:i,duration:n,signal:o}),this._viewables.delete(s),this._trigger(ye,[e],{bindings:[t]})}_untrackViewableOnElement({value:t,element:e}){const s=this._viewables.get(e);if(!s)return;s.ac.abort(),this._viewables.delete(e);const i=ye;this._states.get(t,i)===ve&&this._states.set(t,i,we)}_untrackViewables(t){for(const e of t)this._untrackViewableOnElement(e)}_handleClick(t){const e=this._options&&this._options.click;if(!e||!this._isActive())return;const s=this._bindings.get(t.target);if(s){if("function"==typeof e.validate){if(!e.validate(t,s))return}else if(!e.lenient){if(0!==t.button)return;if(t.defaultPrevented)return;if(!C(t.target,(t=>"A"===t.tagName&&t.href||void 0)))return}this._trigger(be,[s.value],{bindings:[s]})}}_trigger(t,e,{manual:s=!1,bindings:i}={}){Mt(t),this._isActive()&&0!==(e=this._states.untriggered(m(e),t)).length&&(this._states.set(e,t,Ee),this._events.emit(t,{event:t,values:e,manual:s,bindings:i}))}destroy(){this._retireElement(),this._retireStates(),this._bindings._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[]}}const Se=new Set([Tt.PRODUCTS,Tt.SOURCES,Tt.RELATED_RESOURCES]);function xe({property:t,misoId:e},{event:s,values:i,manual:n}){let r;if(e)try{r=function(t){const e=t.split("-"),s=""+e[2].substring(1)+e[1]+e[0];return Math.floor(parseInt(s,16)/1e7)-12219292800}(e)}catch(t){}const o=function(t){return Se.has(t)}(t);return g({type:"viewable"===s?"viewable_impression":s,product_ids:o?i.map((t=>t.product_id)).filter((t=>t)):[],miso_id:e,context:{custom_context:g({api_ts:r,property:t,items:o?void 0:i.map((t=>t.text||t)),trigger:n?"manual":"auto"})}})}function Ie(t){return t&&t.status===Lt.READY}class Ae{constructor(t,e,{active:s,bindings:i,...n}={}){this._hub=t,this._view=e,this._bindings=i;const r=this._role=e.role;this._tracker=new Oe({bindings:{list:t=>this._listBindingsFn()(t)},proxyElement:e.proxyElement,sessionId:()=>this._getSessionId(),active:s||(()=>this._isViewReady()),...n}),this._unsubscribes=[this._tracker.on("*",(t=>this._handleEvent(t))),t.on(Jt(r),(()=>this.refresh()))],this.refresh()}config(t){this._tracker.config(t)}start(){throw Error("workflow.tracker.start() is deprecated. Use workflow.startTracker() instead.")}refresh(){this._tracker.refresh()}impression(t,e){this._assertViewReady(),this._tracker.impression(t.map((t=>({product_id:t}))),e)}viewable(t,e){this._assertViewReady(),this._tracker.viewable(t.map((t=>({product_id:t}))),e)}click(t,e){this._assertViewReady(),this._tracker.click(t.map((t=>({product_id:t}))),e)}_listBindingsFn(){if(this._bindings&&"function"==typeof this._bindings.list)return this._bindings.list;const{layout:t}=this._view;return t&&t.bindings&&"function"==typeof t.bindings.list?t.bindings.list:ce(At)}_assertViewReady(){if(!this._hub.active)throw Error("Workflow is not active. Call workflow.start() to activate it.");if(!Ie(this._getViewState()))throw Error("Workflow is not rendered yet. If you handle rendering by yourself, call workflow.notifyViewUpdate() when DOM is ready.")}_getViewState(){return this._hub.states[Jt(this._role)]}_isViewReady(){return this._hub.active&&Ie(this._getViewState())}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||this._element&&this._element.getAttribute("miso-id")||void 0}getState(t){return this._tracker.getState(t)}_handleEvent(t){const e="results"===this._role?"products":this._role,s=this._getMisoId();this._hub.trigger("interaction",xe({property:e,misoId:s},t))}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._tracker.destroy()}}class Ne{constructor(t,{views:e,options:s}){this._hub=t,this._views=e,this._options=s,this._trackers={},s.on("trackers",(()=>this._syncConfig())),this._syncConfig()}_syncConfig(){for(const[t,e]of Object.entries(this._options.resolved.trackers))this._createOrConfigTracker(t,e)}_createOrConfigTracker(t,e){if(void 0===e)return;let s=this._trackers[t];s?s.config(e):(s=this._trackers[t]=new Ae(this._hub,this._views.get(t),e),Object.defineProperty(this,t,{get:()=>this._trackers[t]}))}_destroy(){for(const t of Object.values(this._trackers))try{t._destroy()}catch(t){console.error(t)}}}class Te{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[Xt()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};s&&this._hub.trigger("interaction",this._buildInteraction(s,t))}_buildInteraction(t,{value:e,unselected:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_id:t,value:s?"unselected":e}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ue{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=m(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function $e(t){return async({group:e,name:s,payload:i,options:n})=>e===h.ASK&&s===_.QUESTIONS?t.api.ask.questions(i,n):t.api[e]._run(s,i,n)}class Pe{constructor({role:t,workflow:e,...s}={}){b(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=N(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,S((()=>this._doRaf())))}_doRaf(){this._requested&&(this._requested=!1,this._applyRender())}_applyRender(t={}){if(!this._pending)return;const e=Date.now();let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const n=this._rendered.get(this._element),r=N([]),o=N({});this._render(this._element,{state:s,rendered:n,timestamp:e},{notifyUpdate:r.args,writeToState:o.merge,...t}),this._rendered.set(this._element,Object.freeze({...s,...o.value})),i&&i(...r.value)}_render(){throw Error("Unimplemented")}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function qe(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function je({className:t},{title:e,description:s,sale_price:i,original_price:n}){let r="";e&&(r+=`<div class="${t}__item-title">${e}</div>`),s&&(r+=`<div class="${t}__item-desc">${s}</div>`);const o=i||n;return o&&(r+=`<hr><div class="${t}__item-price">${o}</div>`),`<div class="${t}__item-info-container">${r}</div>`}function Le({className:t,templates:e},{title:s,snippet:i,description:n,created_at:r,updated_at:o,published_at:a}){const c=o||a||r;let u="";return s&&(u+=`<div class="${t}__item-title">${s}</div>`),c&&(u+=`<div class="${t}__item-date">${function(t,e=Qe){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Qe.locale,e);default:throw Error("Invalid date format: "+e)}}(c,e.date)}</div>`),i?u+=`<div class="${t}__item-snippet">${i}</div>`:n&&(u+=`<div class="${t}__item-desc">${n}</div>`),`<div class="${t}__item-info-container">${u}</div>`}function Me({className:t},{product_id:e,url:s}){const i=s?"a":"div";return[`<${i} class="${t}__item-body" data-role="item" ${e?`${At}="${e}"`:""} ${s?`href="${s}" target="_blank" rel="noopener"`:""}>`,`</${i}>`]}function De({className:t},{cover_image:e}){if(!e)return"";return`<div class="${t}__item-cover-image-container">${`<img class="${t}__item-cover-image" src="${e}">`}</div>`}function ze({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}const Qe=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"});class Be extends Pe{constructor({className:t,templates:e,...s}={}){super(s),b(this,{className:t,templates:{...qe("root"),...e}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Ge extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ge.MisoClient.ui.layouts.create("banner").render(this)}}class We extends Pe{static get category(){return Pt.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e})}_render(t,{state:e}){this._syncBanner(t),this._syncStatus(t,{state:e})}_syncBanner(t){const e=Ge.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===Tt.PRODUCTS||t===Tt.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1}={}}=e,o=[s,r?Lt.EMPTY:Lt.NONEMPTY];s===Lt.READY&&o.push(i?Lt.ONGOING:Lt.DONE),t.setAttribute("status",o.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}}const Ve=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Fe extends Be{static get category(){return Pt.ERROR}static get type(){return"error"}static get defaultTemplates(){return Ve}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Ve,...e},...s})}}const He='<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';const Ke=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});const Ye=Symbol.for("miso.value");const Ze=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=Me(t,s);return""+r+(n.imageBlock||De)(t,s,i)+(n.infoBlock||je)(t,s,i)+(n.indexBlock||ze)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=Me(t,s);return""+r+(n.imageBlock||De)(t,s,i)+(n.infoBlock||Le)(t,s,i)+(n.indexBlock||ze)(t,s,i)+o},question:function(t,e,s){const[i,n]=Me(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===Lt.READY?n[r](t,e):""}</div>`},[Lt.READY]:function(t,e){const{templates:s}=t,i=e.value;return i&&i.length>0||e.ongoing?s.list(t,e,i):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-item-type="${r.itemType}">${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map((s=>n.item(t,e,s,r++))).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`}});class Xe extends Be{static get category(){return Pt.LIST}static get defaultTemplates(){return Ze}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Ze,...t},itemType:e,...s}),b(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})}),this._view=void 0}initialize(t){this._view=t;const{proxyElement:e}=this._view=t;this._unsubscribes.push(e.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===Lt.READY&&e.status===Lt.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=t.value.slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n;this._syncValues(t,e)}_syncValues(t,e){if(!t)return;const s=e.value||[];let i=0;for(const e of this._listItemElements(t))e[Ye]=s[i++]}_getListElement(t){return t.querySelector(`.${this.className}__list`)}_listItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_listBindings(t){if(!t)return[];const e=[];for(const s of this._listItemElements(t)){const t=s[Ye];if(!t)continue;e.push({element:s,key:"product"===this.options.itemType?t.product_id:t,value:t})}return e}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=e[Ye],{session:i}=this._view._state;this._view._events.emit("click",{session:i,value:s,element:e,domEvent:t})}destroy(){this._view=void 0,super.destroy()}}const Je="miso-list";class ts extends Xe{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Je}constructor({className:t=Je,...e}={}){super({className:t,...e})}}const es="miso-cards";const ss="miso-carousel",is=Object.freeze({ready:function(t,e){const{templates:s}=t,i=e.value&&e.value.length>0,n=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,n):n},carousel:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-previous" data-role="previous">${n.previous(t,e)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(t,e)}</div>`},previous:rs,next:rs}),ns=Object.freeze({...Xe.defaultTemplates,...is});function rs(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}var os="1.9.1-beta.2";const as="miso-ui-icon",cs=`${as}-svg-${os.replaceAll(".","_")}`,us=`<svg id="${cs}" style="display:none;">${[`<symbol id="${as}-send" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,`<symbol id="${as}-search" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`].join("")}</svg>`;let ls=!1;function hs(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use xlink:href="#${as}-${t}"></use></svg>`}ls||document.head.querySelector("#"+cs)||(ls=!0,document.head.insertAdjacentHTML("beforeend",us));const _s=hs("send"),ds=hs("search"),ps="miso-search-box";const ms=Object.freeze({root:function(t){const{className:e,role:s,templates:i,options:n,workflow:r}=t,{autocomplete:o,placeholder:a,buttonText:c}=n;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${a?`placeholder="${a}"`:""}>\n    <button class="${e}__button" type="submit" data-role="button">${c||"search"===r?ds:_s}</button>\n  </div>\n  ${o?i.autocomplete(t):""}\n</div>\n`},autocomplete:function(t){const{className:e,templates:s}=t;return`\n<div class="${e}__autocomplete" data-role="autocomplete">\n  ${s.suggestionList(t)}\n</div>\n`},suggestionList:function(t){const{className:e}=t;return`<ol class="${e}__suggestion-list" data-role="suggestion-list"></ol>`},suggestionItem:function(t,e){const{className:s}=t;return`<li class="${s}__suggestion-item" data-role="suggestion-item" tabindex="0">${e.text||e}</li>`}});class fs extends Be{static get category(){return Pt.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return ms}static get defaultClassName(){return ps}constructor({className:t=ps,templates:e,...s}={}){super({className:t,templates:{...ms,...e},...s}),this._contexts=new WeakMap,this._suggestionItems=new WeakMap}initialize(t){const{autocomplete:e}=this.options;this._view=t;const{proxyElement:s,hub:i}=t;this._unsubscribes=[...this._unsubscribes,s.on("keydown",(t=>this._handleKeyDown(t))),s.on("click",(t=>this._handleClick(t)))],e&&this._unsubscribes.push(i.on("suggestions",(()=>this._handleInput())))}focus(){this._element?this._context().focus():this._focusRequested=!0}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){t=super._preprocess({state:t});const{autocomplete:e}=this.options;if(!e)return t;const s=this._view.hub.states.suggestions;return{...t,suggestions:s}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._setupAutocomplete(t),this._renderSuggestions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_setupAutocomplete(t){const{autocomplete:e}=this.options;e&&this._context(t).setupAutocomplete()}_renderSuggestions(t,{state:e},{writeToState:s}={}){const{autocomplete:i}=this.options;if(!i)return;const{suggestionListElement:n,autocompleteElement:r}=this._context(t);if(!n)return void(s&&s({suggestions:{value:[]}}));const{suggestions:o={}}=e,a=o.value||[];r.classList[0===a.length?"add":"remove"]("empty"),n.innerHTML=a.map((t=>this.templates.suggestionItem(this,t))).join("");let c=0;for(const t of n.children)this._suggestionItems.set(t,a[c++])}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return gs.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new gs(t)),e}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick({target:t}){const{inputElement:e}=this._context();for(let s=t;s&&s!==this._view.element;s=s.parentElement)if(s.matches('[type="submit"]')||s.matches('[data-role="button"]'))return void(e&&(e.blur(),this._submit(e.value)));const{autocomplete:s}=this.options;if(s)for(let s=t;s&&s!==this._view.element;s=s.parentElement){const t=this._suggestionItems.get(s);if(!t)continue;const i=t.text||t;return e&&(e.value=i),void this._submit(i)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}class gs{static empty(){return gs._empty||(gs._empty=new gs)}constructor(t){this._element=t,this._cache={}}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get suggestionListElement(){return this._get("suggestion-list")}setupAutocomplete(){if(!this._element||this._autocompleteSetup)return;this._autocompleteSetup=!0;const{inputElement:t,autocompleteElement:e}=this;t&&e&&(t.addEventListener("focus",(()=>{e.classList.add("open")})),t.addEventListener("blur",(()=>{e.classList.remove("open")})))}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const ys=Symbol.for("miso.option-value"),bs="miso-option-list";const ws=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${e.text||e}</li>`}});class vs extends Be{static get category(){return Pt.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return ws}static get defaultClassName(){return bs}constructor({className:t=bs,templates:e,...s}={}){super({className:t,templates:{...ws,...e},...s}),b(this,{bindings:Object.freeze({list:this._listBindings.bind(this)})})}initialize(t){this._view=t;const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s),this._syncOptionValues(t,e)}_syncOptionValues(t,{state:e}){if(!t)return;const s=this._getOptionsElement(t);if(!s)return;const i=e.value||[];s.classList[0===i.length?"add":"remove"]("empty");let n=0;for(const t of this._listOptionElements(s))t[ys]=i[n++]}_listBindings(t){if(!t)return[];const e=this._getOptionsElement(t),s=[];for(const t of this._listOptionElements(e)){const e=t[ys];if(!e)continue;s.push({key:e.text||e,value:e,element:t})}return s}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_listOptionElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){for(let e=t.target;e&&e!==this._view.element;e=e.parentElement){const t=e[ys];if(t)return void this._submit(t.text)}}async _submit(t){t&&this._view.hub.trigger("query",{q:t})}}const Es=Object.freeze({...qe("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class ks extends Be{static get category(){return Pt.RADIO}static get defaultTemplates(){return Es}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...Es,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=this._view=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=C(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],S((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Cs="miso-feedback",Rs=[{text:"Helpful",value:"helpful",icon:He},{text:"Not helpful",value:"unhelpful",icon:He}];const Os=Object.freeze({options:function(t){const{templates:e}=t;return Rs.map((s=>e.option(t,s))).join("")},content:function(t,{text:e,icon:s}){const{className:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${i}__icon">${s}</i>`:""}\n${!1!==n.text?`<span class="${i}__text">${e}</span>`:""}\n`}});class Ss extends ks{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return Os}static get defaultClassName(){return Cs}constructor({className:t=Cs,templates:e,...s}={}){if(super({className:t,templates:{...Os,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const xs="miso-text";const Is=Object.freeze({root:function(t,e){const{className:s,role:i,options:{tag:n}}=t;return`<${n} class="${s}" ${i?`data-role="${i}"`:""}>${e.value||""}</${n}>`}});class As extends Be{static get category(){return Pt.TEXT}static get type(){return"text"}static get defaultTemplates(){return Is}static get defaultClassName(){return xs}constructor({className:t=xs,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Is,...e},tag:s,...i})}}class Ns extends Pe{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t={}){const e=N(!1);super._applyRender({...t,loop:e.t}),e.value&&this._requestRaf()}}class Ts{constructor(t={}){this._cps=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return({doneAt:s,timestamp:i})=>{let n=t*(Math.random()+.5);return e>0&&void 0!==s&&(n*=1+(i-s)*e/1e3),n}}(t)}get(t,e){const s=this._cps(e);return t.cursor+Math.floor((e.timestamp-t.timestamp)*s/1e3)}}class Us{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),u=!i.startsWith(c);return a||u?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function $s(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,Ps(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||Lt.INITIAL),i}function Ps(t){return t+"__cursor"}const qs="miso-typewriter";class js extends Ns{static get category(){return Pt.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return qs}constructor({className:t=qs,tag:e="auto",format:s="markdown",...i}={}){super({tag:e,format:s,...i}),b(this,{className:t}),this._prevState=void 0,this._progress=new Ts(i),this._readiness=new U,"markdown"===s&&js.MisoClient.plugins.install("std:ui-markdown")}initialize(t){this._view=t,this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown"),e=Ps(this.className);this._renderer=t.createRenderer({onRefChange:(t,s)=>{t&&t.classList.remove(e),s&&s.classList.add(e)},onDone:t=>{t.classList.add("done")},onDebug:this.options.onDebug||void 0}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._handleClick(t))))}async _setupForPlaintext(){this._renderer=new Us}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=t,a=i&&i.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==Lt.READY||o?void 0:Date.now());return this._prevState=Object.freeze(g({session:n,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=$s(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._progress.get(s,e);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);n(a);const c=e.status===Lt.READY&&!a.done;i({ongoing:c},{silent:c&&(!s||s.status===Lt.READY)}),c&&r()}_handleClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}var Ls=Object.freeze({__proto__:null,TemplateBasedLayout:Be,ContainerLayout:We,ErrorLayout:Fe,BannerLayout:class extends Be{static get category(){return Pt.BANNER}static get type(){return"banner"}static get defaultTemplates(){return Ke}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...Ke,...e},...s})}},CollectionLayout:Xe,ListLayout:ts,CardsLayout:class extends Xe{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return es}constructor({className:t=es,...e}={}){super({className:t,...e})}},CarouselLayout:class extends Xe{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return ns}static get defaultClassName(){return ss}constructor({className:t=ss,templates:e,...s}={}){super({className:t,templates:{...is,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._itemCount=i.value?i.value.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:fs,OptionListLayout:vs,FeedbackLayout:Ss,TextLayout:As,TypewriterLayout:js});const Ms=Object.freeze({[Tt.CONTAINER]:We.type,[Tt.ERROR]:Fe.type});class Ds extends Q{constructor({name:t,context:e,plugin:s,client:i,roles:n,defaults:r}){super(t||"workflow",s),this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,this._name=t,this._roles=n;const o=this._extensions=s._getExtensions(i),a=this._options=new Ht(e&&e._options,function(t,{layouts:e,interactions:s,...i}={}){const n={preprocess:[e=>t._preprocessInteraction(e)]};return{...i,layouts:Qt(Ms,e),interactions:Wt(n,s)}}(this,r)),c=this._hub=function(t,e){const{update:s,trigger:i}=t;return t.update=(i,n,r)=>(r&&r.silent||e("update",i,n,r),s.call(t,i,n,r)),t.trigger=(...s)=>(e("trigger",...s),i.apply(t,s)),t}(new te,((...t)=>this._log(...t))),u=this._source=$e(i),l=s.layouts;this._sessions=new ee(c),this._data=new se(c,{source:u,options:a});const h=this._views=new oe(c,{extensions:o,layouts:l,roles:n,options:a,workflow:t});this._interactions=new Ue(c,{client:i,options:a}),this._trackers=new Ne(c,{views:h,options:a}),this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t)))]}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this.reset(),this.start(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid===this.session.uuid){this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);return this._hub.update(Xt(),t),this}}_defaultProcessData(t){const{value:e}=t;return e&&e.miso_id?{...t,meta:{...t.meta,miso_id:e.miso_id}}:t}notifyViewUpdate(t,e){return this._assertActive(),e={status:Lt.READY,session:this.session,...e},this._hub.update(Jt(t),e),this}useApi(...t){return this._options.api=t,this}useLayouts(t={}){return this._options.layouts=t,this}useDataProcessor(t){return this._options.dataProcessor=t,this}useTrackers(t){return this._options.trackers=t,this}useInteractions(t){return this._options.interactions=t,this}get trackers(){return this._trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:i,name:n}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:i,api_name:n,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._trackers._destroy(),this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}const zs=Object.freeze({group:h.ASK,name:_.QUESTIONS,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Qs=Object.freeze({[Tt.QUERY]:[fs.type],[Tt.QUESTION]:[As.type,{tag:"h2"}],[Tt.ANSWER]:js.type,[Tt.FEEDBACK]:Ss.type,[Tt.SOURCES]:[ts.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Tt.RELATED_RESOURCES]:[ts.type,{incremental:!0,itemType:"article"}],[Tt.QUERY_SUGGESTIONS]:vs.type}),Bs=Object.freeze({[Tt.SOURCES]:{},[Tt.RELATED_RESOURCES]:{},[Tt.QUERY_SUGGESTIONS]:{active:!0,click:{validate:t=>0===t.button}}}),Gs=Object.freeze({api:zs,layouts:Qs,trackers:Bs});function Ws({layouts:t,...e},s){return{...e,layouts:Qt(t,{[Tt.QUERY]:[fs.type,{placeholder:s?"Ask a follow-up question":"Ask anything"}]})}}class Vs extends Ds{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(Qs),defaults:Ws(Gs,e)}),this._context=t,b(this,{parentQuestionId:e}),this._feedback=new Te(this._hub),this._setSuggestedQuestions(),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this.query(t))),this._hub.on(Xt(),(t=>this._onDataUpdate(t))),this._hub.on(Jt(Tt.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Tt.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))],e&&t._byPqid.set(e,this),t._events.emit("create",this),this.reset()}get questionId(){return this._questionId}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:i}=this._views.get(Tt.QUERY);i&&(s&&t&&(i.value=s),!s&&e&&i.focus()),s&&this.query({q:s})}query({q:t,...e}={}){e={...e,question:t},this.parentQuestionId&&(e.parent_question_id=this.parentQuestionId),this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0),this.restart();const{session:s}=this;return this._hub.update("request",zt(this._options.resolved.api,{payload:e,session:s})),this}restart(){const{session:t,status:e,ongoing:s}=this._hub.states[Jt(Tt.ANSWER)]||{};if(t&&e!==Lt.INITIAL&&(e!==Lt.READY||s)){const i=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",i),this._emit("finally",i)}super.restart()}_defaultProcessData(t){t=super._defaultProcessData(t);const{value:e}=t;return e?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:e.answer_stage}}:t}_onDataUpdate(t){if(this._questionId)return;const e=t&&t.value&&t.value.question_id;e&&(this._questionId=e,this._context._byQid.set(e,this))}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===Lt.INITIAL)return;const i=e===Lt.READY&&!s,n=e===Lt.ERRONEOUS,r=i?"done":n?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._emit(r,o),(i||n)&&this._emit("finally",o)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[Xt()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_onCitationClick({index:t}){const{value:e}=this.states[Xt()]||{},{sources:s}=e||{},i=s&&s[t-1];i&&i.product_id&&this._trackers.sources.click([i.product_id],{manual:!1})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;let{rootQuestionId:i,parentQuestionId:n,questionId:r}=this;return s.property===Tt.QUERY_SUGGESTIONS&&(r=n,n=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions"),t.context={...e,custom_context:g({root_question_id:i,parent_question_id:n,question_id:r,...s})},t}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),this._feedback._destroy(),super._destroy(t)}}class Fs extends Zt{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new Vs(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new Vs(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const Hs=Object.freeze({group:h.ASK,name:_.RELATED_QUESTIONS}),Ks=Object.freeze({[Tt.RELATED_QUESTIONS]:[ts.type,{itemType:"question"}],[Tt.QUERY]:[fs.type]}),Ys=Object.freeze({[Tt.RELATED_QUESTIONS]:{}}),Zs=Object.freeze({api:Hs,layouts:Ks,trackers:Ys});class Xs extends Ds{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(Ks),defaults:Zs}),this._productId=void 0,this._linkFn=void 0,this._unsubscribes=[...this._unsubscribes,this._views.get(Tt.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start(){if(void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:t}=this;return this._hub.update("request",zt(this._options.resolved.api,{session:t})),this}notifyViewUpdate(t=Tt.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._linkFn(t)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._linkFn(t);window.open(e,"_blank")}}const Js=Object.freeze({group:h.SEARCH,name:_.SEARCH,payload:{fl:["*"]}}),ti=Object.freeze({[Tt.QUERY]:fs.type,[Tt.PRODUCTS]:ts.type}),ei=Object.freeze({[Tt.PRODUCTS]:{}}),si=Object.freeze({api:Js,layouts:ti,trackers:ei});class ii extends Ds{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(ti),defaults:si}),this._unsubscribes.push(this._hub.on("query",(t=>this.query(t))))}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:i}=this._views.get(Tt.QUERY);i&&(s&&t&&(i.value=s),!s&&e&&i.focus()),s&&this.query({q:s})}query(t){this.restart();const{session:e}=this;return this._hub.update("request",zt(this.options.resolved.api,{payload:t,session:e})),this}notifyViewUpdate(t=Tt.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}const ni=Object.freeze({group:h.RECOMMENDATION,name:_.USER_TO_PRODUCTS,payload:{fl:["*"]}}),ri=Object.freeze({[Tt.PRODUCTS]:ts.type}),oi=Object.freeze({[Tt.PRODUCTS]:{}}),ai=Object.freeze({api:ni,layouts:ri,trackers:oi});class ci extends Ds{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(ri),defaults:ai}),b(this,{id:e}),this._context=t,t._members.set(e,this)}start(){this._sessions.start();const{session:t}=this;return this._hub.update("request",zt(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(Tt.CONTAINER),this.notifyViewUpdate(Tt.PRODUCTS),this}notifyViewUpdate(t=Tt.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:g({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class ui extends Zt{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=Nt){if(this._members.has(t))throw Error("Unit already exists: "+t);return new ci(this,t)}has(t=Nt){return this._members.has(t)}get(t=Nt){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new ci(this,t)}}class li extends Q{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new U)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const hi="miso-ask-combo";var _i=Object.freeze({__proto__:null,CLASS_PREFIX:hi});var di=Object.freeze({__proto__:null,question:"You asked...",sources:"My reply is based on the following",relatedQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});function pi({classPrefix:t=hi,circledCitationIndex:e=!0,...s}={}){return{classPrefix:t,circledCitationIndex:e,...s}}function mi(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}function fi(t){const{features:e={},logo:s=!0}=t;return Ei(t,{name:"related-resources"},!1===e.relatedResources?"":ki(t,{name:"related-resources",visibleWhen:"nonempty",logo:s},[vi(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}function gi(t){const{features:e={}}=t;return!1===e.querySuggestions?"":ki(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[vi(t,{name:"related-questions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}function yi(t){return[bi(t),wi(t),ki(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}function bi(t){return ki(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",vi(t,{name:"question",tag:"div"}),"<miso-question></miso-question>","<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}function wi(t){return ki(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",vi(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}function vi(t,{name:e,tag:s="div"}){const{classPrefix:i}=t;return`<${s} class="${i}__phrase ${i}__${e}-phrase">${function(t,e){const{phrases:s={}}=t,i=s[e]||di[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}(t,(n=e,n.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))))}</${s}>`;var n}function Ei({classPrefix:t},{name:e},s){return Ci("section",{classes:[t+"__section",`${t}__${e}`]},s)}function ki({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${t}__${i}-container`];return e&&a.push("miso-circled-citation-index"),Ci("miso-ask",{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}function Ci(t,e={},s=""){return("string"==typeof e||Array.isArray(e))&&(s=e,e={}),`<${t}${function({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${Ri(t)}="${i}"`)}return s}(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}function Ri(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}var Oi=Object.freeze({__proto__:null,root:function(t={}){return""+Ei(t=pi(t),{name:"question"},[ki(t,{name:"query"},"<miso-query></miso-query>")])+Ei(t,{name:"answer"},yi(t))+mi(t)+fi(t)},followUp:function(t={}){return Ei(t=pi(t),{name:"follow-up"},[gi(t),ki(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...yi(t)])}});const Si=Object.freeze(_i),xi=Object.freeze(di),Ii=Object.freeze(Oi);var Ai=Object.freeze({__proto__:null,constants:Si,phrases:xi,templates:Ii});const{currentScript:Ni}=document,Ti=Object.freeze({templates:Ii,autostart:!0});class Ui{constructor(){this._defaults=Ti,this._scriptSrc=function(){if(!Ni||!Ni.src)return{};const t=document.createElement("a");t.href=Ni.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Pi(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Pi(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return g({apiKey:t,apiHost:e,templates:qi(s),phrases:i,...n})}(function(...t){let e={};for(const s of t)s&&(e=$i(e,s));return e}(this._defaults,this._scriptSrc,t,this._pageUrl))}}function $i(t,e){return Object.assign(t,{...e,templates:{...t.templates,...e.templates}})}function Pi(t){return""===t||"false"!==t&&t}function qi(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(qi):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,qi);default:throw Error("Unsupported template type: "+t)}}class ji{constructor(t,{classPrefix:e=Si.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");b(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Li extends li{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Ui,this._localOptions={}}config(t={}){const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;b(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new ji(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{client:t,elements:e,resolvedOptions:s}=this,{templates:i={},features:n={}}=s,r=t.ui.asks,o=t.ui.ask;e.followUpsSection&&!1!==n.followUpQuestions&&(r.on("done",(({workflow:t})=>{e.followUpsSection.insertAdjacentHTML("beforeend",i.followUp({...s,parentQuestionId:t.questionId}))})),o.on("loading",(()=>{e.followUpsSection.innerHTML="",r.reset({root:!1})}))),e.relatedResourcesContainer&&!1!==n.relatedResources&&!1!==n.followUpQuestions&&r.on("loading",(({workflow:t})=>{e.relatedResourcesContainer.workflow=t})),o.autoQuery()}}class Mi extends B{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Di,zi,Qi;async function Bi(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Di||(Di=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return zi=zi||e.any(),Qi=Qi||await zi,Qi.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Qi}const Gi="logo",Wi="auto",Vi=Object.freeze([Gi]);function Fi(t){if(!t)return Wi;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Hi extends HTMLElement{static get observedAttributes(){return Vi}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Fi(this.getAttribute(Gi))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Wi:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Gi,e):this.removeAttribute(Gi)}async connectedCallback(){const t=this._client=await Bi(Hi);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Gi)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Fi(t)!==Fi(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Ki="parent-question-id",Yi=Object.freeze([...Hi.observedAttributes,Ki]);const Zi="unit-id",Xi=Object.freeze([...Hi.observedAttributes,Zi]);var Ji=Object.freeze({__proto__:null,MisoAskElement:class extends Hi{static get tagName(){return"miso-ask"}static get observedAttributes(){return Yi}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Ki)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Ki,t):this.removeAttribute(Ki))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Ki)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Hi{static get observedAttributes(){return Hi.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoSearchElement:class extends Hi{static get observedAttributes(){return Hi.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Hi{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Xi}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(Zi)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Zi,t):this.removeAttribute(Zi)}attributeChangedCallback(t,e,s){if(t===Zi)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const tn="role",en=Object.freeze([tn]);class sn extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return en}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(tn);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${tn}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${tn}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===tn&&this._container&&this._container._updateComponentRole(this,e,s)}}var nn=Object.freeze({__proto__:null,MisoComponentElement:sn,MisoQueryElement:class extends sn{constructor(){super({role:Tt.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends sn{constructor(){super({role:Tt.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends sn{constructor(){super({role:Tt.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends sn{constructor(){super({role:Tt.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends sn{constructor(){super({role:Tt.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends sn{constructor(){super({role:Tt.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends sn{constructor(){super({role:Tt.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends sn{constructor(){super({role:Tt.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends sn{constructor(){super({role:Tt.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends sn{constructor(){super({role:Tt.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoErrorElement:class extends sn{constructor(){super({role:Tt.ERROR})}static get tagName(){return"miso-error"}}});class rn extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(rn.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var on=Object.freeze({__proto__:null,containers:Ji,roles:nn,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends rn{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Ge});const an=Object.freeze(Ai);var cn=Object.freeze({__proto__:null,ask:an});let un,ln;async function hn(){return ln||(ln=async function(){try{let t=document.head.querySelector(`link[href="${_n()}"]`);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=_n(),document.head.appendChild(t)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if(dn(t))return;return new Promise((e=>{let s;s=setInterval((()=>{dn(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(t)}catch(t){console.error(t)}}())}function _n(){return un||(un=`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${os}/dist/css/ui.css`)}function dn(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}class pn{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class mn{constructor(t,e){this._plugin=t,this._client=e,b(this,{sources:{api:$e(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new ii(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get explore(){return this._explore||(this._explore=new Xs(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class fn{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Li(this._plugin,this._MisoClient))}}let gn,yn;async function bn(){return gn||(gn=async function(){return async function(t,{interval:e=300,timeout:s}={}){const i=t();return null!=i?i:new Promise(((i,n)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),i(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),n(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function wn(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(kt,"name",{value:"smart-answers"});const i="dev"===s||s.indexOf("beta")>0||e.debug;i&&kt.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&kt.plugins.use("std:dry-run");return window.MisoClientSA=kt,kt}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const i=window.misoSA=new e(s);return i.context.anonymous_id=await async function(){if(yn)return yn;const t=await bn();return yn=t.get("clientId")}(),i}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function vn(t){return e=>({...e,context:{...e.context,custom_context:{...En(t),...e.context&&e.context.custom_context}}})}function En({site:t,version:e}){return{source:"miso-client-script",script_version:e,attribution:"miso-smart-answers",site:t.key,uuid:I()}}kt.plugins.use(class extends Q{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Mi(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new U}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:cn};y(s,this,["layouts","combo","ready"]),b(this,{MisoClient:t}),b(t,{ui:s}),this.combo=new fn(this,t);const i=Object.values(Ls).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,combos:o,...a}=on,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];Hi.MisoClient=t,rn.MisoClient=t;for(const e of c)e.MisoClient=t;await hn();for(const t of c)O(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){b(t,{ui:new mn(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new pn(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new ui(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Fs(this,t)),e}});const{currentScript:kn}=document;async function Cn({}){await Promise.all([On()])}let Rn=!1;async function On(){if(Rn)return;if(Rn=!0,!kn)throw Error("currentScript not found");const t=kn.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=s,i.href=t,document.head.appendChild(i)}))}(s)}function Sn({value:t,...e}){if(!t)return e;const{sources:s=[],related_resources:i=[]}=t;return{value:{...t,sources:s.map(xn),related_resources:i.map(xn)},...e}}function xn({url:t,...e}){return{url:`${t}${0>t.indexOf("?")?"?":"&"}utm=smart_answers`,...e}}const In="#smart-answers";(async t=>{const{version:s,page:i,debug:r}=t;if(i.type!==e)return;if(window.miso_smart_answers_script_version)return void console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version);window.miso_smart_answers_script_version=s,r("Miso Smart Answers script version: "+s);const o=document.querySelector(In);if(!o)return void console.error("Container element not found: "+In);const[[a,c]]=await Promise.all([wn(t),Cn(t)]);!function(t,{MisoClient:e,client:s,rootElement:i}){const{site:r}=t,o=s.ui.asks,a=s.ui.ask;o.useApi({_meta:{site:r.key},source_fl:n,related_resource_fl:n}),o.useDataProcessor(Sn),o.useInteractions({preprocess:vn(t)});const{templates:c}=e.ui.defaults.ask,u=document.createElement("div");u.id="smart-answers",u.classList.add("miso-ask-combo"),i.insertAdjacentElement("afterend",u),i.remove(),(i=u).innerHTML='<section class="miso-ask-combo__section miso-ask-combo__hero">\n  <div class="miso-ask-combo__hero_phrase">Get your tech questions answered by AI,<br>based only on stories and reviews by our experts.</div>\n</section>'+c.root({features:{relatedResources:!1}});const l=i.querySelector(".miso-ask-combo__follow-ups"),h=i.querySelector(".miso-ask-combo__related-resources miso-ask");l&&(o.on("done",(t=>{l.insertAdjacentHTML("beforeend",c.followUp({parentQuestionId:t.workflow.questionId}))})),a.on("loading",(()=>{l.innerHTML="",o.reset({root:!1})}))),h&&o.on("loading",(t=>{h.workflow=t.workflow})),a.autoQuery()}(t,{MisoClient:a,client:c,rootElement:o})})(H)}();
