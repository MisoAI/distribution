!function(){"use strict";const t="home",e="answers",s="article",n="other",i=["cover_image","custom_attributes.site","created_at","product_id","published_at","snippet","title","updated_at","url"];var r="0.9.32-beta.1";var o=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const s={};for(const[t,n]of new URLSearchParams(e.search))"q"!==t&&(s[t]=""===n||n);return s}(),...function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_answers_")&&e.length>13&&"miso_answers_api_key"!==e?t[e.substring(13)]=""===s||s:e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=""===s||s:"q"!==e&&"qs"!==e||(t[e]=s);return t}()});const a={key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},c=window.location.hostname!==a.hostname;var u={...a,dev:c};function l(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const h=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),_=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var d=Object.freeze({__proto__:null,GROUP:h,NAME:_});function p(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function m(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function f(t){return null!=t?""+t:t}function g(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function y(t){return null==t}function b(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function w(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function v(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function E(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function k(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class S{constructor(t,{duration:e=0,onDuration:s,offDuration:n,state:i}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);O(s),O(n),O(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>C(this,t)),e):C(this,t),this._value=t}disconnect(){this._active=!1}}function C(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function O(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function I(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function x(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function R(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async n=>{try{await t(n),e()}catch(t){s(t)}}))}))}async function A(t,{area:e=.5,duration:s=1e3,signal:n}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((i,r)=>{const o=new S((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function T(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function $(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function N(t,e){const s=q((()=>window.localStorage.getItem(t))),n=q((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,n=e.indexOf(s);if(0>n)return;const i=n+s.length,r=e.indexOf(";",i);return decodeURIComponent(0>r?e.substring(i):e.substring(i,r))}(t))),i=s||n||""+e();return i&&!s&&q((()=>window.localStorage.setItem(t,i))),i&&!n&&q((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i))),i}function q(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function U(t){return new P(t)}class P{constructor(t){this._value=t;const e=t=>{this._value=t};w(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class L{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class j{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new L),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}var D="1.11.0-beta.7";let M;try{M=document.currentScript}catch(t){}async function z(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let n;t.onerror=()=>{n&&clearInterval(n),s()},n=setInterval((()=>{t.sheet&&(n&&clearInterval(n),e())}),100)}))}(t),await async function(t){if(F(t))return;return new Promise((e=>{let s;s=setInterval((()=>{F(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function B(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${D}/dist/css/${t}.css`}function F(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function Q(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function G(t,{depth:e=5,...s}={}){return W(t,e)}function W(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>W(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e,s){const n={};if(0>=e)return n;for(const s in t){const i=t[s];"function"!=typeof i&&(s.startsWith("_")&&"object"==typeof i&&"Object"!==i.constructor.name||(n[s]=W(i,e-1)))}return n}(t,e):t:"(...)"}function H(t){const e={},s=new Set;for(let n=t;n!==Object.prototype;n=Object.getPrototypeOf(n)){const i=Object.getOwnPropertyDescriptors(n);for(const n in i){if("constructor"===n||n.startsWith("_")||s.has(n))continue;s.add(n);const{value:r}=i[n];r&&(e[n]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}const Y=100,V=4;function K(t){const e=function({speed:t=Y,acceleration:e=V}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,n)=>{let i=t*(Math.random()+.5);return e>0&&void 0!==n&&s>n&&(i*=1+(s-n)*e/1e3),i}}(t);return(t,s,n,i)=>{const r=e(n,s);return t+Math.max(i-n,0)*r/1e3}}const Z=Symbol.for("miso:resources");class X{constructor(){this._resources=new Map;const t=window[Z]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){J(this._resources,t).resolve(e)}async get(t){return J(this._resources,t).promise}}function J(t,e){if(t.has(e))return t.get(e);const s=new L;return t.set(e,s),s}function tt(){return window[Z]||(window[Z]=new X)}class et{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new L;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class st{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{s(t)}catch(t){n(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:n})=>{try{t(s,n)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)p(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&p(s,e)}}_injectSubscribeInterface(t){b(t,this,["on","once"])}}function nt(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class it{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:nt(t,e),uuid:$()})}(t,e);w(this,{meta:s});const n=this._error=this._error.bind(this);this._events=new st({target:this,error:n,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(it,"miso:component");class rt extends it{constructor(t,e,{libName:s,keyName:n}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new L);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class ot{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new S(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class at{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const{currentScript:ct}=document,ut=ct.src.replace(/\/[^/]+$/,"").replace(/\/answers$/,"").replace(/\/search$/,"").replace(/\/discovery$/,"");async function lt({}){await Promise.all([_t()])}let ht=!1;async function _t(){if(ht)return;if(ht=!0,!ct)throw Error("currentScript not found");const t=ct.src,e=t.indexOf("?"),s=(0>e?t:t.substring(0,e)).replace(/(\.min)?\.js$/,".css");await async function(t){if(document.querySelector(`link[href="${t}"]`))return;return new Promise(((e,s)=>{const n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onload=e,n.onerror=s,n.href=t,document.head.appendChild(n)}))}(s)}function dt(t){if(t)return t.indexOf("//")>=0||t.startsWith("/")?t:`${ut}/${t}`}const pt=[{key:"cio",name:"CIO",hostname:"www.cio.com",whitepaper_hostname:"us.resources.cio.com",newsletter_mauticform_id:"37",regions:["ca","asean","in","middle-east","africa","ie","nl","uk","au","nz"],logo_image:"image/cio.png",lang:"en"},{key:"cso",name:"CSO",hostname:"www.csoonline.com",whitepaper_hostname:"us.resources.csoonline.com",regions:["asean","in","uk","au"],logo_image:"image/csoonline.jpeg",lang:"en"},{key:"networkworld",name:"Network World",hostname:"www.networkworld.com",whitepaper_hostname:"us.resources.networkworld.com",regions:[],logo_image:"image/networkworld.png",lang:"en"},{key:"computerworld",name:"Computerworld",hostname:"www.computerworld.com",whitepaper_hostname:"us.resources.computerworld.com",regions:["us","in","nl","uk","au","nz"],logo_image:"image/computerworld.png",lang:"en"},{key:"infoworld",name:"InfoWorld",hostname:"www.infoworld.com",whitepaper_hostname:"us.resources.infoworld.com",regions:[],logo_image:"image/infoworld.png",lang:"en"}].map((({logo_image:t,...e})=>({logo_image:dt(t),...e}))),mt=pt.reduce(((t,e)=>(t[e.key]=e,t)),{});function ft(t){return mt[t]}var gt=Object.freeze(function(){const i=(r=window.location.pathname).endsWith("/")?r.substring(0,r.length-1):r;var r;switch(i){case"":return{type:t};case"/smart-answers":return{type:e};default:if(u.regions.indexOf(i.substring(1))>=0)return{type:t}}const o=i.substring(1).split("/");if("article"===o[0]){const t=""+o[1];return{type:s,postId:t,product_id:`article_${u.key}_${t}`}}return{type:n}}());const yt="%cMiso",bt="color: #fff; background-color: #9033bb; padding: 2px 2px 1px 4px;";const wt=[{key:"sap",name:"SAP",image:"image/sponsor/sap.svg"}];var vt=function(){if(o.sponsor)return wt.find((t=>t.key===o.sponsor))||void 0}(),Et=Object.freeze({__proto__:null,config:o,version:r,site:u,page:gt,sponsor:vt,debug:function(...t){!function(...t){console.log(yt,bt,...t)}(...t)}}),kt="1.11.0-beta.7";const St=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class Ct{constructor(t,e){this._client=t,this._root=e,this._bulk=new et(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:n,timeout:i,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;i=i||a.timeout,(r=r||a.sendApiKeyByHeader)&&(n={...n,"X-API-KEY":o});const c="GET"!==s&&null!=e?JSON.stringify(e):void 0,u=i?AbortSignal.timeout(i):void 0,l=await(this._root._customFetch||window.fetch)(t,g({method:s,headers:n,body:c,cache:"no-cache",mode:"cors",signal:u})),h=await l.json();if(l.status>=400||h.errors){var _=Error(h.message);throw _.data=h,_.status=l.status,_}return h}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:n}={}){if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:n}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:i,status_code:r,body:o}=n[e];r>=400||i?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return i?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=St.DATA_ENDPOINT,eventEndpoint:s=St.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:n}){const i=this._client;for(const r of this._root._urlPasses)try{n=r({client:i,apiGroup:e,apiName:s,url:n})||n}catch(e){(t._error||console.error)(e)}return n}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:n}){const i=this._client;for(const r of this._root._payloadPasses)try{n=r({client:i,apiGroup:e,apiName:s,payload:n})||n}catch(e){(t._error||console.error)(e)}return n}}class Ot extends it{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:n}=s,i=n?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...i});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...i}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:n,options:{bulk:i,...r}={}}){return i?this.helpers.fetchForBulk(t,e,n):this.helpers.fetch(s,n,r)}_postprocess({response:t}){return t.data}}const{GROUP:It,NAME:xt}=d;class Rt extends Ot{constructor(t){super(t,It.INTERACTIONS)}async upload(t,e){try{return await this._run(xt.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const n=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:n,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===xt.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:n}=s;return this.helpers.sendBeacon(t,n,e),{}}return super._send({...s,options:e})}}class At{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:e,stallTimeout:s=12e4,...n}=this._options;const i=new at(s);let r;e=l(this._ac.signal,i.signal,e);return function(t,{interval:e=1e3,errorLimit:s=10,onError:n,onResponse:i,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,u=!1;function l(){o&&clearInterval(o),u=!0}const h=new j;return o=setInterval((async()=>{let e,o,_;try{if([e,o,_]=await t(r?{signal:r}:{}),u||!y(a)&&a>=_)return;y(_)||(a=_),i&&i(e,o,_),c=0}catch(t){return n&&n(t),c++,void(c>s&&(l(),h.error(t)))}h.update(e,o),o&&l()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{l(),h.abort(r.reason)})),h}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:e,onResponse:(t,e)=>{e?i.clear():this._isUpdated(r,t)&&i.touch(),r=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class Tt extends At{constructor(t,e,s,n){super(n),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:$t,NAME:Nt}=d;class qt extends Ot{constructor(t){super(t,$t.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new Ut(this,t,e);const s=await this._run(Nt.QUESTIONS,t,e);return new Ut(this,s,e)}async _questions(t,e){return this._run(Nt.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${Nt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(Nt.RELATED_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(Nt.SEARCH,t,e);return s.question_id?new Pt(this,s,e):s}async _searchGet(t,e){return this._run(`${Nt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}}class Ut extends Tt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class Pt extends Tt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),w(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:Lt,NAME:jt}=d;class Dt extends Ot{constructor(t){super(t,Lt.SEARCH)}async search(t,e){return this._run(jt.SEARCH,t,e)}async autocomplete(t,e){return this._run(jt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(jt.MGET,t,e)}}const{GROUP:Mt,NAME:zt}=d;class Bt extends Ot{constructor(t){super(t,Mt.RECOMMENDATION)}async userToProducts(t,e){return this._run(zt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(zt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(zt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(zt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(zt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(zt.PRODUCT_TO_PRODUCTS,t,e)}}class Ft extends it{constructor(t,e){super("api",t),this._client=t,this.helpers=new Ct(t,e),this.interactions=new Rt(this),this.ask=new qt(this),this.search=new Dt(this),this.recommendation=new Bt(this)}}var Qt=Object.freeze({__proto__:null,Api:Ft,ApiBase:Ot,ApiHelpers:Ct,Interactions:Rt,Ask:qt,Search:Dt,Recommendation:Bt});class Gt extends it{constructor(t){super("context",t),this._client=t}}var Wt={api:Qt,context:{Context:Gt}};class Ht{constructor(t){w(this,{install:t})}}class Yt extends rt{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Vt(this,Wt),this.plugins=new Kt(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new L);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const n=new s;return w(n,{id:t}),this._tryConfig(n,e),n;case"function":return new Ht(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,s){const n=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),i=0>e?t.length:e,r=t.lastIndexOf("/",i)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,i);return`${t.slice(0,r)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",s),document.head.appendChild(n)}const n=await(new tt).get(s);!this.isRegistered(t)&&this.register(n)}}class Vt{constructor(t,e){b(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),w(this,{classes:e})}}class Kt{constructor(t){b(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Zt=new class extends it{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Yt(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=kt,this._cmdRes=new L}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Xt=Object.freeze({__proto__:null,viewable:A,debounce:Q});const{currentScript:Jt}=document;class te extends it{static attach(){(window.MisoClients||(window.MisoClients=[])).push(te),window.MisoClient?window.MisoClient!==te&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=te}static debug(){}constructor(t){super("client",Zt),this._config(t),this.context=new Gt(this),this.api=new Ft(this,Zt),function(t){Zt._clients.push(t),Zt._events.emit("create",t)}(this)}get version(){return te.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,g(t)}_readConfigFromScriptUrl(){return g({apiKey:new URL(new Request(Jt.src||Jt.href).url).searchParams.get("api_key")||void 0})}}te.helpers=Xt,w(te,{uuid:$()});var ee=function(t){const e=Zt._pluginRoot;return Zt.MisoClient=e.MisoClient=t,b(t,Zt,["version","instances","any","meta","on","once","cmdDone"]),b(t,e,["plugins"]),t}(te);const{GROUP:se,NAME:ne}=d;let ie;class re{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||ie||(ie=N("miso_anonymous_id",$))}set anonymous_id(t){t=f(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=f(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function oe(){const t=new URLSearchParams(window.location.search);let e=g({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class ae{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],n=t[e];n!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${n}`))}return Object.freeze({...this._config})}}function ce(t){const{context:e={}}=t,s={...e.custom_context,sdk_version:kt};return s.uuid||(s.uuid=$()),{...t,context:{...e,custom_context:s}}}const ue="std:native-fetch";let le,he;const _e=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return le="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),le="borrowed",t.contentWindow.fetch}catch(t){he=t}})();const de="miso-logdump",pe="miso-logdump",me=pe+"__download-btn",fe="Miso Log";class ge{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return ve||(ve=z(B("logdump")))}();let t=document.getElementById(de);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||fe,e.classList.add(me),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=de,t.classList.add(pe),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(de),e=t&&t.querySelector("."+me);e&&(e.textContent=this._options.logDownloadButtonText||fe)}hideDownloadButton(){const t=document.getElementById(de);t&&(t.style.display="none")}download(){const t=new Blob([be(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:ye()})}return t&&"string"==typeof t?t:`miso-log.${ye()}.jsonl`}clear(){this._logs=[]}}function ye(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function be(t){return t.map((t=>JSON.stringify(G(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),we(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function we(t){return t?G(t,{depth:2}):t}let ve;const Ee="std:debug";function ke(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}ee.plugins.register(class{constructor(t={}){this._options=t,this._logs=new ge(t)}static get id(){return Ee}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Ee,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,n)=>this._handleEvent(t,n,s,e)))}_handleEvent(t,{name:e},s,n=[]){if("child"===e||"subtree"===e)return;const i=n.concat(t.meta.path);if(i.length||"create"!==e){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(e,{...s,groupName:i[2]});break;case"plugins":return void(1===i.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(i[1],i.slice(2),e,s))}this._logw(i.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:n,bulk:i,...r}){const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:n}={}}={}}=t,i="custom"===e&&s?`${e}:${s}`:e;a.push(n?`${i} (${n})`:""+i)}a.push([{...r,url:n}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,n){this._logw([t,e.join(".")],s,n)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(ke)):this._log(t,e,ke(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return ue}install(t,e){_e?(e.setCustomFetch(_e),t.debug(`<plugin:${ue}>`,"[info]",`Using ${le} native fetch`)):t.debug(`<plugin:${ue}>`,"[error]","Failed to obtain native fetch: "+he.message)}}),ee.plugins.use(class extends it{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new re(this);var s,n;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash","user_type"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:n}){return e===se.INTERACTIONS&&s===ne.UPLOAD?this._modifyPayloadForInteractions(t,n):e===se.ASK&&s===ne.QUESTIONS?this._modifyPayloadForAsk(t,n):this._modifyPayloadForOthers(t,n)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:n,anonymous_id:i}=t.context;return{...s?{user_id:s,user_hash:n}:{anonymous_id:i},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:n,user_type:i,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:n}:{anonymous_id:r};return s&&i&&(o.user_type=i),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:n}=t.context,i=g({anonymous_id:s,user_id:n});return{data:e=e.map((t=>({...i,...t})))}}}),ee.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...g({page:g({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:oe()}),...t.context}})))}}}),ee.plugins.use(class extends it{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new ae(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:s,payload:n}){if(e===h.SEARCH)if(s===_.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),ee.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(ce)}}});const Se="data-miso-product-id",Ce="default",Oe="_organic",Ie=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",HITS:"hits",ERROR:"error"}),xe=new Set([Ie.PRODUCTS,Ie.CATEGORIES,Ie.ATTRIBUTES,Ie.RESULTS,Ie.ITEMS,Ie.QUESTION,Ie.ANSWER,Ie.SOURCES,Ie.RELATED_RESOURCES,Ie.QUERY_SUGGESTIONS,Ie.RELATED_QUESTIONS,Ie.AFFILIATION,Ie.FACETS,Ie.HITS]);function Re(t){return xe.has(t)}const Ae=Object.freeze({AUTOCOMPLETE:"autocomplete"}),Te=Object.freeze({CONTAINER:"container",BANNER:"banner",LIST:"list",QUERY:"query",RADIO:"radio",FILTERS:"filters",TEXT:"text",AFFILIATION:"affiliation",ERROR:"error"}),$e=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit"}),Ne=[$e.IMPRESSION,$e.VIEWABLE,$e.CLICK,$e.SUBMIT],qe=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),Ue=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function Pe(t){if(0>Ne.indexOf(t))throw Error("Unrecognized event type: "+t)}function Le(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function je(t){if(void 0===t)return;let[e,s]=m(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function De(t){t=m(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t}function Me(...t){return!1!==t[t.length-1]&&ss(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,n=e.payload,{...s,...n,...ze("_meta",s,n)})});var s,n}))}function ze(t,e,s){const n=e&&e[t],i=s&&s[t],r=n?i?{...n,...i}:n:i;return void 0!==r?{[t]:r}:{}}function Be(...t){return!1!==t[t.length-1]&&ss(t,((t,e)=>{for(const[s,n]of Object.entries(e))t[s]=Fe(t[s],n);return t}))}function Fe(t,e){return!1===(e=je(e))[0]?e:t&&e?[e[0]||t[0],Qe(t[1],e[1])]:e||t}function Qe(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}function Ge(...t){return t.flat().filter(Boolean)}function We(t={},e={}){return!1===e||!1===t?e:{...t,...e}}function He(...t){return!1!==t[t.length-1]&&ss(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,n=e.preprocess,s&&s.length?n&&n.length?[...s,...n]:s:n)});var s,n}))}const Ye=[{key:"api",normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return g({group:s,name:t,payload:e})},merge:Me},{key:"layouts",normalize:function(t={}){if(!1===t)return!1;const{[Ie.RESULTS]:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ ${[Ie.RESULTS]}: ... }) is deprecated, use useLayouts({ ${[Ie.PRODUCTS]}: ... }) instead`),t={...s,[Ie.PRODUCTS]:e});const n={};for(const[e,s]of Object.entries(t))n[Le(e)]=je(s);return n},merge:Be},{key:"dataProcessor",normalize:De,merge:Ge},{key:"trackers",normalize:function(t){return t},merge:function(...t){return!1!==t[t.length-1]&&ss(t,((t,e)=>Object.assign(t,{...e,impression:We(t.impression,e.impression),viewable:We(t.viewable,e.viewable),click:We(t.click,e.click)})))}},{key:"interactions",normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=m(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:He},{key:"autocomplete",normalize:function(t){if(void 0===t)throw Error("Expect autocomplete options to be an object or a boolean value: "+t);"boolean"==typeof t&&(t={actor:t});const e=De(t.processData);return{...t,processData:e}},merge:function(...t){return!1!==t[t.length-1]&&ss(t,((t,e)=>Object.assign(t,{...e,api:Me(t.api,e.api),processData:Ge(t.processData,e.processData)})))}}];class Ve{constructor(){this._events=new st({target:this}),this._globals={}}_notify(t){this._events.emit(t,{name:t,value:this[t]})}}class Ke{constructor(t={},e={}){this._events=new st({target:this}),this._defaults=e,this._context=t||{},this._locals={},w(this,{resolved:new Xe(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("*",(t=>this._notify(t.name)))])}_notify(t){this._events.emit(t,{name:t,value:this.resolved[t]})}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ze{constructor(t,e,s,n,i){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?n(t):void 0,this._merge=i}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}class Xe{constructor(t){this._options=t}}for(const{key:t,normalize:e,merge:s}of Ye)Object.defineProperty(Ve.prototype,t,{get:function(){const n="_"+t;return this[n]||(this[n]=new Ze(this,this._globals,t,e,s))}}),Object.defineProperty(Ke.prototype,t,{get:function(){const n="_"+t;return this[n]||(this[n]=new Ze(this,this._locals,t,e,s))}}),Object.defineProperty(Xe.prototype,t,{get:function(){const e=this._options,n=e._context[t];return s(e._defaults[t],n&&n.get(),e._locals[t])}});const Je=["api","layouts","dataProcessor","trackers","interactions"];function ts(t,e=Je){for(const s of e)es(t,s)}function es(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const n=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+n](t){return this._options[e].merge(t),this},["clear"+n](){return this._options[e].set(),this}})}var s}function ss(t,e){let s={};for(const n of t)n&&(s=e(s,n));return g(s)}class ns extends it{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Ve}}function is(t){return t?"request:"+t:"request"}function rs(t){return t?"response:"+t:"response"}function os(t){return t?"data:"+t:"data"}function as(t){return t?"view:"+t:"view"}ts(ns.prototype);class cs{constructor(){(this._events=new st)._injectSubscribeInterface(this),this._states={},w(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class us{constructor(t){this._hub=t,this._sessionIndex=0,b(t,this,["active"])}get active(){const t=this._hub.states.session;return!(!t||!t.active)}new({force:t=!1}={}){const e=this._hub.states.session;if(e&&!e.active&&!t)return;const s=this._create();this._hub.update("session",s)}start(){const t=this._hub.states.session||this._create();t.active||this._hub.update("session",{...t,active:!0})}restart(){this._hub.update("session",this._create(!0))}_create(t=!1){return Object.freeze({active:t,uuid:$(),index:this._sessionIndex++,meta:{}})}}const ls=new Set([Ie.PRODUCTS,Ie.SOURCES,Ie.RELATED_RESOURCES]);function hs({property:t,misoId:e,request:s},{event:n,values:i,manual:r}){const o=s&&s._meta&&s._meta.question_source,a=function(t){return ls.has(t)}(t),c=n===$e.SUBMIT,u=t===Ie.AFFILIATION,l=a&&i?i.map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t)):c?void 0:[],h=a||c||!i?void 0:i.map((t=>t.text||t.id||t));return g({type:"viewable"===n?"viewable_impression":n,product_ids:l,miso_id:e,context:{custom_context:g({property:t,channel:u?i[0]&&i[0].channel:void 0,items:h,value:c?i:void 0,positions:u?i.map((t=>t.position)):void 0,trigger:r?"manual":"auto",question_source:o})}})}function _s(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class ds{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on(is(),(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...n}=t;this._emitResponse({session:e,request:n});try{const{signal:s}=this._ac||{},i={...t.options,signal:s},r=await this._source({session:e,...t,options:i});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:n,value:r._response}),r)){if(!_s(this._hub,e))break;this._emitResponse({session:e,request:n,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:n,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:n,error:t})}}_emitResponseWithSessionCheck(t){_s(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update(rs(),t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ps{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{p(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:ms,VIEWABLE:fs,CLICK:gs}=$e,{UNTRACKED:ys,TRIGGERED:bs}=qe,ws=Object.freeze({[ms]:ys,[fs]:ys,[gs]:ys});class vs{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:ws}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||ys}set(t,e,s){Pe(e),function(t){if(t!==qe.UNTRACKED&&t!==qe.TRACKING&&t!==qe.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const n of m(t))this._setOne(n,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==bs))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const n=s(e);return t.set(e,n),n}(this._states,this._getKey(t),(()=>({...ws}))))[e]=s}}const Es=[Symbol("valueless")];class ks{constructor({hub:t,role:e,valueless:s=!1,options:n}){this._hub=t,this._role=e,this._valueless=!!s,this._options=n,this._states=new vs(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s={}){if(this._valueless&&(s=e,e=Es),Pe(t),this._syncSession(),t!==$e.SUBMIT){if(0===(e=this._states.untriggered(m(e),t)).length)return;this._states.set(e,t,qe.TRIGGERED)}const n="results"===this._role?"products":this._role,i=this._getMisoId(),r=this._getRequestPayload();this._hub.trigger("interaction",hs({property:n,misoId:i,request:r},{event:t,values:this._valueless?void 0:e,meta:s}))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new vs(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[as(this._role)]}}for(const t of Ne)ks.prototype[t]=function(e,s){this._trigger(t,e,s)};class Ss{constructor(t,e){this._events=new st({target:this}),this._views=t,this._config=t._rolesConfig[e]||{},w(this,{role:e,interface:new Cs(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new ps((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===Ie.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new ks({hub:e,role:t,options:()=>this._getTrackerOptions()})}return this._tracker}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const n=this._data;this._data=e=this._sliceData(e||this._views._getData());const{session:i,status:r,ongoing:o,request:a,meta:c}=e;if(!t&&!(i&&i.active))return;if(!t&&((u=e)===(l=n)||u&&l&&u.status===l.status&&u.error===l.error&&u.value===l.value&&u.ongoing===l.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(u.session,l.session)))return;var u,l;const h=(t={},e)=>{!1!==t&&this.updateState({session:i,status:r,ongoing:o,request:a,meta:c,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:h})}catch(t){this._error(t),h({error:t})}}updateState({session:t,status:e,ongoing:s,request:n,meta:i,error:r},{silent:o=!1}={}){r&&(e=Ue.ERRONEOUS);const a=this._state=Object.freeze(g({session:t,status:e,ongoing:s,request:n,meta:i,error:r})),{role:c}=this;this.hub.update(as(c),a,{silent:o})}_getTrackerOptions(){return this._views._getTrackerOptions(this.role)}_sliceData(t){const{value:e,error:s,status:n,meta:i,...r}=t,o={value:Os(this._config.mapping||this.role)(t),status:n,data:e,meta:i,...r};return this.role===Ie.CONTAINER&&(o.meta={...i,empty:this._isContainerEmpty(e)}),g(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!Re(s))return!1;let e=t&&t[s];if(s===Ie.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Cs{constructor(t){b(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Os(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function Is(t={},e={}){return Object.freeze(g({...t,...e,facets:Object.freeze(g({...t.facets,...e.facets}))}))}class xs{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub,this._states=this._initialStates=Is({});const s=this._error=this._error.bind(this);this._events=new st({target:this,error:s}),w(this,{facets:new Rs(this,e)})}get states(){return this._states}update(t){const e=this._states,s=this._states=Is({...this._states,...t});this._events.emit("update",{updates:t,states:s,oldStates:e})}reset(){const t=this._states,e=this._states=this._initialStates;this._events.emit("reset",{states:e,oldStates:t})}apply(){this._hub.update("filters",this._states),this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){}}class Rs{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){const s=this._filters._states.facets[t];return s&&s.includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_select(t,e){const s=this._options.multiple?[...this._filters._states.facets[t]||[],e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._filters._states.facets[t].filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const As=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1}),watch:!1});function Ts(t,e){return!!e&&{...t,...e}}class $s{constructor(t,{workflow:e,extensions:s,layouts:n,roles:i=[],rolesConfig:r={},options:o}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=n,this._options=o,this._rolesConfig=r,this._containers=new Map,this._containerTracker=void 0,this._views={},this._trackers=new qs(this,i),this._filters=new xs(this);for(const t of i)this._views[t]=new Ss(this,t);w(this,{interface:new Ns(this)});const a=()=>this.syncSize();window.addEventListener("resize",a),this._unsubscribes=[()=>window.removeEventListener("resize",a),t.on(os(),(t=>this.refresh({data:t}))),o.on("trackers",(()=>this._syncTrackers())),o.on("layouts",(()=>this._syncLayouts()))],this._syncTrackers(),this._syncLayouts()}get trackers(){return this._trackers}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new Ss(this,Ie.CONTAINER);e.layout=this._createLayout(Ie.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,n]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...n,role:e,workflow:this._workflowName});if(e===Ie.CONTAINER)for(const e of this._containers.values())e.layout=t();else this.get(e).layout=t()}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,n]=e;return this._layoutFactory.create(s,{...n,role:t,workflow:this._workflowName})}get(t){return this._views[t]||(this._views[t]=new Ss(this,t))}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:n}=e._inst;t&&(s=s.filter((e=>e.role===Ie.CONTAINER||t.includes(e.role)))),n&&(s=s.filter((t=>!n.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states[os()]}_syncTrackers(){this._trackerOptions=this._options.resolved.trackers}_getTrackerOptions(t){return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:n={},...i}=t;return g({...As,...i,impression:Ts(As.impression,e),viewable:Ts(As.viewable,s),click:Ts(As.click,n)})}(this._trackerOptions&&this._trackerOptions[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=Ie.CONTAINER;this._containerTracker=new ks({hub:this._hub,role:t,valueless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class Ns{constructor(t){this._actor=t,b(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class qs{constructor(t,e){this._views=t;for(const s of e)Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,Ie.CONTAINER,{get:()=>t._getContainerTracker()})}}class Us{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){const{[os()]:e}=this._hub.states,{question_id:s}=e&&e.value||{};if(!s)return;const{request:n}=e||{},{payload:i}=n||{};this._hub.trigger("interaction",this._buildInteraction(t,{question_source:i&&i._meta&&i._meta.question_source}))}_buildInteraction({value:t,unselected:e},{question_source:s}){return{type:"feedback",context:{custom_context:{result_type:"answer",question_source:s,value:e?"unselected":t}}}}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ps{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._index=-1,this._unsubscribes=[t.on("input",(()=>this._sync())),s.on("autocomplete",(()=>this._syncOptions()))],this._sync(!0)}get active(){return!1!==this._options.resolved.autocomplete.actor}get source(){return this._source}_syncOptions(){this._sync(!0)}async _sync(t=!1){if(!this.active)return;const{input:e}=this._hub.states,s=e&&e.value&&e.value.trim()||void 0;if(i=e,(!(n=this._input)&&!i||n&&i&&n.value===i.value)&&!t)return;var n,i;this._input=e;const r=++this._index;if(this._clearTimeout(),this._abortPendingRequest({type:"new-input",message:"A new input renders previous autocomplete request obsolete."}),this._emitCompletions({index:r,input:e,status:s?Ue.LOADING:Ue.INITIAL}),s)try{const t=await this._fetchCompletions(e);if(this._index!==r)return;this._emitCompletions({index:r,input:e,status:Ue.READY,value:t.completions})}catch(t){if(this._error(t),this._index!==r)return;this._emitCompletions({index:r,input:e,status:Ue.ERRONEOUS,error:t})}}async _getCompletions(t){return await this._fetchCompletions(t)}async _fetchCompletions({value:t}){const{api:e}=this._options.resolved.autocomplete,{group:s,name:n}=e,{signal:i}=this._ac||{},r={...e.options,signal:i},o={...e.payload,q:t};return await this._source({group:s,name:n,payload:o,options:r})}_clearTimeout(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}_abortPendingRequest(t){this._ac&&this._ac.abort(t),this._ac=new AbortController}_emitCompletions(t){t.source="actor",this._hub.update(os(Ae.AUTOCOMPLETE),t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"autocomplete-actor-destroy",message:"Autocomplete actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ls{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){t=m(t);const{preprocess:e=[],handle:s}=this._options.resolved.interactions;for(const s of e)t=t.map(s);0!==t.length&&(s?s(t):this._client.api.interactions.upload(t,{merge:!0}))}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function js(t){return async({group:e,name:s,payload:n,options:i})=>{if(e===h.ASK)switch(s){case _.QUESTIONS:return t.api.ask.questions(n,i);case _.SEARCH:return t.api.ask.search(n,i)}return t.api[e]._run(s,n,i)}}class Ds{constructor({role:t,workflow:e,...s}={}){w(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const n=this._rendered.get(t),i=U(!1);e=this._preprocess({state:e,rendered:n},{skip:i.t})||e,this._updatePending(e,s),i.value||this._handleInput({state:e,rendered:n},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,R((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:n}]=this._takePending();s=Object.freeze({...s,timestamp:t});const i=this._rendered.get(this._element),r=U([]),o=U({});this._render(this._element,{state:s,rendered:i,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),n&&n(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function Ms(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function zs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Qs)(t,e,s)+(i.descriptionBlock||Ws)(t,e,s)+(i.priceBlock||Ys)(t,e,s)+(i.ctaBlock||Xs)(t,e,s)}</div>`}function Bs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Qs)(t,e,s)+(i.descriptionBlock||Ws)(t,e,s)+(i.priceBlock||Ys)(t,e,s)}</div>`}function Fs(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__item-info-container">${""+(i.titleBlock||Qs)(t,e,s)+(i.dateBlock||Hs)(t,e,s)+(i.descriptionBlock||Ws)(t,e,s)+(i.ctaBlock||Xs)(t,e,s)}</div>`}function Qs({className:t},{title:e}){return e?`<div class="${t}__item-title">${T(e)}</div>`:""}function Gs({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Ws({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${T(s)}</div>`:""}function Hs({className:t,templates:e},{created_at:s,updated_at:n,published_at:i}){const r=i||s||n;return r?`<div class="${t}__item-date">${sn(r,e.date)}</div>`:""}function Ys(t,e){const{className:s,templates:n}=t,{sale_price:i,original_price:r,currency:o="USD"}=e,a=i||r;if(!a)return"";const c=void 0!==r&&void 0!==i&&r>i,u=e.discount_rate_percent||(c?Math.floor(100*(1-i/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(n.discountRateText||Vs)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Vs(t,{discount_rate_percent:e}){return`(${e}% off)`}function Ks(t,e,s={}){const{className:n,templates:i}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${n}__item-cover-image-container">${`<img class="${n}__item-cover-image" src="${r}">`}${s.brand?(i.brandBlock||Gs)(t,e,s):""}</div>`}function Zs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Xs(t,e,s){const{className:n,templates:i}=t,r=nn.asFunction(i.cta)(t,e,s);return r?`<div class="${n}__item-cta-container">${r}</div>`:""}function Js({className:t,options:e={}},{product_id:s,url:n},{classSuffix:i="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&n?"a":"div";return[`<${l} class="${t}__${i}" ${r?`data-role="${r}"`:""} ${s?`${Se}="${s}"`:""} ${!1!==o.link&&n?`href="${n}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const tn=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),en="en-US";function sn(t,e=tn){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||tn.locale,e);default:throw Error("Invalid date format: "+e)}}const nn=Object.freeze({tagPair:Js,formatDate:sn,formatNumber:function(t,e=en){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||en.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:T,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class rn extends Ds{constructor({className:t,templates:e,...s}={}){super(s),w(this,{className:t,templates:{...Ms("root"),...e,helpers:nn}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class on extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){on.MisoClient.ui.layouts.create("banner").render(this)}}class an{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:n}=s;this._entries.set(t,{ac:s});let i=!1;try{await A(t,{...e,signal:n}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return i}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class cn extends Ds{static get category(){return Te.CONTAINER}static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new an}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=on.tagName,s=this._shallRenderBanner(t),n=t.querySelector(e);s&&!n?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&n&&n.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,n=void 0!==s&&"auto"!==s?s:e;return"auto"===n?t.components.some((({role:t})=>function(t){return t===Ie.PRODUCTS||t===Ie.ANSWER}(t))):!!n}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:n,meta:{miso_id:i,empty:r=!1}={}}=e,o=[s,r?Ue.EMPTY:Ue.NONEMPTY];s===Ue.READY&&o.push(n?Ue.ONGOING:Ue.DONE),t.setAttribute("status",o.join(" ")),i?t.setAttribute("miso-id",i):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===Ue.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const un=Object.freeze({root:function(t,e){const{className:s,templates:n}=t,{status:i,value:r}=e;return"erroneous"!==i?"":`<div class="${s}"><div class="${s}__message">${n.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class ln extends rn{static get category(){return Te.ERROR}static get type(){return"error"}static get defaultTemplates(){return un}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...un,...e},...s})}}const hn=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function _n(t,e){const s=[];for(const n of e.entries){const e=t.e2b.get(n.element);e&&e.key===n.key||s.push(n)}return s}class dn{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const n=function(t,e,s){const n=new Map,i=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});n.set(a,u),i.set(c,u),r.push(u)}return{k2b:n,e2b:i,entries:r}}(t,e,s),i={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=_n(i,n),o=_n(n,i);return this._k2b=n.k2b,this._e2b=n.e2b,this._entries=n.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function pn(t){!function(t,e){const s=Object.getOwnPropertyDescriptors(e);for(const e in s){if("constructor"===e)continue;const{value:n}=s[e];void 0===t[e]&&"function"==typeof n&&(t[e]=n)}}(t,mn.prototype)}class mn{_initTrackable(){this._bindings=new dn,this._viewables=new an}_syncBindings(t,e){const s=this._getItems(e)||[],n=s.map((t=>this._getItemKey(t))),i=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(n,s,i);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:n}of t)(async()=>{await this._viewables.track(n,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!I(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}const fn=Object.freeze({product:function(t,e,s,n){const{templates:i}=t,[r,o]=Js(t,s);return""+r+(i.imageBlock||Ks)(t,s,n)+(i.infoBlock||i.productInfoBlock||Bs)(t,s,n)+o},article:function(t,e,s,n){const{templates:i}=t,[r,o]=Js(t,s);return""+r+(i.imageBlock||Ks)(t,s,n)+(i.infoBlock||i.articleInfoBlock||Fs)(t,s,n)+(i.indexBlock||Zs)(t,s,n)+o},question:function(t,e,s){const[n,i]=Js(t,s);return`${n}${s.value||s.text||s}${i}`},root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e;return`<div class="${s} ${r}" ${n?`data-role="${n}"`:""}>${r===Ue.READY?i[r](t,e):""}</div>`},[Ue.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0||e.ongoing?s.list(t,e,n):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:n,templates:i,options:r}=t,o=i.ordered?"ol":"ul";return`<${o} class="${n}__list" data-role="list" data-item-type="${r.itemType}">${i.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:n=0}={}){const{templates:i}=t;let r=n;return s.map((s=>i.item(t,e,s,r++))).join("")},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item">${r[a](t,e,s,{index:n})}</li>`},productInfoBlock:Bs,articleInfoBlock:Fs,brandBlock:Gs,titleBlock:Qs,descriptionBlock:Ws,dateBlock:Hs,priceBlock:Ys,discountRateText:Vs,ctaBlock:Xs,cta:function(t,e,s){const{templates:n}=t,{url:i}=e;if(!i)return"";const[r,o]=Js(t,{url:i},{classSuffix:"item-cta",role:"cta"}),a=nn.asFunction(n.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:Ks,indexBlock:Zs});class gn extends rn{static get category(){return Te.LIST}static get defaultTemplates(){return fn}constructor({templates:t,itemType:e="product",...s}){super({templates:{...fn,...t},itemType:e,...s}),this._initTrackable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),n=this._html(t,e,s);return{...t,incremental:s,html:n}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.status===Ue.READY&&e.status===Ue.READY&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,n=(this._getItems(t)||[]).slice(s);return n.length>0?this.templates.items(this,t,n,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:n,html:i}=e;if(n)if(i){this._getListElement(t).insertAdjacentHTML("beforeend",i)}else s(!1);else t.innerHTML=i}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:n,element:i}=e;this._view._events.emit("click",{session:s,value:n,element:i,domEvent:t})}destroy(){this._destroyTrackable(),this._view=void 0,super.destroy()}}pn(gn.prototype);const yn="miso-list";class bn extends gn{static get category(){return super.category}static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return yn}constructor({className:t=yn,...e}={}){super({className:t,...e})}}const wn="miso-cards";const vn="miso-carousel",En=Object.freeze({ready:function(t,e){const{templates:s}=t,n=t._getItems(e),i=n&&n.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return i?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-previous" data-role="previous">${i.previous(t,e)}</div><div class="${n}__viewport">${s}</div><div class="${n}__control-next" data-role="next">${i.next(t,e)}</div>`},previous:Sn,next:Sn}),kn=Object.freeze({...gn.defaultTemplates,...En});function Sn(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Cn="miso-ui-icon",On=Cn+"-svg-1_11_0-beta_7",In=`<symbol id="${Cn}-send" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,xn=`<symbol id="${Cn}-search" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,Rn=`<symbol id="${Cn}-triangle" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,n=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-n} ${n}L${n} ${e-n}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,An=`<svg id="${On}" style="display:none;">${[In,xn,Rn].join("")}</svg>`;let Tn=!1;function $n(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${Cn}-${t}"></use></svg>`}Tn||document.head.querySelector("#"+On)||(Tn=!0,document.head.insertAdjacentHTML("beforeend",An));const Nn=$n("send"),qn=$n("search"),Un=$n("triangle"),Pn="miso-search-box";const Ln=Object.freeze({root:function(t){const{className:e,role:s,options:n,workflow:i,autocomplete:r}=t,{placeholder:o,buttonText:a}=n;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${a||"search"===i?qn:Nn}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},completions:function(t,e){const{templates:s,workflow:n,autocomplete:i}=t;t={templates:s,workflow:n,...i};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:n,templates:i}=t;return`\n<ul class="${n}__${e}-list" data-role="${e}-list">\n  ${s.map((s=>i.completionItem(t,e,s))).join("")}\n</ul>`.trim()},completionItem:function(t,e,s){const{className:n,templates:i}=t;return`\n<li class="${n}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${i[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||T(e)},product:function(t,{product:e}){const{templates:s}=t,[n,i]=s.helpers.tagPair(t,e,{role:!1});return""+n+s.imageBlock(t,e)+s.productInfoBlock(t,e)+i},imageBlock:Ks,productInfoBlock:Bs}),jn=Object.freeze({className:"miso-autocomplete",debounce:300});class Dn extends rn{static get category(){return Te.QUERY}static get type(){return"search-box"}static get defaultTemplates(){return Ln}static get defaultClassName(){return Pn}constructor({className:t=Pn,templates:e,autocomplete:s,...n}={}){super({className:t,templates:{...Ln,...e},...n}),w(this,{autocomplete:{...jn,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=Q(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on(os(Ae.AUTOCOMPLETE),(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states[os(Ae.AUTOCOMPLETE)]}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s),this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:n}){if(!e.completions)return;const{status:i=Ue.INITIAL,index:r,value:o}=e.completions;if(s&&s.completions.index===r&&s.completions.status===i)return;const a=this._context(t),{autocompleteElement:c}=a;if(!c)return;const u=a.trackItems(o);t.classList[u.length>0?"add":"remove"]("nonempty"),c.setAttribute("data-status",i),c.innerHTML=this.templates.completions(this,u),n({completions:{index:r,status:i}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Mn.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Mn(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&I(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches("input")&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let n=e;n&&n!==this._element;n=n.parentElement){if(n.matches('[data-role="submit"]')||n.matches('[data-role="button"]')||n.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(n.matches('[data-role="query-item"]')){const e=n.getAttribute("data-index"),i=this._context().data.get(parseInt(e)),r=i&&i.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:i,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(n.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[$e.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit(t)}}class Mn{static empty(){return Mn._empty||(Mn._empty=new Mn)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,n=[];for(const i in t)for(const r of t[i])r.product&&!r.product.url||(r._index=e,r._field=i,s.set(e,r),n.push(r),e++);return n}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const zn="miso-option-list";const Bn=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`\n<div class="${s}" ${n?`data-role="${n}"`:""}>\n  ${i.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:n}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>n.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${T(e.text||e)}</li>`}});class Fn extends rn{static get category(){return Te.QUERY}static get type(){return"option-list"}static get defaultTemplates(){return Bn}static get defaultClassName(){return zn}constructor({className:t=zn,templates:e,...s}={}){super({className:t,templates:{...Bn,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:n}=e;this._syncOptionValues(t,n)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const n=this._getItems(e)||[];s.classList[0===n.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;n&&(this._trackClick(t,s),this._submit(n.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}pn(Fn.prototype);const Qn=Object.freeze({...Ms("options"),root:function(t){const{className:e,role:s,templates:n}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${n.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:n}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${n.content(t,e)}\n</div>\n`}});class Gn extends rn{static get category(){return Te.RADIO}static get defaultTemplates(){return Qn}constructor({className:t,templates:e,field:s,defaultValue:n,...i}={}){super({className:t,templates:{...Qn,...e},...i}),this._field=s,this._defaultValue=n}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=I(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:n}=this._view.hub.states[this._field];s=s||void 0===n;const i=e.getAttribute("data-value");s||void 0===n||n!==i?this._select(i):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],R((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:n}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",n),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const Wn="miso-feedback",Hn=["helpful","unhelpful"];const Yn=Object.freeze({options:function(t){const{templates:e}=t;return Hn.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:n,options:i={}}=t;return`\n${!1!==i.icon?`<i class="${s}__icon">${n.icon(t,e)}</i>`:""}\n${!1!==i.text?`<span class="${s}__text">${n.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Vn extends Gn{static get category(){return super.category}static get type(){return"feedback"}static get defaultTemplates(){return Yn}static get defaultClassName(){return Wn}constructor({className:t=Wn,templates:e,...s}={}){if(super({className:t,templates:{...Yn,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const Kn="miso-text";const Zn=Object.freeze({root:function(t,{value:e}){const{className:s,role:n,options:{raw:i=!1,tag:r}}=t,o=n?`data-role="${n}"`:"",a=void 0!==e?T(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:n}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[i,r]=e;switch(i){case"date":return t=>s(t,r);case"number":return t=>n(t,r);default:return t=>""+t}}(t)(e)):"";return i?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Xn extends rn{static get category(){return Te.TEXT}static get type(){return"text"}static get defaultTemplates(){return Zn}static get defaultClassName(){return Kn}constructor({className:t=Kn,templates:e,tag:s="p",...n}={}){super({className:t,templates:{...Zn,...e},tag:s,...n})}}class Jn extends Ds{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=U(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class ti{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:n,cursor:i,done:r}){const o=n.length;i=Math.min(i,o);const a=!!r&&i===o,c=e.substring(0,s),u=!n.startsWith(c);return a||u?t.innerText=n:t.insertAdjacentText("beforeend",n.substring(s,i)),a&&t.classList.add("done"),{cursor:i,done:a}}}function ei(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:n,format:i,builtInStyles:r=!0}}=t;"auto"===n&&(n="markdown"===i?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,si(e)];r&&"markdown"===i&&a.push("miso-markdown");return`<${n} class="${a.join(" ")}" ${o} data-format="${i}"></${n}>`}(t));const n=e.children[0];return n.setAttribute("data-status",s||Ue.INITIAL),n}function si(t){return t+"__cursor"}function ni(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:n,ref:i,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${ii(n[0])}, ${ii(n[1])})`,e,""+r,i,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function ii(t){return Math.floor(100*t)/100+"ms"}const ri="miso-typewriter";class oi extends Jn{static get category(){return Te.TEXT}static get type(){return"typewriter"}static get defaultClassName(){return ri}constructor({className:t=ri,tag:e="auto",format:s="markdown",tooltip:n=!1,speed:i,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:n,...a}),w(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:K({speed:i,acceleration:r}),this._readiness=new L,"markdown"===s&&oi.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=si(this.className),{onDebug:s,onCitationLink:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:n,onDebug:ni(s)}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new ti}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:n,session:i,status:r,ongoing:o}=t,a=n&&n.answer_stage||"result",c=(l=t,(u=e)&&l&&u.session&&l.session&&u.session.uuid===l.session.uuid);var u,l;const h=e?c&&a===e.stage?e.streak:e.streak+1:0,_=c&&e&&e.doneAt||(r!==Ue.READY||o?void 0:Date.now());return this._prevState=Object.freeze(g({session:i,status:r,value:s,stage:a,streak:h,doneAt:_,done:void 0!==_}))}_render(t,{state:e,rendered:s},{notifyUpdate:n,writeToState:i,loop:r}){const o=ei(this,t,e);let a;if(s&&e.streak===s.streak){const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}else a=this._renderer.clear(o,s);i(a);const c=e.status===Ue.READY&&!a.done;n({ongoing:c},{silent:c&&(!s||s.status===Ue.READY)}),c&&r()}_onClick({target:t}){const e=t.closest('[data-role="citation-link"]');if(!e)return;const s=parseInt(e.dataset.index);Number.isNaN(s)||this._view._events.emit("citation-click",{index:s})}}const ai="miso-affiliation";const ci=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t,{status:r}=e,o=n?` data-role="${n}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===Ue.READY?i[r](t,e):""}</div>`},[Ue.READY]:function(t,e){const{templates:s}=t,n=t._getItems(e);return n&&n.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}-container">${i.control(t,e,s)}</div>`},control:function(t,e,s){const{className:n,templates:i}=t;return`<div class="${n}__control-${s}" data-role="${s}">${i.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Un},body:function(t,e){const{className:s,templates:n}=t,i=t._getItems(e);return`<div class="${s}__body">${n.list(t,e,i)}</div>`},item:function(t,e,s,n){const{className:i,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${i}__item"><div class="${i}__item-inner">${r.itemHeader(t,e,s,{index:n})}${r[a](t,e,s,{index:n})}</div></li>`},itemHeader:function(t,e,s,n){const{className:i,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=nn.asFunction(o)(t,e,s,n),a=nn.asFunction(a)(t,e,s,n),`<div class="${i}__item-header">\n  <div class="${i}__item-header-left">${o}</div>\n  <div class="${i}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,n){const{templates:i}=t,[r,o]=Js(t,s,{link:!1});return""+r+(i.infoBlock||i.affiliationInfoBlock||zs)(t,s,n)+(i.imageBlock||Ks)(t,s,{brand:!0,...n})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,n){const{className:i,templates:r}=t,o=nn.asFunction(r.logoText)(t,e,s,n)||"",a=nn.asFunction(r.logoImg)(t,e,s,n);return a?`<span class="${i}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,n){const{className:i,templates:r}=t,o=nn.asFunction(r.logoUrl)(t,e,s,n);if(!o)return"";const a=nn.asFunction(r.logoAltText)(t,e,s,n);return`<img class="${i}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),ui=Object.freeze({...gn.defaultTemplates,...ci});class li extends gn{static get category(){return Te.AFFILIATION}static get type(){return"affiliation"}static get defaultTemplates(){return ui}static get defaultClassName(){return ai}constructor({className:t=ai,templates:e,autoplay:s,...n}={}){super({className:t,itemType:"affiliation",templates:{...ci,...e},...n}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new ot(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,R((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:n}=this._view;n=n.firstElementChild,n&&(this._displayedCount=s,void 0===s?n.removeAttribute("data-item-count"):n.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const hi="miso-facets",_i="miso-facet",di="custom_attributes.";const pi=Object.freeze({root:function(t,e){const{className:s,role:n,templates:i}=t;return`<div class="${s}" ${n?`data-role="${n}"`:""}>${i.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:n={}}=e.value||{};return Object.keys(n).map((i=>s.facet(t,{field:i,entries:n[i]},e)))},facet:function(t,e,s){const{facetClassName:n=_i,templates:i}=t,{field:r}=e;return`<div class="${n}" data-role="facet" data-field="${T(r)}">${i.header(t,e,s)}${i.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:n=_i,templates:i}=t;return`<div class="${n}__header">${i.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(di)&&(e=e.substring(18)),T(e)},options:function(t,{field:e,entries:s},n){const{facetClassName:i=_i,templates:r}=t;return`<ul class="${i}__options" data-role="options">${s.map((([s,i])=>r.option(t,{field:e,value:s,count:i},n))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:n=_i,templates:i}=t;return`\n<li class="${n}__option" data-role="option" tabindex="0">\n  <span class="${n}__value">${i.value(t,e,s)}</span>\n  <span class="${n}__count">${i.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return T(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function mi(t,e){return`${t}:::${e}`}function fi(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class gi extends rn{static get category(){return Te.FILTERS}static get type(){return"facets"}static get defaultTemplates(){return pi}static get defaultClassName(){return hi}constructor({className:t=hi,templates:e,...s}={}){super({className:t,templates:{...pi,...e},...s}),this._bindings=new dn}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=fi(this._view.filters.states.facets);for(const{value:{field:e,value:s},element:n}of this._bindings.entries)this._setSelected(n,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=fi(t.facets);for(const{value:{field:t,value:s},element:n}of this._bindings.entries)e[t]&&this._setSelected(n,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),n=[],i=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;n.push(mi(t,c)),i.push({field:t,value:c}),r.push(s)}}this._bindings.update(n,i,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[T(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),n=s&&s.value;if(!n)return;const{field:i,value:r}=n;this._view.filters.facets.toggle(i,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}var yi=Object.freeze({__proto__:null,TemplateBasedLayout:rn,ContainerLayout:cn,ErrorLayout:ln,BannerLayout:class extends rn{static get category(){return Te.BANNER}static get type(){return"banner"}static get defaultTemplates(){return hn}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...hn,...e},...s})}},CollectionLayout:gn,ListLayout:bn,CardsLayout:class extends gn{static get category(){return super.category}static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return wn}constructor({className:t=wn,...e}={}){super({className:t,...e})}},CarouselLayout:class extends gn{static get category(){return super.category}static get type(){return"carousel"}static get defaultTemplates(){return kn}static get defaultClassName(){return vn}constructor({className:t=vn,templates:e,...s}={}){super({className:t,templates:{...En,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:n}=e,i=this._getItems(n);this._itemCount=i?i.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:Dn,OptionListLayout:Fn,FeedbackLayout:Vn,TextLayout:Xn,TypewriterLayout:oi,AffiliationLayout:li,FacetsLayout:gi});function bi(t){const e=function(t){if(!t)return Ue.INITIAL;const{request:e,error:s,value:n}=t;return s?Ue.ERRONEOUS:n?Ue.READY:e?Ue.LOADING:Ue.INITIAL}(t);return g({status:e,ongoing:e===Ue.READY?!!t.ongoing:void 0,...t})}function wi(t){const{request:e,value:s}=t;if(!e)return t;const{payload:n}=e||{},{q:i}=n||{};return i?{...t,value:{...s,keywords:i}}:t}function vi(t){if(!t)return;const{facets:e}=t;return g({facet_filters:Ei(e)})}function Ei(t){if(!t)return;const e={};for(const s in t){const n=t[s];n&&n.length&&(e[s]={terms:n})}return Object.keys(e).length?e:void 0}const ki=Object.freeze({[Ie.CONTAINER]:cn.type,[Ie.ERROR]:ln.type}),Si=Object.freeze({[Ie.ERROR]:{mapping:t=>t.error}});function Ci(t){return t&&t.value&&t.value.revision}class Oi extends it{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:n,options:i}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=n=n||e._client,t=Object.freeze({...t,plugin:s,client:n}),this._name=t.name,this._roles=t.roles,this._rolesConfig={...Si,...t.rolesConfig},this._extensions=s._getExtensions(n),this._options=i||new Ke(e&&e._options,function(t,{layouts:e,interactions:s,...n}={}){const i={preprocess:[e=>t._preprocessInteraction(e)]};return{...n,layouts:Be(ki,e),interactions:He(i,s)}}(this,t.defaults)),this._hub=function(t,e){const{update:s,trigger:n}=t;return t.update=(n,i,r)=>(r&&r.silent||e("update",n,i,r),s.call(t,n,i,r)),t.trigger=(...s)=>(e("trigger",...s),n.apply(t,s)),t}(new cs,((...t)=>this._log(...t))),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initReset(t)}_initProperties(){}_initActors(){const t=this._hub,e=this._client,s=this._roles,n=this._rolesConfig,i=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new us(t),this._data=new ds(t,{source:js(e),options:i}),this._views=new $s(t,{extensions:r,layouts:o,roles:s,rolesConfig:n,options:i,workflow:this._name}),this._interactions=new Ls(t,{client:e,options:i})}_initSubscriptions(){this._unsubscribes=[this._hub.on(rs(),(t=>this.updateData(t)))]}_initReset(){this.reset()}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get active(){const{session:t}=this;return!!t&&t.active}get states(){return this._hub.states}get status(){const t=this._hub.states[os()];return t&&t.status}get views(){return this._views.interface}reset(){return this._sessions.new(),this}start(){return this._sessions.start(),this}restart(){return this._sessions.restart(),this}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Ci(t);if(!y(s)){const t=Ci(this._hub.states[os()]);if(!y(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){this._sessions.start(),t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=bi(t)),t}_updateDataInHub(t){this._hub.update(os(),t)}notifyViewUpdate(t,e){return this._assertActive(),e={status:Ue.READY,session:this.session,...e},this._hub.update(as(t),e),this}get trackers(){return this._views.trackers}_preprocessInteraction({context:{custom_context:t,...e}={},...s}={}){const{group:n,name:i}=this._options.resolved.api;return{...s,context:{...e,custom_context:{api_group:n,api_name:i,...t}}}}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}_assertActive(){if(!this.active)throw Error("Unit is not active yet. Call unit.start() to activate it.")}}function Ii(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:xi(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:n}=e;if(!n)return t;n=n.map((t=>({...t})));let i=0;for(const t of n)s&&(t.channel=s),t.position=i++;return{...t,affiliation:{...e,products:n}}}(t)}function xi({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Ri)}}function Ri({id:t,deeplink:e,headline:s,description:n,currency:i,retailPrice:r,salePrice:o,discountRate:a,image:c,thumbnail:u,merchant:l,...h}){return g({id:"sovrn-"+t,title:s,description:n,cover_image:c,url:e,currency:i,original_price:r,sale_price:o,discount_rate_percent:a,brand:l&&l.name,brand_logo:l&&l.logo,custom_attributes:Ai({sovrn_id:t,thumbnail:u,merchant:l,...h})})}function Ai(t,e=""){return Object.keys(t).reduce(((s,n)=>{const i=t[n];if(void 0===i)return s;const r=e?`${e}_${n}`:n;return"object"==typeof i?{...s,...Ai(i,r)}:{...s,[r]:i}}),{})}ts(Oi.prototype);const Ti=Object.freeze({group:h.ASK,payload:{source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),$i=Object.freeze({actor:!1,api:{group:h.ASK,name:_.AUTOCOMPLETE}}),Ni=Object.freeze({[Ie.QUERY]:[Dn.type,{placeholder:"Ask a question"}],[Ie.QUESTION]:[Xn.type,{tag:"h2"}],[Ie.ANSWER]:oi.type,[Ie.FEEDBACK]:Vn.type,[Ie.SOURCES]:[bn.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[Ie.AFFILIATION]:[li.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),qi=Object.freeze({[Ie.SOURCES]:{},[Ie.AFFILIATION]:{},[Ie.PRODUCTS]:{}}),Ui=Object.freeze({api:Ti,autocomplete:$i,layouts:Ni,trackers:qi});class Pi extends Oi{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new Us(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on(as(Ie.ANSWER),(t=>this._onAnswerViewUpdate(t))),this._views.get(Ie.ANSWER).on("citation-click",(t=>this._onCitationClick(t)))]}restart(){this._questionId&&(this._questionId=void 0);const{session:t,status:e,ongoing:s}=this._hub.states[as(Ie.ANSWER)]||{};if(t&&e!==Ue.INITIAL&&(e!==Ue.READY||s)){const n=Object.freeze({session:t,status:e,ongoing:s});this._emit("interrupt",n),this._emit("finally",n)}super.restart()}get questionId(){return this._questionId}autoQuery(t={}){const{setValue:e=!0,focus:s=!0}=this._autoQuery=t,n=new URLSearchParams(window.location.search),i=n.get("q"),r=n.get("qs"),{layout:o}=this._views.get(Ie.QUERY);o&&(i&&e&&(o.value=i),!i&&s&&o.focus()),i&&this.query({q:i,qs:r})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){this.restart(),this._writeQuestionSourceToSession(t);const{session:e}=this,s=this._buildPayload(t),n=Me(this._options.resolved.api,{payload:s,session:e});this._request(n)}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.questionSource||Oe}_request(t){this._hub.update(is(),t)}_buildPayload(){throw Error("Not implemented")}_updateData(t){!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){this._writeQuestionIdFromData(t)}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Ii(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){if(!t)return;const{question_id:e}=t;this._writeQuestionId(e)}_updateUrlIfNecessary({value:t,request:e}){if(!t||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{question:s}=t,n=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source===Oe,i=new URL(window.location);s===i.searchParams.get("q")||n&&!0!==this._autoQuery.updateUrl||(i.searchParams.set("q",s),window.history.replaceState({},"",i))}_preprocessInteraction(t){return t=super._preprocessInteraction(t),t=this._writeQuestionIdToInteractions(t)}_writeQuestionIdToInteractions(t={}){const{context:e={}}=t,{custom_context:s={}}=e;let{questionId:n}=this;return{...t,context:{...e,custom_context:g({question_id:n,...s})}}}_onAnswerViewUpdate({session:t,status:e,ongoing:s}){if(e===Ue.INITIAL)return;const n=e===Ue.READY&&!s,i=e===Ue.ERRONEOUS,r=n?"done":i?"error":e,o=Object.freeze({session:t,status:e,ongoing:s});this._emit(r,o),(n||i)&&this._emit("finally",o)}_onCitationClick({index:t}){const{value:e}=this.states[os()]||{},{sources:s}=e||{},n=s&&s[t-1];n&&n.product_id&&this._trackers.sources.click([n.product_id],{manual:!1})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Object.assign(Pi,{DEFAULT_API_OPTIONS:Ti,DEFAULT_AUTOCOMPLETE_OPTIONS:$i,DEFAULT_LAYOUTS:Ni,DEFAULT_TRACKERS:qi,DEFAULT_OPTIONS:Ui});const Li=Object.freeze({...Pi.DEFAULT_API_OPTIONS,name:_.QUESTIONS,payload:{...Pi.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),ji=Object.freeze({...Pi.DEFAULT_LAYOUTS,[Ie.RELATED_RESOURCES]:[bn.type,{incremental:!0,itemType:"article"}],[Ie.QUERY_SUGGESTIONS]:Fn.type}),Di=Object.freeze({...Pi.DEFAULT_TRACKERS,[Ie.RELATED_RESOURCES]:{},[Ie.QUERY_SUGGESTIONS]:{click:{validate:t=>0===t.button}}}),Mi=Object.freeze({...Pi.DEFAULT_OPTIONS,api:Li,layouts:ji,trackers:Di});class zi extends Pi{constructor(t,e){super({name:"ask",context:t,roles:Object.keys(ji),defaults:Mi,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;w(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states[os()].value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initReset(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initReset(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:n}=this;return g({...s,question:t,parent_question_id:n,_meta:{...s._meta,question_source:e||Oe}})}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{...s}=e.custom_context||{};let{rootQuestionId:n,parentQuestionId:i,questionId:r}=this;return s.property===Ie.QUERY_SUGGESTIONS&&(r=i,i=this.previous&&this.previous.parentQuestionId,s.property="suggested_followup_questions",s.question_source=this.previous&&this.previous.session.meta.question_source),s.question_id=r,s.root_question_id=n,s.parent_question_id=i,{...t,context:{...e,custom_context:g(s)}}}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class Bi extends ns{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new zi(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new zi(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.reset()}}const Fi=Object.freeze({[Ie.QUESTION]:{mapping:Ie.KEYWORDS}});class Qi extends Pi{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,roles:Object.keys(Pi.DEFAULT_LAYOUTS),rolesConfig:Fi,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initReset(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset(),t.restart(),this._resultsSession=t.session}_buildPayload({q:t,qs:e,...s}={}){return{...s,q:t,_meta:{...s._meta,question_source:e||Oe}}}_defaultProcessData(t){return t=wi(t=super._defaultProcessData(t))}_updateDataInHub(t){switch(t.status){case Ue.INITIAL:case Ue.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}}const Gi=Object.freeze({[Ie.FACETS]:{mapping:"facet_counts"}});class Wi extends Oi{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,roles:[Ie.PRODUCTS,Ie.KEYWORDS,Ie.HITS,Ie.FACETS],rolesConfig:Gi,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("filters",(t=>this._refine(t)))]}_initReset(){}_refine(t){const{facet_counts:e}=this._hub.states[os()].value||{};this._previousFacetCounts=e,this.restart();const s=this._buildPayload({...this._superworkflow._answer._hub.states.query,filters:t}),{session:n}=this,i=Me(this._options.resolved.api,{payload:s,session:n});this._request(i)}_buildPayload({filters:t,...e}={}){return e=this._superworkflow._answer._buildPayload(e),e=this._writeFiltersToPayload({...e,filters:t}),e=this._writeQuestionIdToPayload(e),{...e,answer:!1}}_writeFiltersToPayload({filters:t,...e}={}){return g({...e,...vi(t)})}_writeQuestionIdToPayload(t){return{...t,_meta:g({...t._meta,question_id:this._superworkflow._answer.questionId})}}_request(t){this._hub.update(is(),t)}_defaultProcessData(t){return t=wi(t=super._defaultProcessData(t)),t=this._retainFacetCounts(t)}_retainFacetCounts(t){if(!this._previousFacetCounts)return t;const{status:e,value:s}=t;switch(e){case Ue.INITIAL:case Ue.LOADING:break;default:return t}return s&&s.facet_counts?t:{...t,value:{...s,facet_counts:this._previousFacetCounts}}}}const Hi=Object.freeze({...Pi.DEFAULT_API_OPTIONS,name:_.SEARCH,payload:{...Pi.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"],fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Yi=Object.freeze({...Pi.DEFAULT_LAYOUTS,[Ie.QUERY]:[Dn.type,{placeholder:""}],[Ie.QUESTION]:[Xn.type,{raw:!0}],[Ie.PRODUCTS]:[bn.type,{itemType:"article"}],[Ie.KEYWORDS]:[Xn.type,{raw:!0}],[Ie.HITS]:[Xn.type,{raw:!0,format:"number"}],[Ie.FACETS]:[gi.type]}),Vi=Object.freeze({...Pi.DEFAULT_TRACKERS}),Ki=Object.freeze({...Pi.DEFAULT_OPTIONS,api:Hi,layouts:Yi,trackers:Vi}),Zi=Object.freeze({[Ie.QUESTION]:{mapping:Ie.KEYWORDS},[Ie.FACETS]:{mapping:"facet_counts"}}),Xi=Object.freeze({ANSWER:"answer",RESULTS:"results"});class Ji extends Oi{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Object.keys(Yi),rolesConfig:Zi,defaults:Ki})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Qi(this),this._results=new Wi(this)]}_getSubworkflow(t){switch(t){case Xi.ANSWER:return this._answer;case Xi.RESULTS:return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){const t=this._hub,e=this._client,s=this._options;this._views=new tr(this),this._interactions=new Ls(t,{client:e,options:s})}_initReset(){this._results.reset(),this._answer.reset()}restart({answer:t=!0}={}){const e=this.session;this._sessions.restart();const{session:s}=this;return t||(s._answer=e._answer||e),this}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_preprocessInteraction(t){return this._answer._preprocessInteraction(t)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}class tr{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){switch(t){case Ie.PRODUCTS:case Ie.HITS:case Ie.FACETS:case Ie.KEYWORDS:return Xi.RESULTS;default:return Xi.ANSWER}}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,n=this._getSubviews(s);if(!n._containers.has(t)){for(const s of this._getAllSubviews())if(s!==n&&s._containers.has(t)){for(const n of t.components)if(s.containsElement(n))throw Error(`<${t.tagName}> cannot contain both <${n.tagName}> and <${e.tagName}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName}> with child component <${e.tagName}>.`)}n.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const er=Object.freeze({group:h.ASK,name:_.RELATED_QUESTIONS}),sr=Object.freeze({[Ie.RELATED_QUESTIONS]:[bn.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[Ie.QUERY]:[Dn.type,{placeholder:"Ask a question"}]}),nr=Object.freeze({[Ie.RELATED_QUESTIONS]:{},[Ie.CONTAINER]:{},[Ie.QUERY]:{[$e.SUBMIT]:{}}}),ir=Object.freeze({api:er,layouts:sr,trackers:nr});class rr extends Oi{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:Object.keys(sr),defaults:ir})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(Ie.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this.query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}useLink(t){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=t,this}start({relatedQuestions:t=!0}={}){if(t&&void 0===this._linkFn)throw Error("Define link mapping function before calling start()");this._sessions.start();const{session:e}=this;return t?this._hub.update(is(),Me(this._options.resolved.api,{session:e})):this.updateData({session:e,request:{},value:{related_questions:[]}}),this}notifyViewUpdate(t=Ie.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){t=super._defaultProcessData(t);let{value:e}=t;if(!e)return t;const s=e.related_questions.map(this._linkFn?t=>({text:t,url:this._getAnswersUrl(t,!0)}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query({q:t}={}){if(!this._linkFn)return;const e=this._getAnswersUrl(t);window.open(e,"_blank")}_getAnswersUrl(t,e=!1){if(!this._linkFn)return;const s=this._linkFn(t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}const or=Object.freeze({group:h.SEARCH,name:_.SEARCH,payload:{fl:["*"]}}),ar=Object.freeze({actor:!1,api:{group:h.SEARCH,name:_.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}},throttle:300}),cr=Object.freeze({[Ie.QUERY]:Dn.type,[Ie.PRODUCTS]:bn.type}),ur=Object.freeze({[Ie.PRODUCTS]:{}}),lr=Object.freeze({api:or,autocomplete:ar,layouts:cr,trackers:ur});class hr extends Oi{constructor(t,e){super({name:"search",plugin:t,client:e,roles:Object.keys(cr),defaults:lr})}_initActors(t){super._initActors(t),this._autocomplete=new Ps(this._hub,{source:js(this._client),options:this._options})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t)))]}autoQuery({setValue:t=!0,focus:e=!0}={}){const s=new URLSearchParams(window.location.search).get("q"),{layout:n}=this._views.get(Ie.QUERY);n&&(s&&t&&(n.value=s),!s&&e&&n.focus()),s&&this.query({q:s})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this.restart();const{session:e}=this,s=this._buildPayload(t),n=Me(this._options.resolved.api,{payload:s,session:e});this._request(n)}_buildPayload(t){return t}_request(t){this._hub.update(is(),t)}updateCompletions(t){return this._hub.update(os(Ae.AUTOCOMPLETE),{...t,source:"manual"}),this}notifyViewUpdate(t=Ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}ts(hr.prototype,["autocomplete"]);const _r=Object.freeze({group:h.RECOMMENDATION,name:_.USER_TO_PRODUCTS,payload:{fl:["*"]}}),dr=Object.freeze({[Ie.PRODUCTS]:bn.type}),pr=Object.freeze({[Ie.PRODUCTS]:{}}),mr=Object.freeze({api:_r,layouts:dr,trackers:pr});class fr extends Oi{constructor(t,e){super({name:"recommendation",context:t,roles:Object.keys(dr),defaults:mr,id:e})}_initProperties(t){super._initProperties(t);const{id:e}=t;w(this,{id:e})}_initReset(t){this._context._members.set(t.id,this),super._initReset(t)}start(){this._sessions.start();const{session:t}=this;return this._hub.update(is(),Me(this._options.resolved.api,{session:t})),this}startTracker(){return this.useApi(!1),this.useLayouts(!1),this._sessions.start(),this.notifyViewUpdate(Ie.CONTAINER),this.notifyViewUpdate(Ie.PRODUCTS),this}notifyViewUpdate(t=Ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_preprocessInteraction(t){t=super._preprocessInteraction(t)||{};const{context:e={}}=t,{custom_context:s={}}=e;return{...t,context:{...e,custom_context:g({unit_id:this.id,unit_instance_uuid:this.uuid,...s})}}}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class gr extends ns{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=Ce){if(this._members.has(t))throw Error("Unit already exists: "+t);return new fr(this,t)}has(t=Ce){return this._members.has(t)}get(t=Ce){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new fr(this,t)}}class yr extends it{constructor({name:t,plugin:e,MisoClient:s,...n}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=n}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new L)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var br=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var wr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class vr{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Er{constructor(t){this._context=t,w(this,{lowerCamelToKebab:k,kebabToLowerCamel:v,kebabOrSnakeToLowerCamel:E})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...n}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...n}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=E(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:n=!1}){const{classPrefix:i}=t;return`<${s} class="${n?i+"__phrase-inline":i+"__phrase"} ${i}__${e}-phrase">${this.phraseText(t,v(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,n=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof n){case"function":return n(t);case"string":return n;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:n,visibleWhen:i,logo:r=!1},o){const a=[`${t}__${n}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:i,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const n=e[t];void 0!==n&&(s+=` ${k(t)}="${n}"`)}return s}}const kr=H(new Er({...br,DEFAULT_PHRASES:wr})),Sr=H(new class extends vr{constructor(){super({helpers:kr})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:n}=this._helpers,{features:i={},logo:r=!0}=t;return n(t,{name:"related-resources"},!1===i.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:n={}}=t;return!1===n.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:kr}));function Cr(t={}){const{normalizeOptions:e,section:s,container:n}=kr,{querySuggestions:i,answerGroup:r}=Sr;return s(t=e(t),{name:"follow-up"},[i(t),n(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var Or=Object.freeze({__proto__:null,helpers:kr,sections:Sr,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=kr,{followUps:i,relatedResourcesSection:r,answerGroup:o}=Sr;return""+s(t=e(t),{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+i(t)+r(t)},followUp:Cr});const Ir=Object.freeze(br),xr=Object.freeze(wr),Rr=Object.freeze(Or);var Ar=Object.freeze({__proto__:null,constants:Ir,phrases:xr,templates:Rr,wireFollowUps:function(t,e,{template:s=Cr,...n}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const i=t.ui.asks,r=t.ui.ask;i.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...n,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",i.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:Tr}=document,$r=Object.freeze({templates:Rr,autostart:!0}),Nr=["templates","phrases","features"];class qr{constructor(){this._defaults=$r,this._scriptSrc=function(){if(!Tr||!Tr.src)return{};const t=document.createElement("a");t.href=Tr.src;const e={};for(const[s,n]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Lr(n));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Lr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:n,...i}={}){return g({apiKey:t,apiHost:e,templates:jr(s),phrases:n,...i})}(Ur(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Ur(...t){let e={};for(const s of t)s&&(e=Pr(e,s));return e}function Pr(t,e){if(!e)return t;Object.assign(t,e);for(const s of Nr)s in e&&(t[s]={...t[s],...e[s]});return t}function Lr(t){return""===t||"false"!==t&&t}function jr(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(jr):function(t,e){const s={};for(const[n,i]of Object.entries(t))s[n]=e(i);return s}(t,jr);default:throw Error("Unsupported template type: "+t)}}class Dr{constructor(t,{classPrefix:e=Ir.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");w(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Mr extends yr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new qr,this._localOptions={}}config(t={}){t=Ur(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;w(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Dr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:n}=this,{wireFollowUps:i,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=n,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&i(e,s.followUpsSection,{...n,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class zr extends rt{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Br,Fr,Qr;async function Gr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Br||(Br=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Fr=Fr||e.any(),Qr=Qr||await Fr,Qr.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Qr}const Wr="logo",Hr="auto",Yr=Object.freeze([Wr]);function Vr(t){if(!t)return Hr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Kr extends HTMLElement{static get observedAttributes(){return Yr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Vr(this.getAttribute(Wr))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Hr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Wr,e):this.removeAttribute(Wr)}async connectedCallback(){const t=this._client=await Gr(Kr);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Wr)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){Vr(t)!==Vr(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Zr="parent-question-id",Xr=Object.freeze([...Kr.observedAttributes,Zr]);const Jr="unit-id",to=Object.freeze([...Kr.observedAttributes,Jr]);var eo=Object.freeze({__proto__:null,MisoAskElement:class extends Kr{static get tagName(){return"miso-ask"}static get observedAttributes(){return Xr}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Zr)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Zr,t):this.removeAttribute(Zr))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===Zr)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends Kr{static get observedAttributes(){return Kr.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoHybridSearchElement:class extends Kr{static get observedAttributes(){return Kr.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Kr{static get observedAttributes(){return Kr.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends Kr{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return to}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(Jr)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Jr,t):this.removeAttribute(Jr)}attributeChangedCallback(t,e,s){if(t===Jr)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const so="role",no=Object.freeze([so]);class io extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return no}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(so);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${so}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${so}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===so&&this._container&&this._container._updateComponentRole(this,e,s)}}var ro=Object.freeze({__proto__:null,MisoComponentElement:io,MisoQueryElement:class extends io{constructor(){super({role:Ie.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends io{constructor(){super({role:Ie.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends io{constructor(){super({role:Ie.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends io{constructor(){super({role:Ie.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends io{constructor(){super({role:Ie.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends io{constructor(){super({role:Ie.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends io{constructor(){super({role:Ie.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends io{constructor(){super({role:Ie.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends io{constructor(){super({role:Ie.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends io{constructor(){super({role:Ie.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends io{constructor(){super({role:Ie.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends io{constructor(){super({role:Ie.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoHitsElement:class extends io{constructor(){super({role:Ie.HITS})}static get tagName(){return"miso-hits"}},MisoFacetsElement:class extends io{constructor(){super({role:Ie.FACETS})}static get tagName(){return"miso-facets"}},MisoErrorElement:class extends io{constructor(){super({role:Ie.ERROR})}static get tagName(){return"miso-error"}}});class oo extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(oo.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var ao=Object.freeze({__proto__:null,containers:eo,roles:ro,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends oo{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:on});const co="miso-hybrid-search-combo";var uo=Object.freeze({__proto__:null,CLASS_PREFIX:co,CONAINER_TAG:"miso-hybrid-search"});const lo="Show more",ho="Show less";var _o=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",hits:"${value} Results",showMore:lo,showLess:ho});const po=H(new Er({...uo,DEFAULT_PHRASES:_o})),mo=H(new class extends vr{constructor(){super({helpers:po})}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"h3"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>"])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.hits(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}hits(t){const{phrase:e}=this._helpers;return e(t,{name:"hits",tag:"div",inline:!0}).replaceAll("${value}","<miso-hits></miso-hits>")}}({helpers:po}));var fo=Object.freeze({__proto__:null,helpers:po,sections:mo,root:function(t={}){const{normalizeOptions:e,section:s,container:n}=po;t=e(t);const{answerBox:i}=mo;return""+s(t,{name:"question"},[n(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},[i(t)])+s(t,{name:"search-results"},mo.searchResultsGroup(t))}});const go="answer-box-open",yo="answer-box-shown",bo='[data-role="answer-box-toggle"]';class wo{constructor(t,e,{classPrefix:s=co,phrases:n={}}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=n,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>this.destroy()));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer.on("loading",(()=>this.hide())),e._answer.on("error",(()=>this.show())),e._answer.on("ready",(()=>this.show()))]}_handleClick({target:t,button:e}){0===e&&t.closest(bo)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer;switch(t){case Ue.ERRONEOUS:case Ue.READY:this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||ho:this._phrases.showMore||lo;for(const e of this._element.querySelectorAll(bo))e.textContent=t}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const vo={isOpen:go,shown:yo},Eo={toggleOpen:["toggle",go],open:["open",go],close:["remove",go],toggleHidden:["toggle",yo],show:["add",yo],hide:["remove",yo]};for(const[t,e]of Object.entries(vo))Object.defineProperty(wo.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(Eo))wo.prototype[t]=function(){this._updateBoxStatus(e,s),s===go&&this._syncButtonText()};const ko=Object.freeze(uo),So=Object.freeze(_o),Co=Object.freeze(fo);var Oo=Object.freeze({__proto__:null,constants:ko,phrases:So,templates:Co,wireAnswerBox:function(t,e){if(!t)throw Error("client is required");e&&new wo(t,e)}});const Io=Object.freeze(Ar),xo=Object.freeze(Oo);var Ro=Object.freeze({__proto__:null,ask:Io,hybridSearch:xo});const Ao="ui";let To,$o;async function No(){return $o||($o=z(To||(To=B(Ao))))}class qo{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Uo{constructor(t,e){this._plugin=t,this._client=e,w(this,{sources:{api:js(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new hr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Ji(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new rr(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class Po{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Mr(this._plugin,this._MisoClient))}}let Lo,jo,Do;async function Mo(){return Lo||(Lo=async function(){return async function(t,{interval:e=300,timeout:s}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let r,o;function a(){r&&clearInterval(r),o&&clearTimeout(o)}r=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),s&&s>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+s))}),s))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function zo(t){const e=function({site:t,config:e,version:s}){Object.defineProperty(ee,"name",{value:"smart-answers"});const n="dev"===s||s.indexOf("beta")>0||e.debug;n&&ee.plugins.use("std:debug",{console:{background:"#9033bb"}});(e.dry_run||t.dev)&&ee.plugins.use("std:dry-run");return window.MisoClientSA=ee,ee}(t),s=await async function({config:t},{MisoClient:e}){const s={apiKey:t.api_key};t.api_host&&(s.apiHost=`https://${t.api_host}/v1`);const n=window.misoSA=new e(s);return n.context.anonymous_id=await async function(){if(jo)return jo;const t=await Mo();return jo=t.get("clientId")}(),n}(t,{MisoClient:e});return await s.ui.ready,[e,s]}function Bo(t){return e=>({...e,context:{...e.context,custom_context:{...Fo(t),...e.context&&e.context.custom_context}}})}function Fo({site:t,page:e,config:s,version:n}){return g({source:"miso-client-script",script_version:n,attribution:"miso-smart-answers",site:t.key,user_geo:s.geo,page_type:e.type,post_id:e.postId,uuid:$()})}async function Qo(){return Do||(Do=async function(){const[[t,e]]=await Promise.all([zo(Et),lt(Et)]);return{MisoClient:t,client:e}}())}ee.plugins.use(class extends it{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new zr(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new L}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Ro};b(s,this,["layouts","combo","ready"]),w(this,{MisoClient:t}),w(t,{ui:s}),this.combo=new Po(this,t);const n=Object.values(yi).filter((t=>t.type));for(const e of n)e.MisoClient=t;for(const t of n)this.layouts.register(t);const{containers:i,roles:r,combos:o,...a}=ao,c=[...Object.values(o),...Object.values(i),...Object.values(r),...Object.values(a)];Kr.MisoClient=t,oo.MisoClient=t;for(const e of c)e.MisoClient=t;await No();for(const t of c)x(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){w(t,{ui:new Uo(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new qo(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new gr(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Bi(this,t)),e}});const Go=ee.ui.defaults.hybridSearch.templates,Wo={};const Ho=Object.freeze({ordered:!0,infoBlock:function({className:t},{title:e,snippet:s,description:n,created_at:i,updated_at:r,published_at:o,custom_attributes:a={}}){const c=ft(a.site),u=o||i||r;let l="";e&&(l+=`<div class="${t}__item-title">${e}</div>`);s?l+=`<div class="${t}__item-snippet">${s}</div>`:n&&(l+=`<div class="${t}__item-desc">${n}</div>`);const h=[];u&&h.push(`<div class="${t}__item-date">${function(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}(u)}</div>`);c&&h.push(`<div class="${t}__item-site">${c.name}</div>`);h.length>0&&(l+=`<div class="${t}__item-supplementals">${h.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}</div>`);return`<div class="${t}__item-info-container">${l}</div>`}});function Yo(t,{MisoClient:e,client:s,rootElement:n}){const{site:r,config:o}=t,a=s.ui.hybridSearch;a.useApi({_meta:g({site:r.key,user_geo:o.geo}),facets:["categories"],fq:'type:article AND ((NOT _exists_:custom_attributes.languages) OR custom_attributes.languages:"English") AND (NOT custom_attributes.is_sponsored:true)',fl:i,source_fl:i}),a.useDataProcessor(function(t){const e=function({site:t}){return({url:e,...s})=>((e=new URL(e)).host=""+t.whitepaper_hostname,{url:Ko(e=""+e),...s})}(t);return({value:t,...s})=>{if(!t)return s;const{sources:n=[],affiliation_products:i}=t;return{value:{...t,sources:n.map(Vo),affiliation_products:(i||[]).map(e)},...s}}}(t)),a.useInteractions({preprocess:Bo(t)}),a.useLayouts({sources:{templates:Ho},products:{templates:Ho}});const c=document.createElement("div");c.id="miso-search",c.classList.add("miso-hybrid-search-combo"),n.insertAdjacentElement("afterend",c),n.remove(),(n=c).innerHTML=Go.root({phrases:Wo});const{wireAnswerBox:u}=e.ui.defaults.hybridSearch;u(s,n)}function Vo({url:t,cover_image:e,...s}){return{cover_image:e||ft(s.custom_attributes.site).logo_image,url:Ko(t),...s}}function Ko(t){return`${t}${0>t.indexOf("?")?"?":"&"}utm=smart_answers`}const Zo="#miso-search";async function Xo(t){const e=document.querySelector(Zo);if(!e)return void console.error("Miso search container element not found: "+Zo);const{MisoClient:s,client:n}=await Qo();Yo(t,{MisoClient:s,client:n,rootElement:e})}const Jo='<svg fill="currentColor" viewBox="0 0 16 16">\n<path d="M12.52.55l-5,5h0L.55,12.51l3,3,12-12Zm-4,6,4-4,1,1-4,4.05ZM2.77,3.18A3.85,3.85,0,0,1,5.32,5.73h0A3.85,3.85,0,0,1,7.87,3.18h0A3.82,3.82,0,0,1,5.32.64h0A3.82,3.82,0,0,1,2.77,3.18ZM8.5,2.55h0A2,2,0,0,1,9.78,1.27h0A1.92,1.92,0,0,1,8.5,0h0A1.88,1.88,0,0,1,7.23,1.27h0A1.92,1.92,0,0,1,8.5,2.55Zm-6.36,0h0A1.92,1.92,0,0,1,3.41,1.27h0A1.88,1.88,0,0,1,2.14,0h0A1.92,1.92,0,0,1,.86,1.27h0A2,2,0,0,1,2.14,2.55ZM14.73,6.22h0a1.94,1.94,0,0,1-1.28,1.27h0a1.94,1.94,0,0,1,1.28,1.27h0A1.9,1.9,0,0,1,16,7.49h0A1.9,1.9,0,0,1,14.73,6.22Z"/>\n</svg>',ta='<svg fill="currentColor" viewBox="0 0 973.1 973.1">\n<path d="M502.29,788.199h-47c-33.1,0-60,26.9-60,60v64.9c0,33.1,26.9,60,60,60h47c33.101,0,60-26.9,60-60v-64.9 C562.29,815,535.391,788.199,502.29,788.199z M170.89,285.8l86.7,10.8c27.5,3.4,53.6-12.4,63.5-38.3c12.5-32.7,29.9-58.5,52.2-77.3c31.601-26.6,70.9-40,117.9-40 c48.7,0,87.5,12.8,116.3,38.3c28.8,25.6,43.1,56.2,43.1,92.1c0,25.8-8.1,49.4-24.3,70.8c-10.5,13.6-42.8,42.2-96.7,85.9 c-54,43.7-89.899,83.099-107.899,118.099c-18.4,35.801-24.8,75.5-26.4,115.301c-1.399,34.1,25.8,62.5,60,62.5h49 c31.2,0,57-23.9,59.8-54.9c2-22.299,5.7-39.199,11.301-50.699c9.399-19.701,33.699-45.701,72.699-78.1 C723.59,477.8,772.79,428.4,795.891,392c23-36.3,34.6-74.8,34.6-115.5c0-73.5-31.3-138-94-193.4c-62.6-55.4-147-83.1-253-83.1 c-100.8,0-182.1,27.3-244.1,82c-52.8,46.6-84.9,101.8-96.2,165.5C139.69,266.1,152.39,283.5,170.89,285.8z"/>\n</svg>',ea="miso-smart-answers";function sa({sponsor:t}){return t?`\n<div class="${ea}__sponsor">\n  <div class="${ea}__sponsor-text">Sponsored by ${t.name}</div>\n  <div class="${ea}__sponsor-logo">\n    <img src="${dt(t.image)}" alt="${t.name}">\n  </div>\n</div>`.trim():""}const na="miso-smart-answers-discovery";function ia(t,e={}){return oa("article",function(t){return`\n<miso-explore visibleWhen="ready nonempty" class="${na}__container">\n  ${function({site:t}){return`\n<div class="${na}__hero">\n  <h2 class="${na}__hero-title">${t.name} Smart Answers</h2>\n  <a class="${na}__hero-info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a>\n</div>`.trim()}(t)}\n  ${sa(t)}\n  <div class="${na}__header">\n    <a class="${na}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow" title="What is this?">\n      <i>${ta}</i>\n    </a>\n    <h4 class="${na}__title">Explore related questions</h4>\n  </div>\n  <div class="${na}__body">\n    <miso-related-questions></miso-related-questions>\n    <miso-query>${`\n<div class="miso-search-box" data-role="query">\n  <div class="miso-search-box__input-group">\n    <input class="miso-search-box__input" type="text" data-role="input" placeholder="Ask a question">\n    <button class="miso-search-box__button" type="submit" data-role="button"><div class="miso-search-box__button-inner"><i>${Jo}</i><span class="miso-search-box__button-text">Ask</span></div></button>\n  </div>  \n</div>`.trim()}</miso-query>\n  </div>\n</miso-explore>`.trim()}(t))}function ra(t,e={}){const s=oa("home",function(t){const{site:e}=t;return`\n<miso-explore visibleWhen="ready" class="${na}__inner">\n  <h3 class="${na}__title">${e.name} Smart Answers</h3>\n  ${sa(t)}\n  <p>Smart Answers is a chatbot tool designed to help you discover content, answer questions, and go deep on the topics that matter to you. <a class="${na}__info-link" href="/smart-answers" target="_blank" rel="noopener nofollow">Learn more</a></p>\n  <miso-query class="${na}__search-form">\n    <input class="${na}__search-form-input" type="text" data-role="input" placeholder="Ask a question">\n    <button class="${na}__search-form-submit" type="submit" data-role="button">\n      <i>${Jo}</i>\n      <span class="${na}__search-form-submit-text">Ask</span>\n    </button>\n  </miso-query>\n</miso-explore>`.trim()}(t),{classes:["container"]}),n=document.createElement("section");return n.classList.add(na+"__section"),n.appendChild(s),n}function oa(t,e,{classes:s=[]}={}){const n=document.createElement("div");n.classList.add(na),n.classList.add(`${na}__${t}`);for(const t of s)n.classList.add(t);return n.innerHTML=e,n}function aa(t,{client:e}){const{site:s,page:n,config:i}=t,{product_id:r}=n,o=e.ui.explore;o.useApi(g({_meta:g({site:s.key,user_geo:i.geo}),product_id:r})),o.useLink((t=>"/smart-answers?q="+encodeURIComponent(t))),o.useInteractions({preprocess:Bo(t)}),r?o.start():o.start({relatedQuestions:!1})}async function ca(t,{paragraphs:e=10}={}){const{debug:s}=t,n=(i=e,document.querySelectorAll(".article__main .article-column__content > p:not(:empty)")[i-1]);var i;if(!n)return void s("[Discovery] No block shown: cannot find the reference position for discovery block.");const{MisoClient:r,client:o}=await Qo(),a=ia(t);n.insertAdjacentElement("afterend",a),aa(t,{MisoClient:r,client:o,rootElement:a})}const ua="#explore-a-topic";async function la(t){const{debug:e}=t,s=function({}){const t=document.querySelector(ua);return t&&t.parentElement.parentElement}(t);if(!s)return void e(`[Discovery] No block shown: cannot find the reference position (${ua}) for discovery block.`);const{MisoClient:n,client:i}=await Qo(),r=ra(t);s.insertAdjacentElement("afterend",r),aa(t,{MisoClient:n,client:i,rootElement:r})}async function ha(t){const{page:e,debug:n}=t;switch(e.type){case"home":await la(t);break;case s:await ca(t);break;default:n("[Discovery] No discovery block for page type: "+e.type)}}(async t=>{const{version:s,page:n,debug:i}=t;n.type!==e&&(window.miso_smart_answers_script_version?console.warn("Miso Smart Answers script already executed: "+window.miso_smart_answers_script_version):(window.miso_smart_answers_script_version=s,i("Miso Smart Answers script version: "+s),await Promise.all([ha(t),Xo(t)])))})(Et)}();
