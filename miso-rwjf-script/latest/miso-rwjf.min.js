!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===s&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(".miso-ask-combo{margin:1rem 0}.miso-ask-combo__question-phrase{color:#a6a5bb!important;font-size:.875rem!important;font-weight:700!important;line-height:1.2;margin:2.25rem auto!important}.miso-ask-combo__related-resources-phrase,.miso-ask-combo__sources-phrase{color:#33323e;font-size:.75rem!important;font-weight:600!important;line-height:1.5;margin:1.5rem 0 1.875rem}.miso-list__item-cover-image-container:before{display:none!important}.miso-list__item-cover-image-placeholder{align-items:center;background-color:#5d2861;color:#fff;display:flex;font-size:2.5rem;font-weight:700;height:100%;justify-content:center;left:0;position:absolute;top:0;width:100%}.miso-list__item-cover-image{left:0;-o-object-fit:cover!important;object-fit:cover!important;position:absolute;top:0}.miso-list__content-type-icon{bottom:var(--miso-list-item-content-spacing);display:flex;justify-content:center;position:absolute;right:var(--miso-list-item-content-spacing);width:var(--miso-list-item-index-size)}");var t="1.11.4";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",(()=>s.abort(e.reason)))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var n=Object.freeze({__proto__:null,GROUP:s,NAME:i});function r(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function o(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){return null!=t?""+t:t}function c(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function u(t){return null==t}function l(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce(((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t)),{}))}function h(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function _(t){return t.replace(/-([a-z])/g,(t=>t[1].toUpperCase()))}function d(t){return t.replace(/[-_][a-z]/g,(t=>t[1].toUpperCase()))}function p(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class m{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:n}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);g(s),g(i),g(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!n,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>f(this,t)),e):f(this,t),this._value=t}disconnect(){this._active=!1}}function f(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function g(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function y(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function b(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function w(t){return new Promise(((e,s)=>{window.requestAnimationFrame((async i=>{try{await t(i),e()}catch(t){s(t)}}))}))}async function v(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise(((n,r)=>{const o=new m((t=>{t&&(o.disconnect(),a.disconnect(),n())}),{onDuration:s}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",(()=>{o.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))}))}))}function E(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function k(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function S(t,e){const s=O((()=>window.localStorage.getItem(t))),i=O((()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const n=i+s.length,r=e.indexOf(";",n);return decodeURIComponent(0>r?e.substring(n):e.substring(n,r))}(t))),n=s||i||""+e();return n&&!s&&O((()=>window.localStorage.setItem(t,n))),n&&!i&&O((()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,n))),n}function O(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function I(t){return new C(t)}class C{constructor(t){this._value=t;const e=t=>{this._value=t};h(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class T{constructor(){const t=this;t.promise=new Promise(((e,s)=>{t.resolve=e,t.reject=s})),Object.freeze(this)}}class x{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new T),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function A(t,e=t=>console.error(t)){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,e){try{e()}catch(e){t(e)}}(e,t);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let R;try{R=document.currentScript}catch(t){}async function N(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise(((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval((()=>{t.sheet&&(i&&clearInterval(i),e())}),100)}))}(t),await async function(t){if($(t))return;return new Promise((e=>{let s;s=setInterval((()=>{$(t)&&(s&&clearInterval(s),e())}),100)}))}(t)}(e)}catch(t){console.error(t)}}function P(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.11.4/dist/css/${t}.css`}function $(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function L(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout((()=>{e=void 0,s()}),t)}}function U(t,{depth:e=5,...s}={}){return q(t,e)}function q(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,(t=>q(t,e-1))):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const n=t[i];"function"!=typeof n&&(i.startsWith("_")&&"object"==typeof n&&"Object"!==n.constructor.name||(s[i]=q(n,e-1)))}return s}(t,e):t:"(...)"}function j(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,n]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,n)}function D(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const n=Object.getOwnPropertyDescriptors(i);for(const i in n){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=n[i];r&&(e[i]="function"==typeof r?r.bind(t):r)}}return Object.freeze(e)}function z(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let n=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(n*=1+(s-i)*e/1e3),n}}(t);return(t,s,i,n)=>{const r=e(i,s);return t+Math.max(n-i,0)*r/1e3}}const M=Symbol.for("miso:resources");class F{constructor(){this._resources=new Map;const t=window[M]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){B(this._resources,t).resolve(e)}async get(t){return B(this._resources,t).promise}}function B(t,e){if(t.has(e))return t.get(e);const s=new T;return t.set(e,s),s}function Q(){return window[M]||(window[M]=new F)}class G{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new T;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class H{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((s,i)=>{const n=e._on(t,(t=>{setTimeout((()=>n()));try{s(t)}catch(t){i(t)}}))}))}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)r(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&r(s,e)}}_injectSubscribeInterface(t){l(t,this,["on","once"])}}function V(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class W{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:V(t,e),uuid:k()})}(t,e);h(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new H({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(W,"miso:component");class K extends W{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new T);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Y{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new m(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class Z{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const J=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class X{constructor(t,e){this._client=t,this._root=e,this._bulk=new G(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:n,sendApiKeyByHeader:r}={}){const{apiKey:o,request:a={}}=this._client.options;n=n||a.timeout,(r=r||a.sendApiKeyByHeader)&&(i={...i,"X-API-KEY":o});const u="GET"!==s&&null!=e?JSON.stringify(e):void 0,l=n?AbortSignal.timeout(n):void 0,h=await(this._root._customFetch||window.fetch)(t,c({method:s,headers:i,body:u,cache:"no-cache",mode:"cors",signal:l})),_=await h.json();if(h.status>=400||_.errors){var d=Error(_.message);throw d.data=_,d.status=h.status,d}return _}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map((({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s})))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:n,status_code:r,body:o}=i[e];r>=400||n?s.reject({status_code:r,body:o}):s.resolve(o)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t,e={}){const{apiKey:s,request:i={}}=this._client.options,n=e.sendApiKeyByHeader||i.sendApiKeyByHeader,r=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(r)}/${r}`;return n?o:`${o}?api_key=${window.encodeURIComponent(s)}`}getApiEndpoint(t){const{dataEndpoint:e=J.DATA_ENDPOINT,eventEndpoint:s=J.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const n=this._client;for(const r of this._root._urlPasses)try{i=r({client:n,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const n=this._client;for(const r of this._root._payloadPasses)try{i=r({client:n,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}}class tt extends W{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,n=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,o=this._url({apiGroup:r,apiName:t,payload:e,options:s}),a={apiGroup:r,apiName:t,payload:e=this._preprocess({apiGroup:r,apiName:t,payload:e,options:s}),url:o,options:s};this._events.emit("request",{...a,...n});const c=await this._send(a),u={...a,response:c};return this._events.emit("response",{...u,...n}),this._postprocess(u)}_preprocess({apiGroup:t,apiName:e,payload:s}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,payload:i,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,i):this.helpers.fetch(s,i,r)}_postprocess({response:t}){return t.data}}const{GROUP:et,NAME:st}=n;class it extends tt{constructor(t){super(t,et.INTERACTIONS)}async upload(t,e){try{return await this._run(st.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===st.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class nt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...n}=this._options;const r=new Z(i);let o;s=e(this._ac.signal,r.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:n,signal:r}={}){if(r&&r.aborted)return[];let o,a,c=0,l=!1;function h(){o&&clearInterval(o),l=!0}const _=new x;return o=setInterval((async()=>{let e,o,d;try{if([e,o,d]=await t(r?{signal:r}:{}),l||!u(a)&&a>=d)return;u(d)||(a=d),n&&n(e,o,d),c=0}catch(t){return i&&i(t),c++,void(c>s&&(h(),_.error(t)))}_.update(e,o),o&&h()}),e),r&&r.addEventListener&&r.addEventListener("abort",(()=>{h(),_.abort(r.reason)})),_}((async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]}),{interval:t,signal:s,onResponse:(t,e)=>{e?r.clear():this._isUpdated(o,t)&&r.touch(),o=t},...n})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||t.answer.length!==e.answer.length}_revisionOf(t){return t&&t.revision}}class rt extends nt{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}const{GROUP:ot,NAME:at}=n;class ct extends tt{constructor(t){super(t,ot.ASK)}async questions(t,e={}){if(function(t){return"string"==typeof t&&"{"!==t.charAt(0)}(t))return new ut(this,t,e);const s=await this._run(at.QUESTIONS,t,e);return new ut(this,s,e)}async _questions(t,e){return this._run(at.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${at.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(at.RELATED_QUESTIONS,t,e)}async search(t,e={}){const s=await this._run(at.SEARCH,t,e);return s.question_id?new lt(this,s,e):s}async _searchGet(t,e){return this._run(`${at.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(at.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(at.SEARCH_AUTOCOMPLETE,t,e)}}class ut extends rt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class lt extends rt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),h(this,e),this._response=e}get questionId(){return this._id}}const{GROUP:ht,NAME:_t}=n;class dt extends tt{constructor(t){super(t,ht.SEARCH)}async search(t,e){return this._run(_t.SEARCH,t,e)}async autocomplete(t,e){return this._run(_t.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(_t.MGET,t,e)}}const{GROUP:pt,NAME:mt}=n;class ft extends tt{constructor(t){super(t,pt.RECOMMENDATION)}async userToProducts(t,e){return this._run(mt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(mt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(mt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(mt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(mt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(mt.PRODUCT_TO_PRODUCTS,t,e)}}class gt extends W{constructor(t,e){super("api",t),this._client=t,this.helpers=new X(t,e),this.interactions=new it(this),this.ask=new ct(this),this.search=new dt(this),this.recommendation=new ft(this)}}var yt=Object.freeze({__proto__:null,Api:gt,ApiBase:tt,ApiHelpers:X,Interactions:it,Ask:ct,Search:dt,Recommendation:ft});class bt extends W{constructor(t){super("context",t),this._client=t}}var wt={api:yt,context:{Context:bt}};class vt{constructor(t){h(this,{install:t})}}class Et extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new kt(this,wt),this.plugins=new St(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new T);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return h(i,{id:t}),this._tryConfig(i,e),i;case"function":return new vt(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),n=0>e?t.length:e,r=t.lastIndexOf("/",n)+1,o=t.indexOf(".",r),a=0>o?"":t.slice(o,n);return`${t.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new Q).get(s);!this.isRegistered(t)&&this.register(i)}}class kt{constructor(t,e){l(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","setCustomFetch","setCustomSendBeacon","whenInstalled","whenRegistered"]),h(this,{classes:e})}}class St{constructor(t){l(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Ot=new class extends W{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Et(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this.version=t,this._cmdRes=new T}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var It=Object.freeze({__proto__:null,viewable:v,debounce:L});const{currentScript:Ct}=document;class Tt extends W{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Tt),window.MisoClient?window.MisoClient!==Tt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Tt}static debug(){}constructor(t){super("client",Ot),this._config(t),this.context=new bt(this),this.api=new gt(this,Ot),function(t){Ot._clients.push(t),Ot._events.emit("create",t)}(this)}get version(){return Tt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,c(t)}_readConfigFromScriptUrl(){return c({apiKey:new URL(new Request(Ct.src||Ct.href).url).searchParams.get("api_key")||void 0})}}Tt.helpers=It,h(Tt,{uuid:k()});var xt=function(t){const e=Ot._pluginRoot;return Ot.MisoClient=e.MisoClient=t,l(t,Ot,["version","instances","any","meta","on","once","cmdDone"]),l(t,e,["plugins"]),t}(Tt);const{GROUP:At,NAME:Rt}=n;let Nt;class Pt{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||Nt||(Nt=S("miso_anonymous_id",k))}set anonymous_id(t){t=a(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=a(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}get user_type(){return this._userType}set user_type(t){this._userType=t,this._plugin._events.emit("set",`user_type = '${t}'`)}}function $t(){const t=new URLSearchParams(window.location.search);let e=c({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Lt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function Ut(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=k()),{...e,context:{...s,custom_context:i}}}const qt="std:native-fetch";let jt,Dt;const zt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return jt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),jt="borrowed",t.contentWindow.fetch}catch(t){Dt=t}})();const Mt="miso-logdump",Ft="miso-logdump",Bt=Ft+"__download-btn",Qt="Miso Log";class Gt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Kt||(Kt=N(P("logdump")))}();let t=document.getElementById(Mt);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Qt,e.classList.add(Bt),e.addEventListener("click",(()=>this.download())),t=document.createElement("div"),t.id=Mt,t.classList.add(Ft),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Mt),e=t&&t.querySelector("."+Bt);e&&(e.textContent=this._options.logDownloadButtonText||Qt)}hideDownloadButton(){const t=document.getElementById(Mt);t&&(t.style.display="none")}download(){const t=new Blob([Vt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Ht()})}return t&&"string"==typeof t?t:`miso-log.${Ht()}.jsonl`}clear(){this._logs=[]}}function Ht(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Vt(t){return t.map((t=>JSON.stringify(U(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Wt(t[e-1])]}return t}(t),{depth:10})))).join("\n")}function Wt(t){return t?U(t,{depth:2}):t}let Kt;const Yt="std:debug";function Zt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}function Jt(t,e){return Object.freeze({...t,...e,members:Xt(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function Xt(t=[],e=[]){return[...new Set([...t,...e])]}function te(t,e){let s={};for(const i of t)i&&(s=e(s,i));return c(s)}function ee(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function se(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{return Object.assign(t,{...e,payload:(s=t.payload,i=e.payload,{...s,...i,...ie("_meta",s,i)})});var s,i}))}function ie(t,e,s){const i=e&&e[t],n=s&&s[t],r=i?n?{...i,...n}:i:n;return void 0!==r?{[t]:r}:{}}xt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Gt(t)}static get id(){return Yt}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(Yt,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(s=>this._injectComponents(s,e.concat(t.meta.path)))),t.on("*",((s,i)=>this._handleEvent(t,i,s,e)))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const n=i.concat(t.meta.path);if(n.length||"create"!==e){switch(n[0]){case"client":if("api"===n[1])return void this._handleApiEvent(e,{...s,groupName:n[2]});break;case"plugins":return void(1===n.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(n[1],n.slice(2),e,s))}this._logw(n.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:n,...r}){const o=new URL(i).pathname,a=["api",t];if(n&&a.push(`(bulk ${n.bulkId})`),a.push("POST "+o),"interactions"===e){const t=r.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,n="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${n} (${i})`:""+n)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(Zt)):this._log(t,e,Zt(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return qt}install(t,e){zt?(e.setCustomFetch(zt),t.debug(`<plugin:${qt}>`,"[info]",`Using ${jt} native fetch`)):t.debug(`<plugin:${qt}>`,"[error]","Failed to obtain native fetch: "+Dt.message)}}),xt.plugins.use(class extends W{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Pt(this);var s,i;this._contexts.set(t,e),s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type"])?[i]:i).reduce(((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t)),{}))}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return e===At.INTERACTIONS&&s===Rt.UPLOAD?this._modifyPayloadForInteractions(t,i):e===At.ASK&&s===Rt.QUESTIONS?this._modifyPayloadForAsk(t,i):this._modifyPayloadForOthers(t,i)}_modifyPayloadForOthers(t,e){const{user_id:s,user_hash:i,anonymous_id:n}=t.context;return{...s?{user_id:s,user_hash:i}:{anonymous_id:n},...e}}_modifyPayloadForAsk(t,e){const{user_id:s,user_hash:i,user_type:n,anonymous_id:r}=t.context,o=s?{user_id:s,user_hash:i}:{anonymous_id:r};return s&&n&&(o.user_type=n),{...o,...e}}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i}=t.context,n=c({anonymous_id:s,user_id:i});return{data:e=e.map((t=>({...n,...t})))}}}),xt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map((t=>({...t,context:{...c({page:c({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:$t()}),...t.context}})))}}}),xt.plugins.use(class extends W{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Lt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:n,payload:r}){if(e===s.SEARCH)if(n===i.SEARCH)this._captureSearchApiRequest(t,r)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),xt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Ut)}}}),xt.plugins.use(class extends W{static get id(){return"std:api"}constructor(){super("api")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._suppressMetaObject.bind(this))}_suppressMetaObject(t){if(!this._shallSuppressMetaObject(t))return t.payload;const{payload:{_meta:e,...s}={}}=t;return s}_shallSuppressMetaObject({apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:return!0}return!1}});const ne="default",re="_organic",oe=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",SOURCES:"sources",RELATED_RESOURCES:"related_resources",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ae=new Set([oe.PRODUCTS,oe.CATEGORIES,oe.ATTRIBUTES,oe.RESULTS,oe.ITEMS,oe.QUESTION,oe.ANSWER,oe.SOURCES,oe.RELATED_RESOURCES,oe.QUERY_SUGGESTIONS,oe.RELATED_QUESTIONS,oe.AFFILIATION,oe.FACETS,oe.TOTAL]);function ce(t){return ae.has(t)}const ue=new Set([oe.PRODUCTS,oe.SOURCES,oe.RELATED_RESOURCES]);const le=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),he=[le.IMPRESSION,le.VIEWABLE,le.CLICK,le.SUBMIT,le.FEEDBACK],_e=[le.IMPRESSION,le.VIEWABLE,le.CLICK],de=new Set(_e);const pe=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),me=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty"});function fe(t){if(0>he.indexOf(t))throw Error("Unrecognized event type: "+t)}const ge=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination"});function ye(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,(t=>"_"+t.toLowerCase())))}function be(t){if(void 0===t)return;let[e,s]=o(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function we(t,e){return!1===(e=be(e))[0]?e:t&&e?[e[0]||t[0],ve(t[1],e[1])]:e||t}function ve(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const Ee=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function ke(t={}){t=ee(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Se(e);return t}function Se(t={}){return t=ee(t)}function Oe(t={},e={}){const s={...t};for(const[i,n]of Object.entries(e))void 0!==n&&(s[i]=he.includes(i)?Ie(t[i],n):n);return s}function Ie(t={},e={}){return{...t,...e}}const Ce=[{key:ge.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return c({group:s,name:t,payload:e})},merge:se},{key:ge.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${oe.PRODUCTS}: ... }) instead`),t={...s,[oe.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[ye(e)]=be(s);return i},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{for(const[s,i]of Object.entries(e))t[s]=we(t[s],i);return t}))}},{key:ge.DATA_PROCESSOR,normalize:function(t){t=o(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:ge.TRACKERS,normalize:function(t={}){t=ee(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=ke(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:Oe(t[s],i));return t}))}},{key:ge.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=o(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i}))}},{key:ge.FILTERS,normalize:ee,merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>Object.assign(t,e)))}},{key:ge.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&te(t,((t,e)=>Object.assign(t,e)))}}];class Te{constructor(){this._events=new H({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class xe{constructor(t={},e={}){this._events=new H({target:this}),this._defaults=e,this._context=t||{},this._locals={},h(this,{resolved:new Ae(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",(t=>this._notify(t)))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Ae{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class Re{constructor(t,e,s,i,n){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=n}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of Ce){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Te.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Re(this,this._globals,e,s,i))}}),Object.defineProperty(xe.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new Re(this,this._locals,e,s,i))}}),Object.defineProperty(Ae.prototype,e,{get:function(){return this._get(t)}})}const Ne=[ge.API,ge.LAYOUTS,ge.DATA_PROCESSOR,ge.TRACKERS,ge.INTERACTIONS];function Pe(t,e=Ne){for(const s of e)$e(t,s)}function $e(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}class Le extends W{constructor(t,e,s){super(t,e),this._plugin=e,this._client=s,this._options=new Te}}function Ue(t){return t?"view:"+t:"view"}Pe(Le.prototype);class qe{constructor(){(this._events=new H)._injectSubscribeInterface(this),this._states={},h(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,{silent:s=!1}={}){this._states[t]=Object.freeze(e),s||this._events.emit(t,e)}trigger(t,e){this._events.emit(t,e)}}class je{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:k(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function De(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class ze{constructor(t,{source:e,options:s}){this._hub=t,this._source=e,this._options=s,this._unsubscribes=[t.on("session",(t=>this._handleSession(t))),t.on("request",(t=>this._handleRequest(t)))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this.active&&(this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t,this._emitResponse({session:t}))}async _handleRequest(t){if(!this.active)return;const{session:e}=this._hub.states,{session:s,...i}=t;this._emitResponse({session:e,request:i});try{const{signal:s}=this._ac||{},n={...t.options,signal:s},r=await this._source({session:e,...t,options:n});if(r&&r[Symbol.asyncIterator]){let t;for await(t of(r._response&&this._emitResponseWithSessionCheck({session:e,request:i,value:r._response}),r)){if(!De(this._hub,e))break;this._emitResponse({session:e,request:i,value:t})}}else this._emitResponseWithSessionCheck({session:e,request:i,value:r})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:i,error:t})}}_emitResponseWithSessionCheck(t){De(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Me{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,(t=>t.handler===e))}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{r(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Fe,VIEWABLE:Be,CLICK:Qe}=le,{UNTRACKED:Ge,TRIGGERED:He}=pe,Ve=Object.freeze({[Fe]:Ge,[Be]:Ge,[Qe]:Ge});class We{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:Ve}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Ge}set(t,e,s){fe(e),function(t){if(t!==pe.UNTRACKED&&t!==pe.TRACKING&&t!==pe.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of o(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter((t=>this.get(t,e)!==He))}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),(()=>({...Ve}))))[e]=s}}const Ke=[Symbol("itemless")];class Ye{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new We(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){fe(t);const{options:i}=this;if(!i)return;this._syncSession();const{deduplicated:n=!0,itemless:r=!1}=i;if(n){if(r&&(e=Ke),0===(e=this._states.untriggered(o(e),t)).length)return;this._states.set(e,t,pe.TRIGGERED)}this._sendToHub({type:t,items:r?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:le.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(c({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new We(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[Ue(this._role)]}}for(const t of _e)Ye.prototype[t]=function(e,s){this._trigger(t,e,s)};class Ze{constructor(t,e){this._events=new H({target:this}),this._views=t,this._mapping=function(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}((t._roles.mappings||{})[e]||e),h(this,{role:e,interface:new Je(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Me((()=>this.element))),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===oe.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new Ye({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((n=e)===(r=i)||n&&r&&n.status===r.status&&n.error===r.error&&n.value===r.value&&n.ongoing===r.ongoing&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(n.session,r.session)))return;var n,r;const{session:o,status:a,ongoing:c,request:u,meta:l,value:h}=e,_={session:o,status:a,ongoing:c,request:u,meta:l,data:h,...Xe(e)},d=(t={},e)=>{!1!==t&&this.updateState({..._,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:d})}catch(t){this._error(t),d({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?me.ERRONEOUS:t.status;t=this._state=Object.freeze(c({...t,status:s}));const{role:i}=this;this.hub.update(Ue(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:n,...r}=t,o={value:this._mapping(t,this),status:i,data:e,meta:n,...r};return this.role===oe.CONTAINER&&(o.meta={...n,empty:this._isContainerEmpty(e)}),c(o)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!ce(s))return!1;let e=t&&t[s];if(s===oe.QUERY_SUGGESTIONS){const t=this.hub.states.suggestions;e=t&&t.value}if(e&&0!==e.length)return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Je{constructor(t){l(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Xe(t){return function(t){return t.status===me.READY&&!t.ongoing}(t)?{empty:!!ts(t)}:{}}function ts(t){const{value:e}=t;return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}function es(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class ss{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new H({target:this,error:s}),h(this,{facets:new is(this,e)}),this._unsubscribes=[t._options.on("filters",(()=>this._syncOptions()))],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return c({facets:Object.freeze({}),sort:es(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(c({...t,...e,facets:Object.freeze(c({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset(){const t=this.states;this._states=void 0;const e=this._getStates();this._events.emit("reset",{states:e,oldStates:t})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class is{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter((t=>t!==e));0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const ns=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function rs(t,e){return!!e&&{...t,...e}}class os{constructor(t,{workflow:e,extensions:s,layouts:i,roles:n,options:r}){this._hub=t,this._workflowName=e,this._extensions=s,this._layoutFactory=i,this._options=r,this._roles=n,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new ss(this);for(const t of n.members)t!==oe.CONTAINER&&(this._views[t]=new Ze(this,t));h(this,{interface:new as(this),trackers:new cs(this,n.members)});const o=()=>this.syncSize();window.addEventListener("resize",o),this._unsubscribes=[()=>window.removeEventListener("resize",o),t.on("data",(t=>this.refresh({data:t}))),r.on("layouts",(()=>this._syncLayouts()))],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new Ze(this,oe.CONTAINER);e.layout=this._createLayout(oe.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===oe.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);if(!t&&e._inst){const{includes:t,excludes:i}=e._inst;t&&(s=s.filter((e=>e.role===oe.CONTAINER||t.includes(e.role)))),i&&(s=s.filter((t=>!i.includes(t.role))))}await Promise.all(s.map((s=>s.refresh({force:t,data:e}))))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...n}=t;return c({...ns,...n,impression:rs(ns.impression,e),viewable:rs(ns.viewable,s),click:rs(ns.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=oe.CONTAINER;this._containerTracker=new Ye({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class as{constructor(t){this._actor=t,l(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map((t=>t.interface))}}class cs{constructor(t,e){this._views=t;for(const s of e)s!==oe.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,oe.CONTAINER,{get:()=>t._getContainerTracker()})}}class us{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",(t=>this._trigger(t)))]}_trigger(t){this._hub.trigger("tracker",{type:le.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class ls{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",(t=>this._handle(t)))]}_handle(t){0!==(t=o(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function hs(t){return async({group:e,name:n,payload:r,options:o})=>{if(e===s.ASK)switch(n){case i.QUESTIONS:return t.api.ask.questions(r,o);case i.SEARCH:return t.api.ask.search(r,o)}return t.api[e]._run(n,r,o)}}class _s{constructor({role:t,workflow:e,...s}={}){h(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),n=I(!1);e=this._preprocess({state:e,rendered:i},{skip:n.t})||e,this._updatePending(e,s),n.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,w((t=>this._doRaf(t))))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const n=this._rendered.get(this._element),r=I([]),o=I({});this._render(this._element,{state:s,rendered:n,timestamp:t},{notifyUpdate:r.args,writeToState:o.merge,...e}),s=Object.freeze({...s,...o.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ds(...t){return t.reduce(((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t)),{})}function ps(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||gs)(t,e,s)+(n.descriptionBlock||bs)(t,e,s)+(n.priceBlock||vs)(t,e,s)+(n.ctaBlock||Os)(t,e,s)}</div>`}function ms(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||gs)(t,e,s)+(n.descriptionBlock||bs)(t,e,s)+(n.priceBlock||vs)(t,e,s)}</div>`}function fs(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__item-info-container">${""+(n.titleBlock||gs)(t,e,s)+(n.dateBlock||ws)(t,e,s)+(n.descriptionBlock||bs)(t,e,s)+(n.ctaBlock||Os)(t,e,s)}</div>`}function gs({className:t},{title:e}){return e?`<div class="${t}__item-title">${E(e)}</div>`:""}function ys({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function bs({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${e}</div>`:s?`<div class="${t}__item-desc">${E(s)}</div>`:""}function ws({className:t,templates:e},{created_at:s,updated_at:i,published_at:n}){const r=n||s||i;return r?`<div class="${t}__item-date">${xs(r,e.date)}</div>`:""}function vs(t,e){const{className:s,templates:i}=t,{sale_price:n,original_price:r,currency:o="USD"}=e,a=n||r;if(!a)return"";const c=void 0!==r&&void 0!==n&&r>n,u=e.discount_rate_percent||(c?Math.floor(100*(1-n/r)):void 0);let l="";if(c&&(l+=`<span class="${s}__item-original-price miso-price" data-currency="${o}">${r}</span><br>`),l+=`<span class="${s}__item-price miso-price" data-currency="${o}">${a}</span>`,u){l+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Es)(t,{...e,discount_rate_percent:u})}</span>`}return`<div class="${s}__item-price-container">${l}</div>`}function Es(t,{discount_rate_percent:e}){return`(${e}% off)`}function ks(t,e,s={}){const{className:i,templates:n}=t,{cover_image:r}=e;if(!r)return"";return`<div class="${i}__item-cover-image-container">${`<img class="${i}__item-cover-image" src="${r}">`}${s.brand?(n.brandBlock||ys)(t,e,s):""}</div>`}function Ss({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Os(t,e,s){const{className:i,templates:n}=t,r=As.asFunction(n.cta)(t,e,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function Is({className:t,options:e={}},{product_id:s,url:i},{classSuffix:n="item-body",role:r="item",...o}={}){const{link:a={}}=e,{target:c="_blank",rel:u="noopener"}=a,l=!1!==o.link&&i?"a":"div";return[`<${l} class="${t}__${n}" ${r?`data-role="${r}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==o.link&&i?`href="${i}" target="${c}" rel="${u}"`:""}>`,`</${l}>`]}const Cs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Ts="en-US";function xs(t,e=Cs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Cs.locale,e);default:throw Error("Invalid date format: "+e)}}const As=Object.freeze({tagPair:Is,formatDate:xs,formatNumber:function(t,e=Ts){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||Ts.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},escapeHtml:E,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Rs extends _s{constructor({className:t,templates:e,...s}={}){super(s),h(this,{className:t,templates:{...ds("root"),...e,helpers:As}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Ns extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Ns.MisoClient.ui.layouts.create("banner").render(this)}}class Ps{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let n=!1;try{await v(t,{...e,signal:i}),n=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return n}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class $s extends _s{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Ps}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Ns.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some((({role:t})=>function(t){return t===oe.PRODUCTS||t===oe.ANSWER}(t))):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:n,empty:r=!1}={}}=e,o=[s,r?me.EMPTY:me.NONEMPTY];s===me.READY&&o.push(i?me.ONGOING:me.DONE),t.setAttribute("status",o.join(" ")),n?t.setAttribute("miso-id",n):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===me.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const Ls=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:n,value:r}=e;return"erroneous"!==n?"":`<div class="${s}"><div class="${s}__message">${i.message(t,r)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class Us extends Rs{static get type(){return"error"}static get defaultTemplates(){return Ls}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...Ls,...e},...s})}}const qs=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function js(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class Ds{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,n=new Map,r=[];for(let o=0;t.length>o;o++){const a=t[o],c=s[o],u=Object.freeze({index:o,key:a,value:e[o],element:c});i.set(a,u),n.set(c,u),r.push(u)}return{k2b:i,e2b:n,entries:r}}(t,e,s),n={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=js(n,i),o=js(i,n);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:o}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function zs(t){j(t,Ms.prototype)}class Ms{_initTrackable(){this._bindings=new Ds,this._viewables=new Ps}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map((t=>this._getItemKey(t))),n=this._getItemElements(t),{bounds:r,unbounds:o}=this._bindings.update(i,s,n);this._onBindingsUpdate(r,o)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map((({value:t})=>t)))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||0===e.button&&!e.defaultPrevented&&!!y(e.target,(t=>"A"===t.tagName&&t.href||void 0)))})(s,t)&&this._view.tracker.click([e.value])}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class Fs{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===me.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await v(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const Bs=Object.freeze({product:function(t,e,s,i){const{templates:n}=t,[r,o]=Is(t,s);return""+r+(n.imageBlock||ks)(t,s,i)+(n.infoBlock||n.productInfoBlock||ms)(t,s,i)+o},article:function(t,e,s,i){const{templates:n}=t,[r,o]=Is(t,s);return""+r+(n.imageBlock||ks)(t,s,i)+(n.infoBlock||n.articleInfoBlock||fs)(t,s,i)+(n.indexBlock||Ss)(t,s,i)+o},question:function(t,e,s){const[i,n]=Is(t,s);return`${i}${s.value||s.text||s}${n}`},root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e;return`<div class="${s} ${r}" ${i?`data-role="${i}"`:""}>${r===me.READY?n[r](t,e):""}${n.trigger(t,e)}${n.loading(t,e)}</div>`},[me.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0||e.ongoing?s.list(t,e,i):s.empty(t,e)},empty:()=>"",list:function(t,e,s){const{className:i,templates:n,options:r}=t,o=n.ordered?"ol":"ul";return`<${o} class="${i}__list" data-role="list" data-item-type="${r.itemType}">${n.items(t,e,s)}</${o}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:n}=t;let r=i;return s.map((s=>n.item(t,e,s,r++))).join("")},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item">${r[a](t,e,s,{index:i})}</li>`},productInfoBlock:ms,articleInfoBlock:fs,brandBlock:ys,titleBlock:gs,descriptionBlock:bs,dateBlock:ws,priceBlock:vs,discountRateText:Es,ctaBlock:Os,cta:function(t,e,s){const{templates:i}=t,{url:n}=e;if(!n)return"";const[r,o]=Is(t,{url:n},{classSuffix:"item-cta",role:"cta"}),a=As.asFunction(i.ctaText)(t,e,s);return a?`${r}${a}${o}`:""},imageBlock:ks,indexBlock:Ss,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class Qs extends Rs{static get defaultTemplates(){return Bs}constructor({templates:t,itemType:e="product",...s}){super({templates:{...Bs,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:n}=e;if(i)if(n){this._getListElement(t).insertAdjacentHTML("beforeend",n)}else s(!1);else t.innerHTML=n}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:n}=e;this._view._events.emit("click",{session:s,value:i,element:n,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}zs(Qs.prototype),j(Qs.prototype,Fs.prototype);const Gs="miso-list";class Hs extends Qs{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Gs}constructor({className:t=Gs,...e}={}){super({className:t,...e})}}const Vs="miso-cards";const Ws="miso-carousel",Ks=Object.freeze({ready:function(t,e){const{templates:s}=t,i=t._getItems(e),n=i&&i.length>0,r=Object.getPrototypeOf(t.constructor).defaultTemplates.ready(t,e);return n?s.carousel(t,e,r):r},carousel:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-previous" data-role="previous">${n.previous(t,e)}</div><div class="${i}__viewport">${s}</div><div class="${i}__control-next" data-role="next">${n.next(t,e)}</div>`},previous:Zs,next:Zs}),Ys=Object.freeze({...Qs.defaultTemplates,...Ks});function Zs(t){const{className:e}=t;return`<svg class="${e}__control-button" shape-rendering="geometricPrecision" stroke="currentColor" stroke-width="24" fill="#fff" viewBox="-30 -30 358 572"><path d="M285.77 441c16.24 16.17 16.32 42.46.15 58.7-16.16 16.24-42.45 16.32-58.69.16l-215-214.47c-16.24-16.16-16.32-42.45-.15-58.69L227.23 12.08c16.24-16.17 42.53-16.09 58.69.15 16.17 16.24 16.09 42.54-.15 58.7l-185.5 185.04L285.77 441z"/></svg>`}const Js="miso-ui-icon",Xs=Js+"-svg-1_11_4",ti={SEND:"send",SEARCH:"search",TRIANGLE:"triangle"},ei=`<symbol id="${Js}-${ti.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,si=`<symbol id="${Js}-${ti.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,ii=`<symbol id="${Js}-${ti.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,ni=`<svg id="${Xs}" style="display:none;">${[ei,si,ii].join("")}</svg>`;let ri=!1;function oi(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${Js}-${t}"></use></svg>`}ri||document.head.querySelector("#"+Xs)||(ri=!0,document.head.insertAdjacentHTML("beforeend",ni));const ai=new Set(Object.values(ti));oi(ti.SEND),oi(ti.SEARCH);const ci=oi(ti.TRIANGLE),ui="miso-search-box";const li=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:n,autocomplete:r}=t,{placeholder:o}=n;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${o?`placeholder="${o}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:n}=e;var r;return("function"==typeof i?i(t):""+i)+("function"==typeof n?n(t):(ai.has(r=n)?oi(r):"")||""+n)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:n}=t;t={templates:s,workflow:i,...n};const r=[],o=[];for(const t of e)(t.product?r:o).push(t);return s.queries(t,o)+(o.length>0&&r.length>0?"<hr>":"")+s.products(t,r)},completionList:function(t,e,s){const{className:i,templates:n}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map((s=>n.completionItem(t,e,s))).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:n}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${n[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||E(e)},product:function(t,{product:e}){const{templates:s}=t,[i,n]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+n},imageBlock:ks,productInfoBlock:ms}),hi=Object.freeze({className:"miso-autocomplete",debounce:300});class _i extends Rs{static get type(){return"search-box"}static get defaultTemplates(){return li}static get defaultClassName(){return ui}constructor({className:t=ui,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...li,...e},...i}),h(this,{autocomplete:{...hi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=L(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",(t=>this._syncInput(t))),e.on("keydown",(t=>this._handleKeyDown(t))),e.on("click",(t=>this._handleClick(t))),e.on("focusin",(t=>this._handleFocusIn(t))),e.on("focusout",(t=>this._handleFocusOut(t))),s.on("completions",(()=>t.refresh({force:!0})))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:n=me.INITIAL,session:r,value:o}=e.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===n)return;const c=this._context(t),{autocompleteElement:u}=c;if(!u)return;const l=c.trackItems(o);t.classList[l.length>0?"add":"remove"]("nonempty"),u.setAttribute("data-status",n),u.innerHTML=this.templates.completions(this,l),i({completions:{index:a,status:n}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return di.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new di(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce((()=>s._view.hub.update("input",{value:e})))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&y(t,(t=>t===this._element||void 0))||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),n=this._context().data.get(parseInt(e)),r=n&&n.text;return r&&(s&&(s.value=r),this._view._events.emit("select",Object.freeze({value:n,index:e,domEvent:t})),t.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[le.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class di{static empty(){return di._empty||(di._empty=new di)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const n in t)for(const r of t[n])r.product&&!r.product.url||(r._index=e,r._field=n,s.set(e,r),i.push(r),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const pi="miso-option-list";const mi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${n.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map(((e,s)=>i.option(t,e,{index:s}))).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${E(e.text||e)}</li>`}});class fi extends Rs{static get type(){return"option-list"}static get defaultTemplates(){return mi}static get defaultClassName(){return pi}constructor({className:t=pi,templates:e,...s}={}){super({className:t,templates:{...mi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("suggestions",(()=>this._handleInput()))]}_preprocess(){return super._preprocess({state:this._view.hub.states.suggestions})}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;const i=this._getItems(e)||[];s.classList[0===i.length?"add":"remove"]("empty")}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._submit(i.text))}async _submit(t){t&&this._view.hub.update("query",{q:t})}destroy(){this._destroyTrackable(),super.destroy()}}zs(fi.prototype);const gi=Object.freeze({...ds("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class yi extends Rs{static get defaultTemplates(){return gi}constructor({className:t,templates:e,field:s,defaultValue:i,...n}={}){super({className:t,templates:{...gi,...e},...n}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,(()=>this._refresh())),e.on("click",(t=>this._handleClick(t)))],this._defaultValue?this._select(this._defaultValue):this._clear()}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=y(t,(t=>t.hasAttribute("data-value")?t:void 0));if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const n=e.getAttribute("data-value");s||void 0===i||i!==n?this._select(n):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],w((()=>this._syncValueAttribute()))}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t){this._submit({value:t})}_clear(){this._submit({unselected:!0})}async _submit(t){this._view.hub.update(this._field,t)}}const bi="miso-feedback",wi=["helpful","unhelpful"];const vi=Object.freeze({options:function(t){const{templates:e}=t;return wi.map((s=>e.option(t,{value:s}))).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:n={}}=t;return`\n${!1!==n.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==n.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class Ei extends yi{static get type(){return"feedback"}static get defaultTemplates(){return vi}static get defaultClassName(){return bi}constructor({className:t=bi,templates:e,...s}={}){if(super({className:t,templates:{...vi,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const ki="miso-text";const Si=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:n=!1,tag:r}}=t,o=i?`data-role="${i}"`:"",a=void 0!==e?E(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[n,r]=e;switch(n){case"date":return t=>s(t,r);case"number":return t=>i(t,r);default:return t=>""+t}}(t)(e)):"";return n?a:`<${r} class="${s}" ${o}>${a}</${r}>`}});class Oi extends Rs{static get type(){return"text"}static get defaultTemplates(){return Si}static get defaultClassName(){return ki}constructor({className:t=ki,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...Si,...e},tag:s,...i})}}class Ii extends _s{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=I(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class Ci{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:n,done:r}){const o=i.length;n=Math.min(n,o);const a=!!r&&n===o,c=e.substring(0,s),u=!i.startsWith(c);return a||u?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,n)),a&&t.classList.add("done"),{cursor:n,done:a}}}function Ti(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:n,builtInStyles:r=!0}}=t;"auto"===i&&(i="markdown"===n?"div":"p");const o=s?`data-role="${s}"`:"",a=[e,xi(e)];r&&"markdown"===n&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${o} data-format="${n}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||me.INITIAL),i}function xi(t){return t+"__cursor"}function Ai(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:n,operation:r,conflict:o}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${Ri(i[0])}, ${Ri(i[1])})`,e,""+r,n,o)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function Ri(t){return Math.floor(100*t)/100+"ms"}const Ni="miso-typewriter";class Pi extends Ii{static get type(){return"typewriter"}static get defaultClassName(){return Ni}constructor({className:t=Ni,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:n,acceleration:r,nextCursorFn:o,...a}={}){super({tag:e,format:s,tooltip:i,...a}),h(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof o?o:z({speed:n,acceleration:r}),this._readiness=new T,"markdown"===s&&Pi.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=xi(this.className),{onDebug:s,onCitationLink:i,variant:n}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:Ai(s),variant:n}),this._unsubscribes.push(this._view.proxyElement.on("click",(t=>this._onClick(t))))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new Ci}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:s="",meta:i,session:n,status:r,ongoing:o}=t,a=i&&i.answer_stage||"result",u=(h=t,(l=e)&&h&&l.session&&h.session&&l.session.uuid===h.session.uuid);var l,h;const _=e?u&&a===e.stage?e.streak:e.streak+1:0,d=u&&e&&e.doneAt||(r!==me.READY||o?void 0:Date.now());return this._prevState=Object.freeze(c({session:n,status:r,value:s,stage:a,streak:_,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:n,loop:r}){const o=Ti(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(o,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(o,s,{...e,cursor:t})}n(a);const u=e.status===me.READY&&!a.done;i({ongoing:u},{silent:u&&(!s||s.status===me.READY)&&!c}),u&&r()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._events.emit("citation-click",{index:t}))}const i=e.closest("a");if(i){if(!t.defaultPrevented){const{href:t,innerText:e,className:s}=i;t&&this._view._events.emit("link-click",c({url:t,text:e?e.trim():"",className:s||"",attributes:$i(i)}))}}else;}}function $i(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const Li="miso-affiliation";const Ui=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,{status:r}=e,o=i?` data-role="${i}"`:"",a=e.value||{},c=a.channel?` data-channel="${a.channel}"`:"",u=t._getItems(e),l=u?u.length:void 0;return`<div class="${s} ${r}"${o}${c}${void 0!==l?` data-item-count="${l}"`:""}>${r===me.READY?n[r](t,e):""}</div>`},[me.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}-container">${n.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:n}=t;return`<div class="${i}__control-${s}" data-role="${s}">${n.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return ci},body:function(t,e){const{className:s,templates:i}=t,n=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,n)}</div>`},item:function(t,e,s,i){const{className:n,templates:r,options:o}=t,{itemType:a}=o;return`<li class="${n}__item"><div class="${n}__item-inner">${r.itemHeader(t,e,s,{index:i})}${r[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:n,templates:r}=t;let{itemHeaderLeftText:o,itemHeaderRightText:a}=r;return o=As.asFunction(o)(t,e,s,i),a=As.asFunction(a)(t,e,s,i),`<div class="${n}__item-header">\n  <div class="${n}__item-header-left">${o}</div>\n  <div class="${n}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:n}=t,[r,o]=Is(t,s,{link:!1});return""+r+(n.infoBlock||n.affiliationInfoBlock||ps)(t,s,i)+(n.imageBlock||ks)(t,s,{brand:!0,...i})+o},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:n,templates:r}=t,o=As.asFunction(r.logoText)(t,e,s,i)||"",a=As.asFunction(r.logoImg)(t,e,s,i);return a?`<span class="${n}__item-header-logo-text">${o}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:n,templates:r}=t,o=As.asFunction(r.logoUrl)(t,e,s,i);if(!o)return"";const a=As.asFunction(r.logoAltText)(t,e,s,i);return`<img class="${n}__item-header-logo" src="${o}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),qi=Object.freeze({...Qs.defaultTemplates,...Ui});class ji extends Qs{static get type(){return"affiliation"}static get defaultTemplates(){return qi}static get defaultClassName(){return Li}constructor({className:t=Li,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...Ui,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Y(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,w((()=>this._syncItemIndex())))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_getItems(t){const{products:e}=t.value||{};return e}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(this._displayedCount=s,void 0===s?i.removeAttribute("data-item-count"):i.setAttribute("data-item-count",s))}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const Di="miso-facets",zi="miso-facet",Mi="custom_attributes.";const Fi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${n.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map((n=>s.facet(t,{field:n,entries:i[n]},e)))},facet:function(t,e,s){const{facetClassName:i=zi,templates:n}=t,{field:r}=e;return`<div class="${i}" data-role="facet" data-field="${E(r)}">${n.header(t,e,s)}${n.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=zi,templates:n}=t;return`<div class="${i}__header">${n.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(Mi)&&(e=e.substring(18)),E(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:n=zi,templates:r}=t;return`<ul class="${n}__options" data-role="options">${s.map((([s,n])=>r.option(t,{field:e,value:s,count:n},i))).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=zi,templates:n}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${n.value(t,e,s)}</span>\n  <span class="${i}__count">${n.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return E(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function Bi(t,e){return`${t}:::${e}`}function Qi(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class Gi extends Rs{static get type(){return"facets"}static get defaultTemplates(){return Fi}static get defaultClassName(){return Di}constructor({className:t=Di,templates:e,...s}={}){super({className:t,templates:{...Fi,...e},...s}),this._bindings=new Ds}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t))),s.on("update",(t=>this._updateSelections(t))),s.on("reset",(()=>this._syncSelections()))]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=Qi(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=Qi(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],n=[],r=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),o=s[t];if(!o)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=o[e];if(!c)break;i.push(Bi(t,c)),n.push({field:t,value:c}),r.push(s)}}this._bindings.update(i,n,r)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[E(t)]=e[t].map((([t])=>t));return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:n,value:r}=i;this._view.filters.facets.toggle(n,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Hi="miso-select";const Vi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t,r=i?`data-role="${i}"`:"",o=t._getItems(e),a=o.find((t=>t.selected))||o[0];return`\n<div class="${s}" ${r}>\n  ${n.button(t,a)}\n  ${n.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map(((e,s)=>i.option(t,e,{index:s}))).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return E(e&&e.text&&e.text.replace(/[-_][a-zA-Z]/g," $1")||e||"")}});class Wi extends Rs{static get type(){return"select"}static get defaultTemplates(){return Vi}static get defaultClassName(){return Hi}constructor({className:t=Hi,templates:e,...s}={}){super({className:t,templates:{...Vi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",(t=>this._handleClick(t)))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}zs(Wi.prototype);const Ki="miso-more-button";const Yi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:n}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==me.READY?" disabled":""}>\n  ${n.text(t)}\n</div>\n`},text:function(t){return"More"}});class Zi extends Rs{static get type(){return"more-button"}static get defaultTemplates(){return Yi}static get defaultClassName(){return Ki}constructor({className:t=Ki,templates:e,...s}={}){super({className:t,templates:{...Yi,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",(t=>this._handleClick(t)))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var Ji=Object.freeze({__proto__:null,TemplateBasedLayout:Rs,ContainerLayout:$s,ErrorLayout:Us,BannerLayout:class extends Rs{static get type(){return"banner"}static get defaultTemplates(){return qs}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...qs,...e},...s})}},CollectionLayout:Qs,ListLayout:Hs,CardsLayout:class extends Qs{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return Vs}constructor({className:t=Vs,...e}={}){super({className:t,...e})}},CarouselLayout:class extends Qs{static get type(){return"carousel"}static get defaultTemplates(){return Ys}static get defaultClassName(){return Ws}constructor({className:t=Ws,templates:e,...s}={}){super({className:t,templates:{...Ks,...e},...s}),window.addEventListener("resize",this.syncSize=this.syncSize.bind(this)),this._page=0,this._unsubscribes=[]}_render(t,e,s){super._render(t,e,s);const{state:i}=e,n=this._getItems(i);this._itemCount=n?n.length:void 0,this.syncSize()}get page(){return this._page}get pageSize(){return this._pageSize}next(){this._setPage(this._page+1)}previous(){this._setPage(this._page-1)}syncSize(){if(void 0===this._itemCount)return;const t=this._findGridElement();if(!t)return;const e=void 0===this._pageSize?0:this._page*this._pageSize,s=this._pageSize=window.getComputedStyle(t).getPropertyValue("grid-template-columns").split(" ").length;this._pageCount=Math.ceil(this._itemCount/this._pageSize),this._setPage(Math.floor(e/s))}_setPage(t){if(0>t?t=this._pageCount-1:this._pageCount>t||(t=0),t===this._page)return;this._page=t;const e=this._findGridElement();if(e){e.style.setProperty("grid-template-rows",(0===t?"":`repeat(${t}, 0)`)+" 1fr repeat(10, 0)")}}_findGridElement(){const{element:t}=this._view;return t&&t.querySelector(`.${this.className}__list`)}_onClick(t){super._onClick(t);const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')&&this.next()}destroy(){window.removeEventListener("resize",this.syncSize),super.destroy()}},SearchBoxLayout:_i,OptionListLayout:fi,FeedbackLayout:Ei,TextLayout:Oi,TypewriterLayout:Pi,AffiliationLayout:ji,FacetsLayout:Gi,SelectLayout:Wi,MoreButtonLayout:Zi});function Xi(t){return t&&t.value&&t.value.revision}function tn(t){const e=function(t){if(!t)return me.INITIAL;const{request:e,error:s,value:i}=t;return s?me.ERRONEOUS:i?me.READY:e?me.LOADING:me.INITIAL}(t);return c({status:e,ongoing:e===me.READY?t.ongoing:void 0,...t})}function en(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:n}=i||{};return n?{...t,value:{...s,keywords:n}}:t}function sn(t){const{role:e,type:s,items:i}=t,n={type:"viewable"===s?"viewable_impression":s,context:{custom_context:c({property:e})}};switch(function(t){return de.has(t)}(s)&&(!function(t){return ue.has(t)}(e)?(n.product_ids=[],n.context.custom_context.items=(i||[]).map((t=>t.text||t.id||t))):n.product_ids=(i||[]).map((t=>"string"==typeof t?t:t.product_id)).filter((t=>t))),s){case le.SUBMIT:n.context.custom_context.value=t.value;break;case le.FEEDBACK:n.context.custom_context.value=n.value=t.value,n.context.custom_context.result_type=n.result_type=t.result_type}return c(n)}function nn(t={},e={}){return c({...t,...e,context:c({...t.context,...e.context,custom_context:c({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context})})})}const rn=Object.freeze({}),on=Object.freeze({[oe.CONTAINER]:$s.type,[oe.ERROR]:Us.type}),an=Object.freeze({}),cn=Object.freeze({api:rn,layouts:on,trackers:an}),un=Object.freeze({mappings:{[oe.ERROR]:t=>t.error}});class ln extends W{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:n,options:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=n,this._options=r||new xe(e&&e._options,n),this._hub=function(t,e){const{update:s,trigger:i}=t;return t.update=(i,n,r)=>(r&&r.silent||e("update",i,n,r),s.call(t,i,n,r)),t.trigger=(...s)=>(e("trigger",...s),i.apply(t,s)),t}(new qe,((...t)=>this._log(...t))),this._sessionContext=new WeakMap,this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({name:t,roles:e}){const s=this._hub,i=this._client,n=this._options,r=this._extensions,o=this._plugin.layouts;this._sessions=new je(s),this._data=new ze(s,{source:hs(i),options:n}),this._views=new os(s,{extensions:r,layouts:o,roles:e,options:n,workflow:t}),this._interactions=new ls(s,{client:i,options:n})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("response",(t=>this.updateData(t))),this._hub.on("tracker",(t=>this._onTracker(t)))],t.main&&this._unsubscribes.push(this._hub.on(Ue(t.main),(t=>this._onMainViewUpdate(t))))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[Ue(t)]||{};e.session&&e.status===me.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(t){const{status:e}=t,s=e===me.READY,i=e===me.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),n=i.has(t);return i.add(t),!n}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=se(this._options.resolved.api,{...t,session:e});this._hub.update("request",s)}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Xi(t);if(!u(s)){const t=Xi(this._hub.states.data);if(!u(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){t=this._defaultProcessData(t);for(const e of this._options.resolved.dataProcessor)t=e(t);this._updateDataInHub(t)}_defaultProcessData(t){return t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=tn(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:me.READY,session:this.session,...e},this._hub.update(Ue(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction(t);this._sendInteraction(e)}_buildInteraction(t){let e=sn(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){if(e.role!==oe.AFFILIATION)return t;const{items:s}=e;return nn(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map((t=>t.position))}}})}(t=this._writeMisoIdToInteraction(t,e),e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return nn(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[Ue(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?nn(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._events.emit("destroy"),this._destroy(t)}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy()}_log(t,e,s){this._emit(e,{_action:t,...s})}_emit(t,e){this._events.emit(t,e),this._context&&this._context._events.emit(t,{workflow:this,...e})}}function hn(t){if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:_n(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map((t=>({...t})));let n=0;for(const t of i)s&&(t.channel=s),t.position=n++;return{...t,affiliation:{...e,products:i}}}(t)}function _n({products:t,...e}){return{channel:"sovrn",...e,products:t.map(dn)}}function dn({id:t,deeplink:e,headline:s,description:i,currency:n,retailPrice:r,salePrice:o,discountRate:a,image:u,thumbnail:l,merchant:h,..._}){return c({id:"sovrn-"+t,title:s,description:i,cover_image:u,url:e,currency:n,original_price:r,sale_price:o,discount_rate_percent:a,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:pn({sovrn_id:t,thumbnail:l,merchant:h,..._})})}function pn(t,e=""){return Object.keys(t).reduce(((s,i)=>{const n=t[i];if(void 0===n)return s;const r=e?`${e}_${i}`:i;return"object"==typeof n?{...s,...pn(n,r)}:{...s,[r]:n}}),{})}function mn(t){j(t,fn.prototype)}Pe(ln.prototype),Object.assign(ln,{DEFAULT_API_OPTIONS:rn,DEFAULT_LAYOUTS:on,DEFAULT_TRACKERS:an,DEFAULT_OPTIONS:cn,ROLES_OPTIONS:un});class fn{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl(t){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t.q)}}const gn=Object.freeze({...ln.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...ln.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),yn=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),bn=Object.freeze({...ln.DEFAULT_LAYOUTS,[oe.QUERY]:[_i.type,{placeholder:"Ask a question"}],[oe.QUESTION]:[Oi.type,{tag:"h2"}],[oe.ANSWER]:Pi.type,[oe.FEEDBACK]:Ei.type,[oe.SOURCES]:[Hs.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[oe.AFFILIATION]:[ji.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),wn=Object.freeze({...ln.DEFAULT_TRACKERS,[oe.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Ee.click},[oe.SOURCES]:Ee,[oe.AFFILIATION]:Ee,[oe.PRODUCTS]:Ee}),vn=Object.freeze({...ln.DEFAULT_OPTIONS,api:gn,autocomplete:yn,layouts:bn,trackers:wn}),En=Jt(ln.ROLES_OPTIONS,{main:oe.ANSWER,members:Object.keys(bn)});class kn extends ln{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new us(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._views.get(oe.ANSWER).on("citation-click",(t=>this._onCitationClick(t))),this._views.get(oe.ANSWER).on("link-click",(t=>this._onAnswerLinkClick(t)))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[Ue(this._roles.main)]||{};t.session&&t.status!==me.INITIAL&&(t.status!==me.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===me.READY&&!t.ongoing,n=e===me.ERRONEOUS,r=i?"done":n?"error":e,o=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==o.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),o.answerStage=a),this._emitLifecycleEvent(r,t),(i||n)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){const{setValue:e,focus:s,param:i,sourceParam:n}=this._autoQuery=function({setValue:t=!0,focus:e=!0,param:s="q",sourceParam:i="qs",...n}={}){return{setValue:t,focus:e,param:s,sourceParam:i,...n}}(t),r=new URLSearchParams(window.location.search),o=r.get(i),a=r.get(n),{layout:c}=this._views.get(oe.QUERY);c&&(o&&e&&(c.value=o),!o&&s&&c.focus()),o&&this.query({q:o,qs:a})}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||re}_buildPayload(){throw Error("Not implemented")}_updateData(t){!t.value||t.value.answer_stage?(super._updateData(t),this._updateUrlIfNecessary(t)):this._handleHeadResponse(t)}_handleHeadResponse(t){this._writeQuestionIdFromData(t)}_defaultProcessData(t){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:hn(e)}}(t=super._defaultProcessData(t)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){if(!t)return;const{question_id:e}=t;this._writeQuestionId(e)}_updateUrlIfNecessary({value:t,request:e}){if(!t||!this._autoQuery||!1===this._autoQuery.updateUrl)return;const{param:s}=this._autoQuery,{question:i}=t,n=e&&e.payload&&e.payload._meta&&e.payload._meta.question_source===re,r=new URL(window.location);i===r.searchParams.get(s)||n&&!0!==this._autoQuery.updateUrl||(r.searchParams.set(s,i),window.history.replaceState({},"",r))}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAskPropertiesToInteraction(t,e),t=this._writeAnswerClickInteraction(t,e)}_writeAskPropertiesToInteraction(t={},e){return nn(t,{context:{custom_context:{question_source:this._getQuestionSourceFromViewState(e),question_id:this.questionId}}})}_writeAnswerClickInteraction(t,e){if(e.role!==oe.ANSWER)return t;console.log("writeAnswerClickInteraction",t,e);const{items:s=[]}=e;return nn(t,{context:{custom_context:{urls:s.map((t=>t.url)),texts:s.map((t=>t.text)),class_names:s.map((t=>t.className)),attributes:s.map((t=>t.attributes))}}})}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[Ue(t.role)]||{},{payload:s}=e||{};return s&&s._meta&&s._meta.question_source||void 0}_onCitationClick({index:t}){const{value:e}=this.states.data||{},{sources:s}=e||{},i=s&&s[t-1];i&&i.product_id&&this._views.trackers.sources.click([i.product_id])}_onAnswerLinkClick(t){this._views.trackers.answer.click([],{items:[t]})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}mn(kn.prototype),Object.assign(kn,{DEFAULT_API_OPTIONS:gn,DEFAULT_AUTOCOMPLETE_OPTIONS:yn,DEFAULT_LAYOUTS:bn,DEFAULT_TRACKERS:wn,DEFAULT_OPTIONS:vn,ROLES_OPTIONS:En});const Sn=Object.freeze({...kn.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...kn.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),On=Object.freeze({...kn.DEFAULT_LAYOUTS,[oe.QUERY]:[_i.type,{templates:{buttonIcon:"send"}}],[oe.RELATED_RESOURCES]:[Hs.type,{incremental:!0,itemType:"article"}],[oe.QUERY_SUGGESTIONS]:fi.type}),In=Object.freeze({...kn.DEFAULT_TRACKERS,[oe.RELATED_RESOURCES]:Ee,[oe.QUERY_SUGGESTIONS]:{...Ee,click:{...Ee.click,validate:t=>0===t.button}}}),Cn=Object.freeze({...kn.DEFAULT_OPTIONS,api:Sn,layouts:On,trackers:In}),Tn=Jt(kn.ROLES_OPTIONS,{members:Object.keys(On)});class xn extends kn{constructor(t,e){super({name:"ask",context:t,roles:Tn,defaults:Cn,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;h(this,{parentQuestionId:e})}_initSubscriptions(t){this._setSuggestedQuestions(),super._initSubscriptions(t)}_setSuggestedQuestions(){const{previous:t}=this;if(!t)return;const e=t.states.data.value;this._hub.update("suggestions",{value:(e.suggested_followup_questions||e.followup_questions||[]).map((t=>({text:t})))})}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,...s}={}){const{parentQuestionId:i}=this;return c({...s,question:t,parent_question_id:i,_meta:{...s._meta,question_source:e||re}})}_writeAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,n,r,{property:o}=t.context&&t.context.custom_context||{};return e.role===oe.QUERY_SUGGESTIONS?(o="suggested_followup_questions",n=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):(n=this.parentQuestionId,i=this.questionId,r=this._getQuestionSourceFromViewState(e)),nn(t,{context:{custom_context:{property:o,root_question_id:s,parent_question_id:n,question_id:i,question_source:r}}})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(t){const{parentQuestionId:e,questionId:s}=this;e&&this._context._byPqid.delete(e),s&&this._context._byQid.delete(s),super._destroy(t)}}class An extends Le{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new xn(this)}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new xn(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}}const Rn=Object.freeze({...ln.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...ln.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Nn=Object.freeze({...ln.DEFAULT_LAYOUTS,[oe.QUERY]:[_i.type],[oe.PRODUCTS]:[Hs.type,{incremental:!0,infiniteScroll:!0}],[oe.KEYWORDS]:[Oi.type,{raw:!0}],[oe.TOTAL]:[Oi.type,{raw:!0,format:"number"}],[oe.FACETS]:[Gi.type],[oe.SORT]:[Wi.type],[oe.MORE]:[Zi.type]}),Pn=Object.freeze({...ln.DEFAULT_TRACKERS,[oe.PRODUCTS]:Ee}),$n=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Ln=Object.freeze({...ln.DEFAULT_OPTIONS,api:Rn,layouts:Nn,trackers:Pn,pagination:$n}),Un=Jt(ln.ROLES_OPTIONS,{main:oe.PRODUCTS,members:Object.keys(Nn),mappings:{[oe.FACETS]:"facet_counts",[oe.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:n}=e.states.filters||{},r=n&&n.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return r?i.map((t=>({...t,selected:t.field===r}))):i}}});class qn extends ln{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",(t=>this._query(t))),this._hub.on("filters",(()=>this._refine())),this._hub.on("more",(()=>this._more())),this._views.get(oe.SORT).on("select",(t=>this._handleSortSelect(t)))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._queryArgs=t,this.restart();const e=this._buildPayload(t);this._request({payload:e})}_refine(){const{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart();const e=this._getQuery(),s=this._buildPayload(e);this._request({payload:s})}_more(){if(this.status!==me.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=this._getQuery();let e=this._buildPayload(t);e=this._processPayloadForMoreRequest(e),this._request({payload:e})}_getQuery(){return this._queryArgs}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t)}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return c({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return o(t)}_writePageInfoToPayload(t){return{...t,_meta:{...t._meta,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map((t=>t.product_id)).filter((t=>t)),n=[...t.exclude||[],...i];return 0===n.length?t:{...t,exclude:n}}_defaultProcessData(t){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case me.INITIAL:case me.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=en(t=super._defaultProcessData(t)),this._currentFacetCounts),t=function(t,{role:e=oe.PRODUCTS}={}){const{status:s,request:i,value:n}=t;if(s!==me.READY||!i||!n)return t;const{[e]:r}=n;if(!r)return t;const{rows:o}=i.payload,{length:a}=r;return o>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateDataInHub(t){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{_meta:s}=e.payload;if(!s||!s.page)return t;return function(t,e,{role:s=oe.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:n,total:r}=t.value,{[s]:o=[]}=e.value;return{...e,facet_counts:n,total:r,value:{...e.value,[s]:[...i,...o]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}}Pe(qn.prototype,[ge.PAGINATION,ge.FILTERS]),Object.assign(qn,{DEFAULT_API_OPTIONS:Rn,DEFAULT_LAYOUTS:Nn,DEFAULT_TRACKERS:Pn,DEFAULT_PAGINATION:$n,DEFAULT_OPTIONS:Ln,ROLES_OPTIONS:Un});const jn=Object.freeze({members:[]});function Dn({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function zn(t){return t&&t.value&&t.value.trim()||void 0}class Mn extends ln{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:Dn(e),roles:jn,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",(t=>this._query(t)))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,zn(t)===zn(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!zn(t))return void this._updateCompletions({session:s,status:me.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:zn(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function Fn(t){j(t,Bn.prototype)}class Bn{_initAutocomplete(t){this._autocomplete=new Mn(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Qn=Jt(kn.ROLES_OPTIONS,{mappings:{[oe.QUESTION]:oe.KEYWORDS}});class Gn extends kn{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Qn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._superworkflow=t.superworkflow}_initSession(){}restart(){super.restart();const t=this._superworkflow._results;t._views.filters.reset(),t.restart(),this._resultsSession=t.session}_buildPayload(t){return t=this._writeQuestionSourceToPayload(t),t=this._superworkflow._results._writeFiltersToPayload(t)}_writeQuestionSourceToPayload({qs:t,...e}={}){return{...e,_meta:{...e._meta,question_source:t||re}}}_defaultProcessData(t){return t=en(t=super._defaultProcessData(t))}_updateDataInHub(t){switch(t.status){case me.INITIAL:case me.LOADING:this._dispatchDataToSibling(t)}super._updateDataInHub(t)}_handleHeadResponse(t){super._handleHeadResponse(t),this._dispatchDataToSibling(t)}_dispatchDataToSibling(t){this._resultsSession&&this._superworkflow._results.updateData({...t,session:this._resultsSession})}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}Fn(Gn.prototype);const Hn={...qn.ROLES_OPTIONS,members:[oe.PRODUCTS,oe.KEYWORDS,oe.TOTAL,oe.FACETS,oe.SORT,oe.MORE,oe.ERROR]};class Vn extends qn{constructor(t){super({name:"hybrid-search/results",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Hn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_emitLifecycleEvent(t,e){super._emitLifecycleEvent(t,e),this._superworkflow._emitLifecycleEvent(t,e)}_getQuery(){return this._superworkflow._answer._hub.states.query}_buildPayload(t){return t=this._superworkflow._answer._writeQuestionSourceToPayload(t),t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),t=this._writeQuestionIdToPayload(t),{...t,answer:!1}}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t){return{...t,_meta:c({...t._meta,question_id:this._superworkflow._answer.questionId})}}}Object.assign(Vn,{ROLES_OPTIONS:Hn});class Wn{constructor(t){this._workflow=t,this._containers=new Set}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._workflow._subworkflows)e._views.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getSubworkflow(t){return this._workflow._getSubworkflow(function(t){return Vn.ROLES_OPTIONS.members.includes(t)?"results":"answer"}(t))}_getAllSubviews(){return this._workflow._subworkflows.flatMap((t=>t._views))}_getSubviews(t){return this._getSubworkflow(t)._views}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const Kn=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...kn.DEFAULT_API_OPTIONS.payload,...qn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title"]}}),Yn=Object.freeze({...kn.DEFAULT_LAYOUTS,...qn.DEFAULT_LAYOUTS,[oe.QUERY]:[_i.type,{placeholder:""}],[oe.QUESTION]:[Oi.type,{raw:!0}]}),Zn=Object.freeze({...kn.DEFAULT_TRACKERS,...qn.DEFAULT_TRACKERS}),Jn=Object.freeze({...qn.DEFAULT_PAGINATION,active:!0}),Xn=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),tr=Object.freeze({...kn.DEFAULT_OPTIONS,...qn.DEFAULT_OPTIONS,api:Kn,layouts:Yn,trackers:Zn,autocomplete:Xn,pagination:Jn}),er=Object.freeze({main:oe.PRODUCTS,members:Object.keys(Yn),mappings:Object.freeze({...kn.ROLES_OPTIONS.mappings,...qn.ROLES_OPTIONS.mappings})});class sr extends ln{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:er,defaults:tr})}_initProperties(t){super._initProperties(t),this._subworkflows=[this._answer=new Gn(this),this._results=new Vn(this)]}_getSubworkflow(t){switch(t){case"answer":return this._answer;case"results":return this._results;default:throw Error("Invalid subworkflow: "+t)}}_initActors(){const t=this._hub,e=this._client,s=this._options;this._views=new Wn(this),this._interactions=new ls(t,{client:e,options:s})}_initSession(){this._results._sessions.restart(),this._answer._sessions.restart()}useLink(t,e){return this._answer.useLink(t,e),this}get answer(){return this._answer}get results(){return this._results}get questionId(){return this._answer.questionId}get filters(){return this._results._views.filters}get autocomplete(){return this._answer.autocomplete}autoQuery(t){this._answer.autoQuery(t)}query(t){this._answer.query(t)}_defaultProcessInteraction(t,e){return this._answer._defaultProcessInteraction(t,e)}_destroy(){for(const t of this._subworkflows)t.destroy();super._destroy()}}Pe(sr.prototype,[ge.PAGINATION,ge.FILTERS]);const ir=Object.freeze({...ln.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),nr=Object.freeze({...ln.DEFAULT_LAYOUTS,[oe.RELATED_QUESTIONS]:[Hs.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[oe.QUERY]:[_i.type,{placeholder:"Ask a question"}]}),rr=Object.freeze({...ln.DEFAULT_TRACKERS,[oe.RELATED_QUESTIONS]:Ee,[oe.CONTAINER]:{...Ee,itemless:!0},[oe.QUERY]:{[le.SUBMIT]:{active:!0}}}),or=Object.freeze({...ln.DEFAULT_OPTIONS,api:ir,layouts:nr,trackers:rr}),ar=Jt(ln.ROLES_OPTIONS,{main:oe.RELATED_QUESTIONS,members:Object.keys(nr)});class cr extends ln{constructor(t,e){super({name:"explore",plugin:t,client:e,roles:ar,defaults:or})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(oe.RELATED_QUESTIONS).on("click",(t=>this._handleRelatedQuestionClick(t))),this._hub.on("query",(t=>this._query(t)))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(t){const{product_id:e}=t;return e&&(this._productId=e),super.useApi(t)}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=oe.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t){return t=super._defaultProcessData(t),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t},{generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage(t)}_getSubmitUrl(t,{generated:e=!1}={}){let s=fn.prototype._getSubmitUrl.call(this,t);return e&&this._productId?`${s}&qs=${encodeURIComponent(this._productId)}`:s}}mn(cr.prototype);const ur=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),lr=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),hr=Object.freeze({...qn.DEFAULT_LAYOUTS}),_r=Object.freeze({...qn.DEFAULT_TRACKERS}),dr=Object.freeze({...qn.DEFAULT_OPTIONS,api:ur,autocomplete:lr,layouts:hr,trackers:_r}),pr=qn.ROLES_OPTIONS;class mr extends qn{constructor(t,e){super({name:"search",plugin:t,client:e,roles:pr,defaults:dr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}autoQuery({setValue:t=!0,focus:e=!0,param:s="q"}={}){const i=new URLSearchParams(window.location.search).get(s),{layout:n}=this._views.get(oe.QUERY);n&&(i&&t&&(n.value=i),!i&&e&&n.focus()),i&&this.query({q:i})}notifyViewUpdate(t=oe.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._feedback._destroy(),this._destroyAutocomplete(),super._destroy(t)}}Fn(mr.prototype);const fr=Object.freeze({...ln.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...ln.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),gr=Object.freeze({...ln.DEFAULT_LAYOUTS,[oe.PRODUCTS]:Hs.type}),yr=Object.freeze({...ln.DEFAULT_TRACKERS,[oe.PRODUCTS]:Ee}),br=Object.freeze({...ln.DEFAULT_OPTIONS,api:fr,layouts:gr,trackers:yr}),wr=Jt(ln.ROLES_OPTIONS,{main:oe.PRODUCTS,members:Object.keys(gr)});class vr extends ln{constructor(t,e){super({name:"recommendation",context:t,roles:wr,defaults:br,id:e})}_initProperties(t){super._initProperties(t);const{id:e}=t;h(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}start(){return this._request(),this}notifyViewUpdate(t=oe.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return nn(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}class Er extends Le{constructor(t,e){super("recommendations",t,e),this._members=new Map}workflows(){return[...this._members.values()]}create(t=ne){if(this._members.has(t))throw Error("Unit already exists: "+t);return new vr(this,t)}has(t=ne){return this._members.has(t)}get(t=ne){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||new vr(this,t)}}class kr extends W{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new T)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}var Sr=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var Or=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",querySuggestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic"});class Ir{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class Cr{constructor(t){this._context=t,h(this,{lowerCamelToKebab:p,kebabToLowerCamel:_,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=d(t))?"querySuggestions":t}phrase(t,{name:e,tag:s="div",inline:i=!1}){const{classPrefix:n}=t;return`<${s} class="${i?n+"__phrase-inline":n+"__phrase"} ${n}__${e}-phrase">${this.phraseText(t,_(e))}</${s}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s},{name:i,visibleWhen:n,logo:r=!1},o){const a=[`${t}__${i}-container`];return e&&a.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:a,visibleWhen:n,logo:r,parentQuestionId:s},o)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${p(t)}="${i}"`)}return s}}const Tr=D(new Cr({...Sr,DEFAULT_PHRASES:Or})),xr=D(new class extends Ir{constructor(){super({helpers:Tr})}answerGroup(t){const{container:e}=this._helpers;return[...super.answerGroup(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUps(t){const{classPrefix:e,features:s={}}=t;return!1===s.followUpQuestions?"":`<div id="${e}__follow-ups" class="${e}__follow-ups"></div>`}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:n={},logo:r=!0}=t;return i(t,{name:"related-resources"},!1===n.relatedResources?"":e(t,{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}querySuggestions(t){const{container:e,phrase:s}=this._helpers,{features:i={}}=t;return!1===i.querySuggestions?"":e(t,{name:"query-suggestions",visibleWhen:"initial+nonempty"},[s(t,{name:"query-suggestions",tag:"h3"}),"<miso-query-suggestions></miso-query-suggestions>"])}}({helpers:Tr}));function Ar(t={}){const{normalizeOptions:e,section:s,container:i}=Tr,{querySuggestions:n,answerGroup:r}=xr;return s(t=e(t),{name:"follow-up"},[n(t),i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...r(t)])}var Rr=Object.freeze({__proto__:null,helpers:Tr,sections:xr,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=Tr,{followUps:n,relatedResourcesSection:r,answerGroup:o}=xr;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},o(t))+n(t)+r(t)},followUp:Ar});const Nr=Object.freeze(Sr),Pr=Object.freeze(Or),$r=Object.freeze(Rr);var Lr=Object.freeze({__proto__:null,constants:Nr,phrases:Pr,templates:$r,wireFollowUps:function(t,e,{template:s=Ar,...i}={}){if(!t)throw Error("client is required");if("function"!=typeof s)throw Error("template must be a function or undefined");if(!e)return;const n=t.ui.asks,r=t.ui.ask;n.on("done",(t=>{e.insertAdjacentHTML("beforeend",s({...i,parentQuestionId:t.workflow.questionId}))})),r.on("loading",(()=>{e.innerHTML="",n.reset({root:!1})}))},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");e&&t.ui.asks.on("loading",(t=>{for(const s of e.querySelectorAll("miso-ask"))s.workflow=t.workflow}))}});const{currentScript:Ur}=document,qr=Object.freeze({templates:$r,autostart:!0}),jr=["templates","phrases","features"];class Dr{constructor(){this._defaults=qr,this._scriptSrc=function(){if(!Ur||!Ur.src)return{};const t=document.createElement("a");t.href=Ur.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Fr(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Fr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...n}={}){return c({apiKey:t,apiHost:e,templates:Br(s),phrases:i,...n})}(zr(this._defaults,this._scriptSrc,t,this._pageUrl))}}function zr(...t){let e={};for(const s of t)s&&(e=Mr(e,s));return e}function Mr(t,e){if(!e)return t;Object.assign(t,e);for(const s of jr)s in e&&(t[s]={...t[s],...e[s]});return t}function Fr(t){return""===t||"false"!==t&&t}function Br(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map(Br):function(t,e){const s={};for(const[i,n]of Object.entries(t))s[i]=e(n);return s}(t,Br);default:throw Error("Unsupported template type: "+t)}}class Qr{constructor(t,{classPrefix:e=Nr.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");h(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Gr extends kr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Dr,this._localOptions={}}config(t={}){t=zr(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise((t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})}))}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;h(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Qr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:n,wireRelatedResources:r}=t.ui.defaults.ask,{templates:o={},features:a={},api:c}=i,u=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&n(e,s.followUpsSection,{...i,template:o.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(e,s.relatedResourcesSection),u.autoQuery()}}class Hr extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}let Vr,Wr,Kr;async function Yr(t){const e=await async function(t){return t.MisoClient||window.MisoClient||Vr||(Vr=async function(){return new Promise((t=>{(window.misocmd||(window.misocmd=[])).push((()=>t(window.MisoClient)))}))}())}(t);var s;return Wr=Wr||e.any(),Kr=Kr||await Wr,Kr.ui||await(s=0,new Promise((t=>setTimeout(t,s)))),Kr}const Zr="logo",Jr="auto",Xr=Object.freeze([Zr]);function to(t){if(!t)return Jr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class eo extends HTMLElement{static get observedAttributes(){return Xr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return to(this.getAttribute(Zr))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Jr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Zr,e):this.removeAttribute(Zr)}async connectedCallback(){const t=this._client=await Yr(eo);document.body.contains(this)&&this._setWorkflow(this._getWorkflow(t))}disconnectedCallback(){this._setWorkflow(void 0)}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Zr)this._handleLogoUpdate(e,s)}_handleLogoUpdate(t,e){to(t)!==to(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const so="parent-question-id",io=Object.freeze([...eo.observedAttributes,so]);const no="unit-id",ro=Object.freeze([...eo.observedAttributes,no]);var oo=Object.freeze({__proto__:null,MisoAskElement:class extends eo{static get tagName(){return"miso-ask"}static get observedAttributes(){return io}_getWorkflow(t){return this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(so)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(so,t):this.removeAttribute(so))}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t),this.parentQuestionId=t&&t.parentQuestionId}attributeChangedCallback(t,e,s){if(t===so)this._handleParentQuestionIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends eo{static get observedAttributes(){return eo.observedAttributes}static get tagName(){return"miso-explore"}_getWorkflow(t){return t.ui.explore}},MisoHybridSearchElement:class extends eo{static get observedAttributes(){return eo.observedAttributes}static get tagName(){return"miso-hybrid-search"}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends eo{static get observedAttributes(){return eo.observedAttributes}static get tagName(){return"miso-search"}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends eo{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return ro}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}get unitId(){return this.getAttribute(no)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(no,t):this.removeAttribute(no)}attributeChangedCallback(t,e,s){if(t===no)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}});const ao="role",co=Object.freeze([ao]);class uo extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return co}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(ao);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ao}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${ao}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===ao&&this._container&&this._container._updateComponentRole(this,e,s)}}var lo=Object.freeze({__proto__:null,MisoComponentElement:uo,MisoQueryElement:class extends uo{constructor(){super({role:oe.QUERY})}static get tagName(){return"miso-query"}},MisoQuerySuggestionsElement:class extends uo{constructor(){super({role:oe.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends uo{constructor(){super({role:oe.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends uo{constructor(){super({role:oe.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends uo{constructor(){super({role:oe.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends uo{constructor(){super({role:oe.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends uo{constructor(){super({role:oe.ANSWER})}static get tagName(){return"miso-answer"}},MisoSourcesElement:class extends uo{constructor(){super({role:oe.SOURCES})}static get tagName(){return"miso-sources"}},MisoRelatedResourcesElement:class extends uo{constructor(){super({role:oe.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends uo{constructor(){super({role:oe.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoSovrnAffiliationElement:class extends uo{constructor(){super({role:oe.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends uo{constructor(){super({role:oe.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends uo{constructor(){super({role:oe.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends uo{constructor(){super({role:oe.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends uo{constructor(){super({role:oe.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends uo{constructor(){super({role:oe.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends uo{constructor(){super({role:oe.ERROR})}static get tagName(){return"miso-error"}}});class ho extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(ho.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var _o=Object.freeze({__proto__:null,containers:oo,roles:lo,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends ho{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Ns});const po="miso-hybrid-search-combo";var mo=Object.freeze({__proto__:null,CLASS_PREFIX:po,CONAINER_TAG:"miso-hybrid-search"});const fo="Show more",go="Show less";var yo=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:fo,showLess:go});const bo=D(new Cr({...mo,DEFAULT_PHRASES:yo})),wo=D(new class extends Ir{constructor(){super({helpers:bo})}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:bo}));var vo=Object.freeze({__proto__:null,helpers:bo,sections:wo,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=bo;t=e(t);const{answerBox:n,answerGroup:r,searchResultsGroup:o}=wo,{answerBox:a=!0}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[n(t)]:r(t))+s(t,{name:"search-results"},o(t))}});const Eo="answer-box-open",ko="answer-box-shown",So='[data-role="answer-box-toggle"]';class Oo{constructor(t,e,{classPrefix:s=po,phrases:i={}}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push((()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)}));const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",(()=>this._syncWofkflowStatus()))]}_handleClick({target:t,button:e}){0===e&&t.closest(So)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer;switch(t){case me.ERRONEOUS:case me.READY:this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||go:this._phrases.showMore||fo;for(const e of this._element.querySelectorAll(So))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const Io={isOpen:Eo,shown:ko},Co={toggleOpen:["toggle",Eo],open:["open",Eo],close:["remove",Eo],toggleHidden:["toggle",ko],show:["add",ko],hide:["remove",ko]};for(const[t,e]of Object.entries(Io))Object.defineProperty(Oo.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(Co))Oo.prototype[t]=function(){this._updateBoxStatus(e,s),s===Eo&&(this._syncButtonText(),this._syncScroll())};const To=Object.freeze(mo),xo=Object.freeze(yo),Ao=Object.freeze(vo);var Ro=Object.freeze({__proto__:null,constants:To,phrases:xo,templates:Ao,wireAnswerBox:function(t,e){if(!t)throw Error("client is required");e&&new Oo(t,e)}});const No=Object.freeze(Lr),Po=Object.freeze(Ro);var $o=Object.freeze({__proto__:null,ask:No,hybridSearch:Po});let Lo,Uo;async function qo(){return Uo||(Uo=N(Lo||(Lo=P("ui"))))}class jo{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Do{constructor(t,e){this._plugin=t,this._client=e,h(this,{sources:{api:hs(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new mr(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new sr(this._plugin,this._client))}get explore(){return this._explore||(this._explore=new cr(this._plugin,this._client))}get ready(){return this._plugin._ready.promise}}class zo{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Gr(this._plugin,this._MisoClient))}}var Mo;xt.plugins.use(class extends W{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Hr(this),this._recommendations=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new T}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:$o};l(s,this,["layouts","combo","ready"]),h(this,{MisoClient:t}),h(t,{ui:s}),this.combo=new zo(this,t);const i=Object.values(Ji).filter((t=>t.type));for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:n,roles:r,combos:o,...a}=_o,c=[...Object.values(o),...Object.values(n),...Object.values(r),...Object.values(a)];eo.MisoClient=t,ho.MisoClient=t;for(const e of c)e.MisoClient=t;await qo();for(const t of c)b(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then((()=>{}))}_injectClient(t){h(t,{ui:new Do(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new jo(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new Er(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new An(this,t)),e}}),xt.attach(),Mo=function(){Ot._cmdRes.resolve()},A("misodev"),setTimeout((()=>{A("misocmd"),Mo&&Mo()}));const Fo="y8KqBRKsGEJ0BAh4PayOS0qBi5wAhU8vzxxkzLi6",Bo=({parentQuestionId:t})=>`\n  <section class="miso-ask-combo__section miso-ask-combo__follow-up">\n    <div class="miso-ask-combo__query-suggestions-container miso-ask-combo__explore-more-container" style="display: none;">\n      <h3 class="miso-ask-combo__phrase miso-ask-combo__query-suggestions-phrase">Explore More Questions</h3>\n      <div class="miso-option-list">\n        <ol class="miso-option-list__options"></ol>\n      </div>\n    </div>\n    <miso-ask class="miso-ask-combo__query-suggestions-container miso-circled-citation-index" visible-when="initial+nonempty" logo="false" parent-question-id="${t}">\n      <h3 class="miso-ask-combo__phrase miso-ask-combo__query-suggestions-phrase">Related questions you can explore</h3>\n      <miso-query-suggestions></miso-query-suggestions>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" visible-when="initial loading" logo="false" parent-question-id="${t}">\n      <miso-query></miso-query>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false" parent-question-id="${t}">\n      <hr />\n      <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">You asked about...</div>\n      <miso-question></miso-question>\n      <miso-answer></miso-answer>\n      <miso-feedback></miso-feedback>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n      <miso-affiliation></miso-affiliation>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false" parent-question-id="${t}">\n      <hr />\n      <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">This reply is based on the following articles</h3>\n      <miso-sources></miso-sources>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__bottom-spacing-container miso-circled-citation-index" visible-when="ongoing" logo="false" parent-question-id="${t}"></miso-ask>\n  </section>\n`,Qo=(t,e,s,i)=>{const{templates:n}=t,{articleInfoBlock:r,indexBlock:o}=n,{product_id:a,url:c,content_type:u,cover_image:l}=s;return`\n    <a\n      class="miso-list__item-body"\n      data-role="item"\n      data-miso-product-id="${a}"\n      ${c?`href="${c}"`:""}\n      target="_blank"\n      rel="noopener"\n    >\n      ${h=l,`\n    <div class="miso-list__item-cover-image-container">\n      <div class="miso-list__item-cover-image-placeholder">rwjf</div>\n      ${h?`<img class="miso-list__item-cover-image" onerror="this.style.display='none';" src="${h}">`:""}\n    </div>\n  `}\n      ${r(t,s,i)}\n      ${o(t,s,i)}\n      ${(t=>`\n  <div class="miso-list__content-type-icon">\n    ${"file"===t?'\n  <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M2.69979 4.18782C2.69979 2.89246 3.74988 1.84237 5.04524 1.84237H12.7965L15.2818 4.68269V14.5752C15.2818 15.8706 14.2317 16.9207 12.9363 16.9207H5.04524C3.74988 16.9207 2.69979 15.8706 2.69979 14.5752V4.18782Z" stroke="#9096A2" stroke-width="1.56364"/>\n    <path d="M2.47656 13.291L15.6365 13.291" stroke="#9096A2" stroke-width="1.56364"/>\n    <path d="M4.72282 9.97656V6.56499H6.19539C6.44859 6.56499 6.67014 6.61497 6.86005 6.71491C7.04995 6.81486 7.19765 6.95535 7.30315 7.13636C7.40865 7.31738 7.4614 7.52894 7.4614 7.77104C7.4614 8.01535 7.40698 8.22691 7.29815 8.40571C7.19043 8.5845 7.03884 8.72221 6.84339 8.81883C6.64904 8.91544 6.42194 8.96375 6.16207 8.96375H5.28253V8.24412H5.9755C6.08433 8.24412 6.17706 8.22525 6.25369 8.18749C6.33143 8.14862 6.39084 8.09365 6.43193 8.02257C6.47413 7.9515 6.49523 7.86765 6.49523 7.77104C6.49523 7.67331 6.47413 7.59002 6.43193 7.52116C6.39084 7.4512 6.33143 7.39789 6.25369 7.36125C6.17706 7.32349 6.08433 7.30461 5.9755 7.30461H5.649V9.97656H4.72282ZM9.11388 9.97656H7.80123V6.56499H9.10055C9.45148 6.56499 9.75466 6.63329 10.0101 6.76989C10.2666 6.90537 10.4643 7.10083 10.6031 7.35625C10.743 7.61056 10.813 7.91541 10.813 8.27078C10.813 8.62615 10.7436 8.93155 10.6048 9.18697C10.466 9.44128 10.2694 9.63674 10.0151 9.77333C9.76077 9.90882 9.46037 9.97656 9.11388 9.97656ZM8.72741 9.1903H9.08056C9.24937 9.1903 9.39318 9.16309 9.51201 9.10868C9.63195 9.05426 9.72301 8.96042 9.7852 8.82716C9.8485 8.69389 9.88015 8.50843 9.88015 8.27078C9.88015 8.03312 9.84795 7.84766 9.78353 7.7144C9.72023 7.58113 9.62695 7.48729 9.50368 7.43288C9.38152 7.37846 9.2316 7.35125 9.05391 7.35125H8.72741V9.1903ZM11.2415 9.97656V6.56499H13.6403V7.31127H12.1677V7.89764H13.4937V8.64392H12.1677V9.97656H11.2415Z" fill="#9096A2"/>\n  </svg>\n':'\n  <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M11.7275 2.46484H16.4184V7.15575" stroke="#9096A2" stroke-width="1.56364" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M7.81836 11.0648L16.4184 2.46484" stroke="#9096A2" stroke-width="1.56364" stroke-linecap="round" stroke-linejoin="round"/>\n    <path d="M14.073 10.2833V14.9742C14.073 15.3889 13.9082 15.7866 13.615 16.0798C13.3218 16.3731 12.924 16.5378 12.5093 16.5378H3.90934C3.49464 16.5378 3.09692 16.3731 2.80368 16.0798C2.51044 15.7866 2.3457 15.3889 2.3457 14.9742V6.37418C2.3457 5.95948 2.51044 5.56176 2.80368 5.26853C3.09692 4.97529 3.49464 4.81055 3.90934 4.81055H8.60025" stroke="#9096A2" stroke-width="1.56364" stroke-linecap="round" stroke-linejoin="round"/>\n  </svg>\n'}\n  </div>\n`)(u)}\n    </a>\n  `;var h};let Go=[],Ho=[];const Vo=t=>{const e=[...document.querySelectorAll(".miso-ask-combo__explore-more-container")].pop();e&&(e.style.display=t?"block":"none")},Wo=()=>{if(0===Ho.length)return;const t=[...document.querySelectorAll(".miso-ask-combo__explore-more-container .miso-option-list__options")].pop();t&&Ho.forEach((e=>{const s=document.createElement("li");s.className="miso-option-list__option",s.onclick=()=>{const t=[...document.querySelectorAll(".miso-search-box__input")].pop();if(!t)return;t.value=e;const s=[...document.querySelectorAll(".miso-search-box__button")].pop();s&&s.click()},s.textContent=e,t.appendChild(s)})),Vo(!0)},Ko=async()=>{if(0!==Go.length)try{const t=Go.map((t=>fetch("https://api.askmiso.com/v1/ask/related_questions?api_key="+Fo,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t})}).then((t=>t.json())))),e=(await Promise.all(t)).map((t=>t.data.related_questions));Ho=(t=>{if(5>t.reduce(((t,e)=>t+e.length),0))return t.flat();let e=0,s=0;const i=Array.from(t,(()=>[]));for(;5>s;){const n=e%t.length,r=t[n].shift();r&&(i[n].push(r),s+=1),e+=1}return i.flat()})(e)}catch(t){console.error(t)}},Yo=()=>{Go=[],Ho=[],Vo(!1)};(window.misocmd||(window.misocmd=[])).push((async()=>{const t=new xt(Fo),e=t.ui.ask;await t.ui.ready;const s=xt.ui.defaults.ask,i=s.wireFollowUps,n=s.wireRelatedResources,r=document.querySelector("#miso-ask-combo");r.innerHTML='\n  <section class="miso-ask-combo__section miso-ask-combo__question">\n    <miso-ask class="miso-ask-combo__query-container miso-circled-citation-index" logo="false">\n      <miso-query></miso-query>\n    </miso-ask>\n  </section>\n  <section class="miso-ask-combo__section miso-ask-combo__answer">\n    <miso-ask class="miso-ask-combo__answer-container miso-circled-citation-index" visible-when="ready" logo="false">\n      <div class="miso-ask-combo__phrase miso-ask-combo__question-phrase">You asked about...</div>\n      <miso-question></miso-question>\n      <miso-answer></miso-answer>\n      <miso-feedback></miso-feedback>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__affiliation-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <miso-affiliation></miso-affiliation>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__sources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <hr />\n      <h3 class="miso-ask-combo__phrase miso-ask-combo__sources-phrase">This reply is based on the following articles</h3>\n      <miso-sources></miso-sources>\n    </miso-ask>\n    <miso-ask class="miso-ask-combo__bottom-spacing-container miso-circled-citation-index" visible-when="ongoing" logo="false"></miso-ask>\n  </section>\n  <div id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></div>\n  <section class="miso-ask-combo__section miso-ask-combo__related-resources">\n    <miso-ask class="miso-ask-combo__related-resources-container miso-circled-citation-index" visible-when="nonempty" logo="false">\n      <h2 class="miso-ask-combo__phrase miso-ask-combo__related-resources-phrase">Go beyond, and learn more about this topic</h2>\n      <miso-related-resources></miso-related-resources>\n    </miso-ask>\n  </section>\n';const o=t.ui.asks;o.useApi({source_fl:["cover_image","url","created_at","updated_at","published_at"],related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}),o.useLayouts({query:{placeholder:"Ask RWJF anything"},sources:["list",{templates:{article:Qo}}],related_resources:["list",{templates:{article:Qo}}]}),o.useDataProcessor((t=>{var e;return t?.value?.finished&&(e=(t?.value?.sources||[]).map((t=>t.product_id)),Go=e),t})),o.on("request",(()=>{Yo()})),o.on("done",(()=>{(async()=>{await Ko(),Wo()})()})),i(t,r.querySelector(".miso-ask-combo__follow-ups"),{template:Bo}),n(t,r.querySelector(".miso-ask-combo__related-resources")),e.autoQuery()}))}();
