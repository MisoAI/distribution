!function(){"use strict";function t(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}function e(t){return null!=t?""+t:t}function r(t){if("object"!=typeof t)return t;const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&void 0!==t[r]&&(e[r]=t[r]);return e}function n(t,e,r){Object.defineProperties(t,(r="string"==typeof r?[r]:r).reduce(((t,r)=>(t[r]={get:()=>{const t=e[r];return"function"==typeof t?t.bind(e):t}},t)),{}))}function i(t,e){for(const r in e)e.hasOwnProperty(r)&&Object.defineProperty(t,r,{value:e[r]})}class s{constructor(t){let{duration:e=0,onDuration:r,offDuration:n,state:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof t)throw Error("Callback must be a function: "+t);a(r),a(n),a(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==r?r:e,off:void 0!==n?n:e})}),this._value=this._state=!!i,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout((()=>o(this,t)),e):o(this,t),this._value=t}disconnect(){this._active=!1}}function o(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function a(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function c(t){return"string"==typeof t?document.querySelector(t):t}function u(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function l(t,e){const r=window.localStorage.getItem(t),n=function(t){const e="; "+document.cookie,r=`; ${encodeURIComponent(t)}=`,n=e.indexOf(r);if(0>n)return;const i=n+r.length,s=e.indexOf(";",i);return decodeURIComponent(0>s?e.substring(i):e.substring(i,s))}(t),i=r||n||""+e();return i&&!r&&window.localStorage.setItem(t,i),i&&!n&&function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,i),i}class d{constructor(){const t=this;t.promise=new Promise(((e,r)=>{t.resolve=e,t.reject=r})),Object.freeze(this)}}class p{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){for(let t=0;;t=this._index+1){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new d),await this._resolution.promise),this._aborted)break;if(yield this._value,this._done)break}}}function m(){return(new AbortController).signal}function h(t,e){try{e()}catch(e){t(e)}}function _(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>console.error(t);const r=window[t]||(window[t]=[]);if(r._processed)return;r._processed=!0;const n=t=>h(e,t);Object.defineProperty(r,"push",{value:n});for(const t of r)n(t)}const f=Symbol.for("miso:resources");class y{constructor(){this._resources=new Map;const t=window[f]||[];for(const e of t)try{const[t,r]=e;this.push([t,r])}catch(t){}}push(t){let[e,r]=t;g(this._resources,e).resolve(r)}async get(t){return g(this._resources,t).promise}}function g(t,e){if(t.has(e))return t.get(e);const r=new d;return t.set(e,r),r}function b(){return window[f]||(window[f]=new y)}class w{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new d;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class v{constructor(){let{target:t,error:e,replays:r=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._error=e||(t=>console.error(t)),!Array.isArray(r))throw Error("Replays option must be an array of strings: "+r);this._replays=new Set(r),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const r={data:e,meta:{name:t,ts:Date.now()}},n=this._namedCallbacks[t];if(n)for(const t of n)t(r);for(const t of this._unnamedCallbacks)t(r);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(r)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise(((r,n)=>{const i=e._on(t,(t=>{setTimeout((()=>i()));try{r(t)}catch(t){n(t)}}))}))}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return r=>{let{data:n,meta:i}=r;try{t(n,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(e,r){if("*"===e)t(this._unnamedCallbacks,r);else{const n=this._namedCallbacks[e];n&&t(n,r)}}_injectSubscribeInterface(t){n(t,this,["on","once"])}}function k(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class x{constructor(t,e){const r=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:k(t,e),uuid:u()})}(t,e);i(this,{meta:r});const n=this._error=this._error.bind(this);(this._events=new v({error:n,replays:["child"]}))._injectSubscribeInterface(this),this._warn=this._warn.bind(this),(e=r.parent)&&e._events&&e._events.emit("child",this)}_warn(){const t=this.meta.parent;(t&&t._warn||console.warn)(...arguments)}_error(){const t=this.meta.parent;(t&&t._error||console.error)(...arguments)}}!function(t,e){const r=Symbol.for(e);Object.defineProperty(t,r,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[r]})}(x,"miso:component");class I extends x{constructor(t,e){let{libName:r,keyName:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=r,typeof n){case"string":this._keyFn=t=>t[n];break;case"function":this._keyFn=n;break;default:throw Error("Expect keyName to be a string or a function: "+n)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new d);return e}register(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];for(const t of e)this._register(t)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const r=this._libraries||(this._libraries={});r[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class P{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout((()=>this.abort()),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const R={DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"};class j{constructor(t,e){this._client=t,this._root=e,this._bulk=new w(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e){let{method:n="POST",headers:i,timeout:s,sendApiKeyByHeader:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{apiKey:a,request:c={}}=this._client.options;s=s||c.timeout,o=o||c.sendApiKeyByHeader,o&&(i=Object.assign({},i,{"X-API-KEY":a}));const u="GET"!==n&&null!=e?JSON.stringify(e):void 0,l=s?AbortSignal.timeout(s):void 0,d=await window.fetch(t,r({method:n,headers:i,body:u,cache:"no-cache",mode:"cors",signal:l})),p=await d.json();if(d.status>=400||p.errors){var m=Error(p.message);throw m.data=p,m.status=d.status,m}return p}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,r){let{method:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n&&"POST"!==n)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:r})}async _runBulkFetch(t){const e=this.url(["bulk"]),r={requests:t.map((t=>{let{action:{apiGroup:e,apiName:r,payload:n}}=t;return{api_name:`${e}/${r}`,body:n}}))},{data:n}=await this.fetch(e,r);for(let e=0,r=t.length;r>e;e++){const{resolution:r}=t[e],{error:i,status_code:s,body:o}=n[e];s>=400||i?r.reject({status_code:s,body:o}):r.resolve(o)}}sendBeacon(t,e){let{method:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r&&"POST"!==r)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!window.navigator.sendBeacon(t,JSON.stringify(e)))throw Error("Send beacon unsuccessful: "+t)}url(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{apiKey:r,request:n={}}=this._client.options,i=e.sendApiKeyByHeader||n.sendApiKeyByHeader,s=t.filter((t=>t)).join("/"),o=`${this.getApiEndpoint(s)}/${s}`;return i?o:`${o}?api_key=${window.encodeURIComponent(r)}`}getApiEndpoint(t){const{dataEndpoint:e=R.DATA_ENDPOINT,eventEndpoint:r=R.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?r:e}applyUrlPasses(t,e){let{apiGroup:r,apiName:n,url:i}=e;const s=this._client;for(const e of this._root._urlPasses)try{i=e({client:s,apiGroup:r,apiName:n,url:i})||i}catch(e){t.error(e)}return i}applyPayloadPasses(t,e){let{apiGroup:r,apiName:n,payload:i}=e;const s=this._client;for(const e of this._root._payloadPasses)try{i=e({client:s,apiGroup:r,apiName:n,payload:i})||i}catch(e){t.error(e)}return i}}const E=["bulk"];class O extends x{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{bulk:n}=r,i=n?{bulk:this.helpers.bulkInfo}:void 0,s=this._apiPath,o=this._url({apiGroup:s,apiName:t,payload:e,options:r}),a={apiGroup:s,apiName:t,payload:e=this._preprocess({apiGroup:s,apiName:t,payload:e,options:r}),url:o,options:r};this._events.emit("request",Object.assign({},a,i));const c=await this._send(a),u=Object.assign({},a,{response:c});return this._events.emit("response",Object.assign({},u,i)),this._postprocess(u)}_preprocess(t){let{apiGroup:e,apiName:r,payload:n}=t;return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:r,payload:n})}_url(t){let{apiGroup:e,apiName:r,options:n}=t;const i=this.helpers.url([e,r],n);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:r,url:i,options:n})}async _send(t){let{apiGroup:e,apiName:r,url:n,payload:i,options:{bulk:s}={}}=t,o=function(t,e){if(null==t)return{};var r,n,i={},s=Object.keys(t);for(n=0;s.length>n;n++)0>e.indexOf(r=s[n])&&(i[r]=t[r]);return i}(t.options,E);return s?this.helpers.fetchForBulk(e,r,i):this.helpers.fetch(n,i,o)}_postprocess(t){let{response:e}=t;return e.data}}const A=["useBeacon"],S=["options"];function C(t,e){if(null==t)return{};var r,n,i={},s=Object.keys(t);for(n=0;s.length>n;n++)0>e.indexOf(r=s[n])&&(i[r]=t[r]);return i}class $ extends O{constructor(t){super(t,"interactions")}async upload(t,e){try{return await this._run("upload",t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url(t){let{apiGroup:e,apiName:r,options:n}=t;const i=this.helpers.url([this._apiPath],n);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:r,url:i,options:n})}_preprocess(t){let{apiGroup:e,apiName:r,payload:n}=t;return"upload"===r&&(n=this._normalizeUploadPayload(n)),super._preprocess({apiGroup:e,apiName:r,payload:n})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send(t){let{options:{useBeacon:e=!0}={}}=t,r=C(t.options,A),n=C(t,S);if(e){const{url:t,payload:e}=n;return this.helpers.sendBeacon(t,e,r),{}}return super._send(Object.assign({},n,{options:r}))}}const N=["pollingInterval","signal","stallTimeout"];class T extends O{constructor(t){super(t,"ask")}async questions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t&&"{"!==t.charAt(0))return new L(this,{question_id:t},e);const r=await this._run("questions",t,e);return new L(this,r,e)}async _questions(t,e){return this._run("questions",t,e)}async _get(t,e){return this._run(`questions/${t}/answer`,void 0,Object.assign({},e,{method:"GET"}))}}class L{constructor(t,e){let{question_id:r}=e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._api=t,this._questionId=r,this._ac=new AbortController,this._options=n}get questionId(){return this._questionId}async get(t){return this._api._get(this._questionId,Object.assign({},this._options,t))}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){var t=this;let e=this._options,{pollingInterval:r,signal:n,stallTimeout:i=3e4}=e,s=function(t,e){if(null==t)return{};var r,n,i={},s=Object.keys(t);for(n=0;s.length>n;n++)0>e.indexOf(r=s[n])&&(i[r]=t[r]);return i}(e,N);const o=new P(i);let a;n=function(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];const n=e.length;if(0===n)return m();if(1===n)return e[0];const i=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",(()=>i.abort(t.reason)))}return i.signal}(this._ac.signal,o.signal,n);return function(t){let{interval:e=1e3,errorLimit:r=10,onError:n,onResponse:i,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(s&&s.aborted)return[];let o=0;const a=new p,c=setInterval((async()=>{let e,u;try{[e,u]=await t(s?{signal:s}:{}),i&&i(e,u)}catch(t){return n&&n(t),o++,void(o>r&&(clearInterval(c),a.error(t)))}a.update(e,u),u&&clearInterval(c)}),e);return s&&s.addEventListener&&s.addEventListener("abort",(()=>{clearInterval(c),a.abort(s.reason)})),a}((async function(){const e=await t.get();return[e,e.finished]}),Object.assign({interval:r,signal:n,onResponse:(t,e)=>{var r,n;e?o.clear():(n=t,(r=a)&&r.answer_stage===n.answer_stage&&r.answer.length===n.answer.length||o.touch()),a=t}},s))[Symbol.asyncIterator]()}}class M extends O{constructor(t){super(t,"search")}async search(t,e){return this._run("search",t,e)}async autocomplete(t,e){return this._run("autocomplete",t,e)}async multipleGet(t,e){return this._run("mget",t,e)}}class q extends O{constructor(t){super(t,"recommendation")}async userToProducts(t,e){return this._run("user_to_products",t,e)}async userToCategories(t,e){return this._run("user_to_categories",t,e)}async userToAttributes(t,e){return this._run("user_to_attributes",t,e)}async userToTrending(t,e){return this._run("user_to_trending",t,e)}async userToHistory(t,e){return this._run("user_to_history",t,e)}async productToProducts(t,e){return this._run("product_to_products",t,e)}}class U extends x{constructor(t,e){super("api",t),this._client=t,this.helpers=new j(t,e),this.interactions=new $(this),this.ask=new T(this),this.search=new M(this),this.recommendation=new q(this)}}class z extends x{constructor(t){super("context",t),this._client=t}}var G={api:{Api:U,ApiBase:O,ApiHelpers:j,Interactions:$,Recommendation:q,Search:M},context:{Context:z}};class D{constructor(t){i(this,{install:t})}}class B extends I{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new F(this,G),this.plugins=new H(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let r;if("string"==typeof t&&this.isInstalled(t))return r=this.get(t),void this._tryConfig(r,e);"string"!=typeof t||this.isRegistered(t)?(r=this._instantiate(t,e),this._install(r)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if(this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new d);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const r=this._libraries[t];if(!r)throw Error("Plugin class not found: "+t);const n=new r;return i(n,{id:t}),this._tryConfig(n,e),n;case"function":return new D(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const r of e)try{this.use(t,r)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,r="dev"===e?`plugin:${t}@dev:${MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${r}"]`)){const n=document.createElement("script");n.async=!0,n.src=function(t,e,r){const n=t.slice(4);if("dev"===e){const t=r.src,e=t.indexOf("?"),i=0>e?t.length:e,s=t.lastIndexOf("/",i)+1,o=t.indexOf(".",s),a=0>o?"":t.slice(o,i);return`${t.slice(0,s)}plugins/${n}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${n}.min.js`}(t,e,this._currentScript),n.setAttribute("data-request",r),document.head.appendChild(n)}const n=await(new b).get(r);!this.isRegistered(t)&&this.register(n)}}class F{constructor(t,e){n(this,t,["getPluginClass","addSubtree","addPayloadPass","addUrlPass","whenInstalled","whenRegistered"]),i(this,{classes:e})}}class H{constructor(t){n(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const K=new class extends x{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new B(this),this._clients=[],this._payloadPasses=[],this._urlPasses=[],this.version="1.8.0-beta.4"}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}};var V=Object.freeze({__proto__:null,viewable:async function(t){let{area:e=.5,duration:r=1e3,signal:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=c(t),new Promise((i=>{const o=new s((t=>{t&&(o.disconnect(),a.disconnect(),i())}),{onDuration:r}),a=new IntersectionObserver((t=>{o.value=t[0].isIntersecting}),{threshold:e});a.observe(t),n&&n.addEventListener&&n.addEventListener("abort",(()=>{o.disconnect(),a.disconnect()}))}))}});class W extends x{static attach(){(window.MisoClients||(window.MisoClients=[])).push(W),window.MisoClient?window.MisoClient!==W&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=W}constructor(t){var e;super("client",K),this._config(t),this.context=new z(this),this.api=new U(this,K),K._clients.push(e=this),K._events.emit("create",e)}get version(){return W.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t=Object.assign({},this._readConfigFromScriptUrl(),t)),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,r(t)}_readConfigFromScriptUrl(){const t=document.currentScript;return r({apiKey:new URL(new Request(t.src||t.href).url).searchParams.get("api_key")||void 0})}}W.helpers=V,i(W,{uuid:u()});var J=function(t){const e=K._pluginRoot;return K.MisoClient=e.MisoClient=t,n(t,K,["version","instances","any","meta","on","once"]),n(t,e,["plugins"]),t}(W);class X{constructor(t){this._plugin=t}get anonymous_id(){return this._anonymousId||this._autoAnonymousId||(this._autoAnonymousId=l("miso_anonymous_id",u))}set anonymous_id(t){t=e(t),this._anonymousId=t,this._plugin._events.emit("set",`anonymous_id = '${t}'`)}get user_id(){return this._userId}set user_id(t){t=e(t),this._userId=t,this._plugin._events.emit("set",`user_id = '${t}'`)}get user_hash(){return this._userHash}set user_hash(t){if("string"!=typeof t&&void 0!==t)throw Error("User hash must be a string");this._userHash=t,this._plugin._events.emit("set",`user_hash = '${t}'`)}}function Y(){const t=new URLSearchParams(window.location.search);let e=r({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class Z{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const r=this._config[e],n=t[e];n!==r&&(this._config[e]=r,this._plugin._events.emit("config",`${e}: ${r} -> ${n}`))}return Object.freeze(Object.assign({},this._config))}}const Q=["groupName","apiName","url","bulk"];function tt(){let{text:t="Miso"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"%c"+t}function et(){let{color:t="#fff",background:e="#334cbb"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}function rt(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}J.plugins.register(class{constructor(){this._options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}static get id(){return"std:debug"}install(t){var e=this;this._injectComponents(t),t.debug=function(){return e._logr(...arguments)}}config(){this._options=Object.assign({},this._options,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}_injectComponents(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.on("child",(t=>this._injectComponents(t,e))),t.on("subtree",(r=>this._injectComponents(r,e.concat(t.meta.path)))),t.on("*",((r,n)=>this._handleEvent(t,n,r,e)))}_handleEvent(t,e,r){let{name:n}=e;if("child"===n||"subtree"===n)return;const i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:[]).concat(t.meta.path);if(i.length||"create"!==n){switch(i[0]){case"client":if("api"===i[1])return void this._handleApiEvent(n,Object.assign({},r,{groupName:i[2]}));break;case"plugins":return void(1===i.length?this._handlePluginsEvent(n,r):this._handlePluginSpecificEvent(i[1],i.slice(2),n,r))}this._logw(i.join("."),n,r)}else this._handleCreateClient(n,r)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,e){let{groupName:r,url:n,bulk:i}=e,s=function(t,e){if(null==t)return{};var r,n,i={},s=Object.keys(t);for(n=0;s.length>n;n++)0>e.indexOf(r=s[n])&&(i[r]=t[r]);return i}(e,Q);const o=new URL(n).pathname,a=["api",t];if(i&&a.push(`(bulk ${i.bulkId})`),a.push("POST "+o),"interactions"===r){const{type:t}=s.payload.data[0];a.push(t)}a.push([Object.assign({},s,{url:n})]),this._log(...a)}_handlePluginsEvent(t,e){let r=[];Array.isArray(e)&&(r=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...r])}_handlePluginSpecificEvent(t,e,r,n){this._logw([t,e.join(".")],r,n)}_getPath(t){const e=[];for(let r=t;r;r=r.meta.parent)r.meta.name&&e.push(r.meta.name);return e.reverse()}_logr(){const t=this._options.console||{};for(var e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];console.log(tt(t),et(t),...r)}_log(t,e){const r=this._options.console||{};for(var n=arguments.length,i=Array(n>2?n-2:0),s=2;n>s;s++)i[s-2]=arguments[s];console.log(tt(r),et(r),function(t){return`<${"string"==typeof t?t:t.filter((t=>t)).join("/")}>`}(t),function(t){return`[${t}]`}(e),...i)}_logw(t,e,r){void 0===r?this._log(t,e):Array.isArray(r)?this._log(t,e,...r.map(rt)):this._log(t,e,rt(r))}},class{constructor(){this._options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,e){let{addUrlPass:r}=e;r(this._modifyUrl.bind(this))}_modifyUrl(t){let{apiGroup:e,apiName:r,url:n}=t;return"interactions"===e&&"upload"===r?function(t,e,r){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===r&&(r="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+r)}(n,"dry_run","1"):n}}),J.plugins.use(class extends x{static get id(){return"std:user"}constructor(){super("user"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new X(this);var r,n;this._contexts.set(t,e),r=e,Object.defineProperties(t.context,(n="string"==typeof(n=["anonymous_id","user_id","user_hash"])?[n]:n).reduce(((t,e)=>(t[e]={get:()=>r[e],set:t=>{r[e]=t}},t)),{}))}_modifyPayload(t){let{client:e,apiGroup:r,apiName:n,payload:i}=t;return"interactions"===r&&"upload"===n?this._modifyPayloadForInteractions(e,i):this._modifyPayloadForOthers(e,i)}_modifyPayloadForOthers(t,e){const{user_id:r,user_hash:n,anonymous_id:i}=t.context;return Object.assign({},r?{user_id:r,user_hash:n}:{anonymous_id:i},e)}_modifyPayloadForInteractions(t,e){let{data:n}=e;const{anonymous_id:i,user_id:s}=t.context,o=r({anonymous_id:i,user_id:s});return n=n.map((t=>Object.assign({},o,t))),{data:n}}}),J.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,e){let{addPayloadPass:r}=e;r(this._modifyPayload.bind(this))}_modifyPayload(t){let{apiGroup:e,apiName:r,payload:n}=t;return"interactions"===e&&"upload"===r?this._modifyPayloadForInteractions(n):n}_modifyPayloadForInteractions(t){let{data:e}=t;return e=e.map((t=>Object.assign({},t,{context:Object.assign({},r({page:r({url:window.location.href,referrer:document.referrer,title:document.title}),campaign:Y()}),t.context)}))),{data:e}}}),J.plugins.use(class extends x{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new Z(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest(t){let{client:e,apiGroup:r,apiName:n,payload:i}=t;if("search"===r)if("search"===n)this._captureSearchApiRequest(e,i)}_captureSearchApiRequest(t,e){let{q:r}=e;if(!r||"*"===r)return;const n=this._contexts.get(t);n&&n._config.search&&t.api.interactions.upload({type:"search",search:{keywords:r},context:{custom_context:{channel:"miso_api"}}})}}),J.attach(),_("misodev"),setTimeout((()=>_("misocmd")));var nt=Object.freeze({...function(){const t=document.currentScript;if(!t||!t.src)return{};const e=document.createElement("a");e.href=t.src;const r={};for(const[t,n]of new URLSearchParams(e.search))r[t]=""===n||n;return r}(),...function(){const t={};for(const[e,r]of new URLSearchParams(window.location.search))e.startsWith("miso_ipp_")&&e.length>9&&"miso_ipp_api_key"!==e&&(t[e.substring(9)]=""===r||r);return t}()}),it="1.0.36-beta.0";function st(...t){window.MisoClient&&window.MisoClient.plugins.isInstalled("std:debug")&&function(...t){console.log("%cMiso","color: #fff; background-color: #334cbb; padding: 2px 2px 1px 4px;",...t)}(...t)}const ot=864e5;function at(t){const e=t.split("-"),r=""+e[2].substring(1)+e[1]+e[0];return Math.floor(parseInt(r,16)/1e7)-12219292800}let ct;async function ut(){return ct||(ct=async function(){return async function(t,{interval:e=300,timeout:r}={}){const n=t();return null!=n?n:new Promise(((n,i)=>{let s,o;function a(){s&&clearInterval(s),o&&clearTimeout(o)}s=setInterval((()=>{const e=t();null!=e&&(a(),n(e))}),e),r&&r>0&&(o=setTimeout((()=>{a(),i(Error("Timeout: "+r))}),r))}))}((()=>window.ga&&window.ga.getAll&&window.ga.getAll()[0]))}())}async function lt(t){const e={};let r;try{r=await async function(t){if(!t)throw Error("Blank post ID.");const e=`https://b2c-contenthub.com/wp-json/wp/v2/posts/${t}?_embed=1`;return(await window.fetch(e)).json()}(t),st("Fetched post info",[r])}catch(r){return console.error("Cannot fetch post: "+t),console.error(r),e}try{const t=r._embedded["wp:term"];for(const r of t)r.length>0&&"story_types"===r[0].taxonomy&&(e.storyTypes=r.map((t=>t.name)))}catch(e){console.error("Cannot extract story types: "+t),console.error(e)}try{const{suppress_monetization:t='""'}=r.meta||{},n=JSON.parse(t);e.adSuppression=!0===n.content_ads}catch(e){console.error("Cannot extract suppress_monetization info: "+t),console.error(e)}return e}const dt=new Set(["News","Feature","How-To","Opinion"]);async function pt(t,e,r){return async function(t,{ids:e=[],...r}={}){if(0===e.length)return[];const n=`/wp-json/idg/v2/${t}?${new URLSearchParams({...r,include:e.join(","),per_page:100})}`,i=await window.fetch(n);return await i.json()}(e,{ids:r,article_id:t.postId,_embed:1})}function mt(t){return t.product_id.replace("product_","")}async function ht(t,e,{miso_id:r}={}){if(0===e.length)return{};const n=await pt(t.pageInfo,"deals-view",e);for(const e in n)n[e]=yt({...n[e],id:e},{...t,id:e,miso_id:r});return n}const _t='data-vars-link-position="',ft='data-miso-attribution="miso-ipp" data-miso-product-type="deal" ';function yt(t,e){return t=function(t,{pageInfo:e}){const{amazon_us_tag:r}=e.site;if(!r)return t;try{const{html:e}=t,s=e.indexOf('"https://go.redirectingat.com/'),o=0>s?-1:e.indexOf('"',s+1);if(o>=0){const a=(n=e.substring(s+1,o),(i=document.createElement("textarea")).innerHTML=n,i.value),{searchParams:c}=new URL(a),u=new URL(c.get("url"));if(u.hostname.endsWith("amazon.com")){u.searchParams.set("tag",r),c.set("url",""+u);const n="https://go.redirectingat.com/?"+c;t.html=e.substring(0,s+1)+"https://go.redirectingat.com/?"+c+e.substring(o),st("[Recommendation] Replaced Amazon link tag in deal view.",{original:a,replaced:n})}}}catch(t){console.error("Failed to replace Amazon link tag."),console.error(t)}var n,i;return t}(t=function(t,{miso_id:e}={}){try{const{html:r,id:n}=t,i=`data-product="${n}" `,s=r.indexOf(_t);if(0>s)throw Error(`Cannot find '${_t}' in product view HTML.`);let o=ft;e&&(o+=`data-miso-miso-id="${e}" `),t.html=r.substring(0,s)+i+o+r.substring(s)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t,e),e)}var gt={block:{title:"Today's Best Deals"},text:{from:"From",was:"Was",now:"Now",view_deal:"View deal"}},bt={block:{title:"Die besten Angebote des Tages"},text:{from:"Von",was:"Vorher",now:"Jetzt",view_deal:"Angebot ansehen"}};function wt(t,e,r={}){const n={product_ids:e.map((t=>t.product_id)),context:{custom_context:vt(t,e,r)}};return r.miso_id&&(n.miso_id=r.miso_id),n}function vt({type:t,site:e,storyId:r},n,{miso_id:i}={}){const{geo:s}=nt,o={source:"miso-client-script",script_version:it,attribution:"miso-ipp",site:e.key,user_geo:s,product_types:n.map((t=>t.type))};if("story"===t&&r&&(o.story_id=r),i)try{o.api_ts=at(i)}catch(t){console.warn("[Recommendation] Failed to parse timestamp from miso_id: "+i)}return o}async function kt(t,e,{miso_id:r}={}){if(0===e.length)return{};const n=await pt(t.pageInfo,"products-view",e);for(const e in n)n[e]=xt(n[e],{...t,id:e,miso_id:r});return n}function xt(t,e){return!!function({html:t},{id:e,client:r,pageInfo:n}){if("false"===config.prod_check||"0"===config.prod_check)return st("[Recommendation] Product view validation waived due to prod_check=0 flag"),!0;if(0>t.indexOf(It))return st(`[Recommendation] Exclude product ${e} due to lack of outbound link.`),r.api.interactions.upload({type:"custom",custom_action_name:"invalid_product_view",product_ids:["product_"+e],context:{custom_context:vt(n,[{type:"product"}])}}),!1;return!0}(t,e)&&(t=function(t,e){try{const{html:e}=t,r=e.indexOf(jt);if(0>r)throw Error(`Cannot find '${jt}' in product view HTML.`);t.html=e.substring(0,r)+Et+e.substring(r)}catch(t){console.error("Failed to add miso attribution attribute on anchor element."),console.error(t)}return t}(t=function(t,{pageInfo:e}){const{html:r}=t,n=(i=e.site.lang,"de"===i?bt:gt);var i;return t.html=r.replace(Rt,`${Pt}${n.block.title}</h4>`),t}(t,e)))}const It='data-vars-outbound-link="',Pt='<h4 class="product-widget__block-title" id="">',Rt=Pt+"</h4>",jt='data-vars-outbound-link="',Et='data-miso-attribution="miso-ipp" data-miso-product-type="product" ';function Ot(t){return`<svg xmlns="http://www.w3.org/2000/svg"><defs>${function(t,e){return`<linearGradient id="${St(t)}"><stop offset="0%" stop-color="${e[0]}" /><stop offset="100%" stop-color="${e[1]}" /></linearGradient>`}("trending",t)}</defs></svg>`}const At=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 400"><path fill="url(#${St("trending")})" d="m21.396 329.097 210.253-165.83c13.108-10.339 31.941-8.957 43.4 3.184l107.207 113.594 203.12-196.862-147.095-1.456c-17.8-.177-32.086-14.749-31.91-32.549.177-17.8 14.749-32.086 32.549-31.91l217.02 2.149c17.547.174 31.73 14.353 31.91 31.9l2.148 210.574c.182 17.8-14.1 32.377-31.9 32.558-17.8.182-32.376-14.1-32.558-31.9l-1.298-127.265-220.577 213.78a32.23 32.23 0 0 1-45.871-1.022L248.412 232.144 61.316 379.71c-13.977 11.024-34.243 8.63-45.267-5.347-11.023-13.976-8.63-34.243 5.347-45.266z"/></svg>`;function St(t){return`miso-${t}-gradient`}async function Ct(t,e,r){const n=document.createElement("style");n.innerHTML=function(t){const{pageInfo:e}=t,{site:r}=e,{styles:n}=r;return`\n.miso-ipp-articles,\n.miso-ipp-articles__header,\n.miso-ipp-articles__body,\n.miso-ipp-articles__list,\n.miso-ipp-articles__item {\n  display: flex;\n  gap: 1rem;\n}\n.miso-ipp-articles {\n  margin: 20px 0;\n  padding: 1rem;\n  padding-top: 1.65rem;\n  flex-direction: column;\n  gap: 1.65rem;\n  background-color: ${n.background};\n}\n.miso-ipp-articles__header {\n  gap: 0.75rem;\n  align-items: center;\n}\n.miso-ipp-articles__headline {\n  margin: 0 !important;\n  padding: 0;\n  font-size: 1.75rem;\n  font-weight: 700;\n  color: ${n.headline};\n}\n.miso-ipp-articles__image-box {\n  width: 250px;\n  flex-shrink: 0;\n  padding-top: 0.5rem;\n}\n.miso-ipp-articles__image-box > img {\n  width: 100%;\n}\n.miso-ipp-articles__list {\n  list-style: none;\n  margin: 0;\n  flex-direction: column;\n}\n.miso-ipp-articles__item {\n  gap: 0.75rem;\n  font-size: 1.25rem;\n}\n.miso-ipp-articles__item-link {\n  line-height: 1.5em;\n  font-size: 1.25rem;\n  font-weight: 600;\n  color: ${n.title} !important;\n}\n.miso-ipp-articles__svg-defs {\n  position: absolute;\n  height: 0;\n  overflow: hidden;\n}\n.miso-ipp-articles__svg-defs > svg {\n  height: 0;\n}\n.miso-ipp-articles__header-icon,\n.miso-ipp-articles__item-icon {\n  display: block;\n  flex-shrink: 0;\n}\n.miso-ipp-articles__header-icon {\n  height: 1.75rem;\n}\n.miso-ipp-articles__item-icon {\n  height: 1.25rem;\n  margin-top: 0.25em;\n}\n.miso-ipp-articles__header-icon > svg,\n.miso-ipp-articles__item-icon > svg {\n  width: 100%;\n  height: 100%;\n}\n@media (min-width: 680px) {\n  .miso-ipp-articles__item-icon {\n    display: none;\n  }\n}\n@media (max-width: 679px) {\n  .miso-ipp-articles__image-box,\n  .miso-ipp-articles__header-icon {\n    display: none;\n  }\n}\n`}(t),document.head.appendChild(n);const i="miso-ipp-articles",s=function(t,e,{id:r}){if(!e||0===e.length)return"";const{pageInfo:n}=t,{site:i}=n,{styles:s}=i;return`\n<div id="${r}" class="miso-ipp-articles">\n  <div class="miso-ipp-articles__svg-defs">\n    ${Ot(s.icon)}\n  </div>\n  <div class="miso-ipp-articles__header">\n    <i class="miso-ipp-articles__header-icon">${At}</i>\n    <h3 class="miso-ipp-articles__headline">Trending in this topic</h3>\n  </div>\n  <div class="miso-ipp-articles__body">\n    ${function(t,e){const[{cover_image:r}]=e;return`<div class="miso-ipp-articles__image-box"><img src="${r}"></div>`}(0,e)}\n    ${function(t,e){return`<ul class="miso-ipp-articles__list">${e.map((e=>function(t,e){const{product_id:r}=e,{miso_id:n}=t,i=[`data-product="${r}"`,'data-miso-attribution="miso-ipp"','data-miso-product-type="story"'];n&&i.push(`data-miso-miso-id="${n}"`);return`\n<li class="miso-ipp-articles__item">\n  <i class="miso-ipp-articles__item-icon">${At}</i>\n  <a class="miso-ipp-articles__item-link" href="${e.url}" target="_blank" rel="nofollow" ${i.join(" ")}>${e.title}</a>\n</li>`.trim()}(t,e))).join("")}</ul>`}(t,e)}\n  </div>\n</div>`.trim()}(t,e,{id:i});if(!s)return;st("[Recommendation] Inserting view HTML on page..."),r.insertAdjacentHTML("afterend",s),st("[Recommendation] Rendered successfully.");const o=document.getElementById(i),a=o.querySelector(".miso-ipp-articles__list"),c=o.querySelector(".miso-ipp-articles__image-box > img");a.addEventListener("mouseover",(({target:t})=>{const r=t.closest(".miso-ipp-articles__item");if(!r)return;const n=Array.prototype.indexOf.call(a.children,r);c.src=e[n].cover_image}))}function $t(t,e,r,n){if(!r)return;st("[Recommendation] Capturing impression event...");const i=new IntersectionObserver((r=>{if(r[0].isIntersecting){try{i.disconnect()}catch(t){console.error(t)}!function({client:t,pageInfo:e},r,n){if(Nt)return;Nt=!0,t.api.interactions.upload({...wt(e,r,n),type:"impression"}),st("[Recommendation] Impression event sent.")}(t,e,n)}}),{threshold:.5});i.observe(r)}let Nt=!1;async function Tt(t){const{client:e,pageInfo:r}=t;if("story"!==r.type)return void st(`[Recommendation] No block shown: not a story page (${r.type})`);const{storyTypes:n=[],adSuppression:i=!1}=await lt(r.postId)||{};if(i)return void st("[Recommendation] No block shown: ad suppression is enabled.");if(!n.some((t=>dt.has(t))))return void st("[Recommendation] No block shown: not applied for story_type: "+n.join(", "));const s=document.querySelector("#link_wrapped_content > p:nth-of-type(14)");if(!s)return void st("[Recommendation] No block shown: cannot find the reference position for recommendation block.");st("[Recommendation] Fetching results from Miso API...");const{products:o,type:a,...c}=await Mt(t);o&&0!==o.length?(st("[Recommendation] Building views..."),await async function(t,e,r,n,i){if("article"===e)await Ct(t,r,i);else{const e=await async function(t,e,r){const n=[],i=[],s=[];for(const t of e)switch(t.type){case"product":n.push(mt(t));break;case"deal":i.push(mt(t));break;case"story":s.push(t);break;default:throw Error("Unrecognized product type: "+t.type)}if(0===n.length&&0===i.length&&s.length>0)return st("[Recommendation] Show articles."),await buildArticlesHtml(t,s,r);const[o,a]=await Promise.all([kt(t,n,r),ht(t,i,r)]),c={...o,...a};return e.map((t=>c[mt(t)])).filter((t=>t)).map((t=>t&&t.html||"")).join("")}(t,r,n);if(!e)return;st("[Recommendation] Inserting view HTML on page..."),i.insertAdjacentHTML("afterend",e),st("[Recommendation] Rendered successfully.")}}(t,a,o,c,s),e.api.interactions.upload({...wt(r,o,c),type:"custom",custom_action_name:"display"}),$t(t,o,s.nextElementSibling,c)):st("[Recommendation] No block shown: no result from Miso API.")}function Lt(){const{geo:t,rec_type:e}=nt;if(e&&"product"!==e&&"deal"!==e)throw Error('Type parameter should be either "product", "deal", or absent: '+e);const r=Date.now();let n;const i=function(t){if(t)switch(t=t.toLowerCase()){case"us":case"gb":return t;case"de":case"at":case"ch":return"eu";default:return}}(t),s=function(t){if(t)switch(t){case"us":return 9910;case"gb":return 17657;case"eu":return 22080;default:return}}(i);if((!e||"deal"===e)&&i){n='type:"deal"';const t=function(t){const e=new Date(t);return e.setMinutes(0,0,0),e}(r).toISOString();n+=` AND custom_attributes.start_date:["${function(t,e){let r=Math.floor((e||Date.now())/ot)-t;return new Date(r*ot)}(28,r).toISOString()}" TO "${t}"]`,n+=` AND custom_attributes.end_date:["${t}" TO *]`,n+=` AND custom_attributes.geo_tags:"${i}"`;const e="custom_attributes.idg_deal_territories:0";n+=" AND "+(s?`(${e} OR custom_attributes.idg_deal_territories:${s})`:e)}return n}async function Mt(t,e={}){if(nt.test_deal)return{type:"product/deal",products:[{product_id:"product_"+nt.test_deal,type:"deal"}]};if(nt.test_articles){const t=nt.test_articles.split(",");return{type:"article",products:await Ut(t)}}const{client:r,pageInfo:n}=t,i=Lt();if(!i)return{type:"product/deal",products:[]};e={product_id:n.storyId,fl:["type"],fq:i,rows:1,...e};try{const{products:t,miso_id:n}=await r.api.recommendation.productToProducts(e);return{type:"product/deal",products:t,miso_id:n}}catch(t){return console.error(t),[]}}const qt=["id","title","meta","jetpack_featured_media_url"];async function Ut(t){return(await async function(t,{fields:e}={}){if(!t||0===t.length)return[];const r=new URLSearchParams({include:t.join(","),per_page:100,_embed:1});e&&e.length>0&&r.set("_fields",e.join(","));const n="https://b2c-contenthub.com/wp-json/wp/v2/posts/?"+r;return(await window.fetch(n)).json()}(t,{fields:qt})).map((({id:t,title:e,meta:r,jetpack_featured_media_url:n})=>{const{permalink:i}=r.__idg_published_ids[0],{hostname:s}=new URL(i);return{type:"story",product_id:`story_${s.replace(/^www\./,"").replace(/\.com$/,"").replace(/\.de$/,"").replace(/\.se$/,"")}_${t}`,title:e.rendered,url:i,cover_image:n}}))}const zt=[{product_id:"mfr_acer",type:"manufacturer",title:"Acer",hostnames:["acer"]},{product_id:"mfr_activision",type:"manufacturer",title:"Activision",hostnames:["activision"]},{product_id:"mfr_adobe",type:"manufacturer",title:"Adobe",hostnames:["adobe"]},{product_id:"mfr_alientware",type:"manufacturer",title:"Alienware",hostnames:["alientware"]},{product_id:"mfr_alteclansing",type:"manufacturer",title:"Altec Lansing",hostnames:["alteclansing"]},{product_id:"mfr_amazon",type:"manufacturer",title:"Amazon",hostnames:["amazon"]},{product_id:"mfr_amd",type:"manufacturer",title:"AMD",hostnames:["amd"]},{product_id:"mfr_anker",type:"manufacturer",title:"Anker",hostnames:["anker"]},{product_id:"mfr_aoc",type:"manufacturer",title:"AOC",hostnames:["aoc"]},{product_id:"mfr_apple",type:"manufacturer",title:"Apple",hostnames:["apple"]},{product_id:"mfr_arlo",type:"manufacturer",title:"Arlo",hostnames:["arlo"]},{product_id:"mfr_aspyr",type:"manufacturer",title:"Aspyr Media",hostnames:["aspyr"]},{product_id:"mfr_asus",type:"manufacturer",title:"Asus",hostnames:["asus"]},{product_id:"mfr_autodesk",type:"manufacturer",title:"Autodesk",hostnames:["autodesk"]},{product_id:"mfr_avast",type:"manufacturer",title:"Avast",hostnames:["avast"]},{product_id:"mfr_avg",type:"manufacturer",title:"AVG",hostnames:["avg"]},{product_id:"mfr_avira",type:"manufacturer",title:"Avira",hostnames:["avira"]},{product_id:"mfr_avmtech",type:"manufacturer",title:"AVM",hostnames:["avmtech"]},{product_id:"mfr_bang-olufsen",type:"manufacturer",title:"Bang & Olufsen",hostnames:["bang-olufsen"]},{product_id:"mfr_bestsbydre",type:"manufacturer",title:"Beats by Dr. Dre",hostnames:["bestsbydre"]},{product_id:"mfr_belkin",type:"manufacturer",title:"Belkin",hostnames:["belkin"]},{product_id:"mfr_benq",type:"manufacturer",title:"BenQ",hostnames:["benq"]},{product_id:"mfr_bethseda",type:"manufacturer",title:"Bethesda",hostnames:["bethseda"]},{product_id:"mfr_bitdefender",type:"manufacturer",title:"BitDefender",hostnames:["bitdefender"]},{product_id:"mfr_blizzard",type:"manufacturer",title:"Blizzard Entertainment",hostnames:["blizzard"]},{product_id:"mfr_bose",type:"manufacturer",title:"Bose",hostnames:["bose"]},{product_id:"mfr_bowerswilkins",type:"manufacturer",title:"Bowers & Wilkins",hostnames:["bowerswilkins"]},{product_id:"mfr_brother",type:"manufacturer",title:"Brother",hostnames:["brother"]},{product_id:"mfr_buffalo-technology",type:"manufacturer",title:"Buffalo Technology",hostnames:["buffalo-technology"]},{product_id:"mfr_canon",type:"manufacturer",title:"Canon",hostnames:["canon"]},{product_id:"mfr_case-mate",type:"manufacturer",title:"Case-Mate",hostnames:["case-mate"]},{product_id:"mfr_casetify",type:"manufacturer",title:"Casetify",hostnames:["casetify"]},{product_id:"mfr_casio",type:"manufacturer",title:"Casio",hostnames:["casio"]},{product_id:"mfr_corel",type:"manufacturer",title:"Corel",hostnames:["corel"]},{product_id:"mfr_corsair",type:"manufacturer",title:"Corsair",hostnames:["corsair"]},{product_id:"mfr_creative",type:"manufacturer",title:"Creative",hostnames:["creative"]},{product_id:"mfr_crucial",type:"manufacturer",title:"Crucial",hostnames:["crucial"]},{product_id:"mfr_cyberghostvpn",type:"manufacturer",title:"Cyberghost",hostnames:["cyberghostvpn"]},{product_id:"mfr_cyberlink",type:"manufacturer",title:"CyberLink",hostnames:["cyberlink"]},{product_id:"mfr_cygnett",type:"manufacturer",title:"Cygnett",hostnames:["cygnett"]},{product_id:"mfr_dell",type:"manufacturer",title:"Dell",hostnames:["dell"]},{product_id:"mfr_denon",type:"manufacturer",title:"Denon",hostnames:["denon"]},{product_id:"mfr_dji",type:"manufacturer",title:"DJI",hostnames:["dji"]},{product_id:"mfr_dlink",type:"manufacturer",title:"D-Link",hostnames:["dlink"]},{product_id:"mfr_dyson",type:"manufacturer",title:"Dyson",hostnames:["dyson"]},{product_id:"mfr_edifier",type:"manufacturer",title:"Edifier",hostnames:["edifier"]},{product_id:"mfr_ea",type:"manufacturer",title:"Electronic Arts",hostnames:["ea"]},{product_id:"mfr_elgato",type:"manufacturer",title:"Elgato",hostnames:["elgato"]},{product_id:"mfr_epson",type:"manufacturer",title:"Epson",hostnames:["epson"]},{product_id:"mfr_eset",type:"manufacturer",title:"Eset",hostnames:["eset"]},{product_id:"mfr_esgear",type:"manufacturer",title:"ESR",hostnames:["esgear"]},{product_id:"mfr_eufy",type:"manufacturer",title:"Eufy",hostnames:["eufy"]},{product_id:"mfr_xvuslink",type:"manufacturer",title:"ExpressVPN",hostnames:["xvuslink","xvkklink"]},{product_id:"mfr_evga",type:"manufacturer",title:"eVGA",hostnames:["evga"]},{product_id:"mfr_feralinteractive",type:"manufacturer",title:"Feral Interactive",hostnames:["feralinteractive"]},{product_id:"mfr_fitbit",type:"manufacturer",title:"Fitbit",hostnames:["fitbit"]},{product_id:"mfr_freecom",type:"manufacturer",title:"Freecom",hostnames:["freecom"]},{product_id:"mfr_fujifilm",type:"manufacturer",title:"Fujifilm",hostnames:["fujifilm"]},{product_id:"mfr_fujitisu",type:"manufacturer",title:"Fujitsu",hostnames:["fujitisu"]},{product_id:"mfr_gameloft",type:"manufacturer",title:"Gameloft",hostnames:["gameloft"]},{product_id:"mfr_garmin",type:"manufacturer",title:"Garmin",hostnames:["garmin"]},{product_id:"mfr_gateway",type:"manufacturer",title:"Gateway",hostnames:["gateway"]},{product_id:"mfr_gear4",type:"manufacturer",title:"Gear4",hostnames:["gear4"]},{product_id:"mfr_gigabyte",type:"manufacturer",title:"Gigabyte",hostnames:["gigabyte"]},{product_id:"mfr_google",type:"manufacturer",title:"Google",hostnames:["google"]},{product_id:"mfr_griffintechnology",type:"manufacturer",title:"Griffin",hostnames:["griffintechnology"]},{product_id:"mfr_gtech",type:"manufacturer",title:"G-Technology",hostnames:["gtech"]},{product_id:"mfr_hitachi",type:"manufacturer",title:"Hitachi",hostnames:["hitachi"]},{product_id:"mfr_honor",type:"manufacturer",title:"Honor",hostnames:["honor"]},{product_id:"mfr_hp",type:"manufacturer",title:"HP",hostnames:["hp"]},{product_id:"mfr_htc",type:"manufacturer",title:"HTC",hostnames:["htc"]},{product_id:"mfr_huawei",type:"manufacturer",title:"Huawei",hostnames:["huawei"]},{product_id:"mfr_hyperx",type:"manufacturer",title:"HyperX",hostnames:["hyperx"]},{product_id:"mfr_ibm",type:"manufacturer",title:"IBM",hostnames:["ibm"]},{product_id:"mfr_iluv",type:"manufacturer",title:"iLuv",hostnames:["iluv"]},{product_id:"mfr_incase",type:"manufacturer",title:"Incase",hostnames:["incase"]},{product_id:"mfr_incipio",type:"manufacturer",title:"Incipio",hostnames:["incipio"]},{product_id:"mfr_intego",type:"manufacturer",title:"Intego",hostnames:["intego"]},{product_id:"mfr_intel",type:"manufacturer",title:"Intel",hostnames:["intel"]},{product_id:"mfr_intuit",type:"manufacturer",title:"Intuit",hostnames:["intuit"]},{product_id:"mfr_iomega",type:"manufacturer",title:"Iomega",hostnames:["iomega"]},{product_id:"mfr_jabra",type:"manufacturer",title:"Jabra",hostnames:["jabra"]},{product_id:"mfr_jbl",type:"manufacturer",title:"JBL",hostnames:["jbl"]},{product_id:"mfr_johnlewis",type:"manufacturer",title:"John Lewis",hostnames:["johnlewis","john-lewis-and-partners"]},{product_id:"mfr_kaspersky",type:"manufacturer",title:"Kaspersky Lab",hostnames:["kaspersky"]},{product_id:"mfr_kensington",type:"manufacturer",title:"Kensington",hostnames:["kensington"]},{product_id:"mfr_kingston",type:"manufacturer",title:"Kingston",hostnames:["kingston"]},{product_id:"mfr_kodak",type:"manufacturer",title:"Kodak",hostnames:["kodak"]},{product_id:"mfr_konica-minolta",type:"manufacturer",title:"Konica Minolta",hostnames:["konica-minolta"]},{product_id:"mfr_lacie",type:"manufacturer",title:"LaCie",hostnames:["lacie"]},{product_id:"mfr_lego",type:"manufacturer",title:"LEGO",hostnames:["lego"]},{product_id:"mfr_lenovo",type:"manufacturer",title:"Lenovo",hostnames:["lenovo"]},{product_id:"mfr_lexmark",type:"manufacturer",title:"Lexmark",hostnames:["lexmark"]},{product_id:"mfr_lg",type:"manufacturer",title:"LG",hostnames:["lg"]},{product_id:"mfr_linksys",type:"manufacturer",title:"Linksys",hostnames:["linksys"]},{product_id:"mfr_logitech",type:"manufacturer",title:"Logitech",hostnames:["logitech"]},{product_id:"mfr_macally",type:"manufacturer",title:"Macally",hostnames:["macally"]},{product_id:"mfr_macpaw",type:"manufacturer",title:"Macpaw",hostnames:["macpaw"]},{product_id:"mfr_marware",type:"manufacturer",title:"Marware",hostnames:["marware"]},{product_id:"mfr_mcafee",type:"manufacturer",title:"McAfee",hostnames:["mcafee"]},{product_id:"mfr_medion",type:"manufacturer",title:"Medion",hostnames:["medion"]},{product_id:"mfr_microsoft",type:"manufacturer",title:"Microsoft",hostnames:["microsoft"]},{product_id:"mfr_monoprice",type:"manufacturer",title:"Monoprice",hostnames:["monoprice"]},{product_id:"mfr_mophie",type:"manufacturer",title:"Mophie",hostnames:["mophie"]},{product_id:"mfr_moshi",type:"manufacturer",title:"Moshi",hostnames:["moshi"]},{product_id:"mfr_motorola",type:"manufacturer",title:"Motorola",hostnames:["motorola"]},{product_id:"mfr_mous",type:"manufacturer",title:"Mous",hostnames:["mous"]},{product_id:"mfr_mozilla",type:"manufacturer",title:"Mozilla",hostnames:["mozilla"]},{product_id:"mfr_msi",type:"manufacturer",title:"MSI",hostnames:["msi"]},{product_id:"mfr_mujjo",type:"manufacturer",title:"Mujjo",hostnames:["mujjo"]},{product_id:"mfr_nec",type:"manufacturer",title:"NEC",hostnames:["nec"]},{product_id:"mfr_netgear",type:"manufacturer",title:"Netgear",hostnames:["netgear"]},{product_id:"mfr_nikon",type:"manufacturer",title:"Nikon",hostnames:["nikon"]},{product_id:"mfr_nintendo",type:"manufacturer",title:"Nintendo",hostnames:["nintendo"]},{product_id:"mfr_nokia",type:"manufacturer",title:"Nokia",hostnames:["nokia"]},{product_id:"mfr_nomad",type:"manufacturer",title:"Nomad",hostnames:["nomad"]},{product_id:"mfr_nordvpn",type:"manufacturer",title:"NordVPN",hostnames:["nordvpn"]},{product_id:"mfr_norton",type:"manufacturer",title:"Norton",hostnames:["norton"]},{product_id:"mfr_nvidia",type:"manufacturer",title:"Nvidia",hostnames:["nvidia"]},{product_id:"mfr_oculus",type:"manufacturer",title:"Oculus",hostnames:["oculus"]},{product_id:"mfr_olixar",type:"manufacturer",title:"Olixar",hostnames:["olixar"]},{product_id:"mfr_olympus",type:"manufacturer",title:"Olympus",hostnames:["olympus"]},{product_id:"mfr_oneplus",type:"manufacturer",title:"OnePlus",hostnames:["oneplus"]},{product_id:"mfr_oppo",type:"manufacturer",title:"Oppo",hostnames:["oppo"]},{product_id:"mfr_otterbox",type:"manufacturer",title:"OtterBox",hostnames:["otterbox"]},{product_id:"mfr_owc",type:"manufacturer",title:"OWC",hostnames:["owc"]},{product_id:"mfr_palm",type:"manufacturer",title:"Palm",hostnames:["palm"]},{product_id:"mfr_panasonic",type:"manufacturer",title:"Panasonic",hostnames:["panasonic"]},{product_id:"mfr_parallels",type:"manufacturer",title:"Parallels",hostnames:["parallels"]},{product_id:"mfr_philips",type:"manufacturer",title:"Philips",hostnames:["philips"]},{product_id:"mfr_pioneer",type:"manufacturer",title:"Pioneer",hostnames:["pioneer"]},{product_id:"mfr_plantronics",type:"manufacturer",title:"Plantronics",hostnames:["plantronics"]},{product_id:"mfr_plugable",type:"manufacturer",title:"Plugable",hostnames:["plugable"]},{product_id:"mfr_pny",type:"manufacturer",title:"PNY",hostnames:["pny"]},{product_id:"mfr_polaroid",type:"manufacturer",title:"Polaroid",hostnames:["polaroid"]},{product_id:"mfr_polywell",type:"manufacturer",title:"Polywell",hostnames:["polywell"]},{product_id:"mfr_proporta",type:"manufacturer",title:"Proporta",hostnames:["proporta"]},{product_id:"mfr_qnap",type:"manufacturer",title:"QNAP",hostnames:["qnap"]},{product_id:"mfr_razer",type:"manufacturer",title:"Razer",hostnames:["razer"]},{product_id:"mfr_ring",type:"manufacturer",title:"Ring",hostnames:["ring"]},{product_id:"mfr_roccat",type:"manufacturer",title:"Roccat",hostnames:["roccat"]},{product_id:"mfr_roku",type:"manufacturer",title:"Roku",hostnames:["roku"]},{product_id:"mfr_samsung",type:"manufacturer",title:"Samsung",hostnames:["samsung"]},{product_id:"mfr_sandisk",type:"manufacturer",title:"SanDisk",hostnames:["sandisk"]},{product_id:"mfr_sapphire",type:"manufacturer",title:"Sapphire",hostnames:["sapphire"]},{product_id:"mfr_satechi",type:"manufacturer",title:"Satechi",hostnames:["satechi"]},{product_id:"mfr_scosche",type:"manufacturer",title:"Scosche",hostnames:["scosche"]},{product_id:"mfr_seagate",type:"manufacturer",title:"Seagate",hostnames:["seagate"]},{product_id:"mfr_sega",type:"manufacturer",title:"Sega",hostnames:["sega"]},{product_id:"mfr_sennheiser",type:"manufacturer",title:"Sennheiser",hostnames:["sennheiser"]},{product_id:"mfr_serif",type:"manufacturer",title:"Serif",hostnames:["serif"]},{product_id:"mfr_sharp",type:"manufacturer",title:"Sharp",hostnames:["sharp"]},{product_id:"mfr_shure",type:"manufacturer",title:"Shure",hostnames:["shure"]},{product_id:"mfr_signify",type:"manufacturer",title:"Signify",hostnames:["signify"]},{product_id:"mfr_sonos",type:"manufacturer",title:"Sonos",hostnames:["sonos"]},{product_id:"mfr_sony",type:"manufacturer",title:"Sony",hostnames:["sony"]},{product_id:"mfr_speck",type:"manufacturer",title:"Speck",hostnames:["speck"]},{product_id:"mfr_speckproducts",type:"manufacturer",title:"Speck Products",hostnames:["speckproducts"]},{product_id:"mfr_spigen",type:"manufacturer",title:"Spigen",hostnames:["spigen"]},{product_id:"mfr_square-enix",type:"manufacturer",title:"Square Enix",hostnames:["square-enix"]},{product_id:"mfr_steam",type:"manufacturer",title:"Steam",hostnames:["steam"]},{product_id:"mfr_steelseries",type:"manufacturer",title:"SteelSeries",hostnames:["steelseries"]},{product_id:"mfr_stm",type:"manufacturer",title:"STM",hostnames:["stm"]},{product_id:"mfr_symantec",type:"manufacturer",title:"Symantec",hostnames:["symantec"]},{product_id:"mfr_synology",type:"manufacturer",title:"Synology",hostnames:["synology"]},{product_id:"mfr_targus",type:"manufacturer",title:"Targus",hostnames:["targus"]},{product_id:"mfr_tech21",type:"manufacturer",title:"Tech21",hostnames:["tech21"]},{product_id:"mfr_t-mobile",type:"manufacturer",title:"T-Mobile",hostnames:["t-mobile"]},{product_id:"mfr_toshiba",type:"manufacturer",title:"Toshiba",hostnames:["toshiba"]},{product_id:"mfr_tp-link",type:"manufacturer",title:"TP-Link",hostnames:["tp-link"]},{product_id:"mfr_transcend",type:"manufacturer",title:"Transcend",hostnames:["transcend"]},{product_id:"mfr_trendmicro",type:"manufacturer",title:"Trend Micro",hostnames:["trendmicro"]},{product_id:"mfr_twelvesouth",type:"manufacturer",title:"Twelve South",hostnames:["twelvesouth"]},{product_id:"mfr_ubisoft",type:"manufacturer",title:"UbiSoft",hostnames:["ubisoft"]},{product_id:"mfr_ugreen",type:"manufacturer",title:"UGreen",hostnames:["ugreen"]},{product_id:"mfr_verbatim",type:"manufacturer",title:"Verbatim",hostnames:["verbatim"]},{product_id:"mfr_viewsonic",type:"manufacturer",title:"ViewSonic",hostnames:["viewsonic"]},{product_id:"mfr_vivo",type:"manufacturer",title:"Vivo",hostnames:["vivo"]},{product_id:"mfr_vizio",type:"manufacturer",title:"Vizio",hostnames:["vizio"]},{product_id:"mfr_vmware",type:"manufacturer",title:"VMware",hostnames:["vmware"]},{product_id:"mfr_wacom",type:"manufacturer",title:"Wacom",hostnames:["wacom"]},{product_id:"mfr_waterfield-designs",type:"manufacturer",title:"WaterField Designs",hostnames:["waterfield-designs"]},{product_id:"mfr_westerndigital",type:"manufacturer",title:"Western Digital",hostnames:["westerndigital"]},{product_id:"mfr_withings",type:"manufacturer",title:"Withings",hostnames:["withings"]},{product_id:"mfr_wixstats",type:"manufacturer",title:"Wix",hostnames:["wixstats"]},{product_id:"mfr_xerox",type:"manufacturer",title:"Xerox",hostnames:["xerox"]},{product_id:"mfr_xiaomi",type:"manufacturer",title:"Xiaomi",hostnames:["xiaomi"]},{product_id:"mfr_xtrememac",type:"manufacturer",title:"XtremeMac",hostnames:["xtrememac"]},{product_id:"mfr_yamaha",type:"manufacturer",title:"Yamaha",hostnames:["yamaha"]},{product_id:"mfr_zagg",type:"manufacturer",title:"Zagg",hostnames:["zagg"]},{product_id:"mfr_zotac",type:"manufacturer",title:"ZOTAC",hostnames:["zotac"]},{product_id:"mfr_zyxel",type:"manufacturer",title:"ZyXEL",hostnames:["zyxel"]}].reduce(((t,e)=>{const{hostnames:r}=e;for(const n of r)t.set(n,e);return t}),new Map);Object.defineProperty(J,"name",{value:"ipp"});const Gt=["product-name","link-position-id","link-position","outbound-link"],Dt=["attribution","product-type"];function Bt(t,{keywords:e,...r}){!function(t,e,r){const{client:n}=t;n.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{...Ft(t),...r}}})}(t,e,{...r,attribution:"google-cse"})}function Ft(t,e=[]){const{pageInfo:r,config:n,version:i}=t,{site:s}=r,{geo:o}=n;let a={source:"miso-client-script",script_version:i,site:s.key,user_geo:o};for(const r of e)a=r(a,t);return a}function Ht(t,{pageInfo:e}){const{type:r,storyId:n}=e;return"story"===r&&n&&(t.story_id=n),t}function Kt(t,{element:e}){for(const r of Gt){const n=e.getAttribute("data-vars-"+r);n&&(t[r.replaceAll("-","_")]=n)}for(const r of Dt){const n=e.getAttribute("data-miso-"+r);n&&(t[r.replaceAll("-","_")]=n)}return t}(async({site:t,config:e,version:r})=>{const n="false"!==e.ui&&"0"!==e.ui&&!1!==t.ui;if(window.miso_ipp_script_version)return void console.warn("Miso IPP script already executed: "+window.miso_ipp_script_version);window.miso_ipp_script_version=r;const i="dev"===r||r.indexOf("beta")>0;i&&J.plugins.use("std:debug"),st("Miso IPP script version: "+r),e.test_deal?(J.plugins.use("std:dry-run"),st("[Recommendation] Test deal: "+e.test_deal)):e.test_articles?(J.plugins.use("std:dry-run"),st("[Recommendation] Test articles: "+e.test_articles)):e.dry_run&&J.plugins.use("std:dry-run");const s={apiKey:e.api_key};e.api_host&&(s.apiHost=`https://${e.api_host}/v1`);const o=window.miso=new J(s);o.context.anonymous_id=await async function(){return(await ut()).get("clientId")}();const a=function(t){const{pathname:e}=window.location;if("/"===e)return{type:"home",site:t};const r=e.substring(1).split("/");switch(r[0]){case"article":const e=""+r[1];return{type:"story",site:t,postId:e,storyId:`story_${t.key}_${e}`};case"search":if(1===r.length){const{search:e}=window.location,r=new URLSearchParams(e).get("q"),n={type:"search",site:t};return r?{...n,q:r}:n}}return{type:"other",site:t}}(t),c={client:o,pageInfo:a,config:e,version:r};!function(t){const{client:e,pageInfo:r}=t,{type:n,storyId:i}=r;switch(n){case"home":e.api.interactions.upload({type:"home_page_view",context:{custom_context:Ft(t)}});break;case"story":e.api.interactions.upload({type:"product_detail_page_view",product_ids:[i],context:{custom_context:Ft(t)}});break;case"search":const{q:n}=r;n&&Bt(t,{keywords:n})}}(c),function(t){document.addEventListener("click",(e=>{if(e.defaultPrevented)return;const r=e.target;if(!r.tagName||"a"!==r.tagName.toLowerCase())return;const n=r.getAttribute("data-product");if(n)return void function(t){const{client:e,element:r,id:n}=t,i="product_"+n,s=Ft(t,[Ht,Kt]);if(s.product_type)s.product_types=[s.product_type],delete s.product_type;else{const t=function(t){for(;(t=t.parentElement)&&!t.classList.contains(Jt);){for(const e of Vt)if(t.classList.contains(e))return"product";for(const e of Wt)if(t.classList.contains(e))return"deal"}return}(r);t&&(s.product_types=[t])}const o=r.getAttribute("data-miso-miso-id");if(o)try{s.api_ts=at(o)}catch(t){console.warn("[Recommendation] Failed to parse timestamp from miso_id: "+o)}const a={type:"checkout",product_ids:[i],miso_id:o,context:{custom_context:s}};o&&(a.miso_id=o);e.api.interactions.upload(a)}({...t,element:r,id:n});const i=function({element:t}){try{const{hostname:e}=new URL(t.href);for(const t of e.split(".")){const e=zt.get(t);if(e)return e}}catch(t){}}({element:r});i&&function(t){const{client:e,element:r,manufacturer:n}=t,{product_id:i}=n,s=Ft(t,[Ht,Kt]);delete s.product_type,s.product_types=["manufacturer"],s.url=r.href;e.api.interactions.upload({type:"checkout",product_ids:[i],context:{custom_context:s}})}({...t,element:r,manufacturer:i})}))}(c),function(t){if("search"!==t.pageInfo.type)return;!function(t){const{head:e}=window.document,{appendChild:r}=e;e.appendChild=(...n)=>{const[i]=n;if("script"===i.tagName.toLowerCase())try{const e=i.getAttribute("src"),r=new URL(e);if("cse.google.com"===r.hostname&&r.pathname.startsWith("/cse/element")){const e=r.searchParams.get("q"),n=r.searchParams.get("sort");e&&t(n?{keywords:e,sort:n}:{keywords:e})}}catch(t){}return r.apply(e,n)}}((e=>Bt(t,e)))}(c),n&&Tt(c),i&&(o._recp2p=async t=>Mt(c,{fl:["*"],...t}))})({site:{key:"macwelt",hostname:"www.macwelt.de",name:"Macwelt",lang:"de",styles:{background:"#d0e7f3",headline:"#111",title:"#111",icon:["#307ba1","#61c4f6"]}},config:nt,version:it});const Vt=["product-chart-item","product-widget"],Wt=["price-comparison"],Jt="link_wrapped_content"}();
