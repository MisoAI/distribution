!function(){"use strict";!function(e,t){void 0===t&&(t={});var s=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===s&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}('.miso-primary-button{background:var(--buttonBgColor);border:0;border-radius:5px;color:var(--buttonTextColor);cursor:pointer;font-family:var(--bodyFont);font-size:var(--label-4);font-weight:700;justify-content:center;letter-spacing:1px;padding:12px 20px;text-align:center;transition:all .25s linear;width:auto}.miso-icon-button{align-items:center;background:#fff;border:1px solid var(--listBorderColor);border-radius:5px;color:#000;cursor:pointer;display:flex;justify-content:center}.miso-loading{padding:16px!important}.miso-loading:before{height:32px!important}.miso-powered-by{font-size:16px;font-weight:400;line-height:1}.miso-more-button{background:none!important;border:none!important;color:#1969a0!important;font-size:16px!important;font-weight:700;text-decoration:underline}.Page-header-search,.Page-header-search-overlay{display:none!important}.miso-page-header-search{align-items:center;display:flex}.miso-page-header-search-button{border-width:0;height:40px;width:40px}.miso-page-header-search-button .miso-arizent-icon-ai-search{height:27px;width:27px}.miso-page-header-search-button .miso-arizent-icon-close-x{display:none;height:16px;width:16px}body[data-toggle-header=miso-search-overlay] .miso-page-header-search-button .miso-arizent-icon-ai-search{display:none}body[data-toggle-header=miso-search-overlay] .miso-page-header-search-button .miso-arizent-icon-close-x,body[data-toggle-header=miso-search-overlay] .miso-page-header-search-overlay{display:flex}.miso-page-header-search-overlay{--miso-title-font-family:"Merriweather",Arial,Helvetica,sans-serif;background-color:#fff;border-top:1px solid #e6e6e6;box-shadow:0 2px 4px 0 rgba(0,0,0,.15);display:none;flex-direction:column;font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;gap:20px;padding:20px 16px;position:absolute;width:100%;z-index:25}.miso-page-header-search-overlay h2{font-family:var(--miso-title-font-family);font-size:24px;font-weight:400;letter-spacing:0;line-height:32px}.miso-page-header-search-overlay .miso-page-header-search-form{position:relative}.miso-page-header-search-overlay .miso-page-header-search-input{border:1px solid #3c3c3c;border-radius:5px;color:#121212;font-size:18px;font-style:normal;font-weight:400;height:48px;line-height:20px;padding-left:16px;width:100%}.miso-page-header-search-overlay .miso-page-header-search-submit{background:#3c3c3c;border:1px solid #3c3c3c;border-radius:0 5px 5px 0;color:#fff;cursor:pointer;height:48px;padding:0;position:absolute;right:0;width:48px}.miso-page-header-search-overlay .miso-page-header-search-submit svg{bottom:33px;height:30px;width:25px}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns{display:flex;flex-direction:row;gap:32px}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns>*{flex:1}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns h2{margin:16px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns hr{border:none;border-top:1px solid var(--listBorderColor)}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics,.miso-page-header-search-overlay .miso-page-header-search-overlay__upcoming-event{display:none}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics{flex:1}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics ul{list-style:none}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics li{border:1px solid var(--listBorderColor);border-radius:5px;color:var(--headerTextColor);font-size:14px;font-weight:700;line-height:16px;margin:12px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics a{align-items:center;display:flex;gap:8px;height:40px;justify-content:left;padding:0 8px}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics a:hover{color:#1969a0}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics svg{height:24px;width:24px}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions{flex:2}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions ul{padding-left:1.6em}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions li{color:var(--headerTextColor);font-family:var(--miso-title-font-family);font-size:14px;font-weight:700;line-height:26px;margin:12px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions a:hover{color:#1969a0}.miso-page-header-search-overlay .miso-page-header-search-overlay__upcoming-event{flex:1;visibility:hidden}@media only screen and (min-width:768px){.miso-page-header-search-button{border-width:1px}.miso-page-header-search-overlay{padding:20px 24px!important}.miso-page-header-search-overlay__trending-topics,.miso-page-header-search-overlay__upcoming-event{display:block!important}}.miso-hybrid-search-combo{--miso-title-font-family:"Merriweather",Arial,Helvetica,sans-serif;--miso-search-box-font-size:24px!important;--miso-list-image-aspect-ratio:3/2!important;--miso-search-box-icon-size:20px!important;--miso-horizontal-item-index-size:24px!important;font-family:var(--bodyFont)!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{display:grid;gap:56px;grid-template-areas:"query" "answer" "sources" "results";grid-template-columns:1fr;grid-template-rows:auto}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-query{grid-area:query}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-answer{grid-area:answer}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-results{grid-area:results}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-sources{grid-area:sources}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container,.miso-hybrid-search-combo .miso-hybrid-search-combo__query-container,.miso-hybrid-search-combo .miso-hybrid-search-combo__section,.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-container{padding:0!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container,.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-container{margin-top:0!important}.miso-hybrid-search-combo .miso-search-box__input-group{border:none!important;border-bottom:1px solid #333!important;border-radius:0!important;box-shadow:none!important}.miso-hybrid-search-combo .miso-search-box__input{border-radius:0!important;font-family:var(--miso-title-font-family)!important;padding-left:0!important}.miso-hybrid-search-combo .miso-search-box__button{padding:0 10px 0 0!important}.miso-hybrid-search-combo .miso-search-box__button svg{height:30px!important;width:30px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__disclaimer{align-items:start;color:#121212;display:flex;flex-direction:row;font-family:var(--bodyFont)!important;gap:8px;margin-bottom:6px;margin-top:16px}.miso-hybrid-search-combo .miso-hybrid-search-combo__disclaimer-icon{align-items:center;display:flex;height:20px;justify-content:center;width:20px}.miso-hybrid-search-combo .miso-powered-by{font-size:18px;font-weight:400;line-height:20px}.miso-hybrid-search-combo .miso-resource-attribution{font-size:14px;font-weight:400;line-height:20px;margin-top:8px}.miso-hybrid-search-combo [data-role=answer]{font-family:var(--bodyFont)!important;font-size:16px!important}.miso-hybrid-search-combo [data-role=answer] a:not(.miso-citation-link){color:#1969a0;text-decoration:underline}.miso-hybrid-search-combo [status~=unanswerable] miso-answer{display:none}.miso-hybrid-search-combo [status~=unanswerable] .miso-hybrid-search-combo__feedback-container{display:none!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton miso-answer,.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-skeleton{display:none}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton .miso-hybrid-search-combo__answer-skeleton{display:flex;flex-direction:column;gap:16px}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton .miso-hybrid-search-combo__answer-skeleton .miso-hybrid-search-combo__answer-skeleton-half-line,.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton .miso-hybrid-search-combo__answer-skeleton .miso-hybrid-search-combo__answer-skeleton-line{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite;background-color:#e8e8ea;border-radius:24px;height:16px}@keyframes pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton .miso-hybrid-search-combo__answer-skeleton .miso-hybrid-search-combo__answer-skeleton-line{width:100%}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container--skeleton .miso-hybrid-search-combo__answer-skeleton .miso-hybrid-search-combo__answer-skeleton-half-line{width:60%}.miso-hybrid-search-combo .miso-hybrid-search-combo__feedback-container{display:none}.miso-hybrid-search-combo [blocked-reason=none][finish-reason=success] .miso-hybrid-search-combo__feedback-container{align-items:center;display:flex;gap:32px;margin-top:16px}.miso-hybrid-search-combo .miso-feedback{gap:32px;margin-top:0!important}.miso-hybrid-search-combo .miso-feedback__option{color:#000!important}.miso-hybrid-search-combo .miso-feedback__option:hover{background-color:transparent!important}.miso-hybrid-search-combo .miso-feedback__option .miso-feedback__icon{height:14px;width:14px}.miso-hybrid-search-combo .miso-feedback__option .miso-feedback__text{font-size:12px;font-style:normal;font-weight:400;line-height:26px}.miso-hybrid-search-combo .miso-feedback[data-selected=helpful] .miso-feedback__option[data-value=helpful],.miso-hybrid-search-combo .miso-feedback[data-selected=unhelpful] .miso-feedback__option[data-value=unhelpful]{color:#1969a0!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__feedback-link,.miso-hybrid-search-combo .miso-hybrid-search-combo__learn-more-link{align-items:center;color:#1969a0;display:inline-flex;font-size:12px;font-weight:700;line-height:26px}.miso-hybrid-search-combo .miso-hybrid-search-combo__feedback-link svg,.miso-hybrid-search-combo .miso-hybrid-search-combo__learn-more-link svg{height:16px;margin-top:1px;width:16px}.miso-hybrid-search-combo .miso-hybrid-search-combo__learn-more-link{margin-left:4px}.miso-hybrid-search-combo [blocked-reason=metering] miso-answer{-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box;overflow:hidden;position:relative}.miso-hybrid-search-combo [blocked-reason=metering] miso-answer:after{background:linear-gradient(180deg,hsla(0,0%,100%,0),#fff);bottom:0;content:"";height:70%;left:0;position:absolute;width:100%}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate,.miso-hybrid-search-combo .miso-hybrid-search-combo__subscribe-gate{align-items:center;display:none;flex-direction:column;gap:30px;padding-bottom:30px}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate>p,.miso-hybrid-search-combo .miso-hybrid-search-combo__subscribe-gate>p{margin:0}.miso-hybrid-search-combo .miso-hybrid-search-combo__subscribe-gate{padding-top:30px}.miso-hybrid-search-combo.anonymous [blocked-reason=metering] .miso-hybrid-search-combo__sign-up-gate,.miso-hybrid-search-combo.registered [blocked-reason=metering] .miso-hybrid-search-combo__subscribe-gate{display:flex}.miso-hybrid-search-combo .miso-hybrid-search-combo__gate-logo{height:30px}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-login-hint{background:#f3f3f3;font-size:16px;font-weight:400;height:40px;letter-spacing:0;line-height:40px;text-align:center;width:100%}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-login-link,.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-subscribe-link{color:#1969a0;cursor:pointer;font-weight:700;text-decoration:underline}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-sign-up-phrase,.miso-hybrid-search-combo .miso-hybrid-search-combo__subscribe-gate-subscribe-phrase{font-size:26px;font-weight:700;letter-spacing:0;line-height:32px;text-align:center}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-sign-up-note{font-size:18px;font-weight:400;line-height:26px;text-align:center}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-sign-up-button,.miso-hybrid-search-combo .miso-hybrid-search-combo__subscribe-gate-subscribe-button{text-transform:uppercase;width:320px}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-or-separator{color:grey;position:relative;text-align:center;width:75%}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-or-separator:before{background-color:#aaa;content:"";height:1px;left:0;position:absolute;top:50%;width:100%;z-index:-1}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-or-separator>span{background-color:#fff;font-size:14px;font-weight:400;letter-spacing:0;line-height:22px;padding:0 1em}.miso-hybrid-search-combo .miso-hybrid-search-combo__sign-up-gate-subscribe-hint{font-size:16px;font-weight:700;letter-spacing:0;line-height:24px;text-align:center}.miso-hybrid-search-combo ul.miso-hybrid-search-combo__subscribe-gate-bullet-points{display:flex;flex-direction:column;gap:10px;list-style:none}.miso-hybrid-search-combo ul.miso-hybrid-search-combo__subscribe-gate-bullet-points li{align-items:center;display:flex;flex-direction:row;font-size:14px;font-weight:400;gap:10px;letter-spacing:0;line-height:20px}.miso-hybrid-search-combo ul.miso-hybrid-search-combo__subscribe-gate-bullet-points svg{height:11px;width:15px}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__list{overflow-x:unset!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-phrase{font-size:16px!important;font-weight:700!important}.miso-hybrid-search-combo .miso-horizontal__item{background-color:transparent!important;border:none!important;border-radius:0!important;width:auto!important}.miso-hybrid-search-combo .miso-horizontal__item-body{flex-direction:column!important;padding:0!important}.miso-hybrid-search-combo .miso-horizontal__item-title{font-family:var(--miso-title-font-family)!important;font-size:16px!important;font-weight:700;margin-bottom:4px!important}.miso-hybrid-search-combo .miso-horizontal__item-index{font-family:var(--miso-title-font-family)!important;margin-top:0!important}.miso-hybrid-search-combo .miso-horizontal__item-authors-and-date-container{color:#000!important;color:var(--secondaryTextColor)!important;font-size:14px!important;line-height:22px!important;opacity:.5!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__results-header{align-items:start;display:flex;flex-direction:column;gap:16px;justify-content:start;margin-bottom:10px}.miso-hybrid-search-combo .miso-hybrid-search-combo__total-phrase{color:var(--headerTextColor)!important;font-family:var(--miso-title-font-family)!important;font-size:22px!important;font-weight:700!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__search-results-filters{margin-bottom:0!important}.miso-hybrid-search-combo [data-role=sort]{--miso-select-font-size:14px!important;--miso-select-width:180px!important}.miso-hybrid-search-combo .miso-select__button{border-radius:5px!important}.miso-hybrid-search-combo .miso-select .miso-select__option{font-size:var(--miso-select-font-size)!important;gap:4px!important;line-height:var(--miso-select-line-height)!important;padding:.2em .35em!important}.miso-hybrid-search-combo .miso-select .miso-select__option:first-child{padding-top:.4em!important}.miso-hybrid-search-combo .miso-select .miso-select__option:last-child{padding-bottom:.4em!important}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item{border:none!important;border-top:1px solid var(--listBorderColor)!important;border-color:var(--listBorderColor)!important;border-radius:0!important;margin:0!important;padding:15px 0!important}.miso-hybrid-search-combo .miso-list__item-body{align-items:start!important;flex-direction:column-reverse;gap:20px!important;padding:0!important}.miso-hybrid-search-combo .miso-list__item-info-container{gap:10px!important;margin-top:0!important}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item .miso-list__item-cover-image-container{aspect-ratio:unset!important;border-radius:0!important;height:auto!important;min-width:150px!important;width:100%!important}.miso-hybrid-search-combo .miso-list__item-cover-image{aspect-ratio:16/9!important;height:auto!important;max-height:none!important;object-fit:cover!important}.miso-hybrid-search-combo .miso-list__item-section{color:var(--primaryColor1);font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;font-size:var(--section);font-weight:800;letter-spacing:2px;line-height:1.2;text-transform:uppercase;word-break:keep-all}.miso-hybrid-search-combo .miso-list__item-section:hover{color:var(--primaryTextColor)}.miso-hybrid-search-combo .miso-list__item-title{font-family:var(--miso-title-font-family)!important;font-size:var(--title-3)!important;font-weight:700!important;line-height:1.27!important}.miso-hybrid-search-combo .miso-list__item-title mark{font-weight:inherit!important}.miso-hybrid-search-combo .miso-list__item-snippet{color:var(--headerMenuTextColor)!important;font-family:var(--bodyFont)!important;font-size:var(--label-4)!important;font-weight:400!important;letter-spacing:normal!important;line-height:1.57!important}.miso-hybrid-search-combo .miso-list__item-snippet mark{font-weight:inherit!important}.miso-hybrid-search-combo .miso-list__item-author-phrase{color:var(--secondaryTextColor);font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;font-size:var(--section);font-weight:700;letter-spacing:.8px;line-height:1.2}.miso-hybrid-search-combo .miso-list__item-author{color:var(--primaryTextColor)}.miso-hybrid-search-combo .miso-list__item-author:hover{color:var(--primaryColor1)}.miso-hybrid-search-combo .miso-list__item-date{color:var(--secondaryTextColor)!important;font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif!important;font-size:var(--section)!important;font-weight:700!important;letter-spacing:.8px!important;line-height:1.2!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__results-more-container__inner{align-items:center!important;display:flex!important;justify-content:center!important}@media only screen and (max-width:1239px){.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-phrase{margin-bottom:16px!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__list{gap:24px!important;overflow-y:hidden!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item{width:30%!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-body{gap:8px!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-index{width:fit-content!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-authors-and-date-container{display:flex;flex-direction:column}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-authors-and-date-container>:not(:first-child):before{display:none!important}}@media only screen and (min-width:1239px){.miso-hybrid-search-combo{--miso-search-box-font-size:3.2rem!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{grid-template-areas:"query query" "answer sources" "results sources";grid-template-columns:1fr min-content}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-container{background-color:#fff!important;border:1px solid var(--listBorderColor)!important;padding:15px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-phrase{margin-bottom:25px!important;margin-top:0!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__list{flex-direction:column!important;gap:25px!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-body{flex-direction:row!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-title{-webkit-line-clamp:none!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__disclaimer{padding-right:350px!important}.miso-hybrid-search-combo .miso-primary-button[data-role=more]{min-width:310px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{grid-template-columns:1fr 320px}}@media only screen and (max-width:768px){.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item{width:70%!important}}@media only screen and (min-width:768px){.miso-hybrid-search-combo .miso-hybrid-search-combo__results-header{align-items:center;flex-direction:row;justify-content:space-between}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item .miso-list__item-cover-image-container{width:226px!important}.miso-hybrid-search-combo .miso-list__item-body{flex-direction:row!important}}@media only screen and (min-width:768px) and (max-width:1239px){.miso-hybrid-search-combo{padding:0 7.5%!important}}');var e="1.13.0-beta.1";function t(...e){const t=e.length;if(0===t)return(new AbortController).signal;if(1===t)return e[0];const s=new AbortController;for(const t of e)if(t&&t.addEventListener){if(t.aborted)return AbortSignal.abort(t.reason);t.addEventListener("abort",()=>s.abort(t.reason))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var o=Object.freeze({__proto__:null,GROUP:s,NAME:i});function r(e,t){if(!e)return;const s=e.indexOf(t);s>-1&&e.splice(s,1)}function n(e){return Array.isArray(e)?e:void 0===e?[]:[e]}function a(e){if("object"!=typeof e)return e;const t={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&void 0!==e[s]&&(t[s]=e[s]);return t}function c(e){return null==e}function l(e,t,s){Object.defineProperties(e,(s="string"==typeof s?[s]:s).reduce((e,s)=>(e[s]={get:()=>{const e=t[s];return"function"==typeof e?e.bind(t):e}},e),{}))}function u(e,t){for(const s in t)t.hasOwnProperty(s)&&Object.defineProperty(e,s,{value:t[s]})}function h(e){return e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function d(e){return e.replace(/[-_][a-z]/g,e=>e[1].toUpperCase())}function _(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class m{constructor(e,{duration:t=0,onDuration:s,offDuration:i,state:o}={}){if("function"!=typeof e)throw Error("Callback must be a function: "+e);f(s),f(i),f(t),this._callback=e,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:t,off:void 0!==i?i:t})}),this._value=this._state=!!o,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(e){if(this._value===(e=!!e))return;!function(e){if(!e._timeout)return;clearTimeout(e._timeout),e._timeout=void 0}(this);const t=this.durations[e?"on":"off"];t?this._timeout=setTimeout(()=>p(this,e),t):p(this,e),this._value=e}disconnect(){this._active=!1}}function p(e,t){e._state!==t&&(e._state=t,e._active&&e._callback(t))}function f(e,t){if(void 0!==t&&(isNaN(t)||0>t))throw Error(`${e} must be a non-negative number: ${t}`)}function b(e,t,{root:s=e.ownerDocument}={}){for(;e&&e!==s;e=e.parentElement){const s=t(e);if(void 0!==s)return s}}function g(e){const{tagName:t}=e;customElements.define(t,e);for(const e of document.querySelectorAll(t))customElements.upgrade(e)}async function y(e){return new Promise((t,s)=>{window.requestAnimationFrame(async i=>{try{await e(i),t()}catch(e){s(e)}})})}async function v(e,{area:t=.5,duration:s=1e3,signal:i}={}){return e=function(e){return"string"==typeof e?document.querySelector(e):e}(e),new Promise((o,r)=>{const n=new m(e=>{e&&(n.disconnect(),a.disconnect(),o())},{onDuration:s}),a=new IntersectionObserver(e=>{n.value=e[0].isIntersecting},{threshold:t});a.observe(e),i&&i.addEventListener&&i.addEventListener("abort",()=>{n.disconnect(),a.disconnect(),r(new DOMException("Aborted","AbortError"))})})}function w(e){return(e=""+e)&&e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function x(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const e=URL.createObjectURL(new Blob),t=""+e;return URL.revokeObjectURL(e),t.substring(t.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function E(e,t){const s=k(()=>window.localStorage.getItem(e)),i=k(()=>function(e){const t="; "+document.cookie,s=`; ${encodeURIComponent(e)}=`,i=t.indexOf(s);if(0>i)return;const o=i+s.length,r=t.indexOf(";",o);return decodeURIComponent(0>r?t.substring(o):t.substring(o,r))}(e)),o=s||i||""+t();return o&&!s&&k(()=>window.localStorage.setItem(e,o)),o&&!i&&k(()=>function(e,t){document.cookie=`${encodeURIComponent(e)}=${encodeURIComponent(t)}; max-age=31536000; path=/`}(e,o)),o}function k(e){try{return e()}catch(e){if(!function(e){return"SecurityError"===e.name}(e))throw e}}function S(e){return new O(e)}class O{constructor(e){this._value=e;const t=e=>{this._value=e};u(this,{set:t,args:(...e)=>t(e),t:()=>t(!0),f:()=>t(!1),merge:e=>t({...this._value,...e})})}get value(){return this._value}}class I{constructor(){const e=this;e.promise=new Promise((t,s)=>{e.resolve=t,e.reject=s}),Object.freeze(this)}}class C{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(e,t=!1){this._done||(this._value=e,this._done=t,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(e){this._error=e,this._resolution&&(this._resolution.reject(e),this._resolution=void 0)}abort(e){this._aborted=!0,this._abortReason=e,this._resolution&&(e instanceof Error?this._resolution.reject(e):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let e=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(e>this._index&&(this._resolution||(this._resolution=new I),await this._resolution.promise),this._aborted)break;const t=this._done,s=this._index+1;if(yield this._value,this._aborted||t)break;e=s}}}function A(e,t){const s=window[e]||(window[e]=[]);if(s._processed)return;s._processed=!0;const i=e=>function(e,{onError:t=e=>console.error(e),transform:s=e=>e}={}){try{s(e)()}catch(e){t(e)}}(e,t);Object.defineProperty(s,"push",{value:i});for(const e of s)i(e)}let T;try{T=document.currentScript}catch(e){}async function R(e){try{let t=function(e){return document.head.querySelector(`link[href="${e}"]`)}(e);return t||(t=document.createElement("link"),t.rel="stylesheet",t.href=e,document.head.appendChild(t)),async function(e){await async function(e){if(e.sheet)return;return new Promise((t,s)=>{let i;e.onerror=()=>{i&&clearInterval(i),s()},i=setInterval(()=>{e.sheet&&(i&&clearInterval(i),t())},100)})}(e),await async function(e){if(L(e))return;return new Promise(t=>{let s;s=setInterval(()=>{L(e)&&(s&&clearInterval(s),t())},100)})}(e)}(t)}catch(e){console.error(e)}}function N(e){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.13.0-beta.1/dist/css/${e}.css`}function L(e){for(const t of document.styleSheets)if(t.ownerNode===e)return!0;return!1}function $(e){let t;return s=>{t&&clearTimeout(t),t=setTimeout(()=>{t=void 0,s()},e)}}function P(e,{depth:t=5,...s}={}){return U(e,t)}function U(e,t,s){return t>0?"object"==typeof e&&e?void 0!==e.length?Array.prototype.map.call(e,e=>U(e,t-1)):e instanceof Node?function(e){if(e instanceof Element)return`<${e.tagName.toLowerCase()}${e.id?` id="${e.id}"`:""}${e.className?` class="${e.className}"`:""}>`;return`[TextNode](${e.length})`}(e):function(e,t){const s={};if(0>=t)return s;for(const i in e){const o=e[i];"function"!=typeof o&&(i.startsWith("_")&&"object"==typeof o&&"Object"!==o.constructor.name||(s[i]=U(o,t-1)))}return s}(e,t):e:"(...)"}function q(e,t){const s=Object.getOwnPropertyDescriptors(t),i=Object.getOwnPropertyDescriptors(e);for(const[t,o]of Object.entries(s))"constructor"!==t&&void 0===i[t]&&Object.defineProperty(e,t,o)}function j(e){const t={},s=new Set;for(let i=e;i!==Object.prototype;i=Object.getPrototypeOf(i)){const o=Object.getOwnPropertyDescriptors(i);for(const i in o){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:r}=o[i];r&&(t[i]="function"==typeof r?r.bind(e):r)}}return Object.freeze(t)}function z(e={},t={}){const s=e.metadata||t.metadata?a({...e.metadata,...t.metadata}):void 0,i=e._meta||t._meta?a({...e._meta,...t._meta}):void 0;return a({...e,...t,metadata:s,_meta:i})}function D(e={},t={}){const s=e.context&&e.context.custom_context||t.context&&t.context.custom_context?a({...e.context&&e.context.custom_context,...t.context&&t.context.custom_context}):void 0,i=e.context||t.context?a({...e.context,...t.context,custom_context:s}):void 0;return a({...e,...t,context:i})}function M(e){const t=function({speed:e=100,acceleration:t=4}={}){if("function"==typeof e)return e;if("number"!=typeof e)throw Error("Invalid speed: "+e);if("number"!=typeof t)throw Error("Invalid acceleration: "+t);return(s,i)=>{let o=e*(Math.random()+.5);return t>0&&void 0!==i&&s>i&&(o*=1+(s-i)*t/1e3),o}}(e);return(e,s,i,o)=>{const r=t(i,s);return e+Math.max(o-i,0)*r/1e3}}const F=Symbol.for("miso:resources");class B{constructor(){this._resources=new Map;const e=window[F]||[];for(const t of e)try{const[e,s]=t;this.push([e,s])}catch(e){}}push([e,t]){Q(this._resources,e).resolve(t)}async get(e){return Q(this._resources,e).promise}}function Q(e,t){if(e.has(t))return e.get(t);const s=new I;return e.set(t,s),s}function G(){return window[F]||(window[F]=new B)}class H{constructor(e,t){this._dispatchRequested=!1,this._requests=[],this._run=e,this._error=t||(e=>console.error(e)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(e){const t=new I;return this._requests.push({action:e,resolution:t}),this._requestDispatch(),t.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const e=this._requests,t=this._bulkId++;this._requests=[];try{this._run(e,{bulkId:t})}catch(e){this._error(e)}}}class W{constructor({target:e,error:t,replays:s=[]}={}){if(this._error=t||(e=>console.error(e)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},e&&this._injectSubscribeInterface(e)}emit(e,t){const s={data:t,meta:{name:e,ts:Date.now()}},i=this._namedCallbacks[e];if(i)for(const e of i)e(s);for(const e of this._unnamedCallbacks)e(s);this._shallStoreForReplay(e)&&(this._pastEvents[e]||(this._pastEvents[e]=[])).push(s)}on(e,t){return this._checkName(e),this._checkCallback(t),this._on(e,this._wrapCallback(t))}once(e){this._checkName(e);const t=this;return new Promise((s,i)=>{const o=t._on(e,e=>{setTimeout(()=>o());try{s(e)}catch(e){i(e)}})})}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(e){if("string"!=typeof e)throw Error("Event name should be a string: "+e)}_checkCallback(e){if("function"!=typeof e)throw Error("Event callback should be a function: "+e)}_shallStoreForReplay(e){return this._replays.has(e)}_wrapCallback(e){const t=this;return({data:s,meta:i})=>{try{e(s,i)}catch(e){t._error(e)}}}_on(e,t){if("*"===e?this._unnamedCallbacks.push(t):(this._namedCallbacks[e]||(this._namedCallbacks[e]=[])).push(t),"*"===e)for(const e in this._pastEvents)this._pastEvents[e].forEach(t);else this._pastEvents[e]&&this._pastEvents[e].forEach(t);return()=>this._off(e,t)}_off(e,t){if("*"===e)r(this._unnamedCallbacks,t);else{const s=this._namedCallbacks[e];s&&r(s,t)}}_injectSubscribeInterface(e){l(e,this,["on","once"])}}function V(e,t){return Object.freeze([...t&&t.meta&&t.meta.path||[],...e?[e]:[]])}class K{constructor(e,t){const s=function(e,t){if(void 0!==e&&"string"!=typeof e&&void 0===t&&(t=e,e=void 0),void 0!==e&&("string"!=typeof e||!e))throw Error(`Invalid Component name: "${e}"`);return Object.freeze({name:e,parent:t,path:V(e,t),uuid:x()})}(e,t);u(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new W({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(t=s.parent)&&t._events&&t._events.emit("child",this)}_warn(...e){const t=this.meta.parent;(t&&t._warn||console.warn)(...e)}_error(...e){const t=this.meta.parent;(t&&t._error||console.error)(...e)}}!function(e,t){const s=Symbol.for(t);Object.defineProperty(e,s,{value:!0}),Object.defineProperty(e,"isTypeOf",{value:t=>t&&t instanceof e||"function"==typeof t.constructor&&!0===t.constructor[s]})}(K,"miso:component");class Y extends K{constructor(e,t,{libName:s,keyName:i}={}){switch(super(e,t),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=e=>e[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(e){return this._checkKey(e),!!this._libraries[e]}get registered(){return Object.values(this._libraries)}async whenRegistered(e){if(this.isRegistered(e))return this._libraries[e];const{promise:t}=this._libResolutions[e]||(this._libResolutions[e]=new I);return t}register(...e){for(const t of e)this._register(t)}_checkKey(e){if("string"!=typeof e||!e)throw Error("Expect key to be a non-empty string: "+e)}_checkLib(e){if("function"!=typeof e)throw Error("Expect lib to be a class or function: "+e)}_register(e){this._checkLib(e);const t=this._keyFn(e);this._checkKey(t);const s=this._libraries||(this._libraries={});s[t]=e,this._libResolutions[t]&&this._libResolutions[t].resolve(e),this._events.emit("register",e)}}class Z{constructor(e,t){this._callback=e,this._options=t||{},!1!==t&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:t.area||.5}),this._continuity=new m(this._handleContinuity.bind(this),{onDuration:t.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(e){!1!==this._options&&this._intersection.observe(e)}unobserve(e){!1!==this._options&&this._intersection.unobserve(e)}display(e){!1!==this._options&&(this._triggered.has(e)&&(e=void 0),this._displayed!==e&&(this._displayed=e,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(e){this._intersecting=e[0].isIntersecting,this._syncContinuity()}_handleContinuity(e){const t=this._displayed;if(e&&void 0!==t){if(this._triggered.has(t))return;this._triggered.add(t),this._displayed=void 0,this._callback(t)}}}class J{constructor(e){this._ac=new AbortController,this._timeout=e,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout(()=>this.abort(),this._timeout)}get signal(){return this._ac.signal}abort(e){this.clear(),this._ac.abort(e||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const X=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class ee{constructor(e,t){this._client=e,this._root=t,this._bulk=new H(this._runBulkFetch.bind(this),e._error.bind(e))}async fetch(e,t,{method:s="POST",headers:i,timeout:o}={}){const{request:r={}}=this._client.options;o=o||r.timeout;const n="GET"!==s&&null!=t?JSON.stringify(t):void 0,c=o?AbortSignal.timeout(o):void 0,l=await(this._root._customFetch||window.fetch)(e,a({method:s,headers:i,body:n,cache:"no-cache",mode:"cors",signal:c})),u=await l.json();if(l.status>=400||u.errors){var h=Error(u.message);throw h.data=u,h.status=l.status,h}return u}get bulkInfo(){return this._bulk.info}async fetchForBulk(e,t,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:e,apiName:t,payload:s})}async _runBulkFetch(e){const t=this.url(["bulk"]),s={requests:e.map(({action:{apiGroup:e,apiName:t,payload:s}})=>({api_name:`${e}/${t}`,body:s}))},{data:i}=await this.fetch(t,s);for(let t=0,s=e.length;s>t;t++){const{resolution:s}=e[t],{error:o,status_code:r,body:n}=i[t];r>=400||o?s.reject({status_code:r,body:n}):s.resolve(n)}}sendBeacon(e,t,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+e);if(!(this._root._customSendBeacon?this._root._customSendBeacon(e,JSON.stringify(t)):window.navigator.sendBeacon(e,JSON.stringify(t))))throw Error("Send beacon unsuccessful: "+e)}url(e){const{apiKey:t}=this._client.options,s=e.filter(e=>e).join("/");return`${`${this.getApiEndpoint(s)}/${s}`}?api_key=${window.encodeURIComponent(t)}`}getApiEndpoint(e){const{dataEndpoint:t=X.DATA_ENDPOINT,eventEndpoint:s=X.EVENT_ENDPOINT}=this._client.options;return"interactions"===e?s:t}applyUrlPasses(e,{apiGroup:t,apiName:s,url:i}){const o=this._client;for(const r of this._root._urlPasses)try{i=r({client:o,apiGroup:t,apiName:s,url:i})||i}catch(t){(e._error||console.error)(t)}return i}applyPayloadPasses(e,{apiGroup:t,apiName:s,payload:i}){const o=this._client;for(const r of this._root._payloadPasses)try{i=r({client:o,apiGroup:t,apiName:s,payload:i})||i}catch(t){(e._error||console.error)(t)}return i}applyHeaderPasses(e,{apiGroup:t,apiName:s,payload:i,headers:o,options:r}){const n=this._client;for(const a of this._root._headersPasses)try{o=a({client:n,apiGroup:t,apiName:s,payload:i,headers:o,options:r})||o}catch(t){(e._error||console.error)(t)}return o}}class te extends K{constructor(e,t){super(t,e),this._apiPath=t,this.helpers=e.helpers,this.clientOptions=e._client.options,this.context=e._client.context}async _run(e,t,s={}){const{bulk:i}=s,o=i?{bulk:this.helpers.bulkInfo}:void 0,r=this._apiPath,n=this._url({apiGroup:r,apiName:e,payload:t,options:s}),a=this._headers({apiGroup:r,apiName:e,payload:t,options:s}),c={apiGroup:r,apiName:e,payload:t=this._preprocess({apiGroup:r,apiName:e,payload:t,options:s}),url:n,headers:a,options:s};this._events.emit("request",{...c,...o});const l=await this._send(c),u={...c,response:l};return this._events.emit("response",{...u,...o}),this._postprocess(u)}_headers({apiGroup:e,apiName:t,payload:s,options:i}){return this.helpers.applyHeaderPasses(this,{apiGroup:e,apiName:t,payload:s,headers:{},options:i})}_preprocess({apiGroup:e,apiName:t,payload:s,options:i}){return this.helpers.applyPayloadPasses(this,{apiGroup:e,apiName:t,payload:s,options:i})}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([e,t],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}async _send({apiGroup:e,apiName:t,url:s,headers:i,payload:o,options:{bulk:r,...n}={}}){return r?this.helpers.fetchForBulk(e,t,o):this.helpers.fetch(s,o,{...n,headers:i})}_postprocess({response:e}){return e.data}}const{GROUP:se,NAME:ie}=o;class oe extends te{constructor(e){super(e,se.INTERACTIONS)}async upload(e,t){try{return await this._run(ie.UPLOAD,e,t)}catch(e){if(400!==e.status||!e.message||-1>=e.message.toLowerCase().indexOf("playground"))throw e;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:e,apiName:t,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:e,apiName:t,url:i,options:s})}_preprocess({apiGroup:e,apiName:t,payload:s}){return t===ie.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:e,apiName:t,payload:s})}_normalizeUploadPayload(e){if("object"!=typeof e)throw Error("Interactions payload has to be either an object or an array of objects: "+e);return Array.isArray(e)||(e=[e]),{data:e}}async _send({options:{useBeacon:e=!0,...t}={},...s}){if(e){const{url:e,payload:i}=s;return this.helpers.sendBeacon(e,i,t),{}}return super._send({...s,options:t})}}class re{constructor(e={}){this._ac=new AbortController,this._options=e}async get(e){return this._get({...this._options,...e})}_get(e){throw Error("Not implemented")}abort(e){this._ac.abort(e)}[Symbol.asyncIterator](){let{pollingInterval:e,signal:s,stallTimeout:i=12e4,...o}=this._options;const r=new J(i);let n;s=t(this._ac.signal,r.signal,s);return function(e,{interval:t=1e3,errorLimit:s=10,onError:i,onResponse:o,signal:r}={}){if(r&&r.aborted)return[];let n,a,l=0,u=!1;function h(){n&&clearInterval(n),u=!0}const d=new C;return n=setInterval(async()=>{let t,n,_;try{if([t,n,_]=await e(r?{signal:r}:{}),u||!c(a)&&a>=_)return;c(_)||(a=_),o&&o(t,n,_),l=0}catch(e){return i&&i(e),l++,void(l>s&&(h(),d.error(e)))}d.update(t,n),n&&h()},t),r&&r.addEventListener&&r.addEventListener("abort",()=>{h(),d.abort(r.reason)}),d}(async({}={})=>{const e=await this.get();return[e,this._isFinished(e),this._revisionOf(e)]},{interval:e,signal:s,onResponse:(e,t)=>{t?r.clear():this._isUpdated(n,e)&&r.touch(),n=e},...o})[Symbol.asyncIterator]()}_isFinished(e){return!(!e||!e.finished)}_isUpdated(e,t){return!e||e.answer_stage!==t.answer_stage||ae(e.answer)!==ae(t.answer)||ae(e.reasoning)!==ae(t.reasoning)}_revisionOf(e){return e&&e.revision}}class ne extends re{constructor(e,t,s,i){super(i),this._api=e,this._method=t,this._id=s}async _get(e){return this._api[this._method](this._id,e)}}function ae(e=""){return e.length}const{GROUP:ce,NAME:le}=o;class ue extends te{constructor(e){super(e,ce.ASK)}async questions(e,t={}){if(_e(e)&&(e={question_id:e}),e.question_id)return new he(this,e,t);const s=await this._run(le.QUESTIONS,e,t);return new he(this,s,t)}async _questions(e,t){return this._run(le.QUESTIONS,e,t)}async _questionGet(e,t){return this._run(`${le.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async relatedQuestions(e,t={}){return this._run(le.RELATED_QUESTIONS,e,t)}async trendingQuestions(e,t={}){return this._run(le.TRENDING_QUESTIONS,e,t)}async search(e,t={}){if(_e(e)&&(e={question_id:e}),e.question_id)return new de(this,e,t);const s=await this._run(le.SEARCH,e,t);return s.question_id?new de(this,s,t):s}async _searchGet(e,t){return this._run(`${le.QUESTIONS}/${e}/answer`,void 0,{...t,method:"GET"})}async autocomplete(e,t){return this._run(le.AUTOCOMPLETE,e,t)}async searchAutocomplete(e,t){return this._run(le.SEARCH_AUTOCOMPLETE,e,t)}}class he extends ne{constructor(e,t,s={}){super(e,"_questionGet",t.question_id,s),this._response=t}get questionId(){return this._id}}class de extends ne{constructor(e,t,s={}){super(e,"_searchGet",t.question_id,s),u(this,t),this._response=t}get questionId(){return this._id}}function _e(e){return"string"==typeof e&&"{"!==e.charAt(0)}const{GROUP:me,NAME:pe}=o;class fe extends te{constructor(e){super(e,me.SEARCH)}async search(e,t){return this._run(pe.SEARCH,e,t)}async autocomplete(e,t){return this._run(pe.AUTOCOMPLETE,e,t)}async multipleGet(e,t){return this._run(pe.MGET,e,t)}}const{GROUP:be,NAME:ge}=o;class ye extends te{constructor(e){super(e,be.RECOMMENDATION)}async userToProducts(e,t){return this._run(ge.USER_TO_PRODUCTS,e,t)}async userToCategories(e,t){return this._run(ge.USER_TO_CATEGORIES,e,t)}async userToAttributes(e,t){return this._run(ge.USER_TO_ATTRIBUTES,e,t)}async userToTrending(e,t){return this._run(ge.USER_TO_TRENDING,e,t)}async userToHistory(e,t){return this._run(ge.USER_TO_HISTORY,e,t)}async productToProducts(e,t){return this._run(ge.PRODUCT_TO_PRODUCTS,e,t)}}class ve extends K{constructor(e,t){super("api",e),this._client=e,this.helpers=new ee(e,t),this.interactions=new oe(this),this.ask=new ue(this),this.search=new fe(this),this.recommendation=new ye(this)}}var we=Object.freeze({__proto__:null,Api:ve,ApiBase:te,ApiHelpers:ee,Interactions:oe,Ask:ue,Search:fe,Recommendation:ye});class xe extends K{constructor(e){super("context",e),this._client=e}}var Ee={api:we,context:{Context:xe}};class ke{constructor(e){u(this,{install:e})}}class Se extends Y{constructor(e){super("plugins",e,{libName:"plugin class",keyName:"id"}),this._root=e,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new Oe(this,Ee),this.plugins=new Ie(this)}isInstalled(e){return this._checkKey(e),!!this._installed[e]}get installed(){return Object.values(this._installed)}get(e){return this._installed[e]}getPluginClass(e){return this._libraries[e]}use(e,t){if("function"==typeof e&&e.id&&"string"==typeof e.id)return this.register(e),void this.use(e.id,t);let s;if("string"==typeof e&&this.isInstalled(e))return s=this.get(e),void this._tryConfig(s,t);"string"!=typeof e||this.isRegistered(e)?(s=this._instantiate(e,t),this._install(s)):(this._useRequests[e]||(this._useRequests[e]=[])).push(t)}async install(e,t){return this.use(e,t),"string"!=typeof e||this.isRegistered(e)||await this._tryRegisterRemotely(e),this.whenInstalled(e)}async whenInstalled(e){if("function"==typeof e&&e.id&&"string"==typeof e.id&&(e=e.id),this.isInstalled(e))return this.get(e);const{promise:t}=this._installedResolutions[e]||(this._installedResolutions[e]=new I);return t}addSubtree(e){this._subtrees.push(e),this._events.emit("subtree",e)}addPayloadPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._payloadPasses.push(e)}addHeadersPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._headersPasses.push(e)}addUrlPass(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._urlPasses.push(e)}setCustomFetch(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customFetch=e}setCustomSendBeacon(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._customSendBeacon=e}onHubUpdate(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubUpdateCallbacks.push(e)}onHubEmit(e){if("function"!=typeof e)throw Error("Expect parameter to be a function: "+e);this._root._hubEmitCallbacks.push(e)}_tryConfig(e,t){void 0!==t&&("function"==typeof e.config?(e.config(t),this._events.emit("config",[e,t])):this._warn(`Attempt to pass options to plugin "${e.id}", which offers no config() method.`))}_instantiate(e,t){switch(typeof e){case"string":this._checkKey(e);const s=this._libraries[e];if(!s)throw Error("Plugin class not found: "+e);const i=new s;return u(i,{id:e}),this._tryConfig(i,t),i;case"function":return new ke(e)}throw Error("Unexpected parameters: "+e)}_install(e){if("function"!=typeof e.install)throw Error("Expect plugin.install to be a function: "+e);try{e.installed=!1,e.install(this.MisoClient,this.context),e.installed=!0}catch(e){throw e}e.id&&(this._installed[e.id]=e,this._installedResolutions[e.id]&&(this._installedResolutions[e.id].resolve(e),delete this._installedResolutions[e.id])),this._events.emit("install",e)}_register(e){super._register(e),this._fulfillUseRequests(e.id)}_fulfillUseRequests(e){const t=this._useRequests[e];if(t){for(const s of t)try{this.use(e,s)}catch(e){this._error(e)}delete this._useRequests[e]}}async _tryRegisterRemotely(e){if(e.startsWith("std:"))try{return void await this._registerStdRemotely(e)}catch(e){console.error(e)}throw Error("Cannot register plugin remotely: "+e)}async _registerStdRemotely(e){const{version:t}=this._root,s="dev"===t?`plugin:${e}@dev:${this.MisoClient.uuid}`:`plugin:${e}@${t}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(e,t,s){const i=e.slice(4);if("dev"===t){const e=s.src,t=e.indexOf("?"),o=0>t?e.length:t,r=e.lastIndexOf("/",o)+1,n=e.indexOf(".",r),a=0>n?"":e.slice(n,o);return`${e.slice(0,r)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${t}/dist/umd/plugins/${i}.min.js`}(e,t,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new G).get(s);!this.isRegistered(e)&&this.register(i)}}class Oe{constructor(e,t){l(this,e,["getPluginClass","addSubtree","addPayloadPass","addHeadersPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),u(this,{classes:t})}}class Ie{constructor(e){l(this,e,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Ce=new class extends K{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Se(this),this._clients=[],this._payloadPasses=[],this._headersPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=e,this._cmdRes=new I}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Ae=Object.freeze({__proto__:null,viewable:v,debounce:$});const{currentScript:Te}=document;class Re extends K{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Re),window.MisoClient?window.MisoClient!==Re&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Re}static debug(){}constructor(e){super("client",Ce),this._config(e),this.context=new xe(this),this.api=new ve(this,Ce),function(e){Ce._clients.push(e),Ce._events.emit("create",e)}(this)}get version(){return Re.version}_config(e){this.options=Object.freeze(this._normalizeOptions(e))}_normalizeOptions(e={}){if("string"==typeof e&&(e={apiKey:e}),e.readConfigFromScriptUrl&&(e={...this._readConfigFromScriptUrl(),...e}),!e.apiKey)throw Error("Require API key to initialize miso client.");return e.request&&e.request.sendApiKeyByHeader&&console.warn('`sendApiKeyByHeader` option is deprecated. Please call `MisoClient.plugins.use("std:header-api-key");` instead.'),e.dataEndpoint=e.dataEndpoint||e.apiHost,e.eventEndpoint=e.eventEndpoint||e.apiHost,delete e.apiHost,a(e)}_readConfigFromScriptUrl(){return a({apiKey:new URL(new Request(Te.src||Te.href).url).searchParams.get("api_key")||void 0})}}Re.helpers=Ae,u(Re,{uuid:x()});var Ne=function(e){const t=Ce._pluginRoot;return Ce.MisoClient=t.MisoClient=e,l(e,Ce,["version","instances","any","meta","on","once","cmdDone"]),l(e,t,["plugins"]),e}(Re);const{GROUP:Le,NAME:$e}=o;let Pe;class Ue{constructor(e){this._plugin=e,this._props={}}get anonymous_id(){return this._props.anonymous_id||Pe||(Pe=E("miso_anonymous_id",x))}set anonymous_id(e){this._requireString("anonymous_id",e),this._set("anonymous_id",e)}get user_id(){return this._props.user_id}set user_id(e){this._requireString("user_id",e),this._set("user_id",e)}get user_hash(){return this._props.user_hash}set user_hash(e){this._requireString("user_hash",e),this._set("user_hash",e)}get user_type(){return this._props.user_type}set user_type(e){this._requireString("user_type",e),this._set("user_type",e)}get site(){return this._props.site}set site(e){this._requireString("site",e),this._set("site",e)}get auth(){return this._props.auth}set auth(e){this._requireString("auth",e),this._set("auth",e)}_set(e,t){this._props[e]=t,this._plugin._events.emit("set",`${e} = '${t}'`)}_requireString(e,t){if("string"!=typeof t&&void 0!==t)throw Error(e+" must be a string");return t}}function qe(){const e=new URLSearchParams(window.location.search);let t=a({source:e.get("utm_source")||void 0,medium:e.get("utm_medium")||void 0,name:e.get("utm_campaign")||void 0,term:e.get("utm_term")||void 0,content:e.get("utm_content")||void 0});return 0===Object.keys(t).length?void 0:t}class je{constructor(e){this._plugin=e,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(e={}){if("object"!=typeof e)throw Error("Config options must be an object or undefined: "+e);for(const t of e){if(!this._config.hasOwnProperty(t))continue;const s=this._config[t],i=e[t];i!==s&&(this._config[t]=s,this._plugin._events.emit("config",`${t}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function ze(t){const{context:s={}}=t,i={...s.custom_context,sdk_version:e};return i.uuid||(i.uuid=x()),{...t,context:{...s,custom_context:i}}}const De="std:native-fetch";let Me,Fe;const Be=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Me="original",window.fetch;try{const e=document.createElement("iframe");return e.style.display="none",document.head.appendChild(e),Me="borrowed",e.contentWindow.fetch}catch(e){Fe=e}})();const Qe="std:header-api-key";const Ge="miso-logdump",He="miso-logdump",We=He+"__download-btn",Ve="Miso Log";class Ke{constructor(e={}){this._options=e,this._logs=[]}config(e={}){this._options={...this._options,...e}}async showDownloadButton(){await async function(){return Xe||(Xe=R(N("logdump")))}();let e=document.getElementById(Ge);if(!e){const t=document.createElement("div");t.textContent=this._options.logDownloadButtonText||Ve,t.classList.add(We),t.addEventListener("click",()=>this.download()),e=document.createElement("div"),e.id=Ge,e.classList.add(He),e.appendChild(t),document.body.appendChild(e)}e.style.display="block"}_syncUi(){const e=document.getElementById(Ge),t=e&&e.querySelector("."+We);t&&(t.textContent=this._options.logDownloadButtonText||Ve)}hideDownloadButton(){const e=document.getElementById(Ge);e&&(e.style.display="none")}download(){const e=new Blob([Ze(this._logs)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=this._filename(),s.click()}_filename(){let{logFilename:e}=this._options;if("function"==typeof e){e=e({timestamp:Ye()})}return e&&"string"==typeof e?e:`miso-log.${Ye()}.jsonl`}clear(){this._logs=[]}}function Ye(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Ze(e){return e.map(e=>JSON.stringify(P(function(e){if("<progressive-markdown>"===e[0]){const t=e.length;return[...e.slice(0,t-1),Je(e[t-1])]}return e}(e),{depth:10}))).join("\n")}function Je(e){return e?P(e,{depth:2}):e}let Xe;const et="std:debug";function tt(e){const t=typeof e;return"function"===t||"object"===t&&!Array.isArray(e)?[e]:e}Ne.plugins.register(class{constructor(e={}){this._options=e,this._logs=new Ke(e)}static get id(){return et}install(e){this._injectComponents(e),e.debug=(...e)=>this._logr(...e),e.logs=this._logs}config(e={}){this._options={...this._options,...e},this._logs.config(e),e.preserveLog&&this._log(et,"ua",window.navigator.userAgent)}_injectComponents(e,t=[]){e.on("child",e=>this._injectComponents(e,t)),e.on("subtree",s=>this._injectComponents(s,t.concat(e.meta.path))),e.on("*",(s,i)=>this._handleEvent(e,i,s,t))}_handleEvent(e,{name:t},s,i=[]){if("child"===t||"subtree"===t)return;const o=i.concat(e.meta.path);if(o.length||"create"!==t){switch(o[0]){case"client":if("api"===o[1])return void this._handleApiEvent(t,{...s,groupName:o[2]});break;case"plugins":return void(1===o.length?this._handlePluginsEvent(t,s):this._handlePluginSpecificEvent(o[1],o.slice(2),t,s))}this._logw(o.join("."),t,s)}else this._handleCreateClient(t,s)}_handleCreateClient(e,t){this._logw("client",e,t)}_handleApiEvent(e,{groupName:t,apiName:s,url:i,bulk:o,...r}){const n=new URL(i).pathname,a=["api",e];if(o&&a.push(`(bulk ${o.bulkId})`),a.push("POST "+n),"interactions"===t){const e=r.payload.data[0],{type:t,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=e,o="custom"===t&&s?`${t}:${s}`:t;a.push(i?`${o} (${i})`:""+o)}a.push([{...r,url:i}]),this._log(...a)}_handlePluginsEvent(e,t){let s=[];Array.isArray(t)&&(s=t.slice(1),t=t[0]),this._log("plugins",e,""+(t.id||"(anonymous)"),[t,...s])}_handlePluginSpecificEvent(e,t,s,i){this._logw([e,t.join(".")],s,i)}_getPath(e){const t=[];for(let s=e;s;s=s.meta.parent)s.meta.name&&t.push(s.meta.name);return t.reverse()}_logw(e,t,s){void 0===s?this._log(e,t):Array.isArray(s)?this._log(e,t,...s.map(tt)):this._log(e,t,tt(s))}_log(e,t,...s){this._logr(function(e){return`<${"string"==typeof e?e:e.filter(e=>e).join("/")}>`}(e),function(e){return`[${e}]`}(t),...s)}_logr(...e){const t=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(e),console.log(function({text:e="Miso"}={}){return"%c"+e}(t),function({color:e="#fff",background:t="#334cbb"}={}){return`color: ${e}; background-color: ${t}; padding: 2px 2px 1px 4px;`}(t),...e)}},class{constructor(e={}){this._options=e,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(e,{addUrlPass:t}){t(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:e,apiName:t,url:s}){return"interactions"===e&&"upload"===t?function(e,t,s){if("string"!=typeof t)throw Error("Expect URL parameter to be a string: "+t);return void 0===s&&(s="1"),e+(0>e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return De}install(e,t){Be?(t.setCustomFetch(Be),e.debug(`<plugin:${De}>`,"[info]",`Using ${Me} native fetch`)):e.debug(`<plugin:${De}>`,"[error]","Failed to obtain native fetch: "+Fe.message)}},class{static get id(){return Qe}install(e,t){t.addUrlPass(this._modifyUrl.bind(this)),t.addHeadersPass(this._modifyHeaders.bind(this)),e.debug(`<plugin:${Qe}>`,"[info]","Send API key in header")}_modifyUrl({url:e}){return e.replace(/[?&]api_key=[^&]*/g,"")}_modifyHeaders({client:e,headers:t}){const{apiKey:s}=e.options;return s?{...t,"X-API-KEY":s}:t}}),Ne.plugins.use(class extends K{static get id(){return"std:context"}constructor(){super("context")}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addHeadersPass(this._modifyHeaders.bind(this)),t.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(e){const t=new Ue(this);var s,i;s=t,Object.defineProperties(e.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type","site","auth"])?[i]:i).reduce((e,t)=>(e[t]={get:()=>s[t],set:e=>{s[t]=e}},e),{}))}_modifyHeaders({client:e,headers:t}){const{auth:s}=e.context;return s&&(t={...t,Authorization:s}),t}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:i}){return i?t===Le.INTERACTIONS?s===$e.UPLOAD?this._modifyPayloadForInteractions(e,i):i:this._modifyPayloadForQueries(e,i):i}_modifyPayloadForQueries(e,t){const{user_id:s,user_hash:i,user_type:o,anonymous_id:r,site:n}=e.context;return z(t,{...s?{user_id:s,user_type:o,user_hash:i}:{anonymous_id:r},metadata:n?{site:n}:void 0})}_modifyPayloadForInteractions(e,{data:t}){const{anonymous_id:s,user_id:i,site:o}=e.context,r={anonymous_id:s,user_id:i},n=o?{site:o}:void 0,a=n?{custom_context:n}:void 0;return{data:t=t.map(e=>D(e,{...r,context:a}))}}}),Ne.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e=e.map(e=>({...e,context:{...a({page:a({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:qe()}),...e.context}}))}}}),Ne.plugins.use(class extends K{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this)),t.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(e){const t=new je(this);this._contexts.set(e,t),e.autoEvents=t.interface}_captureApiRequest({client:e,apiGroup:t,apiName:o,payload:r}){if(t===s.SEARCH)if(o===i.SEARCH)this._captureSearchApiRequest(e,r)}_captureSearchApiRequest(e,{q:t}){if(!t||"*"===t)return;const s=this._contexts.get(e);s&&s._config.search&&e.api.interactions.upload({type:"search",search:{keywords:t},context:{custom_context:{channel:"miso_api"}}})}}),Ne.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(e,{addPayloadPass:t}){t(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:e,apiName:t,payload:s}){return"interactions"===e&&"upload"===t?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:e}){return{data:e.map(ze)}}}),Ne.plugins.use(class extends K{static get id(){return"std:api-patch"}constructor(){super("api-patch")}install(e,t){t.addSubtree(this),t.addPayloadPass(this._patchApiPayload.bind(this))}_patchApiPayload(e){let{payload:t,...s}=e;return t?(t=this._copyMetadataToMeta(t,s),t=this._suppressMetadata(t,s),t=this._suppressUserType(t,s),t):t}_copyMetadataToMeta(e,{apiGroup:t}){return t===s.ASK&&e.metadata?{...e,_meta:e.metadata}:e}_suppressMetadata(e,{apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:const{_meta:t,metadata:i,...o}=e;return o;default:return e}}_suppressUserType(e,{apiGroup:t}){switch(t){case s.SEARCH:case s.RECOMMENDATION:const{user_type:t,...i}=e;return i;default:return e}}});const st="default",it=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),ot=new Set([it.PRODUCTS,it.CATEGORIES,it.ATTRIBUTES,it.RESULTS,it.ITEMS,it.QUESTION,it.ANSWER,it.REASONING,it.IMAGES,it.SOURCES,it.RELATED_RESOURCES,it.FOLLOW_UP_QUESTIONS,it.QUERY_SUGGESTIONS,it.RELATED_QUESTIONS,it.AFFILIATION,it.FACETS,it.TOTAL]);function rt(e){return ot.has(e)}const nt=new Set([it.PRODUCTS,it.IMAGES,it.SOURCES,it.RELATED_RESOURCES]);const at=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ct=[at.IMPRESSION,at.VIEWABLE,at.CLICK,at.SUBMIT,at.FEEDBACK],lt=[at.IMPRESSION,at.VIEWABLE,at.CLICK],ut=new Set(lt);const ht=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),dt=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),_t=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function mt(e){if(0>ct.indexOf(e))throw Error("Unrecognized event type: "+e)}const pt=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"}),ft=Object.freeze({QUERY:"query",REFINE:"refine",MORE:"more"});function bt(e,t){return Object.freeze({...e,...t,members:gt(e.members,t.members),mappings:Object.freeze({...e.mappings,...t.mappings})})}function gt(e=[],t=[]){return[...new Set([...e,...t])]}function yt(e,t){let s={};for(const i of e)i&&(s=t(s,i));return a(s)}function vt(e){if(void 0===e)throw Error("Expect options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e}function wt(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>Object.assign(e,{...t,payload:z(e.payload,t.payload)}))}function xt(e){return e=function(e){return e.replaceAll("-","_")}(e=e.replace(/[A-Z]/g,e=>"_"+e.toLowerCase()))}function Et(e){if(void 0===e)return;let[t,s]=n(e);return"object"==typeof t&&(s=t,t=void 0),[t,s]}function kt(e,t){return!1===(t=Et(t))[0]?t:e&&t?[t[0]||e[0],St(e[1],t[1])]:t||e}function St(e,t){return{...e,...t,link:{...e&&e.link,...t&&t.link},templates:{...e&&e.templates,...t&&t.templates}}}const Ot=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function It(e={}){e=vt(e);const{active:t,...s}=e;for(const[e,t]of Object.entries(s))Ct(t);return e}function Ct(e={}){return e=vt(e)}function At(e={},t={}){const s={...e};for(const[i,o]of Object.entries(t))void 0!==o&&(s[i]=ct.includes(i)?Tt(e[i],o):o);return s}function Tt(e={},t={}){return{...e,...t}}function Rt(e){return void 0===e?void 0:"function"!=typeof e?()=>e:e}function Nt(e,t){return Rt(t)||e}const Lt=[{key:pt.API,normalize:function([e,t]=[]){if(!1===e)return{actor:!1};let s;if("object"==typeof e&&void 0===t&&(t=e,e=void 0),e&&-1!==e.indexOf("/")&&([s,e]=e.split("/")),e&&"string"!=typeof e||void 0!==t&&"object"!=typeof t)throw Error(`Invalid arguments for useApi(): ${e}, ${t}`);return a({group:s,name:e,payload:t})},merge:wt},{key:pt.LAYOUTS,normalize:function(e={}){if(!1===e)return!1;const{results:t,...s}=e;void 0!==t&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${it.PRODUCTS}: ... }) instead`),e={...s,[it.PRODUCTS]:t});const i={};for(const[t,s]of Object.entries(e))i[xt(t)]=Et(s);return i},merge:function(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>{for(const[s,i]of Object.entries(t))e[s]=kt(e[s],i);return e})}},{key:pt.DATA_PROCESSOR,normalize:function(e){e=n(e);for(const t of e)if("function"!=typeof t)throw Error("Expect data processor options to be a function: "+t);return e},merge:function(...e){return e.flat().filter(Boolean)}},{key:pt.TRACKERS,normalize:function(e={}){e=vt(e);const{active:t,...s}=e,i={};for(const[e,t]of Object.entries(s))i[e]=It(t);return{active:t,...i}},merge:function(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>{for(const[s,i]of Object.entries(t))void 0!==i&&(e[s]="active"===s?i:At(e[s],i));return e})}},{key:pt.INTERACTIONS,normalize:function(e){if(void 0===e)return;if(!1===e)return{handle:()=>{}};const t=n(e.preprocess);for(const e of t)if("function"!=typeof e)throw Error("Expect preprocess options to be a function: "+e);if(e.handle&&"function"!=typeof e.handle)throw Error("Expect handle options to be a function: "+e.handle);return{...e,preprocess:t}},merge:function(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>{return Object.assign(e,{...t,preprocess:(s=e.preprocess,i=t.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i})}},{key:pt.FILTERS,normalize:vt,merge:function(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>Object.assign(e,t))}},{key:pt.PAGINATION,normalize:function(e){if(void 0===e)throw Error("Expect pagination options to be an object or a boolean value: "+e);return"boolean"==typeof e&&(e={active:e}),e},merge:function(...e){return!1!==e[e.length-1]&&yt(e,(e,t)=>Object.assign(e,t))}},{key:pt.TEMPLATES,normalize:function(e={}){const t={};for(const[s,i]of Object.entries(e))t[s]=Rt(i);return t},merge:function(...e){return yt(e,(e,t)=>{for(const[s,i]of Object.entries(t))e[s]=Nt(e[s],i);return e})}}];class $t{constructor(){this._events=new W({target:this}),this._globals={}}_notify(e){this._events.emit(e),this._events.emit("_update",e)}}class Pt{constructor(e={},t={}){this._events=new W({target:this}),this._defaults=t,this._context=e||{},this._locals={},u(this,{resolved:new Ut(this),defaults:t}),e&&e.on&&(this._unsubscribes=[e.on("_update",e=>this._notify(e))])}_notify(e){this.resolved._invalidate(e),this._events.emit(e)}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}}class Ut{constructor(e){this._options=e,this._cache={}}_invalidate(e){this._cache[e]=void 0}_get({key:e,merge:t}){if(void 0===this._cache[e]){const s=this._options,i=s._context[e];this._cache[e]=t(s._defaults[e],i&&i.get(),s._locals[e])}return this._cache[e]}}class qt{constructor(e,t,s,i,o){this._options=e,this._store=t,this._key=s,this._normalize=e=>void 0!==e?i(e):void 0,this._merge=o}get(){return this._store[this._key]}set(e){this._set(this._normalize(e))}merge(e){this._set(this._merge(this.get(),this._normalize(e)))}_set(e){this._store[this._key]=e,this._options._notify(this._key)}}for(const e of Lt){const{key:t,normalize:s,merge:i}=e;Object.defineProperty($t.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new qt(this,this._globals,t,s,i))}}),Object.defineProperty(Pt.prototype,t,{get:function(){const e="_"+t;return this[e]||(this[e]=new qt(this,this._locals,t,s,i))}}),Object.defineProperty(Ut.prototype,t,{get:function(){return this._get(e)}})}const jt=[pt.API,pt.LAYOUTS,pt.DATA_PROCESSOR,pt.TRACKERS,pt.INTERACTIONS];function zt(e,t=jt){for(const s of t)Dt(e,s)}function Dt(e,t){if("api"===t)Object.assign(e,{useApi(...e){return this._options.api.merge(e),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=t).charAt(0).toUpperCase()+s.slice(1);Object.assign(e,{["use"+i](e){return this._options[t].merge(e),this},["clear"+i](){return this._options[t].set(),this}})}var s}function Mt(e={}){const{setValue:t,focus:s,param:i,sourceParam:o}=this._autoQuery=function({setValue:e=!0,focus:t=!0,updateUrl:s=!0,param:i="q",sourceParam:o="qs",...r}={}){return{setValue:e,focus:t,updateUrl:s,param:i,sourceParam:o,...r}}(e),r=new URLSearchParams(window.location.search),n=r.get(i),c=r.get(o)||void 0;setTimeout(()=>{for(const e of this._views.getAll(it.QUERY)){const{layout:i}=e;n&&t&&(i.value=n),!n&&s&&i.focus()}}),n&&this.query(a({q:n,qs:c}))}function Ft({value:e,request:t}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,o=e&&(e.question||e.keyword)||t&&t.payload&&(t.payload.question||t.payload.q),r=t&&t.payload&&t.payload.metadata&&t.payload.metadata.question_source;if(!o)return;const n=new URL(window.location),a=n.searchParams.get(s),c=n.searchParams.get(i)||_t.ORGANIC;o===a&&r===c||(n.searchParams.set(s,o),r===_t.ORGANIC?n.searchParams.delete(i):n.searchParams.set(i,r),window.history.replaceState({},"",n))}class Bt extends K{constructor(e,t,s){super(e,t),this._name=e,this._plugin=t,this._client=s,this._options=new $t}}function Qt(e){return e?"view:"+e:"view"}zt(Bt.prototype);class Gt{constructor(e={}){(this._events=new W)._injectSubscribeInterface(this),this._options=e,this._states={},u(this,{states:new Proxy(this._states,{set(){}})})}update(e,t,s={}){this._states[e]=Object.freeze(t);const i=Object.freeze({action:"update",name:e,state:t,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(e,t){const s=Object.freeze({action:"trigger",name:e,state:t});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(e,t),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class Ht{constructor(e){this._hub=e,this._sessionIndex=0}restart(){const e=Object.freeze({uuid:x(),index:this._sessionIndex++,meta:{}});this._hub.update("session",e)}}function Wt(e,t){if(!t)return!1;const{session:s}=e.states;return s&&s.index===t.index}class Vt{constructor(e,{source:t,options:s,polling:i=!0}){this._hub=e,this._source=t,this._options=s,this._polling=i,this._unsubscribes=[e.on("session",e=>this._handleSession(e)),e.on("request",e=>this._handleRequest(e))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(e){this._session&&e.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=e}async _handleRequest(e){if(!this.active)return;const{session:t,...s}=e;try{const{signal:i}=this._ac||{},o={...e.options,signal:i},r=await this._source({session:t,...s,options:o});if(r&&r[Symbol.asyncIterator]){if(r._response&&this._emitResponseWithSessionCheck({session:t,request:s,value:r._response}),this._polling){let e;for await(e of r){if(!Wt(this._hub,t))break;this._emitResponse({session:t,request:s,value:e})}}}else this._emitResponseWithSessionCheck({session:t,request:s,value:r})}catch(e){this._error(e),this._emitResponseWithSessionCheck({session:t,request:s,error:e})}}_emitResponseWithSessionCheck(e){Wt(this._hub,e.session)&&this._emitResponse(e)}_emitResponse(e){this._hub.update("response",e)}_error(e){console.error(e)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class Kt{constructor(e){this._get="function"==typeof e?e:()=>e,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(e,t){if("element"===e)return this._onElementUpdated(t);const s=this._get();return s&&s.addEventListener(e,t),this._handlers.push({event:e,handler:t}),()=>this._off(e,t)}_off(e,t){const s=this._get();s&&s.removeEventListener(e,t),function(e,t){if(!e)return;const s=e.findIndex(t);s>-1&&e.splice(s,1)}(this._handlers,e=>e.handler===t)}_onElementUpdated(e){return this._elementUpdatedHandlers.push(e),()=>{r(this._elementUpdatedHandlers,e)}}sync({silent:e=!1}={}){const t=this._get();if(this._element===t)return;if(this._offAllFromCurrentElement(),t)for(const{event:e,handler:s}of this._handlers)t.addEventListener(e,s);const s=this._element;if(this._element=t,!e)for(const e of this._elementUpdatedHandlers)try{e(t,s)}catch(e){console.error(e)}}_offAllFromCurrentElement(){if(this._element)for(const{event:e,handler:t}of this._handlers)this._element.removeEventListener(e,t)}destroy(){this._offAllFromCurrentElement()}}function Yt(e){return e&&e.meta&&e.meta.empty}class Zt{constructor(e,t){this._events=new W({target:this}),this._views=e,this._mapping=Xt((e._roles.mappings||{})[t]||t),u(this,{role:t,interface:new Jt(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(e){e!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=e,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",e),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Kt(()=>this.element)),this._proxyElement}get layout(){return this._layout}set layout(e){if(e===this._layout)return;if(e&&"function"!=typeof e.render)throw Error("Render function is mandatory in a layout.");const{element:t}=this;t&&this._safeApplyOnLayout("unrender",t),this._safeApplyOnLayout("destroy"),this._layout=e,e&&(e._view=this,"function"==typeof e.initialize&&e.initialize(this)),this.refresh({force:!0})}get tracker(){return this._views.trackers[this.role]}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:e=!1,data:t}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=t=this._sliceData(t||this._views._getData()),!e&&((o=t)===(r=i)||o&&r&&o.status===r.status&&o.error===r.error&&o.value===r.value&&o.ongoing===r.ongoing&&Yt(o)===Yt(r)&&function(e,t){return e===t||e&&t&&e.uuid===t.uuid}(o.session,r.session)))return;var o,r;const{session:n,status:a,ongoing:c,request:l,meta:u,value:h}=t,d={session:n,status:a,ongoing:c,request:l,meta:u,data:h,...es(this.role,t)},_=(e={},t)=>{!1!==e&&this.updateState({...d,...e},t)};try{await this._layout.render(s,t,{notifyUpdate:_})}catch(e){this._error(e),_({error:e})}}updateState(e,{silent:t=!1}={}){const s=e.error?dt.ERRONEOUS:e.status;e=this._state=Object.freeze(a({...e,status:s}));const{role:i}=this;this.hub.update(Qt(i),e,{silent:t})}_sliceData(e){const{value:t,error:s,status:i,meta:o,...r}=e,n={value:this._mapping(e,this),status:i,data:t,meta:o,...r};return this.role===it.CONTAINER&&(n.meta={...o,empty:this._isContainerEmpty(e)}),a(n)}_isContainerEmpty(e){const{element:t}=this;if(!t)return!1;for(const{role:s}of t.components){if(!rt(s))continue;if(!ts(s,Xt((this._views._roles.mappings||{})[s]||s)(e,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(e,...t){if(this._layout&&"function"==typeof this._layout[e])try{this._layout[e](...t)}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,t),this._views._events.emit(`${this.role}:${e}`,t)}_error(e){this._views._error(e)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class Jt{constructor(e){l(this,e,["role","layout","element","proxyElement","refresh","on","tracker"])}}function Xt(e){switch(typeof e){case"function":return e;case"string":return t=>t.value&&t.value[e];default:throw Error("Invalid mapping function: "+e)}}function es(e,t){return function(e){return e.status===dt.READY&&!e.ongoing}(t)?{empty:!!ts(e,t&&t.value)}:{}}function ts(e,t){switch(e){case it.ANSWER:case it.REASONING:return!t||!t.value;default:return void 0===t||(Array.isArray(t)||"string"==typeof t)&&!t.length}}function ss(e){if(!e)return;const{options:t=[]}=e;for(const e of t)if(e.default)return Object.freeze(e);return Object.freeze(t[0])}class is{constructor(e,{facets:t}={}){this._views=e,this._hub=e._hub;const s=this._error=this._error.bind(this);this._events=new W({target:this,error:s}),u(this,{facets:new os(this,t)}),this._unsubscribes=[e._options.on("filters",()=>this._syncOptions())],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:e}={}){return a({facets:Object.freeze({}),sort:ss(e)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(e){const t=this._getStates();this._states=function(e={},t={}){return Object.freeze(a({...e,...t,facets:Object.freeze(a({...e.facets,...t.facets}))}))}({...t,...e});const s=this._getStates();this._events.emit("update",{updates:e,states:s,oldStates:t})}reset({silent:e=!1}={}){const t=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:e}),this._events.emit("reset",{states:s,oldStates:t})}apply({silent:e=!1}={}){const t=this._getStates();this._hub.update("filters",t,{silent:e}),!e&&this._events.emit("apply")}_error(e){this._views._error(e)}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class os{constructor(e,t={}){this._filters=e,this._options=t}isSelected(e,t){return this._getFieldValues(e).includes(t)}select(e,t){this.isSelected(e,t)||this._select(e,t)}unselect(e,t){this.isSelected(e,t)&&this._unselect(e,t)}toggle(e,t){this.isSelected(e,t)?this._unselect(e,t):this._select(e,t)}_getFieldValues(e){return this._filters._getStates().facets[e]||[]}_select(e,t){const s=this._options.multivalued?[...this._getFieldValues(e),t]:[t];s.sort(),this._filters.update({facets:{[e]:s}})}_unselect(e,t){let s=this._getFieldValues(e).filter(e=>e!==t);0===s.length&&(s=void 0),this._filters.update({facets:{[e]:s}})}}class rs{constructor(e,{workflow:t,extensions:s,layouts:i,roles:o,options:r}){this._hub=e,this._workflow=t,this._workflowName=t._name,this._extensions=s,this._layoutFactory=i,this._options=r,this._roles=o,this._containers=new Map,this._components=new Map,this._filters=new is(this),this._events=new W,u(this,{interface:new ns(this)});const n=()=>this.syncSize();window.addEventListener("resize",n),this._unsubscribes=[()=>window.removeEventListener("resize",n),e.on("data",e=>this.refresh({data:e})),r.on("layouts",()=>this._syncLayouts())],this._syncLayouts()}get filters(){return this._filters}get trackers(){return this._workflow.trackers}on(e,t,s){return this._events.on(`${e}:${t}`,s)}addContainer(e){if(this._containers.has(e))return;const t=this._createView(e);this._containers.set(e,t);const{components:s}=e;for(const e of s)this.addComponent(e)}removeContainer(e){const t=this._containers.get(e);if(!t)return;const{components:s}=e;for(const e of s)this.removeComponent(e);t._destroy(),this._containers.delete(e)}addComponent(e){if(this._components.has(e))return;const t=this._createView(e);this._components.set(e,t)}removeComponent(e){const t=this._components.get(e);t&&(t._destroy(),this._components.delete(e))}updateComponentRole(e,t,s){}containsElement(e){return this._containers.has(e)||this._components.has(e)}refreshElement(e){const t=e.isContainer?this._containers.get(e):this._components.get(e);t&&t.refresh({force:!0})}_createView(e){const t=new Zt(this,e.role);return t.layout=this._createLayout(e.role),t.element=e,t}_syncLayouts(){const{layouts:e}=this._options.resolved;if(!1===e)for(const e of[...this._containers.values(),...this._components.values()])e.layout=void 0;else for(const e of[...this._containers.values(),...this._components.values()])e.layout=this._createLayout(e.role)}_createLayout(e){const t=this._options.resolved.layouts[e];if(!t)return;const[s,i]=t;return this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName})}get(e){return this.getAll(e)[0]}getAll(e){return e===it.CONTAINER?this._containers.values():this._components.values().filter(t=>t.role===e)}get views(){return this._getViews(!0)}_getViews(e=!0){return e?[...this._containers.values(),...this._components.values()]:[...this._components.values(),...this._containers.values()]}syncSize(){for(const e of this._components.values())e._syncSize()}async refresh({force:e,data:t}={}){t=this._getData(t);let s=this._getViews(!0);await Promise.all(s.map(s=>s.refresh({force:e,data:t})))}_getData(e){return e||this._hub.states.data}_error(e){console.error(e)}_destroy({}={}){for(const e of this._getViews(!1))e._destroy();for(const e of this._unsubscribes)e();this._unsubscribes=[],this._filters._destroy()}}class ns{constructor(e){this._actor=e,l(this,e,["syncSize","refresh","trackers","filters"])}get(e){return this._actor.get(e).interface}get all(){return this._actor.views.map(e=>e.interface)}}class as{constructor(e){this._hub=e,this._unsubscribes=[e.on("feedback",e=>this._trigger(e))]}_trigger(e){this._hub.trigger("tracker",{type:at.FEEDBACK,result_type:"answer",value:e.unselected?"unselected":e.value})}_destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}class cs{constructor(e,{client:t,options:s}){this._client=t,this._options=s,this._unsubscribes=[e.on("interaction",e=>this._handle(e))]}_handle(e){0!==(e=n(e)).length&&this._client.api.interactions.upload(e,{merge:!0})}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[]}}const{IMPRESSION:ls,VIEWABLE:us,CLICK:hs}=at,{UNTRACKED:ds,TRIGGERED:_s}=ht,ms=Object.freeze({[ls]:ds,[us]:ds,[hs]:ds});class ps{constructor(e){this.sessionId=e,this._states=new Map}getFullState(e){const t=this._states.get(this._getKey(e));return t?{...t}:ms}get(e,t){const s=this._states.get(this._getKey(e));return s&&s[t]||ds}set(e,t,s){mt(t),function(e){if(e!==ht.UNTRACKED&&e!==ht.TRACKING&&e!==ht.TRIGGERED)throw Error("Unrecognized tracking status: "+e)}(s);for(const i of n(e))this._setOne(i,t,s)}untriggered(e,t){return e.filter(e=>this.get(e,t)!==_s)}_getKey(e){return e.product_id||e.text||e.id||e}_setOne(e,t,s){(function(e,t,s){if(e.has(t))return e.get(t);const i=s(t);return e.set(t,i),i}(this._states,this._getKey(e),()=>({...ms})))[t]=s}}const fs=[Symbol("itemless")];class bs{constructor({hub:e,role:t,options:s}){this._hub=e,this._role=t,this._options=s,this._states=new ps(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(e){return this._states.getFullState(e)}_trigger(e,t,s){mt(e);const{options:i}=this;if(!i||!1===i.active)return;this._syncSession();const{deduplicated:o=!0,itemless:r=!1}=i;if(o){if(r&&(t=fs),0===(t=this._states.untriggered(n(t),e)).length)return;this._states.set(t,e,ht.TRIGGERED)}this._sendToHub({type:e,items:r?void 0:t,...s})}submit({value:e}){this._syncSession(),this._sendToHub({type:at.SUBMIT,value:e})}_sendToHub(e){this._hub.trigger("tracker",Object.freeze(a({role:this._role,...e})))}_syncSession(){const e=this._getSessionId();e&&(this._states&&e===this._states.sessionId||(this._states=new ps(e)))}_getSessionId(){const{session:e}=this._getViewState()||{};return e&&e.uuid}_getMisoId(){const e=this._getViewState();return e&&e.meta&&e.meta.miso_id||void 0}_getRequestPayload(){const{request:e}=this._getViewState()||{};return e&&e.payload}_getViewState(){return this._hub.states[Qt(this._role)]}}for(const e of lt)bs.prototype[e]=function(t,s){this._trigger(e,t,s)};class gs{constructor(e,{roles:t,options:s}){this._hub=e,this._roles=t,this._options=s,this._trackers={}}get(e){if(!this._roles.members.includes(e))throw Error(`Role "${e}" is not a member of this workflow.`);return this._trackers[e]||(this._trackers[e]=new bs({hub:this._hub,role:e,itemless:e===it.CONTAINER,options:()=>this._getTrackerOptions(e)})),this._trackers[e]}_getTrackerOptions(e){const t=this._options.resolved.trackers;return t&&t[e]||{active:!1}}}function ys(e){return async({group:t,name:o,payload:r,options:n})=>{if(t===s.ASK)switch(o){case i.QUESTIONS:return e.api.ask.questions(r,n);case i.SEARCH:return e.api.ask.search(r,n)}return e.api[t]._run(o,r,n)}}class vs{constructor({role:e,workflow:t,...s}={}){u(this,{role:e,workflow:t,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(e,t,s={}){this._syncElement(e);const i=this._rendered.get(e),o=S(!1);t=this._preprocess({state:t,rendered:i},{skip:o.t})||t,this._updatePending(t,s),o.value||this._handleInput({state:t,rendered:i},s)}_syncElement(e){this._element!==e&&this._rendered.delete(this._element),this._element=e}_preprocess({state:e}){return e}_updatePending(e,t){this._pending=[Object.freeze(e),t]}_takePending(){const e=this._pending;return this._pending=void 0,e}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,y(e=>this._doRaf(e)))}_doRaf(e){this._requested&&(this._requested=!1,this._applyRender(e))}_applyRender(e,t={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:e});const o=this._rendered.get(this._element),r=S([]),n=S({});this._render(this._element,{state:s,rendered:o,timestamp:e},{notifyUpdate:r.args,writeToState:n.merge,...t}),s=Object.freeze({...s,...n.value}),this._rendered.set(this._element,s),i&&i(...r.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const e of this._unsubscribes)e();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ws(...e){return e.reduce((e,t)=>(e[t]=function(e){return()=>{throw Error(`Template '${e}' is not implemented.`)}}(t),e),{})}function xs(e,t,s,i){const{templates:o}=e,[r,n]=zs(e,s);return""+r+(o.indexBlock||qs)(e,s,i)+(o.infoBlock||o.articleInfoBlock||Os)(e,s,i)+n}function Es(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Cs)(e,t,s)+(o.descriptionBlock||Ts)(e,t,s)+(o.priceBlock||$s)(e,t,s)+(o.ctaBlock||js)(e,t,s)}</div>`}function ks(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Cs)(e,t,s)+(o.descriptionBlock||Ts)(e,t,s)+(o.priceBlock||$s)(e,t,s)}</div>`}function Ss(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Cs)(e,t,s)+(o.dateBlock||Rs)(e,t,s)+(o.descriptionBlock||Ts)(e,t,s)+(o.ctaBlock||js)(e,t,s)}</div>`}function Os(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Cs)(e,t,s)+(o.authorsAndDateBlock||Ls)(e,t,s)}</div>`}function Is(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-info-container">${""+(o.titleBlock||Cs)(e,t,s)}</div>`}function Cs({className:e},{title:t,_title_with_markups:s}){const i=Bs(s)||w(t);return i?`<div class="${e}__item-title">${i}</div>`:""}function As({className:e},{brand:t,brand_logo:s}){if(!t&&!s)return"";return`<div class="${e}__item-brand-container">${s?`<img class="${e}__item-brand-logo" src="${s}"${t?` alt="${t}"`:""}>`:`<div class="${e}__item-brand">${t}</div>`}</div>`}function Ts({className:e},{snippet:t,description:s}){return t?`<div class="${e}__item-snippet">${Bs(t)}</div>`:s?`<div class="${e}__item-desc">${w(s)}</div>`:""}function Rs({className:e,templates:t},{created_at:s,updated_at:i,published_at:o}){const r=o||s||i;return r?`<div class="${e}__item-date">${Fs(r,t.date)}</div>`:""}function Ns({className:e},{authors:t}){return t&&Array.isArray(t)&&t.length?`<div class="${e}__item-authors">${t.join(", ")}</div>`:""}function Ls(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__item-authors-and-date-container">${""+(o.authorsBlock||Ns)(e,t,s)+(o.dateBlock||Rs)(e,t,s)}</div>`}function $s(e,t){const{className:s,templates:i}=e,{sale_price:o,original_price:r,currency:n="USD"}=t,a=o||r;if(!a)return"";const c=void 0!==r&&void 0!==o&&r>o,l=t.discount_rate_percent||(c?Math.floor(100*(1-o/r)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${n}">${r}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${n}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||Ps)(e,{...t,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function Ps(e,{discount_rate_percent:t}){return`(${t}% off)`}function Us(e,t,s={}){const{className:i,templates:o}=e,{cover_image:r,image_src:n,image_alt:a}=t;if(!r&&!n)return"";const c=n?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${n}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${r}">`}${"cover-image"===c&&s.brand?(o.brandBlock||As)(e,t,s):""}</div>`}function qs({className:e},t,{index:s}){return`<div class="${e}__item-index-container"><span class="${e}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function js(e,t,s){const{className:i,templates:o}=e,r=Qs.asFunction(o.cta)(e,t,s);return r?`<div class="${i}__item-cta-container">${r}</div>`:""}function zs({className:e,options:t={}},{product_id:s,url:i},{classSuffix:o="item-body",role:r="item",...n}={}){const a=!1!==n.link&&i?"a":"div";return[`<${a} class="${e}__${o}" ${r?`data-role="${r}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==n.link&&i?`href="${i}" ${function(e={}){const{target:t="_blank",rel:s="noopener",open:i=!0}=e;let o="";i&&(t&&(o+=` target="${t}"`),s&&(o+=` rel="${s}"`));return o}(t.link)}`:""}>`,`</${a}>`]}const Ds=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Ms="en-US";function Fs(e,t=Ds){switch(typeof t){case"function":return t(e);case"string":return new Date(e).toLocaleDateString(t);case"object":return new Date(e).toLocaleDateString(t.locale||Ds.locale,t);default:throw Error("Invalid date format: "+t)}}function Bs(e){return e&&e.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Qs=Object.freeze({tagPair:zs,formatDate:Fs,formatNumber:function(e,t=Ms){switch(typeof t){case"function":return t(e);case"string":return new Intl.NumberFormat(t).format(e);case"object":return new Intl.NumberFormat(t.locale||Ms.locale,t).format(e);default:throw Error("Invalid number format: "+t)}},formatHtmlWithMarkup:Bs,escapeHtml:w,asFunction:function(e=""){return"function"==typeof e?e:()=>e}});class Gs extends vs{constructor({className:e,templates:t,...s}={}){super(s),u(this,{className:e,templates:{...ws("root"),...t,helpers:Qs}})}_preprocess({state:e}){const t=this.templates.root(this,e);return{...e,html:t}}_render(e,{state:t}){e.innerHTML=t.html}}class Hs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Hs.MisoClient.ui.layouts.create("banner").render(this)}}class Ws{constructor(){this._entries=new WeakMap}isTracked(e){return this._entries.has(e)}async track(e,t={}){if(!t)return!1;if(this._entries.get(e))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(e,{ac:s});let o=!1;try{await v(e,{...t,signal:i}),o=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._entries.delete(e)}return o}untrack(e){const t=this._entries.get(e);t&&(t.ac.abort(),this._entries.delete(e))}}function Vs(e,t,s){void 0===s?e.removeAttribute(t):e.setAttribute(t,s)}function Ks(e,t,s){s?e.classList.add(t):e.classList.remove(t)}function Ys(e){if("number"==typeof e)return e;const[t,s]=function(e){const t=e.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!t)throw Error("Invalid length: "+e);const s=parseFloat(t[1]),i=t[2]||"";return[s,i]}(e);switch(s){case"":case"px":return t;case"rem":return function(e=1){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}(t);default:throw Error("Unsupported unit: "+s)}}function Zs(e){return void 0===e||e instanceof Js?e:new Js(e)}class Js{constructor(e){switch(this._width=NaN,this._height=NaN,typeof e){case"number":this._width=e,this._height=1;break;case"object":Array.isArray(e)&&(this._width=parseFloat(e[0]),this._height=parseFloat(e[1]));break;case"string":const t=e.indexOf("/");0>t?(this._width=parseFloat(e),this._height=1):(this._width=parseFloat(e.slice(0,t).trim()),this._height=parseFloat(e.slice(t+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+e)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(e){return e=Zs(e),Zs([e._width*this._width,e._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class Xs extends vs{static get type(){return"container"}constructor({logo:e="auto",...t}={}){super({logo:e,...t}),this._impression=!1,this._viewables=new Ws}_syncElement(e){this._element!==e&&this._viewables.untrack(this._element),super._syncElement(e)}_render(e,t){this._syncBanner(e),this._syncStatus(e,t),this._trackInteractions(e,t)}_afterRender(e,t){this._trackInteractions(e,t)}_syncBanner(e){const t=Hs.tagName,s=this._shallRenderBanner(e),i=e.querySelector(t);s&&!i?e.insertAdjacentHTML("beforeend",`<${t} visible-when="ready"></${t}>`):!s&&i&&i.remove()}_shallRenderBanner(e){const{logo:t}=this.options,{logo:s}=e,i=void 0!==s&&"auto"!==s?s:t;return"auto"===i?e.components.some(({role:e})=>function(e){return e===it.PRODUCTS||e===it.ANSWER}(e)):!!i}_syncStatus(e,{state:t}){if(!e)return;const{status:s,data:i,ongoing:o,meta:{miso_id:r,empty:n=!1,unanswerable:a=!1}={}}=t,{blocked_reason:c,finish_reason:l}=i||{},u=[s,n?dt.EMPTY:dt.NONEMPTY];s===dt.READY&&u.push(o?dt.ONGOING:dt.DONE),a&&u.push(dt.UNANSWERABLE),e.setAttribute("status",u.join(" ")),Vs(e,"miso-id",r),Vs(e,"blocked-reason",c),Vs(e,"finish-reason",l)}_trackInteractions(e,t){const{status:s}=t;s===dt.READY&&(this._trackImpression(),this._trackViewable(e))}_trackImpression(){const{impression:e}=this._view.tracker.options||{};e&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(e){const{viewable:t}=this._view.tracker.options||{};t&&await this._viewables.track(e,t)&&this._view.tracker.viewable()}}const ei=Object.freeze({root:function(e,t){const{className:s,templates:i}=e,{status:o,value:r}=t;return"erroneous"!==o?"":`<div class="${s}"><div class="${s}__message">${i.message(e,r)}</div></div>`},message:function(e,t){return"Error: "+(t.message||t)}});class ti extends Gs{static get type(){return"error"}static get defaultTemplates(){return ei}constructor({className:e="miso-error",templates:t,...s}={}){super({className:e,templates:{...ei,...t},...s})}}const si=Object.freeze({root:function(e){const{className:t,templates:s}=e;return`<div class="${t}"><div class="${t}__logo">${s.logo(e)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function ii(e,t){const s=[];for(const i of t.entries){const t=e.e2b.get(i.element);t&&t.key===i.key||s.push(i)}return s}class oi{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(e){return this._e2b.get(e)||void 0}find(e){return this._k2b.get(e)||void 0}update(e,t,s){const i=function(e,t,s){const i=new Map,o=new Map,r=[];for(let n=0;e.length>n;n++){const a=e[n],c=s[n],l=Object.freeze({index:n,key:a,value:t[n],element:c});i.set(a,l),o.set(c,l),r.push(l)}return{k2b:i,e2b:o,entries:r}}(e,t,s),o={k2b:this._k2b,e2b:this._e2b,entries:this._entries},r=ii(o,i),n=ii(i,o);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:r,unbounds:n}}clear(){const e=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:e}}}const ri=Symbol.for("miso:tracked");function ni(e){return!!e[ri]}function ai(e){e[ri]=!0}function ci(e){q(e,li.prototype)}Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});class li{_initTrackable(){this._bindings=new oi,this._viewables=new Ws}_syncBindings(e,t){const s=this._getItems(t)||[],i=s.map(e=>this._getItemKey(e)),o=this._getItemElements(e),{bounds:r,unbounds:n}=this._bindings.update(i,s,o);this._onBindingsUpdate(r,n)}_clearBindings(){const{bounds:e,unbounds:t}=this._bindings.clear();this._onBindingsUpdate(e,t)}_getItemKey(e){return e.product_id||e.text||e.id||e}_getItems(e){throw Error("Not implemented.")}_getItemElements(e){throw Error("Not implemented.")}_onBindingsUpdate(e,t){this._trackImpressions(e),this._untrackViewables(t),this._trackViewables(e)}_trackImpressions(e){if(0===e.length)return;const{impression:t}=this._view.tracker.options||{};t&&this._view.tracker.impression(e.map(({value:e})=>e))}_untrackViewables(e){for(const{element:t}of e)this._viewables.untrack(t)}_trackViewables(e){if(0===e.length)return;const{viewable:t}=this._view.tracker.options||{};if(t)for(const{value:s,element:i}of e)(async()=>{await this._viewables.track(i,t)&&this._view.tracker.viewable([s])})()}_trackClick(e,t){const{click:s}=this._view.tracker.options||{};(function(e={},t){return!!e&&("function"==typeof e.validate?e.validate(t):!!e.lenient||!ni(t)&&0===t.button&&!t.defaultPrevented&&!!b(t.target,e=>"A"===e.tagName&&e.href||void 0))})(s,e)&&(ai(e),this._view.tracker.click([t.value]))}_destroyTrackable(){const{unbounds:e}=this._bindings.clear();this._untrackViewables(e)}}class ui{_initTriggerable(){this._trigger=void 0}_syncTrigger(e,t){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(t.status===dt.READY?this._trackTrigger(e):this._untrackTrigger())}async _trackTrigger(e){if(this._trigger)return;const t=e.querySelector('[data-role="trigger"]');if(!t)return;const s=new AbortController;this._trigger=Object.freeze({element:t,ac:s});let i=!1;try{await v(t,{area:1,duration:0,signal:s.signal}),i=!0}catch(e){if("AbortError"!==e.name)throw e}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const hi=Object.freeze({product:function(e,t,s,i){const{templates:o}=e,[r,n]=zs(e,s);return""+r+(o.imageBlock||Us)(e,s,i)+(o.infoBlock||o.productInfoBlock||ks)(e,s,i)+n},article:function(e,t,s,i){const{templates:o}=e,[r,n]=zs(e,s);return""+r+(o.imageBlock||Us)(e,s,i)+(o.infoBlock||o.articleInfoBlock||Ss)(e,s,i)+(o.indexBlock||qs)(e,s,i)+n},compactArticle:xs,image:function(e,t,s,i){const{templates:o}=e,[r,n]=zs(e,s);return""+r+(o.imageBlock||Us)(e,s,i)+(o.infoBlock||o.imageInfoBlock||Is)(e,s,i)+n},question:function(e,t,s){const[i,o]=zs(e,s);return`${i}${s.value||s.text||s}${o}`},root:function(e,t){const{className:s,role:i,templates:o,options:r}=e,{status:n}=t;return`<div class="${s} ${n}"${i?` data-role="${i}"`:""}${r.itemType?` data-item-type="${r.itemType}"`:""}>${n===dt.READY?o[n](e,t):""}${o.trigger(e,t)}${o.loading(e,t)}</div>`},[dt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t)||[];return i.length>0||t.ongoing?s.body(e,t,i):s.empty(e,t)},empty:()=>"",body:function(e,t,s){return e.templates.list(e,t,s)},list:function(e,t,s){const{className:i,templates:o,options:r}=e,n=o.ordered?"ol":"ul";return`<${n} class="${i}__list" data-role="list"${r.itemType?` data-item-type="${r.itemType}"`:""}>${o.items(e,t,s)}</${n}>`},ordered:!1,items:function(e,t,s,{offset:i=0}={}){const{templates:o}=e;let r=i;return s.map(s=>o.item(e,t,s,r++)).join("")},item:function(e,t,s,i){const{className:o,templates:r,options:n}=e,{itemType:a}=n;return`<li class="${o}__item">${r[a](e,t,s,{index:i})}</li>`},productInfoBlock:ks,articleInfoBlock:Ss,compactArticleInfoBlock:Os,imageInfoBlock:Is,brandBlock:As,titleBlock:Cs,descriptionBlock:Ts,dateBlock:Rs,authorsBlock:Ns,authorsAndDateBlock:Ls,priceBlock:$s,discountRateText:Ps,ctaBlock:js,cta:function(e,t,s){const{templates:i}=e,{url:o}=t;if(!o)return"";const[r,n]=zs(e,{url:o},{classSuffix:"item-cta",role:"cta"}),a=Qs.asFunction(i.ctaText)(e,t,s);return a?`${r}${a}${n}`:""},imageBlock:Us,indexBlock:qs,trigger:function(e,t){const{className:s}=e;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class di extends Gs{static get defaultTemplates(){return hi}constructor({templates:e,itemType:t="product",...s}){super({templates:{...hi,...e},itemType:t,...s}),this._initTrackable(),this._initTriggerable()}initialize(e){this._unsubscribes.push(e.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=this._html(e,t,s);return{...e,incremental:s,html:i}}_shallRenderIncrementally(e,t){return this.options.incremental&&t&&t.value&&t.value.length>0&&e.value&&e.value.length>=t.value.length&&e.session&&t.session&&e.session.id===t.session.id}_html(e,t,s){if(s){const s=t.value.length,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}return this.templates.root(this,e)}_render(e,{state:t},{notifyUpdate:s}){const{incremental:i,html:o}=t;if(i)if(o){this._getListElement(e).insertAdjacentHTML("beforeend",o)}else s(!1);else e.innerHTML=o}_afterRender(e,t){this._syncBindings(e,t),this._syncTrigger(e,t)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(e){return e.value&&(e.value.products||e.value)}_getListElement(e){return e.querySelector('[data-role="list"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="item"]')):[]}_onClick(e){const t=e.target.closest('[data-role="item"]');if(!t)return;const s=this._bindings.get(t);s&&(this._trackClick(e,s),this._emitClickEvent(e,s))}_emitClickEvent(e,t){const{session:s}=this._view._state,{value:i,element:o}=t;this._view._emit("click",{session:s,value:i,element:o,domEvent:e})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}ci(di.prototype),q(di.prototype,ui.prototype);const _i="miso-list";class mi extends di{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return _i}constructor({className:e=_i,...t}={}){super({className:e,...t})}}const pi="miso-horizontal";class fi extends di{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return pi}constructor({className:e=pi,...t}={}){super({className:e,...t})}}const bi="miso-cards";class gi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(e){const t=this._swipeableContext;void 0!==t.itemCount&&(0>e?e=t.itemCount-1:t.itemCount>e||(e=0),t.itemIndex=e,y(()=>this._syncDisplayedSwipeableItemIndex()))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(e,t,s){this._syncSwipeableItemCount(t),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:e}={}){const t=this._swipeableContext,s=this._getItems(e),i=t.itemCount,o=t.itemCount=s?s.length:void 0;o!==i&&(void 0===o?t.itemIndex=void 0:void 0===i&&(t.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const e=this._swipeableContext,{itemCount:t}=e;if(t===e.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(Vs(s,"data-item-count",t),e.displayedCount=t)}_syncDisplayedSwipeableItemIndex(){const e=this._swipeableContext,{itemIndex:t}=e;t!==e.displayedIndex&&(e.displayedIndex=t,this._syncSwipeableListIndex(t),this._syncSwipeableIndicatorIndex(t))}_syncSwipeableListIndex(e){const{element:t}=this._view,s=t&&this._getListElement(t);s&&(s.style.left=100*-e+"%")}_syncSwipeableIndicatorIndex(e){const{element:t}=this._view,s=t&&this._getSwipeableIndicatorElement(t);if(!s)return;let i=0;for(const t of s.children)Ks(t,"active",i===e),i++}_getSwipeableIndicatorElement(e){return e.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const e=this._swipeableContext,t=e.displayedIndex;e.displayEventIndex!==t&&(e.displayEventIndex=t,this._view._emit("display",{index:t}))}_onClickSwipeable(e){const{target:t}=e;t.closest('[data-role="previous"]')&&(e.preventDefault(),this.previous()),t.closest('[data-role="next"]')&&(e.preventDefault(),this.next())}}const yi="miso-ui-icon",vi=yi+"-svg-1_13_0-beta_1",wi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},xi=`<symbol id="${yi}-${wi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Ei=`<symbol id="${yi}-${wi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,ki=`<symbol id="${yi}-${wi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(e){const t=100,s=2.414213562373095*e,i=.7071067811865475*s;return`M${e} 0L${t-s} 0A${e} ${e} 0 0 1 ${t-i} ${i}L${i} ${t-i}A${e} ${e} 0 0 1 0 ${t-s}L0 ${e}Z`}(5)}"/></symbol>`,Si=`<svg id="${vi}" style="display:none;">${[xi,Ei,ki,`<symbol id="${yi}-${wi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${yi}-${wi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${yi}-${wi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${yi}-${wi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let Oi=!1;function Ii(e){return`<svg class="miso-ui-icon miso-ui-icon-${e}"><use href="#${yi}-${e}"></use></svg>`}Oi||document.head.querySelector("#"+vi)||(Oi=!0,document.head.insertAdjacentHTML("beforeend",Si));const Ci=new Set(Object.values(wi));Ii(wi.SEND),Ii(wi.SEARCH);const Ai=Ii(wi.TRIANGLE);Ii(wi.TRIANGLE_EQ);const Ti=Ii(wi.CHEVRON),Ri=Ii(wi.CHEVRON_NEGATIVE),Ni=Ii(wi.BULB),Li="miso-carousel",$i=Object.freeze({body:function(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${o.list(e,t,s)}</div></div>${o.controls(e,t,s)}`},controls:function(e,t,s){const{templates:i}=e;return`${i.controlContainer(e,t,"previous")}${i.controlContainer(e,t,"next")}${i.indexIndicator(e,t,s)}`},controlContainer:function(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__control-container-${s}">${o.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(e,t,s)}</div>`},controlIcon:function(e){return"image"===e.options.itemType?Ri:Ti},indexIndicator:function(e,t,s){const{className:i,templates:o}=e;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map(s=>`<li class="${i}__index-indicator-item">${o.indexIndicatorItem(e,t,s)}</li>`).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),Pi=Object.freeze({...di.defaultTemplates,...$i});class Ui extends di{static get type(){return"carousel"}static get defaultTemplates(){return Pi}static get defaultClassName(){return Li}constructor({className:e=Li,templates:t,...s}={}){super({className:e,templates:{...$i,...t},...s}),this._initSwipeable()}_render(e,t,s){super._render(e,t,s),this._renderSwipeable(e,t,s)}_afterRender(e,t){super._afterRender(e,t),this._afterRenderSwipeable(e,t)}_onClick(e){this._onClickSwipeable(e),super._onClick(e)}}!function(e){q(e,gi.prototype)}(Ui.prototype);const qi="16rem",ji=Object.freeze({...di.defaultTemplates,item:function(e,t,s,i){const{className:o,templates:r,options:n}=e,{itemType:a}=n,c=r[a](e,t,s,{index:i});return`<li class="${o}__item${s._size?` ${o}__item-${s._size}`:""}">${c}</li>`}}),zi="miso-gallery";class Di extends di{static get type(){return"gallery"}static get defaultTemplates(){return ji}static get defaultClassName(){return zi}constructor({className:e=zi,templates:t,...s}={}){super({className:e,templates:{...ji,...t},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:e}=this._view,t=e&&this._getListElement(e);t&&(this._syncListAspectRatio(t),this._syncItemSizes(t))}_preprocess({state:e,rendered:t}){const s=this._shallRenderIncrementally(e,t),i=s?void 0:this._bodyHtml(e),o=this._itemsHtml(e,t);return{...e,...a({incremental:s,bodyHtml:i,itemsHtml:o})}}_bodyHtml(e){return this.templates.root(this,{...e,value:[]})}_itemsHtml(e,t){const s=t&&t.value&&t.value.length||0,i=(this._getItems(e)||[]).slice(s);return i.length>0?this.templates.items(this,e,i,{offset:s}):""}_render(e,t,s){this._syncItemCount(t),this._syncCssVariables();const i=this._renderListElement(e,t,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,t,s))}_renderListElement(e,{state:t}){const{incremental:s,bodyHtml:i}=t;return s||(e.innerHTML=i),this._getListElement(e)}_renderItems(e,t){t.state.incremental?this._appendItems(e,t):this._updateItems(e,t)}_updateItems(e,{state:t}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(t)||[],s);e.innerHTML=this.templates.items(this,t,i)}_appendItems(e,{state:t}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(e);const i=e.children.length,o=this._writeItemSizes((this._getItems(t)||[]).slice(i),s,i);e.insertAdjacentHTML("beforeend",this.templates.items(this,t,o,{offset:i}))}_writeItemSizes(e,[t=0,s=0]=[],i=0){let o=0;i>0&&(o=Math.min(i,t),i-=o,t-=o),i>0&&(o=Math.min(i,s),i-=o,s-=o);const r=[];for(const i of e){let e="small";t>0?(e="large",t--):s>0&&(e="medium",s--),r.push({...i,_size:e})}return r}_syncCssVariables(){const e=this._galleryContext;let{itemAspectRatio:t=1}=this.options;t=e.itemAspectRatio=Zs(t);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+t),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+t.scaleBy([1,2])))}_syncListAspectRatio(e){const t=this._galleryContext,{itemCount:s,itemAspectRatio:i}=t,{height:o=qi}=this.options,r=Ys(o),n=e.clientWidth;if(0===n)return t.columnCount=void 0,void(t.itemSizes=void 0);const a=t.columnCount=Math.round(n*i.width*2/(r*i.height));t.itemSizes=function(e,t){let s=Math.max(2*t-e,0),i=e;const o=Math.min(Math.floor(s/3),i);i-=o,s-=3*o;const r=Math.min(s,i);return i-=r,s-=r,[o,r,i]}(s,a),e.style.aspectRatio=a+" / 2",e.style.height=s>0?"auto":"0"}_syncItemCount({state:e}={}){const t=this._getItems(e);this._galleryContext.itemCount=t?t.length:void 0}_syncItemSizes(e){const{itemSizes:t=[]}=this._galleryContext;let[s=0,i=0]=t;const{className:o}=this;for(const t of e.children){let e=!1,r=!1;s>0?(e=!0,s--):i>0&&(r=!0,i--),Ks(t,o+"__item-large",e),Ks(t,o+"__item-medium",r),Ks(t,o+"__item-small",!e&&!r)}}}const Mi="miso-search-box";const Fi=Object.freeze({root:function(e){const{className:t,templates:s,role:i,options:o,autocomplete:r}=e,{placeholder:n}=o;return`\n<div class="${t}" ${i?`data-role="${i}"`:""}>\n  <div class="${t}__input-group">\n    <input class="${t}__input" type="text" data-role="input" ${n?`placeholder="${n}"`:""}>\n    <button class="${t}__button" type="submit" data-role="submit">${s.buttonContent(e)}</button>\n  </div>\n  <div class="${r.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(e){const{templates:t,options:s}=e;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:o}=t;var r;return("function"==typeof i?i(e):""+i)+("function"==typeof o?o(e):(Ci.has(r=o)?Ii(r):"")||""+o)},buttonText:"",buttonIcon:"search",completions:function(e,t){const{templates:s,workflow:i,autocomplete:o}=e;e={templates:s,workflow:i,...o};const r=[],n=[];for(const e of t)(e.product?r:n).push(e);return s.queries(e,n)+(n.length>0&&r.length>0?"<hr>":"")+s.products(e,r)},completionList:function(e,t,s){const{className:i,templates:o}=e;return`<ul class="${i}__${t}-list" data-role="${t}-list">${s.map(s=>o.completionItem(e,t,s)).join("")}</ul>`},completionItem:function(e,t,s){const{className:i,templates:o}=e;return`\n<li class="${i}__${t}-item" data-role="${t}-item" data-index="${s._index}" tabindex="0">\n  ${o[t](e,s)}\n</li>`.trim()},queries:function(e,t){const{templates:s}=e;return s.completionList(e,"query",t)},products:function(e,t){const{templates:s}=e;return s.completionList(e,"product",t)},query:function(e,{text:t,text_with_inverted_markups:s}={}){return s||w(t)},product:function(e,{product:t}){const{templates:s}=e,[i,o]=s.helpers.tagPair(e,t,{role:!1});return""+i+s.imageBlock(e,t)+s.productInfoBlock(e,t)+o},imageBlock:Us,productInfoBlock:ks}),Bi=Object.freeze({className:"miso-autocomplete",debounce:300});class Qi extends Gs{static get type(){return"search-box"}static get defaultTemplates(){return Fi}static get defaultClassName(){return Mi}constructor({className:e=Mi,templates:t,autocomplete:s,...i}={}){super({className:e,templates:{...Fi,...t},...i}),u(this,{autocomplete:{...Bi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=$(this.autocomplete.debounce)}initialize(e){const{proxyElement:t,hub:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("input",e=>this._syncInput(e)),t.on("keydown",e=>this._handleKeyDown(e)),t.on("click",e=>this._handleClick(e)),t.on("focusin",e=>this._handleFocusIn(e)),t.on("focusout",e=>this._handleFocusOut(e)),s.on("completions",()=>e.refresh({force:!0}))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(e){this._element?this._context().value=e:this._valueRequested=e}_preprocess({state:e}){return e=super._preprocess({state:e}),{...e,completions:this._view.hub.states.completions}}_render(e,t,s){0===e.childElementCount&&super._render(e,t,s),this._updateCompletions(e,t,s)}_afterRender(e,t){this._fullfillFocusRequest(e),this._fullfillValueRequest(e)}_updateCompletions(e,{state:t,rendered:s},{writeToState:i}){if(!t.completions)return;const{status:o=dt.INITIAL,session:r,value:n}=t.completions,{index:a}=r;if(s&&s.completions.index===a&&s.completions.status===o)return;const c=this._context(e),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(n);Ks(e,"nonempty",u.length>0),l.setAttribute("data-status",o),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:o}})}_fullfillFocusRequest(e){e&&this._focusRequested&&(this._focusRequested=!1,this._context(e).focus())}_fullfillValueRequest(e){e&&this._valueRequested&&(this._context(e).value=this._valueRequested,this._valueRequested=void 0)}_context(e){if(!(e=e||this._view.element))return Gi.empty();let t=this._contexts.get(e);return t||this._contexts.set(e,t=new Gi(e)),t}_syncInput(){const{inputElement:e}=this._context();if(!e)return;const t=e.value.trim();if(this._prevInput===t)return;this._prevInput=t;const s=this;this._debounce(()=>s._view.hub.update("input",{value:t}))}_handleFocusIn({target:e}){this._element&&e.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:e}){this._element&&(e&&b(e,e=>e===this._element||void 0)||this.close())}_handleKeyDown({key:e,target:t,isComposing:s}){!s&&"Enter"===e&&t.matches('[data-role="input"]')&&(this._submit(t.value),t.blur())}_handleClick(e){const{target:t}=e,{inputElement:s}=this._context();for(let i=t;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const t=i.getAttribute("data-index"),o=this._context().data.get(parseInt(t)),r=o&&o.text;return r&&(s&&(s.value=r),this._view._emit("select",Object.freeze({value:o,index:t,domEvent:e})),e.defaultPrevented||this._submit(r)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._emit("select",Object.freeze({value:item,index:index,domEvent:e}))}}async _submit(e){e&&e.trim()&&(this.close(),this._view.hub.update("query",{q:e}),this._trackSubmit(e))}_trackSubmit(e){const{[at.SUBMIT]:t}=this._view.tracker.options||{};t&&this._view.tracker.submit({value:e})}}class Gi{static empty(){return Gi._empty||(Gi._empty=new Gi)}constructor(e){this._element=e,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(e){let t=0;const s=this._data=new Map,i=[];for(const o in e)for(const r of e[o])r.product&&!r.product.url||(r._index=t,r._field=o,s.set(t,r),i.push(r),t++);return i}focus(){if(!this._element)return;const{inputElement:e}=this;e&&e.focus()}set value(e){if(!this._element)return;const{inputElement:t}=this;t&&(t.value=e)}_get(e){return this._element?this._cache[e]||(this._cache[e]=this._element.querySelector(`[data-role="${e}"]`)):void 0}}const Hi="miso-option-list";const Wi=Object.freeze({root:function(e,t){const{className:s,role:i,templates:o}=e;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${o.options(e,t)}\n</div>\n`},options:function(e,t){const{className:s,templates:i}=e;return`\n<ol class="${s}__options" data-role="options">\n  ${(t.value||[]).map((t,s)=>i.option(e,t,{index:s})).join("")}\n</ol>\n`},option:function(e,t){const{className:s}=e;return`<li class="${s}__option" data-role="option" tabindex="0">${w(t.text||t)}</li>`}});class Vi extends Gs{static get type(){return"option-list"}static get defaultTemplates(){return Wi}static get defaultClassName(){return Hi}constructor({className:e=Hi,templates:t,...s}={}){super({className:e,templates:{...Wi,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",e=>this._handleClick(e))]}_render(e,t,s){super._render(e,t,s);const{state:i}=t;this._syncOptionValues(e,i)}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_syncOptionValues(e,t){const s=e&&this._getOptionsElement(e);if(!s)return;Ks(s,"empty",0===(this._getItems(t)||[]).length)}_getItems(e){return e.value}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;i&&(this._trackClick(e,s),this._select(i.text))}async _select(e){e&&this._view._emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}ci(Vi.prototype);const Ki=Object.freeze({...ws("options"),root:function(e){const{className:t,role:s,templates:i}=e;return`\n<div class="${t}" ${s?`data-role="${s}"`:""}>\n  ${i.options(e)}\n</div>\n`},option:function(e,t){const{className:s,templates:i}=e;return`\n<div role="button" class="${s}__option" data-value="${t.value}">\n  ${i.content(e,t)}\n</div>\n`}});class Yi extends Gs{static get defaultTemplates(){return Ki}constructor({className:e,templates:t,field:s,defaultValue:i,...o}={}){super({className:e,templates:{...Ki,...t},...o}),this._field=s,this._defaultValue=i}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,e.hub.on(this._field,()=>this._refresh()),t.on("click",e=>this._handleClick(e))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(e,t){return e.rendered&&t.skip(),super._preprocess(e,t)}_handleClick({target:e}){const t=b(e,e=>e.hasAttribute("data-value")?e:void 0);if(!t)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const o=t.getAttribute("data-value");s||void 0===i||i!==o?this._select(o):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],y(()=>this._syncValueAttribute())}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:e}=this._view,t=e&&e.children[0];if(!t)return;let{unselected:s,value:i}=this._state;s?t.removeAttribute("data-selected"):t.setAttribute("data-selected",i),this._state=void 0}_select(e,t){this._submit({value:e},t)}_clear(e){this._submit({unselected:!0},e)}async _submit(e,t){this._view.hub.update(this._field,e,t)}}const Zi="miso-feedback",Ji=["helpful","unhelpful"];const Xi=Object.freeze({options:function(e){const{templates:t}=e;return Ji.map(s=>t.option(e,{value:s})).join("")},content:function(e,{value:t}){const{className:s,templates:i,options:o={}}=e;return`\n${!1!==o.icon?`<i class="${s}__icon">${i.icon(e,t)}</i>`:""}\n${!1!==o.text?`<span class="${s}__text">${i.text(e,t)}</span>`:""}\n`},icon:function(e,t){switch(t){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(e,t){switch(t){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class eo extends Yi{static get type(){return"feedback"}static get defaultTemplates(){return Xi}static get defaultClassName(){return Zi}constructor({className:e=Zi,templates:t,...s}={}){if(super({className:e,templates:{...Xi,...t},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const to="miso-text";const so=Object.freeze({root:function(e,{value:t}){const{className:s,role:i,options:{raw:o=!1,tag:r}}=e,n=i?`data-role="${i}"`:"",a=void 0!==t?w(function(e){let{format:t}=e.options;const{formatDate:s,formatNumber:i}=e.templates.helpers;if(!t)return e=>""+e;switch(typeof t){case"function":return t;case"string":t=[t]}let[o,r]=t;switch(o){case"date":return e=>s(e,r);case"number":return e=>i(e,r);default:return e=>""+e}}(e)(t)):"";return o?a:`<${r} class="${s}" ${n}>${a}</${r}>`}});class io extends Gs{static get type(){return"text"}static get defaultTemplates(){return so}static get defaultClassName(){return to}constructor({className:e=to,templates:t,tag:s="p",...i}={}){super({className:e,templates:{...so,...t},tag:s,...i})}}class oo extends vs{constructor(e){super(e)}_takePending(){return this._pending}_applyRender(e,t={}){const s=S(!1);super._applyRender(e,{...t,loop:s.t}),s.value&&this._requestRaf()}}class ro{clear(e){return e.innerText="",{cursor:0,done:!1}}update(e,{value:t,cursor:s},{value:i,cursor:o,done:r}){const n=i.length;o=Math.min(o,n);const a=!!r&&o===n,c=t.substring(0,s),l=!i.startsWith(c);return a||l?e.innerText=i:e.insertAdjacentText("beforeend",i.substring(s,o)),a&&e.classList.add("done"),{cursor:o,done:a}}}function no(e,t,{status:s}){if(!t)return;0===t.children.length&&(t.innerHTML=function(e){let{className:t,role:s,options:{tag:i,format:o,builtInStyles:r=!0}}=e;"auto"===i&&(i="markdown"===o?"div":"p");const n=s?`data-role="${s}"`:"",a=[t,ao(t)];r&&"markdown"===o&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${n} data-format="${o}"></${i}>`}(e));const i=t.children[0];return i.setAttribute("data-status",s||dt.INITIAL),i}function ao(e){return e+"__cursor"}function co(e){if(!0===e)return function(e=performance.now()){return function({summary:t,timestamp:s,elapsed:i,ref:o,operation:r,conflict:n}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-e,Math.floor(a)/1e3+"s"}](${lo(i[0])}, ${lo(i[1])})`,t,""+r,o,n)}}();if(e){if("function"==typeof e)return e;throw Error("onDebug must be a function or a boolean")}}function lo(e){return Math.floor(100*e)/100+"ms"}const uo="miso-typewriter";class ho extends oo{static get type(){return"typewriter"}static get defaultClassName(){return uo}constructor({className:e=uo,tag:t="auto",format:s="markdown",tooltip:i=!1,speed:o,acceleration:r,nextCursorFn:n,...a}={}){super({tag:t,format:s,tooltip:i,...a}),u(this,{className:e}),this._prevState=void 0,this._getNextCursor="function"==typeof n?n:M({speed:o,acceleration:r}),this._readiness=new I,"markdown"===s&&ho.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(e){this._readiness.reject(e)}}async _setupForMarkdown(){const e=await this._view._views._extensions.require("markdown");if(!this._view)return;const t=ao(this.className),{onDebug:s,onCitationLink:i,variant:o}=this.options;this._renderer=e.createRenderer({cursorClass:t,getSource:e=>this._getSource(e),onCitationLink:i,onDebug:co(s),variant:o}),this._unsubscribes.push(this._view.proxyElement.on("click",e=>this._onClick(e)))}_getSource(e){const{data:t={}}=this._view._data,{sources:s=[]}=t;return s[e]}async _setupForPlaintext(){this._renderer=new ro}async _ready(){return this._readiness.promise}async render(...e){await this._ready(),await super.render(...e)}_preprocess({state:e}){const t=this._prevState,{value:{value:s="",stage:i,finished:o}={},session:r,status:n}=e,c=(u=e,(l=t)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const h=t?c&&i===t.stage?t.streak:t.streak+1:0,d=c&&t&&t.doneAt||(n===dt.READY&&o?performance.now():void 0);return this._prevState=Object.freeze(a({session:r,status:n,value:s,stage:i,streak:h,doneAt:d,done:void 0!==d}))}_render(e,{state:t,rendered:s},{notifyUpdate:i,writeToState:o,loop:r}){const n=no(this,e,t);let a;const c=!s||t.streak!==s.streak;if(c)a=this._renderer.clear(n,s);else{const e=this._getNextCursor(s.cursor,t.doneAt,s.timestamp,t.timestamp);a=this._renderer.update(n,s,{...t,cursor:e})}o(a);const l=t.status===dt.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===dt.READY)&&!c}),l&&r()}_onClick(e){const{target:t}=e,s=t.closest('[data-role="citation-link"]');if(s){const t=parseInt(s.dataset.index);return void(Number.isNaN(t)||this._view._emit("citation-click",{event:e,index:t}))}const i=t.closest('[data-role="follow-up-link"]');if(i){let{q:t}=i.dataset;return t=t?t.trim():void 0,void(t&&this._view._emit("follow-up-click",{event:e,q:t}))}const o=t.closest("a");if(o){if(!e.defaultPrevented){const{href:t,innerText:s,className:i}=o;t&&this._view._emit("link-click",a({event:e,url:t,text:s?s.trim():"",className:i||"",attributes:_o(o)}))}}else;}}function _o(e){const{attributes:t}=e,s={};for(const{name:e,value:i}of t)e.startsWith("data-")&&(s[e]=i);try{return JSON.stringify(s)}catch(e){return"{}"}}const mo="miso-affiliation";const po=Object.freeze({root:function(e,t){const{className:s,role:i,templates:o,options:r}=e,{status:n}=t,a=i?` data-role="${i}"`:"",c=t.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=e._getItems(t),h=u?u.length:void 0;return`<div class="${s} ${n}"${a}${l}${r.itemType?` data-item-type="${r.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${n===dt.READY?o[n](e,t):""}</div>`},[dt.READY]:function(e,t){const{templates:s}=e,i=e._getItems(t);return i&&i.length>0?s.controlContainer(e,t,"previous")+s.body(e,t)+s.controlContainer(e,t,"next"):s.empty(e,t)},controlContainer:function(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__control-${s}-container">${o.control(e,t,s)}</div>`},control:function(e,t,s){const{className:i,templates:o}=e;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(e,t,s)}</div>`},controlIcon:function(e,t,s){return Ai},body:function(e,t){const{className:s,templates:i}=e,o=e._getItems(t);return`<div class="${s}__body">${i.list(e,t,o)}</div>`},item:function(e,t,s,i){const{className:o,templates:r,options:n}=e,{itemType:a}=n;return`<li class="${o}__item"><div class="${o}__item-inner">${r.itemHeader(e,t,s,{index:i})}${r[a](e,t,s,{index:i})}</div></li>`},itemHeader:function(e,t,s,i){const{className:o,templates:r}=e;let{itemHeaderLeftText:n,itemHeaderRightText:a}=r;return n=Qs.asFunction(n)(e,t,s,i),a=Qs.asFunction(a)(e,t,s,i),`<div class="${o}__item-header">\n  <div class="${o}__item-header-left">${n}</div>\n  <div class="${o}__item-header-right">${a}</div>\n</div>`},affiliation:function(e,t,s,i){const{templates:o}=e,[r,n]=zs(e,s,{link:!1});return""+r+(o.infoBlock||o.affiliationInfoBlock||Es)(e,s,i)+(o.imageBlock||Us)(e,s,{brand:!0,...i})+n},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(e,t,s,i){const{className:o,templates:r}=e,n=Qs.asFunction(r.logoText)(e,t,s,i)||"",a=Qs.asFunction(r.logoImg)(e,t,s,i);return a?`<span class="${o}__item-header-logo-text">${n}</span>${a}`:""},logoImg:function(e,t,s,i){const{className:o,templates:r}=e,n=Qs.asFunction(r.logoUrl)(e,t,s,i);if(!n)return"";const a=Qs.asFunction(r.logoAltText)(e,t,s,i);return`<img class="${o}__item-header-logo" src="${n}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),fo=Object.freeze({...di.defaultTemplates,...po});class bo extends di{static get type(){return"affiliation"}static get defaultTemplates(){return fo}static get defaultClassName(){return mo}constructor({className:e=mo,templates:t,autoplay:s,...i}={}){super({className:e,itemType:"affiliation",templates:{...po,...t},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(e){super.initialize(e);const{viewable:t}=this._view.tracker.options||{};this._viewable=new Z(this._onViewable.bind(this),t)}get itemIndex(){return this._itemIndex}set itemIndex(e){void 0!==this._itemCount&&(0>e?e=this._itemCount-1:this._itemCount>e||(e=0),this._itemIndex=e,y(()=>this._syncItemIndex()))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(e,t,s){super._render(e,t,s),this._syncItemCount(t),this._syncItemIndex()}_syncElement(e){const t=this._element;super._syncElement(e),this._syncViewableElement(t,e)}_syncViewableElement(e,t){e!==t&&(e&&this._viewable.unobserve(e),t&&this._viewable.observe(t))}_syncItemCount({state:e}={}){const t=this._getItems(e),s=this._itemCount=t?t.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(Vs(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const e=this._itemIndex;if(e===this._displayedIndex)return;const{element:t}=this._view,s=t&&this._getListElement(t);s&&(this._displayedIndex=e,s.style.left=100*-e+"%",this._viewable.display(e),this._view._emit("display",{index:e}))}_onViewable(e){const t=this._getRenderedItemData(e);t&&this._view.tracker.viewable([t])}_getRenderedItemData(e){const{value:t}=this._rendered.get(this._element)||{};if(!t)return;const{products:s=[]}=t;return s[e]}_trackViewables(){}_onClick(e){const t=e.target;t.closest('[data-role="previous"]')?this.previous():t.closest('[data-role="next"]')?this.next():super._onClick(e)}}const go="miso-facets",yo="miso-facet",vo="custom_attributes.";const wo=Object.freeze({root:function(e,t){const{className:s,role:i,templates:o}=e;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${o.facets(e,t)}</div>`},facets:function(e,t){const{templates:s}=e,{facet_fields:i={}}=t.value||{};return Object.keys(i).map(o=>s.facet(e,{field:o,entries:i[o]},t))},facet:function(e,t,s){const{facetClassName:i=yo,templates:o}=e,{field:r}=t;return`<div class="${i}" data-role="facet" data-field="${w(r)}">${o.header(e,t,s)}${o.options(e,t,s)}</div>`},header:function(e,t,s){const{facetClassName:i=yo,templates:o}=e;return`<div class="${i}__header">${o.title(e,t,s)}</div>`},title:function(e,{field:t}){return t.startsWith(vo)&&(t=t.substring(18)),w(t)},options:function(e,{field:t,entries:s},i){const{facetClassName:o=yo,templates:r}=e;return`<ul class="${o}__options" data-role="options">${s.map(([s,o])=>r.option(e,{field:t,value:s,count:o},i)).join("")}</ul>`},option:function(e,t,s){const{facetClassName:i=yo,templates:o}=e;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${o.value(e,t,s)}</span>\n  <span class="${i}__count">${o.count(e,t,s)}</span>\n</li>`},value:function(e,{value:t},s){return w(t)},count:function(e,{count:t},s){return e.templates.helpers.formatNumber(t)}});function xo(e,t){return`${e}:::${t}`}function Eo(e){const t={};for(const s in e)t[s]=new Set(e[s]);return t}class ko extends Gs{static get type(){return"facets"}static get defaultTemplates(){return wo}static get defaultClassName(){return go}constructor({className:e=go,templates:t,...s}={}){super({className:e,templates:{...wo,...t},...s}),this._bindings=new oi}initialize(e){const{proxyElement:t,filters:s}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",e=>this._handleClick(e)),s.on("update",e=>this._updateSelections(e)),s.on("reset",()=>this._syncSelections())]}_render(e,t,s){super._render(e,t,s)}_afterRender(e,t){this._syncBindings(e,t),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const e=Eo(this._view.hub.states.filters.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)this._setSelected(i,e[t]&&e[t].has(s))}_updateSelections({updates:e}){const t=Eo(e.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)t[e]&&this._setSelected(i,t[e].has(s))}_setSelected(e,t){e&&(t?e.classList.add("selected"):e.classList.remove("selected"))}_syncBindings(e,t){if(!e||!t.value)return;const s=this._getItems(t),i=[],o=[],r=[];for(const t of this._getFacetElements(e)){const e=t.getAttribute("data-field"),n=s[e];if(!n)continue;const a=this._getItemElements(t);for(let t=0;a.length>t;t++){const s=a[t],c=n[t];if(!c)break;i.push(xo(e,c)),o.push({field:e,value:c}),r.push(s)}}this._bindings.update(i,o,r)}_clearBindings(){this._bindings.clear()}_getItems({value:e}={}){const{facet_fields:t={}}=e||{},s={};for(const e in t)s[w(e)]=t[e].map(([e])=>e);return s}_getFacetElements(e){return Array.from(e.querySelectorAll('[data-role="facet"]'))}_getFacetElement(e,t){return e.querySelector(`[data-role="facet"][data-field="${t}"]`)}_getItemElements(e){return Array.from(e.querySelectorAll('[data-role="option"]'))}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="option"]');if(!t)return;const s=this._bindings.get(t),i=s&&s.value;if(!i)return;const{field:o,value:r}=i;this._view.filters.facets.toggle(o,r),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const So="miso-select";const Oo=Object.freeze({root:function(e,t){const{className:s,role:i,templates:o}=e,r=i?`data-role="${i}"`:"",n=e._getItems(t),a=n.find(e=>e.selected)||n[0];return`\n<div class="${s}" ${r}>\n  ${o.button(e,a)}\n  ${o.options(e,t)}\n</div>`},button:function(e,t){const{className:s,templates:i}=e;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(e,t)}</button>`},options:function(e,t){const{className:s,templates:i}=e;return`<ul class="${s}__options">${e._getItems(t).map((t,s)=>i.option(e,t,{index:s})).join("")}</ul>`},option:function(e,t){const{className:s,templates:i}=e;return`<li class="${s}__option ${t.selected?"selected":""}" data-role="option" tabindex="0">${i.text(e,t)}</li>`},text:function(e,t){return w(t&&t.text&&t.text.replace(/[-_]([a-zA-Z])/g,(e,t)=>" "+t)||t||"")}});class Io extends Gs{static get type(){return"select"}static get defaultTemplates(){return Oo}static get defaultClassName(){return So}constructor({className:e=So,templates:t,...s}={}){super({className:e,templates:{...Oo,...t},...s}),this._initTrackable()}initialize(e){const{proxyElement:t}=e;this._unsubscribes=[...this._unsubscribes,t.on("click",e=>this._handleClick(e))]}_afterRender(e,t){this._syncBindings(e,t)}_unrender(){this._clearBindings()}_getItems(e){return e.value||[]}_getOptionsElement(e){return e.querySelector('[data-role="options"]')}_getItemElements(e){return e?Array.from(e.querySelectorAll('[data-role="option"]')):[]}_handleClick(e){if(this._element)for(let t=e.target;t&&t!==this._element;t=t.parentElement){const{role:e}=t.dataset;switch(e){case"button":this._toggle();break;case"option":const e=this._bindings.get(t);this._select(e&&e.value)}}}_toggle(){if(!this._element)return;const e=this._element.children[0];e&&e.classList.toggle("open")}async _select(e){e&&this._view._emit("select",{value:e})}destroy(){this._destroyTrackable(),super.destroy()}}ci(Io.prototype);const Co="miso-more-button";const Ao=Object.freeze({root:function(e,t){const{className:s,role:i,templates:o}=e;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${t.status!==dt.READY?" disabled":""}>\n  ${Qs.asFunction(o.text)(e)}\n</div>\n`},text:function(e){return"More"}});class To extends Gs{static get type(){return"more-button"}static get defaultTemplates(){return Ao}static get defaultClassName(){return Co}constructor({className:e=Co,templates:t,...s}={}){super({className:e,templates:{...Ao,...t},...s})}initialize(e){this._unsubscribes=[...this._unsubscribes,e.proxyElement.on("click",e=>this._handleClick(e))]}_handleClick(e){if(0!==e.button)return;const t=e.target.closest('[data-role="more"]');t&&!t.disabled&&this._view.hub.trigger("more")}}var Ro=Object.freeze({__proto__:null,TemplateBasedLayout:Gs,ContainerLayout:Xs,ErrorLayout:ti,BannerLayout:class extends Gs{static get type(){return"banner"}static get defaultTemplates(){return si}constructor({className:e="miso-banner",templates:t,...s}={}){super({className:e,templates:{...si,...t},...s})}},CollectionLayout:di,ListLayout:mi,HorizontalLayout:fi,CardsLayout:class extends di{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return bi}constructor({className:e=bi,...t}={}){super({className:e,...t})}},CarouselLayout:Ui,GalleryLayout:Di,SearchBoxLayout:Qi,OptionListLayout:Vi,FeedbackLayout:eo,TextLayout:io,TypewriterLayout:ho,AffiliationLayout:bo,FacetsLayout:ko,SelectLayout:Io,MoreButtonLayout:To});function No({qs:e,...t}={}){return z(t,{metadata:{question_source:e||_t.ORGANIC}})}function Lo(e){return e&&e.value&&e.value.revision}function $o(e){const t=function(e){if(!e)return dt.INITIAL;const{request:t,error:s,value:i}=e;return s?dt.ERRONEOUS:i?dt.READY:t?dt.LOADING:dt.INITIAL}(e);return a({status:t,ongoing:t===dt.READY?e.ongoing:void 0,...e})}function Po(e){const{session:t,value:s}=e;if(!t||!s)return;const{miso_id:i}=s;i&&(t.meta.miso_id=i)}function Uo(e){const{request:t,value:s}=e;if(!t)return e;const{payload:i}=t||{},{q:o}=i||{};return o?{...e,value:{...s,keywords:o}}:e}function qo(e){const{role:t,type:s,items:i}=e,o={type:"viewable"===s?"viewable_impression":s,context:{custom_context:a({property:t})}};switch(function(e){return ut.has(e)}(s)&&(!function(e,t=[]){return function(e){return nt.has(e)}(e)||t.length>0&&"object"==typeof t[0]&&t[0].product_id}(t,i)?(o.product_ids=[],o.context.custom_context.items=(i||[]).map(e=>e.text||e.id||e)):o.product_ids=(i||[]).map(e=>"string"==typeof e?e:e.product_id).filter(e=>e)),s){case at.SUBMIT:o.context.custom_context.value=e.value;break;case at.FEEDBACK:o.context.custom_context.value=o.value=e.value,o.context.custom_context.result_type=o.result_type=e.result_type}return a(o)}function jo(e,t){return e=function(e={},{data:t}={}){if(!t)return e;const{request:s={},value:i={}}=t,{question_source:o}=s.payload&&s.payload.metadata||{},{question_id:r}=i;return D(e,{context:{custom_context:{question_source:o,question_id:r}}})}(e,t),e=function(e,t){if(t.role!==it.ANSWER)return e;const{items:s=[]}=t;return D(e,{context:{custom_context:{urls:s.map(e=>e.url),texts:s.map(e=>e.text),class_names:s.map(e=>e.className),attributes:s.map(e=>e.attributes)}}})}(e,t),e=function(e,{event_target:t}={}){if(!t)return e;return D(e,{context:{custom_context:{event_target:t}}})}(e,t)}const zo=Object.freeze({}),Do=Object.freeze({[it.CONTAINER]:Xs.type,[it.ERROR]:ti.type}),Mo=Object.freeze({}),Fo=Object.freeze({api:zo,layouts:Do,trackers:Mo}),Bo=Object.freeze({mappings:{[it.ERROR]:e=>e.error}});class Qo extends K{constructor(e){super(e.name||"workflow",e.plugin);let{context:t,plugin:s,client:i,defaults:o,options:r,extraOptions:n}=e;this._context=t,this._plugin=s=s||t._plugin,this._client=i=i||t._client,e=Object.freeze({...e,plugin:s,client:i}),this._name=e.name,this._roles=e.roles,this._extensions=s._getExtensions(i),this._defaults=o,this._options=r||new Pt(t&&t._options,o),this._extraOptions=n||{},this._hub=new Gt({onUpdate:e=>this._onHubUpdate(e),onEmit:e=>this._onHubEmit(e)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(e),this._initActors(e),this._initSubscriptions(e),this._initSession(e)}_initProperties(){}_initActors({roles:e}){const t=this._hub,s=this._client,i=this._options,o=this._extensions,r=this._plugin.layouts;this._sessions=new Ht(t),this._trackers=new gs(t,{roles:e,options:i}),this._proxyTrackers=new Proxy(this._trackers,{get:(e,t)=>{try{return e.get(t)}catch(e){}}}),this._data=new Vt(t,{source:ys(s),options:i,...this._extraOptions.api}),this._views=new rs(t,{extensions:o,layouts:r,roles:e,options:i,workflow:this}),this._interactions=new cs(t,{client:s,options:i})}_initSubscriptions({roles:e}){this._unsubscribes=[this._hub.on("session",e=>this._onSession(e)),this._hub.on("response",e=>this.updateData(e)),this._hub.on("tracker",e=>this._onTracker(e))],e.main&&this._unsubscribes.push(this._hub.on(Qt(e.main),e=>this._onMainViewUpdate(e)))}_initSession(){this.restart()}_getSessionContext(e){let t=this._sessionContext.get(e);return t||this._sessionContext.set(e,t={}),t}_onHubUpdate(e){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,e)}_onHubEmit(e){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,e),this._emitAsWorkflowEvent(e)}_emitAsWorkflowEvent({action:e,name:t,state:s,silent:i}){i||this._emit(t,{_action:e,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const e=this._hub.states.data;return e&&e.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:e}=this._roles;if(!e)return;const t=this._hub.states[Qt(e)]||{};t.session&&t.status===dt.LOADING&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onSession(e){this.updateData({session:e})}_onMainViewUpdate(e){const{status:t}=e,s=t===dt.READY,i=t===dt.ERRONEOUS;this._emitLifecycleEvent(i?"error":t,e),s&&this._emitLifecycleEvent("done",e),(s||i)&&this._emitLifecycleEvent("finally",e)}_shallEmitLifecycleEvent(e,{session:t}){const s=this._getSessionContext(t),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),o=i.has(e);return i.add(e),!o}_emitLifecycleEvent(e,t){this._shallEmitLifecycleEvent(e,t)&&this._emit(e,t)}_request(e={}){const{session:t}=this,s=wt(this._options.resolved.api,e);this.updateData({session:t,request:s}),this._hub.update("request",{...s,session:t})}updateData(e){if(!e)throw Error("Data is required.");const{session:t}=e;if(!t)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(t.uuid!==this.session.uuid)return;const s=Lo(e);if(!c(s)){const e=Lo(this._hub.states.data);if(!c(e)&&e>=s)return}return this._updateData(e),this}_updateData(e){const t=this._hub.states.data;e=this._defaultProcessData(e,t);for(const s of this._options.resolved.dataProcessor)e=s(e,t);this._updateDataInHub(e,t)}_defaultProcessData(e,t){return e=function(e,t){if(!e||!e.value||e.request||!t||!t.request)return e;const{request:s}=t;return{...e,request:s}}(e,t),e=function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,meta:{...e.meta,miso_id:s}}:e}(e=$o(e)),e}_updateDataInHub(e){this._hub.update("data",e)}notifyViewUpdate(e,t){return t={status:dt.READY,session:this.session,...t},this._hub.update(Qt(e),t),this}get trackers(){return this._proxyTrackers}_onTracker(e){const t=this._buildInteraction({...e,data:this._hub.states.data,workflow:this});this._sendInteraction(t)}_buildInteraction(e){let t=qo(e);t=this._defaultProcessInteraction(t,e);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)t=i(t,e);return t}_defaultProcessInteraction(e,t){return e=this._writeApiInfoToInteraction(e,t),e=function(e,t){const{data:s}=t;if(!s)return e;const i=s.request&&s.request.payload;if(!i)return e;const{question:o,q:r,fq:n}=i;return D(e,{context:{custom_context:{question:o,q:r,fq:n}}})}(e=this._writeMisoIdToInteraction(e,t),t),e=function(e,t){const{data:s}=t;if(!s)return e;const i=s.request&&s.request.payload&&s.request.payload.metadata;return i?D(e,{context:{custom_context:i}}):e}(e,t),e=function(e,t){if(t.role!==it.AFFILIATION)return e;const{items:s}=t;return D(e,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map(e=>e.position)}}})}(e,t),e}_writeApiInfoToInteraction(e){const{group:t,name:s}=this._options.resolved.api;return D(e,{context:{custom_context:{api_group:t,api_name:s}}})}_writeMisoIdToInteraction(e,t){const s=this._hub.states[Qt(t.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?D(e,{miso_id:i}):e}_sendInteraction(e){const{handle:t}=this._options.resolved.interactions;"function"==typeof t?t(e):this._hub.trigger("interaction",e)}destroy(e){this._emit("destroy"),this._destroy(e)}get destroyed(){return!!this._destroyed}_destroy({dom:e}={}){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],this._views._destroy({dom:e}),this._data._destroy(),this._destroyed=!0}_runCallbacks(e,t){for(const s of e)try{s({workflow:this,...t})}catch(e){this._error(e)}}_emit(e,t){this._events.emit(e,{_event:e,...t}),this._context&&this._context._events.emit(e,{workflow:this,_event:e,...t})}}function Go(e){if(e.affiliation_products){const{affiliation_products:t,...s}=e;e={...s,affiliation:Ho(t)}}else if(e.sovrn_aff){const{sovrn_aff:t,...s}=e;e={...s,affiliation:Wo(t)}}return function(e){const{affiliation:t}=e;if(!t)return e;let{channel:s,products:i}=t;if(!i)return e;i=i.map(e=>({...e}));let o=0;for(const e of i)s&&(e.channel=s),e.position=o++;return{...e,affiliation:{...t,products:i}}}(e)}function Ho(e){return{channel:"miso",products:e}}function Wo({products:e,...t}){return{channel:"sovrn",...t,products:e.map(Vo)}}function Vo({id:e,deeplink:t,headline:s,description:i,currency:o,retailPrice:r,salePrice:n,discountRate:c,image:l,thumbnail:u,merchant:h,...d}){return a({id:"sovrn-"+e,title:s,description:i,cover_image:l,url:t,currency:o,original_price:r,sale_price:n,discount_rate_percent:c,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:Ko({sovrn_id:e,thumbnail:u,merchant:h,...d})})}function Ko(e,t=""){return Object.keys(e).reduce((s,i)=>{const o=e[i];if(void 0===o)return s;const r=t?`${t}_${i}`:i;return"object"==typeof o?{...s,...Ko(o,r)}:{...s,[r]:o}},{})}function Yo(e){q(e,Zo.prototype)}zt(Qo.prototype),Object.assign(Qo,{DEFAULT_API_OPTIONS:zo,DEFAULT_LAYOUTS:Do,DEFAULT_TRACKERS:Mo,DEFAULT_OPTIONS:Fo,ROLES_OPTIONS:Bo});class Zo{useLink(e,t={}){if("function"!=typeof e&&!1!==e)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!e&&[e,t],this}_submitToPage(e={}){if(!this._linkFn)return;const t=this._getSubmitUrl(e),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=t;else{window.open(t,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:e,...t}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](e,t)}}const Jo=Object.freeze({...Qo.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Qo.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),Xo=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),er=Object.freeze({...Qo.DEFAULT_LAYOUTS,[it.QUERY]:[Qi.type,{placeholder:"Ask a question"}],[it.QUESTION]:[io.type,{tag:"h2"}],[it.ANSWER]:ho.type,[it.FEEDBACK]:eo.type,[it.IMAGES]:[Di.type,{incremental:!0,itemType:"image"}],[it.SOURCES]:[mi.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[it.AFFILIATION]:[bo.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),tr=Object.freeze({...Qo.DEFAULT_TRACKERS,[it.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:Ot.click},[it.IMAGES]:Ot,[it.SOURCES]:Ot,[it.AFFILIATION]:Ot,[it.PRODUCTS]:Ot}),sr=Object.freeze({...Qo.DEFAULT_OPTIONS,api:Jo,autocomplete:Xo,layouts:er,trackers:tr}),ir=bt(Qo.ROLES_OPTIONS,{main:it.ANSWER,members:Object.keys(er),mappings:{[it.ANSWER]:function(e){if(!e||!e.value)return;const{answer:t="",answer_stage:s,finished:i}=e.value;return Object.freeze({value:t,stage:s,finished:!!i})},[it.REASONING]:function(e){if(!e||!e.value)return;const{reasoning:t="",reasoning_finished:s}=e.value;return Object.freeze({value:t,stage:"reasoning",finished:!!s})}}});class or extends Qo{_initProperties(e){super._initProperties(e),this._questionId=void 0,this._autoQuery=!1}_initActors(e){super._initActors(e),this._feedback=new as(this._hub)}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",e=>this._query(e)),this._views.on(it.ANSWER,"citation-click",e=>this._onCitationClick(e)),this._views.on(it.ANSWER,"link-click",e=>this._onAnswerLinkClick(e))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(e,t){return"answer-stage"===e||super._shallEmitLifecycleEvent(e,t)}_emitInterruptEventIfNecessary(){const e=this._hub.states[Qt(this._roles.main)]||{};e.session&&e.status!==dt.INITIAL&&(e.status!==dt.READY||e.ongoing)&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onMainViewUpdate(e){const{status:t,session:s}=e,i=t===dt.READY&&!e.ongoing,o=t===dt.ERRONEOUS,r=i?"done":o?"error":t,n=this._getSessionContext(s),a=e.meta&&e.meta.answer_stage;a&&a!==n.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...e,answer_stage:a})),n.answerStage=a);const c=this._hub.states.data||{},{value:l}=c;if(l){const{blocked_reason:t}=l;t&&this._emitLifecycleEvent("blocked",{...e,blockedReason:t})}this._emitLifecycleEvent(r,e),(i||o)&&this._emitLifecycleEvent("finally",e)}get questionId(){return this._questionId}autoQuery(e={}){Mt.call(this,e)}query(e){if(!e.q&&!e.questionId)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e={}){if(this._linkFn)return void this._submitToPage(e);this.restart(),this._writeQuestionSourceToSession(e);const t=this._buildPayload(e);this._request({payload:t})}_writeQuestionSourceToSession(e){this.session.meta.question_source=e.qs||_t.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(e){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...e,wiki_link_template:`?${this._autoQuery.param}=%s`}:e}_updateData(e){this._writeQuestionIdFromData(e),!e.value||e.value.answer_stage?(super._updateData(e),Ft.call(this,e)):this._handleHeadResponse(e)}_handleHeadResponse(e){}_defaultProcessData(e,t){return e=function(e){if(!e||!e.value)return e;const{value:t}=e;return{...e,value:Go(t)}}(e=super._defaultProcessData(e,t)),e=function(e){const{value:t}=e;if(!t)return e;const{answer_stage:s}=t;return s?{...e,ongoing:!t.finished,meta:{...e.meta,answer_stage:s}}:e}(e),e}_writeQuestionIdFromData({value:e}){e&&this._writeQuestionId(e.question_id)}_defaultProcessInteraction(e,t){return e=jo(e=super._defaultProcessInteraction(e,t),t)}_getQuestionSourceFromViewState(e){const{request:t}=this._hub.states[Qt(e.role)]||{},{payload:s}=t||{};return s&&s.metadata&&s.metadata.question_source||void 0}_onCitationClick({index:e,event:t}){if(0!==t.button)return;if(ni(t))return;const{value:s}=this._hub.states.data||{},{sources:i}=s||{},o=i&&i[e-1];o&&o.product_id&&(ai(t),this._views.trackers.sources.click([o.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:e,...t}){0===e.button&&(ni(e)||(ai(e),this._views.trackers.answer.click([],{items:[t]})))}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e)}_clearQuestionId(){this._questionId=void 0}_destroy(e){this._feedback._destroy(),super._destroy(e)}}Yo(or.prototype),Object.assign(or,{DEFAULT_API_OPTIONS:Jo,DEFAULT_AUTOCOMPLETE_OPTIONS:Xo,DEFAULT_LAYOUTS:er,DEFAULT_TRACKERS:tr,DEFAULT_OPTIONS:sr,ROLES_OPTIONS:ir});var rr=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var nr=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class ar{constructor({helpers:e}){this._helpers=e}errorSection(e){const{section:t,container:s}=this._helpers;return t(e,{name:"error"},[s(e,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(e){return[this.answer(e),this.affiliation(e),this.sources(e)]}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(e){const{phrase:t}=this._helpers;return[t(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},[s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(e){const{container:t}=this._helpers,{affiliation:s=!0}=e||{};return s?t(e,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class cr{constructor(e){this._context=e,u(this,{lowerCamelToKebab:_,kebabToLowerCamel:h,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:e,circledCitationIndex:t=!0,phrases:s,...i}={}){return{classPrefix:e=e||this._context.CLASS_PREFIX,circledCitationIndex:t,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(e={}){if(!e)return{};const t={};for(const s in e)t[this.normalizePhraseOptionKey(s)]=e[s];return t}normalizePhraseOptionKey(e){return"relatedQuestions"===(e=d(e))||"querySuggestions"===e?"followUpQuestions":e}phrase(e,{name:t,extraNames:s=[],tag:i="div",inline:o=!1}){const{classPrefix:r}=e;return`<${i} class="${o?r+"__phrase-inline":r+"__phrase"} ${[t,...s].map(e=>`${r}__${e}-phrase`).join(" ")}">${this.phraseText(e,h(t))}</${i}>`}phraseText(e,t){const{phrases:s={}}=e,i=s[t]||this._context.DEFAULT_PHRASES[t];switch(typeof i){case"function":return i(e);case"string":return i;default:return""}}section({classPrefix:e},{name:t},s){return this.element("section",{classes:[e+"__section",`${e}__${t}`]},s)}container({classPrefix:e,circledCitationIndex:t,parentQuestionId:s,workflow:i},{name:o,extraNames:r=[],visibleWhen:n,trait:a,logo:c=!1},l){const u=[o,...r].map(t=>`${e}__${t}-container`);return t&&u.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:u,visibleWhen:n,trait:a,logo:c,parentQuestionId:s,workflow:i},l)}element(e,t={},s=""){return`<${e}${this.attrs(t)}>${Array.isArray(s)?s.join(""):s}</${e}>`}attrs({classes:e=[],...t}={}){let s="";e.length&&(s+=` class="${e.join(" ")}"`);for(const e in t){const i=t[e];void 0!==i&&(s+=` ${_(e)}="${i}"`)}return s}}const lr=j(new cr({...rr,DEFAULT_PHRASES:nr})),ur=j(new class extends ar{constructor(){super({helpers:lr})}answerGroup(e){const{container:t}=this._helpers;return[this.question(e),this.reasoning(e),this.answer(e),this.affiliation(e),this.sources(e),this.followUpQuestions(e),t(e,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"question",visibleWhen:"ready"},[e.parentQuestionId?"<hr>":"",s(e,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(e={}){const{phrases:t,reasoning:s={}}=e,{container:i,element:o,phraseText:r}=this._helpers,n=[];return s.expand&&n.push("expanded"),i(e,{name:"reasoning",visibleWhen:"nonempty"},[o("miso-stub",{classes:n,trait:"collapsible","data-role":"reasoning-box"},[o("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||Ni}</div>`,`<div class="miso-collapsible__title" data-role="title">${r(t,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ti}</div>`]),o("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(e){const{container:t,phrase:s}=this._helpers;return t(e,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(e,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(e){const{container:t,phrase:s}=this._helpers,i="follow-up-questions",o=["query-suggestions"];return t(e,{name:i,extraNames:o,visibleWhen:"nonempty"},[s(e,{name:i,extraNames:o,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(e){const{features:t={}}=e;return!1===t.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(e){const{container:t,phrase:s,section:i}=this._helpers,{features:o={},logo:r=!0}=e;return i(e,{name:"related-resources"},!1===o.relatedResources?"":t({...e,workflow:"active"},{name:"related-resources",visibleWhen:"nonempty",logo:r},[s(e,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:lr}));function hr(e={}){const{normalizeOptions:t,section:s,container:i}=lr,{answerGroup:o}=ur;return s(e=t(e),{name:"follow-up"},[i(e,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...o(e)])}var dr=Object.freeze({__proto__:null,helpers:lr,sections:ur,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=lr,{followUps:o,relatedResourcesSection:r,answerGroup:n}=ur;return""+s(e=t(e),{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},n(e))+o(e)+r(e)},followUp:hr});const _r=Object.freeze({...or.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...or.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),mr=Object.freeze({...or.DEFAULT_LAYOUTS,[it.QUERY]:[Qi.type,{templates:{buttonIcon:"send"}}],[it.REASONING]:ho.type,[it.RELATED_RESOURCES]:[mi.type,{incremental:!0,itemType:"article"}],[it.QUERY_SUGGESTIONS]:Vi.type,[it.FOLLOW_UP_QUESTIONS]:Vi.type}),pr=Object.freeze({...or.DEFAULT_TRACKERS,[it.RELATED_RESOURCES]:Ot,[it.QUERY_SUGGESTIONS]:{...Ot,click:{...Ot.click,validate:e=>0===e.button}}}),fr=Object.freeze({followUp:hr}),br=Object.freeze({...or.DEFAULT_OPTIONS,api:_r,layouts:mr,trackers:pr,templates:fr}),gr=bt(or.ROLES_OPTIONS,{members:Object.keys(mr),mappings:{[it.QUERY_SUGGESTIONS]:function(e,{workflow:t}={}){const s=t.previous,i=s&&s.states.data.value,o=i&&(i.suggested_followup_questions||i.followup_questions||[]);return o&&o.map(e=>({text:e}))},[it.FOLLOW_UP_QUESTIONS]:function(e){if(e&&e.value)return(e.value.followup_questions||[]).map(e=>({text:e}))}}});class yr extends or{constructor(e,t){super({name:"ask",context:e,roles:gr,defaults:br,parentQuestionId:t})}_initProperties(e){super._initProperties(e);const{parentQuestionId:t}=e;u(this,{parentQuestionId:t})}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on(Qt(it.REASONING),e=>this._onReasoningViewUpdate(e)),this._views.on(it.ANSWER,"follow-up-click",e=>this._onFollowUpClick(e)),this._views.on(it.FOLLOW_UP_QUESTIONS,"select",e=>this._onFollowUpQuestionSelect(e)),this._views.on(it.QUERY_SUGGESTIONS,"select",e=>this._onQuerySuggestionSelect(e))]}_initSession(e){e.parentQuestionId&&this._context._byPqid.set(e.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(e)}restart(){const{next:e}=this;e&&e.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:e}=this;return e?this._context.getByQuestionId(e):void 0}get next(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e):void 0}getOrCreateNext(){const{questionId:e}=this;return e?this._context.getByParentQuestionId(e,{autoCreate:!0}):void 0}_buildPayload({q:e,qs:t,questionId:s,...i}={}){if(s)return a({...i,question_id:s});const{parentQuestionId:o}=this;let r=a({...i,question:e,parent_question_id:o});return r=No({...r,qs:t}),r=this._writeWikiLinkTemplateToPayload(r),r}_updateData(e){super._updateData(e),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:e}=this;if(e)for(const t of e._views.getAll(it.QUERY_SUGGESTIONS))t.refresh()}_onReasoningViewUpdate({status:e,ongoing:t}){if(e===dt.READY&&!t)for(const e of this._views.getAll(it.REASONING)){const t=e.element&&e.element.closest('[data-role="reasoning-box"]');t&&t.classList.add("done")}}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeAdditionalAskPropertiesToInteraction(e,t)}_writeAdditionalAskPropertiesToInteraction(e,t){const s=this.rootQuestionId;let i,o,r,{property:n}=e.context&&e.context.custom_context||{};return t.role!==it.FOLLOW_UP_QUESTIONS&&t.role!==it.QUERY_SUGGESTIONS||(n="suggested_followup_questions"),t.role===it.QUERY_SUGGESTIONS?(o=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,r=this.previous&&this.previous.session.meta.question_source):o=this.parentQuestionId,D(e,{context:{custom_context:a({property:n,root_question_id:s,parent_question_id:o,question_id:i,question_source:r})}})}_onFollowUpClick({q:e,event:t}={}){0===t.button&&this._submitFollowUpQuestion({q:e,qs:_t.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:e}){this._submitFollowUpQuestion({q:e,qs:_t.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:e="",qs:t}={}){if(!(e=e.trim()))return;this.getOrCreateNext().query({q:e,qs:t})}_onQuerySuggestionSelect({value:e}){e&&this.query({q:e,qs:_t.SUGGESTED_QUESTIONS})}_writeQuestionId(e){!this._questionId&&e&&(this._questionId=e,this._context._byQid.set(e,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_destroy(e){const{next:t,parentQuestionId:s,questionId:i}=this;t&&t.destroy(e),s&&this._context._byPqid.delete(s),i&&this._context._byQid.delete(i),super._destroy(e)}}const vr={event:"done"};class wr extends Bt{constructor(e,t){super("asks",e,t),this._byQid=new Map,this._byPqid=new Map,this._root=new yr(this),this._events.on("*",e=>this._createNextIfNecessary(e)),this._events.on("loading",e=>this._setActive(e.workflow)),this._events.on("destroy",()=>this._requestEmitAfterDestroy()),this._events.on("after-destroy",()=>this._syncActiveOnAfterDestroy()),this._autoNextFn=void 0,this._active=this._root}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}get active(){return this._active}getByQuestionId(e){if("string"!=typeof e)throw Error("Required ID to be a string: "+e);return this._byQid.get(e)}getByParentQuestionId(e,{autoCreate:t=!1}={}){if(void 0===e)return this._root;if("string"!=typeof e)throw Error("Required ID to be a string: "+e);let s=this._byPqid.get(e);return!s&&t&&(s=new yr(this,e)),s}reset({root:e=!0,events:t,...s}={}){void 0===t&&(t=!!e),t&&this._events.clear();for(const e of this._byPqid.values())e.destroy(s);e&&this._root.restart()}autoNext(e){this._autoNextFn=function(e=vr){switch(!0===e&&(e=vr),"string"==typeof e&&(e={event:e}),typeof e){case"object":return t=>t&&e.event===t._event;case"function":return e;default:return()=>!1}}(e)}_createNextIfNecessary(e){if(!this._autoNextFn||!this._autoNextFn(e))return;const{workflow:t}=e;t&&t.getOrCreateNext()}_requestEmitAfterDestroy(){this._emitAfterDestroyRequested||(this._emitAfterDestroyRequested=!0,setTimeout(()=>{this._emitAfterDestroyRequested=!1,this._events.emit("after-destroy",{})},0))}_syncActiveOnAfterDestroy(){if(!this._active.destroyed)return;let e=this._root;for(;e.next&&e.next.status!==dt.INITIAL;e=e.next);this._setActive(e)}_setActive(e){e!==this._active&&(this._active=e,this._events.emit("active",{workflow:e}))}}zt(wr.prototype,[pt.TEMPLATES]);const xr=Object.freeze({...Qo.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Qo.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),Er=Object.freeze({...Qo.DEFAULT_LAYOUTS,[it.QUERY]:[Qi.type],[it.PRODUCTS]:[mi.type,{incremental:!0,infiniteScroll:!0}],[it.KEYWORDS]:[io.type,{raw:!0}],[it.TOTAL]:[io.type,{raw:!0,format:"number"}],[it.FACETS]:[ko.type],[it.SORT]:[Io.type],[it.MORE]:[To.type]}),kr=Object.freeze({...Qo.DEFAULT_TRACKERS,[it.PRODUCTS]:Ot}),Sr=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Or=Object.freeze({...Qo.DEFAULT_OPTIONS,api:xr,layouts:Er,trackers:kr,pagination:Sr}),Ir=bt(Qo.ROLES_OPTIONS,{main:it.PRODUCTS,members:Object.keys(Er),mappings:{[it.FACETS]:"facet_counts",[it.SORT]:function(e,{hub:t,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:o}=t.states.filters||{},r=o&&o.field||function(e){for(const t of e)if(t.default)return t;return e[0]}(i).field;return r?i.map(e=>({...e,selected:e.field===r})):i}}});class Cr extends Qo{_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",e=>this._query(e)),this._hub.on("filters",()=>this._refine()),this._hub.on("more",()=>this._more()),this._views.on(it.SORT,"select",e=>this._handleSortSelect(e))]}restart(){super.restart(),this._page=0}get exhausted(){const e=this._hub.states.data;return!!(e&&e.meta&&e.meta.exhausted)}get page(){return this._page}autoQuery(e={}){Mt.call(this,e)}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){if(this._linkFn)return void this._submitToPage(e);const t=ft.QUERY;this._views.filters.reset({silent:!0}),this.restart({type:t});const s=this._buildPayload(e,t);this._request({payload:s,type:t})}_refine(){const e=ft.REFINE,{facet_counts:t}=this._hub.states.data.value||{};this._currentFacetCounts=t,this.restart({type:e});const s=this._getQuery(),i=this._buildPayload(s,e);this._request({payload:i,type:e})}_more(){if(this.status!==dt.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const e=ft.MORE,t=this._getQuery(),s=this._buildPayload(t,e);this._request({payload:s,type:e})}_getQuery(){return this._hub.states.query}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(e,t){return e=this._writeFiltersToPayload(e),e=this._writePageInfoToPayload(e),t===ft.MORE&&(e=this._processPayloadForMoreRequest(e)),e}_writeFiltersToPayload(e){const t=this._hub.states.filters,{facets:s,sort:i}=t||{};return a({...e,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(e){if(!e)return;const t={};for(const s in e){const i=e[s];i&&i.length&&(t[s]={terms:i})}return Object.keys(t).length?t:void 0}_buildOrderBy(e){if(e)return n(e)}_writePageInfoToPayload(e){return{...e,metadata:{...e.metadata,page:this._page}}}_processPayloadForMoreRequest(e={}){const t=this._hub.states.data,{[this._roles.main]:s=[]}=t&&t.value||{},i=s.map(e=>e.product_id).filter(e=>e),o=[...e.exclude||[],...i];return 0===o.length?e:{...e,exclude:o}}_defaultProcessData(e,t){return e=function(e,t){if(!t)return e;const{status:s,value:i}=e;switch(s){case dt.INITIAL:case dt.LOADING:break;default:return e}return i&&i.facet_counts?e:{...e,value:{...i,facet_counts:t}}}(e=Uo(e=super._defaultProcessData(e,t)),this._currentFacetCounts),e=function(e,{role:t=it.PRODUCTS}={}){const{status:s,request:i,value:o}=e;if(s!==dt.READY||!i||!o)return e;const{[t]:r}=o;if(!r)return e;const{rows:n}=i.payload,{length:a}=r;return n>a?{...e,meta:{...e.meta,exhausted:!0}}:e}(e,{role:this._roles.main}),e}_updateData(e){super._updateData(e),Ft.call(this,e)}_updateDataInHub(e,t){e=this._appendResultsFromMoreRequest(e),super._updateDataInHub(e,t)}_appendResultsFromMoreRequest(e){const{request:t}=e;if(!t)return e;const{metadata:s}=t.payload;if(!s||!s.page)return function(e){const{value:t}=e;if(!t)return e;const{miso_id:s}=t;return s?{...e,value:{...t,root_miso_id:s}}:e}(e);return function(e,t,{role:s=it.PRODUCTS}={}){if(!t.value)return e;const{[s]:i=[],facet_counts:o,total:r,root_miso_id:n}=e.value,{[s]:a=[]}=t.value;return{...t,value:{...t.value,facet_counts:o,total:r,root_miso_id:n,[s]:[...i,...a]}}}(this._hub.states.data,e,{role:this._roles.main})}_handleSortSelect({value:e}={}){e&&(this._views.filters.update({sort:e}),this._views.filters.apply())}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeRootMisoIdToInteraction(e)}_writeRootMisoIdToInteraction(e){const t=this._hub.states.data,{root_miso_id:s}=t&&t.value||{};return s?D(e,{context:{custom_context:{root_miso_id:s}}}):e}}zt(Cr.prototype,[pt.PAGINATION,pt.FILTERS]),Yo(Cr.prototype),Object.assign(Cr,{DEFAULT_API_OPTIONS:xr,DEFAULT_LAYOUTS:Er,DEFAULT_TRACKERS:kr,DEFAULT_PAGINATION:Sr,DEFAULT_OPTIONS:Or,ROLES_OPTIONS:Ir});const Ar=or.ROLES_OPTIONS;class Tr extends or{constructor(e){super({name:"hybrid-search/answer",plugin:e._plugin,client:e._client,options:e._options,defaults:e._defaults,roles:Ar,superworkflow:e})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow}_initSession(){}_doLoading(e){const{session:t}=this;this.updateData({...e,session:t})}_queryWithQuestionId(e){const{session:t}=this,{request:s,value:i}=e;this.updateData({...e,session:t});const{question_id:o}=i;if(!o)return;const r={...s.payload,question_id:o};void 0!==r.metadata.page&&delete r.metadata.page,this._hub.update("request",{...s,payload:r,session:t})}_defaultProcessData(e,t){return e=function(e){const{session:t,value:s}=e;if(!t||!s)return e;const{meta:{miso_id:i}={}}=t;return i?{...e,meta:{...e.meta,miso_id:i}}:e}(e=Uo(e=super._defaultProcessData(e,t))),e=function(e){const{value:t}=e;return t?!t.finished||"success"!==t.finish_reason||t.sources&&t.sources.length>0?e:{...e,meta:{...e.meta,unanswerable:!0}}:e}(e),e}_handleHeadResponse(e){super._handleHeadResponse(e),Po(e)}_onTracker(e){this._superworkflow._onTracker(e)}}const Rr=Cr.ROLES_OPTIONS.members;class Nr{constructor(e){this._subviews=e,this._containers=new Set}get filters(){return this._subviews.results.filters}on(e,t,s){return this._getSubviews(e).on(e,t,s)}get(e){return this._getSubviews(e).get(e)}getAll(e){return this._getSubviews(e).getAll(e)}addContainer(e){if(this._containers.has(e))return;this._containers.add(e);const{components:t}=e;for(const e of t)this.addComponent(e)}removeContainer(e){for(const t of this._getAllSubviews())t.removeContainer(e);this._containers.delete(e)}addComponent(e){this._getSubviews(e.role).addComponent(e),this._addContainerToSubviews(e._container,e)}removeComponent(e){this._getSubviews(e.role).removeComponent(e),this._removeContainerFromSubviewsIfNecessary(e._container)}updateComponentRole(e,t,s){}refreshElement(e){this._getSubviews(e.role).refreshElement(e)}_getAllSubviews(){return Object.values(this._subviews)}_getSubviews(e){return this._subviews[function(e){return Rr.includes(e)?"results":"answer"}(e)]}_addContainerToSubviews(e,t){if(!e)return;const{role:s}=t,i=this._getSubviews(s);if(!i._containers.has(e)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(e)){for(const i of e.components)if(s.containsElement(i))throw Error(`<${e.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${t.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${e.tagName.toLowerCase()}> with child component <${t.tagName.toLowerCase()}>.`)}i.addContainer(e)}}_removeContainerFromSubviewsIfNecessary(e){if(e&&0>=e.components.length)for(const t of this._getAllSubviews())t.removeContainer(e)}}const Lr=Object.freeze({members:[]});function $r({layouts:e,trackers:t,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function Pr(e){return e&&e.value&&e.value.trim()||void 0}class Ur extends Qo{constructor(e,{defaults:t,...s}={}){super({name:"autocomplete",plugin:e._plugin,client:e._client,defaults:$r(t),roles:Lr,superworkflow:e,...s})}_initProperties(e){super._initProperties(e),this._superworkflow=e.superworkflow,this._active=e.defaults.active}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,e.superworkflow._hub.on("input",e=>this._query(e))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(e){if(!this._active||(t=this._args,Pr(e)===Pr(t)))return;var t;this._args=e,this.restart();const{session:s}=this;if(s.meta.input=e,!Pr(e))return void this._updateCompletions({session:s,status:dt.INITIAL});const i=this._buildPayload(e);this._request({payload:i})}_buildPayload(e){return{q:Pr(e)}}_updateDataInHub(e){e.value&&(e={...e,value:e.value.completions}),this._updateCompletions(e)}_updateCompletions(e){this._superworkflow.updateCompletions(e)}}function qr(e){q(e,jr.prototype)}class jr{_initAutocomplete(e){this._autocomplete=new Ur(this,{defaults:e.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(e){return this._hub.update("completions",e),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const zr=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...or.DEFAULT_API_OPTIONS.payload,...Cr.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Dr=Object.freeze({...or.DEFAULT_LAYOUTS,...Cr.DEFAULT_LAYOUTS,[it.QUERY]:[Qi.type,{placeholder:""}],[it.QUESTION]:[io.type,{raw:!0}],[it.SOURCES]:[fi.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:xs,articleInfoBlock:Os}}]}),Mr=Object.freeze({...or.DEFAULT_TRACKERS,...Cr.DEFAULT_TRACKERS}),Fr=Object.freeze({...Cr.DEFAULT_PAGINATION,active:!0}),Br=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Qr=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Gr=Object.freeze({...or.DEFAULT_OPTIONS,...Cr.DEFAULT_OPTIONS,api:zr,layouts:Dr,trackers:Mr,autocomplete:Br,pagination:Fr,filters:Qr}),Hr=Object.freeze({main:it.PRODUCTS,members:Object.keys(Dr),mappings:Object.freeze({...or.ROLES_OPTIONS.mappings,...Cr.ROLES_OPTIONS.mappings})}),Wr=Object.freeze({api:Object.freeze({polling:!1})});class Vr extends Cr{constructor(e,t){super({name:"hybrid-search",plugin:e,client:t,roles:Hr,defaults:Gr,extraOptions:Wr})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e),this._answer=new Tr(this)}_initActors(e){super._initActors(e),this._views=new Nr({results:this._views,answer:this._answer._views})}restart({type:e}={}){super.restart(),e&&e!==ft.QUERY||this._answer.restart()}get answer(){return this._answer}get questionId(){return this._answer.questionId}_buildPayload(e,t){return e=function(e,t){return t===ft.QUERY?e:{...e,answer:!1}}(e=super._buildPayload(e,t),t),e=No(e),!1!==(e=this._writeQuestionIdToPayload(e,t)).answer&&(e=or.prototype._writeWikiLinkTemplateToPayload.call(this,e)),e}_buildOrderBy(e){if(e)return e.field}_writeQuestionIdToPayload(e,t){if(t===ft.QUERY)return e;const s=this._answer.questionId;return s?z(e,{metadata:{question_id:s}}):e}_defaultProcessData(e,t){return Po(e=super._defaultProcessData(e,t)),e}_updateDataInHub(e,t){this._dispatchDataToAnswerWorkflow(e),e=function(e,t){const{question_id:s}=t&&t.value||{};return s?{...e,value:{...e.value,question_id:s}}:e}(e,t),super._updateDataInHub(e,t)}_dispatchDataToAnswerWorkflow(e){const{request:t}=e;if(!t)return;const{type:s,payload:i}=t;if(s===ft.QUERY&&i&&!1!==i.answer)switch(e.status){case dt.LOADING:this._answer._doLoading(e);break;case dt.READY:this._answer._queryWithQuestionId(e)}}_defaultProcessInteraction(e,t){return e=jo(e=super._defaultProcessInteraction(e,t),t)}_destroy(){this._answer.destroy(),super._destroy()}}zt(Vr.prototype,[pt.PAGINATION,pt.FILTERS]),qr(Vr.prototype);const Kr=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),Yr=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),Zr=Object.freeze({...Cr.DEFAULT_LAYOUTS}),Jr=Object.freeze({...Cr.DEFAULT_TRACKERS}),Xr=Object.freeze({...Cr.DEFAULT_OPTIONS,api:Kr,autocomplete:Yr,layouts:Zr,trackers:Jr}),en=Cr.ROLES_OPTIONS;class tn extends Cr{constructor(e,t){super({name:"search",plugin:e,client:t,roles:en,defaults:Xr})}_initProperties(e){super._initProperties(e),this._initAutocomplete(e)}notifyViewUpdate(e=it.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}_destroy(e){this._destroyAutocomplete(),super._destroy(e)}}qr(tn.prototype);class sn extends Bt{constructor(e,t,s){super(e,t,s),this._members=new Map}workflows(){return[...this._members.values()]}create(e=st){if(this._members.has(e))throw Error("Unit already exists: "+e);return this._create(e)}has(e=st){return this._members.has(e)}get(e=st){if("string"!=typeof e)throw Error("Required unit ID to be a string: "+e);return this._members.get(e)||this._create(e)}_create(e){throw Error("Not implemented")}}class on extends Qo{_initProperties(e){super._initProperties(e);const{id:t}=e;u(this,{id:t})}_initSession(e){this._context._members.set(e.id,this),super._initSession(e)}_defaultProcessInteraction(e,t){return e=super._defaultProcessInteraction(e,t),e=this._writeUnitIdToInteraction(e,t)}_writeUnitIdToInteraction(e){return D(e,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(e){this._context._members.delete(this.id),super._destroy(e)}}Object.assign(on,{DEFAULT_API_OPTIONS:Qo.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Qo.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Qo.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Qo.DEFAULT_OPTIONS,ROLES_OPTIONS:Qo.ROLES_OPTIONS});const rn=Object.freeze({...on.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...on.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),nn=Object.freeze({...on.DEFAULT_LAYOUTS,[it.PRODUCTS]:mi.type}),an=Object.freeze({...on.DEFAULT_TRACKERS,[it.PRODUCTS]:Ot}),cn=Object.freeze({...on.DEFAULT_OPTIONS,api:rn,layouts:nn,trackers:an}),ln=bt(on.ROLES_OPTIONS,{main:it.PRODUCTS,members:Object.keys(nn)});class un extends on{constructor(e,t){super({name:"recommendation",context:e,roles:ln,defaults:cn,id:t})}start(){return this._request(),this}notifyViewUpdate(e=it.PRODUCTS,...t){return super.notifyViewUpdate(e,...t),this}}class hn extends sn{constructor(e,t){super("recommendations",e,t)}_create(e){return new un(this,e)}}const dn=Object.freeze({...on.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),_n=Object.freeze({...on.DEFAULT_LAYOUTS,[it.RELATED_QUESTIONS]:[mi.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[it.QUERY]:[Qi.type,{placeholder:"Ask a question"}]}),mn=Object.freeze({...on.DEFAULT_TRACKERS,[it.RELATED_QUESTIONS]:Ot,[it.CONTAINER]:{...Ot,itemless:!0},[it.QUERY]:{[at.SUBMIT]:{active:!0}}}),pn=Object.freeze({...on.DEFAULT_OPTIONS,api:dn,layouts:_n,trackers:mn}),fn=bt(on.ROLES_OPTIONS,{main:it.RELATED_QUESTIONS,members:Object.keys(_n)});class bn extends on{constructor(e,t){super({name:"explore",context:e,roles:fn,defaults:pn,id:t})}_initProperties(e){super._initProperties(e),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(e){super._initSubscriptions(e),this._unsubscribes=[...this._unsubscribes,this._views.on(it.RELATED_QUESTIONS,"click",e=>this._handleRelatedQuestionClick(e)),this._hub.on("query",e=>this._query(e))]}set productId(e){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:e})}useApi(...e){const t=("object"==typeof e[0]?e[0]:e[1])||{},{product_id:s}=t;return s&&(this._productId=s),super.useApi(...e)}useLink(e,t){return Zo.prototype.useLink.call(this,e,t),t&&this.useLayouts({[it.RELATED_QUESTIONS]:{link:t}}),this}start({relatedQuestions:e=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(e)this._request();else{const{session:e}=this;this.updateData({session:e,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(e=it.RELATED_QUESTIONS,...t){return super.notifyViewUpdate(e,...t),this}_defaultProcessData(e,t){return e=super._defaultProcessData(e,t),e=this._addUrlToRelatedQuestions(e)}_addUrlToRelatedQuestions(e){const{value:t}=e;if(!t||!t.related_questions)return e;const s=t.related_questions.map(this._linkFn&&this._linkFn[0]?e=>({text:e,url:this._getSubmitUrl({q:e,generated:!0})}):e=>({text:e}));return{...e,value:{...t,related_questions:s}}}_handleRelatedQuestionClick({value:e,...t}){this._events.emit("select",Object.freeze({...t,question:e}))}query(e){if(!e.q)throw Error("q is required in query() call");this._hub.update("query",e)}_query(e){this._submitToPage({...e,generated:!1})}_getSubmitUrl(e){let t=Zo.prototype._getSubmitUrl.call(this,e);return e.generated&&this._productId?`${t}&qs=${encodeURIComponent(this._productId)}`:t}}Yo(bn.prototype);class gn extends sn{constructor(e,t){super("explores",e,t)}_create(e){return new bn(this,e)}}class yn extends K{constructor({name:e,plugin:t,MisoClient:s,...i}){super(e||"combo",t),this._name=e,this._plugin=t,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new I)).promise}set element(e){this._element=e,this._elementRes&&this._elementRes.resolve(e)}start(e){this._started||(this._started=!0,e&&this.config(e),this._start())}_start(){throw Error("Unimplemented")}}const vn=Object.freeze(rr),wn=Object.freeze(nr),xn=Object.freeze(dr);var En=Object.freeze({__proto__:null,constants:vn,phrases:wn,templates:xn,wireFollowUps:function(e,t,s){if(!e)throw Error("client is required");!function(e,{template:t=hr,...s}={}){if("function"!=typeof t)throw Error("template must be a function or undefined");const i=Object.keys(s).length>0;if(t===hr&&!i)return;e.ui.asks.useTemplates({followUp:i?e=>t({...s,...e}):t})}(e,s),function(e){if(!e||"miso-follow-ups"===e.tagName.toLowerCase())return;const t=document.createElement("miso-follow-ups");for(const{name:s,value:i}of e.attributes)t.setAttribute(s,i);e.parentNode.replaceChild(t,e)}(t)},wireRelatedResources:function(e,t){if(!e)throw Error("client is required");if(t)for(const e of t.querySelectorAll("miso-ask"))e.setAttribute("workflow","active")}});const{currentScript:kn}=document,Sn=Object.freeze({templates:xn,autostart:!0}),On=["templates","phrases","features"];class In{constructor(){this._defaults=Sn,this._scriptSrc=function(){if(!kn||!kn.src)return{};const e=document.createElement("a");e.href=kn.src;const t={};for(const[s,i]of new URLSearchParams(e.search))"q"!==s&&(t[s]=Tn(i));return t}(),this._pageUrl=function(){const e={};for(const[t,s]of new URLSearchParams(window.location.search))t.startsWith("miso_")&&t.length>5&&"miso_api_key"!==t?e[t.substring(5)]=Tn(s):"q"===t&&(e.q=s);return e}()}resolve(e){return function({api_key:e,api_host:t,templates:s,phrases:i,...o}={}){return a({apiKey:e,apiHost:t,templates:Rn(s),phrases:i,...o})}(Cn(this._defaults,this._scriptSrc,e,this._pageUrl))}}function Cn(...e){let t={};for(const s of e)s&&(t=An(t,s));return t}function An(e,t){if(!t)return e;Object.assign(e,t);for(const s of On)s in t&&(e[s]={...e[s],...t[s]});return e}function Tn(e){return""===e||"false"!==e&&e}function Rn(e){if(null==e)return e;switch(typeof e){case"function":return e;case"string":case"number":return()=>e;case"object":return Array.isArray(e)?e.map(Rn):function(e,t){const s={};for(const[i,o]of Object.entries(e))s[i]=t(o);return s}(e,Rn);default:throw Error("Unsupported template type: "+e)}}class Nn{constructor(e,{classPrefix:t=vn.CLASS_PREFIX}={}){if(!e)throw Error("Root element is required");u(this,{root:e,followUpsSection:e.querySelector(`.${t}__follow-ups`),relatedResourcesSection:e.querySelector(`.${t}__related-resources`),relatedResourcesContainer:e.querySelector(`.${t}__related-resources miso-ask`)})}}class Ln extends yn{constructor(e,t){super({name:"ask-combo",plugin:e,MisoClient:t}),this._options=new In,this._localOptions={}}config(e={}){e=Cn(this._localOptions,e);const t=this._options.resolve(e);return this._localOptions=e,this._resolvedOptions=t,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})})}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:e,resolvedOptions:t}=this,{version:s}=e;u(e,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||t.debug)&&e.plugins.use("std:debug"),t.dry_run&&e.plugins.use("std:dry-run"),t.lorem&&await e.plugins.install("std:lorem")}_renderRootContent(){const{element:e,resolvedOptions:t}=this,{templates:s={}}=t;e.innerHTML=s.root(t),this._elements=new Nn(e,t)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:e,client:t,elements:s,resolvedOptions:i}=this,{wireFollowUps:o,wireRelatedResources:r}=e.ui.defaults.ask,{templates:n={},features:a={},api:c}=i,l=t.ui.ask;c&&t.ui.asks.useApi(c),!1!==a.followUpQuestions&&o(t,s.followUpsSection,{...i,template:n.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&r(t,s.relatedResourcesSection),l.autoQuery()}}class $n extends Y{constructor(e){super("layouts",e,{libName:"layout",keyName:e=>e.type}),this._plugin=e}get(e){return this._libraries[e]}create(e,t){if(!1!==e)switch(typeof e){case"function":return{render:e};case"string":const s=this.get(e);if(!s)throw Error(`Layout of name '${e}' not found.`);return new s(t);default:throw Error("Expect a string, a render function, or boolean value false: "+e)}}}const Pn="trait",Un=Object.freeze([Pn]);class qn extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return Un}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const e of this._traits)this._destroyTrait(e);this._traits=[]}attributeChangedCallback(e){if(e===Pn)this._syncTraits()}_syncTraits(){const e=(this.getAttribute(Pn)||"").split(/\s+/).filter(Boolean),t=[];for(const s of this._traits)e.includes(s.constructor.traitName)?t.push(s):this._destroyTrait(s);if(e.length>0){const s=function(e){const t=e.ui&&e.ui.traits||{};return Object.values(t).reduce((e,t)=>(e[t.traitName]=t,e),{})}(qn.MisoClient);for(const i of e){if(this._traits.find(e=>e.constructor.traitName===i))continue;const e=s[i];if(!e){console.warn("Unknown trait: "+i);continue}const o=new e(this);t.push(o)}}this._traits=t}_destroyTrait(e){try{e._destroy&&e._destroy()}catch(e){console.error(e)}}}let jn,zn,Dn;async function Mn(e){const t=await async function(e){return e.MisoClient||window.MisoClient||jn||(jn=async function(){return new Promise(e=>{(window.misocmd||(window.misocmd=[])).push(()=>e(window.MisoClient))})}())}(e);var s;return zn=zn||t.any(),Dn=Dn||await zn,Dn.ui||await(s=0,new Promise(e=>setTimeout(e,s))),Dn}const Fn="logo",Bn="auto",Qn=Object.freeze([...qn.observedAttributes,Fn]);function Gn(e){if(!e)return Bn;switch(e){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${e}.`)}}class Hn extends qn{static get observedAttributes(){return Qn}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get role(){return it.CONTAINER}get workflow(){return this._workflow}set workflow(e){this._setWorkflow(e)}get logo(){return Gn(this.getAttribute(Fn))}set logo(e){if(this.logo===e)return;const t=function(e){switch(e){case Bn:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${e}.`)}}(e);t?this.setAttribute(Fn,t):this.removeAttribute(Fn)}async connectedCallback(){super.connectedCallback();const e=this._client=await Mn(Hn);document.body.contains(this)&&(this._setWorkflow(this._getWorkflow(e)),this._onConnected(e))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_onConnected(e){}_getWorkflow(e){throw Error("Unimplemented")}_setWorkflow(e){this._workflow!==e&&(this._workflow&&this._workflow._views.removeContainer(this),e&&e._views.addContainer(this),this._workflow=e)}attributeChangedCallback(e,t,s){if(e===Fn)this._handleLogoUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleLogoUpdate(e,t){Gn(e)!==Gn(t)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(e){this._components.has(e)||(this._components.add(e),this._workflow&&this._workflow._views.addComponent(e))}_removeComponent(e){this._components.has(e)&&(this._workflow&&this._workflow._views.removeComponent(e),this._components.delete(e))}_updateComponentRole(e,t,s){this._workflow&&this._workflow._views.updateComponentRole(e,t,s)}}const Wn="workflow",Vn="parent-question-id",Kn=Object.freeze([...Hn.observedAttributes,Wn,Vn]);const Yn="unit-id",Zn=Object.freeze([...Hn.observedAttributes,Yn]);class Jn extends Hn{static get observedAttributes(){return Zn}_getWorkflow(e){return this._getWorkflowByUnitId(e,this.unitId)}_getWorkflowByUnitId(e,t){throw Error("Not implemented")}get unitId(){return this.getAttribute(Yn)||void 0}set unitId(e){(e=e&&""+e)?this.setAttribute(Yn,e):this.removeAttribute(Yn)}attributeChangedCallback(e,t,s){if(e===Yn)this._handleUnitIdUpdate(t,s);else super.attributeChangedCallback(e,t,s)}_handleUnitIdUpdate(e,t){e!==t&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,t))}}var Xn=Object.freeze({__proto__:null,MisoAskElement:class extends Hn{static get tagName(){return"miso-ask"}static get observedAttributes(){return Kn}_getWorkflow(e){return this.boundToActiveWorkflow?e.ui.asks.active:this._getWorkflowByParentQuestionId(e,this.parentQuestionId)}_getWorkflowByParentQuestionId(e,t){return e.ui.asks.getByParentQuestionId(t,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Vn)||void 0}set parentQuestionId(e){(e=void 0!==e?""+e:void 0)!==this.parentQuestionId&&(e?this.setAttribute(Vn,e):this.removeAttribute(Vn))}get boundToActiveWorkflow(){return"active"===this.getAttribute(Wn)}_setWorkflow(e){this._workflow!==e&&(super._setWorkflow(e),e&&(this.parentQuestionId=e.parentQuestionId))}async connectedCallback(){if(await super.connectedCallback(),document.body.contains(this)){this._unsubscribes=[...this._unsubscribes||[],this._client.ui.asks.on("active",e=>{this.boundToActiveWorkflow&&(this.workflow=e.workflow)})]}}disconnectedCallback(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],super.disconnectedCallback()}attributeChangedCallback(e,t,s){switch(e){case Vn:this._handleParentQuestionIdUpdate(t,s);break;case Wn:this._handleQuestionUpdate(t,s);break;default:super.attributeChangedCallback(e,t,s)}}_handleQuestionUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&t===ATTR_VALUE_ACTIVE&&this._setWorkflow(this._getWorkflow(this._client))}_handleParentQuestionIdUpdate(e,t){(e=e||void 0)!==(t=t||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,t))}},MisoExploreElement:class extends Jn{static get tagName(){return"miso-explore"}static get observedAttributes(){return Jn.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.explores.get(t)}},MisoHybridSearchElement:class extends Hn{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Hn.observedAttributes}_getWorkflow(e){return e.ui.hybridSearch}},MisoSearchElement:class extends Hn{static get tagName(){return"miso-search"}static get observedAttributes(){return Hn.observedAttributes}_getWorkflow(e){return e.ui.search}},MisoRecommendationElement:class extends Jn{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return Jn.observedAttributes}_getWorkflowByUnitId(e,t){return e.ui.recommendations.get(t)}}});const ea="role",ta=Object.freeze([ea]);class sa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return ta}constructor({role:e}={}){super(),e&&Object.defineProperty(this,"_role",{value:e,writable:!1})}get role(){return this._role}connectedCallback(){const e=function(e){for(let t=e;t;t=t.parentNode)if(t.isContainer)return t;throw Error(e.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==e&&this._container._removeComponent(this),this._syncRole(),e._addComponent(this),this._container=e,this._containerResolution&&this._containerResolution.resolve(e)}_syncRole(){const e=this.getAttribute(ea);if(e)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${ea}="${e}"' is ignored.`):this._role=e;else if(!this._role)throw Error(`An attribute '${ea}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(e,t,s){t!==s&&e===ea&&this._container&&this._container._updateComponentRole(this,t,s)}}var ia=Object.freeze({__proto__:null,MisoComponentElement:sa,MisoQueryElement:class extends sa{constructor(){super({role:it.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends sa{constructor(){super({role:it.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends sa{constructor(){super({role:it.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends sa{constructor(){super({role:it.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends sa{constructor(){super({role:it.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends sa{constructor(){super({role:it.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends sa{constructor(){super({role:it.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends sa{constructor(){super({role:it.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends sa{constructor(){super({role:it.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends sa{constructor(){super({role:it.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends sa{constructor(){super({role:it.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends sa{constructor(){super({role:it.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends sa{constructor(){super({role:it.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends sa{constructor(){super({role:it.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends sa{constructor(){super({role:it.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends sa{constructor(){super({role:it.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends sa{constructor(){super({role:it.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends sa{constructor(){super({role:it.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends sa{constructor(){super({role:it.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends sa{constructor(){super({role:it.ERROR})}static get tagName(){return"miso-error"}}});class oa extends qn{static get observedAttributes(){return qn.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(e){this._setContext(e)}async connectedCallback(){super.connectedCallback();const e=this._client=await Mn(oa);document.body.contains(this)&&this._setContext(this._getContext(e))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(e){throw Error("Unimplemented")}_setContext(e){if(this._context===e)return;const t=this._context;this._context=e,this._onContext(e,t)}_onContext(){}}var ra=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends oa{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return oa.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(e){return e.ui.asks}_onContext(e,t){e!==t&&(this._unwire(),this._wire(e))}_unwire(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[]}_wire(e){e&&(e._autoNextFn||e.autoNext(),this._unsubscribes.push(e.on("create",e=>{const{parentQuestionId:t}=e,s=e._options.resolved.templates.followUp;if(!t||!s)return;const i=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:t}));const o=this.children.length;for(const t of Array.prototype.slice.call(this.children,i,o))this._elementToWorkflow.set(t,e)})),this._unsubscribes.push(e.on("loading",({workflow:e})=>{for(const t of this.children)if(this._elementToWorkflow.get(t)===e){t.scrollIntoView({behavior:"smooth",block:"start"});break}})),this._unsubscribes.push(e.on("destroy",({workflow:e})=>{for(const t of this.children)this._elementToWorkflow.get(t)===e&&(this._elementToWorkflow.delete(t),t.remove())})))}}});class na extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(na.MisoClient))}disconnectedCallback(){}_getCombo(e){throw Error("Unimplemented")}_setCombo(e){this._combo!==e&&(this._combo=e,e.element=this,e.autoStart())}}var aa=Object.freeze({__proto__:null,containers:Xn,roles:ia,contexts:ra,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends na{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(e){return e.ui.combo.ask}}}),MisoBannerElement:Hs,MisoStubElement:qn});const ca="miso-hybrid-search-combo";var la=Object.freeze({__proto__:null,CLASS_PREFIX:ca,CONAINER_TAG:"miso-hybrid-search"});const ua="Show more",ha="Show less";var da=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:ua,showLess:ha});const _a=j(new cr({...la,DEFAULT_PHRASES:da})),ma=j(new class extends ar{constructor(){super({helpers:_a})}answer(e){const{container:t}=this._helpers;return t(e,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(e),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box"]},[t("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(e)),this.answerBoxToggle(e)])}question(e){const{phrase:t}=this._helpers;return t(e,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__answer-box-toggle-container"]},[t("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(e){const{container:t}=this._helpers;return t(e,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(e),this.searchResultsFilters(e),"<miso-products></miso-products>",this.more(e)])}searchResultsInfoGroup(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-info"]},[this.keywords(e),this.total(e)])}searchResultsFilters(e){const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(e){const{phrase:t}=this._helpers;return t(e,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(e){const{phrase:t}=this._helpers;return t(e,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(e){if(!e.moreButton)return"";const{element:t}=this._helpers,{classPrefix:s}=e;return t("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:_a}));var pa=Object.freeze({__proto__:null,helpers:_a,sections:ma,root:function(e={}){const{normalizeOptions:t,section:s,container:i}=_a;e=t(e);const{answerBox:o,answerGroup:r,searchResultsGroup:n}=ma,{answerBox:a=!1}=e;return""+s(e,{name:"question"},[i(e,{name:"query"},"<miso-query></miso-query>")])+s(e,{name:"answer"},a?[o(e)]:r(e))+s(e,{name:"search-results"},n(e))}});const fa="answer-box-open",ba="answer-box-shown",ga='[data-role="answer-box-toggle"]';class ya{constructor(e,t,{classPrefix:s=ca,phrases:i={},hideWhenUnanswerable:o=!0}={}){this._client=e,this._workflow=e.ui.hybridSearch,this._element=t,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=o,this._init()}_init(){const e=this._element,t=this._workflow;t.answerBox=this,t._unsubscribes.push(()=>{t.answerBox===this&&(this.destroy(),t.answerBox=void 0)});const s=e=>this._handleClick(e);e.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>e.removeEventListener("click",s),t._answer._hub.on("data",()=>this._syncWofkflowStatus())]}_handleClick({target:e,button:t}){0===t&&e.closest(ga)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:e}=this._workflow._answer,{meta:{unanswerable:t=!1}={}}=this._workflow._answer._hub.states.data;switch(e){case dt.ERRONEOUS:case dt.READY:t&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(e,t){this._element.classList[e](`${this._classPrefix}__${t}`)}_syncButtonText(){const e=this.isOpen?this._phrases.showLess||ha:this._phrases.showMore||ua;for(const t of this._element.querySelectorAll(ga))t.textContent=e}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const e of this._unsubscribes)e();const e=this._workflow;e&&e.answerBox===this&&delete e.answerBox}}const va={isOpen:fa,shown:ba},wa={toggleOpen:["toggle",fa],open:["add",fa],close:["remove",fa],toggleHidden:["toggle",ba],show:["add",ba],hide:["remove",ba]};for(const[e,t]of Object.entries(va))Object.defineProperty(ya.prototype,e,{get(){return this._element.classList.contains(`${this._classPrefix}__${t}`)}});for(const[e,[t,s]]of Object.entries(wa))ya.prototype[e]=function(){this._updateBoxStatus(t,s),s===fa&&(this._syncButtonText(),this._syncScroll())};const xa=Object.freeze(la),Ea=Object.freeze(da),ka=Object.freeze(pa);var Sa=Object.freeze({__proto__:null,constants:xa,phrases:Ea,templates:ka,wireAnswerBox:function(e,t,s={}){if(!e)throw Error("client is required");t&&new ya(e,t,s)}});const Oa=Object.freeze(En),Ia=Object.freeze(Sa);var Ca=Object.freeze({__proto__:null,ask:Oa,hybridSearch:Ia});function Aa(e){const t=e._element;if(!t)return()=>{};const s=t=>e._handleClick(t);return t.addEventListener("click",s),()=>t.removeEventListener("click",s)}const Ta="miso-collapsible",Ra="expanded",Na=[{action:"expand",classAction:"add",className:Ra},{action:"collapse",classAction:"remove",className:Ra}];class La{static get traitName(){return"collapsible"}constructor(e){this._element=e,e.collapsible=this,e.classList.add(Ta),this._unsubscribes=[Aa(this)]}_destroy(){for(const e of this._unsubscribes||[])e();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(Ta),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(e,t){for(const s of t)Object.defineProperty(e,s,{get(){return this._element&&this._element.classList.contains(s)}})}(La.prototype,[Ra]),function(e,t){for(const{action:s,classAction:i,className:o}of t)e[s]=function(){this._element&&this._element.classList[i](o),this["_"+s]&&this["_"+s]()}}(La.prototype,Na),function(e,t){e._handleClick=function(e){const{target:s,button:i}=e;if(0===i)for(let{role:i,selector:o,action:r}of t)if(o=o||`[data-role="${i}"]`,o&&s.closest(o))return this[r](),void e.stopPropagation()}}(La.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var $a=Object.freeze({__proto__:null,CollapsibleTrait:La});let Pa,Ua;async function qa(){return Ua||(Ua=R(Pa||(Pa=N("ui"))))}class ja{constructor(e,t){this._plugin=e,this._client=t,this._contexts={}}async require(e){if(this._contexts[e])return this._contexts[e];const t=await this._plugin.requireExtension(e);return this._contexts[e]=t.getContext(this._client)}}class za{constructor(e,t){this._plugin=e,this._client=t,u(this,{sources:{api:ys(t)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new tn(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Vr(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Da{constructor(e,t){this._plugin=e,this._MisoClient=t}get ask(){return this._ask||(this._ask=new Ln(this._plugin,this._MisoClient))}}Ne.plugins.use(class extends K{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new $n(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new I}async install(e,t){t.addSubtree(this),e.on("create",this._injectClient.bind(this));const s={defaults:Ca,traits:$a};l(s,this,["layouts","combo","ready"]),u(this,{MisoClient:e}),u(e,{ui:s}),this.combo=new Da(this,e);const i=Object.values(Ro).filter(e=>e.type);for(const t of i)t.MisoClient=e;for(const e of i)this.layouts.register(e);const{containers:o,roles:r,combos:n,contexts:a,...c}=aa,h=[...Object.values(n),...Object.values(a),...Object.values(o),...Object.values(r),...Object.values(c)],d=[Hn,oa,na];for(const t of[...d,...h])t.MisoClient=e;await qa();for(const e of h)g(e);this._ready.resolve()}async requireExtension(e){if("markdown"===e)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+e)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then(()=>{})}_injectClient(e){u(e,{ui:new za(this,e)})}_getExtensions(e){if(this._extensions.has(e))return this._extensions.get(e);const t=new ja(this,e);return this._extensions.set(e,t),t}_getRecommendations(e){let t=this._recommendations.get(e);return t||this._recommendations.set(e,t=new hn(this,e)),t}_getExplores(e){let t=this._explores.get(e);return t||this._explores.set(e,t=new gn(this,e)),t}_getAsks(e){let t=this._asks.get(e);return t||this._asks.set(e,t=new wr(this,e)),t}}),Ne.attach(),function(e){const t=[];function s(e){t.push(e)}A("misodev",{transform:e=>()=>e({addCmdTransform:s})});const i=e=>{for(const s of t)e=s(e);return e};setTimeout(()=>{A("misocmd",{transform:i}),e&&e()})}(function(){Ce._cmdRes.resolve()});const{GROUP:Ma,NAME:Fa}=o;class Ba extends K{static get id(){return"anonymous-id-keep"}constructor(){super("anonymous-id-keep")}install(e,t){t.addPayloadPass(this._modifyPayload.bind(this))}_modifyPayload({client:e,apiGroup:t,apiName:s,payload:i}){const{user_id:o,anonymous_id:r}=e.context;return o&&r?t!==Ma.ASK||s!==Fa.SEARCH||i.anonymous_id?i:{...i,anonymous_id:r}:i}}const Qa="/search",Ga={key:"bondbuyer",shortName:"bb",name:"Bond Buyer",hostname:"www.bondbuyer.com",logo:"bondbuyer.svg",apiKey:"kkNW4eaywCOd3jbfc3Z13k9ltdKRyxS08A2LAwUg",trendingTopics:["Public Finance","Politics and Policy","Regulation and Compliance","Tax","Technology","Career moves"],popularQuestions:["What are the biggest challenges for infrastructure and its financing?","How will interest rate changes affect the municipal market?","Are P3 deals getting more use and what hurdles do they face?","What were the biggest muni deals of 2025?","What are the major impacts of climate change that issuers need to worry about?","Will cryptocurrency products be welcomed in the muni market?"]},Ha=window.location.hostname===Ga.hostname,{currentScript:Wa}=document,Va=Wa.src.replace(/\/[^/]*$/,""),Ka=`Powered by ${Ga.name} AI Answers`,Ya=Ga.name+"'s AI Answers is the <b><i>only</i></b> generative AI search tool with access to more than 10 years of trusted content produced by our award-winning journalists and expert contributors.",Za="Search by topic, interests, or ask a question...",Ja="Ask a question...",Xa="Already have an account?",ec="To access this AI Answer,<br>create your guest account.",tc="Your complimentary guest account also includes access to a limited number of articles.",sc="Want unlimited access?",ic=`Unlock this AI Answer and get<br>unlimited access to ${Ga.name}.`,oc=["Unmatched news and analysis","Original research reports","Exclusive data programs","On-demand thought leadership","AI answers trained on our complete archive"],rc="Log in",nc="Sign up",ac="Subscribe Now",cc="Subscribe Now",lc=`This answer was based on the following ${Ga.name} articles:`,uc="miso-arizent-icon",hc=uc+"-svg",dc="ai-search",_c="close-x",mc="trending",pc="checkmark",fc=`<svg id="${hc}" style="display:none;">${[`<symbol id="${uc}-${dc}" viewBox="0 0 24 24"><path d="M16.6 22L10.3 15.7C9.8 16.1 9.225 16.4167 8.575 16.65C7.925 16.8833 7.23333 17 6.5 17C4.68333 17 3.14583 16.3708 1.8875 15.1125C0.629167 13.8542 0 12.3167 0 10.5C0 8.68333 0.629167 7.14583 1.8875 5.8875C3.14583 4.62917 4.68333 4 6.5 4C8.31667 4 9.85417 4.62917 11.1125 5.8875C12.3708 7.14583 13 8.68333 13 10.5C13 11.2333 12.8833 11.925 12.65 12.575C12.4167 13.225 12.1 13.8 11.7 14.3L18 20.6L16.6 22ZM6.5 15C7.75 15 8.8125 14.5625 9.6875 13.6875C10.5625 12.8125 11 11.75 11 10.5C11 9.25 10.5625 8.1875 9.6875 7.3125C8.8125 6.4375 7.75 6 6.5 6C5.25 6 4.1875 6.4375 3.3125 7.3125C2.4375 8.1875 2 9.25 2 10.5C2 11.75 2.4375 12.8125 3.3125 13.6875C4.1875 14.5625 5.25 15 6.5 15Z" fill="currentColor"/><path d="M21.5 15L22.2833 13.2833L24 12.5L22.2833 11.7167L21.5 10L20.7167 11.7167L19 12.5L20.7167 13.2833L21.5 15Z" fill="currentColor"/><path d="M17.5 9L18.91 5.91L22 4.5L18.91 3.09L17.5 0L16.09 3.09L13 4.5L16.09 5.91L17.5 9Z" fill="currentColor"/></symbol>`,`<symbol id="${uc}-${_c}" viewBox="0 0 14 14"><path fill-rule="nonzero" fill="currentColor" d="M6.336 7L0 .664.664 0 7 6.336 13.336 0 14 .664 7.664 7 14 13.336l-.664.664L7 7.664.664 14 0 13.336 6.336 7z"/></symbol>`,`<symbol id="${uc}-${mc}" viewBox="0 0 24 24"><path d="M3.4 18L2 16.6L9.4 9.15L13.4 13.15L18.6 8H16V6H22V12H20V9.4L13.4 16L9.4 12L3.4 18Z" fill="currentColor"/></symbol>`,`<symbol id="${uc}-${pc}" viewBox="0 0 15 11"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2506 0.342773L4.8237 8.24727L1.47985 5.11777L0.365234 6.16277L4.81293 10.3428L14.3652 1.38777L13.2506 0.342773Z" fill="currentColor" stroke="currentColor" stroke-width="0.5"/></symbol>`].join("")}</svg>`;let bc=!1;function gc(e){return`<svg class="miso-arizent-icon miso-arizent-icon-${e}"><use href="#${uc}-${e}"></use></svg>`}bc||document.head.querySelector("#"+hc)||(bc=!0,document.head.insertAdjacentHTML("beforeend",fc));const yc=gc(dc),vc=gc(_c),wc=gc(mc),xc=gc(pc),Ec=`${Va}/${Ga.logo}`,kc=`<div class="miso-powered-by"><span class="miso-powered-by__icon"></span><span class="miso-powered-by__text">${Ka}</span></div>`,Sc=`\n<div class="miso-page-header-search">\n  <button class="miso-page-header-search-button miso-icon-button">\n    <span class="sr-only">Show Search</span>\n    <span class="miso-page-header-search-button__icon">\n      ${yc}\n      ${vc}\n    </span>\n  </button>\n</div>\n`,Oc=`\n<form class="miso-page-header-search-form" action="/search#nt=navsearch" novalidate="" autocomplete="off">\n  <label>\n    <input placeholder="${Za}" type="text" class="miso-page-header-search-input" name="q" required="required">\n    <span class="sr-only">Search Query</span>\n    <button type="submit" class="miso-page-header-search-submit">\n      ${yc}\n      <span class="sr-only">Submit Search</span>\n    </button>\n  </label>\n</form>\n`,Ic=`\n<div class="miso-page-header-search-overlay__columns">\n  <div class="miso-page-header-search-overlay__trending-topics">\n    <hr>\n    <h2>Trending Topics</h2>\n    <ul>\n      ${Ga.trendingTopics.map(function(e){return`<li><a href="${Qa}?q=${encodeURIComponent(e)}">${wc}<span>${e}</span></a></li>`}).join("")}\n    </ul>\n  </div>\n  <div class="miso-page-header-search-overlay__popular-questions">\n    <hr>\n    <h2>Popular Questions</h2>\n    <ul>\n      ${Ga.popularQuestions.map(function(e){return`<li><a href="${Qa}?q=${encodeURIComponent(e)}">${e}</a></li>`}).join("")}\n    </ul>\n  </div>\n  <div class="miso-page-header-search-overlay__upcoming-event">\n    \x3c!--\n    <hr>\n    <h2>Upcoming Event</h2>\n    --\x3e\n  </div>\n</div>\n`,Cc=`\n<div class="miso-page-header-search-overlay">\n  <h2>Find Answers</h2>\n  ${Oc.trim()}\n  <div>\n    ${kc}\n  </div>\n  ${Ic.trim()}\n</div>\n`;const Ac=`<img class="miso-hybrid-search-combo__gate-logo" alt="${Ga.name}" loading="lazy" src="${Ec}">`;function Tc(e){return`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n  <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" logo="false">\n    ${Rc}\n    <miso-answer></miso-answer>\n    <div class="miso-hybrid-search-combo__feedback-container">\n      <miso-feedback></miso-feedback>\n      <a class="miso-hybrid-search-combo__feedback-link" href="/about-ai-answers#formstack" target="_blank">\n        <span>PROVIDE FEEDBACK</span>\n        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M630-444H228.05q-15.32 0-25.69-10.29Q192-464.58 192-479.79t10.36-25.71q10.37-10.5 25.69-10.5H630l-80-80q-11-11-11-25.5t10.52-25.5q11.48-11 25.98-11t25.5 11l142.33 142.33Q748-500 750.5-493.7q2.5 6.3 2.5 13.5t-2.5 13.5q-2.5 6.3-7.5 11.7L601-313q-11 11-25 10.5T550.52-314Q540-325 540-339.5t11-25.5l79-79Z"/></svg>\n      </a>\n    </div>\n    ${function(e){return`\n<div class="miso-hybrid-search-combo__sign-up-gate">\n  <div class="miso-hybrid-search-combo__sign-up-gate-login-hint">\n    ${Xa}\n    <a class="miso-hybrid-search-combo__sign-up-gate-login-link" data-role="login" ${Dc(e.loginPagePath)}>${rc}</a>\n  </div>\n  ${Ac}\n  <p class="miso-hybrid-search-combo__sign-up-gate-sign-up-phrase">${ec}</p>\n  <p class="miso-hybrid-search-combo__sign-up-gate-sign-up-note">${tc}</p>\n  <button class="miso-hybrid-search-combo__sign-up-gate-sign-up-button miso-primary-button" data-role="sign-up" ${Dc(e.signUpPagePath)}>${nc}</button>\n  <div class="miso-hybrid-search-combo__sign-up-gate-or-separator"><span>or</span></div>\n  <div class="miso-hybrid-search-combo__sign-up-gate-subscribe-hint">\n    ${sc}\n    <a class="miso-hybrid-search-combo__sign-up-gate-subscribe-link" data-role="subscribe" ${Dc(e.subscribePagePath)}>${ac}</a>\n  </div>\n</div>`.trim()}(e)}\n    ${function(e){return`\n<div class="miso-hybrid-search-combo__subscribe-gate">\n  ${Ac}\n  <p class="miso-hybrid-search-combo__subscribe-gate-subscribe-phrase">${ic}</p>\n  <ul class="miso-hybrid-search-combo__subscribe-gate-bullet-points">\n    ${oc.map(e=>`<li>${xc}${e}</li>`).join("")}\n  </ul>\n  <a class="miso-hybrid-search-combo__subscribe-gate-subscribe-button miso-primary-button" data-role="subscribe" ${Dc(e.subscribePagePath)}>${cc}</a>\n</div>`.trim()}(e)}\n  </miso-hybrid-search>\n</section>`.trim()}const Rc='\n<div class="miso-hybrid-search-combo__answer-skeleton">\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-line"></div>\n  <div class="miso-hybrid-search-combo__answer-skeleton-half-line"></div>\n</div>\n';function Nc(e={}){const{userId:t,userState:s}=e;return`\n<div id="miso-hybrid-search-combo" class="miso-hybrid-search-combo ${t?"subscribed"===s?"subscriber":"registered":"anonymous"}">\n  <div class="miso-hybrid-search-combo__grid">\n    <div class="miso-hybrid-search-combo__grid-query">${`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  <miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n    <miso-query>\n      <div class="miso-search-box" data-role="query">\n        <div class="miso-search-box__input-group">\n          <input class="miso-search-box__input" type="text" data-role="input">\n          <button class="miso-search-box__button" type="submit" data-role="submit">\n            ${yc}\n          </button>\n        </div>\n        <div class="miso-autocomplete" data-role="autocomplete">\n          <ul class="miso-autocomplete__query-list" data-role="query-list"></ul>\n          <ul class="miso-autocomplete__product-list" data-role="product-list"></ul>\n        </div>\n      </div>\n    </miso-query>\n    <div class="miso-hybrid-search-combo__disclaimer">\n      <div class="miso-hybrid-search-combo__disclaimer-icon">\n        <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M7.22228 0L9.17295 5.27167L14.4446 7.22237L9.17295 9.17306L7.22228 14.4447L5.27161 9.17306L0 7.22237L5.27161 5.27167L7.22228 0Z" fill="#1969A0"/>\n          <path d="M16.1116 11.1113L17.1619 13.9499L20.0005 15.0003L17.1619 16.0507L16.1116 18.8892L15.0612 16.0507L12.2227 15.0003L15.0612 13.9499L16.1116 11.1113Z" fill="#1969A0"/>\n        </svg>\n      </div>\n      <div class="miso-hybrid-search-combo__disclaimer-text">\n        ${kc}\n        <div class="miso-resource-attribution">\n          ${Ya}\n          <a class="miso-hybrid-search-combo__learn-more-link" href="/about-ai-answers" target="_blank">\n            <span>LEARN MORE</span>\n            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M630-444H228.05q-15.32 0-25.69-10.29Q192-464.58 192-479.79t10.36-25.71q10.37-10.5 25.69-10.5H630l-80-80q-11-11-11-25.5t10.52-25.5q11.48-11 25.98-11t25.5 11l142.33 142.33Q748-500 750.5-493.7q2.5 6.3 2.5 13.5t-2.5 13.5q-2.5 6.3-7.5 11.7L601-313q-11 11-25 10.5T550.52-314Q540-325 540-339.5t11-25.5l79-79Z"/></svg>\n          </a>\n        </div>\n      </div>\n    </div>\n  </miso-hybrid-search>\n</section>`.trim()}</div>\n    <div class="miso-hybrid-search-combo__grid-answer">${Tc(e)}</div>\n    <div class="miso-hybrid-search-combo__grid-sources">${`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__sources">\n  <miso-hybrid-search class="miso-hybrid-search-combo__sources-container" visible-when="nonempty" logo="false">\n    <div class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">${lc}</div>\n    <miso-sources></miso-sources>\n  </miso-hybrid-search>\n</section>`.trim()}</div>\n    <div class="miso-hybrid-search-combo__grid-results"><section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__results-container miso-circled-citation-index" logo="false">\n    <div class="miso-hybrid-search-combo__results-header">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase">\n        <miso-total></miso-total> Matching Results for Your Search\n      </div>\n      <div class="miso-hybrid-search-combo__search-results-filters">\n        <miso-sort></miso-sort>\n      </div>\n    </div>\n    <miso-products></miso-products>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__results-more-container miso-circled-citation-index" visible-when="ready" logo="false">\n    <div class="miso-hybrid-search-combo__results-more-container__inner">\n      <miso-more></miso-more>\n    </div>\n  </miso-hybrid-search>\n</section></div>\n  </div>\n</div>\n`.trim()}function Lc(e,t,s){return e.templates.article(e,t,Mc(s))}function $c(e,t,s){s=Mc(s);const{templates:{helpers:i}}=e,{url:o,...r}=s,[n,a]=i.tagPair(e,r);return[n,Pc(e,s),Uc(e,s),a].join("")}function Pc(e,t){const{className:s,templates:{descriptionBlock:i,dateBlock:o}}=e;return`<div class="${s}__item-info-container">${[qc(e,t),jc(e,t),i(e,t),zc(e,t),o(e,t)].join("")}</div>`}function Uc(e,t){const{className:s}=e,{cover_image:i,url:o}=t;if(!i)return"";const r=`<img class="${s}__item-cover-image" src="${i}">`;return o?`<a class="${s}__item-cover-image-container" href="${o}">${r}</a>`:`<div class="${s}__item-cover-image-container">${r}</div>`}function qc({className:e},{tags:t=[]}){const s=t[0];return s?`<a class="${e}__item-section" href="${i=s,"/"+i.toLowerCase().replace(" ","-")}">${s}</a>`:"";var i}function jc({className:e,templates:{helpers:t}},{title:s,_title_with_markups:i,url:o}){const r=t.formatHtmlWithMarkup(i)||t.escapeHtml(s);return r?o?`<a class="${e}__item-title" href="${o}">${r}</a>`:`<div class="${e}__item-title">${r}</div>`:""}function zc(e,{authors:t=[]}){const s=t[0];return s?`<div class="${e.className}__item-author-phrase">By <a href="${function(e){return"/author/"+e.toLowerCase().replace(" ","-")}(s)}" class="${e.className}__item-author">${s}</a></div>`:""}function Dc(e){return e?`href="${e}"`:""}function Mc(e){return Ha?e:function(e){if(!e.url||!e.url.startsWith(`https://${Ga.hostname}/`))return e;return{...e,url:e.url.replace(`https://${Ga.hostname}/`,"/")}}(e)}const Fc=".Page-header",Bc=".Page-header-bottom-bar",Qc=".Page-header-buttons",Gc=".Page-header-search-overlay",Hc=".miso-page-header-search-input";async function Wc(e,t){!function(){const e=document.querySelector(Qc);if(!e)return void console.error("Page header buttons not found: "+Qc);e.insertAdjacentHTML("beforeend",Sc.trim());const t=document.querySelector(".miso-page-header-search");if(!t)return void console.error("Miso page header search button not found: .miso-page-header-search");t.addEventListener("click",()=>{!function(e,t,s){e.getAttribute(t)===s?e.removeAttribute(t):e.setAttribute(t,s)}(document.body,"data-toggle-header","miso-search-overlay")})}(),function(){const e=document.querySelector(Fc);if(!e)return void console.error("Page header not found: "+Fc);const t=document.querySelector(Gc);if(t)return void t.insertAdjacentHTML("afterend",Cc.trim());const s=document.querySelector(Bc);if(s)return void s.insertAdjacentHTML("beforebegin",Cc.trim());e.insertAdjacentHTML("beforeend",Cc.trim())}(),function(){const e=document.querySelector(Hc);if(!e)return;const t=window.matchMedia("(max-width: 768px)");function s(t){e.placeholder=t.matches?Ja:Za}s(t),t.addEventListener&&t.addEventListener("change",s)}()}const Vc=".SearchResultsPage-content",Kc=".miso-hybrid-search-combo__answer-container",Yc="miso-hybrid-search-combo__answer-container--skeleton",Zc=["cover_image","url","created_at","updated_at","published_at","authors","tags","type","custom_attributes"];async function Jc(e,t){const[s,i]=await Promise.all([Xc(t.userId),Xc(t.userState),e.ui.ready]);t={...t,userId:s,userState:i},s&&(e.context.user_id=s,e.context.user_type="subscribed"===i?"subscriber":"registered");const o=document.querySelector(Vc);if(!o)return void console.error("Search page root element not found: "+Vc);o.innerHTML=Nc(t),function(e,t){e.addEventListener("click",({target:e,button:s})=>{if(0!==s)return;const i=e.closest("[data-role]");if(i)switch(i.dataset.role){case"login":el(t.onLoginClick);break;case"sign-up":el(t.onSignUpClick);break;case"subscribe":el(t.onSubscribeClick)}})}(o,t);const r=e.ui.hybridSearch;r.useApi({fl:Zc}),r.useLayouts({products:{templates:{product:$c,article:Lc},infiniteScroll:!1},more:{templates:{text:()=>"LOAD MORE"}}}),r.answer.on("request",()=>{tl()}),r.answer.on("data",({value:e={}}={})=>{const{blocked_reason:t}=e;"metering"===t&&sl()}),r.answer.on("answer-stage",({answer_stage:e})=>{"Generating summary"===e&&sl()}),r.answer.on("done",()=>{sl()}),r.on("request",()=>{const e=document.querySelector("miso-more");e&&(e.style.display="none"),r.answer._hub.update("feedback",{unselected:!0},{silent:!0});const t=document.querySelector("miso-feedback .miso-feedback");t&&t.removeAttribute("data-selected")}),r.on("done",({empty:e})=>{if(!e){const e=document.querySelector("miso-more");e&&(e.style.display="block")}}),r.autoQuery();const n=new URLSearchParams(window.location.search).get("q");n&&il(".miso-search-box__input",3e3).then(e=>{e.value||(e.value=n)})}async function Xc(e){return"function"==typeof e?e():e}function el(e){"function"==typeof e&&e()}const tl=()=>{const e=document.querySelector(Kc);e&&!e.classList.contains(Yc)&&e.classList.add(Yc)},sl=()=>{const e=document.querySelector(Kc);e&&e.classList.contains(Yc)&&e.classList.remove(Yc)},il=(e,t=3e3)=>new Promise((s,i)=>{const o=document.querySelector(e);if(o)return s(o);const r=new MutationObserver(()=>{const t=document.querySelector(e);t&&(r.disconnect(),s(t))});r.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{r.disconnect(),i()},t)}),ol=e=>new Promise(t=>{tp.push(["init",async()=>{if(!window.tp?.pianoId?.isUserValid())return void t("anonymous");const s={ab:["RX81QLC","RQQQ4JX","RKY7DIO","R88GAOE"],bb:["RLZY42H","RTS8B33","RPPDJ37"]},i=s[e]||s.ab,o=await(r=i,new Promise(e=>{if(!window.tp||!window.tp.api)return void e(!1);let t=0,s=!1;r.forEach(i=>{window.tp.api.callApi("/access/check",{rid:i},i=>{t++,i?.access?.granted&&(s=!0),t===r.length&&e(s)})})}));var r;t(o?"subscribed":"registered")}])}),rl={apiKey:Ga.apiKey,searchPagePath:Qa,subscribePagePath:"/subscribe",userId:()=>new Promise(e=>{tp.push(["init",()=>{if(window.tp?.pianoId?.isUserValid()){const t=window.tp.pianoId.getUser();e(t?.id||t?.uid||null)}else e(null)}])}),userState:()=>ol(Ga.shortName),onLoginClick:()=>window.tp&&window.tp.pianoId.show({screen:"login"}),onSignUpClick:()=>window.tp&&window.tp.pianoId.show({screen:"register"})};function nl(e){return(e={...rl,...e}).onLoginClick&&e.loginPagePath&&delete e.loginPagePath,e.onSignUpClick&&e.signUpPagePath&&delete e.signUpPagePath,e.onSubscribeClick&&e.subscribePagePath&&delete e.subscribePagePath,function(e){if("string"!=typeof e.apiKey)throw Error("apiKey is required");if("string"!=typeof e.searchPagePath)throw Error("searchPagePath is required");if("function"!=typeof e.userId&&"string"!=typeof e.userId)throw Error("userId is required to be either a string or a function");if("function"!=typeof e.userState&&"string"!=typeof e.userState)throw Error("userState is required to be either a string or a function");if(e.loginPagePath&&"string"!=typeof e.loginPagePath)throw Error("loginPagePath must be a string");if(e.signUpPagePath&&"string"!=typeof e.signUpPagePath)throw Error("signUpPagePath must be a string");if(e.subscribePagePath&&"string"!=typeof e.subscribePagePath)throw Error("subscribePagePath must be a string");if(e.onLoginClick&&"function"!=typeof e.onLoginClick)throw Error("onLoginClick must be a function");if(e.onSignUpClick&&"function"!=typeof e.onSignUpClick)throw Error("onSignUpClick must be a function");if(e.onSubscribeClick&&"function"!=typeof e.onSubscribeClick)throw Error("onSubscribeClick must be a function");return e}(e)}let al=!1;!function(e,t){const s=window[e]||(window[e]=[]);if(s._processed)return;s._processed=!0;const i=e=>function(e,t){try{e(t)}catch(e){console.error(e)}}(e,t);Object.defineProperty(s,"push",{value:i});for(const e of s)i(e)}("misoapp",{start:function(e){if(al)return void console.warn("misoapp: already started");al=!0,e=nl(e),Ne.plugins.use(Ba);const t=new Ne(e.apiKey),s=window.location.pathname;Wc(),s===e.searchPagePath&&Jc(t,e)},defaultOptions:rl,site:Ga})}();
