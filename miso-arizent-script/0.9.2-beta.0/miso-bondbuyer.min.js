!function(){"use strict";!function(t,e){void 0===e&&(e={});var s=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===s&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}('.miso-horizontal .miso-citation-index:before{content:attr(data-index)}.miso-primary-button{background:var(--buttonBgColor);border:0;border-radius:5px;color:var(--buttonTextColor);cursor:pointer;font-family:var(--bodyFont);font-size:var(--label-4);font-weight:700;justify-content:center;letter-spacing:1px;padding:12px 20px;text-align:center;transition:all .25s linear;width:auto}.miso-icon-button{align-items:center;background:#fff;border:1px solid var(--listBorderColor);border-radius:5px;color:#000;cursor:pointer;display:flex;justify-content:center}.miso-loading{padding:16px!important}.miso-loading:before{height:32px!important}.miso-powered-by{font-size:16px;font-weight:400;line-height:1}.Page-header-buttons{width:auto!important}.Page-header-search,.Page-header-search-overlay{display:none!important}.miso-page-header-search{align-items:center;display:flex}.miso-page-header-search-button{height:40px;width:40px}.miso-page-header-search-button .miso-arizent-icon-ai-search{height:27px;width:27px}.miso-page-header-search-button .miso-arizent-icon-close-x{display:none;height:16px;width:16px}body[data-toggle-header=miso-search-overlay] .miso-page-header-search-button .miso-arizent-icon-ai-search{display:none}body[data-toggle-header=miso-search-overlay] .miso-page-header-search-button .miso-arizent-icon-close-x,body[data-toggle-header=miso-search-overlay] .miso-page-header-search-overlay{display:flex}.miso-page-header-search-overlay{--miso-title-font-family:"Merriweather",Arial,Helvetica,sans-serif;background-color:#fff;border-top:1px solid #e6e6e6;box-shadow:0 2px 4px 0 rgba(0,0,0,.15);display:none;flex-direction:column;font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;gap:20px;padding:20px 16px;position:absolute;width:100%;z-index:25}.miso-page-header-search-overlay h2{font-family:var(--miso-title-font-family);font-size:24px;font-weight:400;letter-spacing:0;line-height:32px}.miso-page-header-search-overlay .miso-page-header-search-form{position:relative}.miso-page-header-search-overlay .miso-page-header-search-input{border:1px solid #3c3c3c;border-radius:5px;color:#121212;font-size:18px;font-style:normal;font-weight:400;height:48px;line-height:20px;padding-left:16px;width:100%}.miso-page-header-search-overlay .miso-page-header-search-submit{background:#3c3c3c;border:1px solid #3c3c3c;border-radius:0 5px 5px 0;color:#fff;cursor:pointer;height:48px;padding:0;position:absolute;right:0;width:48px}.miso-page-header-search-overlay .miso-page-header-search-submit svg{bottom:33px;height:30px;width:25px}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns{display:flex;flex-direction:row;gap:32px}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns>*{flex:1}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns h2{margin:16px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__columns hr{border:none;border-top:1px solid var(--listBorderColor)}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics{flex:1}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics ul{list-style:none}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics li{border:1px solid var(--listBorderColor);border-radius:5px;color:var(--headerTextColor);font-size:14px;font-weight:700;line-height:16px;margin:12px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics a{align-items:center;display:flex;gap:8px;height:40px;justify-content:left;padding:0 8px}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics a:hover{color:#1969a0}.miso-page-header-search-overlay .miso-page-header-search-overlay__trending-topics svg{height:24px;width:24px}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions{flex:2}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions ul{padding-left:1em}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions li{color:var(--headerTextColor);font-family:var(--miso-title-font-family);font-size:14px;font-weight:700;line-height:26px;margin:12px 0}.miso-page-header-search-overlay .miso-page-header-search-overlay__popular-questions a:hover{color:#1969a0}.miso-page-header-search-overlay .miso-page-header-search-overlay__upcoming-event{flex:1;visibility:hidden}@media only screen and (min-width:768px){.miso-page-header-search-overlay{padding:20px 24px!important}}.miso-hybrid-search-combo{--miso-title-font-family:"Merriweather",Arial,Helvetica,sans-serif;--miso-search-box-font-size:24px!important;--miso-list-image-aspect-ratio:3/2!important;--miso-search-box-icon-size:20px!important;--miso-horizontal-item-index-size:24px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{display:grid;gap:30px;grid-template-areas:"query" "answer" "sources" "results";grid-template-columns:1fr;grid-template-rows:auto}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-query{grid-area:query}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-answer{grid-area:answer}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-results{grid-area:results}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid-sources{grid-area:sources}.miso-hybrid-search-combo .miso-hybrid-search-combo__answer-container,.miso-hybrid-search-combo .miso-hybrid-search-combo__query-container,.miso-hybrid-search-combo .miso-hybrid-search-combo__section,.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-container{padding:0!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__question-phrase{font-family:var(--miso-title-font-family)!important;font-size:18px!important}.miso-hybrid-search-combo .miso-search-box__input-group{border:none!important;border-bottom:1px solid #333!important;border-radius:0!important;box-shadow:none!important}.miso-hybrid-search-combo .miso-search-box__input{padding-left:0!important}.miso-hybrid-search-combo .miso-search-box__button{padding:0 10px 0 0!important}.miso-hybrid-search-combo .miso-search-box__button svg{height:30px!important;width:30px!important}.miso-hybrid-search-combo .miso-powered-by{margin-top:20px}.miso-hybrid-search-combo .miso-resource-attribution{color:grey;font-size:14px;font-weight:400;line-height:20px}.miso-hybrid-search-combo [data-role=answer]{font-size:16px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-phrase{font-size:16px!important;font-weight:700!important}.miso-hybrid-search-combo .miso-horizontal__item-title{font-family:var(--miso-title-font-family)!important;font-size:16px!important}.miso-hybrid-search-combo .miso-horizontal__item-index{font-family:var(--miso-title-font-family)!important;margin-top:0!important}.miso-hybrid-search-combo .miso-horizontal__item-authors-and-date-container{color:var(--secondaryTextColor)!important;font-size:14px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__results-header{align-items:center;display:flex;justify-content:space-between;margin-bottom:10px}.miso-hybrid-search-combo .miso-hybrid-search-combo__total-phrase{color:var(--headerTextColor)!important;font-family:var(--miso-title-font-family)!important;font-size:22px!important;font-weight:700!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__search-results-filters{margin-bottom:0!important}.miso-hybrid-search-combo [data-role=sort]{--miso-select-font-size:14px!important;--miso-select-width:180px!important}.miso-hybrid-search-combo .miso-select__button{border-radius:5px!important}.miso-hybrid-search-combo .miso-select .miso-select__option{font-size:var(--miso-select-font-size)!important;gap:4px!important;line-height:var(--miso-select-line-height)!important;padding:.2em .35em!important}.miso-hybrid-search-combo .miso-select .miso-select__option:first-child{padding-top:.4em!important}.miso-hybrid-search-combo .miso-select .miso-select__option:last-child{padding-bottom:.4em!important}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item{border:none!important;border-top:1px solid var(--listBorderColor)!important;border-color:var(--listBorderColor)!important;border-radius:0!important;margin:0!important;padding:15px 0!important}.miso-hybrid-search-combo .miso-list__item-body{align-items:start!important;gap:20px!important;padding:0!important}.miso-hybrid-search-combo .miso-list__item-info-container{gap:10px!important;margin-top:0!important}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item .miso-list__item-cover-image-container{aspect-ratio:unset!important;border-radius:0!important;height:auto!important;min-width:150px!important;width:100%!important}.miso-hybrid-search-combo .miso-list__item-cover-image{height:auto!important;max-height:none!important}.miso-hybrid-search-combo .miso-list__item-section{color:var(--primaryColor1);font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;font-size:var(--section);font-weight:800;letter-spacing:2px;line-height:1.2;text-transform:uppercase;word-break:keep-all}.miso-hybrid-search-combo .miso-list__item-section:hover{color:var(--primaryTextColor)}.miso-hybrid-search-combo .miso-list__item-title{font-family:var(--miso-title-font-family)!important;font-size:var(--title-3)!important;font-weight:700!important;line-height:1.27!important}.miso-hybrid-search-combo .miso-list__item-title mark{font-weight:inherit!important}.miso-hybrid-search-combo .miso-list__item-snippet{color:var(--headerMenuTextColor)!important;font-family:var(--bodyFont)!important;font-size:var(--label-4)!important;font-weight:400!important;letter-spacing:normal!important;line-height:1.57!important}.miso-hybrid-search-combo .miso-list__item-snippet mark{font-weight:inherit!important}.miso-hybrid-search-combo .miso-list__item-author-phrase{color:var(--secondaryTextColor);font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif;font-size:var(--section);font-weight:700;letter-spacing:.8px;line-height:1.2}.miso-hybrid-search-combo .miso-list__item-author{color:var(--primaryTextColor)}.miso-hybrid-search-combo .miso-list__item-author:hover{color:var(--primaryColor1)}.miso-hybrid-search-combo .miso-list__item-date{color:var(--secondaryTextColor)!important;font-family:var(--primaryHeadlineFont),Arial,Helvetica,sans-serif!important;font-size:var(--section)!important;font-weight:700!important;letter-spacing:.8px!important;line-height:1.2!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__results-more-container__inner{align-items:center!important;display:flex!important;justify-content:center!important}@media only screen and (min-width:768px){.miso-hybrid-search-combo{--miso-search-box-font-size:3.2rem!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{grid-template-areas:"query query" "answer sources" "results sources";grid-template-columns:1fr min-content}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-container{background-color:#fff!important;border:1px solid var(--listBorderColor)!important;margin-top:0!important;padding:15px!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__sources-phrase{margin-bottom:25px!important;margin-top:0!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__list{flex-direction:column!important;gap:25px!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item{background-color:transparent!important;border:none!important;border-radius:0!important;width:auto!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-body{padding:0!important}.miso-hybrid-search-combo .miso-horizontal[data-role=sources] .miso-horizontal__item-title{-webkit-line-clamp:none!important}.miso-hybrid-search-combo .miso-hybrid-search-combo__question-phrase{font-size:2.4rem!important}.miso-hybrid-search-combo .miso-list[data-role=products] .miso-list__item .miso-list__item-cover-image-container{width:226px!important}.miso-hybrid-search-combo .miso-primary-button[data-role=more]{min-width:310px!important}}@media only screen and (min-width:1024px){.miso-hybrid-search-combo .miso-hybrid-search-combo__grid{grid-template-columns:1fr 320px}}');var t="1.12.7";function e(...t){const e=t.length;if(0===e)return(new AbortController).signal;if(1===e)return t[0];const s=new AbortController;for(const e of t)if(e&&e.addEventListener){if(e.aborted)return AbortSignal.abort(e.reason);e.addEventListener("abort",()=>s.abort(e.reason))}return s.signal}const s=Object.freeze({ASK:"ask",SEARCH:"search",RECOMMENDATION:"recommendation",INTERACTIONS:"interactions"}),i=Object.freeze({QUESTIONS:"questions",RELATED_QUESTIONS:"related_questions",TRENDING_QUESTIONS:"trending_questions",SEARCH:"search",AUTOCOMPLETE:"autocomplete",SEARCH_AUTOCOMPLETE:"search_autocomplete",MGET:"mget",USER_TO_PRODUCTS:"user_to_products",USER_TO_CATEGORIES:"user_to_categories",USER_TO_ATTRIBUTES:"user_to_attributes",USER_TO_TRENDING:"user_to_trending",USER_TO_HISTORY:"user_to_history",PRODUCT_TO_PRODUCTS:"product_to_products",UPLOAD:"upload"});var o=Object.freeze({__proto__:null,GROUP:s,NAME:i});function n(t,e){if(!t)return;const s=t.indexOf(e);s>-1&&t.splice(s,1)}function r(t){return Array.isArray(t)?t:void 0===t?[]:[t]}function a(t){if("object"!=typeof t)return t;const e={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&void 0!==t[s]&&(e[s]=t[s]);return e}function c(t){return null==t}function l(t,e,s){Object.defineProperties(t,(s="string"==typeof s?[s]:s).reduce((t,s)=>(t[s]={get:()=>{const t=e[s];return"function"==typeof t?t.bind(e):t}},t),{}))}function u(t,e){for(const s in e)e.hasOwnProperty(s)&&Object.defineProperty(t,s,{value:e[s]})}function h(t){return t.replace(/-([a-z])/g,t=>t[1].toUpperCase())}function d(t){return t.replace(/[-_][a-z]/g,t=>t[1].toUpperCase())}function _(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}class p{constructor(t,{duration:e=0,onDuration:s,offDuration:i,state:o}={}){if("function"!=typeof t)throw Error("Callback must be a function: "+t);f(s),f(i),f(e),this._callback=t,Object.defineProperty(this,"durations",{value:Object.freeze({on:void 0!==s?s:e,off:void 0!==i?i:e})}),this._value=this._state=!!o,this._active=!0}get active(){return this._active}get state(){return this._state}get value(){return this._value}set value(t){if(this._value===(t=!!t))return;!function(t){if(!t._timeout)return;clearTimeout(t._timeout),t._timeout=void 0}(this);const e=this.durations[t?"on":"off"];e?this._timeout=setTimeout(()=>m(this,t),e):m(this,t),this._value=t}disconnect(){this._active=!1}}function m(t,e){t._state!==e&&(t._state=e,t._active&&t._callback(e))}function f(t,e){if(void 0!==e&&(isNaN(e)||0>e))throw Error(`${t} must be a non-negative number: ${e}`)}function g(t,e,{root:s=t.ownerDocument}={}){for(;t&&t!==s;t=t.parentElement){const s=e(t);if(void 0!==s)return s}}function b(t){const{tagName:e}=t;customElements.define(e,t);for(const t of document.querySelectorAll(e))customElements.upgrade(t)}async function y(t){return new Promise((e,s)=>{window.requestAnimationFrame(async i=>{try{await t(i),e()}catch(t){s(t)}})})}async function v(t,{area:e=.5,duration:s=1e3,signal:i}={}){return t=function(t){return"string"==typeof t?document.querySelector(t):t}(t),new Promise((o,n)=>{const r=new p(t=>{t&&(r.disconnect(),a.disconnect(),o())},{onDuration:s}),a=new IntersectionObserver(t=>{r.value=t[0].isIntersecting},{threshold:e});a.observe(t),i&&i.addEventListener&&i.addEventListener("abort",()=>{r.disconnect(),a.disconnect(),n(new DOMException("Aborted","AbortError"))})})}function w(t){return(t=""+t)&&t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function E(){return(crypto&&crypto.randomUUID?crypto.randomUUID():void 0)||function(){if(!URL||!URL.createObjectURL||URL.revokeObjectURL||!Blob)return;const t=URL.createObjectURL(new Blob),e=""+t;return URL.revokeObjectURL(t),e.substring(e.lastIndexOf("/")+1)}()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function x(t,e){const s=S(()=>window.localStorage.getItem(t)),i=S(()=>function(t){const e="; "+document.cookie,s=`; ${encodeURIComponent(t)}=`,i=e.indexOf(s);if(0>i)return;const o=i+s.length,n=e.indexOf(";",o);return decodeURIComponent(0>n?e.substring(o):e.substring(o,n))}(t)),o=s||i||""+e();return o&&!s&&S(()=>window.localStorage.setItem(t,o)),o&&!i&&S(()=>function(t,e){document.cookie=`${encodeURIComponent(t)}=${encodeURIComponent(e)}; max-age=31536000; path=/`}(t,o)),o}function S(t){try{return t()}catch(t){if(!function(t){return"SecurityError"===t.name}(t))throw t}}function O(t){return new k(t)}class k{constructor(t){this._value=t;const e=t=>{this._value=t};u(this,{set:e,args:(...t)=>e(t),t:()=>e(!0),f:()=>e(!1),merge:t=>e({...this._value,...t})})}get value(){return this._value}}class I{constructor(){const t=this;t.promise=new Promise((e,s)=>{t.resolve=e,t.reject=s}),Object.freeze(this)}}class C{constructor(){this._index=-1,this._done=!1,this._aborted=!1,this._abortReason=void 0,this._error=void 0}get aborted(){return this._aborted}get abortReason(){return this._abortReason}get done(){return this._done}update(t,e=!1){this._done||(this._value=t,this._done=e,this._index++,this._resolution&&(this._resolution.resolve(),this._resolution=void 0))}error(t){this._error=t,this._resolution&&(this._resolution.reject(t),this._resolution=void 0)}abort(t){this._aborted=!0,this._abortReason=t,this._resolution&&(t instanceof Error?this._resolution.reject(t):this._resolution.resolve(),this._resolution=void 0)}async*[Symbol.asyncIterator](){let t=0;for(;;){if(this._error)throw this._error;if(this._aborted)break;if(t>this._index&&(this._resolution||(this._resolution=new I),await this._resolution.promise),this._aborted)break;const e=this._done,s=this._index+1;if(yield this._value,this._aborted||e)break;t=s}}}function T(t,e){const s=window[t]||(window[t]=[]);if(s._processed)return;s._processed=!0;const i=t=>function(t,{onError:e=t=>console.error(t),transform:s=t=>t}={}){try{s(t)()}catch(t){e(t)}}(t,e);Object.defineProperty(s,"push",{value:i});for(const t of s)i(t)}let A;try{A=document.currentScript}catch(t){}async function R(t){try{let e=function(t){return document.head.querySelector(`link[href="${t}"]`)}(t);return e||(e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.appendChild(e)),async function(t){await async function(t){if(t.sheet)return;return new Promise((e,s)=>{let i;t.onerror=()=>{i&&clearInterval(i),s()},i=setInterval(()=>{t.sheet&&(i&&clearInterval(i),e())},100)})}(t),await async function(t){if($(t))return;return new Promise(e=>{let s;s=setInterval(()=>{$(t)&&(s&&clearInterval(s),e())},100)})}(t)}(e)}catch(t){console.error(t)}}function N(t){return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@1.12.7/dist/css/${t}.css`}function $(t){for(const e of document.styleSheets)if(e.ownerNode===t)return!0;return!1}function L(t){let e;return s=>{e&&clearTimeout(e),e=setTimeout(()=>{e=void 0,s()},t)}}function U(t,{depth:e=5,...s}={}){return P(t,e)}function P(t,e,s){return e>0?"object"==typeof t&&t?void 0!==t.length?Array.prototype.map.call(t,t=>P(t,e-1)):t instanceof Node?function(t){if(t instanceof Element)return`<${t.tagName.toLowerCase()}${t.id?` id="${t.id}"`:""}${t.className?` class="${t.className}"`:""}>`;return`[TextNode](${t.length})`}(t):function(t,e){const s={};if(0>=e)return s;for(const i in t){const o=t[i];"function"!=typeof o&&(i.startsWith("_")&&"object"==typeof o&&"Object"!==o.constructor.name||(s[i]=P(o,e-1)))}return s}(t,e):t:"(...)"}function q(t,e){const s=Object.getOwnPropertyDescriptors(e),i=Object.getOwnPropertyDescriptors(t);for(const[e,o]of Object.entries(s))"constructor"!==e&&void 0===i[e]&&Object.defineProperty(t,e,o)}function j(t){const e={},s=new Set;for(let i=t;i!==Object.prototype;i=Object.getPrototypeOf(i)){const o=Object.getOwnPropertyDescriptors(i);for(const i in o){if("constructor"===i||i.startsWith("_")||s.has(i))continue;s.add(i);const{value:n}=o[i];n&&(e[i]="function"==typeof n?n.bind(t):n)}}return Object.freeze(e)}function D(t={},e={}){const s=t.metadata||e.metadata?a({...t.metadata,...e.metadata}):void 0,i=t._meta||e._meta?a({...t._meta,...e._meta}):void 0;return a({...t,...e,metadata:s,_meta:i})}function z(t={},e={}){const s=t.context&&t.context.custom_context||e.context&&e.context.custom_context?a({...t.context&&t.context.custom_context,...e.context&&e.context.custom_context}):void 0,i=t.context||e.context?a({...t.context,...e.context,custom_context:s}):void 0;return a({...t,...e,context:i})}function M(t){const e=function({speed:t=100,acceleration:e=4}={}){if("function"==typeof t)return t;if("number"!=typeof t)throw Error("Invalid speed: "+t);if("number"!=typeof e)throw Error("Invalid acceleration: "+e);return(s,i)=>{let o=t*(Math.random()+.5);return e>0&&void 0!==i&&s>i&&(o*=1+(s-i)*e/1e3),o}}(t);return(t,s,i,o)=>{const n=e(i,s);return t+Math.max(o-i,0)*n/1e3}}const F=Symbol.for("miso:resources");class B{constructor(){this._resources=new Map;const t=window[F]||[];for(const e of t)try{const[t,s]=e;this.push([t,s])}catch(t){}}push([t,e]){Q(this._resources,t).resolve(e)}async get(t){return Q(this._resources,t).promise}}function Q(t,e){if(t.has(e))return t.get(e);const s=new I;return t.set(e,s),s}function G(){return window[F]||(window[F]=new B)}class H{constructor(t,e){this._dispatchRequested=!1,this._requests=[],this._run=t,this._error=e||(t=>console.error(t)),this._bulkId=0,this._dispatch=this._dispatch.bind(this)}get info(){return{bulkId:this._bulkId,index:this._requests.length}}async run(t){const e=new I;return this._requests.push({action:t,resolution:e}),this._requestDispatch(),e.promise}_requestDispatch(){this._dispatchRequested||(this._dispatchRequested=!0,setTimeout(this._dispatch))}_dispatch(){if(!this._dispatchRequested)return;this._dispatchRequested=!1;const t=this._requests,e=this._bulkId++;this._requests=[];try{this._run(t,{bulkId:e})}catch(t){this._error(t)}}}class W{constructor({target:t,error:e,replays:s=[]}={}){if(this._error=e||(t=>console.error(t)),!Array.isArray(s))throw Error("Replays option must be an array of strings: "+s);this._replays=new Set(s),this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={},t&&this._injectSubscribeInterface(t)}emit(t,e){const s={data:e,meta:{name:t,ts:Date.now()}},i=this._namedCallbacks[t];if(i)for(const t of i)t(s);for(const t of this._unnamedCallbacks)t(s);this._shallStoreForReplay(t)&&(this._pastEvents[t]||(this._pastEvents[t]=[])).push(s)}on(t,e){return this._checkName(t),this._checkCallback(e),this._on(t,this._wrapCallback(e))}once(t){this._checkName(t);const e=this;return new Promise((s,i)=>{const o=e._on(t,t=>{setTimeout(()=>o());try{s(t)}catch(t){i(t)}})})}clear(){this._namedCallbacks={},this._unnamedCallbacks=[],this._pastEvents={}}_checkName(t){if("string"!=typeof t)throw Error("Event name should be a string: "+t)}_checkCallback(t){if("function"!=typeof t)throw Error("Event callback should be a function: "+t)}_shallStoreForReplay(t){return this._replays.has(t)}_wrapCallback(t){const e=this;return({data:s,meta:i})=>{try{t(s,i)}catch(t){e._error(t)}}}_on(t,e){if("*"===t?this._unnamedCallbacks.push(e):(this._namedCallbacks[t]||(this._namedCallbacks[t]=[])).push(e),"*"===t)for(const t in this._pastEvents)this._pastEvents[t].forEach(e);else this._pastEvents[t]&&this._pastEvents[t].forEach(e);return()=>this._off(t,e)}_off(t,e){if("*"===t)n(this._unnamedCallbacks,e);else{const s=this._namedCallbacks[t];s&&n(s,e)}}_injectSubscribeInterface(t){l(t,this,["on","once"])}}function V(t,e){return Object.freeze([...e&&e.meta&&e.meta.path||[],...t?[t]:[]])}class Y{constructor(t,e){const s=function(t,e){if(void 0!==t&&"string"!=typeof t&&void 0===e&&(e=t,t=void 0),void 0!==t&&("string"!=typeof t||!t))throw Error(`Invalid Component name: "${t}"`);return Object.freeze({name:t,parent:e,path:V(t,e),uuid:E()})}(t,e);u(this,{meta:s});const i=this._error=this._error.bind(this);this._events=new W({target:this,error:i,replays:["child"]}),this._warn=this._warn.bind(this),(e=s.parent)&&e._events&&e._events.emit("child",this)}_warn(...t){const e=this.meta.parent;(e&&e._warn||console.warn)(...t)}_error(...t){const e=this.meta.parent;(e&&e._error||console.error)(...t)}}!function(t,e){const s=Symbol.for(e);Object.defineProperty(t,s,{value:!0}),Object.defineProperty(t,"isTypeOf",{value:e=>e&&e instanceof t||"function"==typeof e.constructor&&!0===e.constructor[s]})}(Y,"miso:component");class K extends Y{constructor(t,e,{libName:s,keyName:i}={}){switch(super(t,e),this._events._replays.add("register"),this._libraries={},this._libResolutions={},this._libName=s,typeof i){case"string":this._keyFn=t=>t[i];break;case"function":this._keyFn=i;break;default:throw Error("Expect keyName to be a string or a function: "+i)}}isRegistered(t){return this._checkKey(t),!!this._libraries[t]}get registered(){return Object.values(this._libraries)}async whenRegistered(t){if(this.isRegistered(t))return this._libraries[t];const{promise:e}=this._libResolutions[t]||(this._libResolutions[t]=new I);return e}register(...t){for(const e of t)this._register(e)}_checkKey(t){if("string"!=typeof t||!t)throw Error("Expect key to be a non-empty string: "+t)}_checkLib(t){if("function"!=typeof t)throw Error("Expect lib to be a class or function: "+t)}_register(t){this._checkLib(t);const e=this._keyFn(t);this._checkKey(e);const s=this._libraries||(this._libraries={});s[e]=t,this._libResolutions[e]&&this._libResolutions[e].resolve(t),this._events.emit("register",t)}}class Z{constructor(t,e){this._callback=t,this._options=e||{},!1!==e&&(this._intersection=new IntersectionObserver(this._handleIntersection.bind(this),{threshold:e.area||.5}),this._continuity=new p(this._handleContinuity.bind(this),{onDuration:e.duration||1e3})),this._displayed=void 0,this._intersecting=!1,this._triggered=new Set}observe(t){!1!==this._options&&this._intersection.observe(t)}unobserve(t){!1!==this._options&&this._intersection.unobserve(t)}display(t){!1!==this._options&&(this._triggered.has(t)&&(t=void 0),this._displayed!==t&&(this._displayed=t,this._continuity.value=!1,this._syncContinuity()))}disconnect(){!1!==this._options&&(this._continuity.disconnect(),this._intersection.disconnect())}get triggeredCount(){return this._triggered.size}get triggered(){return new Set(this._triggered)}_syncContinuity(){this._continuity.value=this._intersecting&&void 0!==this._displayed}_handleIntersection(t){this._intersecting=t[0].isIntersecting,this._syncContinuity()}_handleContinuity(t){const e=this._displayed;if(t&&void 0!==e){if(this._triggered.has(e))return;this._triggered.add(e),this._displayed=void 0,this._callback(e)}}}class J{constructor(t){this._ac=new AbortController,this._timeout=t,this.touch()}clear(){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0)}touch(){this.clear(),this._timeoutId=setTimeout(()=>this.abort(),this._timeout)}get signal(){return this._ac.signal}abort(t){this.clear(),this._ac.abort(t||Error(`Stall timeout: data stay unchanged for ${this._timeout/1e3} seconds.`))}}const X=Object.freeze({DATA_ENDPOINT:"https://api-edge.askmiso.com/v1",EVENT_ENDPOINT:"https://api.askmiso.com/v1"});class tt{constructor(t,e){this._client=t,this._root=e,this._bulk=new H(this._runBulkFetch.bind(this),t._error.bind(t))}async fetch(t,e,{method:s="POST",headers:i,timeout:o}={}){const{request:n={}}=this._client.options;o=o||n.timeout;const r="GET"!==s&&null!=e?JSON.stringify(e):void 0,c=o?AbortSignal.timeout(o):void 0,l=await(this._root._customFetch||window.fetch)(t,a({method:s,headers:i,body:r,cache:"no-cache",mode:"cors",signal:c})),u=await l.json();if(l.status>=400||u.errors){var h=Error(u.message);throw h.data=u,h.status=l.status,h}return u}get bulkInfo(){return this._bulk.info}async fetchForBulk(t,e,s,{method:i}={}){if(i&&"POST"!==i)throw Error("Non-POST API is not supported in bulk mode: "+url);return this._bulk.run({apiGroup:t,apiName:e,payload:s})}async _runBulkFetch(t){const e=this.url(["bulk"]),s={requests:t.map(({action:{apiGroup:t,apiName:e,payload:s}})=>({api_name:`${t}/${e}`,body:s}))},{data:i}=await this.fetch(e,s);for(let e=0,s=t.length;s>e;e++){const{resolution:s}=t[e],{error:o,status_code:n,body:r}=i[e];n>=400||o?s.reject({status_code:n,body:r}):s.resolve(r)}}sendBeacon(t,e,{method:s}={}){if(s&&"POST"!==s)throw Error("Non-POST API is not supported in useBeacon mode: "+t);if(!(this._root._customSendBeacon?this._root._customSendBeacon(t,JSON.stringify(e)):window.navigator.sendBeacon(t,JSON.stringify(e))))throw Error("Send beacon unsuccessful: "+t)}url(t){const{apiKey:e}=this._client.options,s=t.filter(t=>t).join("/");return`${`${this.getApiEndpoint(s)}/${s}`}?api_key=${window.encodeURIComponent(e)}`}getApiEndpoint(t){const{dataEndpoint:e=X.DATA_ENDPOINT,eventEndpoint:s=X.EVENT_ENDPOINT}=this._client.options;return"interactions"===t?s:e}applyUrlPasses(t,{apiGroup:e,apiName:s,url:i}){const o=this._client;for(const n of this._root._urlPasses)try{i=n({client:o,apiGroup:e,apiName:s,url:i})||i}catch(e){(t._error||console.error)(e)}return i}applyPayloadPasses(t,{apiGroup:e,apiName:s,payload:i}){const o=this._client;for(const n of this._root._payloadPasses)try{i=n({client:o,apiGroup:e,apiName:s,payload:i})||i}catch(e){(t._error||console.error)(e)}return i}applyHeaderPasses(t,{apiGroup:e,apiName:s,payload:i,headers:o,options:n}){const r=this._client;for(const a of this._root._headersPasses)try{o=a({client:r,apiGroup:e,apiName:s,payload:i,headers:o,options:n})||o}catch(e){(t._error||console.error)(e)}return o}}class et extends Y{constructor(t,e){super(e,t),this._apiPath=e,this.helpers=t.helpers,this.clientOptions=t._client.options,this.context=t._client.context}async _run(t,e,s={}){const{bulk:i}=s,o=i?{bulk:this.helpers.bulkInfo}:void 0,n=this._apiPath,r=this._url({apiGroup:n,apiName:t,payload:e,options:s}),a=this._headers({apiGroup:n,apiName:t,payload:e,options:s}),c={apiGroup:n,apiName:t,payload:e=this._preprocess({apiGroup:n,apiName:t,payload:e,options:s}),url:r,headers:a,options:s};this._events.emit("request",{...c,...o});const l=await this._send(c),u={...c,response:l};return this._events.emit("response",{...u,...o}),this._postprocess(u)}_headers({apiGroup:t,apiName:e,payload:s,options:i}){return this.helpers.applyHeaderPasses(this,{apiGroup:t,apiName:e,payload:s,headers:{},options:i})}_preprocess({apiGroup:t,apiName:e,payload:s,options:i}){return this.helpers.applyPayloadPasses(this,{apiGroup:t,apiName:e,payload:s,options:i})}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([t,e],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}async _send({apiGroup:t,apiName:e,url:s,headers:i,payload:o,options:{bulk:n,...r}={}}){return n?this.helpers.fetchForBulk(t,e,o):this.helpers.fetch(s,o,{...r,headers:i})}_postprocess({response:t}){return t.data}}const{GROUP:st,NAME:it}=o;class ot extends et{constructor(t){super(t,st.INTERACTIONS)}async upload(t,e){try{return await this._run(it.UPLOAD,t,e)}catch(t){if(400!==t.status||!t.message||-1>=t.message.toLowerCase().indexOf("playground"))throw t;this._warn("Ignore interactions uploaded to playground app.")}}_url({apiGroup:t,apiName:e,options:s}){const i=this.helpers.url([this._apiPath],s);return this.helpers.applyUrlPasses(this,{apiGroup:t,apiName:e,url:i,options:s})}_preprocess({apiGroup:t,apiName:e,payload:s}){return e===it.UPLOAD&&(s=this._normalizeUploadPayload(s)),super._preprocess({apiGroup:t,apiName:e,payload:s})}_normalizeUploadPayload(t){if("object"!=typeof t)throw Error("Interactions payload has to be either an object or an array of objects: "+t);return Array.isArray(t)||(t=[t]),{data:t}}async _send({options:{useBeacon:t=!0,...e}={},...s}){if(t){const{url:t,payload:i}=s;return this.helpers.sendBeacon(t,i,e),{}}return super._send({...s,options:e})}}class nt{constructor(t={}){this._ac=new AbortController,this._options=t}async get(t){return this._get({...this._options,...t})}_get(t){throw Error("Not implemented")}abort(t){this._ac.abort(t)}[Symbol.asyncIterator](){let{pollingInterval:t,signal:s,stallTimeout:i=12e4,...o}=this._options;const n=new J(i);let r;s=e(this._ac.signal,n.signal,s);return function(t,{interval:e=1e3,errorLimit:s=10,onError:i,onResponse:o,signal:n}={}){if(n&&n.aborted)return[];let r,a,l=0,u=!1;function h(){r&&clearInterval(r),u=!0}const d=new C;return r=setInterval(async()=>{let e,r,_;try{if([e,r,_]=await t(n?{signal:n}:{}),u||!c(a)&&a>=_)return;c(_)||(a=_),o&&o(e,r,_),l=0}catch(t){return i&&i(t),l++,void(l>s&&(h(),d.error(t)))}d.update(e,r),r&&h()},e),n&&n.addEventListener&&n.addEventListener("abort",()=>{h(),d.abort(n.reason)}),d}(async({}={})=>{const t=await this.get();return[t,this._isFinished(t),this._revisionOf(t)]},{interval:t,signal:s,onResponse:(t,e)=>{e?n.clear():this._isUpdated(r,t)&&n.touch(),r=t},...o})[Symbol.asyncIterator]()}_isFinished(t){return!(!t||!t.finished)}_isUpdated(t,e){return!t||t.answer_stage!==e.answer_stage||at(t.answer)!==at(e.answer)||at(t.reasoning)!==at(e.reasoning)}_revisionOf(t){return t&&t.revision}}class rt extends nt{constructor(t,e,s,i){super(i),this._api=t,this._method=e,this._id=s}async _get(t){return this._api[this._method](this._id,t)}}function at(t=""){return t.length}const{GROUP:ct,NAME:lt}=o;class ut extends et{constructor(t){super(t,ct.ASK)}async questions(t,e={}){if(_t(t)&&(t={question_id:t}),t.question_id)return new ht(this,t,e);const s=await this._run(lt.QUESTIONS,t,e);return new ht(this,s,e)}async _questions(t,e){return this._run(lt.QUESTIONS,t,e)}async _questionGet(t,e){return this._run(`${lt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async relatedQuestions(t,e={}){return this._run(lt.RELATED_QUESTIONS,t,e)}async trendingQuestions(t,e={}){return this._run(lt.TRENDING_QUESTIONS,t,e)}async search(t,e={}){if(_t(t)&&(t={question_id:t}),t.question_id)return new dt(this,t,e);const s=await this._run(lt.SEARCH,t,e);return s.question_id?new dt(this,s,e):s}async _searchGet(t,e){return this._run(`${lt.QUESTIONS}/${t}/answer`,void 0,{...e,method:"GET"})}async autocomplete(t,e){return this._run(lt.AUTOCOMPLETE,t,e)}async searchAutocomplete(t,e){return this._run(lt.SEARCH_AUTOCOMPLETE,t,e)}}class ht extends rt{constructor(t,e,s={}){super(t,"_questionGet",e.question_id,s),this._response=e}get questionId(){return this._id}}class dt extends rt{constructor(t,e,s={}){super(t,"_searchGet",e.question_id,s),u(this,e),this._response=e}get questionId(){return this._id}}function _t(t){return"string"==typeof t&&"{"!==t.charAt(0)}const{GROUP:pt,NAME:mt}=o;class ft extends et{constructor(t){super(t,pt.SEARCH)}async search(t,e){return this._run(mt.SEARCH,t,e)}async autocomplete(t,e){return this._run(mt.AUTOCOMPLETE,t,e)}async multipleGet(t,e){return this._run(mt.MGET,t,e)}}const{GROUP:gt,NAME:bt}=o;class yt extends et{constructor(t){super(t,gt.RECOMMENDATION)}async userToProducts(t,e){return this._run(bt.USER_TO_PRODUCTS,t,e)}async userToCategories(t,e){return this._run(bt.USER_TO_CATEGORIES,t,e)}async userToAttributes(t,e){return this._run(bt.USER_TO_ATTRIBUTES,t,e)}async userToTrending(t,e){return this._run(bt.USER_TO_TRENDING,t,e)}async userToHistory(t,e){return this._run(bt.USER_TO_HISTORY,t,e)}async productToProducts(t,e){return this._run(bt.PRODUCT_TO_PRODUCTS,t,e)}}class vt extends Y{constructor(t,e){super("api",t),this._client=t,this.helpers=new tt(t,e),this.interactions=new ot(this),this.ask=new ut(this),this.search=new ft(this),this.recommendation=new yt(this)}}var wt=Object.freeze({__proto__:null,Api:vt,ApiBase:et,ApiHelpers:tt,Interactions:ot,Ask:ut,Search:ft,Recommendation:yt});class Et extends Y{constructor(t){super("context",t),this._client=t}}var xt={api:wt,context:{Context:Et}};class St{constructor(t){u(this,{install:t})}}class Ot extends K{constructor(t){super("plugins",t,{libName:"plugin class",keyName:"id"}),this._root=t,this._currentScript=document.currentScript,this._events._replays.add("install").add("subtree"),this._installed={},this._installedResolutions={},this._useRequests={},this._subtrees=[],this.context=new kt(this,xt),this.plugins=new It(this)}isInstalled(t){return this._checkKey(t),!!this._installed[t]}get installed(){return Object.values(this._installed)}get(t){return this._installed[t]}getPluginClass(t){return this._libraries[t]}use(t,e){if("function"==typeof t&&t.id&&"string"==typeof t.id)return this.register(t),void this.use(t.id,e);let s;if("string"==typeof t&&this.isInstalled(t))return s=this.get(t),void this._tryConfig(s,e);"string"!=typeof t||this.isRegistered(t)?(s=this._instantiate(t,e),this._install(s)):(this._useRequests[t]||(this._useRequests[t]=[])).push(e)}async install(t,e){return this.use(t,e),"string"!=typeof t||this.isRegistered(t)||await this._tryRegisterRemotely(t),this.whenInstalled(t)}async whenInstalled(t){if("function"==typeof t&&t.id&&"string"==typeof t.id&&(t=t.id),this.isInstalled(t))return this.get(t);const{promise:e}=this._installedResolutions[t]||(this._installedResolutions[t]=new I);return e}addSubtree(t){this._subtrees.push(t),this._events.emit("subtree",t)}addPayloadPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._payloadPasses.push(t)}addHeadersPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._headersPasses.push(t)}addUrlPass(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._urlPasses.push(t)}setCustomFetch(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customFetch=t}setCustomSendBeacon(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._customSendBeacon=t}onHubUpdate(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubUpdateCallbacks.push(t)}onHubEmit(t){if("function"!=typeof t)throw Error("Expect parameter to be a function: "+t);this._root._hubEmitCallbacks.push(t)}_tryConfig(t,e){void 0!==e&&("function"==typeof t.config?(t.config(e),this._events.emit("config",[t,e])):this._warn(`Attempt to pass options to plugin "${t.id}", which offers no config() method.`))}_instantiate(t,e){switch(typeof t){case"string":this._checkKey(t);const s=this._libraries[t];if(!s)throw Error("Plugin class not found: "+t);const i=new s;return u(i,{id:t}),this._tryConfig(i,e),i;case"function":return new St(t)}throw Error("Unexpected parameters: "+t)}_install(t){if("function"!=typeof t.install)throw Error("Expect plugin.install to be a function: "+t);try{t.installed=!1,t.install(this.MisoClient,this.context),t.installed=!0}catch(t){throw t}t.id&&(this._installed[t.id]=t,this._installedResolutions[t.id]&&(this._installedResolutions[t.id].resolve(t),delete this._installedResolutions[t.id])),this._events.emit("install",t)}_register(t){super._register(t),this._fulfillUseRequests(t.id)}_fulfillUseRequests(t){const e=this._useRequests[t];if(e){for(const s of e)try{this.use(t,s)}catch(t){this._error(t)}delete this._useRequests[t]}}async _tryRegisterRemotely(t){if(t.startsWith("std:"))try{return void await this._registerStdRemotely(t)}catch(t){console.error(t)}throw Error("Cannot register plugin remotely: "+t)}async _registerStdRemotely(t){const{version:e}=this._root,s="dev"===e?`plugin:${t}@dev:${this.MisoClient.uuid}`:`plugin:${t}@${e}`;if(!document.querySelector(`script[data-request="${s}"]`)){const i=document.createElement("script");i.async=!0,i.src=function(t,e,s){const i=t.slice(4);if("dev"===e){const t=s.src,e=t.indexOf("?"),o=0>e?t.length:e,n=t.lastIndexOf("/",o)+1,r=t.indexOf(".",n),a=0>r?"":t.slice(r,o);return`${t.slice(0,n)}plugins/${i}${a}`}return`https://cdn.jsdelivr.net/npm/@miso.ai/client-sdk@${e}/dist/umd/plugins/${i}.min.js`}(t,e,this._currentScript),i.setAttribute("data-request",s),document.head.appendChild(i)}const i=await(new G).get(s);!this.isRegistered(t)&&this.register(i)}}class kt{constructor(t,e){l(this,t,["getPluginClass","addSubtree","addPayloadPass","addHeadersPass","addUrlPass","setCustomFetch","setCustomSendBeacon","onHubUpdate","onHubEmit","whenInstalled","whenRegistered"]),u(this,{classes:e})}}class It{constructor(t){l(this,t,["installed","registered","isInstalled","isRegistered","whenInstalled","whenRegistered","get","register","use","install"])}}const Ct=new class extends Y{constructor(){super(),this._events._replays.add("create"),this._pluginRoot=new Ot(this),this._clients=[],this._payloadPasses=[],this._headersPasses=[],this._urlPasses=[],this._customFetch=void 0,this._customSendBeacon=void 0,this._hubUpdateCallbacks=[],this._hubEmitCallbacks=[],this.version=t,this._cmdRes=new I}get instances(){return[...this._clients]}async any(){return this._clients[0]||this._any||(this._any=(await this._events.once("create")).data)}get cmdDone(){return this._cmdRes.promise}};var Tt=Object.freeze({__proto__:null,viewable:v,debounce:L});const{currentScript:At}=document;class Rt extends Y{static attach(){(window.MisoClients||(window.MisoClients=[])).push(Rt),window.MisoClient?window.MisoClient!==Rt&&console.warn(`window.MisoClient already exists: (${window.MisoClient.version}).`):window.MisoClient=Rt}static debug(){}constructor(t){super("client",Ct),this._config(t),this.context=new Et(this),this.api=new vt(this,Ct),function(t){Ct._clients.push(t),Ct._events.emit("create",t)}(this)}get version(){return Rt.version}_config(t){this.options=Object.freeze(this._normalizeOptions(t))}_normalizeOptions(t={}){if("string"==typeof t&&(t={apiKey:t}),t.readConfigFromScriptUrl&&(t={...this._readConfigFromScriptUrl(),...t}),!t.apiKey)throw Error("Require API key to initialize miso client.");return t.request&&t.request.sendApiKeyByHeader&&console.warn('`sendApiKeyByHeader` option is deprecated. Please call `MisoClient.plugins.use("std:header-api-key");` instead.'),t.dataEndpoint=t.dataEndpoint||t.apiHost,t.eventEndpoint=t.eventEndpoint||t.apiHost,delete t.apiHost,a(t)}_readConfigFromScriptUrl(){return a({apiKey:new URL(new Request(At.src||At.href).url).searchParams.get("api_key")||void 0})}}Rt.helpers=Tt,u(Rt,{uuid:E()});var Nt=function(t){const e=Ct._pluginRoot;return Ct.MisoClient=e.MisoClient=t,l(t,Ct,["version","instances","any","meta","on","once","cmdDone"]),l(t,e,["plugins"]),t}(Rt);const{GROUP:$t,NAME:Lt}=o;let Ut;class Pt{constructor(t){this._plugin=t,this._props={}}get anonymous_id(){return this._props.anonymous_id||Ut||(Ut=x("miso_anonymous_id",E))}set anonymous_id(t){this._requireString("anonymous_id",t),this._set("anonymous_id",t)}get user_id(){return this._props.user_id}set user_id(t){this._requireString("user_id",t),this._set("user_id",t)}get user_hash(){return this._props.user_hash}set user_hash(t){this._requireString("user_hash",t),this._set("user_hash",t)}get user_type(){return this._props.user_type}set user_type(t){this._requireString("user_type",t),this._set("user_type",t)}get site(){return this._props.site}set site(t){this._requireString("site",t),this._set("site",t)}get auth(){return this._props.auth}set auth(t){this._requireString("auth",t),this._set("auth",t)}_set(t,e){this._props[t]=e,this._plugin._events.emit("set",`${t} = '${e}'`)}_requireString(t,e){if("string"!=typeof e&&void 0!==e)throw Error(t+" must be a string");return e}}function qt(){const t=new URLSearchParams(window.location.search);let e=a({source:t.get("utm_source")||void 0,medium:t.get("utm_medium")||void 0,name:t.get("utm_campaign")||void 0,term:t.get("utm_term")||void 0,content:t.get("utm_content")||void 0});return 0===Object.keys(e).length?void 0:e}class jt{constructor(t){this._plugin=t,this._config={search:!0},this.interface=Object.freeze({config:this.config.bind(this)})}config(t={}){if("object"!=typeof t)throw Error("Config options must be an object or undefined: "+t);for(const e of t){if(!this._config.hasOwnProperty(e))continue;const s=this._config[e],i=t[e];i!==s&&(this._config[e]=s,this._plugin._events.emit("config",`${e}: ${s} -> ${i}`))}return Object.freeze({...this._config})}}function Dt(e){const{context:s={}}=e,i={...s.custom_context,sdk_version:t};return i.uuid||(i.uuid=E()),{...e,context:{...s,custom_context:i}}}const zt="std:native-fetch";let Mt,Ft;const Bt=(()=>{if((""+window.fetch).indexOf("[native code]")>-1)return Mt="original",window.fetch;try{const t=document.createElement("iframe");return t.style.display="none",document.head.appendChild(t),Mt="borrowed",t.contentWindow.fetch}catch(t){Ft=t}})();const Qt="std:header-api-key";const Gt="miso-logdump",Ht="miso-logdump",Wt=Ht+"__download-btn",Vt="Miso Log";class Yt{constructor(t={}){this._options=t,this._logs=[]}config(t={}){this._options={...this._options,...t}}async showDownloadButton(){await async function(){return Xt||(Xt=R(N("logdump")))}();let t=document.getElementById(Gt);if(!t){const e=document.createElement("div");e.textContent=this._options.logDownloadButtonText||Vt,e.classList.add(Wt),e.addEventListener("click",()=>this.download()),t=document.createElement("div"),t.id=Gt,t.classList.add(Ht),t.appendChild(e),document.body.appendChild(t)}t.style.display="block"}_syncUi(){const t=document.getElementById(Gt),e=t&&t.querySelector("."+Wt);e&&(e.textContent=this._options.logDownloadButtonText||Vt)}hideDownloadButton(){const t=document.getElementById(Gt);t&&(t.style.display="none")}download(){const t=new Blob([Zt(this._logs)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=this._filename(),s.click()}_filename(){let{logFilename:t}=this._options;if("function"==typeof t){t=t({timestamp:Kt()})}return t&&"string"==typeof t?t:`miso-log.${Kt()}.jsonl`}clear(){this._logs=[]}}function Kt(){return(new Date).toISOString().replaceAll(/[\:\.]/g,"-")}function Zt(t){return t.map(t=>JSON.stringify(U(function(t){if("<progressive-markdown>"===t[0]){const e=t.length;return[...t.slice(0,e-1),Jt(t[e-1])]}return t}(t),{depth:10}))).join("\n")}function Jt(t){return t?U(t,{depth:2}):t}let Xt;const te="std:debug";function ee(t){const e=typeof t;return"function"===e||"object"===e&&!Array.isArray(t)?[t]:t}Nt.plugins.register(class{constructor(t={}){this._options=t,this._logs=new Yt(t)}static get id(){return te}install(t){this._injectComponents(t),t.debug=(...t)=>this._logr(...t),t.logs=this._logs}config(t={}){this._options={...this._options,...t},this._logs.config(t),t.preserveLog&&this._log(te,"ua",window.navigator.userAgent)}_injectComponents(t,e=[]){t.on("child",t=>this._injectComponents(t,e)),t.on("subtree",s=>this._injectComponents(s,e.concat(t.meta.path))),t.on("*",(s,i)=>this._handleEvent(t,i,s,e))}_handleEvent(t,{name:e},s,i=[]){if("child"===e||"subtree"===e)return;const o=i.concat(t.meta.path);if(o.length||"create"!==e){switch(o[0]){case"client":if("api"===o[1])return void this._handleApiEvent(e,{...s,groupName:o[2]});break;case"plugins":return void(1===o.length?this._handlePluginsEvent(e,s):this._handlePluginSpecificEvent(o[1],o.slice(2),e,s))}this._logw(o.join("."),e,s)}else this._handleCreateClient(e,s)}_handleCreateClient(t,e){this._logw("client",t,e)}_handleApiEvent(t,{groupName:e,apiName:s,url:i,bulk:o,...n}){const r=new URL(i).pathname,a=["api",t];if(o&&a.push(`(bulk ${o.bulkId})`),a.push("POST "+r),"interactions"===e){const t=n.payload.data[0],{type:e,custom_action_name:s,context:{custom_context:{property:i}={}}={}}=t,o="custom"===e&&s?`${e}:${s}`:e;a.push(i?`${o} (${i})`:""+o)}a.push([{...n,url:i}]),this._log(...a)}_handlePluginsEvent(t,e){let s=[];Array.isArray(e)&&(s=e.slice(1),e=e[0]),this._log("plugins",t,""+(e.id||"(anonymous)"),[e,...s])}_handlePluginSpecificEvent(t,e,s,i){this._logw([t,e.join(".")],s,i)}_getPath(t){const e=[];for(let s=t;s;s=s.meta.parent)s.meta.name&&e.push(s.meta.name);return e.reverse()}_logw(t,e,s){void 0===s?this._log(t,e):Array.isArray(s)?this._log(t,e,...s.map(ee)):this._log(t,e,ee(s))}_log(t,e,...s){this._logr(function(t){return`<${"string"==typeof t?t:t.filter(t=>t).join("/")}>`}(t),function(t){return`[${t}]`}(e),...s)}_logr(...t){const e=this._options.console||{};this._options.preserveLog&&this._logs._logs.push(t),console.log(function({text:t="Miso"}={}){return"%c"+t}(e),function({color:t="#fff",background:e="#334cbb"}={}){return`color: ${t}; background-color: ${e}; padding: 2px 2px 1px 4px;`}(e),...t)}},class{constructor(t={}){this._options=t,this.id="std:dry-run",this.name="dry-run"}static get id(){return"std:dry-run"}install(t,{addUrlPass:e}){e(this._modifyUrl.bind(this))}_modifyUrl({apiGroup:t,apiName:e,url:s}){return"interactions"===t&&"upload"===e?function(t,e,s){if("string"!=typeof e)throw Error("Expect URL parameter to be a string: "+e);return void 0===s&&(s="1"),t+(0>t.indexOf("?")?"?":"&")+encodeURIComponent(e)+"="+encodeURIComponent(""+s)}(s,"dry_run","1"):s}},class{static get id(){return zt}install(t,e){Bt?(e.setCustomFetch(Bt),t.debug(`<plugin:${zt}>`,"[info]",`Using ${Mt} native fetch`)):t.debug(`<plugin:${zt}>`,"[error]","Failed to obtain native fetch: "+Ft.message)}},class{static get id(){return Qt}install(t,e){e.addUrlPass(this._modifyUrl.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),t.debug(`<plugin:${Qt}>`,"[info]","Send API key in header")}_modifyUrl({url:t}){return t.replace(/[?&]api_key=[^&]*/g,"")}_modifyHeaders({client:t,headers:e}){const{apiKey:s}=t.options;return s?{...e,"X-API-KEY":s}:e}}),Nt.plugins.use(class extends Y{static get id(){return"std:context"}constructor(){super("context")}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addHeadersPass(this._modifyHeaders.bind(this)),e.addPayloadPass(this._modifyPayload.bind(this))}_injectClient(t){const e=new Pt(this);var s,i;s=e,Object.defineProperties(t.context,(i="string"==typeof(i=["anonymous_id","user_id","user_hash","user_type","site","auth"])?[i]:i).reduce((t,e)=>(t[e]={get:()=>s[e],set:t=>{s[e]=t}},t),{}))}_modifyHeaders({client:t,headers:e}){const{auth:s}=t.context;return s&&(e={...e,Authorization:s}),e}_modifyPayload({client:t,apiGroup:e,apiName:s,payload:i}){return i?e===$t.INTERACTIONS?s===Lt.UPLOAD?this._modifyPayloadForInteractions(t,i):i:this._modifyPayloadForQueries(t,i):i}_modifyPayloadForQueries(t,e){const{user_id:s,user_hash:i,user_type:o,anonymous_id:n,site:r}=t.context;return D(e,{...s?{user_id:s,user_type:o,user_hash:i}:{anonymous_id:n},metadata:r?{site:r}:void 0})}_modifyPayloadForInteractions(t,{data:e}){const{anonymous_id:s,user_id:i,site:o}=t.context,n={anonymous_id:s,user_id:i},r=o?{site:o}:void 0,a=r?{custom_context:r}:void 0;return{data:e=e.map(t=>z(t,{...n,context:a}))}}}),Nt.plugins.use(class{static get id(){return"std:page-info"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t=t.map(t=>({...t,context:{...a({page:a({url:window.location.href,referrer:document.referrer||void 0,title:document.title}),campaign:qt()}),...t.context}}))}}}),Nt.plugins.use(class extends Y{static get id(){return"std:auto-events"}constructor(){super("auto-events"),this._contexts=new WeakMap}install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this)),e.addPayloadPass(this._captureApiRequest.bind(this))}_injectClient(t){const e=new jt(this);this._contexts.set(t,e),t.autoEvents=e.interface}_captureApiRequest({client:t,apiGroup:e,apiName:o,payload:n}){if(e===s.SEARCH)if(o===i.SEARCH)this._captureSearchApiRequest(t,n)}_captureSearchApiRequest(t,{q:e}){if(!e||"*"===e)return;const s=this._contexts.get(t);s&&s._config.search&&t.api.interactions.upload({type:"search",search:{keywords:e},context:{custom_context:{channel:"miso_api"}}})}}),Nt.plugins.use(class{static get id(){return"std:interactions"}constructor(){}install(t,{addPayloadPass:e}){e(this._modifyPayload.bind(this))}_modifyPayload({apiGroup:t,apiName:e,payload:s}){return"interactions"===t&&"upload"===e?this._modifyPayloadForInteractions(s):s}_modifyPayloadForInteractions({data:t}){return{data:t.map(Dt)}}}),Nt.plugins.use(class extends Y{static get id(){return"std:api-patch"}constructor(){super("api-patch")}install(t,e){e.addSubtree(this),e.addPayloadPass(this._patchApiPayload.bind(this))}_patchApiPayload(t){let{payload:e,...s}=t;return e?(e=this._copyMetadataToMeta(e,s),e=this._suppressMetadata(e,s),e=this._suppressUserType(e,s),e):e}_copyMetadataToMeta(t,{apiGroup:e}){return e===s.ASK&&t.metadata?{...t,_meta:t.metadata}:t}_suppressMetadata(t,{apiGroup:e}){switch(e){case s.SEARCH:case s.RECOMMENDATION:const{_meta:e,metadata:i,...o}=t;return o;default:return t}}_suppressUserType(t,{apiGroup:e}){switch(e){case s.SEARCH:case s.RECOMMENDATION:const{user_type:e,...i}=t;return i;default:return t}}});const se="default",ie=Object.freeze({CONTAINER:"container",BANNER:"banner",QUERY:"query",FEEDBACK:"feedback",PRODUCTS:"products",CATEGORIES:"categories",ATTRIBUTES:"attributes",RESULTS:"results",ITEMS:"items",QUESTION:"question",ANSWER:"answer",REASONING:"reasoning",IMAGES:"images",SOURCES:"sources",RELATED_RESOURCES:"related_resources",FOLLOW_UP_QUESTIONS:"follow_up_questions",QUERY_SUGGESTIONS:"query_suggestions",RELATED_QUESTIONS:"related_questions",AFFILIATION:"affiliation",KEYWORDS:"keywords",FACETS:"facets",TOTAL:"total",MORE:"more",SORT:"sort",ERROR:"error"}),oe=new Set([ie.PRODUCTS,ie.CATEGORIES,ie.ATTRIBUTES,ie.RESULTS,ie.ITEMS,ie.QUESTION,ie.ANSWER,ie.REASONING,ie.IMAGES,ie.SOURCES,ie.RELATED_RESOURCES,ie.FOLLOW_UP_QUESTIONS,ie.QUERY_SUGGESTIONS,ie.RELATED_QUESTIONS,ie.AFFILIATION,ie.FACETS,ie.TOTAL]);function ne(t){return oe.has(t)}const re=new Set([ie.PRODUCTS,ie.IMAGES,ie.SOURCES,ie.RELATED_RESOURCES]);const ae=Object.freeze({IMPRESSION:"impression",VIEWABLE:"viewable",CLICK:"click",SUBMIT:"submit",FEEDBACK:"feedback"}),ce=[ae.IMPRESSION,ae.VIEWABLE,ae.CLICK,ae.SUBMIT,ae.FEEDBACK],le=[ae.IMPRESSION,ae.VIEWABLE,ae.CLICK],ue=new Set(le);const he=Object.freeze({UNTRACKED:"untracked",TRACKING:"tracking",TRIGGERED:"triggered"}),de=Object.freeze({INITIAL:"initial",LOADING:"loading",ERRONEOUS:"erroneous",READY:"ready",ONGOING:"ongoing",DONE:"done",EMPTY:"empty",NONEMPTY:"nonempty",UNANSWERABLE:"unanswerable"}),_e=Object.freeze({ORGANIC:"_organic",SUGGESTED_QUESTIONS:"_suggested_questions",INLINE_QUESTION_LINK:"_inline_question_link"});function pe(t){if(0>ce.indexOf(t))throw Error("Unrecognized event type: "+t)}const me=Object.freeze({API:"api",LAYOUTS:"layouts",DATA_PROCESSOR:"dataProcessor",TRACKERS:"trackers",INTERACTIONS:"interactions",FILTERS:"filters",PAGINATION:"pagination",TEMPLATES:"templates"}),fe=Object.freeze({QUERY:"query",REFINE:"refine",MORE:"more"});function ge(t,e){return Object.freeze({...t,...e,members:be(t.members,e.members),mappings:Object.freeze({...t.mappings,...e.mappings})})}function be(t=[],e=[]){return[...new Set([...t,...e])]}function ye(t,e){let s={};for(const i of t)i&&(s=e(s,i));return a(s)}function ve(t){if(void 0===t)throw Error("Expect options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t}function we(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>Object.assign(t,{...e,payload:D(t.payload,e.payload)}))}function Ee(t){return t=function(t){return t.replaceAll("-","_")}(t=t.replace(/[A-Z]/g,t=>"_"+t.toLowerCase()))}function xe(t){if(void 0===t)return;let[e,s]=r(t);return"object"==typeof e&&(s=e,e=void 0),[e,s]}function Se(t,e){return!1===(e=xe(e))[0]?e:t&&e?[e[0]||t[0],Oe(t[1],e[1])]:e||t}function Oe(t,e){return{...t,...e,link:{...t&&t.link,...e&&e.link},templates:{...t&&t.templates,...e&&e.templates}}}const ke=Object.freeze({active:!0,impression:Object.freeze({active:!0}),viewable:Object.freeze({active:!0,area:.5,duration:1e3}),click:Object.freeze({active:!0,lenient:!1})});function Ie(t={}){t=ve(t);const{active:e,...s}=t;for(const[t,e]of Object.entries(s))Ce(e);return t}function Ce(t={}){return t=ve(t)}function Te(t={},e={}){const s={...t};for(const[i,o]of Object.entries(e))void 0!==o&&(s[i]=ce.includes(i)?Ae(t[i],o):o);return s}function Ae(t={},e={}){return{...t,...e}}function Re(t){return void 0===t?void 0:"function"!=typeof t?()=>t:t}function Ne(t,e){return Re(e)||t}const $e=[{key:me.API,normalize:function([t,e]=[]){if(!1===t)return{actor:!1};let s;if("object"==typeof t&&void 0===e&&(e=t,t=void 0),t&&-1!==t.indexOf("/")&&([s,t]=t.split("/")),t&&"string"!=typeof t||void 0!==e&&"object"!=typeof e)throw Error(`Invalid arguments for useApi(): ${t}, ${e}`);return a({group:s,name:t,payload:e})},merge:we},{key:me.LAYOUTS,normalize:function(t={}){if(!1===t)return!1;const{results:e,...s}=t;void 0!==e&&(console.warn(`useLayouts({ results: ... }) is deprecated, use useLayouts({ ${ie.PRODUCTS}: ... }) instead`),t={...s,[ie.PRODUCTS]:e});const i={};for(const[e,s]of Object.entries(t))i[Ee(e)]=xe(s);return i},merge:function(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>{for(const[s,i]of Object.entries(e))t[s]=Se(t[s],i);return t})}},{key:me.DATA_PROCESSOR,normalize:function(t){t=r(t);for(const e of t)if("function"!=typeof e)throw Error("Expect data processor options to be a function: "+e);return t},merge:function(...t){return t.flat().filter(Boolean)}},{key:me.TRACKERS,normalize:function(t={}){t=ve(t);const{active:e,...s}=t,i={};for(const[t,e]of Object.entries(s))i[t]=Ie(e);return{active:e,...i}},merge:function(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>{for(const[s,i]of Object.entries(e))void 0!==i&&(t[s]="active"===s?i:Te(t[s],i));return t})}},{key:me.INTERACTIONS,normalize:function(t){if(void 0===t)return;if(!1===t)return{handle:()=>{}};const e=r(t.preprocess);for(const t of e)if("function"!=typeof t)throw Error("Expect preprocess options to be a function: "+t);if(t.handle&&"function"!=typeof t.handle)throw Error("Expect handle options to be a function: "+t.handle);return{...t,preprocess:e}},merge:function(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>{return Object.assign(t,{...e,preprocess:(s=t.preprocess,i=e.preprocess,s&&s.length?i&&i.length?[...s,...i]:s:i)});var s,i})}},{key:me.FILTERS,normalize:ve,merge:function(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>Object.assign(t,e))}},{key:me.PAGINATION,normalize:function(t){if(void 0===t)throw Error("Expect pagination options to be an object or a boolean value: "+t);return"boolean"==typeof t&&(t={active:t}),t},merge:function(...t){return!1!==t[t.length-1]&&ye(t,(t,e)=>Object.assign(t,e))}},{key:me.TEMPLATES,normalize:function(t={}){const e={};for(const[s,i]of Object.entries(t))e[s]=Re(i);return e},merge:function(...t){return ye(t,(t,e)=>{for(const[s,i]of Object.entries(e))t[s]=Ne(t[s],i);return t})}}];class Le{constructor(){this._events=new W({target:this}),this._globals={}}_notify(t){this._events.emit(t),this._events.emit("_update",t)}}class Ue{constructor(t={},e={}){this._events=new W({target:this}),this._defaults=e,this._context=t||{},this._locals={},u(this,{resolved:new Pe(this),defaults:e}),t&&t.on&&(this._unsubscribes=[t.on("_update",t=>this._notify(t))])}_notify(t){this.resolved._invalidate(t),this._events.emit(t)}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}}class Pe{constructor(t){this._options=t,this._cache={}}_invalidate(t){this._cache[t]=void 0}_get({key:t,merge:e}){if(void 0===this._cache[t]){const s=this._options,i=s._context[t];this._cache[t]=e(s._defaults[t],i&&i.get(),s._locals[t])}return this._cache[t]}}class qe{constructor(t,e,s,i,o){this._options=t,this._store=e,this._key=s,this._normalize=t=>void 0!==t?i(t):void 0,this._merge=o}get(){return this._store[this._key]}set(t){this._set(this._normalize(t))}merge(t){this._set(this._merge(this.get(),this._normalize(t)))}_set(t){this._store[this._key]=t,this._options._notify(this._key)}}for(const t of $e){const{key:e,normalize:s,merge:i}=t;Object.defineProperty(Le.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new qe(this,this._globals,e,s,i))}}),Object.defineProperty(Ue.prototype,e,{get:function(){const t="_"+e;return this[t]||(this[t]=new qe(this,this._locals,e,s,i))}}),Object.defineProperty(Pe.prototype,e,{get:function(){return this._get(t)}})}const je=[me.API,me.LAYOUTS,me.DATA_PROCESSOR,me.TRACKERS,me.INTERACTIONS];function De(t,e=je){for(const s of e)ze(t,s)}function ze(t,e){if("api"===e)Object.assign(t,{useApi(...t){return this._options.api.merge(t),this},clearApi(){return this._options.api.set(),this}});else{const i=(s=e).charAt(0).toUpperCase()+s.slice(1);Object.assign(t,{["use"+i](t){return this._options[e].merge(t),this},["clear"+i](){return this._options[e].set(),this}})}var s}function Me(t={}){const{setValue:e,focus:s,param:i,sourceParam:o}=this._autoQuery=function({setValue:t=!0,focus:e=!0,updateUrl:s=!0,param:i="q",sourceParam:o="qs",...n}={}){return{setValue:t,focus:e,updateUrl:s,param:i,sourceParam:o,...n}}(t),n=new URLSearchParams(window.location.search),r=n.get(i),c=n.get(o)||void 0,{layout:l}=this._views.get(ie.QUERY);l&&(r&&e&&(l.value=r),!r&&s&&l.focus()),r&&this.query(a({q:r,qs:c}))}function Fe({value:t,request:e}){if(!this._autoQuery||!this._autoQuery.updateUrl)return;const{param:s,sourceParam:i}=this._autoQuery,o=t&&(t.question||t.keyword)||e&&e.payload&&(e.payload.question||e.payload.q),n=e&&e.payload&&e.payload.metadata&&e.payload.metadata.question_source;if(!o)return;const r=new URL(window.location),a=r.searchParams.get(s),c=r.searchParams.get(i)||_e.ORGANIC;o===a&&n===c||(r.searchParams.set(s,o),n===_e.ORGANIC?r.searchParams.delete(i):r.searchParams.set(i,n),window.history.replaceState({},"",r))}class Be extends Y{constructor(t,e,s){super(t,e),this._name=t,this._plugin=e,this._client=s,this._options=new Le}}function Qe(t){return t?"view:"+t:"view"}De(Be.prototype);class Ge{constructor(t={}){(this._events=new W)._injectSubscribeInterface(this),this._options=t,this._states={},u(this,{states:new Proxy(this._states,{set(){}})})}update(t,e,s={}){this._states[t]=Object.freeze(e);const i=Object.freeze({action:"update",name:t,state:e,...s});"function"==typeof this._options.onUpdate&&this._options.onUpdate(i),s.silent||this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(i)}trigger(t,e){const s=Object.freeze({action:"trigger",name:t,state:e});"function"==typeof this._options.onUpdate&&this._options.onUpdate(s),this._events.emit(t,e),"function"==typeof this._options.onEmit&&this._options.onEmit(s)}}class He{constructor(t){this._hub=t,this._sessionIndex=0}restart(){const t=Object.freeze({uuid:E(),index:this._sessionIndex++,meta:{}});this._hub.update("session",t)}}function We(t,e){if(!e)return!1;const{session:s}=t.states;return s&&s.index===e.index}class Ve{constructor(t,{source:e,options:s,polling:i=!0}){this._hub=t,this._source=e,this._options=s,this._polling=i,this._unsubscribes=[t.on("session",t=>this._handleSession(t)),t.on("request",t=>this._handleRequest(t))]}get active(){return!1!==this._options.resolved.api.actor}get source(){return this._source}_handleSession(t){this._session&&t.index===this._session.index||(this._ac&&this._ac.abort({type:"new-session",message:"A new session is created, discarding the old one."}),this._ac=new AbortController),this._session=t}async _handleRequest(t){if(!this.active)return;const{session:e,...s}=t;try{const{signal:i}=this._ac||{},o={...t.options,signal:i},n=await this._source({session:e,...s,options:o});if(n&&n[Symbol.asyncIterator]){if(n._response&&this._emitResponseWithSessionCheck({session:e,request:s,value:n._response}),this._polling){let t;for await(t of n){if(!We(this._hub,e))break;this._emitResponse({session:e,request:s,value:t})}}}else this._emitResponseWithSessionCheck({session:e,request:s,value:n})}catch(t){this._error(t),this._emitResponseWithSessionCheck({session:e,request:s,error:t})}}_emitResponseWithSessionCheck(t){We(this._hub,t.session)&&this._emitResponse(t)}_emitResponse(t){this._hub.update("response",t)}_error(t){console.error(t)}_destroy(){this._ac&&this._ac.abort({type:"data-actor-destroy",message:"Data actor is destroyed."});for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class Ye{constructor(t){this._get="function"==typeof t?t:()=>t,this._handlers=[],this._elementUpdatedHandlers=[],this.sync()}get current(){return this._element}on(t,e){if("element"===t)return this._onElementUpdated(e);const s=this._get();return s&&s.addEventListener(t,e),this._handlers.push({event:t,handler:e}),()=>this._off(t,e)}_off(t,e){const s=this._get();s&&s.removeEventListener(t,e),function(t,e){if(!t)return;const s=t.findIndex(e);s>-1&&t.splice(s,1)}(this._handlers,t=>t.handler===e)}_onElementUpdated(t){return this._elementUpdatedHandlers.push(t),()=>{n(this._elementUpdatedHandlers,t)}}sync({silent:t=!1}={}){const e=this._get();if(this._element===e)return;if(this._offAllFromCurrentElement(),e)for(const{event:t,handler:s}of this._handlers)e.addEventListener(t,s);const s=this._element;if(this._element=e,!t)for(const t of this._elementUpdatedHandlers)try{t(e,s)}catch(t){console.error(t)}}_offAllFromCurrentElement(){if(this._element)for(const{event:t,handler:e}of this._handlers)this._element.removeEventListener(t,e)}destroy(){this._offAllFromCurrentElement()}}const{IMPRESSION:Ke,VIEWABLE:Ze,CLICK:Je}=ae,{UNTRACKED:Xe,TRIGGERED:ts}=he,es=Object.freeze({[Ke]:Xe,[Ze]:Xe,[Je]:Xe});class ss{constructor(t){this.sessionId=t,this._states=new Map}getFullState(t){const e=this._states.get(this._getKey(t));return e?{...e}:es}get(t,e){const s=this._states.get(this._getKey(t));return s&&s[e]||Xe}set(t,e,s){pe(e),function(t){if(t!==he.UNTRACKED&&t!==he.TRACKING&&t!==he.TRIGGERED)throw Error("Unrecognized tracking status: "+t)}(s);for(const i of r(t))this._setOne(i,e,s)}untriggered(t,e){return t.filter(t=>this.get(t,e)!==ts)}_getKey(t){return t.product_id||t.text||t.id||t}_setOne(t,e,s){(function(t,e,s){if(t.has(e))return t.get(e);const i=s(e);return t.set(e,i),i}(this._states,this._getKey(t),()=>({...es})))[e]=s}}const is=[Symbol("itemless")];class os{constructor({hub:t,role:e,options:s}){this._hub=t,this._role=e,this._options=s,this._states=new ss(this._getSessionId())}get options(){return"function"==typeof this._options?this._options():this._options}getState(t){return this._states.getFullState(t)}_trigger(t,e,s){pe(t);const{options:i}=this;if(!i||!1===i.active)return;this._syncSession();const{deduplicated:o=!0,itemless:n=!1}=i;if(o){if(n&&(e=is),0===(e=this._states.untriggered(r(e),t)).length)return;this._states.set(e,t,he.TRIGGERED)}this._sendToHub({type:t,items:n?void 0:e,...s})}submit({value:t}){this._syncSession(),this._sendToHub({type:ae.SUBMIT,value:t})}_sendToHub(t){this._hub.trigger("tracker",Object.freeze(a({role:this._role,...t})))}_syncSession(){const t=this._getSessionId();t&&(this._states&&t===this._states.sessionId||(this._states=new ss(t)))}_getSessionId(){const{session:t}=this._getViewState()||{};return t&&t.uuid}_getMisoId(){const t=this._getViewState();return t&&t.meta&&t.meta.miso_id||void 0}_getRequestPayload(){const{request:t}=this._getViewState()||{};return t&&t.payload}_getViewState(){return this._hub.states[Qe(this._role)]}}for(const t of le)os.prototype[t]=function(e,s){this._trigger(t,e,s)};function ns(t){return t&&t.meta&&t.meta.empty}class rs{constructor(t,e){this._events=new W({target:this}),this._views=t,this._mapping=cs((t._roles.mappings||{})[e]||e),u(this,{role:e,interface:new as(this)})}get hub(){return this._views._hub}get element(){return this._element}set element(t){t!==this._element&&(this._element&&this._safeApplyOnLayout("unrender",this._element),this._element=t,this._proxyElement&&this._proxyElement.sync(),this._events.emit("element",t),this.refresh({force:!0}))}get proxyElement(){return this._proxyElement||(this._proxyElement=new Ye(()=>this.element)),this._proxyElement}get layout(){return this._layout}set layout(t){if(t===this._layout)return;if(t&&"function"!=typeof t.render)throw Error("Render function is mandatory in a layout.");const{element:e}=this;e&&this._safeApplyOnLayout("unrender",e),this._safeApplyOnLayout("destroy"),this._layout=t,t&&(t._view=this,"function"==typeof t.initialize&&t.initialize(this)),this.refresh({force:!0})}get tracker(){const{role:t}=this;if(t===ie.CONTAINER)return this._views._getContainerTracker();if(!this._tracker){const{hub:e}=this;this._tracker=new os({hub:e,role:t,options:()=>this.trackerOptions})}return this._tracker}get workflow(){return this._views._workflow}get workflowOptions(){return this._views._options.resolved}get trackerOptions(){return this._views._getTrackerOptions(this.role)}get filters(){return this._views.filters}async refresh({force:t=!1,data:e}={}){if(!this._layout)return;const{element:s}=this;if(!s)return;const i=this._data;if(this._data=e=this._sliceData(e||this._views._getData()),!t&&((o=e)===(n=i)||o&&n&&o.status===n.status&&o.error===n.error&&o.value===n.value&&o.ongoing===n.ongoing&&ns(o)===ns(n)&&function(t,e){return t===e||t&&e&&t.uuid===e.uuid}(o.session,n.session)))return;var o,n;const{session:r,status:a,ongoing:c,request:l,meta:u,value:h}=e,d={session:r,status:a,ongoing:c,request:l,meta:u,data:h,...ls(this.role,e)},_=(t={},e)=>{!1!==t&&this.updateState({...d,...t},e)};try{await this._layout.render(s,e,{notifyUpdate:_})}catch(t){this._error(t),_({error:t})}}updateState(t,{silent:e=!1}={}){const s=t.error?de.ERRONEOUS:t.status;t=this._state=Object.freeze(a({...t,status:s}));const{role:i}=this;this.hub.update(Qe(i),t,{silent:e})}_sliceData(t){const{value:e,error:s,status:i,meta:o,...n}=t,r={value:this._mapping(t,this),status:i,data:e,meta:o,...n};return this.role===ie.CONTAINER&&(r.meta={...o,empty:this._isContainerEmpty(t)}),a(r)}_isContainerEmpty(t){const{element:e}=this;if(!e)return!1;for(const{role:s}of e.components){if(!ne(s))continue;if(!us(s,cs((this._views._roles.mappings||{})[s]||s)(t,this)))return!1}return!0}_syncSize(){this._element&&this._safeApplyOnLayout("syncSize",this._element)}_safeApplyOnLayout(t,...e){if(this._layout&&"function"==typeof this._layout[t])try{this._layout[t](...e)}catch(t){this._error(t)}}_error(t){this._views._error(t)}_destroy(){this._safeApplyOnLayout("destroy"),this._proxyElement&&this._proxyElement.destroy()}}class as{constructor(t){l(this,t,["role","layout","element","proxyElement","refresh","on","tracker"])}}function cs(t){switch(typeof t){case"function":return t;case"string":return e=>e.value&&e.value[t];default:throw Error("Invalid mapping function: "+t)}}function ls(t,e){return function(t){return t.status===de.READY&&!t.ongoing}(e)?{empty:!!us(t,e&&e.value)}:{}}function us(t,e){switch(t){case ie.ANSWER:case ie.REASONING:return!e||!e.value;default:return void 0===e||(Array.isArray(e)||"string"==typeof e)&&!e.length}}function hs(t){if(!t)return;const{options:e=[]}=t;for(const t of e)if(t.default)return Object.freeze(t);return Object.freeze(e[0])}class ds{constructor(t,{facets:e}={}){this._views=t,this._hub=t._hub;const s=this._error=this._error.bind(this);this._events=new W({target:this,error:s}),u(this,{facets:new _s(this,e)}),this._unsubscribes=[t._options.on("filters",()=>this._syncOptions())],this._syncOptions(),this._states=void 0}_syncOptions(){this._initialStates=function({sort:t}={}){return a({facets:Object.freeze({}),sort:hs(t)})}(this._views._options.resolved.filters),this.apply({silent:!0})}_getStates(){return this._states||this._initialStates}update(t){const e=this._getStates();this._states=function(t={},e={}){return Object.freeze(a({...t,...e,facets:Object.freeze(a({...t.facets,...e.facets}))}))}({...e,...t});const s=this._getStates();this._events.emit("update",{updates:t,states:s,oldStates:e})}reset({silent:t=!1}={}){const e=this._states;this._states=void 0;const s=this._getStates();this._hub.update("filters",s,{silent:t}),this._events.emit("reset",{states:s,oldStates:e})}apply({silent:t=!1}={}){const e=this._getStates();this._hub.update("filters",e,{silent:t}),!t&&this._events.emit("apply")}_error(t){this._views._error(t)}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class _s{constructor(t,e={}){this._filters=t,this._options=e}isSelected(t,e){return this._getFieldValues(t).includes(e)}select(t,e){this.isSelected(t,e)||this._select(t,e)}unselect(t,e){this.isSelected(t,e)&&this._unselect(t,e)}toggle(t,e){this.isSelected(t,e)?this._unselect(t,e):this._select(t,e)}_getFieldValues(t){return this._filters._getStates().facets[t]||[]}_select(t,e){const s=this._options.multivalued?[...this._getFieldValues(t),e]:[e];s.sort(),this._filters.update({facets:{[t]:s}})}_unselect(t,e){let s=this._getFieldValues(t).filter(t=>t!==e);0===s.length&&(s=void 0),this._filters.update({facets:{[t]:s}})}}const ps=Symbol.for("miso:tracked");function ms(t){return!!t[ps]}function fs(t){t[ps]=!0}const gs=Object.freeze({impression:Object.freeze({}),viewable:Object.freeze({area:.5,duration:1e3}),click:Object.freeze({lenient:!1})});function bs(t,e){return!!e&&{...t,...e}}class ys{constructor(t,{workflow:e,extensions:s,layouts:i,roles:o,options:n}){this._hub=t,this._workflow=e,this._workflowName=e._name,this._extensions=s,this._layoutFactory=i,this._options=n,this._roles=o,this._containers=new Map,this._containerTracker=void 0,this._views={},this._filters=new ds(this);for(const t of o.members)t!==ie.CONTAINER&&(this._views[t]=new rs(this,t));u(this,{interface:new vs(this),trackers:new ws(this,o.members)});const r=()=>this.syncSize();window.addEventListener("resize",r),this._unsubscribes=[()=>window.removeEventListener("resize",r),t.on("data",t=>this.refresh({data:t})),n.on("layouts",()=>this._syncLayouts())],this._syncLayouts()}get filters(){return this._filters}addContainer(t){if(this._containers.has(t))return;const e=new rs(this,ie.CONTAINER);e.layout=this._createLayout(ie.CONTAINER),e.element=t,this._containers.set(t,e);const{components:s}=t;for(const t of s)this.addComponent(t)}removeContainer(t){const e=this._containers.get(t);if(!e)return;const{components:s}=t;for(const t of s)this.removeComponent(t);e._destroy(),this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t}removeComponent(t){this._getViewByElement(t).element=void 0}updateComponentRole(t,e,s){}containsElement(t){return this._containers.has(t)||this._views[t.role]}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_syncLayouts(){const{layouts:t}=this._options.resolved;if(!1===t){for(const t of this._containers.values())t.layout=void 0;for(const t of Object.values(this._views))t.layout=void 0}else for(let[e,[s,i]]of Object.entries(t)){const t=()=>this._layoutFactory.create(s,{...i,role:e,workflow:this._workflowName});if(e===ie.CONTAINER)for(const e of this._containers.values())e.layout=t();else{const s=this.get(e);s&&(s.layout=t())}}}_createLayout(t){const e=this._options.resolved.layouts[t];if(!e)return;const[s,i]=e;return this._layoutFactory.create(s,{...i,role:t,workflow:this._workflowName})}get(t){return this._views[t]}get views(){return this._getViews(!0)}_getViews(t=!0){return t?[...this._containers.values(),...Object.values(this._views)]:[...Object.values(this._views),...this._containers.values()]}syncSize(){for(const t of Object.values(this._views))t._syncSize()}async refresh({force:t,data:e}={}){e=this._getData(e);let s=this._getViews(!0);await Promise.all(s.map(s=>s.refresh({force:t,data:e})))}_getData(t){return t||this._hub.states.data}_getTrackerOptions(t){const e=this._options.resolved.trackers;return function(t){if(!1===t)return!1;if(!0===t&&(t={}),"object"!=typeof t)throw Error("Invalid options: "+t);const{impression:e={},viewable:s={},click:i={},...o}=t;return a({...gs,...o,impression:bs(gs.impression,e),viewable:bs(gs.viewable,s),click:bs(gs.click,i)})}(e&&e[t]||!1)}_getContainerTracker(){if(!this._containerTracker){const t=ie.CONTAINER;this._containerTracker=new os({hub:this._hub,role:t,itemless:!0,options:()=>this._getTrackerOptions(t)})}return this._containerTracker}_error(t){console.error(t)}_destroy({}={}){for(const t of this._getViews(!1))t._destroy();for(const t of this._unsubscribes)t();this._unsubscribes=[],this._filters._destroy()}}class vs{constructor(t){this._actor=t,l(this,t,["syncSize","refresh","trackers","filters"])}get(t){return this._actor.get(t).interface}get all(){return this._actor.views.map(t=>t.interface)}}class ws{constructor(t,e){this._views=t;for(const s of e)s!==ie.CONTAINER&&Object.defineProperty(this,s,{get:()=>t.get(s).tracker});Object.defineProperty(this,ie.CONTAINER,{get:()=>t._getContainerTracker()})}}class Es{constructor(t){this._hub=t,this._unsubscribes=[t.on("feedback",t=>this._trigger(t))]}_trigger(t){this._hub.trigger("tracker",{type:ae.FEEDBACK,result_type:"answer",value:t.unselected?"unselected":t.value})}_destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}class xs{constructor(t,{client:e,options:s}){this._client=e,this._options=s,this._unsubscribes=[t.on("interaction",t=>this._handle(t))]}_handle(t){0!==(t=r(t)).length&&this._client.api.interactions.upload(t,{merge:!0})}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[]}}function Ss(t){return async({group:e,name:o,payload:n,options:r})=>{if(e===s.ASK)switch(o){case i.QUESTIONS:return t.api.ask.questions(n,r);case i.SEARCH:return t.api.ask.search(n,r)}return t.api[e]._run(o,n,r)}}class Os{constructor({role:t,workflow:e,...s}={}){u(this,{role:t,workflow:e,options:s}),this._unsubscribes=[],this._rendered=new WeakMap,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}async render(t,e,s={}){this._syncElement(t);const i=this._rendered.get(t),o=O(!1);e=this._preprocess({state:e,rendered:i},{skip:o.t})||e,this._updatePending(e,s),o.value||this._handleInput({state:e,rendered:i},s)}_syncElement(t){this._element!==t&&this._rendered.delete(this._element),this._element=t}_preprocess({state:t}){return t}_updatePending(t,e){this._pending=[Object.freeze(t),e]}_takePending(){const t=this._pending;return this._pending=void 0,t}_handleInput(){this._requestRaf()}_requestRaf(){this._requested||(this._requested=!0,y(t=>this._doRaf(t)))}_doRaf(t){this._requested&&(this._requested=!1,this._applyRender(t))}_applyRender(t,e={}){if(!this._pending)return;let[s,{notifyUpdate:i}]=this._takePending();s=Object.freeze({...s,timestamp:t});const o=this._rendered.get(this._element),n=O([]),r=O({});this._render(this._element,{state:s,rendered:o,timestamp:t},{notifyUpdate:n.args,writeToState:r.merge,...e}),s=Object.freeze({...s,...r.value}),this._rendered.set(this._element,s),i&&i(...n.value),this._afterRender(this._element,s)}_render(){throw Error("Unimplemented")}_afterRender(){}destroy(){for(const t of this._unsubscribes)t();this._unsubscribes=[],this._view=void 0,this._element=void 0,this._notifyUpdate=void 0,this._pending=void 0}}function ks(...t){return t.reduce((t,e)=>(t[e]=function(t){return()=>{throw Error(`Template '${t}' is not implemented.`)}}(e),t),{})}function Is(t,e,s,i){const{templates:o}=t,[n,r]=Qs(t,s);return""+n+(o.indexBlock||Fs)(t,s,i)+(o.infoBlock||o.articleInfoBlock||Rs)(t,s,i)+r}function Cs(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||$s)(t,e,s)+(o.descriptionBlock||Us)(t,e,s)+(o.priceBlock||Ds)(t,e,s)+(o.ctaBlock||Bs)(t,e,s)}</div>`}function Ts(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||$s)(t,e,s)+(o.descriptionBlock||Us)(t,e,s)+(o.priceBlock||Ds)(t,e,s)}</div>`}function As(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||$s)(t,e,s)+(o.dateBlock||Ps)(t,e,s)+(o.descriptionBlock||Us)(t,e,s)+(o.ctaBlock||Bs)(t,e,s)}</div>`}function Rs(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||$s)(t,e,s)+(o.authorsAndDateBlock||js)(t,e,s)}</div>`}function Ns(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-info-container">${""+(o.titleBlock||$s)(t,e,s)}</div>`}function $s({className:t},{title:e,_title_with_markups:s}){const i=Vs(s)||w(e);return i?`<div class="${t}__item-title">${i}</div>`:""}function Ls({className:t},{brand:e,brand_logo:s}){if(!e&&!s)return"";return`<div class="${t}__item-brand-container">${s?`<img class="${t}__item-brand-logo" src="${s}"${e?` alt="${e}"`:""}>`:`<div class="${t}__item-brand">${e}</div>`}</div>`}function Us({className:t},{snippet:e,description:s}){return e?`<div class="${t}__item-snippet">${Vs(e)}</div>`:s?`<div class="${t}__item-desc">${w(s)}</div>`:""}function Ps({className:t,templates:e},{created_at:s,updated_at:i,published_at:o}){const n=o||s||i;return n?`<div class="${t}__item-date">${Ws(n,e.date)}</div>`:""}function qs({className:t},{authors:e}){return e&&Array.isArray(e)&&e.length?`<div class="${t}__item-authors">${e.join(", ")}</div>`:""}function js(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__item-authors-and-date-container">${""+(o.authorsBlock||qs)(t,e,s)+(o.dateBlock||Ps)(t,e,s)}</div>`}function Ds(t,e){const{className:s,templates:i}=t,{sale_price:o,original_price:n,currency:r="USD"}=e,a=o||n;if(!a)return"";const c=void 0!==n&&void 0!==o&&n>o,l=e.discount_rate_percent||(c?Math.floor(100*(1-o/n)):void 0);let u="";if(c&&(u+=`<span class="${s}__item-original-price miso-price" data-currency="${r}">${n}</span><br>`),u+=`<span class="${s}__item-price miso-price" data-currency="${r}">${a}</span>`,l){u+=` <span class="${s}__item-discount-rate">${(i.discountRateText||zs)(t,{...e,discount_rate_percent:l})}</span>`}return`<div class="${s}__item-price-container">${u}</div>`}function zs(t,{discount_rate_percent:e}){return`(${e}% off)`}function Ms(t,e,s={}){const{className:i,templates:o}=t,{cover_image:n,image_src:r,image_alt:a}=e;if(!n&&!r)return"";const c=r?"image":"cover-image";return`<div class="${i}__item-${c}-container">${"image"===c?`<img class="${i}__item-${c}" src="${r}"${a?` alt="${a}"`:""}>`:`<img class="${i}__item-${c}" src="${n}">`}${"cover-image"===c&&s.brand?(o.brandBlock||Ls)(t,e,s):""}</div>`}function Fs({className:t},e,{index:s}){return`<div class="${t}__item-index-container"><span class="${t}__item-index miso-citation-index" data-index="${s+1}"></span></div>`}function Bs(t,e,s){const{className:i,templates:o}=t,n=Ys.asFunction(o.cta)(t,e,s);return n?`<div class="${i}__item-cta-container">${n}</div>`:""}function Qs({className:t,options:e={}},{product_id:s,url:i},{classSuffix:o="item-body",role:n="item",...r}={}){const a=!1!==r.link&&i?"a":"div";return[`<${a} class="${t}__${o}" ${n?`data-role="${n}"`:""} ${s?`data-miso-product-id="${s}"`:""} ${!1!==r.link&&i?`href="${i}" ${function(t={}){const{target:e="_blank",rel:s="noopener",open:i=!0}=t;let o="";i&&(e&&(o+=` target="${e}"`),s&&(o+=` rel="${s}"`));return o}(e.link)}`:""}>`,`</${a}>`]}const Gs=Object.freeze({locale:"en-US",year:"numeric",month:"short",day:"numeric"}),Hs="en-US";function Ws(t,e=Gs){switch(typeof e){case"function":return e(t);case"string":return new Date(t).toLocaleDateString(e);case"object":return new Date(t).toLocaleDateString(e.locale||Gs.locale,e);default:throw Error("Invalid date format: "+e)}}function Vs(t){return t&&t.replace(/<\/mark>\s+<mark>/g,"</mark>&nbsp;<mark>")}const Ys=Object.freeze({tagPair:Qs,formatDate:Ws,formatNumber:function(t,e=Hs){switch(typeof e){case"function":return e(t);case"string":return new Intl.NumberFormat(e).format(t);case"object":return new Intl.NumberFormat(e.locale||Hs.locale,e).format(t);default:throw Error("Invalid number format: "+e)}},formatHtmlWithMarkup:Vs,escapeHtml:w,asFunction:function(t=""){return"function"==typeof t?t:()=>t}});class Ks extends Os{constructor({className:t,templates:e,...s}={}){super(s),u(this,{className:t,templates:{...ks("root"),...e,helpers:Ys}})}_preprocess({state:t}){const e=this.templates.root(this,t);return{...t,html:e}}_render(t,{state:e}){t.innerHTML=e.html}}class Zs extends HTMLElement{static get tagName(){return"miso-banner"}async connectedCallback(){Zs.MisoClient.ui.layouts.create("banner").render(this)}}class Js{constructor(){this._entries=new WeakMap}isTracked(t){return this._entries.has(t)}async track(t,e={}){if(!e)return!1;if(this._entries.get(t))return!1;const s=new AbortController,{signal:i}=s;this._entries.set(t,{ac:s});let o=!1;try{await v(t,{...e,signal:i}),o=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._entries.delete(t)}return o}untrack(t){const e=this._entries.get(t);e&&(e.ac.abort(),this._entries.delete(t))}}class Xs extends Os{static get type(){return"container"}constructor({logo:t="auto",...e}={}){super({logo:t,...e}),this._impression=!1,this._viewables=new Js}_syncElement(t){this._element!==t&&this._viewables.untrack(this._element),super._syncElement(t)}_render(t,e){this._syncBanner(t),this._syncStatus(t,e),this._trackInteractions(t,e)}_afterRender(t,e){this._trackInteractions(t,e)}_syncBanner(t){const e=Zs.tagName,s=this._shallRenderBanner(t),i=t.querySelector(e);s&&!i?t.insertAdjacentHTML("beforeend",`<${e} visible-when="ready"></${e}>`):!s&&i&&i.remove()}_shallRenderBanner(t){const{logo:e}=this.options,{logo:s}=t,i=void 0!==s&&"auto"!==s?s:e;return"auto"===i?t.components.some(({role:t})=>function(t){return t===ie.PRODUCTS||t===ie.ANSWER}(t)):!!i}_syncStatus(t,{state:e}){if(!t)return;const{status:s,ongoing:i,meta:{miso_id:o,empty:n=!1,unanswerable:r=!1}={}}=e,a=[s,n?de.EMPTY:de.NONEMPTY];s===de.READY&&a.push(i?de.ONGOING:de.DONE),r&&a.push(de.UNANSWERABLE),t.setAttribute("status",a.join(" ")),o?t.setAttribute("miso-id",o):t.removeAttribute("miso-id")}_trackInteractions(t,e){const{status:s}=e;s===de.READY&&(this._trackImpression(),this._trackViewable(t))}_trackImpression(){const{impression:t}=this._view.tracker.options||{};t&&(this._impression||(this._impression=!0,this._view.tracker.impression()))}async _trackViewable(t){const{viewable:e}=this._view.tracker.options||{};e&&await this._viewables.track(t,e)&&this._view.tracker.viewable()}}const ti=Object.freeze({root:function(t,e){const{className:s,templates:i}=t,{status:o,value:n}=e;return"erroneous"!==o?"":`<div class="${s}"><div class="${s}__message">${i.message(t,n)}</div></div>`},message:function(t,e){return"Error: "+(e.message||e)}});class ei extends Ks{static get type(){return"error"}static get defaultTemplates(){return ti}constructor({className:t="miso-error",templates:e,...s}={}){super({className:t,templates:{...ti,...e},...s})}}const si=Object.freeze({root:function(t){const{className:e,templates:s}=t;return`<div class="${e}"><div class="${e}__logo">${s.logo(t)}</div></div>`},logo:()=>'<svg viewBox="0 0 500 200"><path d="M131.1,39.4 C144.3,39.4 155,43.8 163.2,52.7 C171.3,61.3 175.2,72.9 175.2,87.6 L175.2,159.1 L140.4,159.1 L140.4,90.6 C140.4,78.7 134.6,71.5 123.7,71.5 C112.3,71.5 105.5,79.7 105.5,93.4 L105.5,159.1 L70.7,159.1 L70.7,90.6 C70.7,78.7 64.9,71.5 54,71.5 C42.6,71.5 35.8,79.7 35.8,93.4 L35.8,159.1 L1,159.1 L1,42.7 L35.8,42.7 L35.8,53.4 C42.1,44.1 52.6,39.4 67,39.4 C80.5,39.4 90.7,44.5 97.4,54.8 C104.6,44.5 115.8,39.4 131.1,39.4 Z M202,42.4 L238.4,42.4 L238.4,159.1 L202,159.1 Z M202,0 L238.4,0 L202,36.4 Z M302.6,76.6 C302.6,81.2 311.7,83.8 323,86.8 C339.2,90.3 360.5,98.7 360.3,124 C360.3,136.6 355.6,146.1 346.2,152.6 C336.8,158.9 325.3,162.1 311.5,162.1 C286.9,162.1 270,152.8 261.1,134.5 L291.6,117.3 C294.6,126.3 301.4,131 311.5,131 C319.9,131 324.2,128.7 324.2,123.8 C324.2,119.1 315,116.3 303.8,113.5 C287.6,109.1 266.5,101.2 266.5,77.5 C266.5,65.4 270.9,56.1 279.6,49.4 C288.5,42.6 299.5,39.4 312.4,39.4 C331.9,39.4 348.6,48.2 358.2,64.3 L328.2,80.3 C324.4,73.6 319.2,70.1 312.4,70.1 C305.9,70.1 302.6,72.2 302.6,76.6 Z M480.4,144.5 C468.4,156.3 453.7,162.1 436.3,162.1 C419,162.1 404.2,156.3 392.2,144.5 C380.3,132.6 374.2,118 374.2,100.8 C374.2,83.6 380.3,69.1 392.2,57.3 C404.2,45.4 419,39.4 436.3,39.4 C453.7,39.4 468.4,45.4 480.4,57.3 C492.4,69.1 498.5,83.6 498.5,100.8 C498.5,118 492.4,132.6 480.4,144.5 Z M417.1,120.5 C422.2,125.6 428.6,128.2 436.3,128.2 C444.1,128.2 450.4,125.6 455.5,120.5 C460.7,115.4 463.3,108.9 463.3,100.8 C463.3,92.6 460.7,86.1 455.5,81 C450.4,75.9 444.1,73.3 436.3,73.3 C428.6,73.3 422.2,75.9 417.1,81 C411.9,86.1 409.3,92.6 409.3,100.8 C409.3,108.9 411.9,115.4 417.1,120.5 Z" /></svg>'});function ii(t,e){const s=[];for(const i of e.entries){const e=t.e2b.get(i.element);e&&e.key===i.key||s.push(i)}return s}class oi{constructor(){this._k2b=new Map,this._e2b=new Map,this._entries=[]}get entries(){return[...this._entries]}get(t){return this._e2b.get(t)||void 0}find(t){return this._k2b.get(t)||void 0}update(t,e,s){const i=function(t,e,s){const i=new Map,o=new Map,n=[];for(let r=0;t.length>r;r++){const a=t[r],c=s[r],l=Object.freeze({index:r,key:a,value:e[r],element:c});i.set(a,l),o.set(c,l),n.push(l)}return{k2b:i,e2b:o,entries:n}}(t,e,s),o={k2b:this._k2b,e2b:this._e2b,entries:this._entries},n=ii(o,i),r=ii(i,o);return this._k2b=i.k2b,this._e2b=i.e2b,this._entries=i.entries,{bounds:n,unbounds:r}}clear(){const t=this._entries;return this._k2b=new Map,this._e2b=new Map,this._entries=[],{bounds:[],unbounds:t}}}function ni(t){q(t,ri.prototype)}class ri{_initTrackable(){this._bindings=new oi,this._viewables=new Js}_syncBindings(t,e){const s=this._getItems(e)||[],i=s.map(t=>this._getItemKey(t)),o=this._getItemElements(t),{bounds:n,unbounds:r}=this._bindings.update(i,s,o);this._onBindingsUpdate(n,r)}_clearBindings(){const{bounds:t,unbounds:e}=this._bindings.clear();this._onBindingsUpdate(t,e)}_getItemKey(t){return t.product_id||t.text||t.id||t}_getItems(t){throw Error("Not implemented.")}_getItemElements(t){throw Error("Not implemented.")}_onBindingsUpdate(t,e){this._trackImpressions(t),this._untrackViewables(e),this._trackViewables(t)}_trackImpressions(t){if(0===t.length)return;const{impression:e}=this._view.tracker.options||{};e&&this._view.tracker.impression(t.map(({value:t})=>t))}_untrackViewables(t){for(const{element:e}of t)this._viewables.untrack(e)}_trackViewables(t){if(0===t.length)return;const{viewable:e}=this._view.tracker.options||{};if(e)for(const{value:s,element:i}of t)(async()=>{await this._viewables.track(i,e)&&this._view.tracker.viewable([s])})()}_trackClick(t,e){const{click:s}=this._view.tracker.options||{};(function(t={},e){return!!t&&("function"==typeof t.validate?t.validate(e):!!t.lenient||!ms(e)&&0===e.button&&!e.defaultPrevented&&!!g(e.target,t=>"A"===t.tagName&&t.href||void 0))})(s,t)&&(fs(t),this._view.tracker.click([e.value]))}_destroyTrackable(){const{unbounds:t}=this._bindings.clear();this._untrackViewables(t)}}class ai{_initTriggerable(){this._trigger=void 0}_syncTrigger(t,e){if(!this.options.infiniteScroll)return;const s=this._view.workflowOptions.pagination;s.active&&"infiniteScroll"===s.mode&&(e.status===de.READY?this._trackTrigger(t):this._untrackTrigger())}async _trackTrigger(t){if(this._trigger)return;const e=t.querySelector('[data-role="trigger"]');if(!e)return;const s=new AbortController;this._trigger=Object.freeze({element:e,ac:s});let i=!1;try{await v(e,{area:1,duration:0,signal:s.signal}),i=!0}catch(t){if("AbortError"!==t.name)throw t}finally{this._trigger=void 0}i&&this._onTrigger()}_onTrigger(){this._view.hub.trigger("more")}_untrackTrigger(){this._trigger&&(this._trigger.ac&&this._trigger.ac.abort(),this._trigger=void 0)}_destroyTriggerable(){this._untrackTrigger()}}const ci=Object.freeze({product:function(t,e,s,i){const{templates:o}=t,[n,r]=Qs(t,s);return""+n+(o.imageBlock||Ms)(t,s,i)+(o.infoBlock||o.productInfoBlock||Ts)(t,s,i)+r},article:function(t,e,s,i){const{templates:o}=t,[n,r]=Qs(t,s);return""+n+(o.imageBlock||Ms)(t,s,i)+(o.infoBlock||o.articleInfoBlock||As)(t,s,i)+(o.indexBlock||Fs)(t,s,i)+r},compactArticle:Is,image:function(t,e,s,i){const{templates:o}=t,[n,r]=Qs(t,s);return""+n+(o.imageBlock||Ms)(t,s,i)+(o.infoBlock||o.imageInfoBlock||Ns)(t,s,i)+r},question:function(t,e,s){const[i,o]=Qs(t,s);return`${i}${s.value||s.text||s}${o}`},root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e;return`<div class="${s} ${r}"${i?` data-role="${i}"`:""}${n.itemType?` data-item-type="${n.itemType}"`:""}>${r===de.READY?o[r](t,e):""}${o.trigger(t,e)}${o.loading(t,e)}</div>`},[de.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e)||[];return i.length>0||e.ongoing?s.body(t,e,i):s.empty(t,e)},empty:()=>"",body:function(t,e,s){return t.templates.list(t,e,s)},list:function(t,e,s){const{className:i,templates:o,options:n}=t,r=o.ordered?"ol":"ul";return`<${r} class="${i}__list" data-role="list"${n.itemType?` data-item-type="${n.itemType}"`:""}>${o.items(t,e,s)}</${r}>`},ordered:!1,items:function(t,e,s,{offset:i=0}={}){const{templates:o}=t;let n=i;return s.map(s=>o.item(t,e,s,n++)).join("")},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item">${n[a](t,e,s,{index:i})}</li>`},productInfoBlock:Ts,articleInfoBlock:As,compactArticleInfoBlock:Rs,imageInfoBlock:Ns,brandBlock:Ls,titleBlock:$s,descriptionBlock:Us,dateBlock:Ps,authorsBlock:qs,authorsAndDateBlock:js,priceBlock:Ds,discountRateText:zs,ctaBlock:Bs,cta:function(t,e,s){const{templates:i}=t,{url:o}=e;if(!o)return"";const[n,r]=Qs(t,{url:o},{classSuffix:"item-cta",role:"cta"}),a=Ys.asFunction(i.ctaText)(t,e,s);return a?`${n}${a}${r}`:""},imageBlock:Ms,indexBlock:Fs,trigger:function(t,e){const{className:s}=t;return`<div class="${s}__trigger" data-role="trigger"></div>`},loading:function(){return'<div class="miso-loading" aria-label="Loading" data-role="loading"></div>'}});class li extends Ks{static get defaultTemplates(){return ci}constructor({templates:t,itemType:e="product",...s}){super({templates:{...ci,...t},itemType:e,...s}),this._initTrackable(),this._initTriggerable()}initialize(t){this._unsubscribes.push(t.proxyElement.on("click",this._onClick.bind(this)))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=this._html(t,e,s);return{...t,incremental:s,html:i}}_shallRenderIncrementally(t,e){return this.options.incremental&&e&&e.value&&e.value.length>0&&t.value&&t.value.length>=e.value.length&&t.session&&e.session&&t.session.id===e.session.id}_html(t,e,s){if(s){const s=e.value.length,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}return this.templates.root(this,t)}_render(t,{state:e},{notifyUpdate:s}){const{incremental:i,html:o}=e;if(i)if(o){this._getListElement(t).insertAdjacentHTML("beforeend",o)}else s(!1);else t.innerHTML=o}_afterRender(t,e){this._syncBindings(t,e),this._syncTrigger(t,e)}_unrender(){this._clearBindings(),this._untrackTrigger()}_getItems(t){return t.value&&(t.value.products||t.value)}_getListElement(t){return t.querySelector('[data-role="list"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="item"]')):[]}_onClick(t){const e=t.target.closest('[data-role="item"]');if(!e)return;const s=this._bindings.get(e);s&&(this._trackClick(t,s),this._emitClickEvent(t,s))}_emitClickEvent(t,e){const{session:s}=this._view._state,{value:i,element:o}=e;this._view._events.emit("click",{session:s,value:i,element:o,domEvent:t})}destroy(){this._destroyTrackable(),this._destroyTriggerable(),this._view=void 0,super.destroy()}}ni(li.prototype),q(li.prototype,ai.prototype);const ui="miso-list";class hi extends li{static get type(){return"list"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return ui}constructor({className:t=ui,...e}={}){super({className:t,...e})}}const di="miso-horizontal";class _i extends li{static get type(){return"horizontal"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return di}constructor({className:t=di,...e}={}){super({className:t,...e})}}const pi="miso-cards";function mi(t,e,s){void 0===s?t.removeAttribute(e):t.setAttribute(e,s)}function fi(t,e,s){s?t.classList.add(e):t.classList.remove(e)}function gi(t){if("number"==typeof t)return t;const[e,s]=function(t){const e=t.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*)$/);if(!e)throw Error("Invalid length: "+t);const s=parseFloat(e[1]),i=e[2]||"";return[s,i]}(t);switch(s){case"":case"px":return e;case"rem":return function(t=1){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}(e);default:throw Error("Unsupported unit: "+s)}}function bi(t){return void 0===t||t instanceof yi?t:new yi(t)}class yi{constructor(t){switch(this._width=NaN,this._height=NaN,typeof t){case"number":this._width=t,this._height=1;break;case"object":Array.isArray(t)&&(this._width=parseFloat(t[0]),this._height=parseFloat(t[1]));break;case"string":const e=t.indexOf("/");0>e?(this._width=parseFloat(t),this._height=1):(this._width=parseFloat(t.slice(0,e).trim()),this._height=parseFloat(t.slice(e+1).trim()))}if(NaN===this._width||NaN===this._height)throw Error("Invalid aspect ratio value: "+t)}get width(){return this._width}get height(){return this._height}get floatValue(){return this._width/this._height}scaleBy(t){return t=bi(t),bi([t._width*this._width,t._height*this._height])}toString(){return 1===this._height?""+this._width:`${this._width} / ${this._height}`}}class vi{_initSwipeable(){this._swipeableContext={itemCount:void 0,itemIndex:void 0,displayedCount:void 0,displayedIndex:void 0,displayEventIndex:void 0}}get itemIndex(){return this._swipeableContext.itemIndex}set itemIndex(t){const e=this._swipeableContext;void 0!==e.itemCount&&(0>t?t=e.itemCount-1:e.itemCount>t||(t=0),e.itemIndex=t,y(()=>this._syncDisplayedSwipeableItemIndex()))}next(){void 0!==this._swipeableContext.itemCount&&this.itemIndex++}previous(){void 0!==this._swipeableContext.itemCount&&this.itemIndex--}_renderSwipeable(t,e,s){this._syncSwipeableItemCount(e),this._syncDisplayedSwipeableItemCount(),this._syncDisplayedSwipeableItemIndex()}_afterRenderSwipeable(){this._emitSwipeableDisplayEvent()}_syncSwipeableItemCount({state:t}={}){const e=this._swipeableContext,s=this._getItems(t),i=e.itemCount,o=e.itemCount=s?s.length:void 0;o!==i&&(void 0===o?e.itemIndex=void 0:void 0===i&&(e.itemIndex=0))}_syncDisplayedSwipeableItemCount(){const t=this._swipeableContext,{itemCount:e}=t;if(e===t.displayedCount)return;let{element:s}=this._view;s=s.firstElementChild,s&&(mi(s,"data-item-count",e),t.displayedCount=e)}_syncDisplayedSwipeableItemIndex(){const t=this._swipeableContext,{itemIndex:e}=t;e!==t.displayedIndex&&(t.displayedIndex=e,this._syncSwipeableListIndex(e),this._syncSwipeableIndicatorIndex(e))}_syncSwipeableListIndex(t){const{element:e}=this._view,s=e&&this._getListElement(e);s&&(s.style.left=100*-t+"%")}_syncSwipeableIndicatorIndex(t){const{element:e}=this._view,s=e&&this._getSwipeableIndicatorElement(e);if(!s)return;let i=0;for(const e of s.children)fi(e,"active",i===t),i++}_getSwipeableIndicatorElement(t){return t.querySelector('[data-role="index-indicator"]')}_emitSwipeableDisplayEvent(){const t=this._swipeableContext,e=t.displayedIndex;t.displayEventIndex!==e&&(t.displayEventIndex=e,this._view._events.emit("display",{index:e}))}_onClickSwipeable(t){const{target:e}=t;e.closest('[data-role="previous"]')&&(t.preventDefault(),this.previous()),e.closest('[data-role="next"]')&&(t.preventDefault(),this.next())}}const wi="miso-ui-icon",Ei=wi+"-svg-1_12_7",xi={SEND:"send",SEARCH:"search",TRIANGLE:"triangle",TRIANGLE_EQ:"triangle-eq",CHEVRON:"chevron",CHEVRON_NEGATIVE:"chevron-negative",BULB:"bulb"},Si=`<symbol id="${wi}-${xi.SEND}" viewBox="0 0 32 32"><path fill="currentColor" d="M11.499,19.173l5.801,-5.849c0.389,-0.392 1.022,-0.394 1.414,-0.006c0.392,0.389 0.395,1.022 0.006,1.414l-5.798,5.847l5.306,8.002c0.207,0.313 0.572,0.483 0.945,0.441c0.373,-0.042 0.691,-0.289 0.824,-0.64l9.024,-23.904c0.138,-0.366 0.05,-0.78 -0.226,-1.058c-0.276,-0.278 -0.689,-0.369 -1.057,-0.233l-24.004,8.892c-0.353,0.13 -0.602,0.448 -0.646,0.821c-0.044,0.373 0.125,0.74 0.438,0.948l7.973,5.325Z"/></symbol>`,Oi=`<symbol id="${wi}-${xi.SEARCH}" viewBox="0 0 24 24"><path fill="currentColor" d="M4 11C4 7.13401 7.13401 4 11 4C14.866 4 18 7.13401 18 11C18 14.866 14.866 18 11 18C7.13401 18 4 14.866 4 11ZM11 2C6.02944 2 2 6.02944 2 11C2 15.9706 6.02944 20 11 20C13.125 20 15.078 19.2635 16.6177 18.0319L20.2929 21.7071C20.6834 22.0976 21.3166 22.0976 21.7071 21.7071C22.0976 21.3166 22.0976 20.6834 21.7071 20.2929L18.0319 16.6177C19.2635 15.078 20 13.125 20 11C20 6.02944 15.9706 2 11 2Z"/></symbol>`,ki=`<symbol id="${wi}-${xi.TRIANGLE}" viewBox="-5 -5 105 105"><path d="${function(t){const e=100,s=2.414213562373095*t,i=.7071067811865475*s;return`M${t} 0L${e-s} 0A${t} ${t} 0 0 1 ${e-i} ${i}L${i} ${e-i}A${t} ${t} 0 0 1 0 ${e-s}L0 ${t}Z`}(5)}"/></symbol>`,Ii=`<svg id="${Ei}" style="display:none;">${[Si,Oi,ki,`<symbol id="${wi}-${xi.TRIANGLE_EQ}" viewBox="-100 -100 200 200"><path d="M12.99 -77.5A15 15,0,0,0,-12.99 -77.5L-73.61 27.5A15 15,0,0,0,-60.62 50L60.62 50A15 15,0,0,0,73.61 27.5L12.99 -77.5Z"/></symbol>`,`<symbol id="${wi}-${xi.CHEVRON}" viewBox="-100 -100 200 200"><path d="M10.61 -43.94A15 15,0,0,0,-10.61 -43.94L-60.61 6.06A15 15,0,0,0,-39.39 27.27L0 -12.12L39.39 27.27A15 15,0,0,0,60.61 6.06L10.61 -43.94Z"/></symbol>`,`<symbol id="${wi}-${xi.CHEVRON_NEGATIVE}" viewBox="-100 -100 200 200"><path d="M100 100V-200H-200V200H200ZM-10.61 -43.94A15 15,0,0,1,10.61 -43.94L60.61 6.06A15 15,0,0,1,39.39 27.27L0 -12.12L-39.39 27.27A15 15,0,0,1,-60.61 6.06L-10.61 -43.94Z"/></symbol>`,`<symbol id="${wi}-${xi.BULB}" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></symbol>`].join("")}</svg>`;let Ci=!1;function Ti(t){return`<svg class="miso-ui-icon miso-ui-icon-${t}"><use href="#${wi}-${t}"></use></svg>`}Ci||document.head.querySelector("#"+Ei)||(Ci=!0,document.head.insertAdjacentHTML("beforeend",Ii));const Ai=new Set(Object.values(xi));Ti(xi.SEND),Ti(xi.SEARCH);const Ri=Ti(xi.TRIANGLE);Ti(xi.TRIANGLE_EQ);const Ni=Ti(xi.CHEVRON),$i=Ti(xi.CHEVRON_NEGATIVE),Li=Ti(xi.BULB),Ui="miso-carousel",Pi=Object.freeze({body:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__viewport"><div class="${i}__viewport-inner">${o.list(t,e,s)}</div></div>${o.controls(t,e,s)}`},controls:function(t,e,s){const{templates:i}=t;return`${i.controlContainer(t,e,"previous")}${i.controlContainer(t,e,"next")}${i.indexIndicator(t,e,s)}`},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-container-${s}">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t){return"image"===t.options.itemType?$i:Ni},indexIndicator:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__index-indicator" data-role="index-indicator">${s.map(s=>`<li class="${i}__index-indicator-item">${o.indexIndicatorItem(t,e,s)}</li>`).join("")}</ul>`},indexIndicatorItem:()=>"",trigger:()=>""}),qi=Object.freeze({...li.defaultTemplates,...Pi});class ji extends li{static get type(){return"carousel"}static get defaultTemplates(){return qi}static get defaultClassName(){return Ui}constructor({className:t=Ui,templates:e,...s}={}){super({className:t,templates:{...Pi,...e},...s}),this._initSwipeable()}_render(t,e,s){super._render(t,e,s),this._renderSwipeable(t,e,s)}_afterRender(t,e){super._afterRender(t,e),this._afterRenderSwipeable(t,e)}_onClick(t){this._onClickSwipeable(t),super._onClick(t)}}!function(t){q(t,vi.prototype)}(ji.prototype);const Di="16rem",zi=Object.freeze({...li.defaultTemplates,item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r,c=n[a](t,e,s,{index:i});return`<li class="${o}__item${s._size?` ${o}__item-${s._size}`:""}">${c}</li>`}}),Mi="miso-gallery";class Fi extends li{static get type(){return"gallery"}static get defaultTemplates(){return zi}static get defaultClassName(){return Mi}constructor({className:t=Mi,templates:e,...s}={}){super({className:t,templates:{...zi,...e},...s}),this._galleryContext={itemAspectRatio:void 0,itemCount:void 0,columnCount:void 0}}syncSize(){const{element:t}=this._view,e=t&&this._getListElement(t);e&&(this._syncListAspectRatio(e),this._syncItemSizes(e))}_preprocess({state:t,rendered:e}){const s=this._shallRenderIncrementally(t,e),i=s?void 0:this._bodyHtml(t),o=this._itemsHtml(t,e);return{...t,...a({incremental:s,bodyHtml:i,itemsHtml:o})}}_bodyHtml(t){return this.templates.root(this,{...t,value:[]})}_itemsHtml(t,e){const s=e&&e.value&&e.value.length||0,i=(this._getItems(t)||[]).slice(s);return i.length>0?this.templates.items(this,t,i,{offset:s}):""}_render(t,e,s){this._syncItemCount(e),this._syncCssVariables();const i=this._renderListElement(t,e,s);i&&(this._syncListAspectRatio(i),this._renderItems(i,e,s))}_renderListElement(t,{state:e}){const{incremental:s,bodyHtml:i}=e;return s||(t.innerHTML=i),this._getListElement(t)}_renderItems(t,e){e.state.incremental?this._appendItems(t,e):this._updateItems(t,e)}_updateItems(t,{state:e}){const{itemSizes:s}=this._galleryContext,i=this._writeItemSizes(this._getItems(e)||[],s);t.innerHTML=this.templates.items(this,e,i)}_appendItems(t,{state:e}){const{itemSizes:s}=this._galleryContext;this._syncItemSizes(t);const i=t.children.length,o=this._writeItemSizes((this._getItems(e)||[]).slice(i),s,i);t.insertAdjacentHTML("beforeend",this.templates.items(this,e,o,{offset:i}))}_writeItemSizes(t,[e=0,s=0]=[],i=0){let o=0;i>0&&(o=Math.min(i,e),i-=o,e-=o),i>0&&(o=Math.min(i,s),i-=o,s-=o);const n=[];for(const i of t){let t="small";e>0?(t="large",e--):s>0&&(t="medium",s--),n.push({...i,_size:t})}return n}_syncCssVariables(){const t=this._galleryContext;let{itemAspectRatio:e=1}=this.options;e=t.itemAspectRatio=bi(e);const{element:s}=this._view;s&&(s.style.setProperty("--miso-gallery-item-1x1-aspect-ratio",""+e),s.style.setProperty("--miso-gallery-item-1x2-aspect-ratio",""+e.scaleBy([1,2])))}_syncListAspectRatio(t){const e=this._galleryContext,{itemCount:s,itemAspectRatio:i}=e,{height:o=Di}=this.options,n=gi(o),r=t.clientWidth;if(0===r)return e.columnCount=void 0,void(e.itemSizes=void 0);const a=e.columnCount=Math.round(r*i.width*2/(n*i.height));e.itemSizes=function(t,e){let s=Math.max(2*e-t,0),i=t;const o=Math.min(Math.floor(s/3),i);i-=o,s-=3*o;const n=Math.min(s,i);return i-=n,s-=n,[o,n,i]}(s,a),t.style.aspectRatio=a+" / 2",t.style.height=s>0?"auto":"0"}_syncItemCount({state:t}={}){const e=this._getItems(t);this._galleryContext.itemCount=e?e.length:void 0}_syncItemSizes(t){const{itemSizes:e=[]}=this._galleryContext;let[s=0,i=0]=e;const{className:o}=this;for(const e of t.children){let t=!1,n=!1;s>0?(t=!0,s--):i>0&&(n=!0,i--),fi(e,o+"__item-large",t),fi(e,o+"__item-medium",n),fi(e,o+"__item-small",!t&&!n)}}}const Bi="miso-search-box";const Qi=Object.freeze({root:function(t){const{className:e,templates:s,role:i,options:o,autocomplete:n}=t,{placeholder:r}=o;return`\n<div class="${e}" ${i?`data-role="${i}"`:""}>\n  <div class="${e}__input-group">\n    <input class="${e}__input" type="text" data-role="input" ${r?`placeholder="${r}"`:""}>\n    <button class="${e}__button" type="submit" data-role="submit">${s.buttonContent(t)}</button>\n  </div>\n  <div class="${n.className}" data-role="autocomplete"></div>\n</div>`.trim()},buttonContent:function(t){const{templates:e,options:s}=t;if(s.buttonText)return s.buttonText;const{buttonText:i,buttonIcon:o}=e;var n;return("function"==typeof i?i(t):""+i)+("function"==typeof o?o(t):(Ai.has(n=o)?Ti(n):"")||""+o)},buttonText:"",buttonIcon:"search",completions:function(t,e){const{templates:s,workflow:i,autocomplete:o}=t;t={templates:s,workflow:i,...o};const n=[],r=[];for(const t of e)(t.product?n:r).push(t);return s.queries(t,r)+(r.length>0&&n.length>0?"<hr>":"")+s.products(t,n)},completionList:function(t,e,s){const{className:i,templates:o}=t;return`<ul class="${i}__${e}-list" data-role="${e}-list">${s.map(s=>o.completionItem(t,e,s)).join("")}</ul>`},completionItem:function(t,e,s){const{className:i,templates:o}=t;return`\n<li class="${i}__${e}-item" data-role="${e}-item" data-index="${s._index}" tabindex="0">\n  ${o[e](t,s)}\n</li>`.trim()},queries:function(t,e){const{templates:s}=t;return s.completionList(t,"query",e)},products:function(t,e){const{templates:s}=t;return s.completionList(t,"product",e)},query:function(t,{text:e,text_with_inverted_markups:s}={}){return s||w(e)},product:function(t,{product:e}){const{templates:s}=t,[i,o]=s.helpers.tagPair(t,e,{role:!1});return""+i+s.imageBlock(t,e)+s.productInfoBlock(t,e)+o},imageBlock:Ms,productInfoBlock:Ts}),Gi=Object.freeze({className:"miso-autocomplete",debounce:300});class Hi extends Ks{static get type(){return"search-box"}static get defaultTemplates(){return Qi}static get defaultClassName(){return Bi}constructor({className:t=Bi,templates:e,autocomplete:s,...i}={}){super({className:t,templates:{...Qi,...e},...i}),u(this,{autocomplete:{...Gi,...s}}),this._contexts=new WeakMap,this._prevInput=void 0,this._debounce=L(this.autocomplete.debounce)}initialize(t){const{proxyElement:e,hub:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("input",t=>this._syncInput(t)),e.on("keydown",t=>this._handleKeyDown(t)),e.on("click",t=>this._handleClick(t)),e.on("focusin",t=>this._handleFocusIn(t)),e.on("focusout",t=>this._handleFocusOut(t)),s.on("completions",()=>t.refresh({force:!0}))]}focus(){this._element?this._context().focus():this._focusRequested=!0}open(){this._element.classList.add("open")}close(){this._element.classList.remove("open")}set value(t){this._element?this._context().value=t:this._valueRequested=t}_preprocess({state:t}){return t=super._preprocess({state:t}),{...t,completions:this._view.hub.states.completions}}_render(t,e,s){0===t.childElementCount&&super._render(t,e,s),this._updateCompletions(t,e,s)}_afterRender(t,e){this._fullfillFocusRequest(t),this._fullfillValueRequest(t)}_updateCompletions(t,{state:e,rendered:s},{writeToState:i}){if(!e.completions)return;const{status:o=de.INITIAL,session:n,value:r}=e.completions,{index:a}=n;if(s&&s.completions.index===a&&s.completions.status===o)return;const c=this._context(t),{autocompleteElement:l}=c;if(!l)return;const u=c.trackItems(r);fi(t,"nonempty",u.length>0),l.setAttribute("data-status",o),l.innerHTML=this.templates.completions(this,u),i({completions:{index:a,status:o}})}_fullfillFocusRequest(t){t&&this._focusRequested&&(this._focusRequested=!1,this._context(t).focus())}_fullfillValueRequest(t){t&&this._valueRequested&&(this._context(t).value=this._valueRequested,this._valueRequested=void 0)}_context(t){if(!(t=t||this._view.element))return Wi.empty();let e=this._contexts.get(t);return e||this._contexts.set(t,e=new Wi(t)),e}_syncInput(){const{inputElement:t}=this._context();if(!t)return;const e=t.value.trim();if(this._prevInput===e)return;this._prevInput=e;const s=this;this._debounce(()=>s._view.hub.update("input",{value:e}))}_handleFocusIn({target:t}){this._element&&t.matches('[data-role="input"]')&&(this._syncInput(),this.open())}_handleFocusOut({relatedTarget:t}){this._element&&(t&&g(t,t=>t===this._element||void 0)||this.close())}_handleKeyDown({key:t,target:e,isComposing:s}){!s&&"Enter"===t&&e.matches('[data-role="input"]')&&(this._submit(e.value),e.blur())}_handleClick(t){const{target:e}=t,{inputElement:s}=this._context();for(let i=e;i&&i!==this._element;i=i.parentElement){if(i.matches('[data-role="submit"]')||i.matches('[data-role="button"]')||i.matches('[type="submit"]'))return void(s&&(s.blur(),this._submit(s.value)));if(i.matches('[data-role="query-item"]')){const e=i.getAttribute("data-index"),o=this._context().data.get(parseInt(e)),n=o&&o.text;return n&&(s&&(s.value=n),this._view._events.emit("select",Object.freeze({value:o,index:e,domEvent:t})),t.defaultPrevented||this._submit(n)),void this.close()}if(i.matches('[data-role="product-item"]'))return void this._view._events.emit("select",Object.freeze({value:item,index:index,domEvent:t}))}}async _submit(t){t&&t.trim()&&(this.close(),this._view.hub.update("query",{q:t}),this._trackSubmit(t))}_trackSubmit(t){const{[ae.SUBMIT]:e}=this._view.tracker.options||{};e&&this._view.tracker.submit({value:t})}}class Wi{static empty(){return Wi._empty||(Wi._empty=new Wi)}constructor(t){this._element=t,this._cache={},this._data=new Map}get inputElement(){return this._get("input")}get autocompleteElement(){return this._get("autocomplete")}get data(){return this._data}trackItems(t){let e=0;const s=this._data=new Map,i=[];for(const o in t)for(const n of t[o])n.product&&!n.product.url||(n._index=e,n._field=o,s.set(e,n),i.push(n),e++);return i}focus(){if(!this._element)return;const{inputElement:t}=this;t&&t.focus()}set value(t){if(!this._element)return;const{inputElement:e}=this;e&&(e.value=t)}_get(t){return this._element?this._cache[t]||(this._cache[t]=this._element.querySelector(`[data-role="${t}"]`)):void 0}}const Vi="miso-option-list";const Yi=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}" ${i?`data-role="${i}"`:""}>\n  ${o.options(t,e)}\n</div>\n`},options:function(t,e){const{className:s,templates:i}=t;return`\n<ol class="${s}__options" data-role="options">\n  ${(e.value||[]).map((e,s)=>i.option(t,e,{index:s})).join("")}\n</ol>\n`},option:function(t,e){const{className:s}=t;return`<li class="${s}__option" data-role="option" tabindex="0">${w(e.text||e)}</li>`}});class Ki extends Ks{static get type(){return"option-list"}static get defaultTemplates(){return Yi}static get defaultClassName(){return Vi}constructor({className:t=Vi,templates:e,...s}={}){super({className:t,templates:{...Yi,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_render(t,e,s){super._render(t,e,s);const{state:i}=e;this._syncOptionValues(t,i)}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_syncOptionValues(t,e){const s=t&&this._getOptionsElement(t);if(!s)return;fi(s,"empty",0===(this._getItems(e)||[]).length)}_getItems(t){return t.value}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;i&&(this._trackClick(t,s),this._select(i.text))}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}ni(Ki.prototype);const Zi=Object.freeze({...ks("options"),root:function(t){const{className:e,role:s,templates:i}=t;return`\n<div class="${e}" ${s?`data-role="${s}"`:""}>\n  ${i.options(t)}\n</div>\n`},option:function(t,e){const{className:s,templates:i}=t;return`\n<div role="button" class="${s}__option" data-value="${e.value}">\n  ${i.content(t,e)}\n</div>\n`}});class Ji extends Ks{static get defaultTemplates(){return Zi}constructor({className:t,templates:e,field:s,defaultValue:i,...o}={}){super({className:t,templates:{...Zi,...e},...o}),this._field=s,this._defaultValue=i}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,t.hub.on(this._field,()=>this._refresh()),e.on("click",t=>this._handleClick(t))],this._defaultValue?this._select(this._defaultValue,{silent:!0}):this._clear({silent:!0})}_preprocess(t,e){return t.rendered&&e.skip(),super._preprocess(t,e)}_handleClick({target:t}){const e=g(t,t=>t.hasAttribute("data-value")?t:void 0);if(!e)return;let{unselected:s,value:i}=this._view.hub.states[this._field];s=s||void 0===i;const o=e.getAttribute("data-value");s||void 0===i||i!==o?this._select(o):this._clear()}_refresh(){this._state=this._view.hub.states[this._field],y(()=>this._syncValueAttribute())}_syncValueAttribute(){if(!this._state||!this._view)return;const{element:t}=this._view,e=t&&t.children[0];if(!e)return;let{unselected:s,value:i}=this._state;s?e.removeAttribute("data-selected"):e.setAttribute("data-selected",i),this._state=void 0}_select(t,e){this._submit({value:t},e)}_clear(t){this._submit({unselected:!0},t)}async _submit(t,e){this._view.hub.update(this._field,t,e)}}const Xi="miso-feedback",to=["helpful","unhelpful"];const eo=Object.freeze({options:function(t){const{templates:e}=t;return to.map(s=>e.option(t,{value:s})).join("")},content:function(t,{value:e}){const{className:s,templates:i,options:o={}}=t;return`\n${!1!==o.icon?`<i class="${s}__icon">${i.icon(t,e)}</i>`:""}\n${!1!==o.text?`<span class="${s}__text">${i.text(t,e)}</span>`:""}\n`},icon:function(t,e){switch(e){case"helpful":case"unhelpful":return'<svg viewBox="0 0 16 16"><path d="M8.342 3.652 4.979 5.708a1 1 0 0 0-.479.852v5.561a1 1 0 0 0 .87.992l6.029.79a1 1 0 0 0 1.042-.583l2.534-5.65a1 1 0 0 0-.74-1.394l-3.543-.623.9-3.1A2.097 2.097 0 0 0 10.297 0L8.719 3.237a1 1 0 0 1-.377.415ZM1 6.5a1.5 1.5 0 0 1 3 0v6a1.5 1.5 0 0 1-3 0Z"/></svg>';default:return""}},text:function(t,e){switch(e){case"helpful":return"Helpful";case"unhelpful":return"Not helpful";default:return""}}});class so extends Ji{static get type(){return"feedback"}static get defaultTemplates(){return eo}static get defaultClassName(){return Xi}constructor({className:t=Xi,templates:e,...s}={}){if(super({className:t,templates:{...eo,...e},field:"feedback",...s}),!1===s.text&&!1===s.icon)throw Error("At least one of options.text or options.icon must be enabled")}}const io="miso-text";const oo=Object.freeze({root:function(t,{value:e}){const{className:s,role:i,options:{raw:o=!1,tag:n}}=t,r=i?`data-role="${i}"`:"",a=void 0!==e?w(function(t){let{format:e}=t.options;const{formatDate:s,formatNumber:i}=t.templates.helpers;if(!e)return t=>""+t;switch(typeof e){case"function":return e;case"string":e=[e]}let[o,n]=e;switch(o){case"date":return t=>s(t,n);case"number":return t=>i(t,n);default:return t=>""+t}}(t)(e)):"";return o?a:`<${n} class="${s}" ${r}>${a}</${n}>`}});class no extends Ks{static get type(){return"text"}static get defaultTemplates(){return oo}static get defaultClassName(){return io}constructor({className:t=io,templates:e,tag:s="p",...i}={}){super({className:t,templates:{...oo,...e},tag:s,...i})}}class ro extends Os{constructor(t){super(t)}_takePending(){return this._pending}_applyRender(t,e={}){const s=O(!1);super._applyRender(t,{...e,loop:s.t}),s.value&&this._requestRaf()}}class ao{clear(t){return t.innerText="",{cursor:0,done:!1}}update(t,{value:e,cursor:s},{value:i,cursor:o,done:n}){const r=i.length;o=Math.min(o,r);const a=!!n&&o===r,c=e.substring(0,s),l=!i.startsWith(c);return a||l?t.innerText=i:t.insertAdjacentText("beforeend",i.substring(s,o)),a&&t.classList.add("done"),{cursor:o,done:a}}}function co(t,e,{status:s}){if(!e)return;0===e.children.length&&(e.innerHTML=function(t){let{className:e,role:s,options:{tag:i,format:o,builtInStyles:n=!0}}=t;"auto"===i&&(i="markdown"===o?"div":"p");const r=s?`data-role="${s}"`:"",a=[e,lo(e)];n&&"markdown"===o&&a.push("miso-markdown");return`<${i} class="${a.join(" ")}" ${r} data-format="${o}"></${i}>`}(t));const i=e.children[0];return i.setAttribute("data-status",s||de.INITIAL),i}function lo(t){return t+"__cursor"}function uo(t){if(!0===t)return function(t=performance.now()){return function({summary:e,timestamp:s,elapsed:i,ref:o,operation:n,conflict:r}){var a;MisoClient.debug("<progressive-markdown>",`[${a=s-t,Math.floor(a)/1e3+"s"}](${ho(i[0])}, ${ho(i[1])})`,e,""+n,o,r)}}();if(t){if("function"==typeof t)return t;throw Error("onDebug must be a function or a boolean")}}function ho(t){return Math.floor(100*t)/100+"ms"}const _o="miso-typewriter";class po extends ro{static get type(){return"typewriter"}static get defaultClassName(){return _o}constructor({className:t=_o,tag:e="auto",format:s="markdown",tooltip:i=!1,speed:o,acceleration:n,nextCursorFn:r,...a}={}){super({tag:e,format:s,tooltip:i,...a}),u(this,{className:t}),this._prevState=void 0,this._getNextCursor="function"==typeof r?r:M({speed:o,acceleration:n}),this._readiness=new I,"markdown"===s&&po.MisoClient.plugins.install("std:ui-markdown")}initialize(){this._setup()}async _setup(){try{if("plaintext"===this.options.format)await this._setupForPlaintext();else await this._setupForMarkdown();this._readiness.resolve()}catch(t){this._readiness.reject(t)}}async _setupForMarkdown(){const t=await this._view._views._extensions.require("markdown");if(!this._view)return;const e=lo(this.className),{onDebug:s,onCitationLink:i,variant:o}=this.options;this._renderer=t.createRenderer({cursorClass:e,getSource:t=>this._getSource(t),onCitationLink:i,onDebug:uo(s),variant:o}),this._unsubscribes.push(this._view.proxyElement.on("click",t=>this._onClick(t)))}_getSource(t){const{data:e={}}=this._view._data,{sources:s=[]}=e;return s[t]}async _setupForPlaintext(){this._renderer=new ao}async _ready(){return this._readiness.promise}async render(...t){await this._ready(),await super.render(...t)}_preprocess({state:t}){const e=this._prevState,{value:{value:s="",stage:i,finished:o}={},session:n,status:r}=t,c=(u=t,(l=e)&&u&&l.session&&u.session&&l.session.uuid===u.session.uuid);var l,u;const h=e?c&&i===e.stage?e.streak:e.streak+1:0,d=c&&e&&e.doneAt||(r===de.READY&&o?performance.now():void 0);return this._prevState=Object.freeze(a({session:n,status:r,value:s,stage:i,streak:h,doneAt:d,done:void 0!==d}))}_render(t,{state:e,rendered:s},{notifyUpdate:i,writeToState:o,loop:n}){const r=co(this,t,e);let a;const c=!s||e.streak!==s.streak;if(c)a=this._renderer.clear(r,s);else{const t=this._getNextCursor(s.cursor,e.doneAt,s.timestamp,e.timestamp);a=this._renderer.update(r,s,{...e,cursor:t})}o(a);const l=e.status===de.READY&&!a.done;i({ongoing:l},{silent:l&&(!s||s.status===de.READY)&&!c}),l&&n()}_onClick(t){const{target:e}=t,s=e.closest('[data-role="citation-link"]');if(s){const e=parseInt(s.dataset.index);return void(Number.isNaN(e)||this._view._events.emit("citation-click",{event:t,index:e}))}const i=e.closest('[data-role="follow-up-link"]');if(i){let{q:e}=i.dataset;return e=e?e.trim():void 0,void(e&&this._view._events.emit("follow-up-click",{event:t,q:e}))}const o=e.closest("a");if(o){if(!t.defaultPrevented){const{href:e,innerText:s,className:i}=o;e&&this._view._events.emit("link-click",a({event:t,url:e,text:s?s.trim():"",className:i||"",attributes:mo(o)}))}}else;}}function mo(t){const{attributes:e}=t,s={};for(const{name:t,value:i}of e)t.startsWith("data-")&&(s[t]=i);try{return JSON.stringify(s)}catch(t){return"{}"}}const fo="miso-affiliation";const go=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o,options:n}=t,{status:r}=e,a=i?` data-role="${i}"`:"",c=e.value||{},l=c.channel?` data-channel="${c.channel}"`:"",u=t._getItems(e),h=u?u.length:void 0;return`<div class="${s} ${r}"${a}${l}${n.itemType?` data-item-type="${n.itemType}"`:""}${void 0!==h?` data-item-count="${h}"`:""}>${r===de.READY?o[r](t,e):""}</div>`},[de.READY]:function(t,e){const{templates:s}=t,i=t._getItems(e);return i&&i.length>0?s.controlContainer(t,e,"previous")+s.body(t,e)+s.controlContainer(t,e,"next"):s.empty(t,e)},controlContainer:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}-container">${o.control(t,e,s)}</div>`},control:function(t,e,s){const{className:i,templates:o}=t;return`<div class="${i}__control-${s}" data-role="${s}">${o.controlIcon(t,e,s)}</div>`},controlIcon:function(t,e,s){return Ri},body:function(t,e){const{className:s,templates:i}=t,o=t._getItems(e);return`<div class="${s}__body">${i.list(t,e,o)}</div>`},item:function(t,e,s,i){const{className:o,templates:n,options:r}=t,{itemType:a}=r;return`<li class="${o}__item"><div class="${o}__item-inner">${n.itemHeader(t,e,s,{index:i})}${n[a](t,e,s,{index:i})}</div></li>`},itemHeader:function(t,e,s,i){const{className:o,templates:n}=t;let{itemHeaderLeftText:r,itemHeaderRightText:a}=n;return r=Ys.asFunction(r)(t,e,s,i),a=Ys.asFunction(a)(t,e,s,i),`<div class="${o}__item-header">\n  <div class="${o}__item-header-left">${r}</div>\n  <div class="${o}__item-header-right">${a}</div>\n</div>`},affiliation:function(t,e,s,i){const{templates:o}=t,[n,r]=Qs(t,s,{link:!1});return""+n+(o.infoBlock||o.affiliationInfoBlock||Cs)(t,s,i)+(o.imageBlock||Ms)(t,s,{brand:!0,...i})+r},ctaText:"View deal",itemHeaderLeftText:"Today's best deals",itemHeaderRightText:function(t,e,s,i){const{className:o,templates:n}=t,r=Ys.asFunction(n.logoText)(t,e,s,i)||"",a=Ys.asFunction(n.logoImg)(t,e,s,i);return a?`<span class="${o}__item-header-logo-text">${r}</span>${a}`:""},logoImg:function(t,e,s,i){const{className:o,templates:n}=t,r=Ys.asFunction(n.logoUrl)(t,e,s,i);if(!r)return"";const a=Ys.asFunction(n.logoAltText)(t,e,s,i);return`<img class="${o}__item-header-logo" src="${r}"${a?` alt="${a}"`:""}>`},logoText:"Selected by"}),bo=Object.freeze({...li.defaultTemplates,...go});class yo extends li{static get type(){return"affiliation"}static get defaultTemplates(){return bo}static get defaultClassName(){return fo}constructor({className:t=fo,templates:e,autoplay:s,...i}={}){super({className:t,itemType:"affiliation",templates:{...go,...e},...i}),this._itemCount=void 0,this._itemIndex=0,this._displayedCount=void 0,this._displayedIndex=void 0,this._viewable=void 0}initialize(t){super.initialize(t);const{viewable:e}=this._view.tracker.options||{};this._viewable=new Z(this._onViewable.bind(this),e)}get itemIndex(){return this._itemIndex}set itemIndex(t){void 0!==this._itemCount&&(0>t?t=this._itemCount-1:this._itemCount>t||(t=0),this._itemIndex=t,y(()=>this._syncItemIndex()))}next(){void 0!==this._itemCount&&this.itemIndex++}previous(){void 0!==this._itemCount&&this.itemIndex--}_render(t,e,s){super._render(t,e,s),this._syncItemCount(e),this._syncItemIndex()}_syncElement(t){const e=this._element;super._syncElement(t),this._syncViewableElement(e,t)}_syncViewableElement(t,e){t!==e&&(t&&this._viewable.unobserve(t),e&&this._viewable.observe(e))}_syncItemCount({state:t}={}){const e=this._getItems(t),s=this._itemCount=e?e.length:void 0;if(s===this._displayedCount)return;let{element:i}=this._view;i=i.firstElementChild,i&&(mi(i,"data-item-count",s),this._displayedCount=s)}_syncItemIndex(){const t=this._itemIndex;if(t===this._displayedIndex)return;const{element:e}=this._view,s=e&&this._getListElement(e);s&&(this._displayedIndex=t,s.style.left=100*-t+"%",this._viewable.display(t),this._view._events.emit("display",{index:t}))}_onViewable(t){const e=this._getRenderedItemData(t);e&&this._view.tracker.viewable([e])}_getRenderedItemData(t){const{value:e}=this._rendered.get(this._element)||{};if(!e)return;const{products:s=[]}=e;return s[t]}_trackViewables(){}_onClick(t){const e=t.target;e.closest('[data-role="previous"]')?this.previous():e.closest('[data-role="next"]')?this.next():super._onClick(t)}}const vo="miso-facets",wo="miso-facet",Eo="custom_attributes.";const xo=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`<div class="${s}" ${i?`data-role="${i}"`:""}>${o.facets(t,e)}</div>`},facets:function(t,e){const{templates:s}=t,{facet_fields:i={}}=e.value||{};return Object.keys(i).map(o=>s.facet(t,{field:o,entries:i[o]},e))},facet:function(t,e,s){const{facetClassName:i=wo,templates:o}=t,{field:n}=e;return`<div class="${i}" data-role="facet" data-field="${w(n)}">${o.header(t,e,s)}${o.options(t,e,s)}</div>`},header:function(t,e,s){const{facetClassName:i=wo,templates:o}=t;return`<div class="${i}__header">${o.title(t,e,s)}</div>`},title:function(t,{field:e}){return e.startsWith(Eo)&&(e=e.substring(18)),w(e)},options:function(t,{field:e,entries:s},i){const{facetClassName:o=wo,templates:n}=t;return`<ul class="${o}__options" data-role="options">${s.map(([s,o])=>n.option(t,{field:e,value:s,count:o},i)).join("")}</ul>`},option:function(t,e,s){const{facetClassName:i=wo,templates:o}=t;return`\n<li class="${i}__option" data-role="option" tabindex="0">\n  <span class="${i}__value">${o.value(t,e,s)}</span>\n  <span class="${i}__count">${o.count(t,e,s)}</span>\n</li>`},value:function(t,{value:e},s){return w(e)},count:function(t,{count:e},s){return t.templates.helpers.formatNumber(e)}});function So(t,e){return`${t}:::${e}`}function Oo(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}class ko extends Ks{static get type(){return"facets"}static get defaultTemplates(){return xo}static get defaultClassName(){return vo}constructor({className:t=vo,templates:e,...s}={}){super({className:t,templates:{...xo,...e},...s}),this._bindings=new oi}initialize(t){const{proxyElement:e,filters:s}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t)),s.on("update",t=>this._updateSelections(t)),s.on("reset",()=>this._syncSelections())]}_render(t,e,s){super._render(t,e,s)}_afterRender(t,e){this._syncBindings(t,e),this._syncSelections()}_unrender(){this._clearBindings()}_syncSelections(){const t=Oo(this._view.hub.states.filters.facets);for(const{value:{field:e,value:s},element:i}of this._bindings.entries)this._setSelected(i,t[e]&&t[e].has(s))}_updateSelections({updates:t}){const e=Oo(t.facets);for(const{value:{field:t,value:s},element:i}of this._bindings.entries)e[t]&&this._setSelected(i,e[t].has(s))}_setSelected(t,e){t&&(e?t.classList.add("selected"):t.classList.remove("selected"))}_syncBindings(t,e){if(!t||!e.value)return;const s=this._getItems(e),i=[],o=[],n=[];for(const e of this._getFacetElements(t)){const t=e.getAttribute("data-field"),r=s[t];if(!r)continue;const a=this._getItemElements(e);for(let e=0;a.length>e;e++){const s=a[e],c=r[e];if(!c)break;i.push(So(t,c)),o.push({field:t,value:c}),n.push(s)}}this._bindings.update(i,o,n)}_clearBindings(){this._bindings.clear()}_getItems({value:t}={}){const{facet_fields:e={}}=t||{},s={};for(const t in e)s[w(t)]=e[t].map(([t])=>t);return s}_getFacetElements(t){return Array.from(t.querySelectorAll('[data-role="facet"]'))}_getFacetElement(t,e){return t.querySelector(`[data-role="facet"][data-field="${e}"]`)}_getItemElements(t){return Array.from(t.querySelectorAll('[data-role="option"]'))}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="option"]');if(!e)return;const s=this._bindings.get(e),i=s&&s.value;if(!i)return;const{field:o,value:n}=i;this._view.filters.facets.toggle(o,n),this._view.filters.apply()}destroy(){this._bindings.clear(),super.destroy()}}const Io="miso-select";const Co=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t,n=i?`data-role="${i}"`:"",r=t._getItems(e),a=r.find(t=>t.selected)||r[0];return`\n<div class="${s}" ${n}>\n  ${o.button(t,a)}\n  ${o.options(t,e)}\n</div>`},button:function(t,e){const{className:s,templates:i}=t;return`<button class="${s}__button" data-role="button" tabindex="0">${i.text(t,e)}</button>`},options:function(t,e){const{className:s,templates:i}=t;return`<ul class="${s}__options">${t._getItems(e).map((e,s)=>i.option(t,e,{index:s})).join("")}</ul>`},option:function(t,e){const{className:s,templates:i}=t;return`<li class="${s}__option ${e.selected?"selected":""}" data-role="option" tabindex="0">${i.text(t,e)}</li>`},text:function(t,e){return w(e&&e.text&&e.text.replace(/[-_]([a-zA-Z])/g,(t,e)=>" "+e)||e||"")}});class To extends Ks{static get type(){return"select"}static get defaultTemplates(){return Co}static get defaultClassName(){return Io}constructor({className:t=Io,templates:e,...s}={}){super({className:t,templates:{...Co,...e},...s}),this._initTrackable()}initialize(t){const{proxyElement:e}=t;this._unsubscribes=[...this._unsubscribes,e.on("click",t=>this._handleClick(t))]}_afterRender(t,e){this._syncBindings(t,e)}_unrender(){this._clearBindings()}_getItems(t){return t.value||[]}_getOptionsElement(t){return t.querySelector('[data-role="options"]')}_getItemElements(t){return t?Array.from(t.querySelectorAll('[data-role="option"]')):[]}_handleClick(t){if(this._element)for(let e=t.target;e&&e!==this._element;e=e.parentElement){const{role:t}=e.dataset;switch(t){case"button":this._toggle();break;case"option":const t=this._bindings.get(e);this._select(t&&t.value)}}}_toggle(){if(!this._element)return;const t=this._element.children[0];t&&t.classList.toggle("open")}async _select(t){t&&this._view._events.emit("select",{value:t})}destroy(){this._destroyTrackable(),super.destroy()}}ni(To.prototype);const Ao="miso-more-button";const Ro=Object.freeze({root:function(t,e){const{className:s,role:i,templates:o}=t;return`\n<div class="${s}"${i?` data-role="${i}"`:""}${e.status!==de.READY?" disabled":""}>\n  ${o.text(t)}\n</div>\n`},text:function(t){return"More"}});class No extends Ks{static get type(){return"more-button"}static get defaultTemplates(){return Ro}static get defaultClassName(){return Ao}constructor({className:t=Ao,templates:e,...s}={}){super({className:t,templates:{...Ro,...e},...s})}initialize(t){this._unsubscribes=[...this._unsubscribes,t.proxyElement.on("click",t=>this._handleClick(t))]}_handleClick(t){if(0!==t.button)return;const e=t.target.closest('[data-role="more"]');e&&!e.disabled&&this._view.hub.trigger("more")}}var $o=Object.freeze({__proto__:null,TemplateBasedLayout:Ks,ContainerLayout:Xs,ErrorLayout:ei,BannerLayout:class extends Ks{static get type(){return"banner"}static get defaultTemplates(){return si}constructor({className:t="miso-banner",templates:e,...s}={}){super({className:t,templates:{...si,...e},...s})}},CollectionLayout:li,ListLayout:hi,HorizontalLayout:_i,CardsLayout:class extends li{static get type(){return"cards"}static get defaultTemplates(){return super.defaultTemplates}static get defaultClassName(){return pi}constructor({className:t=pi,...e}={}){super({className:t,...e})}},CarouselLayout:ji,GalleryLayout:Fi,SearchBoxLayout:Hi,OptionListLayout:Ki,FeedbackLayout:so,TextLayout:no,TypewriterLayout:po,AffiliationLayout:yo,FacetsLayout:ko,SelectLayout:To,MoreButtonLayout:No});function Lo({qs:t,...e}={}){return D(e,{metadata:{question_source:t||_e.ORGANIC}})}function Uo(t){return t&&t.value&&t.value.revision}function Po(t){const e=function(t){if(!t)return de.INITIAL;const{request:e,error:s,value:i}=t;return s?de.ERRONEOUS:i?de.READY:e?de.LOADING:de.INITIAL}(t);return a({status:e,ongoing:e===de.READY?t.ongoing:void 0,...t})}function qo(t){const{session:e,value:s}=t;if(!e||!s)return;const{miso_id:i}=s;i&&(e.meta.miso_id=i)}function jo(t){const{request:e,value:s}=t;if(!e)return t;const{payload:i}=e||{},{q:o}=i||{};return o?{...t,value:{...s,keywords:o}}:t}function Do(t){const{role:e,type:s,items:i}=t,o={type:"viewable"===s?"viewable_impression":s,context:{custom_context:a({property:e})}};switch(function(t){return ue.has(t)}(s)&&(!function(t,e=[]){return function(t){return re.has(t)}(t)||e.length>0&&"object"==typeof e[0]&&e[0].product_id}(e,i)?(o.product_ids=[],o.context.custom_context.items=(i||[]).map(t=>t.text||t.id||t)):o.product_ids=(i||[]).map(t=>"string"==typeof t?t:t.product_id).filter(t=>t)),s){case ae.SUBMIT:o.context.custom_context.value=t.value;break;case ae.FEEDBACK:o.context.custom_context.value=o.value=t.value,o.context.custom_context.result_type=o.result_type=t.result_type}return a(o)}function zo(t,e){return t=function(t={},{data:e}={}){if(!e)return t;const{request:s={},value:i={}}=e,{question_source:o}=s.payload&&s.payload.metadata||{},{question_id:n}=i;return z(t,{context:{custom_context:{question_source:o,question_id:n}}})}(t,e),t=function(t,e){if(e.role!==ie.ANSWER)return t;const{items:s=[]}=e;return z(t,{context:{custom_context:{urls:s.map(t=>t.url),texts:s.map(t=>t.text),class_names:s.map(t=>t.className),attributes:s.map(t=>t.attributes)}}})}(t,e),t=function(t,{event_target:e}={}){if(!e)return t;return z(t,{context:{custom_context:{event_target:e}}})}(t,e)}const Mo=Object.freeze({}),Fo=Object.freeze({[ie.CONTAINER]:Xs.type,[ie.ERROR]:ei.type}),Bo=Object.freeze({}),Qo=Object.freeze({api:Mo,layouts:Fo,trackers:Bo}),Go=Object.freeze({mappings:{[ie.ERROR]:t=>t.error}});class Ho extends Y{constructor(t){super(t.name||"workflow",t.plugin);let{context:e,plugin:s,client:i,defaults:o,options:n,extraOptions:r}=t;this._context=e,this._plugin=s=s||e._plugin,this._client=i=i||e._client,t=Object.freeze({...t,plugin:s,client:i}),this._name=t.name,this._roles=t.roles,this._extensions=s._getExtensions(i),this._defaults=o,this._options=n||new Ue(e&&e._options,o),this._extraOptions=r||{},this._hub=new Ge({onUpdate:t=>this._onHubUpdate(t),onEmit:t=>this._onHubEmit(t)}),this._sessionContext=new WeakMap,i._events.emit("workflow",this),this._initProperties(t),this._initActors(t),this._initSubscriptions(t),this._initSession(t)}_initProperties(){}_initActors({roles:t}){const e=this._hub,s=this._client,i=this._options,o=this._extensions,n=this._plugin.layouts;this._sessions=new He(e),this._data=new Ve(e,{source:Ss(s),options:i,...this._extraOptions.api}),this._views=new ys(e,{extensions:o,layouts:n,roles:t,options:i,workflow:this}),this._interactions=new xs(e,{client:s,options:i})}_initSubscriptions({roles:t}){this._unsubscribes=[this._hub.on("session",t=>this._onSession(t)),this._hub.on("response",t=>this.updateData(t)),this._hub.on("tracker",t=>this._onTracker(t))],t.main&&this._unsubscribes.push(this._hub.on(Qe(t.main),t=>this._onMainViewUpdate(t)))}_initSession(){this.restart()}_getSessionContext(t){let e=this._sessionContext.get(t);return e||this._sessionContext.set(t,e={}),e}_onHubUpdate(t){this._runCallbacks(this._client.meta.parent._hubUpdateCallbacks,t)}_onHubEmit(t){this._runCallbacks(this._client.meta.parent._hubEmitCallbacks,t),this._emitAsWorkflowEvent(t)}_emitAsWorkflowEvent({action:t,name:e,state:s,silent:i}){i||this._emit(e,{_action:t,...s})}get uuid(){return this.session&&this.session.uuid}get session(){return this._hub.states.session}get states(){return this._hub.states}get status(){const t=this._hub.states.data;return t&&t.status}get views(){return this._views.interface}restart(){return this._emitInterruptEventIfNecessary(),this._sessions.restart(),this}_emitInterruptEventIfNecessary(){const{main:t}=this._roles;if(!t)return;const e=this._hub.states[Qe(t)]||{};e.session&&e.status===de.LOADING&&(this._emitLifecycleEvent("interrupt",e),this._emitLifecycleEvent("finally",e))}_onSession(t){this.updateData({session:t})}_onMainViewUpdate(t){const{status:e}=t,s=e===de.READY,i=e===de.ERRONEOUS;this._emitLifecycleEvent(i?"error":e,t),s&&this._emitLifecycleEvent("done",t),(s||i)&&this._emitLifecycleEvent("finally",t)}_shallEmitLifecycleEvent(t,{session:e}){const s=this._getSessionContext(e),i=s.lifecycleEvents||(s.lifecycleEvents=new Set),o=i.has(t);return i.add(t),!o}_emitLifecycleEvent(t,e){this._shallEmitLifecycleEvent(t,e)&&this._emit(t,e)}_request(t={}){const{session:e}=this,s=we(this._options.resolved.api,t);this.updateData({session:e,request:s}),this._hub.update("request",{...s,session:e})}updateData(t){if(!t)throw Error("Data is required.");const{session:e}=t;if(!e)throw Error("Session is required to update data.");if(!this.session)throw Error("No session is created yet. Call workflow.restart() to start a new session.");if(e.uuid!==this.session.uuid)return;const s=Uo(t);if(!c(s)){const t=Uo(this._hub.states.data);if(!c(t)&&t>=s)return}return this._updateData(t),this}_updateData(t){const e=this._hub.states.data;t=this._defaultProcessData(t,e);for(const s of this._options.resolved.dataProcessor)t=s(t,e);this._updateDataInHub(t,e)}_defaultProcessData(t,e){return t=function(t,e){if(!t||!t.value||t.request||!e||!e.request)return t;const{request:s}=e;return{...t,request:s}}(t,e),t=function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,meta:{...t.meta,miso_id:s}}:t}(t=Po(t)),t}_updateDataInHub(t){this._hub.update("data",t)}notifyViewUpdate(t,e){return e={status:de.READY,session:this.session,...e},this._hub.update(Qe(t),e),this}get trackers(){return this._views.trackers}_onTracker(t){const e=this._buildInteraction({...t,data:this._hub.states.data,workflow:this});this._sendInteraction(e)}_buildInteraction(t){let e=Do(t);e=this._defaultProcessInteraction(e,t);const{preprocess:s=[]}=this._options.resolved.interactions;for(const i of s)e=i(e,t);return e}_defaultProcessInteraction(t,e){return t=this._writeApiInfoToInteraction(t,e),t=function(t,e){const{data:s}=e;if(!s)return t;const i=s.request&&s.request.payload;if(!i)return t;const{question:o,q:n,fq:r}=i;return z(t,{context:{custom_context:{question:o,q:n,fq:r}}})}(t=this._writeMisoIdToInteraction(t,e),e),t=function(t,e){const{data:s}=e;if(!s)return t;const i=s.request&&s.request.payload&&s.request.payload.metadata;return i?z(t,{context:{custom_context:i}}):t}(t,e),t=function(t,e){if(e.role!==ie.AFFILIATION)return t;const{items:s}=e;return z(t,{context:{custom_context:{channel:s[0]&&s[0].channel||void 0,positions:s.map(t=>t.position)}}})}(t,e),t}_writeApiInfoToInteraction(t){const{group:e,name:s}=this._options.resolved.api;return z(t,{context:{custom_context:{api_group:e,api_name:s}}})}_writeMisoIdToInteraction(t,e){const s=this._hub.states[Qe(e.role)]||{},i=s.meta&&s.meta.miso_id||void 0;return i?z(t,{miso_id:i}):t}_sendInteraction(t){const{handle:e}=this._options.resolved.interactions;"function"==typeof e?e(t):this._hub.trigger("interaction",t)}destroy(t){this._emit("destroy"),this._destroy(t)}get destroyed(){return!!this._destroyed}_destroy({dom:t}={}){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],this._views._destroy({dom:t}),this._data._destroy(),this._destroyed=!0}_runCallbacks(t,e){for(const s of t)try{s({workflow:this,...e})}catch(t){this._error(t)}}_emit(t,e){this._events.emit(t,{_event:t,...e}),this._context&&this._context._events.emit(t,{workflow:this,_event:t,...e})}}function Wo(t){if(t.affiliation_products){const{affiliation_products:e,...s}=t;t={...s,affiliation:Vo(e)}}else if(t.sovrn_aff){const{sovrn_aff:e,...s}=t;t={...s,affiliation:Yo(e)}}return function(t){const{affiliation:e}=t;if(!e)return t;let{channel:s,products:i}=e;if(!i)return t;i=i.map(t=>({...t}));let o=0;for(const t of i)s&&(t.channel=s),t.position=o++;return{...t,affiliation:{...e,products:i}}}(t)}function Vo(t){return{channel:"miso",products:t}}function Yo({products:t,...e}){return{channel:"sovrn",...e,products:t.map(Ko)}}function Ko({id:t,deeplink:e,headline:s,description:i,currency:o,retailPrice:n,salePrice:r,discountRate:c,image:l,thumbnail:u,merchant:h,...d}){return a({id:"sovrn-"+t,title:s,description:i,cover_image:l,url:e,currency:o,original_price:n,sale_price:r,discount_rate_percent:c,brand:h&&h.name,brand_logo:h&&h.logo,custom_attributes:Zo({sovrn_id:t,thumbnail:u,merchant:h,...d})})}function Zo(t,e=""){return Object.keys(t).reduce((s,i)=>{const o=t[i];if(void 0===o)return s;const n=e?`${e}_${i}`:i;return"object"==typeof o?{...s,...Zo(o,n)}:{...s,[n]:o}},{})}function Jo(t){q(t,Xo.prototype)}De(Ho.prototype),Object.assign(Ho,{DEFAULT_API_OPTIONS:Mo,DEFAULT_LAYOUTS:Fo,DEFAULT_TRACKERS:Bo,DEFAULT_OPTIONS:Qo,ROLES_OPTIONS:Go});class Xo{useLink(t,e={}){if("function"!=typeof t&&!1!==t)throw Error("useLink(fn) expects fn to be a function or false");return this._linkFn=!!t&&[t,e],this}_submitToPage(t={}){if(!this._linkFn)return;const e=this._getSubmitUrl(t),[s,i={}]=this._linkFn;if(!1===i.open)window.location.href=e;else{window.open(e,i.target||"_blank",i.windowFeatures||"")}}_getSubmitUrl({q:t,...e}={}){if(!this._linkFn)throw Error("useLink(fn) must be called before _getSubmitUrl()");return this._linkFn[0](t,e)}}const tn=Object.freeze({...Ho.DEFAULT_API_OPTIONS,group:s.ASK,payload:{...Ho.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at"],cite_link:1,cite_start:"[",cite_end:"]"}}),en=Object.freeze({actor:!1,api:{group:s.ASK,name:i.AUTOCOMPLETE}}),sn=Object.freeze({...Ho.DEFAULT_LAYOUTS,[ie.QUERY]:[Hi.type,{placeholder:"Ask a question"}],[ie.QUESTION]:[no.type,{tag:"h2"}],[ie.ANSWER]:po.type,[ie.FEEDBACK]:so.type,[ie.IMAGES]:[Fi.type,{incremental:!0,itemType:"image"}],[ie.SOURCES]:[hi.type,{incremental:!0,itemType:"article",templates:{ordered:!0}}],[ie.AFFILIATION]:[yo.type,{incremental:!0,itemType:"affiliation",link:{rel:"noopener nofollow"}}]}),on=Object.freeze({...Ho.DEFAULT_TRACKERS,[ie.ANSWER]:{active:!0,itemless:!0,deduplicated:!1,click:ke.click},[ie.IMAGES]:ke,[ie.SOURCES]:ke,[ie.AFFILIATION]:ke,[ie.PRODUCTS]:ke}),nn=Object.freeze({...Ho.DEFAULT_OPTIONS,api:tn,autocomplete:en,layouts:sn,trackers:on}),rn=ge(Ho.ROLES_OPTIONS,{main:ie.ANSWER,members:Object.keys(sn),mappings:{[ie.ANSWER]:function(t){if(!t||!t.value)return;const{answer:e="",answer_stage:s,finished:i}=t.value;return Object.freeze({value:e,stage:s,finished:!!i})},[ie.REASONING]:function(t){if(!t||!t.value)return;const{reasoning:e="",reasoning_finished:s}=t.value;return Object.freeze({value:e,stage:"reasoning",finished:!!s})}}});class an extends Ho{_initProperties(t){super._initProperties(t),this._questionId=void 0,this._autoQuery=!1}_initActors(t){super._initActors(t),this._feedback=new Es(this._hub)}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._views.get(ie.ANSWER).on("citation-click",t=>this._onCitationClick(t)),this._views.get(ie.ANSWER).on("link-click",t=>this._onAnswerLinkClick(t))]}restart(){this._questionId&&(this._questionId=void 0),super.restart()}_shallEmitLifecycleEvent(t,e){return"answer-stage"===t||super._shallEmitLifecycleEvent(t,e)}_emitInterruptEventIfNecessary(){const t=this._hub.states[Qe(this._roles.main)]||{};t.session&&t.status!==de.INITIAL&&(t.status!==de.READY||t.ongoing)&&(this._emitLifecycleEvent("interrupt",t),this._emitLifecycleEvent("finally",t))}_onMainViewUpdate(t){const{status:e,session:s}=t,i=e===de.READY&&!t.ongoing,o=e===de.ERRONEOUS,n=i?"done":o?"error":e,r=this._getSessionContext(s),a=t.meta&&t.meta.answer_stage;a&&a!==r.answerStage&&(this._emitLifecycleEvent("answer-stage",Object.freeze({...t,answer_stage:a})),r.answerStage=a),this._emitLifecycleEvent(n,t),(i||o)&&this._emitLifecycleEvent("finally",t)}get questionId(){return this._questionId}autoQuery(t={}){Me.call(this,t)}query(t){if(!t.q&&!t.questionId)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t={}){if(this._linkFn)return void this._submitToPage(t);this.restart(),this._writeQuestionSourceToSession(t);const e=this._buildPayload(t);this._request({payload:e})}_writeQuestionSourceToSession(t){this.session.meta.question_source=t.qs||_e.ORGANIC}_buildPayload(){throw Error("Not implemented")}_writeWikiLinkTemplateToPayload(t){return this._autoQuery&&this._autoQuery.param&&"q"!==this._autoQuery.param?{...t,wiki_link_template:`?${this._autoQuery.param}=%s`}:t}_updateData(t){this._writeQuestionIdFromData(t),!t.value||t.value.answer_stage?(super._updateData(t),Fe.call(this,t)):this._handleHeadResponse(t)}_handleHeadResponse(t){}_defaultProcessData(t,e){return t=function(t){if(!t||!t.value)return t;const{value:e}=t;return{...t,value:Wo(e)}}(t=super._defaultProcessData(t,e)),t=function(t){const{value:e}=t;if(!e)return t;const{answer_stage:s}=e;return s?{...t,ongoing:!e.finished,meta:{...t.meta,answer_stage:s}}:t}(t),t}_writeQuestionIdFromData({value:t}){t&&this._writeQuestionId(t.question_id)}_defaultProcessInteraction(t,e){return t=zo(t=super._defaultProcessInteraction(t,e),e)}_getQuestionSourceFromViewState(t){const{request:e}=this._hub.states[Qe(t.role)]||{},{payload:s}=e||{};return s&&s.metadata&&s.metadata.question_source||void 0}_onCitationClick({index:t,event:e}){if(0!==e.button)return;if(ms(e))return;const{value:s}=this._hub.states.data||{},{sources:i}=s||{},o=i&&i[t-1];o&&o.product_id&&(fs(e),this._views.trackers.sources.click([o.product_id],{event_target:"citation-link"}))}_onAnswerLinkClick({event:t,...e}){0===t.button&&(ms(t)||(fs(t),this._views.trackers.answer.click([],{items:[e]})))}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t)}_clearQuestionId(){this._questionId=void 0}_destroy(t){this._feedback._destroy(),super._destroy(t)}}Jo(an.prototype),Object.assign(an,{DEFAULT_API_OPTIONS:tn,DEFAULT_AUTOCOMPLETE_OPTIONS:en,DEFAULT_LAYOUTS:sn,DEFAULT_TRACKERS:on,DEFAULT_OPTIONS:nn,ROLES_OPTIONS:rn});var cn=Object.freeze({__proto__:null,CLASS_PREFIX:"miso-ask-combo",CONAINER_TAG:"miso-ask"});var ln=Object.freeze({__proto__:null,question:"You asked...",sources:"This reply is based on the following articles",followUpQuestions:"Related questions you can explore",relatedResources:"Go beyond, and learn more about this topic",thoughts:"Thoughts"});class un{constructor({helpers:t}){this._helpers=t}errorSection(t){const{section:e,container:s}=this._helpers;return e(t,{name:"error"},[s(t,{name:"error",visibleWhen:"erroneous"},"<miso-error></miso-error>")])}answerGroup(t){return[this.answer(t),this.affiliation(t),this.sources(t)]}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}question(t){const{phrase:e}=this._helpers;return[e(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"]}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},[s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}affiliation(t){const{container:e}=this._helpers,{affiliation:s=!0}=t||{};return s?e(t,{name:"affiliation",visibleWhen:"nonempty"},["<miso-affiliation></miso-affiliation>"]):""}}class hn{constructor(t){this._context=t,u(this,{lowerCamelToKebab:_,kebabToLowerCamel:h,kebabOrSnakeToLowerCamel:d})}normalizeOptions({classPrefix:t,circledCitationIndex:e=!0,phrases:s,...i}={}){return{classPrefix:t=t||this._context.CLASS_PREFIX,circledCitationIndex:e,phrases:s=this.normalizePhraseOptions(s),...i}}normalizePhraseOptions(t={}){if(!t)return{};const e={};for(const s in t)e[this.normalizePhraseOptionKey(s)]=t[s];return e}normalizePhraseOptionKey(t){return"relatedQuestions"===(t=d(t))||"querySuggestions"===t?"followUpQuestions":t}phrase(t,{name:e,extraNames:s=[],tag:i="div",inline:o=!1}){const{classPrefix:n}=t;return`<${i} class="${o?n+"__phrase-inline":n+"__phrase"} ${[e,...s].map(t=>`${n}__${t}-phrase`).join(" ")}">${this.phraseText(t,h(e))}</${i}>`}phraseText(t,e){const{phrases:s={}}=t,i=s[e]||this._context.DEFAULT_PHRASES[e];switch(typeof i){case"function":return i(t);case"string":return i;default:return""}}section({classPrefix:t},{name:e},s){return this.element("section",{classes:[t+"__section",`${t}__${e}`]},s)}container({classPrefix:t,circledCitationIndex:e,parentQuestionId:s,workflow:i},{name:o,extraNames:n=[],visibleWhen:r,trait:a,logo:c=!1},l){const u=[o,...n].map(e=>`${t}__${e}-container`);return e&&u.push("miso-circled-citation-index"),this.element(this._context.CONAINER_TAG,{classes:u,visibleWhen:r,trait:a,logo:c,parentQuestionId:s,workflow:i},l)}element(t,e={},s=""){return`<${t}${this.attrs(e)}>${Array.isArray(s)?s.join(""):s}</${t}>`}attrs({classes:t=[],...e}={}){let s="";t.length&&(s+=` class="${t.join(" ")}"`);for(const t in e){const i=e[t];void 0!==i&&(s+=` ${_(t)}="${i}"`)}return s}}const dn=j(new hn({...cn,DEFAULT_PHRASES:ln})),_n=j(new class extends un{constructor(){super({helpers:dn})}answerGroup(t){const{container:e}=this._helpers;return[this.question(t),this.reasoning(t),this.answer(t),this.affiliation(t),this.sources(t),this.followUpQuestions(t),e(t,{name:"bottom-spacing",visibleWhen:"ongoing"})]}question(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"question",visibleWhen:"ready"},[t.parentQuestionId?"<hr>":"",s(t,{name:"question",tag:"div"}),"<miso-question></miso-question>"])}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready"},["<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}reasoning(t={}){const{phrases:e,reasoning:s={}}=t,{container:i,element:o,phraseText:n}=this._helpers,r=[];return s.expand&&r.push("expanded"),i(t,{name:"reasoning",visibleWhen:"nonempty"},[o("miso-stub",{classes:r,trait:"collapsible","data-role":"reasoning-box"},[o("div",{classes:["miso-collapsible__header"],"data-role":"toggle-expand"},[`<div class="miso-collapsible__icon">${s.icon||Li}</div>`,`<div class="miso-collapsible__title" data-role="title">${n(e,"thoughts")}</div>`,`<div class="miso-collapsible__toggle">${Ni}</div>`]),o("div",{classes:["miso-collapsible__body"]},["<miso-reasoning></miso-reasoning>"])])])}sources(t){const{container:e,phrase:s}=this._helpers;return e(t,{name:"sources",visibleWhen:"nonempty"},["<hr>",s(t,{name:"sources",tag:"h3"}),"<miso-sources></miso-sources>"])}followUpQuestions(t){const{container:e,phrase:s}=this._helpers,i="follow-up-questions",o=["query-suggestions"];return e(t,{name:i,extraNames:o,visibleWhen:"nonempty"},[s(t,{name:i,extraNames:o,tag:"h3"}),"<miso-follow-up-questions></miso-follow-up-questions>"])}followUps(t){const{features:e={}}=t;return!1===e.followUpQuestions?"":'<miso-follow-ups id="miso-ask-combo__follow-ups" class="miso-ask-combo__follow-ups"></miso-follow-ups>'}relatedResourcesSection(t){const{container:e,phrase:s,section:i}=this._helpers,{features:o={},logo:n=!0}=t;return i(t,{name:"related-resources"},!1===o.relatedResources?"":e({...t,workflow:"active"},{name:"related-resources",visibleWhen:"nonempty",logo:n},[s(t,{name:"related-resources",tag:"h2"}),"<miso-related-resources></miso-related-resources>"]))}}({helpers:dn}));function pn(t={}){const{normalizeOptions:e,section:s,container:i}=dn,{answerGroup:o}=_n;return s(t=e(t),{name:"follow-up"},[i(t,{name:"query",visibleWhen:"initial loading"},"<miso-query></miso-query>"),...o(t)])}var mn=Object.freeze({__proto__:null,helpers:dn,sections:_n,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=dn,{followUps:o,relatedResourcesSection:n,answerGroup:r}=_n;return""+s(t=e(t),{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},r(t))+o(t)+n(t)},followUp:pn});const fn=Object.freeze({...an.DEFAULT_API_OPTIONS,name:i.QUESTIONS,payload:{...an.DEFAULT_API_OPTIONS.payload,related_resource_fl:["cover_image","url","created_at","updated_at","published_at"]}}),gn=Object.freeze({...an.DEFAULT_LAYOUTS,[ie.QUERY]:[Hi.type,{templates:{buttonIcon:"send"}}],[ie.REASONING]:po.type,[ie.RELATED_RESOURCES]:[hi.type,{incremental:!0,itemType:"article"}],[ie.QUERY_SUGGESTIONS]:Ki.type,[ie.FOLLOW_UP_QUESTIONS]:Ki.type}),bn=Object.freeze({...an.DEFAULT_TRACKERS,[ie.RELATED_RESOURCES]:ke,[ie.QUERY_SUGGESTIONS]:{...ke,click:{...ke.click,validate:t=>0===t.button}}}),yn=Object.freeze({followUp:pn}),vn=Object.freeze({...an.DEFAULT_OPTIONS,api:fn,layouts:gn,trackers:bn,templates:yn}),wn=ge(an.ROLES_OPTIONS,{members:Object.keys(gn),mappings:{[ie.QUERY_SUGGESTIONS]:function(t,{workflow:e}={}){const s=e.previous,i=s&&s.states.data.value,o=i&&(i.suggested_followup_questions||i.followup_questions||[]);return o&&o.map(t=>({text:t}))},[ie.FOLLOW_UP_QUESTIONS]:function(t){if(t&&t.value)return(t.value.followup_questions||[]).map(t=>({text:t}))}}});class En extends an{constructor(t,e){super({name:"ask",context:t,roles:wn,defaults:vn,parentQuestionId:e})}_initProperties(t){super._initProperties(t);const{parentQuestionId:e}=t;u(this,{parentQuestionId:e})}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on(Qe(ie.REASONING),t=>this._onReasoningViewUpdate(t)),this._views.get(ie.ANSWER).on("follow-up-click",t=>this._onFollowUpClick(t)),this._views.get(ie.FOLLOW_UP_QUESTIONS).on("select",t=>this._onFollowUpQuestionSelect(t)),this._views.get(ie.QUERY_SUGGESTIONS).on("select",t=>this._onQuerySuggestionSelect(t))]}_initSession(t){t.parentQuestionId&&this._context._byPqid.set(t.parentQuestionId,this),this._context._events.emit("create",this),super._initSession(t)}restart(){const{next:t}=this;t&&t.destroy(),this._questionId&&this._context._byQid.delete(this._questionId),super.restart()}get rootQuestionId(){return this._context.root.questionId}get previous(){const{parentQuestionId:t}=this;return t?this._context.getByQuestionId(t):void 0}get next(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t):void 0}getOrCreateNext(){const{questionId:t}=this;return t?this._context.getByParentQuestionId(t,{autoCreate:!0}):void 0}_buildPayload({q:t,qs:e,questionId:s,...i}={}){if(s)return a({...i,question_id:s});const{parentQuestionId:o}=this;let n=a({...i,question:t,parent_question_id:o});return n=Lo({...n,qs:e}),n=this._writeWikiLinkTemplateToPayload(n),n}_updateData(t){super._updateData(t),this._triggerSuggestionsRefreshIfNecessary()}_triggerSuggestionsRefreshIfNecessary(){const{next:t}=this;if(!t)return;const e=t._views.get(ie.QUERY_SUGGESTIONS);e&&e.refresh()}_onReasoningViewUpdate({status:t,ongoing:e}){if(t!==de.READY||e)return;const s=this._getReasoningBoxElement();s&&s.classList.add("done")}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeAdditionalAskPropertiesToInteraction(t,e)}_writeAdditionalAskPropertiesToInteraction(t,e){const s=this.rootQuestionId;let i,o,n,{property:r}=t.context&&t.context.custom_context||{};return e.role!==ie.FOLLOW_UP_QUESTIONS&&e.role!==ie.QUERY_SUGGESTIONS||(r="suggested_followup_questions"),e.role===ie.QUERY_SUGGESTIONS?(o=this.previous&&this.previous.parentQuestionId,i=this.parentQuestionId,n=this.previous&&this.previous.session.meta.question_source):o=this.parentQuestionId,z(t,{context:{custom_context:a({property:r,root_question_id:s,parent_question_id:o,question_id:i,question_source:n})}})}_onFollowUpClick({q:t,event:e}={}){0===e.button&&this._submitFollowUpQuestion({q:t,qs:_e.INLINE_QUESTION_LINK})}_onFollowUpQuestionSelect({value:t}){this._submitFollowUpQuestion({q:t,qs:_e.SUGGESTED_QUESTIONS})}_submitFollowUpQuestion({q:t="",qs:e}={}){if(!(t=t.trim()))return;this.getOrCreateNext().query({q:t,qs:e})}_onQuerySuggestionSelect({value:t}){t&&this.query({q:t,qs:_e.SUGGESTED_QUESTIONS})}_writeQuestionId(t){!this._questionId&&t&&(this._questionId=t,this._context._byQid.set(t,this))}_clearQuestionId(){this._questionId&&(this._context._byQid.delete(this._questionId),this._questionId=void 0)}_getReasoningBoxElement(){const t=this._views.get(ie.REASONING),e=t&&t.element;return e&&e.closest('[data-role="reasoning-box"]')}_destroy(t){const{next:e,parentQuestionId:s,questionId:i}=this;e&&e.destroy(t),s&&this._context._byPqid.delete(s),i&&this._context._byQid.delete(i),super._destroy(t)}}const xn={event:"done"};class Sn extends Be{constructor(t,e){super("asks",t,e),this._byQid=new Map,this._byPqid=new Map,this._root=new En(this),this._events.on("*",t=>this._createNextIfNecessary(t)),this._events.on("loading",t=>this._setActive(t.workflow)),this._events.on("destroy",()=>this._requestEmitAfterDestroy()),this._events.on("after-destroy",()=>this._syncActiveOnAfterDestroy()),this._autoNextFn=void 0,this._active=this._root}get root(){return this._root}get workflows(){return[this._root,...this._byPqid.values()]}get active(){return this._active}getByQuestionId(t){if("string"!=typeof t)throw Error("Required ID to be a string: "+t);return this._byQid.get(t)}getByParentQuestionId(t,{autoCreate:e=!1}={}){if(void 0===t)return this._root;if("string"!=typeof t)throw Error("Required ID to be a string: "+t);let s=this._byPqid.get(t);return!s&&e&&(s=new En(this,t)),s}reset({root:t=!0,events:e,...s}={}){void 0===e&&(e=!!t),e&&this._events.clear();for(const t of this._byPqid.values())t.destroy(s);t&&this._root.restart()}autoNext(t){this._autoNextFn=function(t=xn){switch(!0===t&&(t=xn),"string"==typeof t&&(t={event:t}),typeof t){case"object":return e=>e&&t.event===e._event;case"function":return t;default:return()=>!1}}(t)}_createNextIfNecessary(t){if(!this._autoNextFn||!this._autoNextFn(t))return;const{workflow:e}=t;e&&e.getOrCreateNext()}_requestEmitAfterDestroy(){this._emitAfterDestroyRequested||(this._emitAfterDestroyRequested=!0,setTimeout(()=>{this._emitAfterDestroyRequested=!1,this._events.emit("after-destroy",{})},0))}_syncActiveOnAfterDestroy(){if(!this._active.destroyed)return;let t=this._root;for(;t.next&&t.next.status!==de.INITIAL;t=t.next);this._setActive(t)}_setActive(t){t!==this._active&&(this._active=t,this._events.emit("active",{workflow:t}))}}De(Sn.prototype,[me.TEMPLATES]);const On=Object.freeze({...Ho.DEFAULT_API_OPTIONS,group:s.SEARCH,payload:{...Ho.DEFAULT_API_OPTIONS.payload,fl:["cover_image","url","created_at","updated_at","published_at","title"],rows:10}}),kn=Object.freeze({...Ho.DEFAULT_LAYOUTS,[ie.QUERY]:[Hi.type],[ie.PRODUCTS]:[hi.type,{incremental:!0,infiniteScroll:!0}],[ie.KEYWORDS]:[no.type,{raw:!0}],[ie.TOTAL]:[no.type,{raw:!0,format:"number"}],[ie.FACETS]:[ko.type],[ie.SORT]:[To.type],[ie.MORE]:[No.type]}),In=Object.freeze({...Ho.DEFAULT_TRACKERS,[ie.PRODUCTS]:ke}),Cn=Object.freeze({active:!1,mode:"infiniteScroll",pageLimit:10}),Tn=Object.freeze({...Ho.DEFAULT_OPTIONS,api:On,layouts:kn,trackers:In,pagination:Cn}),An=ge(Ho.ROLES_OPTIONS,{main:ie.PRODUCTS,members:Object.keys(kn),mappings:{[ie.FACETS]:"facet_counts",[ie.SORT]:function(t,{hub:e,workflowOptions:s={}}={}){const{sort:{options:i=[]}={}}=s.filters||{};if(!i.length)return[];const{sort:o}=e.states.filters||{},n=o&&o.field||function(t){for(const e of t)if(e.default)return e;return t[0]}(i).field;return n?i.map(t=>({...t,selected:t.field===n})):i}}});class Rn extends Ho{_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._hub.on("query",t=>this._query(t)),this._hub.on("filters",()=>this._refine()),this._hub.on("more",()=>this._more()),this._views.get(ie.SORT).on("select",t=>this._handleSortSelect(t))]}restart(){super.restart(),this._page=0}get exhausted(){const t=this._hub.states.data;return!!(t&&t.meta&&t.meta.exhausted)}get page(){return this._page}autoQuery(t={}){Me.call(this,t)}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){if(this._linkFn)return void this._submitToPage(t);const e=fe.QUERY;this._views.filters.reset({silent:!0}),this.restart({type:e});const s=this._buildPayload(t,e);this._request({payload:s,type:e})}_refine(){const t=fe.REFINE,{facet_counts:e}=this._hub.states.data.value||{};this._currentFacetCounts=e,this.restart({type:t});const s=this._getQuery(),i=this._buildPayload(s,t);this._request({payload:i,type:t})}_more(){if(this.status!==de.READY)throw Error("Can not call more() while loading.");if(this.exhausted||this._page>=9)return;this._page++;const t=fe.MORE,e=this._getQuery(),s=this._buildPayload(e,t);this._request({payload:s,type:t})}_getQuery(){return this._hub.states.query}_getPageSize(){return this._options.resolved.api.payload.rows}_buildPayload(t,e){return t=this._writeFiltersToPayload(t),t=this._writePageInfoToPayload(t),e===fe.MORE&&(t=this._processPayloadForMoreRequest(t)),t}_writeFiltersToPayload(t){const e=this._hub.states.filters,{facets:s,sort:i}=e||{};return a({...t,facet_filters:this._buildFacetFilters(s),order_by:this._buildOrderBy(i)})}_buildFacetFilters(t){if(!t)return;const e={};for(const s in t){const i=t[s];i&&i.length&&(e[s]={terms:i})}return Object.keys(e).length?e:void 0}_buildOrderBy(t){if(t)return r(t)}_writePageInfoToPayload(t){return{...t,metadata:{...t.metadata,page:this._page}}}_processPayloadForMoreRequest(t={}){const e=this._hub.states.data,{[this._roles.main]:s=[]}=e&&e.value||{},i=s.map(t=>t.product_id).filter(t=>t),o=[...t.exclude||[],...i];return 0===o.length?t:{...t,exclude:o}}_defaultProcessData(t,e){return t=function(t,e){if(!e)return t;const{status:s,value:i}=t;switch(s){case de.INITIAL:case de.LOADING:break;default:return t}return i&&i.facet_counts?t:{...t,value:{...i,facet_counts:e}}}(t=jo(t=super._defaultProcessData(t,e)),this._currentFacetCounts),t=function(t,{role:e=ie.PRODUCTS}={}){const{status:s,request:i,value:o}=t;if(s!==de.READY||!i||!o)return t;const{[e]:n}=o;if(!n)return t;const{rows:r}=i.payload,{length:a}=n;return r>a?{...t,meta:{...t.meta,exhausted:!0}}:t}(t,{role:this._roles.main}),t}_updateData(t){super._updateData(t),Fe.call(this,t)}_updateDataInHub(t,e){t=this._appendResultsFromMoreRequest(t),super._updateDataInHub(t,e)}_appendResultsFromMoreRequest(t){const{request:e}=t;if(!e)return t;const{metadata:s}=e.payload;if(!s||!s.page)return function(t){const{value:e}=t;if(!e)return t;const{miso_id:s}=e;return s?{...t,value:{...e,root_miso_id:s}}:t}(t);return function(t,e,{role:s=ie.PRODUCTS}={}){if(!e.value)return t;const{[s]:i=[],facet_counts:o,total:n,root_miso_id:r}=t.value,{[s]:a=[]}=e.value;return{...e,value:{...e.value,facet_counts:o,total:n,root_miso_id:r,[s]:[...i,...a]}}}(this._hub.states.data,t,{role:this._roles.main})}_handleSortSelect({value:t}={}){t&&(this._views.filters.update({sort:t}),this._views.filters.apply())}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeRootMisoIdToInteraction(t)}_writeRootMisoIdToInteraction(t){const e=this._hub.states.data,{root_miso_id:s}=e&&e.value||{};return s?z(t,{context:{custom_context:{root_miso_id:s}}}):t}}De(Rn.prototype,[me.PAGINATION,me.FILTERS]),Jo(Rn.prototype),Object.assign(Rn,{DEFAULT_API_OPTIONS:On,DEFAULT_LAYOUTS:kn,DEFAULT_TRACKERS:In,DEFAULT_PAGINATION:Cn,DEFAULT_OPTIONS:Tn,ROLES_OPTIONS:An});const Nn=an.ROLES_OPTIONS;class $n extends an{constructor(t){super({name:"hybrid-search/answer",plugin:t._plugin,client:t._client,options:t._options,defaults:t._defaults,roles:Nn,superworkflow:t})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow}_initSession(){}_doLoading(t){const{session:e}=this;this.updateData({...t,session:e})}_queryWithQuestionId(t){const{session:e}=this,{request:s,value:i}=t;this.updateData({...t,session:e});const{question_id:o}=i;if(!o)return;const n={...s.payload,question_id:o};void 0!==n.metadata.page&&delete n.metadata.page,this._hub.update("request",{...s,payload:n,session:e})}_defaultProcessData(t,e){return t=function(t){const{session:e,value:s}=t;if(!e||!s)return t;const{meta:{miso_id:i}={}}=e;return i?{...t,meta:{...t.meta,miso_id:i}}:t}(t=jo(t=super._defaultProcessData(t,e))),t=function(t){const{value:e}=t;return e?!e.finished||"success"!==e.finish_reason||e.sources&&e.sources.length>0?t:{...t,meta:{...t.meta,unanswerable:!0}}:t}(t),t}_handleHeadResponse(t){super._handleHeadResponse(t),qo(t)}_onTracker(t){this._superworkflow._onTracker(t)}}const Ln=Rn.ROLES_OPTIONS.members;class Un{constructor(t){this._subviews=t,this._containers=new Set}get filters(){return this._subviews.results.filters}get(t){return this._getSubviews(t).get(t)}addContainer(t){if(this._containers.has(t))return;this._containers.add(t);const{components:e}=t;for(const t of e)this.addComponent(t)}removeContainer(t){for(const e of this._getAllSubviews())e.removeContainer(t);this._containers.delete(t)}addComponent(t){this._getViewByElement(t).element=t,this._addContainerToSubviews(t._container,t)}removeComponent(t){this._getViewByElement(t).element=void 0,this._removeContainerFromSubviewsIfNecessary(t._container)}updateComponentRole(t,e,s){}refreshElement(t){const e=t.isContainer?this._containers.get(t):this._getViewByElement(t);e&&e.refresh({force:!0})}_getAllSubviews(){return Object.values(this._subviews)}_getSubviews(t){return this._subviews[function(t){return Ln.includes(t)?"results":"answer"}(t)]}_getViewByElement(t){let{role:e}=t;if(!e)throw Error("Component must have a role");return this.get(e)}_addContainerToSubviews(t,e){if(!t)return;const{role:s}=e,i=this._getSubviews(s);if(!i._containers.has(t)){for(const s of this._getAllSubviews())if(s!==i&&s._containers.has(t)){for(const i of t.components)if(s.containsElement(i))throw Error(`<${t.tagName.toLowerCase()}> cannot contain both <${i.tagName.toLowerCase()}> and <${e.tagName.toLowerCase()}>, for they don't share the same data lifecycle.`);throw Error(`Failed to add container <${t.tagName.toLowerCase()}> with child component <${e.tagName.toLowerCase()}>.`)}i.addContainer(t)}}_removeContainerFromSubviewsIfNecessary(t){if(t&&0>=t.components.length)for(const e of this._getAllSubviews())e.removeContainer(t)}}const Pn=Object.freeze({members:[]});function qn({layouts:t,trackers:e,...s}={}){return{active:!1,...s,layouts:{},trackers:{}}}function jn(t){return t&&t.value&&t.value.trim()||void 0}class Dn extends Ho{constructor(t,{defaults:e,...s}={}){super({name:"autocomplete",plugin:t._plugin,client:t._client,defaults:qn(e),roles:Pn,superworkflow:t,...s})}_initProperties(t){super._initProperties(t),this._superworkflow=t.superworkflow,this._active=t.defaults.active}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,t.superworkflow._hub.on("input",t=>this._query(t))]}get enabled(){return this._active}enable(){this._active=!0}disable(){this._active=!1}_query(t){if(!this._active||(e=this._args,jn(t)===jn(e)))return;var e;this._args=t,this.restart();const{session:s}=this;if(s.meta.input=t,!jn(t))return void this._updateCompletions({session:s,status:de.INITIAL});const i=this._buildPayload(t);this._request({payload:i})}_buildPayload(t){return{q:jn(t)}}_updateDataInHub(t){t.value&&(t={...t,value:t.value.completions}),this._updateCompletions(t)}_updateCompletions(t){this._superworkflow.updateCompletions(t)}}function zn(t){q(t,Mn.prototype)}class Mn{_initAutocomplete(t){this._autocomplete=new Dn(this,{defaults:t.defaults.autocomplete})}get autocomplete(){return this._autocomplete}updateCompletions(t){return this._hub.update("completions",t),this}_destroyAutocomplete(){this._autocomplete&&this._autocomplete._destroy(),this._autocomplete=void 0}}const Fn=Object.freeze({group:s.ASK,name:i.SEARCH,payload:{...an.DEFAULT_API_OPTIONS.payload,...Rn.DEFAULT_API_OPTIONS.payload,source_fl:["cover_image","url","created_at","updated_at","published_at","title","authors"]}}),Bn=Object.freeze({...an.DEFAULT_LAYOUTS,...Rn.DEFAULT_LAYOUTS,[ie.QUERY]:[Hi.type,{placeholder:""}],[ie.QUESTION]:[no.type,{raw:!0}],[ie.SOURCES]:[_i.type,{incremental:!0,itemType:"article",templates:{ordered:!0,article:Is,articleInfoBlock:Rs}}]}),Qn=Object.freeze({...an.DEFAULT_TRACKERS,...Rn.DEFAULT_TRACKERS}),Gn=Object.freeze({...Rn.DEFAULT_PAGINATION,active:!0}),Hn=Object.freeze({api:{group:s.ASK,name:i.SEARCH_AUTOCOMPLETE,payload:{completion_fields:["suggested_queries"]}}}),Wn=Object.freeze({sort:{options:[{field:"relevance",text:"Relevance",default:!0},{field:"published_at",text:"Date"}]}}),Vn=Object.freeze({...an.DEFAULT_OPTIONS,...Rn.DEFAULT_OPTIONS,api:Fn,layouts:Bn,trackers:Qn,autocomplete:Hn,pagination:Gn,filters:Wn}),Yn=Object.freeze({main:ie.PRODUCTS,members:Object.keys(Bn),mappings:Object.freeze({...an.ROLES_OPTIONS.mappings,...Rn.ROLES_OPTIONS.mappings})}),Kn=Object.freeze({api:Object.freeze({polling:!1})});class Zn extends Rn{constructor(t,e){super({name:"hybrid-search",plugin:t,client:e,roles:Yn,defaults:Vn,extraOptions:Kn})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t),this._answer=new $n(this)}_initActors(t){super._initActors(t),this._views=new Un({results:this._views,answer:this._answer._views})}restart({type:t}={}){super.restart(),t&&t!==fe.QUERY||this._answer.restart()}get answer(){return this._answer}get questionId(){return this._answer.questionId}_buildPayload(t,e){return t=function(t,e){return e===fe.QUERY?t:{...t,answer:!1}}(t=super._buildPayload(t,e),e),t=Lo(t),!1!==(t=this._writeQuestionIdToPayload(t,e)).answer&&(t=an.prototype._writeWikiLinkTemplateToPayload.call(this,t)),t}_buildOrderBy(t){if(t)return t.field}_writeQuestionIdToPayload(t,e){if(e===fe.QUERY)return t;const s=this._answer.questionId;return s?D(t,{metadata:{question_id:s}}):t}_defaultProcessData(t,e){return qo(t=super._defaultProcessData(t,e)),t}_updateDataInHub(t,e){this._dispatchDataToAnswerWorkflow(t),t=function(t,e){const{question_id:s}=e&&e.value||{};return s?{...t,value:{...t.value,question_id:s}}:t}(t,e),super._updateDataInHub(t,e)}_dispatchDataToAnswerWorkflow(t){const{request:e}=t;if(!e)return;const{type:s,payload:i}=e;if(s===fe.QUERY&&i&&!1!==i.answer)switch(t.status){case de.LOADING:this._answer._doLoading(t);break;case de.READY:this._answer._queryWithQuestionId(t)}}_defaultProcessInteraction(t,e){return t=zo(t=super._defaultProcessInteraction(t,e),e)}_destroy(){this._answer.destroy(),super._destroy()}}De(Zn.prototype,[me.PAGINATION,me.FILTERS]),zn(Zn.prototype);const Jn=Object.freeze({group:s.SEARCH,name:i.SEARCH,payload:{fl:["*"]}}),Xn=Object.freeze({api:{group:s.SEARCH,name:i.AUTOCOMPLETE,payload:{completion_fields:["suggested_queries","title"],fl:["title","url","cover_image"]}}}),tr=Object.freeze({...Rn.DEFAULT_LAYOUTS}),er=Object.freeze({...Rn.DEFAULT_TRACKERS}),sr=Object.freeze({...Rn.DEFAULT_OPTIONS,api:Jn,autocomplete:Xn,layouts:tr,trackers:er}),ir=Rn.ROLES_OPTIONS;class or extends Rn{constructor(t,e){super({name:"search",plugin:t,client:e,roles:ir,defaults:sr})}_initProperties(t){super._initProperties(t),this._initAutocomplete(t)}notifyViewUpdate(t=ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}_destroy(t){this._destroyAutocomplete(),super._destroy(t)}}zn(or.prototype);class nr extends Be{constructor(t,e,s){super(t,e,s),this._members=new Map}workflows(){return[...this._members.values()]}create(t=se){if(this._members.has(t))throw Error("Unit already exists: "+t);return this._create(t)}has(t=se){return this._members.has(t)}get(t=se){if("string"!=typeof t)throw Error("Required unit ID to be a string: "+t);return this._members.get(t)||this._create(t)}_create(t){throw Error("Not implemented")}}class rr extends Ho{_initProperties(t){super._initProperties(t);const{id:e}=t;u(this,{id:e})}_initSession(t){this._context._members.set(t.id,this),super._initSession(t)}_defaultProcessInteraction(t,e){return t=super._defaultProcessInteraction(t,e),t=this._writeUnitIdToInteraction(t,e)}_writeUnitIdToInteraction(t){return z(t,{context:{custom_context:{unit_id:this.id,unit_instance_uuid:this.uuid}}})}_destroy(t){this._context._members.delete(this.id),super._destroy(t)}}Object.assign(rr,{DEFAULT_API_OPTIONS:Ho.DEFAULT_API_OPTIONS,DEFAULT_LAYOUTS:Ho.DEFAULT_LAYOUTS,DEFAULT_TRACKERS:Ho.DEFAULT_TRACKERS,DEFAULT_OPTIONS:Ho.DEFAULT_OPTIONS,ROLES_OPTIONS:Ho.ROLES_OPTIONS});const ar=Object.freeze({...rr.DEFAULT_API_OPTIONS,group:s.RECOMMENDATION,name:i.USER_TO_PRODUCTS,payload:{...rr.DEFAULT_API_OPTIONS.payload,fl:["*"]}}),cr=Object.freeze({...rr.DEFAULT_LAYOUTS,[ie.PRODUCTS]:hi.type}),lr=Object.freeze({...rr.DEFAULT_TRACKERS,[ie.PRODUCTS]:ke}),ur=Object.freeze({...rr.DEFAULT_OPTIONS,api:ar,layouts:cr,trackers:lr}),hr=ge(rr.ROLES_OPTIONS,{main:ie.PRODUCTS,members:Object.keys(cr)});class dr extends rr{constructor(t,e){super({name:"recommendation",context:t,roles:hr,defaults:ur,id:e})}start(){return this._request(),this}notifyViewUpdate(t=ie.PRODUCTS,...e){return super.notifyViewUpdate(t,...e),this}}class _r extends nr{constructor(t,e){super("recommendations",t,e)}_create(t){return new dr(this,t)}}const pr=Object.freeze({...rr.DEFAULT_API_OPTIONS,group:s.ASK,name:i.RELATED_QUESTIONS}),mr=Object.freeze({...rr.DEFAULT_LAYOUTS,[ie.RELATED_QUESTIONS]:[hi.type,{itemType:"question",link:{rel:"noopener nofollow"}}],[ie.QUERY]:[Hi.type,{placeholder:"Ask a question"}]}),fr=Object.freeze({...rr.DEFAULT_TRACKERS,[ie.RELATED_QUESTIONS]:ke,[ie.CONTAINER]:{...ke,itemless:!0},[ie.QUERY]:{[ae.SUBMIT]:{active:!0}}}),gr=Object.freeze({...rr.DEFAULT_OPTIONS,api:pr,layouts:mr,trackers:fr}),br=ge(rr.ROLES_OPTIONS,{main:ie.RELATED_QUESTIONS,members:Object.keys(mr)});class yr extends rr{constructor(t,e){super({name:"explore",context:t,roles:br,defaults:gr,id:e})}_initProperties(t){super._initProperties(t),this._productId=void 0,this._linkFn=void 0}_initSubscriptions(t){super._initSubscriptions(t),this._unsubscribes=[...this._unsubscribes,this._views.get(ie.RELATED_QUESTIONS).on("click",t=>this._handleRelatedQuestionClick(t)),this._hub.on("query",t=>this._query(t))]}set productId(t){console.warning("DEPRECATED: use useApi() instead"),this.useApi({product_id:t})}useApi(...t){const e=("object"==typeof t[0]?t[0]:t[1])||{},{product_id:s}=e;return s&&(this._productId=s),super.useApi(...t)}useLink(t,e){return Xo.prototype.useLink.call(this,t,e),e&&this.useLayouts({[ie.RELATED_QUESTIONS]:{link:e}}),this}start({relatedQuestions:t=!0}={}){if(void 0===this._linkFn)throw Error("Must define link mapping function with useLink(fn) before calling start()");if(t)this._request();else{const{session:t}=this;this.updateData({session:t,request:{},value:{related_questions:[]}})}return this}notifyViewUpdate(t=ie.RELATED_QUESTIONS,...e){return super.notifyViewUpdate(t,...e),this}_defaultProcessData(t,e){return t=super._defaultProcessData(t,e),t=this._addUrlToRelatedQuestions(t)}_addUrlToRelatedQuestions(t){const{value:e}=t;if(!e||!e.related_questions)return t;const s=e.related_questions.map(this._linkFn&&this._linkFn[0]?t=>({text:t,url:this._getSubmitUrl({q:t,generated:!0})}):t=>({text:t}));return{...t,value:{...e,related_questions:s}}}_handleRelatedQuestionClick({value:t,...e}){this._events.emit("select",Object.freeze({...e,question:t}))}query(t){if(!t.q)throw Error("q is required in query() call");this._hub.update("query",t)}_query(t){this._submitToPage({...t,generated:!1})}_getSubmitUrl(t){let e=Xo.prototype._getSubmitUrl.call(this,t);return t.generated&&this._productId?`${e}&qs=${encodeURIComponent(this._productId)}`:e}}Jo(yr.prototype);class vr extends nr{constructor(t,e){super("explores",t,e)}_create(t){return new yr(this,t)}}class wr extends Y{constructor({name:t,plugin:e,MisoClient:s,...i}){super(t||"combo",e),this._name=t,this._plugin=e,this._MisoClient=s,this._options=i}get MisoClient(){return this._MisoClient}get element(){return this._element}async waitForElement(){return this._element||(this._elementRes||(this._elementRes=new I)).promise}set element(t){this._element=t,this._elementRes&&this._elementRes.resolve(t)}start(t){this._started||(this._started=!0,t&&this.config(t),this._start())}_start(){throw Error("Unimplemented")}}const Er=Object.freeze(cn),xr=Object.freeze(ln),Sr=Object.freeze(mn);var Or=Object.freeze({__proto__:null,constants:Er,phrases:xr,templates:Sr,wireFollowUps:function(t,e,s){if(!t)throw Error("client is required");!function(t,{template:e=pn,...s}={}){if("function"!=typeof e)throw Error("template must be a function or undefined");const i=Object.keys(s).length>0;if(e===pn&&!i)return;t.ui.asks.useTemplates({followUp:i?t=>e({...s,...t}):e})}(t,s),function(t){if(!t||"miso-follow-ups"===t.tagName.toLowerCase())return;const e=document.createElement("miso-follow-ups");for(const{name:s,value:i}of t.attributes)e.setAttribute(s,i);t.parentNode.replaceChild(e,t)}(e)},wireRelatedResources:function(t,e){if(!t)throw Error("client is required");if(e)for(const t of e.querySelectorAll("miso-ask"))t.setAttribute("workflow","active")}});const{currentScript:kr}=document,Ir=Object.freeze({templates:Sr,autostart:!0}),Cr=["templates","phrases","features"];class Tr{constructor(){this._defaults=Ir,this._scriptSrc=function(){if(!kr||!kr.src)return{};const t=document.createElement("a");t.href=kr.src;const e={};for(const[s,i]of new URLSearchParams(t.search))"q"!==s&&(e[s]=Nr(i));return e}(),this._pageUrl=function(){const t={};for(const[e,s]of new URLSearchParams(window.location.search))e.startsWith("miso_")&&e.length>5&&"miso_api_key"!==e?t[e.substring(5)]=Nr(s):"q"===e&&(t.q=s);return t}()}resolve(t){return function({api_key:t,api_host:e,templates:s,phrases:i,...o}={}){return a({apiKey:t,apiHost:e,templates:$r(s),phrases:i,...o})}(Ar(this._defaults,this._scriptSrc,t,this._pageUrl))}}function Ar(...t){let e={};for(const s of t)s&&(e=Rr(e,s));return e}function Rr(t,e){if(!e)return t;Object.assign(t,e);for(const s of Cr)s in e&&(t[s]={...t[s],...e[s]});return t}function Nr(t){return""===t||"false"!==t&&t}function $r(t){if(null==t)return t;switch(typeof t){case"function":return t;case"string":case"number":return()=>t;case"object":return Array.isArray(t)?t.map($r):function(t,e){const s={};for(const[i,o]of Object.entries(t))s[i]=e(o);return s}(t,$r);default:throw Error("Unsupported template type: "+t)}}class Lr{constructor(t,{classPrefix:e=Er.CLASS_PREFIX}={}){if(!t)throw Error("Root element is required");u(this,{root:t,followUpsSection:t.querySelector(`.${e}__follow-ups`),relatedResourcesSection:t.querySelector(`.${e}__related-resources`),relatedResourcesContainer:t.querySelector(`.${e}__related-resources miso-ask`)})}}class Ur extends wr{constructor(t,e){super({name:"ask-combo",plugin:t,MisoClient:e}),this._options=new Tr,this._localOptions={}}config(t={}){t=Ar(this._localOptions,t);const e=this._options.resolve(t);return this._localOptions=t,this._resolvedOptions=e,this}get resolvedOptions(){return this._resolvedOptions||(this._resolvedOptions=this._options.resolve(this._localOptions))}get client(){return this._client}get elements(){return this._elements}autoStart(){this.resolvedOptions.autostart&&this.start()}async _start(){await async function(){"loading"===document.readyState&&await new Promise(t=>{document.addEventListener("DOMContentLoaded",t,{once:!0})})}(),await this.waitForElement(),await this._setupMisoClient(),this._renderRootContent(),this._createClientInstance(),this._setupWorkflows()}async _setupMisoClient(){const{MisoClient:t,resolvedOptions:e}=this,{version:s}=t;u(t,{name:"miso-ask-combo"});("dev"===s||s.indexOf("beta")>0||e.debug)&&t.plugins.use("std:debug"),e.dry_run&&t.plugins.use("std:dry-run"),e.lorem&&await t.plugins.install("std:lorem")}_renderRootContent(){const{element:t,resolvedOptions:e}=this,{templates:s={}}=e;t.innerHTML=s.root(e),this._elements=new Lr(t,e)}async _createClientInstance(){this._client=new MisoClient(this.resolvedOptions)}async _setupWorkflows(){const{MisoClient:t,client:e,elements:s,resolvedOptions:i}=this,{wireFollowUps:o,wireRelatedResources:n}=t.ui.defaults.ask,{templates:r={},features:a={},api:c}=i,l=e.ui.ask;c&&e.ui.asks.useApi(c),!1!==a.followUpQuestions&&o(e,s.followUpsSection,{...i,template:r.followUp}),!1!==a.relatedResources&&!1!==a.followUpQuestions&&n(e,s.relatedResourcesSection),l.autoQuery()}}class Pr extends K{constructor(t){super("layouts",t,{libName:"layout",keyName:t=>t.type}),this._plugin=t}get(t){return this._libraries[t]}create(t,e){if(!1!==t)switch(typeof t){case"function":return{render:t};case"string":const s=this.get(t);if(!s)throw Error(`Layout of name '${t}' not found.`);return new s(e);default:throw Error("Expect a string, a render function, or boolean value false: "+t)}}}const qr="trait",jr=Object.freeze([qr]);class Dr extends HTMLElement{static get tagName(){return"miso-stub"}static get observedAttributes(){return jr}constructor(){super(),this._traits=[]}connectedCallback(){this._syncTraits()}disconnectedCallback(){for(const t of this._traits)this._destroyTrait(t);this._traits=[]}attributeChangedCallback(t){if(t===qr)this._syncTraits()}_syncTraits(){const t=(this.getAttribute(qr)||"").split(/\s+/).filter(Boolean),e=[];for(const s of this._traits)t.includes(s.constructor.traitName)?e.push(s):this._destroyTrait(s);if(t.length>0){const s=function(t){const e=t.ui&&t.ui.traits||{};return Object.values(e).reduce((t,e)=>(t[e.traitName]=e,t),{})}(Dr.MisoClient);for(const i of t){if(this._traits.find(t=>t.constructor.traitName===i))continue;const t=s[i];if(!t){console.warn("Unknown trait: "+i);continue}const o=new t(this);e.push(o)}}this._traits=e}_destroyTrait(t){try{t._destroy&&t._destroy()}catch(t){console.error(t)}}}let zr,Mr,Fr;async function Br(t){const e=await async function(t){return t.MisoClient||window.MisoClient||zr||(zr=async function(){return new Promise(t=>{(window.misocmd||(window.misocmd=[])).push(()=>t(window.MisoClient))})}())}(t);var s;return Mr=Mr||e.any(),Fr=Fr||await Mr,Fr.ui||await(s=0,new Promise(t=>setTimeout(t,s))),Fr}const Qr="logo",Gr="auto",Hr=Object.freeze([...Dr.observedAttributes,Qr]);function Wr(t){if(!t)return Gr;switch(t){case"true":return!0;case"false":return!1;default:throw Error(`Invalid logo attribute value: ${t}.`)}}class Vr extends Dr{static get observedAttributes(){return Hr}constructor(){super(),this._workflow=void 0,this._components=new Set}get isContainer(){return!0}get workflow(){return this._workflow}set workflow(t){this._setWorkflow(t)}get logo(){return Wr(this.getAttribute(Qr))}set logo(t){if(this.logo===t)return;const e=function(t){switch(t){case Gr:return;case!0:return"true";case!1:return"false";default:throw Error(`Invalid logo property value: ${t}.`)}}(t);e?this.setAttribute(Qr,e):this.removeAttribute(Qr)}async connectedCallback(){super.connectedCallback();const t=this._client=await Br(Vr);document.body.contains(this)&&(this._setWorkflow(this._getWorkflow(t)),this._onConnected(t))}disconnectedCallback(){this._setWorkflow(void 0),super.disconnectedCallback()}_onConnected(t){}_getWorkflow(t){throw Error("Unimplemented")}_setWorkflow(t){this._workflow!==t&&(this._workflow&&this._workflow._views.removeContainer(this),t&&t._views.addContainer(this),this._workflow=t)}attributeChangedCallback(t,e,s){if(t===Qr)this._handleLogoUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleLogoUpdate(t,e){Wr(t)!==Wr(e)&&this._workflow&&this._workflow._views.refreshElement(this)}get components(){return[...this._components]}_addComponent(t){this._components.has(t)||(this._components.add(t),this._workflow&&this._workflow._views.addComponent(t))}_removeComponent(t){this._components.has(t)&&(this._workflow&&this._workflow._views.removeComponent(t),this._components.delete(t))}_updateComponentRole(t,e,s){this._workflow&&this._workflow._views.updateComponentRole(t,e,s)}}const Yr="workflow",Kr="parent-question-id",Zr=Object.freeze([...Vr.observedAttributes,Yr,Kr]);const Jr="unit-id",Xr=Object.freeze([...Vr.observedAttributes,Jr]);class ta extends Vr{static get observedAttributes(){return Xr}_getWorkflow(t){return this._getWorkflowByUnitId(t,this.unitId)}_getWorkflowByUnitId(t,e){throw Error("Not implemented")}get unitId(){return this.getAttribute(Jr)||void 0}set unitId(t){(t=t&&""+t)?this.setAttribute(Jr,t):this.removeAttribute(Jr)}attributeChangedCallback(t,e,s){if(t===Jr)this._handleUnitIdUpdate(e,s);else super.attributeChangedCallback(t,e,s)}_handleUnitIdUpdate(t,e){t!==e&&this._client&&this._setWorkflow(this._getWorkflowByUnitId(this._client,e))}}var ea=Object.freeze({__proto__:null,MisoAskElement:class extends Vr{static get tagName(){return"miso-ask"}static get observedAttributes(){return Zr}_getWorkflow(t){return this.boundToActiveWorkflow?t.ui.asks.active:this._getWorkflowByParentQuestionId(t,this.parentQuestionId)}_getWorkflowByParentQuestionId(t,e){return t.ui.asks.getByParentQuestionId(e,{autoCreate:!0})}get parentQuestionId(){return this.getAttribute(Kr)||void 0}set parentQuestionId(t){(t=void 0!==t?""+t:void 0)!==this.parentQuestionId&&(t?this.setAttribute(Kr,t):this.removeAttribute(Kr))}get boundToActiveWorkflow(){return"active"===this.getAttribute(Yr)}_setWorkflow(t){this._workflow!==t&&(super._setWorkflow(t),t&&(this.parentQuestionId=t.parentQuestionId))}async connectedCallback(){if(await super.connectedCallback(),document.body.contains(this)){this._unsubscribes=[...this._unsubscribes||[],this._client.ui.asks.on("active",t=>{this.boundToActiveWorkflow&&(this.workflow=t.workflow)})]}}disconnectedCallback(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],super.disconnectedCallback()}attributeChangedCallback(t,e,s){switch(t){case Kr:this._handleParentQuestionIdUpdate(e,s);break;case Yr:this._handleQuestionUpdate(e,s);break;default:super.attributeChangedCallback(t,e,s)}}_handleQuestionUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&e===ATTR_VALUE_ACTIVE&&this._setWorkflow(this._getWorkflow(this._client))}_handleParentQuestionIdUpdate(t,e){(t=t||void 0)!==(e=e||void 0)&&this._client&&this._setWorkflow(this._getWorkflowByParentQuestionId(this._client,e))}},MisoExploreElement:class extends ta{static get tagName(){return"miso-explore"}static get observedAttributes(){return ta.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.explores.get(e)}},MisoHybridSearchElement:class extends Vr{static get tagName(){return"miso-hybrid-search"}static get observedAttributes(){return Vr.observedAttributes}_getWorkflow(t){return t.ui.hybridSearch}},MisoSearchElement:class extends Vr{static get tagName(){return"miso-search"}static get observedAttributes(){return Vr.observedAttributes}_getWorkflow(t){return t.ui.search}},MisoRecommendationElement:class extends ta{static get tagName(){return"miso-recommendation"}static get observedAttributes(){return ta.observedAttributes}_getWorkflowByUnitId(t,e){return t.ui.recommendations.get(e)}}});const sa="role",ia=Object.freeze([sa]);class oa extends HTMLElement{static get tagName(){return"miso-component"}static get observedAttributes(){return ia}constructor({role:t}={}){super(),t&&Object.defineProperty(this,"_role",{value:t,writable:!1})}get role(){return this._role}connectedCallback(){const t=function(t){for(let e=t;e;e=e.parentNode)if(e.isContainer)return e;throw Error(t.tagName+" needs to be placed under a workflow container element.")}(this);this._container&&this._container!==t&&this._container._removeComponent(this),this._syncRole(),t._addComponent(this),this._container=t,this._containerResolution&&this._containerResolution.resolve(t)}_syncRole(){const t=this.getAttribute(sa);if(t)this._role?console.warn(`Element <${this.tagName}>' already has a predefined role '${this._role}', so attribute '${sa}="${t}"' is ignored.`):this._role=t;else if(!this._role)throw Error(`An attribute '${sa}' is required for element <${this.tagName}>`)}disconnectedCallback(){this._container&&(this._container._removeComponent(this),this._container=void 0,this._containerResolution=void 0)}attributeChangedCallback(t,e,s){e!==s&&t===sa&&this._container&&this._container._updateComponentRole(this,e,s)}}var na=Object.freeze({__proto__:null,MisoComponentElement:oa,MisoQueryElement:class extends oa{constructor(){super({role:ie.QUERY})}static get tagName(){return"miso-query"}},MisoFollowUpQuestionsElement:class extends oa{constructor(){super({role:ie.FOLLOW_UP_QUESTIONS})}static get tagName(){return"miso-follow-up-questions"}},MisoQuerySuggestionsElement:class extends oa{constructor(){super({role:ie.QUERY_SUGGESTIONS})}static get tagName(){return"miso-query-suggestions"}},MisoFeedbackElement:class extends oa{constructor(){super({role:ie.FEEDBACK})}static get tagName(){return"miso-feedback"}},MisoResultsElement:class extends oa{constructor(){super({role:ie.PRODUCTS})}connectedCallback(){console.warn("Element <miso-results> is deprecated. Please use <miso-products> instead."),super.connectedCallback()}static get tagName(){return"miso-results"}},MisoProductsElement:class extends oa{constructor(){super({role:ie.PRODUCTS})}static get tagName(){return"miso-products"}},MisoQuestionElement:class extends oa{constructor(){super({role:ie.QUESTION})}static get tagName(){return"miso-question"}},MisoAnswerElement:class extends oa{constructor(){super({role:ie.ANSWER})}static get tagName(){return"miso-answer"}},MisoReasoningElement:class extends oa{constructor(){super({role:ie.REASONING})}static get tagName(){return"miso-reasoning"}},MisoSourcesElement:class extends oa{constructor(){super({role:ie.SOURCES})}static get tagName(){return"miso-sources"}},MisoImagesElement:class extends oa{constructor(){super({role:ie.IMAGES})}static get tagName(){return"miso-images"}},MisoRelatedResourcesElement:class extends oa{constructor(){super({role:ie.RELATED_RESOURCES})}static get tagName(){return"miso-related-resources"}},MisoRelatedQuestionsElement:class extends oa{constructor(){super({role:ie.RELATED_QUESTIONS})}static get tagName(){return"miso-related-questions"}},MisoAffiliationElement:class extends oa{constructor(){super({role:ie.AFFILIATION})}static get tagName(){return"miso-affiliation"}},MisoKeywordsElement:class extends oa{constructor(){super({role:ie.KEYWORDS})}static get tagName(){return"miso-keywords"}},MisoTotalElement:class extends oa{constructor(){super({role:ie.TOTAL})}static get tagName(){return"miso-total"}},MisoFacetsElement:class extends oa{constructor(){super({role:ie.FACETS})}static get tagName(){return"miso-facets"}},MisoMoreElement:class extends oa{constructor(){super({role:ie.MORE})}static get tagName(){return"miso-more"}},MisoSortElement:class extends oa{constructor(){super({role:ie.SORT})}static get tagName(){return"miso-sort"}},MisoErrorElement:class extends oa{constructor(){super({role:ie.ERROR})}static get tagName(){return"miso-error"}}});class ra extends Dr{static get observedAttributes(){return Dr.observedAttributes}constructor(){super(),this._context=void 0}get context(){return this._context}set context(t){this._setContext(t)}async connectedCallback(){super.connectedCallback();const t=this._client=await Br(ra);document.body.contains(this)&&this._setContext(this._getContext(t))}disconnectedCallback(){this._setContext(void 0),super.disconnectedCallback()}_getContext(t){throw Error("Unimplemented")}_setContext(t){if(this._context===t)return;const e=this._context;this._context=t,this._onContext(t,e)}_onContext(){}}var aa=Object.freeze({__proto__:null,MisoFollowUpsElement:class extends ra{static get tagName(){return"miso-follow-ups"}static get observedAttributes(){return ra.observedAttributes}constructor(){super(),this._elementToWorkflow=new WeakMap,this._unsubscribes=[]}_getContext(t){return t.ui.asks}_onContext(t,e){t!==e&&(this._unwire(),this._wire(t))}_unwire(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[]}_wire(t){t&&(t._autoNextFn||t.autoNext(),this._unsubscribes.push(t.on("create",t=>{const{parentQuestionId:e}=t,s=t._options.resolved.templates.followUp;if(!e||!s)return;const i=this.children.length;this.insertAdjacentHTML("beforeend",s({parentQuestionId:e}));const o=this.children.length;for(const e of Array.prototype.slice.call(this.children,i,o))this._elementToWorkflow.set(e,t)})),this._unsubscribes.push(t.on("loading",({workflow:t})=>{for(const e of this.children)if(this._elementToWorkflow.get(e)===t){e.scrollIntoView({behavior:"smooth",block:"start"});break}})),this._unsubscribes.push(t.on("destroy",({workflow:t})=>{for(const e of this.children)this._elementToWorkflow.get(e)===t&&(this._elementToWorkflow.delete(e),e.remove())})))}}});class ca extends HTMLElement{constructor(){super()}async connectedCallback(){document.body.contains(this)&&this._setCombo(this._getCombo(ca.MisoClient))}disconnectedCallback(){}_getCombo(t){throw Error("Unimplemented")}_setCombo(t){this._combo!==t&&(this._combo=t,t.element=this,t.autoStart())}}var la=Object.freeze({__proto__:null,containers:ea,roles:na,contexts:aa,combos:Object.freeze({__proto__:null,MisoAskComboElement:class extends ca{static get tagName(){return"miso-ask-combo"}constructor(){super()}_getCombo(t){return t.ui.combo.ask}}}),MisoBannerElement:Zs,MisoStubElement:Dr});const ua="miso-hybrid-search-combo";var ha=Object.freeze({__proto__:null,CLASS_PREFIX:ua,CONAINER_TAG:"miso-hybrid-search"});const da="Show more",_a="Show less";var pa=Object.freeze({__proto__:null,question:"You asked ${value}",sources:"Sources",keywords:"You searched for ${value}",total:"${value} Results",showMore:da,showLess:_a});const ma=j(new hn({...ha,DEFAULT_PHRASES:pa})),fa=j(new class extends un{constructor(){super({helpers:ma})}answer(t){const{container:e}=this._helpers;return e(t,{name:"answer",visibleWhen:"ready !unanswerable"},[...this.question(t),"<miso-answer></miso-answer>","<miso-feedback></miso-feedback>"])}answerBox(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box"]},[e("div",{classes:[s+"__answer-box-inner"]},this.answerGroup(t)),this.answerBoxToggle(t)])}question(t){const{phrase:e}=this._helpers;return e(t,{name:"question",tag:"div"}).replaceAll("${value}","<miso-question></miso-question>")}answerBoxToggle(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__answer-box-toggle-container"]},[e("div",{classes:[s+"__answer-box-toggle"],"data-role":"answer-box-toggle"})])}searchResultsGroup(t){const{container:e}=this._helpers;return e(t,{name:"search-results",visibleWhen:"loading ready"},[this.searchResultsInfoGroup(t),this.searchResultsFilters(t),"<miso-products></miso-products>",this.more(t)])}searchResultsInfoGroup(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-info"]},[this.keywords(t),this.total(t)])}searchResultsFilters(t){const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-filters"]},["<miso-facets></miso-facets>","<miso-sort></miso-sort>"])}keywords(t){const{phrase:e}=this._helpers;return e(t,{name:"keywords",tag:"div",inline:!0}).replaceAll("${value}","<miso-keywords></miso-keywords>")}total(t){const{phrase:e}=this._helpers;return e(t,{name:"total",tag:"div",inline:!0}).replaceAll("${value}","<miso-total></miso-total>")}more(t){if(!t.moreButton)return"";const{element:e}=this._helpers,{classPrefix:s}=t;return e("div",{classes:[s+"__search-results-more-container"]},["<miso-more></miso-more>"])}}({helpers:ma}));var ga=Object.freeze({__proto__:null,helpers:ma,sections:fa,root:function(t={}){const{normalizeOptions:e,section:s,container:i}=ma;t=e(t);const{answerBox:o,answerGroup:n,searchResultsGroup:r}=fa,{answerBox:a=!1}=t;return""+s(t,{name:"question"},[i(t,{name:"query"},"<miso-query></miso-query>")])+s(t,{name:"answer"},a?[o(t)]:n(t))+s(t,{name:"search-results"},r(t))}});const ba="answer-box-open",ya="answer-box-shown",va='[data-role="answer-box-toggle"]';class wa{constructor(t,e,{classPrefix:s=ua,phrases:i={},hideWhenUnanswerable:o=!0}={}){this._client=t,this._workflow=t.ui.hybridSearch,this._element=e,this._classPrefix=s,this._phrases=i,this._hideWhenUnanswerable=o,this._init()}_init(){const t=this._element,e=this._workflow;e.answerBox=this,e._unsubscribes.push(()=>{e.answerBox===this&&(this.destroy(),e.answerBox=void 0)});const s=t=>this._handleClick(t);t.addEventListener("click",s),this._syncWofkflowStatus(),this._syncButtonText(),this._unsubscribes=[()=>t.removeEventListener("click",s),e._answer._hub.on("data",()=>this._syncWofkflowStatus())]}_handleClick({target:t,button:e}){0===e&&t.closest(va)&&this.toggleOpen()}_syncWofkflowStatus(){const{status:t}=this._workflow._answer,{meta:{unanswerable:e=!1}={}}=this._workflow._answer._hub.states.data;switch(t){case de.ERRONEOUS:case de.READY:e&&this._hideWhenUnanswerable?this.hide():this.show();break;default:this.hide()}}_updateBoxStatus(t,e){this._element.classList[t](`${this._classPrefix}__${e}`)}_syncButtonText(){const t=this.isOpen?this._phrases.showLess||_a:this._phrases.showMore||da;for(const e of this._element.querySelectorAll(va))e.textContent=t}_syncScroll(){this.isOpen||this._element.scrollIntoView({behavior:"smooth"})}destroy(){for(const t of this._unsubscribes)t();const t=this._workflow;t&&t.answerBox===this&&delete t.answerBox}}const Ea={isOpen:ba,shown:ya},xa={toggleOpen:["toggle",ba],open:["add",ba],close:["remove",ba],toggleHidden:["toggle",ya],show:["add",ya],hide:["remove",ya]};for(const[t,e]of Object.entries(Ea))Object.defineProperty(wa.prototype,t,{get(){return this._element.classList.contains(`${this._classPrefix}__${e}`)}});for(const[t,[e,s]]of Object.entries(xa))wa.prototype[t]=function(){this._updateBoxStatus(e,s),s===ba&&(this._syncButtonText(),this._syncScroll())};const Sa=Object.freeze(ha),Oa=Object.freeze(pa),ka=Object.freeze(ga);var Ia=Object.freeze({__proto__:null,constants:Sa,phrases:Oa,templates:ka,wireAnswerBox:function(t,e,s={}){if(!t)throw Error("client is required");e&&new wa(t,e,s)}});const Ca=Object.freeze(Or),Ta=Object.freeze(Ia);var Aa=Object.freeze({__proto__:null,ask:Ca,hybridSearch:Ta});function Ra(t){const e=t._element;if(!e)return()=>{};const s=e=>t._handleClick(e);return e.addEventListener("click",s),()=>e.removeEventListener("click",s)}const Na="miso-collapsible",$a="expanded",La=[{action:"expand",classAction:"add",className:$a},{action:"collapse",classAction:"remove",className:$a}];class Ua{static get traitName(){return"collapsible"}constructor(t){this._element=t,t.collapsible=this,t.classList.add(Na),this._unsubscribes=[Ra(this)]}_destroy(){for(const t of this._unsubscribes||[])t();this._unsubscribes=[],delete this._element.collapsible,this._element.classList.remove(Na),this._element=void 0}toggle(){this.expanded?this.collapse():this.expand()}}!function(t,e){for(const s of e)Object.defineProperty(t,s,{get(){return this._element&&this._element.classList.contains(s)}})}(Ua.prototype,[$a]),function(t,e){for(const{action:s,classAction:i,className:o}of e)t[s]=function(){this._element&&this._element.classList[i](o),this["_"+s]&&this["_"+s]()}}(Ua.prototype,La),function(t,e){t._handleClick=function(t){const{target:s,button:i}=t;if(0===i)for(let{role:i,selector:o,action:n}of e)if(o=o||`[data-role="${i}"]`,o&&s.closest(o))return this[n](),void t.stopPropagation()}}(Ua.prototype,[{role:"expand",action:"expand"},{role:"collapse",action:"collapse"},{role:"toggle-expand",action:"toggle"}]);var Pa=Object.freeze({__proto__:null,CollapsibleTrait:Ua});let qa,ja;async function Da(){return ja||(ja=R(qa||(qa=N("ui"))))}class za{constructor(t,e){this._plugin=t,this._client=e,this._contexts={}}async require(t){if(this._contexts[t])return this._contexts[t];const e=await this._plugin.requireExtension(t);return this._contexts[t]=e.getContext(this._client)}}class Ma{constructor(t,e){this._plugin=t,this._client=e,u(this,{sources:{api:Ss(e)}})}get recommendations(){return this._recommendations||(this._recommendations=this._plugin._getRecommendations(this._client))}get recommendation(){return this.recommendations.get()}get search(){return this._search||(this._search=new or(this._plugin,this._client))}get asks(){return this._asks||(this._asks=this._plugin._getAsks(this._client))}get ask(){return this.asks.root}get hybridSearch(){return this._hybridSearch||(this._hybridSearch=new Zn(this._plugin,this._client))}get explores(){return this._explores||(this._explores=this._plugin._getExplores(this._client))}get explore(){return this.explores.get()}get ready(){return this._plugin._ready.promise}}class Fa{constructor(t,e){this._plugin=t,this._MisoClient=e}get ask(){return this._ask||(this._ask=new Ur(this._plugin,this._MisoClient))}}Nt.plugins.use(class extends Y{static get id(){return"std:ui"}constructor(){super("ui"),this.layouts=new Pr(this),this._recommendations=new WeakMap,this._explores=new WeakMap,this._asks=new WeakMap,this._extensions=new WeakMap,this._ready=new I}async install(t,e){e.addSubtree(this),t.on("create",this._injectClient.bind(this));const s={defaults:Aa,traits:Pa};l(s,this,["layouts","combo","ready"]),u(this,{MisoClient:t}),u(t,{ui:s}),this.combo=new Fa(this,t);const i=Object.values($o).filter(t=>t.type);for(const e of i)e.MisoClient=t;for(const t of i)this.layouts.register(t);const{containers:o,roles:n,combos:r,contexts:a,...c}=la,h=[...Object.values(r),...Object.values(a),...Object.values(o),...Object.values(n),...Object.values(c)],d=[Vr,ra,ca];for(const e of[...d,...h])e.MisoClient=t;await Da();for(const t of h)b(t);this._ready.resolve()}async requireExtension(t){if("markdown"===t)return await this.MisoClient.plugins.install("std:ui-markdown");throw Error("Unknown extension: "+t)}get ready(){return Promise.all([this._ready.promise,MisoClient.any()]).then(()=>{})}_injectClient(t){u(t,{ui:new Ma(this,t)})}_getExtensions(t){if(this._extensions.has(t))return this._extensions.get(t);const e=new za(this,t);return this._extensions.set(t,e),e}_getRecommendations(t){let e=this._recommendations.get(t);return e||this._recommendations.set(t,e=new _r(this,t)),e}_getExplores(t){let e=this._explores.get(t);return e||this._explores.set(t,e=new vr(this,t)),e}_getAsks(t){let e=this._asks.get(t);return e||this._asks.set(t,e=new Sn(this,t)),e}}),Nt.attach(),function(t){const e=[];function s(t){e.push(t)}T("misodev",{transform:t=>()=>t({addCmdTransform:s})});const i=t=>{for(const s of e)t=s(t);return t};setTimeout(()=>{T("misocmd",{transform:i}),t&&t()})}(function(){Ct._cmdRes.resolve()});const Ba="/search",Qa="Bond Buyer",Ga="www.bondbuyer.com",Ha=window.location.hostname===Ga,Wa=`Powered by ${Qa} AI Answers`,Va=Qa+"'s AI Answers sources information from more than 10 years of trusted content produced by our award-winning journalists and expert contributors.",Ya=`This answer was based on the following ${Qa} articles:`,Ka="miso-arizent-icon",Za=Ka+"-svg",Ja="ai-search",Xa="close-x",tc="trending",ec=`<svg id="${Za}" style="display:none;">${[`<symbol id="${Ka}-${Ja}" viewBox="0 0 24 24"><path d="M16.6 22L10.3 15.7C9.8 16.1 9.225 16.4167 8.575 16.65C7.925 16.8833 7.23333 17 6.5 17C4.68333 17 3.14583 16.3708 1.8875 15.1125C0.629167 13.8542 0 12.3167 0 10.5C0 8.68333 0.629167 7.14583 1.8875 5.8875C3.14583 4.62917 4.68333 4 6.5 4C8.31667 4 9.85417 4.62917 11.1125 5.8875C12.3708 7.14583 13 8.68333 13 10.5C13 11.2333 12.8833 11.925 12.65 12.575C12.4167 13.225 12.1 13.8 11.7 14.3L18 20.6L16.6 22ZM6.5 15C7.75 15 8.8125 14.5625 9.6875 13.6875C10.5625 12.8125 11 11.75 11 10.5C11 9.25 10.5625 8.1875 9.6875 7.3125C8.8125 6.4375 7.75 6 6.5 6C5.25 6 4.1875 6.4375 3.3125 7.3125C2.4375 8.1875 2 9.25 2 10.5C2 11.75 2.4375 12.8125 3.3125 13.6875C4.1875 14.5625 5.25 15 6.5 15Z" fill="currentColor"/><path d="M21.5 15L22.2833 13.2833L24 12.5L22.2833 11.7167L21.5 10L20.7167 11.7167L19 12.5L20.7167 13.2833L21.5 15Z" fill="currentColor"/><path d="M17.5 9L18.91 5.91L22 4.5L18.91 3.09L17.5 0L16.09 3.09L13 4.5L16.09 5.91L17.5 9Z" fill="currentColor"/></symbol>`,`<symbol id="${Ka}-${Xa}" viewBox="0 0 14 14"><path fill-rule="nonzero" fill="currentColor" d="M6.336 7L0 .664.664 0 7 6.336 13.336 0 14 .664 7.664 7 14 13.336l-.664.664L7 7.664.664 14 0 13.336 6.336 7z"/></symbol>`,`<symbol id="${Ka}-${tc}" viewBox="0 0 24 24"><path d="M3.4 18L2 16.6L9.4 9.15L13.4 13.15L18.6 8H16V6H22V12H20V9.4L13.4 16L9.4 12L3.4 18Z" fill="currentColor"/></symbol>`].join("")}</svg>`;let sc=!1;function ic(t){return`<svg class="miso-arizent-icon miso-arizent-icon-${t}"><use href="#${Ka}-${t}"></use></svg>`}sc||document.head.querySelector("#"+Za)||(sc=!0,document.head.insertAdjacentHTML("beforeend",ec));const oc=ic(Ja),nc=ic(Xa),rc=ic(tc),ac=`<div class="miso-powered-by"><span class="miso-powered-by__icon"></span><span class="miso-powered-by__text">${Wa}</span></div>`,cc=`<div class="miso-resource-attribution">${Va}</div>`,lc=`\n<div class="miso-page-header-search">\n  <button class="miso-page-header-search-button miso-icon-button">\n    <span class="sr-only">Show Search</span>\n    <span class="miso-page-header-search-button__icon">\n      ${oc}\n      ${nc}\n    </span>\n  </button>\n</div>\n`,uc=`\n<form class="miso-page-header-search-form" action="/search#nt=navsearch" novalidate="" autocomplete="off">\n  <label>\n    <input placeholder="Search by topic, interests, or ask a question..." type="text" class="miso-page-header-search-input" name="q" required="required">\n    <span class="sr-only">Search Query</span>\n    <button type="submit" class="miso-page-header-search-submit">\n      ${oc}\n      <span class="sr-only">Submit Search</span>\n    </button>\n  </label>\n</form>\n`,hc=`\n<div class="miso-page-header-search-overlay__columns">\n  <div class="miso-page-header-search-overlay__trending-topics">\n    <hr>\n    <h2>Trending Topics</h2>\n    <ul>\n      ${["Cryptocurrency","Stablecoin","Blockchain","Cross Border Payments","On-Chain Finance","Regulation and Compliance"].map(function(t){return`<li><a href="${Ba}?q=${encodeURIComponent(t)}">${rc}<span>${t}</span></a></li>`}).join("")}\n    </ul>\n  </div>\n  <div class="miso-page-header-search-overlay__popular-questions">\n    <hr>\n    <h2>Popular Questions</h2>\n    <ul>\n      ${["What is blockchain?","Is Bitcoin a stable coin?","What is a stablecoin?","Which payment providers are adopting stablecoins?","How will Zelle adoption stablecoins affect the crypto market?","What are the long-term implications of adoption of stablecoins?"].map(function(t){return`<li><a href="${Ba}?q=${encodeURIComponent(t)}">${t}</a></li>`}).join("")}\n    </ul>\n  </div>\n  <div class="miso-page-header-search-overlay__upcoming-event">\n    \x3c!--\n    <hr>\n    <h2>Upcoming Event</h2>\n    --\x3e\n  </div>\n</div>\n`,dc=`\n<div class="miso-page-header-search-overlay">\n  <h2>Find Answers</h2>\n  ${uc.trim()}\n  <div>\n    ${ac}\n  </div>\n  ${hc.trim()}\n</div>\n`;const _c='\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__answer">\n  <miso-hybrid-search class="miso-hybrid-search-combo__answer-container miso-circled-citation-index" logo="false">\n    <miso-answer></miso-answer>\n  </miso-hybrid-search>\n</section>\n',pc=`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__sources">\n  <miso-hybrid-search class="miso-hybrid-search-combo__sources-container" visible-when="nonempty" logo="false">\n    <div class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__sources-phrase">${Ya}</div>\n    <miso-sources></miso-sources>\n  </miso-hybrid-search>\n</section>\n`,mc='\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__results">\n  <miso-hybrid-search class="miso-hybrid-search-combo__results-container miso-circled-citation-index" logo="false">\n    <div class="miso-hybrid-search-combo__results-header">\n      <div class="miso-hybrid-search-combo__phrase-inline miso-hybrid-search-combo__total-phrase">\n        <miso-total></miso-total> Matching Results for Your Search\n      </div>\n      <div class="miso-hybrid-search-combo__search-results-filters">\n        <miso-sort></miso-sort>\n      </div>\n    </div>\n    <miso-products></miso-products>\n  </miso-hybrid-search>\n  <miso-hybrid-search class="miso-hybrid-search-combo__results-more-container miso-circled-citation-index" visible-when="ready" logo="false">\n    <div class="miso-hybrid-search-combo__results-more-container__inner">\n      <miso-more></miso-more>\n    </div>\n  </miso-hybrid-search>\n</section>\n',fc=`\n<div id="miso-hybrid-search-combo" class="miso-hybrid-search-combo">\n  <div class="miso-hybrid-search-combo__grid">\n    <div class="miso-hybrid-search-combo__grid-query">${`\n<section class="miso-hybrid-search-combo__section miso-hybrid-search-combo__question">\n  <miso-hybrid-search class="miso-hybrid-search-combo__query-container miso-circled-citation-index" logo="false">\n    <h2 class="miso-hybrid-search-combo__phrase miso-hybrid-search-combo__question-phrase">Search Results for</h2>\n    <miso-query>\n      <div class="miso-search-box" data-role="query">\n        <div class="miso-search-box__input-group">\n          <input class="miso-search-box__input" type="text" data-role="input">\n          <button class="miso-search-box__button" type="submit" data-role="submit">\n            ${oc}\n          </button>\n        </div>\n        <div class="miso-autocomplete" data-role="autocomplete">\n          <ul class="miso-autocomplete__query-list" data-role="query-list"></ul>\n          <ul class="miso-autocomplete__product-list" data-role="product-list"></ul>\n        </div>\n      </div>\n    </miso-query>\n    ${ac}\n    ${cc}\n  </miso-hybrid-search>\n</section>\n`.trim()}</div>\n    <div class="miso-hybrid-search-combo__grid-answer">${_c.trim()}</div>\n    <div class="miso-hybrid-search-combo__grid-sources">${pc.trim()}</div>\n    <div class="miso-hybrid-search-combo__grid-results">${mc.trim()}</div>\n  </div>\n</div>\n`;function gc(t,e,s){return t.templates.article(t,e,Sc(s))}function bc(t,e,s){s=Sc(s);const{templates:{helpers:i}}=t,{url:o,...n}=s,[r,a]=i.tagPair(t,n);return[r,yc(t,s),vc(t,s),a].join("")}function yc(t,e){const{className:s,templates:{descriptionBlock:i,dateBlock:o}}=t;return`<div class="${s}__item-info-container">${[wc(t,e),Ec(t,e),i(t,e),xc(t,e),o(t,e)].join("")}</div>`}function vc(t,e){const{className:s}=t,{cover_image:i,url:o}=e;if(!i)return"";const n=`<img class="${s}__item-cover-image" src="${i}">`;return o?`<a class="${s}__item-cover-image-container" href="${o}">${n}</a>`:`<div class="${s}__item-cover-image-container">${n}</div>`}function wc({className:t},{tags:e=[]}){const s=e[0];return s?`<a class="${t}__item-section" href="${i=s,"/"+i.toLowerCase().replace(" ","-")}">${s}</a>`:"";var i}function Ec({className:t,templates:{helpers:e}},{title:s,_title_with_markups:i,url:o}){const n=e.formatHtmlWithMarkup(i)||e.escapeHtml(s);return n?o?`<a class="${t}__item-title" href="${o}">${n}</a>`:`<div class="${t}__item-title">${n}</div>`:""}function xc(t,{authors:e=[]}){const s=e[0];return s?`<div class="${t.className}__item-author-phrase">By <a href="${function(t){return"/author/"+t.toLowerCase().replace(" ","-")}(s)}" class="${t.className}__item-author">${s}</a></div>`:""}function Sc(t){return Ha?t:function(t){if(!t.url||!t.url.startsWith(`https://${Ga}/`))return t;return{...t,url:t.url.replace(`https://${Ga}/`,"/")}}(t)}const Oc=".Page-header",kc=".Page-header-bottom-bar",Ic=".Page-header-buttons",Cc=".Page-header-search-overlay";const Tc=".SearchResultsPage-content",Ac=["cover_image","url","created_at","updated_at","published_at","authors","tags","type","custom_attributes"];const Rc=new Nt("YFt75g0BghnBdNox5VmoFO8bZiw0YmCs3lM08isR"),Nc=window.location.pathname;!async function(){!function(){const t=document.querySelector(Ic);if(!t)return void console.error("Page header buttons not found: "+Ic);t.insertAdjacentHTML("beforeend",lc.trim());const e=document.querySelector(".miso-page-header-search");if(!e)return void console.error("Miso page header search button not found: .miso-page-header-search");e.addEventListener("click",()=>{!function(t,e,s){t.getAttribute(e)===s?t.removeAttribute(e):t.setAttribute(e,s)}(document.body,"data-toggle-header","miso-search-overlay")})}(),function(){const t=document.querySelector(Oc);if(!t)return void console.error("Page header not found: "+Oc);const e=document.querySelector(Cc);if(e)return void e.insertAdjacentHTML("afterend",dc.trim());const s=document.querySelector(kc);if(s)return void s.insertAdjacentHTML("beforebegin",dc.trim());t.insertAdjacentHTML("beforeend",dc.trim())}()}(),Nc===Ba&&async function(t){await t.ui.ready;const e=document.querySelector(Tc);if(!e)return void console.error("Search page root element not found: "+Tc);e.innerHTML=fc.trim();const s=t.ui.hybridSearch;s.useApi({fl:Ac}),s.useLayouts({products:{templates:{product:bc,article:gc},infiniteScroll:!1},more:{className:"miso-primary-button",templates:{text:()=>"Load More Results"}}}),s.autoQuery()}(Rc)}();
